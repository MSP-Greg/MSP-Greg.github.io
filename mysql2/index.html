<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: README &mdash; Mysql2 master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "README",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Mysql2 master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: README&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1><a href="Mysql2.html" title="Mysql2 (module)"><code>Mysql2</code></a> - A modern, simple and very fast MySQL library for Ruby - binding to libmysql</h1>

<p>GitHub Actions
<a href="https://github.com/brianmario/mysql2/actions/workflows/build.yml"><img src="https://github.com/brianmario/mysql2/actions/workflows/build.yml/badge.svg" alt="GitHub Actions Status: Build"></a>
<a href="https://github.com/brianmario/mysql2/actions/workflows/container.yml"><img src="https://github.com/brianmario/mysql2/actions/workflows/container.yml/badge.svg" alt="GitHub Actions Status: Container"></a>
Appveyor CI
<a href="https://ci.appveyor.com/project/sodabrew/mysql2"><img src="https://ci.appveyor.com/api/projects/status/github/sodabrew/mysql2" alt="Appveyor CI Status"></a></p>

<p>The Mysql2 gem is meant to serve the extremely common use-case of connecting, querying and iterating on results.
Some database libraries out there serve as direct 1:1 mappings of the already complex C APIs available.
This one is not.</p>

<p>It also forces the use of UTF-8 [or binary] for the connection and uses encoding-aware MySQL API calls where it can.</p>

<p>The API consists of three classes:</p>

<p><a href="Mysql2/Client.html" title="Mysql2::Client (class)"><code>::Mysql2::Client</code></a> - your connection to the database.</p>

<p><a href="Mysql2/Result.html" title="Mysql2::Result (class)"><code>::Mysql2::Result</code></a> - returned from issuing a #query on the connection. It includes Enumerable.</p>

<p><a href="Mysql2/Statement.html" title="Mysql2::Statement (class)"><code>::Mysql2::Statement</code></a> - returned from issuing a #prepare on the connection. Execute the statement to get a Result.</p>

<h2>Installing</h2>

<h3>General Instructions</h3>

<pre class="code sh"><code class="sh">gem install mysql2
</code></pre>

<p>This gem links against MySQL&#39;s <code>libmysqlclient</code> library or <code>Connector/C</code>
library, and compatible alternatives such as MariaDB.
You may need to install a package such as <code>libmariadb-dev</code>, <code>libmysqlclient-dev</code>,
<code>mysql-devel</code>, or other appropriate package for your system. See below for
system-specific instructions.</p>

<p>By default, the mysql2 gem will try to find a copy of MySQL in this order:</p>

<ul>
<li>Option <code>--with-mysql-dir</code>, if provided (see below).</li>
<li>Option <code>--with-mysql-config</code>, if provided (see below).</li>
<li>Several typical paths for <code>mysql_config</code> (default for the majority of users).</li>
<li>The directory <code>/usr/local</code>.</li>
</ul>

<h3>Configuration options</h3>

<p>Use these options by <code>gem install mysql2 -- [--optionA] [--optionB=argument]</code>.</p>

<ul>
<li><p><code>--with-mysql-dir[=/path/to/mysqldir]</code> -
Specify the directory where MySQL is installed. The mysql2 gem will not use
<code>mysql_config</code>, but will instead look at <code>mysqldir/lib</code> and <code>mysqldir/include</code>
for the library and header files.
This option is mutually exclusive with <code>--with-mysql-config</code>.</p></li>
<li><p><code>--with-mysql-config[=/path/to/mysql_config]</code> -
Specify a path to the <code>mysql_config</code> binary provided by your copy of MySQL. The
mysql2 gem will ask this <code>mysql_config</code> binary about the compiler and linker
arguments needed.
This option is mutually exclusive with <code>--with-mysql-dir</code>.</p></li>
<li><p><code>--with-mysql-rpath=/path/to/mysql/lib</code> / <code>--without-mysql-rpath</code> -
Override the runtime path used to find the MySQL libraries.
This may be needed if you deploy to a system where these libraries
are located somewhere different than on your build system.
This overrides any rpath calculated by default or by the options above.</p></li>
<li><p><code>--with-openssl-dir[=/path/to/openssl]</code> - Specify the directory where OpenSSL
is installed. In most cases, the Ruby runtime and MySQL client libraries will
link against a system-installed OpenSSL library and this option is not needed.
Use this option when non-default library paths are needed.</p></li>
<li><p><code>--with-sanitize[=address,cfi,integer,memory,thread,undefined]</code> -
Enable sanitizers for Clang / GCC. If no argument is given, try to enable
all sanitizers or fail if none are available. If a command-separated list of
specific sanitizers is given, configure will fail unless they all are available.
Note that the some sanitizers may incur a performance penalty, and the Address
Sanitizer may require a runtime library.
To see line numbers in backtraces, declare these environment variables
(adjust the llvm-symbolizer path as needed for your system):</p></li>
</ul>

<pre class="code sh"><code class="sh">  export ASAN_SYMBOLIZER_PATH=/usr/bin/llvm-symbolizer-3.4
  export ASAN_OPTIONS=symbolize=1
</code></pre>

<h3>Linux and other Unixes</h3>

<p>You may need to install a package such as <code>libmariadb-dev</code>, <code>libmysqlclient-dev</code>,
<code>mysql-devel</code>, or <code>default-libmysqlclient-dev</code>; refer to your distribution&#39;s package guide to
find the particular package. The most common issue we see is a user who has
the library file <code>libmysqlclient.so</code> but is missing the header file <code>mysql.h</code>
-- double check that you have the <em>-dev</em> packages installed.</p>

<h3>Mac OS X</h3>

<p>You may use Homebrew, MacPorts, or a native MySQL installer package. The most
common paths will be automatically searched. If you want to select a specific
MySQL directory, use the <code>--with-mysql-dir</code> or <code>--with-mysql-config</code> options above.</p>

<p>If you have not done so already, you will need to install the XCode select tools by running
<code>xcode-select --install</code>.</p>

<p>Later versions of MacOS no longer distribute a linkable OpenSSL library. It is
common to use Homebrew or MacPorts to install OpenSSL. Make sure that both the
Ruby runtime and MySQL client libraries are compiled with the same OpenSSL
family, 1.0 or 1.1 or 3.0, since only one can be loaded at runtime.</p>

<pre class="code sh"><code class="sh">$ brew install openssl@1.1 zstd
$ gem install mysql2 -- --with-openssl-dir=$(brew --prefix openssl@1.1)

or

$ sudo port install openssl11
</code></pre>

<p>Since most Ruby projects use Bundler, you can set build options in the Bundler
config rather than manually installing a global mysql2 gem. This example shows
how to set build arguments with <a href="https://bundler.io/man/bundle-config.1.html">Bundler config</a>:</p>

<pre class="code sh"><code class="sh">$ bundle config --local build.mysql2 -- --with-openssl-dir=$(brew --prefix openssl@1.1)
</code></pre>

<p>Another helpful trick is to use the same OpenSSL library that your Ruby was
built with, if it was built with an alternate OpenSSL path. This example finds
the argument <code>--with-openssl-dir=/some/path</code> from the Ruby build and adds that
to the <a href="https://bundler.io/man/bundle-config.1.html">Bundler config</a>:</p>

<pre class="code sh"><code class="sh">$ bundle config --local build.mysql2 -- $(ruby -r rbconfig -e &#39;puts RbConfig::CONFIG[&quot;configure_args&quot;]&#39; | xargs -n1 | grep with-openssl-dir)
</code></pre>

<p>Note the additional double dashes (<code>--</code>) these separate command-line arguments
that <code>gem</code> or <code>bundler</code> interpret from the additional arguments that are passed
to the mysql2 build process.</p>

<h3>Windows</h3>

<p>Make sure that you have Ruby and the DevKit compilers installed. We recommend
the <a href="http://rubyinstaller.org">Ruby Installer</a> distribution.</p>

<p>By default, the mysql2 gem will download and use MySQL Connector/C from
mysql.com. If you prefer to use a local installation of Connector/C, add the
flag <code>--with-mysql-dir=c:/mysql-connector-c-x-y-z</code> (<em>this path may use forward slashes</em>).</p>

<p>By default, the <code>libmysql.dll</code> library will be copied into the mysql2 gem
directory. To prevent this, add the flag <code>--no-vendor-libmysql</code>. The mysql2 gem
will search for <code>libmysql.dll</code> in the following paths, in order:</p>

<ul>
<li>Environment variable <code>RUBY_MYSQL2_LIBMYSQL_DLL=C:\path\to\libmysql.dll</code>
(<em>note the Windows-style backslashes</em>).</li>
<li>In the mysql2 gem&#39;s own directory <code>vendor/libmysql.dll</code></li>
<li>In the system&#39;s default library search paths.</li>
</ul>

<h2>Usage</h2>

<p>Connect to a database:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># this takes a hash of options, almost all of which map directly
</span><span class='comment'># to the familiar database.yml in rails
</span><span class='comment'># See http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/Mysql2Adapter.html
</span><span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_username'>username</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>Then query it:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE group=&#39;githubbers&#39;</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>Need to escape something first?</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_escaped'>escaped</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_escape'>escape</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gi&#39;thu\&quot;bbe\0r&#39;s</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE group=&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_escaped'>escaped</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>You can get a count of your results with <code>results.count</code>.</p>

<p>Finally, iterate over the results:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_results'>results</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'># conveniently, row is a hash
</span>  <span class='comment'># the keys are the fields, as you&#39;d expect
</span>  <span class='comment'># the values are pre-built ruby primitives mapped from their corresponding field types in MySQL
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_row'>row</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span>] <span class='comment'># row[&quot;id&quot;].is_a? Integer
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_row'>row</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dne</span><span class='tstring_end'>&quot;</span></span>]  <span class='comment'># non-existent hash entry is nil
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_row'>row</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dne</span><span class='tstring_end'>&quot;</span></span>]
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Or, you might just keep it simple:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE group=&#39;githubbers&#39;</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'># do something with row, it&#39;s ready to rock
</span><span class='kw'>end</span></code></pre>

<p>How about with symbolized keys?</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE group=&#39;githubbers&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'># do something with row, it&#39;s ready to rock
</span><span class='kw'>end</span></code></pre>

<p>You can get the headers, columns, and the field types in the order that they were returned
by the query like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>.<span class='id identifier rubyid_fields'>fields</span> <span class='comment'># &lt;= that&#39;s an array of field names, in order
</span><span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>.<span class='id identifier rubyid_field_types'>field_types</span> <span class='comment'># &lt;= that&#39;s an array of field types, in order
</span><span class='id identifier rubyid_results'>results</span>.<span class='id identifier rubyid_each'>each</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_array'>array</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'># Each row is an array, ordered the same as the query results
</span>  <span class='comment'># An otter&#39;s den is called a &quot;holt&quot; or &quot;couch&quot;
</span><span class='kw'>end</span></code></pre>

<p>Prepared statements are supported, as well. In a prepared statement, use a <code>?</code>
in place of each value and then execute the statement to retrieve a result set.
Pass your arguments to the execute method in the same number and order as the
question marks in the statement. Query options can be passed as keyword arguments
to the execute method.</p>

<p>Be sure to read about the known limitations of prepared statements at
<a href="https://dev.mysql.com/doc/refman/5.6/en/c-api-prepared-statement-problems.html">https://dev.mysql.com/doc/refman/5.6/en/c-api-prepared-statement-problems.html</a></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_statement'>statement</span> <span class='op'>=</span> <span class='ivar'>@client</span>.<span class='id identifier rubyid_prepare'>prepare</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE login_count = ?</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_result1'>result1</span> <span class='op'>=</span> <span class='id identifier rubyid_statement'>statement</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_result2'>result2</span> <span class='op'>=</span> <span class='id identifier rubyid_statement'>statement</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='int'>2</span>)

<span class='id identifier rubyid_statement'>statement</span> <span class='op'>=</span> <span class='ivar'>@client</span>.<span class='id identifier rubyid_prepare'>prepare</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE last_login &gt;= ? AND location LIKE ?</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_statement'>statement</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CA</span><span class='tstring_end'>&quot;</span></span>)

<span class='id identifier rubyid_statement'>statement</span> <span class='op'>=</span> <span class='ivar'>@client</span>.<span class='id identifier rubyid_prepare'>prepare</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE last_login &gt;= ? AND location LIKE ?</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_statement'>statement</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CA</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_array'>array</span>)</code></pre>

<p>Session Tracking information can be accessed with</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(
  <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>username:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>flags:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SESSION_TRACK</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>init_command:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SET @@SESSION.session_track_schema=ON</span><span class='tstring_end'>&quot;</span></span>
)
<span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO test VALUES (1)</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_session_track_type'>session_track_type</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span><span class='op'>::</span><span class='const'>SESSION_TRACK_SCHEMA</span>
<span class='id identifier rubyid_session_track_data'>session_track_data</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_session_track'>session_track</span>(<span class='id identifier rubyid_session_track_type'>session_track_type</span>)</code></pre>

<p>The types of session track types can be found at
<a href="https://dev.mysql.com/doc/refman/5.7/en/session-state-tracking.html">https://dev.mysql.com/doc/refman/5.7/en/session-state-tracking.html</a></p>

<h2>Connection options</h2>

<p>You may set the following connection options in Mysql2::Client.new(...):</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_password'>password</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_database'>database</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/path/to/mysql.sock</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='const'>REMEMBER_OPTIONS</span> <span class='op'>|</span> <span class='const'>LONG_PASSWORD</span> <span class='op'>|</span> <span class='const'>LONG_FLAG</span> <span class='op'>|</span> <span class='const'>TRANSACTIONS</span> <span class='op'>|</span> <span class='const'>PROTOCOL_41</span> <span class='op'>|</span> <span class='const'>SECURE_CONNECTION</span> <span class='op'>|</span> <span class='const'>MULTI_STATEMENTS</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>utf8mb4</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read_timeout'>read_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_write_timeout'>write_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_connect_attrs'>connect_attrs</span> <span class='op'>=</span> {<span class='symbeg'>:</span><span class='id identifier rubyid_program_name'>program_name</span> <span class='op'>=&gt;</span> <span class='gvar'>$PROGRAM_NAME</span><span class='comma'>,</span> <span class='op'>...</span>}<span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_reconnect'>reconnect</span> <span class='op'>=</span> <span class='kw'>true</span><span class='op'>/</span><span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_local_infile'>local_infile</span> <span class='op'>=</span> <span class='kw'>true</span><span class='op'>/</span><span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_secure_auth'>secure_auth</span> <span class='op'>=</span> <span class='kw'>true</span><span class='op'>/</span><span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_get_server_public_key'>get_server_public_key</span> <span class='op'>=</span> <span class='kw'>true</span><span class='op'>/</span><span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_default_file'>default_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/path/to/my.cfg</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_default_group'>default_group</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my.cfg section</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_default_auth'>default_auth</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>authentication_windows_client</span><span class='tstring_end'>&#39;</span></span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_init_command'>init_command</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_sql'>sql</span>
  )</code></pre>

<h3>Connecting to MySQL on localhost and elsewhere</h3>

<p>The underlying MySQL client library uses the <code>:host</code> parameter to determine the
type of connection to make, with special interpretation you should be aware of:</p>

<ul>
<li>An empty value or <code>&quot;localhost&quot;</code> will attempt a local connection:

<ul>
<li>On Unix, connect to the default local socket path. (To set a custom socket
path, use the <code>:socket</code> parameter).</li>
<li>On Windows, connect using a shared-memory connection, if enabled, or TCP.</li>
</ul></li>
<li>A value of <code>&quot;.&quot;</code> on Windows specifies a named-pipe connection.</li>
<li>An IPv4 or IPv6 address will result in a TCP connection.</li>
<li>Any other value will be looked up as a hostname for a TCP connection.</li>
</ul>

<h3>SSL/TLS options</h3>

<p>Setting any of the following options will enable an SSL/TLS connection, but
only if your MySQL client library and server have been compiled with SSL
support. MySQL client library defaults will be used for any parameters that are
left out or set to nil. Relative paths are allowed, and may be required by
managed hosting providers such as Heroku.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(
  <span class='comment'># ...options as above...,
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sslkey'>sslkey</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/path/to/client-key.pem</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sslcert'>sslcert</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/path/to/client-cert.pem</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sslca'>sslca</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/path/to/ca-cert.pem</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sslcapath'>sslcapath</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/path/to/cacerts</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sslcipher'>sslcipher</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DHE-RSA-AES256-SHA</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sslverify'>sslverify</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='comment'># Removed in MySQL 8.0
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_mode'>ssl_mode</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_disabled'>disabled</span> <span class='op'>/</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preferred'>preferred</span> <span class='op'>/</span> <span class='symbeg'>:</span><span class='id identifier rubyid_required'>required</span> <span class='op'>/</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verify_ca'>verify_ca</span> <span class='op'>/</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verify_identity'>verify_identity</span><span class='comma'>,</span>
  )</code></pre>

<p>For MySQL versions 5.7.11 and higher, use <code>:ssl_mode</code> to prefer or require an
SSL connection and certificate validation. For earlier versions of MySQL, use
the <code>:sslverify</code> boolean. For details on each of the <code>:ssl_mode</code> options, see
<a href="https://dev.mysql.com/doc/refman/8.0/en/connection-options.html#option_general_ssl-mode">https://dev.mysql.com/doc/refman/8.0/en/connection-options.html</a>.</p>

<p>The <code>:ssl_mode</code> option will also set the appropriate MariaDB connection flags:</p>

<table><thead>
<tr>
<th><code>:ssl_mode</code></th>
<th>MariaDB option value</th>
</tr>
</thead><tbody>
<tr>
<td><code>:disabled</code></td>
<td>MYSQL_OPT_SSL_ENFORCE = 0</td>
</tr>
<tr>
<td><code>:required</code></td>
<td>MYSQL_OPT_SSL_ENFORCE = 1</td>
</tr>
<tr>
<td><code>:verify_identity</code></td>
<td>MYSQL_OPT_SSL_VERIFY_SERVER_CERT = 1</td>
</tr>
</tbody></table>

<p>MariaDB does not support the <code>:preferred</code> or <code>:verify_ca</code> options. For more
information about SSL/TLS in MariaDB, see
<a href="https://mariadb.com/kb/en/securing-connections-for-client-and-server/">https://mariadb.com/kb/en/securing-connections-for-client-and-server/</a>
and <a href="https://mariadb.com/kb/en/mysql_optionsv/#tls-options">https://mariadb.com/kb/en/mysql_optionsv/#tls-options</a></p>

<h3>Secure auth</h3>

<p>Starting with MySQL 5.6.5, secure_auth is enabled by default on servers (it was disabled by default prior to this).
When secure_auth is enabled, the server will refuse a connection if the account password is stored in old pre-MySQL 4.1 format.
The MySQL 5.6.5 client library may also refuse to attempt a connection if provided an older format password.
To bypass this restriction in the client, pass the option <code>:secure_auth =&gt; false</code> to Mysql2::Client.new().</p>

<h3>Flags option parsing</h3>

<p>The <code>:flags</code> parameter accepts an integer, a string, or an array. The integer
form allows the client to assemble flags from constants defined under
<a href="Mysql2/Client.html" title="Mysql2::Client (class)"><code>::Mysql2::Client</code></a> such as <code>Mysql2::Client::FOUND_ROWS</code>. Use a bitwise <code>|</code> (OR)
to specify several flags.</p>

<p>The string form will be split on whitespace and parsed as with the array form:
Plain flags are added to the default flags, while flags prefixed with <code>-</code>
(minus) are removed from the default flags.</p>

<h3>Using Active Record&#39;s database.yml</h3>

<p>Active Record typically reads its configuration from a file named <code>database.yml</code> or an environment variable <code>DATABASE_URL</code>.
Use the value <code>mysql2</code> as the adapter name. For example:</p>

<pre class="code yaml"><code class="yaml">development:
  adapter: mysql2
  encoding: utf8mb4
  database: my_db_name
  username: root
  password: my_password
  host: 127.0.0.1
  port: 3306
  flags:
    - -COMPRESS
    - FOUND_ROWS
    - MULTI_STATEMENTS
  secure_auth: false
</code></pre>

<p>In this example, the compression flag is negated with <code>-COMPRESS</code>.</p>

<h3>Using Active Record&#39;s DATABASE_URL</h3>

<p>Active Record typically reads its configuration from a file named <code>database.yml</code> or an environment variable <code>DATABASE_URL</code>.
Use the value <code>mysql2</code> as the protocol name. For example:</p>

<pre class="code sh"><code class="sh">DATABASE_URL=mysql2://sql_user:sql_pass@sql_host_name:port/sql_db_name?option1=value1&amp;option2=value2
</code></pre>

<h3>Reading a MySQL config file</h3>

<p>You may read configuration options from a MySQL configuration file by passing
the <code>:default_file</code> and <code>:default_group</code> parameters. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_default_file'>default_file</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/user/.my.cnf</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_default_group'>default_group</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>client</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<h3>Initial command on connect and reconnect</h3>

<p>If you specify the <code>:init_command</code> option, the SQL string you provide will be executed after the connection is established.
If <code>:reconnect</code> is set to <code>true</code>, init_command will also be executed after a successful reconnect.
It is useful if you want to provide session options which survive reconnection.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_init_command'>init_command</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SET @@SESSION.sql_mode = &#39;STRICT_ALL_TABLES&#39;</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<h3>Multiple result sets</h3>

<p>You can also retrieve multiple result sets. For this to work you need to
connect with flags <code>Mysql2::Client::MULTI_STATEMENTS</code>. Multiple result sets can
be used with stored procedures that return more than one result set, and for
bundling several SQL statements into a single call to <code>client.query</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_username'>username</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span> <span class='op'>=&gt;</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span><span class='op'>::</span><span class='const'>MULTI_STATEMENTS</span>)
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CALL sp_customer_list( 25, 10 )</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># result now contains the first result set
</span><span class='kw'>while</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_next_result'>next_result</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_store_result'>store_result</span>
  <span class='comment'># result now contains the next result set
</span><span class='kw'>end</span></code></pre>

<p>Repeated calls to <code>client.next_result</code> will return true, false, or raise an
exception if the respective query erred. When <code>client.next_result</code> returns true,
call <code>client.store_result</code> to retrieve a result object. Exceptions are not
raised until <code>client.next_result</code> is called to find the status of the respective
query. Subsequent queries are not executed if an earlier query raised an
exception. Subsequent calls to <code>client.next_result</code> will return false.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SELECT 1; SELECT 2; SELECT A; SELECT 3</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_first'>first</span>

<span class='kw'>while</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_next_result'>next_result</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_store_result'>store_result</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></code></pre>

<p>Yields:</p>

<pre class="code ruby"><code class="ruby">{<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>1</span>}
{<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>2</span>}
<span class='id identifier rubyid_next_result'>next_result</span><span class='op'>:</span> <span class='const'>Unknown</span> <span class='id identifier rubyid_column'>column</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>A</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>in</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>field list</span><span class='tstring_end'>&#39;</span></span> (<span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Error.html" title="Mysql2::Error (class)">Error</a></span>)</code></pre>

<h2>Cascading config</h2>

<p>The default config hash is at:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_default_query_options'><a href="Mysql2/Client.html#default_query_options-class_method" title="Mysql2::Client.default_query_options (method)">default_query_options</a></span></code></pre>

<p>which defaults to:</p>

<pre class="code ruby"><code class="ruby">{<span class='symbeg'>:</span><span class='id identifier rubyid_async'>async</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>}</code></pre>

<p>that can be used as so:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># these are the defaults all Mysql2::Client instances inherit
</span><span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_default_query_options'><a href="Mysql2/Client.html#default_query_options-class_method" title="Mysql2::Client.default_query_options (method)">default_query_options</a></span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_array'>array</span>)</code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># this will change the defaults for all future results returned by the #query method _for this connection only_
</span><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
<span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_query_options'>query_options</span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># this will set the options for the Mysql2::Result instance returned from the #query method
</span><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
<span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_query'>query</span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># this will set the options for the Mysql2::Result instance returned from the #execute method
</span><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
<span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_prepare'>prepare</span>(<span class='id identifier rubyid_sql'>sql</span>)
<span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='id identifier rubyid_arg1'>arg1</span><span class='comma'>,</span> <span class='id identifier rubyid_args2'>args2</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_symbolize_keys'>symbolize_keys</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<h2>Result types</h2>

<h3>Array of Arrays</h3>

<p>Pass the <code>:as =&gt; :array</code> option to any of the above methods of configuration</p>

<h3>Array of Hashes</h3>

<p>The default result type is set to <code>:hash</code>, but you can override a previous setting to something else with <code>:as =&gt; :hash</code></p>

<h3>Timezones</h3>

<p>Mysql2 now supports two timezone options:</p>

<pre class="code ruby"><code class="ruby"><span class='symbeg'>:</span><span class='id identifier rubyid_database_timezone'>database_timezone</span> <span class='comment'># this is the timezone Mysql2 will assume fields are already stored as, and will use this when creating the initial Time objects in ruby
</span><span class='symbeg'>:</span><span class='id identifier rubyid_application_timezone'>application_timezone</span> <span class='comment'># this is the timezone Mysql2 will convert to before finally handing back to the caller</span></code></pre>

<p>In other words, if <code>:database_timezone</code> is set to <code>:utc</code> - Mysql2 will create the Time objects using <code>Time.utc(...)</code> from the raw value libmysql hands over initially.
Then, if <code>:application_timezone</code> is set to say - <code>:local</code> - Mysql2 will then convert the just-created UTC Time object to local time.</p>

<p>Both options only allow two values - <code>:local</code> or <code>:utc</code> - with the exception that <code>:application_timezone</code> can be [and defaults to] nil</p>

<h3>Casting &quot;boolean&quot; columns</h3>

<p>You can now tell Mysql2 to cast <code>tinyint(1)</code> fields to boolean values in Ruby with the <code>:cast_booleans</code> option.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM table_with_boolean_field</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cast_booleans'>cast_booleans</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<p>Keep in mind that this works only with fields and not with computed values, e.g. this result will contain <code>1</code>, not <code>true</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT true</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cast_booleans'>cast_booleans</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<p>CAST function wouldn&#39;t help here as there&#39;s no way to cast to TINYINT(1). Apparently the only way to solve this is to use a stored procedure with return type set to TINYINT(1).</p>

<h3>Skipping casting</h3>

<p>Mysql2 casting is fast, but not as fast as not casting data.  In rare cases where typecasting is not needed, it will be faster to disable it by providing :cast =&gt; false. (Note that :cast =&gt; false overrides :cast_booleans =&gt; true.)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/Client.html" title="Mysql2::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM table</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cast'>cast</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>)</code></pre>

<p>Here are the results from the <code>query_without_mysql_casting.rb</code> script in the benchmarks folder:</p>

<pre class="code sh"><code class="sh">                           user     system      total        real
Mysql2 (cast: true)    0.340000   0.000000   0.340000 (  0.405018)
Mysql2 (cast: false)   0.160000   0.010000   0.170000 (  0.209937)
Mysql                  0.080000   0.000000   0.080000 (  0.129355)
do_mysql               0.520000   0.010000   0.530000 (  0.574619)
</code></pre>

<p>Although Mysql2 performs reasonably well at retrieving uncasted data, it (currently) is not as fast as the Mysql gem.  In spite of this small disadvantage, Mysql2 still sports a friendlier interface and doesn&#39;t block the entire ruby process when querying.</p>

<h3>Async</h3>

<p>NOTE: Not supported on Windows.</p>

<p><a href="Mysql2/Client.html" title="Mysql2::Client (class)"><code>::Mysql2::Client</code></a> takes advantage of the MySQL C API&#39;s (undocumented) non-blocking function mysql_send_query for <em>all</em> queries.
But, in order to take full advantage of it in your Ruby code, you can do:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT sleep(5)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async'>async</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<p>Which will return nil immediately. At this point you&#39;ll probably want to use some socket monitoring mechanism
like EventMachine or even IO.select. Once the socket becomes readable, you can do:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># result will be a Mysql2::Result instance
</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_async_result'>async_result</span></code></pre>

<p>NOTE: Because of the way MySQL&#39;s query API works, this method will block until the result is ready.
So if you really need things to stay async, it&#39;s best to just monitor the socket with something like EventMachine.
If you need multiple query concurrency take a look at using a connection pool.</p>

<h3>Row Caching</h3>

<p>By default, Mysql2 will cache rows that have been created in Ruby (since this happens lazily).
This is especially helpful since it saves the cost of creating the row in Ruby if you were to iterate over the collection again.</p>

<p>If you only plan on using each row once, then it&#39;s much more efficient to disable this behavior by setting the <code>:cache_rows</code> option to false.
This would be helpful if you wanted to iterate over the results in a streaming manner. Meaning the GC would cleanup rows you don&#39;t need anymore as you&#39;re iterating over the result set.</p>

<h3>Streaming</h3>

<p><a href="Mysql2/Client.html" title="Mysql2::Client (class)"><code>::Mysql2::Client</code></a> can optionally only fetch rows from the server on demand by setting <code>:stream =&gt; true</code>. This is handy when handling very large result sets which might not fit in memory on the client.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_query'>query</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM really_big_Table</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stream'>stream</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)</code></pre>

<p>There are a few things that need to be kept in mind while using streaming:</p>

<ul>
<li><code>:cache_rows</code> is ignored currently. (if you want to use <code>:cache_rows</code> you probably don&#39;t want to be using <code>:stream</code>)</li>
<li>You must fetch all rows in the result set of your query before you can make new queries. (i.e. with <a href="Mysql2/Result.html#each-instance_method" title="Mysql2::Result#each (method)">Mysql2::Result#each</a>)</li>
</ul>

<p>Read more about the consequences of using <code>mysql_use_result</code> (what streaming is implemented with) here: <a href="http://dev.mysql.com/doc/refman/5.0/en/mysql-use-result.html">http://dev.mysql.com/doc/refman/5.0/en/mysql-use-result.html</a>.</p>

<h3>Lazy Everything</h3>

<p>Well... almost ;)</p>

<p>Field name strings/symbols are shared across all the rows so only one object is ever created to represent the field name for an entire dataset.</p>

<p>Rows themselves are lazily created in ruby-land when an attempt to yield it is made via #each.
For example, if you were to yield 4 rows from a 100 row dataset, only 4 hashes will be created. The rest will sit and wait in C-land until you want them (or when the GC goes to cleanup your <a href="Mysql2/Result.html" title="Mysql2::Result (class)"><code>::Mysql2::Result</code></a> instance).
Now say you were to iterate over that same collection again, this time yielding 15 rows - the 4 previous rows that had already been turned into ruby hashes would be pulled from an internal cache, then 11 more would be created and stored in that cache.
Once the entire dataset has been converted into ruby objects, Mysql2::Result will free the Mysql C result object as it&#39;s no longer needed.</p>

<p>This caching behavior can be disabled by setting the <code>:cache_rows</code> option to false.</p>

<p>As for field values themselves, I&#39;m workin on it - but expect that soon.</p>

<h2>Compatibility</h2>

<p>This gem is tested with the following Ruby versions on Linux and Mac OS X:</p>

<ul>
<li>Ruby MRI 2.0 through 2.7 (all versions to date)</li>
<li>Ruby MRI 3.0, 3.1, 3.2 (all versions to date)</li>
<li>Rubinius 2.x and 3.x do work but may fail under some workloads</li>
</ul>

<p>This gem is tested with the following MySQL and MariaDB versions:</p>

<ul>
<li>MySQL 5.5, 5.6, 5.7, 8.0</li>
<li>MySQL Connector/C 6.0, 6.1, 8.0 (primarily on Windows)</li>
<li>MariaDB 5.5, 10.x, with a focus on 10.6 LTS and 10.11 LTS</li>
<li>MariaDB Connector/C 2.x, 3.x</li>
</ul>

<h3>Ruby on Rails / Active Record</h3>

<ul>
<li>mysql2 0.5.x works with Rails / Active Record 4.2.11, 5.0.7, 5.1.6, and higher.</li>
<li>mysql2 0.4.x works with Rails / Active Record 4.2.5 - 5.0 and higher.</li>
<li>mysql2 0.3.x works with Rails / Active Record 3.1, 3.2, 4.x, 5.0.</li>
<li>mysql2 0.2.x works with Rails / Active Record 2.3 - 3.0.</li>
</ul>

<h3>Asynchronous Active Record</h3>

<p>Please see the <a href="https://github.com/igrigorik/em-synchrony">em-synchrony</a> project for details about using EventMachine with mysql2 and Rails.</p>

<h3>Sequel</h3>

<p>Sequel includes a mysql2 adapter in all releases since 3.15 (2010-09-01).
Use the prefix &quot;mysql2://&quot; in your connection specification.</p>

<h3>EventMachine</h3>

<p>The mysql2 EventMachine deferrable api allows you to make async queries using EventMachine,
while specifying callbacks for success for failure. Here&#39;s a simple example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysql2/em</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>EM</span>.<span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_client1'>client1</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/EM.html" title="Mysql2::EM (module)">EM</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/EM/Client.html" title="Mysql2::EM::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
  <span class='id identifier rubyid_defer1'>defer1</span> <span class='op'>=</span> <span class='id identifier rubyid_client1'>client1</span>.<span class='id identifier rubyid_query'>query</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT sleep(3) as first_query</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_defer1'>defer1</span>.<span class='id identifier rubyid_callback'>callback</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Result: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_client2'>client2</span> <span class='op'>=</span> <span class='const'><a href="Mysql2.html" title="Mysql2 (module)">Mysql2</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/EM.html" title="Mysql2::EM (module)">EM</a></span><span class='op'>::</span><span class='const'><a href="Mysql2/EM/Client.html" title="Mysql2::EM::Client (class)">Client</a></span>.<span class='id identifier rubyid_new'><a href="Mysql2/Client.html#new-class_method" title="Mysql2::Client.new (method)">new</a></span>
  <span class='id identifier rubyid_defer2'>defer2</span> <span class='op'>=</span> <span class='id identifier rubyid_client2'>client2</span>.<span class='id identifier rubyid_query'>query</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT sleep(1) second_query</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_defer2'>defer2</span>.<span class='id identifier rubyid_callback'>callback</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Result: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h2>Benchmarks and Comparison</h2>

<p>The mysql2 gem converts MySQL field types to Ruby data types in C code, providing a serious speed benefit.</p>

<p>The do_mysql gem also converts MySQL fields types, but has a considerably more complex API and is still ~2x slower than mysql2.</p>

<p>The mysql gem returns only nil or string data types, leaving you to convert field values to Ruby types in Ruby-land, which is much slower than mysql2&#39;s C code.</p>

<p>For a comparative benchmark, the script below performs a basic &quot;SELECT * FROM&quot;
query on a table with 30k rows and fields of nearly every Ruby-representable
data type, then iterating over every row using an #each like method yielding a
block:</p>

<pre class="code sh"><code class="sh">         user       system     total       real
Mysql2   0.750000   0.180000   0.930000   (1.821655)
do_mysql 1.650000   0.200000   1.850000   (2.811357)
Mysql    7.500000   0.210000   7.710000   (8.065871)
</code></pre>

<p>These results are from the <code>query_with_mysql_casting.rb</code> script in the benchmarks folder.</p>

<h2>Development</h2>

<p>Use &#39;bundle install&#39; to install the necessary development and testing gems:</p>

<pre class="code sh"><code class="sh">bundle install
rake
</code></pre>

<p>The tests require the &quot;test&quot; database to exist, and expect to connect
both as root and the running user, both with a blank password:</p>

<pre class="code sql"><code class="sql">CREATE DATABASE test;
CREATE USER &#39;&lt;user&gt;&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;&#39;;
GRANT ALL PRIVILEGES ON test.* TO &#39;&lt;user&gt;&#39;@&#39;localhost&#39;;
</code></pre>

<p>You can change these defaults in the spec/configuration.yml which is generated
automatically when you run rake (or explicitly <code>rake spec/configuration.yml</code>).</p>

<p>For a normal installation on a Mac, you most likely do not need to do anything,
though.</p>

<h2>Special Thanks</h2>

<ul>
<li>Eric Wong - for the contribution (and the informative explanations) of some thread-safety, non-blocking I/O and cleanup patches. You rock dude</li>
<li><a href="http://github.com/yury">Yury Korolev</a> - for TONS of help testing the Active Record adapter</li>
<li><a href="http://github.com/tenderlove">Aaron Patterson</a> - tons of contributions, suggestions and general badassness</li>
<li><a href="http://github.com/mperham">Mike Perham</a> - Async Active Record adapter (uses Fibers and EventMachine)</li>
<li><a href="http://github.com/sodabrew">Aaron Stone</a> - additional client settings, local files, microsecond time, maintenance support</li>
<li><a href="https://github.com/nyaxt">Kouhei Ueno</a> - for the original work on Prepared Statements way back in 2012</li>
<li><a href="http://github.com/johncant">John Cant</a> - polishing and updating Prepared Statements support</li>
<li><a href="http://github.com/justincase">Justin Case</a> - polishing and updating Prepared Statements support and getting it merged</li>
<li><a href="http://github.com/tamird">Tamir Duberstein</a> - for help with timeouts and all around updates and cleanups</li>
<li><a href="http://github.com/junaruga">Jun Aruga</a> - for migrating CI tests to GitHub Actions and other improvements</li>
</ul>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>