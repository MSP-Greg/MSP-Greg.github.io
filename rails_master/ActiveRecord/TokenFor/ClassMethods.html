<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::TokenFor::ClassMethods &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::TokenFor::ClassMethods",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails main</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../TokenFor.html" title="ActiveRecord::TokenFor (module)">TokenFor</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::TokenFor::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/token_for.rb#L56'>activerecord/lib/active_record/token_for.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#generates_token_for-instance_method" title="#generates_token_for (instance method)">#<strong>generates_token_for</strong>(purpose, expires_in: nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines the behavior of tokens generated for a specific <code>purpose</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#find_by_token_for-instance_method" title="#find_by_token_for (instance method)">#<strong>find_by_token_for</strong>(purpose, token)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#find_by_token_for!-instance_method" title="#find_by_token_for! (instance method)">#<strong>find_by_token_for!</strong>(purpose, token)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="find_by_token_for-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>find_by_token_for</strong>(purpose, token)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/token_for.rb#L106-L108'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='106' data-end='108'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/token_for.rb', line 106</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_by_token_for'>find_by_token_for</span>(<span class='id identifier rubyid_purpose'>purpose</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_find_by_token_for'>find_by_token_for</span>(<span class='id identifier rubyid_purpose'>purpose</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_by_token_for!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>find_by_token_for!</strong>(purpose, token)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/token_for.rb#L110-L112'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='110' data-end='112'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/token_for.rb', line 110</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_by_token_for!'>find_by_token_for!</span>(<span class='id identifier rubyid_purpose'>purpose</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_find_by_token_for!'>find_by_token_for!</span>(<span class='id identifier rubyid_purpose'>purpose</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generates_token_for-instance_method">
  <h3 class='signature '>
    #<strong>generates_token_for</strong>(purpose, expires_in: nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines the behavior of tokens generated for a specific <code>purpose</code>. A token can be generated by calling <a href="../TokenFor.html#generate_token_for-instance_method" title="ActiveRecord::TokenFor#generate_token_for (method)">ActiveRecord::TokenFor#generate_token_for</a> on a record. Later, that record can be fetched by calling <a href="#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for (method)">#find_by_token_for</a> (or <a href="#find_by_token_for!-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for! (method)">#find_by_token_for!</a>) with the same purpose and token.</p>

<p>Tokens are signed so that they are tamper-proof. Thus they can be exposed to outside world as, for example, password reset tokens.</p>

<p>By default, tokens do not expire. They can be configured to expire by specifying a duration via the <code>expires_in</code> option. The duration becomes part of the token’s signature, so changing the value of <code>expires_in</code> will automatically invalidate previously generated tokens.</p>

<p>A block may also be specified. When generating a token with <a href="../TokenFor.html#generate_token_for-instance_method" title="ActiveRecord::TokenFor#generate_token_for (method)">ActiveRecord::TokenFor#generate_token_for</a>, the block will be evaluated in the context of the record, and its return value will be embedded in the token as JSON. Later, when fetching the record with <a href="#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for (method)">#find_by_token_for</a>, the block will be evaluated again in the context of the fetched record. If the two JSON values do not match, the token will be treated as invalid. Note that the value returned by the block <strong>should not contain sensitive information</strong> because it will be embedded in the token as <strong>human-readable plaintext JSON</strong>.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_secure_password'>has_secure_password</span>

  <span class='id identifier rubyid_generates_token_for'>generates_token_for</span> <span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='int'>15</span>.<span class='id identifier rubyid_minutes'>minutes</span> <span class='kw'>do</span>
    <span class='comment'># Last 10 characters of password salt, which changes when password is updated:
</span>    <span class='id identifier rubyid_password_salt'>password_salt</span><span class='op'>&amp;.</span><span class='id identifier rubyid_last'>last</span>(<span class='int'>10</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>

<span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_generate_token_for'><a href="../TokenFor.html#generate_token_for-instance_method" title="ActiveRecord::TokenFor#generate_token_for (method)">generate_token_for</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span>)
<span class='const'>User</span>.<span class='id identifier rubyid_find_by_token_for'><a href="#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for (method)">find_by_token_for</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>) <span class='comment'># =&gt; user
</span><span class='comment'># 16 minutes later...
</span><span class='const'>User</span>.<span class='id identifier rubyid_find_by_token_for'><a href="#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for (method)">find_by_token_for</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>) <span class='comment'># =&gt; nil
</span>
<span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_generate_token_for'><a href="../TokenFor.html#generate_token_for-instance_method" title="ActiveRecord::TokenFor#generate_token_for (method)">generate_token_for</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span>)
<span class='const'>User</span>.<span class='id identifier rubyid_find_by_token_for'><a href="#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for (method)">find_by_token_for</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>) <span class='comment'># =&gt; user
</span><span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new password</span><span class='tstring_end'>&quot;</span></span>)
<span class='const'>User</span>.<span class='id identifier rubyid_find_by_token_for'><a href="#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::ClassMethods#find_by_token_for (method)">find_by_token_for</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>) <span class='comment'># =&gt; nil</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/token_for.rb#L102-L104'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='102' data-end='104'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/token_for.rb', line 102</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_generates_token_for'>generates_token_for</span>(<span class='id identifier rubyid_purpose'>purpose</span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_token_definitions'>token_definitions</span> <span class='op'>=</span> <span class='id identifier rubyid_token_definitions'>token_definitions</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_purpose'>purpose</span> <span class='op'>=&gt;</span> <span class='const'><a href="TokenDefinition.html" title="ActiveRecord::TokenFor::TokenDefinition (class)">TokenDefinition</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_purpose'>purpose</span><span class='comma'>,</span> <span class='id identifier rubyid_expires_in'>expires_in</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>