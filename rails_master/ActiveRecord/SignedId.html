<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::SignedId &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::SignedId",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>SignedId&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::SignedId</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="SignedId/ClassMethods.html" title="ActiveRecord::SignedId::ClassMethods (module)"><code>ClassMethods</code></a>,
        <a class='nodoc' href="SignedId/RelationMethods.html" title="ActiveRecord::SignedId::RelationMethods (module)"><code>RelationMethods</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActiveRecord::Base (class)"><code>Base</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/signed_id.rb#L5'>activerecord/lib/active_record/signed_id.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#prepend_features-instance_method" title="ActiveSupport::Concern#prepend_features (method)">prepend_features</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#signed_id-instance_method" title="#signed_id (instance method)">#<strong>signed_id</strong>(expires_in: nil, expires_at: nil, purpose: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a signed id that’s generated using a preconfigured <a href="../ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a> instance.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/signed_id.rb#L8-L30'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 8</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__signed_id_verifier'>_signed_id_verifier</span><span class='comma'>,</span> <span class='label'>instance_accessor:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>instance_predicate:</span> <span class='kw'>false</span>

  <span class='comment'>##
</span>  <span class='comment'># :singleton-method:
</span>  <span class='comment'># Set the secret used for the signed id verifier instance when using Active Record outside of \Rails.
</span>  <span class='comment'># Within \Rails, this is automatically set using the \Rails application key generator.
</span>  <span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_signed_id_verifier_secret'>signed_id_verifier_secret</span><span class='comma'>,</span> <span class='label'>instance_writer:</span> <span class='kw'>false</span>
  <span class='kw'>module</span> <span class='const'>DeprecateSignedIdVerifierSecret</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_signed_id_verifier_secret='>signed_id_verifier_secret=</span>(<span class='id identifier rubyid_secret'>secret</span>)
      <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span>.<span class='id identifier rubyid_deprecator'><a href="../ActiveRecord.html#deprecator-class_method" title="ActiveRecord.deprecator (method)">deprecator</a></span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='heredoc_beg'>&lt;&lt;~MSG</span>)
<span class='ignored_sp'>        </span><span class='tstring_content'>ActiveRecord::Base.signed_id_verifier_secret is deprecated and will be removed in Rails 8.2.
</span><span class='tstring_content'>
</span><span class='ignored_sp'>        </span><span class='tstring_content'>If the secret is model-specific, set Model.signed_id_verifier instead.
</span><span class='tstring_content'>
</span><span class='ignored_sp'>        </span><span class='tstring_content'>Otherwise, configure Rails.application.message_verifiers (or ActiveRecord.message_verifiers) with the secret.
</span><span class='heredoc_end'>      MSG
</span>
      <span class='kw'>super</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_singleton_class'>singleton_class</span>.<span class='id identifier rubyid_prepend'>prepend</span> <span class='const'>DeprecateSignedIdVerifierSecret</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="signed_id-instance_method">
  <h3 class='signature  first'>
    #<strong>signed_id</strong>(expires_in: nil, expires_at: nil, purpose: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a signed id that’s generated using a preconfigured <a href="../ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a> instance.</p>

<p>This signed id is tamper proof, so it’s safe to send in an email or otherwise share with the outside world. However, as with any message signed with a <a href="../ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a>, <code>the signed id is not encrypted</code>. It’s just encoded and protected against tampering.</p>

<p>This means that the ID can be decoded by anyone; however, if tampered with (so to point to a different ID), the cryptographic signature will no longer match, and the signed id will be considered invalid and return nil when passed to <code>find_signed</code> (or raise with <code>find_signed!</code>).</p>

<p>It can furthermore be set to expire (the default is not to expire), and scoped down with a specific purpose. If the expiration date has been exceeded before <code>find_signed</code> is called, the id won’t find the designated record. If a purpose is set, this too must match.</p>

<p>If you accidentally let a signed id out in the wild that you wish to retract sooner than its expiration date (or maybe you forgot to set an expiration date while meaning to!), you can use the purpose to essentially version the signed_id, like so:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_signed_id'>signed_id</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_v2'>v2</span></code></pre>

<p>And you then change your <code>find_signed</code> calls to require this new purpose. Any old signed ids that were not created with the purpose will no longer find the record.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/signed_id.rb#L160-L164'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='160' data-end='164'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 160</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_signed_id'>signed_id</span>(<span class='label'>expires_in:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>expires_at:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot get a signed_id for a new record</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_new_record?'>new_record?</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_signed_id_verifier'>signed_id_verifier</span>.<span class='id identifier rubyid_generate'>generate</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='id identifier rubyid_expires_in'>expires_in</span><span class='comma'>,</span> <span class='label'>expires_at:</span> <span class='id identifier rubyid_expires_at'>expires_at</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_combine_signed_id_purposes'>combine_signed_id_purposes</span>(<span class='id identifier rubyid_purpose'>purpose</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>