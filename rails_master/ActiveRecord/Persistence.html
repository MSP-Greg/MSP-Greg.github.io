<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Persistence &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Persistence",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Persistence&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::Persistence</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Persistence/ClassMethods.html" title="ActiveRecord::Persistence::ClassMethods (module)"><code>ClassMethods</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActiveRecord::Base (class)"><code>Base</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L7'>activerecord/lib/active_record/persistence.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#prepend_features-instance_method" title="ActiveSupport::Concern#prepend_features (method)">prepend_features</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#destroyed%3F-instance_method" title="#destroyed? (instance method)">#<strong>destroyed?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if this object has been destroyed, otherwise returns false.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#new_record%3F-instance_method" title="#new_record? (instance method)">#<strong>new_record?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if this object hasn’t been saved yet – that is, a record for the object doesn’t exist in the database yet; otherwise, returns false.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#persisted%3F-instance_method" title="#persisted? (instance method)">#<strong>persisted?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if the record is persisted, i.e.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#previously_new_record%3F-instance_method" title="#previously_new_record? (instance method)">#<strong>previously_new_record?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if this object was just created – that is, prior to the last update or delete, the object didn’t exist in the database and new_record? would have returned true.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#previously_persisted%3F-instance_method" title="#previously_persisted? (instance method)">#<strong>previously_persisted?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if this object was previously persisted but now it has been deleted.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#becomes-instance_method" title="#becomes (instance method)">#<strong>becomes</strong>(klass)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an instance of the specified <code>klass</code> with the attributes of the current record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#becomes!-instance_method" title="#becomes! (instance method)">#<strong>becomes!</strong>(klass)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wrapper around <a href="#becomes-instance_method" title="ActiveRecord::Persistence#becomes (method)">#becomes</a> that also changes the instance’s STI column value.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#decrement-instance_method" title="#decrement (instance method)">#<strong>decrement</strong>(attribute, by = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Initializes <code>attribute</code> to zero if <code>nil</code> and subtracts the value passed as <code>by</code> (default is 1).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#decrement!-instance_method" title="#decrement! (instance method)">#<strong>decrement!</strong>(attribute, by = 1, touch: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wrapper around <a href="#decrement-instance_method" title="ActiveRecord::Persistence#decrement (method)">#decrement</a> that writes the update to the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can’t be persisted).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can’t be persisted).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy!-instance_method" title="#destroy! (instance method)">#<strong>destroy!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can’t be persisted).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#increment-instance_method" title="#increment (instance method)">#<strong>increment</strong>(attribute, by = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Initializes <code>attribute</code> to zero if <code>nil</code> and adds the value passed as <code>by</code> (default is 1).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#increment!-instance_method" title="#increment! (instance method)">#<strong>increment!</strong>(attribute, by = 1, touch: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wrapper around <a href="#increment-instance_method" title="ActiveRecord::Persistence#increment (method)">#increment</a> that writes the update to the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reload-instance_method" title="#reload (instance method)">#<strong>reload</strong>(options = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reloads the record from the database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#save-instance_method" title="#save (instance method)">#<strong>save</strong>(**options)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Saves the model.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#save!-instance_method" title="#save! (instance method)">#<strong>save!</strong>(**options)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Saves the model.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#toggle-instance_method" title="#toggle (instance method)">#<strong>toggle</strong>(attribute)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Assigns to <code>attribute</code> the boolean opposite of <code>attribute?</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#toggle!-instance_method" title="#toggle! (instance method)">#<strong>toggle!</strong>(attribute)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wrapper around <a href="#toggle-instance_method" title="ActiveRecord::Persistence#toggle (method)">#toggle</a> that saves the record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#touch-instance_method" title="#touch (instance method)">#<strong>touch</strong>(*names, time: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Saves the record with the updated_at/on attributes set to the current time or the time specified.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the attributes of the model from the passed-in hash and saves the record, all wrapped in a transaction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update!-instance_method" title="#update! (instance method)">#<strong>update!</strong>(attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates its receiver just like <a href="#update-instance_method" title="ActiveRecord::Persistence#update (method)">#update</a> but calls <a href="#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">#save!</a> instead of <a href="#save-instance_method" title="ActiveRecord::Persistence#save (method)">#save</a>, so an exception is raised if the record is invalid and saving will fail.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_attribute-instance_method" title="#update_attribute (instance method)">#<strong>update_attribute</strong>(name, value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates a single attribute and saves the record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_attribute!-instance_method" title="#update_attribute! (instance method)">#<strong>update_attribute!</strong>(name, value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates a single attribute and saves the record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_column-instance_method" title="#update_column (instance method)">#<strong>update_column</strong>(name, value, touch: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Equivalent to <code>update_columns(name =&gt; value)</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_columns-instance_method" title="#update_columns (instance method)">#<strong>update_columns</strong>(attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the attributes directly in the database issuing an UPDATE SQL statement and sets them in the receiver:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_create_record-instance_method" title="#_create_record (instance method)">#<strong>_create_record</strong>(attribute_names = self.attribute_names) {|_self| ... } </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a record with values matching those of the instance attributes and returns its id.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_delete_row-instance_method" title="#_delete_row (instance method)">#<strong>_delete_row</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_find_record-instance_method" title="#_find_record (instance method)">#<strong>_find_record</strong>(options)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_in_memory_query_constraints_hash-instance_method" title="#_in_memory_query_constraints_hash (instance method)">#<strong>_in_memory_query_constraints_hash</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_query_constraints_hash-instance_method" title="#_query_constraints_hash (instance method)">#<strong>_query_constraints_hash</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_raise_readonly_record_error-instance_method" title="#_raise_readonly_record_error (instance method)">#<strong>_raise_readonly_record_error</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_raise_record_not_destroyed-instance_method" title="#_raise_record_not_destroyed (instance method)">#<strong>_raise_record_not_destroyed</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_raise_record_not_touched_error-instance_method" title="#_raise_record_not_touched_error (instance method)">#<strong>_raise_record_not_touched_error</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_touch_row-instance_method" title="#_touch_row (instance method)">#<strong>_touch_row</strong>(attribute_names, time)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_update_record-instance_method" title="#_update_record (instance method)">#<strong>_update_record</strong>(attribute_names = self.attribute_names) {|_self| ... } </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the associated record with values matching those of the instance attributes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_update_row-instance_method" title="#_update_row (instance method)">#<strong>_update_row</strong>(attribute_names, attempted_action = &quot;update&quot;)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#apply_scoping%3F-instance_method" title="#apply_scoping? (instance method)">#<strong>apply_scoping?</strong>(options)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#create_or_update-instance_method" title="#create_or_update (instance method)">#<strong>create_or_update</strong>(&amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#destroy_associations-instance_method" title="#destroy_associations (instance method)">#<strong>destroy_associations</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>A hook to be overridden by association modules.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#destroy_row-instance_method" title="#destroy_row (instance method)">#<strong>destroy_row</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#init_internals-instance_method" title="#init_internals (instance method)">#<strong>init_internals</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#strict_loaded_associations-instance_method" title="#strict_loaded_associations (instance method)">#<strong>strict_loaded_associations</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_readonly_attribute-instance_method" title="#verify_readonly_attribute (instance method)">#<strong>verify_readonly_attribute</strong>(name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="destroyed?-instance_method">
  <h3 class='signature ro first'>
    #<strong>destroyed?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if this object has been destroyed, otherwise returns false.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L355-L357'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='355' data-end='357'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 355</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroyed?'>destroyed?</span>
  <span class='ivar'>@destroyed</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new_record?-instance_method">
  <h3 class='signature ro'>
    #<strong>new_record?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if this object hasn’t been saved yet – that is, a record for the object doesn’t exist in the database yet; otherwise, returns false.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L338-L340'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='338' data-end='340'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 338</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_new_record?'>new_record?</span>
  <span class='ivar'>@new_record</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="persisted?-instance_method">
  <h3 class='signature ro'>
    #<strong>persisted?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if the record is persisted, i.e. it’s not a new record and it was not destroyed, otherwise returns false.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L361-L363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='361' data-end='363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 361</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_persisted?'>persisted?</span>
  <span class='op'>!</span>(<span class='ivar'>@new_record</span> <span class='op'>||</span> <span class='ivar'>@destroyed</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="previously_new_record?-instance_method">
  <h3 class='signature ro'>
    #<strong>previously_new_record?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if this object was just created – that is, prior to the last update or delete, the object didn’t exist in the database and new_record? would have returned true.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L345-L347'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='345' data-end='347'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 345</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_previously_new_record?'>previously_new_record?</span>
  <span class='ivar'>@previously_new_record</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="previously_persisted?-instance_method">
  <h3 class='signature ro'>
    #<strong>previously_persisted?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if this object was previously persisted but now it has been deleted.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L350-L352'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='350' data-end='352'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 350</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_previously_persisted?'>previously_persisted?</span>
  <span class='op'>!</span><span class='id identifier rubyid_new_record?'><a href="#new_record%3F-instance_method" title="ActiveRecord::Persistence#new_record? (method)">new_record?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_destroyed?'><a href="#destroyed%3F-instance_method" title="ActiveRecord::Persistence#destroyed? (method)">destroyed?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_create_record-instance_method">
  <h3 class='signature priv first'>
    #<strong>_create_record</strong>(attribute_names = self.attribute_names) {|_self| ... }  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a record with values matching those of the instance attributes and returns its id.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>_self</code>)</span>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>_self</span>
    <span class='type'>(<code>Persistence</code>)</span>
&mdash;    <div class='inline'>
<p>the object that the method was called on</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L953-L976'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='953' data-end='976'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 953</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__create_record'>_create_record</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_attribute_names'>attribute_names</span>)
  <span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes_for_create'>attributes_for_create</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span>)

  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
    <span class='id identifier rubyid_returning_columns'>returning_columns</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__returning_columns_for_insert'>_returning_columns_for_insert</span>(<span class='id identifier rubyid_connection'>connection</span>)

    <span class='id identifier rubyid_returning_values'>returning_values</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__insert_record'>_insert_record</span>(
      <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span>
      <span class='id identifier rubyid_attributes_with_values'>attributes_with_values</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span>)<span class='comma'>,</span>
      <span class='id identifier rubyid_returning_columns'>returning_columns</span>
    )

    <span class='id identifier rubyid_returning_columns'>returning_columns</span>.<span class='id identifier rubyid_zip'>zip</span>(<span class='id identifier rubyid_returning_values'>returning_values</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
      <span class='id identifier rubyid__write_attribute'>_write_attribute</span>(<span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_type_for_attribute'>type_for_attribute</span>(<span class='id identifier rubyid_column'>column</span>).<span class='id identifier rubyid_deserialize'>deserialize</span>(<span class='id identifier rubyid_value'>value</span>)) <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_column'>column</span>)
    <span class='kw'>end</span> <span class='kw'>if</span> <span class='id identifier rubyid_returning_values'>returning_values</span>
  <span class='kw'>end</span>

  <span class='ivar'>@new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@previously_new_record</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>yield</span>(<span class='kw'>self</span>) <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_delete_row-instance_method">
  <h3 class='signature priv'>
    #<strong>_delete_row</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L903-L905'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='903' data-end='905'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 903</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__delete_row'>_delete_row</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__delete_record'>_delete_record</span>(<span class='id identifier rubyid__query_constraints_hash'><a href="#_query_constraints_hash-instance_method" title="ActiveRecord::Persistence#_query_constraints_hash (method)">_query_constraints_hash</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_find_record-instance_method">
  <h3 class='signature priv'>
    #<strong>_find_record</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L859-L868'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='859' data-end='868'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 859</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__find_record'>_find_record</span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='id identifier rubyid_all_queries'>all_queries</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>?</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_all_queries'>all_queries</span>] <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_base'>base</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_all'>all</span>(<span class='label'>all_queries:</span> <span class='id identifier rubyid_all_queries'>all_queries</span>).<span class='id identifier rubyid_preload'>preload</span>(<span class='id identifier rubyid_strict_loaded_associations'><a href="#strict_loaded_associations-instance_method" title="ActiveRecord::Persistence#strict_loaded_associations (method)">strict_loaded_associations</a></span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lock'>lock</span>]
    <span class='id identifier rubyid_base'>base</span>.<span class='id identifier rubyid_lock'>lock</span>(<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lock'>lock</span>]).<span class='id identifier rubyid_find_by!'>find_by!</span>(<span class='id identifier rubyid__in_memory_query_constraints_hash'><a href="#_in_memory_query_constraints_hash-instance_method" title="ActiveRecord::Persistence#_in_memory_query_constraints_hash (method)">_in_memory_query_constraints_hash</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_base'>base</span>.<span class='id identifier rubyid_find_by!'>find_by!</span>(<span class='id identifier rubyid__in_memory_query_constraints_hash'><a href="#_in_memory_query_constraints_hash-instance_method" title="ActiveRecord::Persistence#_in_memory_query_constraints_hash (method)">_in_memory_query_constraints_hash</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_in_memory_query_constraints_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>_in_memory_query_constraints_hash</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L870-L878'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='870' data-end='878'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 870</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__in_memory_query_constraints_hash'>_in_memory_query_constraints_hash</span>
  <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    { <span class='ivar'>@primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span> }
  <span class='kw'>else</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>.<span class='id identifier rubyid_index_with'>index_with</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column_name'>column_name</span><span class='op'>|</span>
      <span class='id identifier rubyid_attribute'>attribute</span>(<span class='id identifier rubyid_column_name'>column_name</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_query_constraints_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>_query_constraints_hash</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L885-L893'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='885' data-end='893'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 885</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__query_constraints_hash'>_query_constraints_hash</span>
  <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    { <span class='ivar'>@primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id_in_database'>id_in_database</span> }
  <span class='kw'>else</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>.<span class='id identifier rubyid_index_with'>index_with</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column_name'>column_name</span><span class='op'>|</span>
      <span class='id identifier rubyid_attribute_in_database'>attribute_in_database</span>(<span class='id identifier rubyid_column_name'>column_name</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_raise_readonly_record_error-instance_method">
  <h3 class='signature priv'>
    #<strong>_raise_readonly_record_error</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ReadOnlyRecord.html" title="ActiveRecord::ReadOnlyRecord (class)">ReadOnlyRecord</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L990-L992'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='990' data-end='992'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 990</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__raise_readonly_record_error'>_raise_readonly_record_error</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ReadOnlyRecord.html" title="ActiveRecord::ReadOnlyRecord (class)">ReadOnlyRecord</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> is marked as readonly</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_raise_record_not_destroyed-instance_method">
  <h3 class='signature priv'>
    #<strong>_raise_record_not_destroyed</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L982-L988'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='982' data-end='988'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 982</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__raise_record_not_destroyed'>_raise_record_not_destroyed</span>
  <span class='ivar'>@_association_destroy_exception</span> <span class='op'>||=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='ivar'>@_association_destroy_exception</span> <span class='op'>||</span> <span class='const'><a href="RecordNotDestroyed.html" title="ActiveRecord::RecordNotDestroyed (class)">RecordNotDestroyed</a></span>.<span class='id identifier rubyid_new'><a href="RecordNotDestroyed.html#new-class_method" title="ActiveRecord::RecordNotDestroyed.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to destroy </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span>)
<span class='kw'>ensure</span>
  <span class='ivar'>@_association_destroy_exception</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_raise_record_not_touched_error-instance_method">
  <h3 class='signature priv'>
    #<strong>_raise_record_not_touched_error</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L994-L999'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='994' data-end='999'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 994</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__raise_record_not_touched_error'>_raise_record_not_touched_error</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span><span class='comma'>,</span> <span class='heredoc_beg'>&lt;&lt;~MSG</span>.<span class='id identifier rubyid_squish'>squish</span>
<span class='ignored_sp'>    </span><span class='tstring_content'>Cannot touch on a new or destroyed record object. Consider using
</span><span class='ignored_sp'>    </span><span class='tstring_content'>persisted?, new_record?, or destroyed? before touching.
</span><span class='heredoc_end'>  MSG
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_touch_row-instance_method">
  <h3 class='signature priv'>
    #<strong>_touch_row</strong>(attribute_names, time)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L907-L915'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='907' data-end='915'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 907</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__touch_row'>_touch_row</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span>)
  <span class='id identifier rubyid_time'>time</span> <span class='op'>||=</span> <span class='id identifier rubyid_current_time_from_proper_timezone'>current_time_from_proper_timezone</span>

  <span class='id identifier rubyid_attribute_names'>attribute_names</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='op'>|</span>
    <span class='id identifier rubyid__write_attribute'>_write_attribute</span>(<span class='id identifier rubyid_attr_name'>attr_name</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid__update_row'><a href="#_update_row-instance_method" title="ActiveRecord::Persistence#_update_row (method)">_update_row</a></span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>touch</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_update_record-instance_method">
  <h3 class='signature priv'>
    #<strong>_update_record</strong>(attribute_names = self.attribute_names) {|_self| ... }  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the associated record with values matching those of the instance attributes. Returns the number of affected rows.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>_self</code>)</span>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>_self</span>
    <span class='type'>(<code>Persistence</code>)</span>
&mdash;    <div class='inline'>
<p>the object that the method was called on</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L933-L949'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='933' data-end='949'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 933</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__update_record'>_update_record</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_attribute_names'>attribute_names</span>)
  <span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes_for_update'>attributes_for_update</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_attribute_names'>attribute_names</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='ivar'>@_trigger_update_callback</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>=</span> <span class='id identifier rubyid__update_row'><a href="#_update_row-instance_method" title="ActiveRecord::Persistence#_update_row (method)">_update_row</a></span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span>)
    <span class='ivar'>@_trigger_update_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='ivar'>@previously_new_record</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='kw'>yield</span>(<span class='kw'>self</span>) <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='id identifier rubyid_affected_rows'>affected_rows</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_update_row-instance_method">
  <h3 class='signature priv'>
    #<strong>_update_row</strong>(attribute_names, attempted_action = &quot;update&quot;)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L917-L922'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='917' data-end='922'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 917</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__update_row'>_update_row</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span><span class='comma'>,</span> <span class='id identifier rubyid_attempted_action'>attempted_action</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__update_record'><a href="#_update_record-instance_method" title="ActiveRecord::Persistence#_update_record (method)">_update_record</a></span>(
    <span class='id identifier rubyid_attributes_with_values'>attributes_with_values</span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span>)<span class='comma'>,</span>
    <span class='id identifier rubyid__query_constraints_hash'><a href="#_query_constraints_hash-instance_method" title="ActiveRecord::Persistence#_query_constraints_hash (method)">_query_constraints_hash</a></span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="apply_scoping?-instance_method">
  <h3 class='signature priv'>
    #<strong>apply_scoping?</strong>(options)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L880-L883'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='880' data-end='883'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 880</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_scoping?'>apply_scoping?</span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='op'>!</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_unscoped'>unscoped</span>]) <span class='op'>&amp;&amp;</span>
    (<span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_default_scopes?'>default_scopes?</span>(<span class='label'>all_queries:</span> <span class='kw'>true</span>) <span class='op'>||</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_global_current_scope'>global_current_scope</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="becomes-instance_method">
  <h3 class='signature '>
    #<strong>becomes</strong>(klass)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an instance of the specified <code>klass</code> with the attributes of the current record. This is mostly useful in relation to single table inheritance (STI) structures where you want a subclass to appear as the superclass. This can be used along with record identification in Action Pack to allow, say, <code>Client &lt; Company</code> to do something like render <code>partial: @client.becomes(Company)</code> to render that instance using the companies/company partial instead of clients/client.</p>

<p>Note: The new instance will share a link to the same attributes as the original class. Therefore the STI column value will still be the same. Any change to the attributes on either instance will affect both instances. This includes any attribute initialization done by the new instance.</p>

<p>If you want to change the STI column as well, use <a href="#becomes!-instance_method" title="ActiveRecord::Persistence#becomes! (method)">#becomes!</a> instead.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L487-L503'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='487' data-end='503'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 487</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_becomes'>becomes</span>(<span class='id identifier rubyid_klass'>klass</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_clone'>clone</span> <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span> <span class='op'>==</span> <span class='id identifier rubyid_klass'>klass</span>

  <span class='id identifier rubyid_became'>became</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_allocate'>allocate</span>

  <span class='id identifier rubyid_became'>became</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_initialize'>initialize</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_becoming'>becoming</span><span class='op'>|</span>
    <span class='ivar'>@attributes</span>.<span class='id identifier rubyid_reverse_merge!'>reverse_merge!</span>(<span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span>(<span class='symbeg'>:</span><span class='ivar'>@attributes</span>))
    <span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='symbeg'>:</span><span class='ivar'>@attributes</span><span class='comma'>,</span> <span class='ivar'>@attributes</span>)
    <span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='symbeg'>:</span><span class='ivar'>@mutations_from_database</span><span class='comma'>,</span> <span class='ivar'>@mutations_from_database</span> <span class='op'>||=</span> <span class='kw'>nil</span>)
    <span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='symbeg'>:</span><span class='ivar'>@new_record</span><span class='comma'>,</span> <span class='id identifier rubyid_new_record?'><a href="#new_record%3F-instance_method" title="ActiveRecord::Persistence#new_record? (method)">new_record?</a></span>)
    <span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='symbeg'>:</span><span class='ivar'>@previously_new_record</span><span class='comma'>,</span> <span class='id identifier rubyid_previously_new_record?'><a href="#previously_new_record%3F-instance_method" title="ActiveRecord::Persistence#previously_new_record? (method)">previously_new_record?</a></span>)
    <span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='symbeg'>:</span><span class='ivar'>@destroyed</span><span class='comma'>,</span> <span class='id identifier rubyid_destroyed?'><a href="#destroyed%3F-instance_method" title="ActiveRecord::Persistence#destroyed? (method)">destroyed?</a></span>)
    <span class='id identifier rubyid_becoming'>becoming</span>.<span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_copy!'>copy!</span>(<span class='id identifier rubyid_errors'>errors</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_became'>became</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="becomes!-instance_method">
  <h3 class='signature '>
    #<strong>becomes!</strong>(klass)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wrapper around <a href="#becomes-instance_method" title="ActiveRecord::Persistence#becomes (method)">#becomes</a> that also changes the instance’s STI column value. This is especially useful if you want to persist the changed class in your database.</p>

<p>Note: The old instance’s STI column value will be changed too, as both objects share the same set of attributes.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L511-L519'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='511' data-end='519'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 511</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_becomes!'>becomes!</span>(<span class='id identifier rubyid_klass'>klass</span>)
  <span class='id identifier rubyid_became'>became</span> <span class='op'>=</span> <span class='id identifier rubyid_becomes'><a href="#becomes-instance_method" title="ActiveRecord::Persistence#becomes (method)">becomes</a></span>(<span class='id identifier rubyid_klass'>klass</span>)
  <span class='id identifier rubyid_sti_type'>sti_type</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_descends_from_active_record?'>descends_from_active_record?</span>
    <span class='id identifier rubyid_sti_type'>sti_type</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_sti_name'>sti_name</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_became'>became</span>.<span class='id identifier rubyid_public_send'>public_send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_inheritance_column'>inheritance_column</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_sti_type'>sti_type</span>)
  <span class='id identifier rubyid_became'>became</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_or_update-instance_method">
  <h3 class='signature priv'>
    #<strong>create_or_update</strong>(&amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L924-L929'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='924' data-end='929'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 924</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_or_update'>create_or_update</span>(<span class='op'>**</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid__raise_readonly_record_error'><a href="#_raise_readonly_record_error-instance_method" title="ActiveRecord::Persistence#_raise_readonly_record_error (method)">_raise_readonly_record_error</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_readonly?'>readonly?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_destroyed?'><a href="#destroyed%3F-instance_method" title="ActiveRecord::Persistence#destroyed? (method)">destroyed?</a></span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_new_record?'><a href="#new_record%3F-instance_method" title="ActiveRecord::Persistence#new_record? (method)">new_record?</a></span> <span class='op'>?</span> <span class='id identifier rubyid__create_record'><a href="#_create_record-instance_method" title="ActiveRecord::Persistence#_create_record (method)">_create_record</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='op'>:</span> <span class='id identifier rubyid__update_record'><a href="#_update_record-instance_method" title="ActiveRecord::Persistence#_update_record (method)">_update_record</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>!=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decrement-instance_method">
  <h3 class='signature '>
    #<strong>decrement</strong>(attribute, by = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initializes <code>attribute</code> to zero if <code>nil</code> and subtracts the value passed as <code>by</code> (default is 1). The decrement is performed directly on the underlying attribute, no setter is invoked. Only makes sense for number-based attributes. Returns <code>self</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L688-L690'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='688' data-end='690'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 688</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decrement'>decrement</span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_by'>by</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_increment'><a href="#increment-instance_method" title="ActiveRecord::Persistence#increment (method)">increment</a></span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_by'>by</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decrement!-instance_method">
  <h3 class='signature '>
    #<strong>decrement!</strong>(attribute, by = 1, touch: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wrapper around <a href="#decrement-instance_method" title="ActiveRecord::Persistence#decrement (method)">#decrement</a> that writes the update to the database. Only <code>attribute</code> is updated; the record itself is not saved. This means that any other modified attributes will still be dirty. <a href="Validations.html" title="ActiveRecord::Validations (module)"><code>Validations</code></a> and callbacks are skipped. Supports the <a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">#touch</a> option from <code>update_counters</code>, see that for more. Returns <code>self</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L698-L700'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='698' data-end='700'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 698</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decrement!'>decrement!</span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_by'>by</span> <span class='op'>=</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_increment!'><a href="#increment!-instance_method" title="ActiveRecord::Persistence#increment! (method)">increment!</a></span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_by'>by</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can’t be persisted). Returns the frozen instance.</p>

<p>The row is simply removed with an SQL <code>DELETE</code> statement on the record’s primary key, and no callbacks are executed.</p>

<p>Note that this will also delete records marked as <a href="rdoc-ref:Core#readonly?">#readonly?</a>.</p>

<p>To enforce the object’s <code>before_destroy</code> and <code>after_destroy</code> callbacks or any <code>:dependent</code> association options, use <a href="#destroy-instance_method" title="ActiveRecord::Persistence#destroy (method)">#destroy</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L439-L444'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='439' data-end='444'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 439</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>
  <span class='id identifier rubyid__delete_row'><a href="#_delete_row-instance_method" title="ActiveRecord::Persistence#_delete_row (method)">_delete_row</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_persisted?'><a href="#persisted%3F-instance_method" title="ActiveRecord::Persistence#persisted? (method)">persisted?</a></span>
  <span class='ivar'>@destroyed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@previously_new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_freeze'>freeze</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy-instance_method">
  <h3 class='signature '>
    #<strong>destroy</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can’t be persisted).</p>

<p>There’s a series of callbacks associated with <code>#destroy</code>. If the <code>before_destroy</code> callback throws <code>:abort</code> the action is cancelled and <code>#destroy</code> returns <code>false</code>. See <a href="Callbacks.html" title="ActiveRecord::Callbacks (module)"><code>Callbacks</code></a> for further details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L453-L460'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='453' data-end='460'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 453</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='id identifier rubyid__raise_readonly_record_error'><a href="#_raise_readonly_record_error-instance_method" title="ActiveRecord::Persistence#_raise_readonly_record_error (method)">_raise_readonly_record_error</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_readonly?'>readonly?</span>
  <span class='id identifier rubyid_destroy_associations'><a href="#destroy_associations-instance_method" title="ActiveRecord::Persistence#destroy_associations (method)">destroy_associations</a></span>
  <span class='ivar'>@_trigger_destroy_callback</span> <span class='op'>||=</span> <span class='id identifier rubyid_persisted?'><a href="#persisted%3F-instance_method" title="ActiveRecord::Persistence#persisted? (method)">persisted?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_destroy_row'><a href="#destroy_row-instance_method" title="ActiveRecord::Persistence#destroy_row (method)">destroy_row</a></span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='ivar'>@destroyed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@previously_new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_freeze'>freeze</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy!-instance_method">
  <h3 class='signature '>
    #<strong>destroy!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can’t be persisted).</p>

<p>There’s a series of callbacks associated with <code>#destroy!</code>. If the <code>before_destroy</code> callback throws <code>:abort</code> the action is cancelled and <code>#destroy!</code> raises <a href="RecordNotDestroyed.html" title="ActiveRecord::RecordNotDestroyed (class)"><code>RecordNotDestroyed</code></a>. See <a href="Callbacks.html" title="ActiveRecord::Callbacks (module)"><code>Callbacks</code></a> for further details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L469-L471'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='469' data-end='471'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 469</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy!'>destroy!</span>
  <span class='id identifier rubyid_destroy'><a href="#destroy-instance_method" title="ActiveRecord::Persistence#destroy (method)">destroy</a></span> <span class='op'>||</span> <span class='id identifier rubyid__raise_record_not_destroyed'><a href="#_raise_record_not_destroyed-instance_method" title="ActiveRecord::Persistence#_raise_record_not_destroyed (method)">_raise_record_not_destroyed</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy_associations-instance_method">
  <h3 class='signature priv'>
    #<strong>destroy_associations</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A hook to be overridden by association modules.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L896-L897'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='896' data-end='897'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 896</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_associations'>destroy_associations</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy_row-instance_method">
  <h3 class='signature priv'>
    #<strong>destroy_row</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L899-L901'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='899' data-end='901'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 899</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_row'>destroy_row</span>
  <span class='id identifier rubyid__delete_row'><a href="#_delete_row-instance_method" title="ActiveRecord::Persistence#_delete_row (method)">_delete_row</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="increment-instance_method">
  <h3 class='signature '>
    #<strong>increment</strong>(attribute, by = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initializes <code>attribute</code> to zero if <code>nil</code> and adds the value passed as <code>by</code> (default is 1). The increment is performed directly on the underlying attribute, no setter is invoked. Only makes sense for number-based attributes. Returns <code>self</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L658-L662'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='658' data-end='662'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 658</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_increment'>increment</span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_by'>by</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='kw'>self</span>[<span class='id identifier rubyid_attribute'>attribute</span>] <span class='op'>||=</span> <span class='int'>0</span>
  <span class='kw'>self</span>[<span class='id identifier rubyid_attribute'>attribute</span>] <span class='op'>+=</span> <span class='id identifier rubyid_by'>by</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="increment!-instance_method">
  <h3 class='signature '>
    #<strong>increment!</strong>(attribute, by = 1, touch: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wrapper around <a href="#increment-instance_method" title="ActiveRecord::Persistence#increment (method)">#increment</a> that writes the update to the database. Only <code>attribute</code> is updated; the record itself is not saved. This means that any other modified attributes will still be dirty. <a href="Validations.html" title="ActiveRecord::Validations (module)"><code>Validations</code></a> and callbacks are skipped. Supports the <a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">#touch</a> option from <code>update_counters</code>, see that for more.</p>

<p>This method raises an <a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>ActiveRecordError</code></a> when called on new objects, or when at least one of the attributes is marked as readonly.</p>

<p>Returns <code>self</code>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L674-L683'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='674' data-end='683'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 674</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_increment!'>increment!</span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_by'>by</span> <span class='op'>=</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot update a new record</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_new_record?'><a href="#new_record%3F-instance_method" title="ActiveRecord::Persistence#new_record? (method)">new_record?</a></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot update a destroyed record</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_destroyed?'><a href="#destroyed%3F-instance_method" title="ActiveRecord::Persistence#destroyed? (method)">destroyed?</a></span>

  <span class='id identifier rubyid_increment'><a href="#increment-instance_method" title="ActiveRecord::Persistence#increment (method)">increment</a></span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_by'>by</span>)
  <span class='id identifier rubyid_change'>change</span> <span class='op'>=</span> <span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_attribute'>attribute</span>) <span class='op'>-</span> (<span class='id identifier rubyid_public_send'>public_send</span>(<span class='symbeg'>:&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attribute'>attribute</span><span class='embexpr_end'>}</span><span class='tstring_content'>_in_database</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>||</span> <span class='int'>0</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_update_counters'>update_counters</span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_attribute'>attribute</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_change'>change</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span>)
  <span class='id identifier rubyid_public_send'>public_send</span>(<span class='symbeg'>:&quot;</span><span class='tstring_content'>clear_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attribute'>attribute</span><span class='embexpr_end'>}</span><span class='tstring_content'>_change</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="init_internals-instance_method">
  <h3 class='signature priv'>
    #<strong>init_internals</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L847-L851'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='847' data-end='851'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 847</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_init_internals'>init_internals</span>
  <span class='kw'>super</span>
  <span class='ivar'>@_trigger_destroy_callback</span> <span class='op'>=</span> <span class='ivar'>@_trigger_update_callback</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@previously_new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reload-instance_method">
  <h3 class='signature '>
    #<strong>reload</strong>(options = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reloads the record from the database.</p>

<p>This method finds the record by its primary key (which could be assigned manually) and modifies the receiver in-place:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_account'>account</span> <span class='op'>=</span> <span class='const'>Account</span>.<span class='id identifier rubyid_new'>new</span>
<span class='comment'># =&gt; #&lt;Account id: nil, email: nil&gt;
</span><span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_reload'>reload</span>
<span class='comment'># Account Load (1.2ms)  SELECT &quot;accounts&quot;.* FROM &quot;accounts&quot; WHERE &quot;accounts&quot;.&quot;id&quot; = $1 LIMIT 1  [[&quot;id&quot;, 1]]
</span><span class='comment'># =&gt; #&lt;Account id: 1, email: &#39;account@example.com&#39;&gt;</span></code></pre>

<p><a href="Attributes.html" title="ActiveRecord::Attributes (module)"><code>Attributes</code></a> are reloaded from the database, and caches busted, in particular the associations cache and the <a href="QueryCache.html" title="ActiveRecord::QueryCache (class)"><code>QueryCache</code></a>.</p>

<p>If the record no longer exists in the database <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> is raised. Otherwise, in addition to the in-place modification the method returns <code>self</code> for convenience.</p>

<p>The optional <code>:lock</code> flag option allows you to lock the reloaded record:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_reload'>reload</span>(<span class='label'>lock:</span> <span class='kw'>true</span>) <span class='comment'># reload with pessimistic locking</span></code></pre>

<p>Reloading is commonly used in test suites to test something is actually written to the database, or when some action modifies the corresponding row in the database but not the object in memory:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert'>assert</span> <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_deposit!'>deposit!</span>(<span class='int'>25</span>)
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>25</span><span class='comma'>,</span> <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_credit'>credit</span>        <span class='comment'># check it is updated in memory
</span><span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>25</span><span class='comma'>,</span> <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_reload'>reload</span>.<span class='id identifier rubyid_credit'>credit</span> <span class='comment'># check it is also persisted</span></code></pre>

<p>Another common use case is optimistic locking handling:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_with_optimistic_retry'>with_optimistic_retry</span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="StaleObjectError.html" title="ActiveRecord::StaleObjectError (class)">StaleObjectError</a></span>
    <span class='kw'>begin</span>
      <span class='comment'># Reload lock_version in particular.
</span>      <span class='id identifier rubyid_reload'>reload</span>
    <span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)">RecordNotFound</a></span>
      <span class='comment'># If the record is gone there is nothing to do.
</span>    <span class='kw'>else</span>
      <span class='kw'>retry</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L775-L790'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='775' data-end='790'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 775</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reload'>reload</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_connection_pool'>connection_pool</span>.<span class='id identifier rubyid_clear_query_cache'>clear_query_cache</span>

  <span class='id identifier rubyid_fresh_object'>fresh_object</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_apply_scoping?'><a href="#apply_scoping%3F-instance_method" title="ActiveRecord::Persistence#apply_scoping? (method)">apply_scoping?</a></span>(<span class='id identifier rubyid_options'>options</span>)
    <span class='id identifier rubyid__find_record'><a href="#_find_record-instance_method" title="ActiveRecord::Persistence#_find_record (method)">_find_record</a></span>((<span class='id identifier rubyid_options'>options</span> <span class='op'>||</span> {}).<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>all_queries:</span> <span class='kw'>true</span>))
  <span class='kw'>else</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_unscoped'>unscoped</span> { <span class='id identifier rubyid__find_record'><a href="#_find_record-instance_method" title="ActiveRecord::Persistence#_find_record (method)">_find_record</a></span>(<span class='id identifier rubyid_options'>options</span>) }
  <span class='kw'>end</span>

  <span class='ivar'>@association_cache</span> <span class='op'>=</span> <span class='id identifier rubyid_fresh_object'>fresh_object</span>.<span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span>(<span class='symbeg'>:</span><span class='ivar'>@association_cache</span>)
  <span class='ivar'>@association_cache</span>.<span class='id identifier rubyid_each_value'>each_value</span> { <span class='op'>|</span><span class='id identifier rubyid_association'>association</span><span class='op'>|</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_owner'>owner</span> <span class='op'>=</span> <span class='kw'>self</span> }
  <span class='ivar'>@attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_fresh_object'>fresh_object</span>.<span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span>(<span class='symbeg'>:</span><span class='ivar'>@attributes</span>)
  <span class='ivar'>@new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@previously_new_record</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save-instance_method">
  <h3 class='signature '>
    #<strong>save</strong>(**options)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Saves the model.</p>

<p>If the model is new, a record gets created in the database, otherwise the existing record gets updated.</p>

<p>By default, save always runs validations. If any of them fail the action is cancelled and <code>#save</code> returns <code>false</code>, and the record won’t be saved. However, if you supply <code>validate: false</code>, validations are bypassed altogether. See <a href="Validations.html" title="ActiveRecord::Validations (module)"><code>Validations</code></a> for more information.</p>

<p>By default, <code>#save</code> also sets the <code>updated_at+/+updated_on</code> attributes to the current time. However, if you supply <code>touch: false</code>, these timestamps will not be updated.</p>

<p>There’s a series of callbacks associated with <code>#save</code>. If any of the <code>before_*</code> callbacks throws <code>:abort</code> the action is cancelled and <code>#save</code> returns <code>false</code>. See <a href="Callbacks.html" title="ActiveRecord::Callbacks (module)"><code>Callbacks</code></a> for further details.</p>

<p><a href="Attributes.html" title="ActiveRecord::Attributes (module)"><code>Attributes</code></a> marked as readonly are silently ignored if the record is being updated.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L390-L394'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='390' data-end='394'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 390</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save'>save</span>(<span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_create_or_update'><a href="#create_or_update-instance_method" title="ActiveRecord::Persistence#create_or_update (method)">create_or_update</a></span>(<span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="RecordInvalid.html" title="ActiveRecord::RecordInvalid (class)">RecordInvalid</a></span>
  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save!-instance_method">
  <h3 class='signature '>
    #<strong>save!</strong>(**options)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Saves the model.</p>

<p>If the model is new, a record gets created in the database, otherwise the existing record gets updated.</p>

<p>By default, <code>#save!</code> always runs validations. If any of them fail <a href="RecordInvalid.html" title="ActiveRecord::RecordInvalid (class)"><code>RecordInvalid</code></a> gets raised, and the record won’t be saved. However, if you supply <code>validate: false</code>, validations are bypassed altogether. See <a href="Validations.html" title="ActiveRecord::Validations (module)"><code>Validations</code></a> for more information.</p>

<p>By default, <code>#save!</code> also sets the <code>updated_at+/+updated_on</code> attributes to the current time. However, if you supply <code>touch: false</code>, these timestamps will not be updated.</p>

<p>There’s a series of callbacks associated with <code>#save!</code>. If any of the <code>before_*</code> callbacks throws <code>:abort</code> the action is cancelled and <code>#save!</code> raises <a href="RecordNotSaved.html" title="ActiveRecord::RecordNotSaved (class)"><code>RecordNotSaved</code></a>. See <a href="Callbacks.html" title="ActiveRecord::Callbacks (module)"><code>Callbacks</code></a> for further details.</p>

<p><a href="Attributes.html" title="ActiveRecord::Attributes (module)"><code>Attributes</code></a> marked as readonly are silently ignored if the record is being updated.</p>

<p>Unless an error is raised, returns true.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L423-L425'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='423' data-end='425'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 423</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save!'>save!</span>(<span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_create_or_update'><a href="#create_or_update-instance_method" title="ActiveRecord::Persistence#create_or_update (method)">create_or_update</a></span>(<span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='op'>||</span> <span class='id identifier rubyid_raise'>raise</span>(<span class='const'><a href="RecordNotSaved.html" title="ActiveRecord::RecordNotSaved (class)">RecordNotSaved</a></span>.<span class='id identifier rubyid_new'><a href="RecordNotSaved.html#new-class_method" title="ActiveRecord::RecordNotSaved.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to save the record</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="strict_loaded_associations-instance_method">
  <h3 class='signature priv'>
    #<strong>strict_loaded_associations</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L853-L857'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='853' data-end='857'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 853</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_strict_loaded_associations'>strict_loaded_associations</span>
  <span class='ivar'>@association_cache</span>.<span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='op'>|</span>
    <span class='id identifier rubyid_assoc'>assoc</span>.<span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_strict_loading?'>strict_loading?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_assoc'>assoc</span>.<span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_strict_loading_n_plus_one_only?'>strict_loading_n_plus_one_only?</span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_first'>first</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="toggle-instance_method">
  <h3 class='signature '>
    #<strong>toggle</strong>(attribute)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Assigns to <code>attribute</code> the boolean opposite of <code>attribute?</code>. So if the predicate returns <code>true</code> the attribute will become <code>false</code>. This method toggles directly the underlying value without calling any setter. Returns <code>self</code>.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_banned?'>banned?</span> <span class='comment'># =&gt; false
</span><span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_toggle'>toggle</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_banned'>banned</span>)
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_banned?'>banned?</span> <span class='comment'># =&gt; true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L714-L717'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='714' data-end='717'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 714</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_toggle'>toggle</span>(<span class='id identifier rubyid_attribute'>attribute</span>)
  <span class='kw'>self</span>[<span class='id identifier rubyid_attribute'>attribute</span>] <span class='op'>=</span> <span class='op'>!</span><span class='id identifier rubyid_public_send'>public_send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attribute'>attribute</span><span class='embexpr_end'>}</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="toggle!-instance_method">
  <h3 class='signature '>
    #<strong>toggle!</strong>(attribute)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wrapper around <a href="#toggle-instance_method" title="ActiveRecord::Persistence#toggle (method)">#toggle</a> that saves the record. This method differs from its non-bang version in the sense that it passes through the attribute setter. Saving is not subjected to validation checks. Returns <code>true</code> if the record could be saved.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L723-L725'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='723' data-end='725'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 723</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_toggle!'>toggle!</span>(<span class='id identifier rubyid_attribute'>attribute</span>)
  <span class='id identifier rubyid_toggle'><a href="#toggle-instance_method" title="ActiveRecord::Persistence#toggle (method)">toggle</a></span>(<span class='id identifier rubyid_attribute'>attribute</span>).<span class='id identifier rubyid_update_attribute'><a href="#update_attribute-instance_method" title="ActiveRecord::Persistence#update_attribute (method)">update_attribute</a></span>(<span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='kw'>self</span>[<span class='id identifier rubyid_attribute'>attribute</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="touch-instance_method">
  <h3 class='signature '>
    #<strong>touch</strong>(*names, time: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Saves the record with the updated_at/on attributes set to the current time or the time specified. Please note that no validation is performed and only the <code>after_touch</code>, <code>after_commit</code> and <code>after_rollback</code> callbacks are executed.</p>

<p>This method can be passed attribute names and an optional time argument. If attribute names are passed, they are updated along with updated_at/on attributes. If no time argument is passed, the current time is used as default.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_product'>product</span>.<span class='id identifier rubyid_touch'>touch</span>                         <span class='comment'># updates updated_at/on with current time
</span><span class='id identifier rubyid_product'>product</span>.<span class='id identifier rubyid_touch'>touch</span>(<span class='label'>time:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2015</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>)) <span class='comment'># updates updated_at/on with specified time
</span><span class='id identifier rubyid_product'>product</span>.<span class='id identifier rubyid_touch'>touch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_designed_at'>designed_at</span>)           <span class='comment'># updates the designed_at attribute and updated_at/on
</span><span class='id identifier rubyid_product'>product</span>.<span class='id identifier rubyid_touch'>touch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_started_at'>started_at</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ended_at'>ended_at</span>) <span class='comment'># updates started_at, ended_at and updated_at/on attributes</span></code></pre>

<p>If used along with <a href="Associations/ClassMethods.html#belongs_to-instance_method" title="ActiveRecord::Associations::ClassMethods#belongs_to (method)">belongs_to</a> then <code>touch</code> will invoke <code>touch</code> method on associated object.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Brake</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_car'>car</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>true</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Car</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_corporation'>corporation</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>true</span>
<span class='kw'>end</span>

<span class='comment'># triggers @brake.car.touch and @brake.car.corporation.touch
</span><span class='ivar'>@brake</span>.<span class='id identifier rubyid_touch'>touch</span></code></pre>

<p>Note that <code>touch</code> must be used on a persisted object, or else an <a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>ActiveRecordError</code></a> will be thrown. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ball'>ball</span> <span class='op'>=</span> <span class='const'>Ball</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_ball'>ball</span>.<span class='id identifier rubyid_touch'>touch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_updated_at'>updated_at</span>)   <span class='comment'># =&gt; raises ActiveRecordError</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L826-L844'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='826' data-end='844'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 826</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_touch'>touch</span>(<span class='op'>*</span><span class='id identifier rubyid_names'>names</span><span class='comma'>,</span> <span class='label'>time:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid__raise_record_not_touched_error'><a href="#_raise_record_not_touched_error-instance_method" title="ActiveRecord::Persistence#_raise_record_not_touched_error (method)">_raise_record_not_touched_error</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_persisted?'><a href="#persisted%3F-instance_method" title="ActiveRecord::Persistence#persisted? (method)">persisted?</a></span>
  <span class='id identifier rubyid__raise_readonly_record_error'><a href="#_raise_readonly_record_error-instance_method" title="ActiveRecord::Persistence#_raise_readonly_record_error (method)">_raise_readonly_record_error</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_readonly?'>readonly?</span>

  <span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>=</span> <span class='id identifier rubyid_timestamp_attributes_for_update_in_model'>timestamp_attributes_for_update_in_model</span>
  <span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>=</span> (<span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>|</span> <span class='id identifier rubyid_names'>names</span>).<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_attribute_aliases'>attribute_aliases</span>[<span class='id identifier rubyid_name'>name</span>] <span class='op'>||</span> <span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_verify_readonly_attribute'><a href="#verify_readonly_attribute-instance_method" title="ActiveRecord::Persistence#verify_readonly_attribute (method)">verify_readonly_attribute</a></span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_attribute_names'>attribute_names</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>=</span> <span class='id identifier rubyid__touch_row'><a href="#_touch_row-instance_method" title="ActiveRecord::Persistence#_touch_row (method)">_touch_row</a></span>(<span class='id identifier rubyid_attribute_names'>attribute_names</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span>)
    <span class='ivar'>@_trigger_update_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update-instance_method">
  <h3 class='signature '>
    #<strong>update</strong>(attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the attributes of the model from the passed-in hash and saves the record, all wrapped in a transaction. If the object is invalid, the saving will fail and false will be returned.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L566-L573'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='566' data-end='573'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 566</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='comment'># The following transaction covers any possible database side-effects of the
</span>  <span class='comment'># attributes assignment. For example, setting the IDs of a child collection.
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assign_attributes'>assign_attributes</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='id identifier rubyid_save'><a href="#save-instance_method" title="ActiveRecord::Persistence#save (method)">save</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update!-instance_method">
  <h3 class='signature '>
    #<strong>update!</strong>(attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates its receiver just like <a href="#update-instance_method" title="ActiveRecord::Persistence#update (method)">#update</a> but calls <a href="#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">#save!</a> instead of <a href="#save-instance_method" title="ActiveRecord::Persistence#save (method)">#save</a>, so an exception is raised if the record is invalid and saving will fail.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L577-L584'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='577' data-end='584'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 577</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='comment'># The following transaction covers any possible database side-effects of the
</span>  <span class='comment'># attributes assignment. For example, setting the IDs of a child collection.
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assign_attributes'>assign_attributes</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='id identifier rubyid_save!'><a href="#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">save!</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_attribute-instance_method">
  <h3 class='signature '>
    #<strong>update_attribute</strong>(name, value)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates a single attribute and saves the record. This is especially useful for boolean flags on existing records. Also note that</p>
<ul><li>
<p>Validation is skipped.</p>
</li><li>
<p>Callbacks are invoked.</p>
</li><li>
<p>updated_at/updated_on column is updated if that column is available.</p>
</li><li>
<p>Updates all the attributes that are dirty in this object.</p>
</li></ul>

<p>This method raises an <a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>ActiveRecordError</code></a> if the attribute is marked as readonly.</p>

<p>Also see <a href="#update_column-instance_method" title="ActiveRecord::Persistence#update_column (method)">#update_column</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L533-L539'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='533' data-end='539'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 533</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_attribute'>update_attribute</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_verify_readonly_attribute'><a href="#verify_readonly_attribute-instance_method" title="ActiveRecord::Persistence#verify_readonly_attribute (method)">verify_readonly_attribute</a></span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_public_send'>public_send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)

  <span class='id identifier rubyid_save'><a href="#save-instance_method" title="ActiveRecord::Persistence#save (method)">save</a></span>(<span class='label'>validate:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_attribute!-instance_method">
  <h3 class='signature '>
    #<strong>update_attribute!</strong>(name, value)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates a single attribute and saves the record. This is especially useful for boolean flags on existing records. Also note that</p>
<ul><li>
<p>Validation is skipped.</p>
</li><li>
<p>Callbacks are invoked.</p>
</li><li>
<p>updated_at/updated_on column is updated if that column is available.</p>
</li><li>
<p>Updates all the attributes that are dirty in this object.</p>
</li></ul>

<p>This method raises an <a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>ActiveRecordError</code></a> if the attribute is marked as readonly.</p>

<p>If any of the <code>before_*</code> callbacks throws <code>:abort</code> the action is cancelled and <code>#update_attribute!</code> raises <a href="RecordNotSaved.html" title="ActiveRecord::RecordNotSaved (class)"><code>RecordNotSaved</code></a>. See <a href="Callbacks.html" title="ActiveRecord::Callbacks (module)"><code>Callbacks</code></a> for further details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L555-L561'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='555' data-end='561'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 555</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_attribute!'>update_attribute!</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_verify_readonly_attribute'><a href="#verify_readonly_attribute-instance_method" title="ActiveRecord::Persistence#verify_readonly_attribute (method)">verify_readonly_attribute</a></span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_public_send'>public_send</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)

  <span class='id identifier rubyid_save!'><a href="#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">save!</a></span>(<span class='label'>validate:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_column-instance_method">
  <h3 class='signature '>
    #<strong>update_column</strong>(name, value, touch: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Equivalent to <code>update_columns(name =&gt; value)</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L587-L589'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='587' data-end='589'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 587</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_column'>update_column</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_update_columns'><a href="#update_columns-instance_method" title="ActiveRecord::Persistence#update_columns (method)">update_columns</a></span>(<span class='id identifier rubyid_name'>name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_columns-instance_method">
  <h3 class='signature '>
    #<strong>update_columns</strong>(attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the attributes directly in the database issuing an UPDATE SQL statement and sets them in the receiver:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_update_columns'>update_columns</span>(<span class='label'>last_request_at:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="../Time.html#current-class_method" title="Time.current (method)">current</a></span>)</code></pre>

<p>This is the fastest way to update attributes because it goes straight to the database, but take into account that in consequence the regular update procedures are totally bypassed. In particular:</p>
<ul><li>
<p>Validations are skipped.</p>
</li><li>
<p>Callbacks are skipped.</p>
</li><li>
<p><code>updated_at+/+updated_on</code> are updated if the <a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">#touch</a> option is set to <code>true</code>.</p>
</li><li>
<p>However, attributes are serialized with the same rules as <a href="Relation.html#update_all-instance_method" title="ActiveRecord::Relation#update_all (method)">Relation#update_all</a></p>
</li></ul>

<p>This method raises an <a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>ActiveRecordError</code></a> when called on new objects, or when at least one of the attributes is marked as readonly.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>:touch</code> option - Touch the timestamp columns when updating.</p>
</li><li>
<p>If attribute names are passed, they are updated along with <code>updated_at+/+updated_on</code> attributes.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Update a single attribute.
</span><span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_update_columns'>update_columns</span>(<span class='label'>last_request_at:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="../Time.html#current-class_method" title="Time.current (method)">current</a></span>)

<span class='comment'># Update with touch option.
</span><span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_update_columns'>update_columns</span>(<span class='label'>last_request_at:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="../Time.html#current-class_method" title="Time.current (method)">current</a></span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>true</span>)</code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L621-L653'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='621' data-end='653'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 621</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_columns'>update_columns</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot update a new record</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_new_record?'><a href="#new_record%3F-instance_method" title="ActiveRecord::Persistence#new_record? (method)">new_record?</a></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot update a destroyed record</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_destroyed?'><a href="#destroyed%3F-instance_method" title="ActiveRecord::Persistence#destroyed? (method)">destroyed?</a></span>
  <span class='id identifier rubyid__raise_readonly_record_error'><a href="#_raise_readonly_record_error-instance_method" title="ActiveRecord::Persistence#_raise_readonly_record_error (method)">_raise_readonly_record_error</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_readonly?'>readonly?</span>

  <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_transform_keys'>transform_keys</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_attribute_aliases'>attribute_aliases</span>[<span class='id identifier rubyid_name'>name</span>] <span class='op'>||</span> <span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_verify_readonly_attribute'><a href="#verify_readonly_attribute-instance_method" title="ActiveRecord::Persistence#verify_readonly_attribute (method)">verify_readonly_attribute</a></span>(<span class='id identifier rubyid_name'>name</span>) <span class='op'>||</span> <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Persistence#delete (method)">delete</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>touch</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span>
    <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_touch'><a href="#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">touch</a></span> <span class='op'>!=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_wrap'><a href="../Array.html#wrap-class_method" title="Array.wrap (method)">wrap</a></span>(<span class='id identifier rubyid_names'>names</span>)
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_names'>names</span>.<span class='id identifier rubyid_extract_options!'>extract_options!</span>
    <span class='id identifier rubyid_touch_updates'>touch_updates</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_touch_attributes_with_time'>touch_attributes_with_time</span>(<span class='op'>*</span><span class='id identifier rubyid_names'>names</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_with_defaults!'>with_defaults!</span>(<span class='id identifier rubyid_touch_updates'>touch_updates</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_touch_updates'>touch_updates</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_update_constraints'>update_constraints</span> <span class='op'>=</span> <span class='id identifier rubyid__query_constraints_hash'><a href="#_query_constraints_hash-instance_method" title="ActiveRecord::Persistence#_query_constraints_hash (method)">_query_constraints_hash</a></span>
  <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_each_with_object'>each_with_object</span>({}) <span class='kw'>do</span> <span class='op'>|</span>(<span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span>)<span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span><span class='op'>|</span>
    <span class='id identifier rubyid_h'>h</span>[<span class='id identifier rubyid_k'>k</span>] <span class='op'>=</span> <span class='ivar'>@attributes</span>.<span class='id identifier rubyid_write_cast_value'>write_cast_value</span>(<span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span>)
    <span class='id identifier rubyid_clear_attribute_change'>clear_attribute_change</span>(<span class='id identifier rubyid_k'>k</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__update_record'><a href="#_update_record-instance_method" title="ActiveRecord::Persistence#_update_record (method)">_update_record</a></span>(
    <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span>
    <span class='id identifier rubyid_update_constraints'>update_constraints</span>
  )

  <span class='id identifier rubyid_affected_rows'>affected_rows</span> <span class='op'>==</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_readonly_attribute-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_readonly_attribute</strong>(name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/persistence.rb#L978-L980'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='978' data-end='980'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 978</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_readonly_attribute'>verify_readonly_attribute</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is marked as readonly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_readonly_attribute?'>readonly_attribute?</span>(<span class='id identifier rubyid_name'>name</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>