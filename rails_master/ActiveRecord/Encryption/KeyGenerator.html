<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Encryption::KeyGenerator &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Encryption::KeyGenerator",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails main</a> &raquo; 
      <a href='../../_index.html#alpha_K'>Index (K)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>KeyGenerator&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveRecord::Encryption::KeyGenerator</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L8'>activerecord/lib/active_record/encryption/key_generator.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Utility for generating and deriving random keys.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(hash_digest_class: ActiveRecord::Encryption.config.hash_digest_class)  &#x21d2; KeyGenerator </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#hash_digest_class-instance_method" title="#hash_digest_class (instance method)">#<strong>hash_digest_class</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#derive_key_from-instance_method" title="#derive_key_from (instance method)">#<strong>derive_key_from</strong>(password, length: key_length)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Derives a key from the given password.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#generate_random_hex_key-instance_method" title="#generate_random_hex_key (instance method)">#<strong>generate_random_hex_key</strong>(length: key_length)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a random key in hexadecimal format.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#generate_random_key-instance_method" title="#generate_random_key (instance method)">#<strong>generate_random_key</strong>(length: key_length)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a random key.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#key_derivation_salt-instance_method" title="#key_derivation_salt (instance method)">#<strong>key_derivation_salt</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#key_length-instance_method" title="#key_length (instance method)">#<strong>key_length</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(hash_digest_class: ActiveRecord::Encryption.config.hash_digest_class)  &#x21d2; <code>KeyGenerator</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L11-L13'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='11' data-end='13'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='label'>hash_digest_class:</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_config'><a href="../Encryption.html#config-class_method" title="ActiveRecord::Encryption.config (method)">config</a></span>.<span class='id identifier rubyid_hash_digest_class'><a href="#hash_digest_class-instance_method" title="ActiveRecord::Encryption::KeyGenerator#hash_digest_class (method)">hash_digest_class</a></span>)
  <span class='ivar'>@hash_digest_class</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_digest_class'><a href="#hash_digest_class-instance_method" title="ActiveRecord::Encryption::KeyGenerator#hash_digest_class (method)">hash_digest_class</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="hash_digest_class-instance_method">
  <h3 class='signature ro first'>
    #<strong>hash_digest_class</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L9-L9'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='9' data-end='9'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 9</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_hash_digest_class'>hash_digest_class</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="derive_key_from-instance_method">
  <h3 class='signature  first'>
    #<strong>derive_key_from</strong>(password, length: key_length)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Derives a key from the given password. The key will have a size in bytes of <code>:length</code> (configured <a href="Cipher.html" title="ActiveRecord::Encryption::Cipher (class)"><code>Cipher</code></a>‘s length by default)</p>

<p>The generated key will be salted with the value of <code>ActiveRecord::Encryption.key_derivation_salt</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L38-L41'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='38' data-end='41'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 38</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_derive_key_from'>derive_key_from</span>(<span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='label'>length:</span> <span class='id identifier rubyid_key_length'><a href="#key_length-instance_method" title="ActiveRecord::Encryption::KeyGenerator#key_length (method)">key_length</a></span>)
  <span class='const'><a href="../../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveSupport/KeyGenerator.html" title="ActiveSupport::KeyGenerator (class)">KeyGenerator</a></span>.<span class='id identifier rubyid_new'><a href="../../ActiveSupport/KeyGenerator.html#new-class_method" title="ActiveSupport::KeyGenerator.new (method)">new</a></span>(<span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='label'>hash_digest_class:</span> <span class='id identifier rubyid_hash_digest_class'><a href="#hash_digest_class-instance_method" title="ActiveRecord::Encryption::KeyGenerator#hash_digest_class (method)">hash_digest_class</a></span>)
    .<span class='id identifier rubyid_generate_key'>generate_key</span>(<span class='id identifier rubyid_key_derivation_salt'><a href="#key_derivation_salt-instance_method" title="ActiveRecord::Encryption::KeyGenerator#key_derivation_salt (method)">key_derivation_salt</a></span><span class='comma'>,</span> <span class='id identifier rubyid_length'>length</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generate_random_hex_key-instance_method">
  <h3 class='signature '>
    #<strong>generate_random_hex_key</strong>(length: key_length)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a random key in hexadecimal format. The key will have a size in bytes of <code>:length</code> (configured <a href="Cipher.html" title="ActiveRecord::Encryption::Cipher (class)"><code>Cipher</code></a>‘s length by default)</p>

<p>Hexadecimal format is handy for representing keys as printable text. To maximize the space of characters used, it is good practice including not printable characters. Hexadecimal format ensures that generated keys are representable with plain text</p>

<p>To convert back to the original string with the desired length:</p>

<pre class="code ruby"><code class="ruby">[ <span class='id identifier rubyid_value'>value</span> ].<span class='id identifier rubyid_pack'>pack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>H*</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L30-L32'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='30' data-end='32'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 30</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_random_hex_key'>generate_random_hex_key</span>(<span class='label'>length:</span> <span class='id identifier rubyid_key_length'><a href="#key_length-instance_method" title="ActiveRecord::Encryption::KeyGenerator#key_length (method)">key_length</a></span>)
  <span class='id identifier rubyid_generate_random_key'><a href="#generate_random_key-instance_method" title="ActiveRecord::Encryption::KeyGenerator#generate_random_key (method)">generate_random_key</a></span>(<span class='label'>length:</span> <span class='id identifier rubyid_length'>length</span>).<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>H*</span><span class='tstring_end'>&quot;</span></span>)[<span class='int'>0</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generate_random_key-instance_method">
  <h3 class='signature '>
    #<strong>generate_random_key</strong>(length: key_length)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a random key. The key will have a size in bytes of <code>:length</code> (configured <a href="Cipher.html" title="ActiveRecord::Encryption::Cipher (class)"><code>Cipher</code></a>‘s length by default)</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L16-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='16' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 16</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_random_key'>generate_random_key</span>(<span class='label'>length:</span> <span class='id identifier rubyid_key_length'><a href="#key_length-instance_method" title="ActiveRecord::Encryption::KeyGenerator#key_length (method)">key_length</a></span>)
  <span class='const'><a href="../../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span>.<span class='id identifier rubyid_random_bytes'>random_bytes</span>(<span class='id identifier rubyid_length'>length</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="key_derivation_salt-instance_method">
  <h3 class='signature priv'>
    #<strong>key_derivation_salt</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L44-L46'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='44' data-end='46'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 44</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_key_derivation_salt'>key_derivation_salt</span>
  <span class='ivar'>@key_derivation_salt</span> <span class='op'>||=</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_config'><a href="../Encryption.html#config-class_method" title="ActiveRecord::Encryption.config (method)">config</a></span>.<span class='id identifier rubyid_key_derivation_salt'>key_derivation_salt</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="key_length-instance_method">
  <h3 class='signature priv'>
    #<strong>key_length</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/key_generator.rb#L48-L50'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='48' data-end='50'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/key_generator.rb', line 48</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_key_length'>key_length</span>
  <span class='ivar'>@key_length</span> <span class='op'>||=</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_cipher'>cipher</span>.<span class='id identifier rubyid_key_length'>key_length</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>