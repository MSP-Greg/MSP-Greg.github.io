<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Encryption::Encryptor &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Encryption::Encryptor",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails main</a> &raquo; 
      <a href='../../_index.html#alpha_E'>Index (E)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Encryptor&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveRecord::Encryption::Encryptor</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="EncryptingOnlyEncryptor.html" title="ActiveRecord::Encryption::EncryptingOnlyEncryptor (class)">EncryptingOnlyEncryptor</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L13'>activerecord/lib/active_record/encryption/encryptor.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>An encryptor exposes the encryption API that <a href="EncryptedAttributeType.html" title="ActiveRecord::Encryption::EncryptedAttributeType (class)"><code>EncryptedAttributeType</code></a> uses for encrypting and decrypting attribute values.</p>

<p>It interacts with a <a href="KeyProvider.html" title="ActiveRecord::Encryption::KeyProvider (class)"><code>KeyProvider</code></a> for getting the keys, and delegate to <a href="Cipher.html" title="ActiveRecord::Encryption::Cipher (class)"><code>Cipher</code></a> the actual encryption algorithm.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='DECRYPT_ERRORS-constant' class='summary_signature'>DECRYPT_ERRORS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L95-L95'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 95</a>    <pre class='code ruby'>[<span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'><a href="Cipher.html" title="ActiveRecord::Encryption::Cipher (class)">Cipher</a></span><span class='op'>::</span><span class='const'>CipherError</span><span class='comma'>,</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/EncryptedContentIntegrity.html" title="ActiveRecord::Encryption::Errors::EncryptedContentIntegrity (class)">EncryptedContentIntegrity</a></span><span class='comma'>,</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Decryption.html" title="ActiveRecord::Encryption::Errors::Decryption (class)">Decryption</a></span>]</pre>
  </li>
  <li>
    <span id='ENCODING_ERRORS-constant' class='summary_signature'>ENCODING_ERRORS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L96-L96'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 96</a>    <pre class='code ruby'>[<span class='const'>EncodingError</span><span class='comma'>,</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Encoding.html" title="ActiveRecord::Encryption::Errors::Encoding (class)">Encoding</a></span>]</pre>
  </li>
  <li>
    <span id='THRESHOLD_TO_JUSTIFY_COMPRESSION-constant' class='summary_signature'>THRESHOLD_TO_JUSTIFY_COMPRESSION =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>This threshold cannot be changed.</p>

<p>Users can search for attributes encrypted with <code>deterministic: true</code>. That is possible because we are able to generate the message for the given clear text deterministically, and with that perform a regular string lookup in SQL.</p>

<p>Problem is, messages may have a “c” header that is present or not depending on whether compression was applied on encryption. If this threshold was modified, the message generated for lookup could vary for the same clear text, and searches on exisiting data could fail.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L109-L109'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 109</a>    <pre class='code ruby'><span class='int'>140</span>.<span class='id identifier rubyid_bytes'>bytes</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(compress: true, compressor: nil)  &#x21d2; Encryptor </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Options.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#binary%3F-instance_method" title="#binary? (instance method)">#<strong>binary?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#compressor-instance_method" title="#compressor (instance method)">#<strong>compressor</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The compressor to use for compressing the payload.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#compress%3F-instance_method" title="#compress? (instance method)">#<strong>compress?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#decrypt-instance_method" title="#decrypt (instance method)">#<strong>decrypt</strong>(encrypted_text, key_provider: default_key_provider, cipher_options: {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Decrypts an <code>encrypted_text</code> and returns the result as clean text.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#encrypt-instance_method" title="#encrypt (instance method)">#<strong>encrypt</strong>(clear_text, key_provider: default_key_provider, cipher_options: {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Encrypts <code>clean_text</code> and returns the encrypted result.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#encrypted%3F-instance_method" title="#encrypted? (instance method)">#<strong>encrypted?</strong>(text)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether the text is encrypted or not.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_encrypted_message-instance_method" title="#build_encrypted_message (instance method)">#<strong>build_encrypted_message</strong>(clear_text, key_provider:, cipher_options:)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#cipher-instance_method" title="#cipher (instance method)">#<strong>cipher</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#compress-instance_method" title="#compress (instance method)">#<strong>compress</strong>(data)  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compress_if_worth_it-instance_method" title="#compress_if_worth_it (instance method)">#<strong>compress_if_worth_it</strong>(string)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Under certain threshold, ZIP compression is actually worse that not compressing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#default_key_provider-instance_method" title="#default_key_provider (instance method)">#<strong>default_key_provider</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#deserialize_message-instance_method" title="#deserialize_message (instance method)">#<strong>deserialize_message</strong>(message)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#force_encoding_if_needed-instance_method" title="#force_encoding_if_needed (instance method)">#<strong>force_encoding_if_needed</strong>(value)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#forced_encoding_for_deterministic_encryption-instance_method" title="#forced_encoding_for_deterministic_encryption (instance method)">#<strong>forced_encoding_for_deterministic_encryption</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#serialize_message-instance_method" title="#serialize_message (instance method)">#<strong>serialize_message</strong>(message)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#serializer-instance_method" title="#serializer (instance method)">#<strong>serializer</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#uncompress-instance_method" title="#uncompress (instance method)">#<strong>uncompress</strong>(data)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#uncompress_if_needed-instance_method" title="#uncompress_if_needed (instance method)">#<strong>uncompress_if_needed</strong>(data, compressed)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_payload_type-instance_method" title="#validate_payload_type (instance method)">#<strong>validate_payload_type</strong>(clear_text)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(compress: true, compressor: nil)  &#x21d2; <code>Encryptor</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:compress</code></dt>
<dd>
<p>Boolean indicating whether records should be compressed before encryption. Defaults to <code>true</code>.</p>
</dd><dt><code>:compressor</code></dt>
<dd>
<p>The compressor to use. It must respond to <code>deflate</code> and <code>inflate</code>. If not provided, will default to <code>ActiveRecord::Encryption.config.compressor</code>, which itself defaults to <code>Zlib</code>.</p>
</dd></dl>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L27-L30'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='27' data-end='30'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 27</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='label'>compress:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>compressor:</span> <span class='kw'>nil</span>)
  <span class='ivar'>@compress</span> <span class='op'>=</span> <span class='id identifier rubyid_compress'><a href="#compress-instance_method" title="ActiveRecord::Encryption::Encryptor#compress (method)">compress</a></span>
  <span class='ivar'>@compressor</span> <span class='op'>=</span> <span class='id identifier rubyid_compressor'><a href="#compressor-instance_method" title="ActiveRecord::Encryption::Encryptor#compressor (method)">compressor</a></span> <span class='op'>||</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_config'><a href="../Encryption.html#config-class_method" title="ActiveRecord::Encryption.config (method)">config</a></span>.<span class='id identifier rubyid_compressor'><a href="#compressor-instance_method" title="ActiveRecord::Encryption::Encryptor#compressor (method)">compressor</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="binary?-instance_method">
  <h3 class='signature ro first'>
    #<strong>binary?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L86-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='86' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 86</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_binary?'>binary?</span>
  <span class='id identifier rubyid_serializer'><a href="#serializer-instance_method" title="ActiveRecord::Encryption::Encryptor#serializer (method)">serializer</a></span>.<span class='id identifier rubyid_binary?'>binary?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compress?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>compress?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L90-L92'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='90' data-end='92'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 90</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compress?'>compress?</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@compress</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compressor-instance_method">
  <h3 class='signature ro'>
    #<strong>compressor</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The compressor to use for compressing the payload.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L15-L15'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='15' data-end='15'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 15</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_compressor'>compressor</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="build_encrypted_message-instance_method">
  <h3 class='signature priv first'>
    #<strong>build_encrypted_message</strong>(clear_text, key_provider:, cipher_options:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L125-L133'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='125' data-end='133'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 125</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_encrypted_message'>build_encrypted_message</span>(<span class='id identifier rubyid_clear_text'>clear_text</span><span class='comma'>,</span> <span class='label'>key_provider:</span><span class='comma'>,</span> <span class='label'>cipher_options:</span>)
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key_provider'>key_provider</span>.<span class='id identifier rubyid_encryption_key'>encryption_key</span>

  <span class='id identifier rubyid_clear_text'>clear_text</span><span class='comma'>,</span> <span class='id identifier rubyid_was_compressed'>was_compressed</span> <span class='op'>=</span> <span class='id identifier rubyid_compress_if_worth_it'><a href="#compress_if_worth_it-instance_method" title="ActiveRecord::Encryption::Encryptor#compress_if_worth_it (method)">compress_if_worth_it</a></span>(<span class='id identifier rubyid_clear_text'>clear_text</span>)
  <span class='id identifier rubyid_cipher'><a href="#cipher-instance_method" title="ActiveRecord::Encryption::Encryptor#cipher (method)">cipher</a></span>.<span class='id identifier rubyid_encrypt'><a href="#encrypt-instance_method" title="ActiveRecord::Encryption::Encryptor#encrypt (method)">encrypt</a></span>(<span class='id identifier rubyid_clear_text'>clear_text</span><span class='comma'>,</span> <span class='label'>key:</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_cipher_options'>cipher_options</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='op'>|</span>
    <span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_add'>add</span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_public_tags'>public_tags</span>)
    <span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_compressed'>compressed</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_was_compressed'>was_compressed</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cipher-instance_method">
  <h3 class='signature priv'>
    #<strong>cipher</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L121-L123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='121' data-end='123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 121</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cipher'>cipher</span>
  <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_cipher'>cipher</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compress-instance_method">
  <h3 class='signature ro priv'>
    #<strong>compress</strong>(data)   <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L158-L162'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='158' data-end='162'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 158</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compress'>compress</span>(<span class='id identifier rubyid_data'>data</span>)
  <span class='ivar'>@compressor</span>.<span class='id identifier rubyid_deflate'>deflate</span>(<span class='id identifier rubyid_data'>data</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_compressed_data'>compressed_data</span><span class='op'>|</span>
    <span class='id identifier rubyid_compressed_data'>compressed_data</span>.<span class='id identifier rubyid_force_encoding'>force_encoding</span>(<span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_encoding'>encoding</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compress_if_worth_it-instance_method">
  <h3 class='signature priv'>
    #<strong>compress_if_worth_it</strong>(string)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Under certain threshold, ZIP compression is actually worse that not compressing</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L150-L156'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='150' data-end='156'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 150</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compress_if_worth_it'>compress_if_worth_it</span>(<span class='id identifier rubyid_string'>string</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_compress?'><a href="#compress%3F-instance_method" title="ActiveRecord::Encryption::Encryptor#compress? (method)">compress?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_bytesize'>bytesize</span> <span class='op'>&gt;</span> <span class='const'><a href="#THRESHOLD_TO_JUSTIFY_COMPRESSION-constant" title="ActiveRecord::Encryption::Encryptor::THRESHOLD_TO_JUSTIFY_COMPRESSION (constant)">THRESHOLD_TO_JUSTIFY_COMPRESSION</a></span>
    [<span class='id identifier rubyid_compress'><a href="#compress-instance_method" title="ActiveRecord::Encryption::Encryptor#compress (method)">compress</a></span>(<span class='id identifier rubyid_string'>string</span>)<span class='comma'>,</span> <span class='kw'>true</span>]
  <span class='kw'>else</span>
    [<span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='kw'>false</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decrypt-instance_method">
  <h3 class='signature '>
    #<strong>decrypt</strong>(encrypted_text, key_provider: default_key_provider, cipher_options: {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Decrypts an <code>encrypted_text</code> and returns the result as clean text.</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:key_provider</code></dt>
<dd>
<p>Key provider to use for the encryption operation. It will default to <code>ActiveRecord::Encryption.key_provider</code> when not provided.</p>
</dd><dt><code>:cipher_options</code></dt>
<dd>
<p>Cipher-specific options that will be passed to the Cipher configured in <code>ActiveRecord::Encryption.cipher</code>.</p>
</dd></dl>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L69-L76'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='69' data-end='76'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 69</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt'>decrypt</span>(<span class='id identifier rubyid_encrypted_text'>encrypted_text</span><span class='comma'>,</span> <span class='label'>key_provider:</span> <span class='id identifier rubyid_default_key_provider'><a href="#default_key_provider-instance_method" title="ActiveRecord::Encryption::Encryptor#default_key_provider (method)">default_key_provider</a></span><span class='comma'>,</span> <span class='label'>cipher_options:</span> {})
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_deserialize_message'><a href="#deserialize_message-instance_method" title="ActiveRecord::Encryption::Encryptor#deserialize_message (method)">deserialize_message</a></span>(<span class='id identifier rubyid_encrypted_text'>encrypted_text</span>)
  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='id identifier rubyid_key_provider'>key_provider</span>.<span class='id identifier rubyid_decryption_keys'>decryption_keys</span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Decryption.html" title="ActiveRecord::Encryption::Errors::Decryption (class)">Decryption</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_present?'>present?</span>
  <span class='id identifier rubyid_uncompress_if_needed'><a href="#uncompress_if_needed-instance_method" title="ActiveRecord::Encryption::Encryptor#uncompress_if_needed (method)">uncompress_if_needed</a></span>(<span class='id identifier rubyid_cipher'><a href="#cipher-instance_method" title="ActiveRecord::Encryption::Encryptor#cipher (method)">cipher</a></span>.<span class='id identifier rubyid_decrypt'>decrypt</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>key:</span> <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_collect'>collect</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_secret'>secret</span>)<span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_cipher_options'>cipher_options</span>)<span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_compressed'>compressed</span>)
<span class='kw'>rescue</span> <span class='op'>*</span>(<span class='const'><a href="#ENCODING_ERRORS-constant" title="ActiveRecord::Encryption::Encryptor::ENCODING_ERRORS (constant)">ENCODING_ERRORS</a></span> <span class='op'>+</span> <span class='const'><a href="#DECRYPT_ERRORS-constant" title="ActiveRecord::Encryption::Encryptor::DECRYPT_ERRORS (constant)">DECRYPT_ERRORS</a></span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Decryption.html" title="ActiveRecord::Encryption::Errors::Decryption (class)">Decryption</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="default_key_provider-instance_method">
  <h3 class='signature priv'>
    #<strong>default_key_provider</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L111-L113'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='111' data-end='113'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_default_key_provider'>default_key_provider</span>
  <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_key_provider'>key_provider</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="deserialize_message-instance_method">
  <h3 class='signature priv'>
    #<strong>deserialize_message</strong>(message)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L139-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='139' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 139</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_deserialize_message'>deserialize_message</span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='id identifier rubyid_serializer'><a href="#serializer-instance_method" title="ActiveRecord::Encryption::Encryptor#serializer (method)">serializer</a></span>.<span class='id identifier rubyid_load'>load</span> <span class='id identifier rubyid_message'>message</span>
<span class='kw'>rescue</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/ForbiddenClass.html" title="ActiveRecord::Encryption::Errors::ForbiddenClass (class)">ForbiddenClass</a></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Encoding.html" title="ActiveRecord::Encryption::Errors::Encoding (class)">Encoding</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encrypt-instance_method">
  <h3 class='signature '>
    #<strong>encrypt</strong>(clear_text, key_provider: default_key_provider, cipher_options: {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Encrypts <code>clean_text</code> and returns the encrypted result.</p>

<p>Internally, it will:</p>
<ol><li>
<p>Create a new <a href="Message.html" title="ActiveRecord::Encryption::Message (class)"><code>Message</code></a>.</p>
</li><li>
<p>Compress and encrypt <code>clean_text</code> as the message payload.</p>
</li><li>
<p>Serialize it with <code>ActiveRecord::Encryption.message_serializer</code> (<code>ActiveRecord::Encryption::SafeMarshal</code> by default).</p>
</li><li>
<p>Encode the result with Base64.</p>
</li></ol>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:key_provider</code></dt>
<dd>
<p>Key provider to use for the encryption operation. It will default to <code>ActiveRecord::Encryption.key_provider</code> when not provided.</p>
</dd><dt><code>:cipher_options</code></dt>
<dd>
<p>Cipher-specific options that will be passed to the Cipher configured in <code>ActiveRecord::Encryption.cipher</code>.</p>
</dd></dl>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L51-L56'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='51' data-end='56'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 51</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encrypt'>encrypt</span>(<span class='id identifier rubyid_clear_text'>clear_text</span><span class='comma'>,</span> <span class='label'>key_provider:</span> <span class='id identifier rubyid_default_key_provider'><a href="#default_key_provider-instance_method" title="ActiveRecord::Encryption::Encryptor#default_key_provider (method)">default_key_provider</a></span><span class='comma'>,</span> <span class='label'>cipher_options:</span> {})
  <span class='id identifier rubyid_clear_text'>clear_text</span> <span class='op'>=</span> <span class='id identifier rubyid_force_encoding_if_needed'><a href="#force_encoding_if_needed-instance_method" title="ActiveRecord::Encryption::Encryptor#force_encoding_if_needed (method)">force_encoding_if_needed</a></span>(<span class='id identifier rubyid_clear_text'>clear_text</span>) <span class='kw'>if</span> <span class='id identifier rubyid_cipher_options'>cipher_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_deterministic'>deterministic</span>]

  <span class='id identifier rubyid_validate_payload_type'><a href="#validate_payload_type-instance_method" title="ActiveRecord::Encryption::Encryptor#validate_payload_type (method)">validate_payload_type</a></span>(<span class='id identifier rubyid_clear_text'>clear_text</span>)
  <span class='id identifier rubyid_serialize_message'><a href="#serialize_message-instance_method" title="ActiveRecord::Encryption::Encryptor#serialize_message (method)">serialize_message</a></span> <span class='id identifier rubyid_build_encrypted_message'><a href="#build_encrypted_message-instance_method" title="ActiveRecord::Encryption::Encryptor#build_encrypted_message (method)">build_encrypted_message</a></span>(<span class='id identifier rubyid_clear_text'>clear_text</span><span class='comma'>,</span> <span class='label'>key_provider:</span> <span class='id identifier rubyid_key_provider'>key_provider</span><span class='comma'>,</span> <span class='label'>cipher_options:</span> <span class='id identifier rubyid_cipher_options'>cipher_options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encrypted?-instance_method">
  <h3 class='signature '>
    #<strong>encrypted?</strong>(text)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether the text is encrypted or not.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L79-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='79' data-end='84'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 79</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encrypted?'>encrypted?</span>(<span class='id identifier rubyid_text'>text</span>)
  <span class='id identifier rubyid_deserialize_message'><a href="#deserialize_message-instance_method" title="ActiveRecord::Encryption::Encryptor#deserialize_message (method)">deserialize_message</a></span>(<span class='id identifier rubyid_text'>text</span>)
  <span class='kw'>true</span>
<span class='kw'>rescue</span> <span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/Encoding.html" title="ActiveRecord::Encryption::Errors::Encoding (class)">Encoding</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='const'><a href="#DECRYPT_ERRORS-constant" title="ActiveRecord::Encryption::Encryptor::DECRYPT_ERRORS (constant)">DECRYPT_ERRORS</a></span>
  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="force_encoding_if_needed-instance_method">
  <h3 class='signature priv'>
    #<strong>force_encoding_if_needed</strong>(value)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L178-L184'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='178' data-end='184'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 178</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_force_encoding_if_needed'>force_encoding_if_needed</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_forced_encoding_for_deterministic_encryption'><a href="#forced_encoding_for_deterministic_encryption-instance_method" title="ActiveRecord::Encryption::Encryptor#forced_encoding_for_deterministic_encryption (method)">forced_encoding_for_deterministic_encryption</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>!=</span> <span class='id identifier rubyid_forced_encoding_for_deterministic_encryption'><a href="#forced_encoding_for_deterministic_encryption-instance_method" title="ActiveRecord::Encryption::Encryptor#forced_encoding_for_deterministic_encryption (method)">forced_encoding_for_deterministic_encryption</a></span>
    <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_encode'>encode</span>(<span class='id identifier rubyid_forced_encoding_for_deterministic_encryption'><a href="#forced_encoding_for_deterministic_encryption-instance_method" title="ActiveRecord::Encryption::Encryptor#forced_encoding_for_deterministic_encryption (method)">forced_encoding_for_deterministic_encryption</a></span><span class='comma'>,</span> <span class='label'>invalid:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_replace'>replace</span><span class='comma'>,</span> <span class='label'>undef:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_replace'>replace</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="forced_encoding_for_deterministic_encryption-instance_method">
  <h3 class='signature priv'>
    #<strong>forced_encoding_for_deterministic_encryption</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L186-L188'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='186' data-end='188'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 186</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_forced_encoding_for_deterministic_encryption'>forced_encoding_for_deterministic_encryption</span>
  <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_config'><a href="../Encryption.html#config-class_method" title="ActiveRecord::Encryption.config (method)">config</a></span>.<span class='id identifier rubyid_forced_encoding_for_deterministic_encryption'>forced_encoding_for_deterministic_encryption</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="serialize_message-instance_method">
  <h3 class='signature priv'>
    #<strong>serialize_message</strong>(message)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L135-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='135' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_serialize_message'>serialize_message</span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='id identifier rubyid_serializer'><a href="#serializer-instance_method" title="ActiveRecord::Encryption::Encryptor#serializer (method)">serializer</a></span>.<span class='id identifier rubyid_dump'>dump</span>(<span class='id identifier rubyid_message'>message</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="serializer-instance_method">
  <h3 class='signature priv'>
    #<strong>serializer</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L145-L147'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='145' data-end='147'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 145</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_serializer'>serializer</span>
  <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span>.<span class='id identifier rubyid_message_serializer'>message_serializer</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uncompress-instance_method">
  <h3 class='signature priv'>
    #<strong>uncompress</strong>(data)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L172-L176'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='172' data-end='176'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 172</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uncompress'>uncompress</span>(<span class='id identifier rubyid_data'>data</span>)
  <span class='ivar'>@compressor</span>.<span class='id identifier rubyid_inflate'>inflate</span>(<span class='id identifier rubyid_data'>data</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_uncompressed_data'>uncompressed_data</span><span class='op'>|</span>
    <span class='id identifier rubyid_uncompressed_data'>uncompressed_data</span>.<span class='id identifier rubyid_force_encoding'>force_encoding</span>(<span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_encoding'>encoding</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uncompress_if_needed-instance_method">
  <h3 class='signature priv'>
    #<strong>uncompress_if_needed</strong>(data, compressed)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L164-L170'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='164' data-end='170'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 164</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uncompress_if_needed'>uncompress_if_needed</span>(<span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_compressed'>compressed</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_compressed'>compressed</span>
    <span class='id identifier rubyid_uncompress'><a href="#uncompress-instance_method" title="ActiveRecord::Encryption::Encryptor#uncompress (method)">uncompress</a></span>(<span class='id identifier rubyid_data'>data</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_data'>data</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_payload_type-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_payload_type</strong>(clear_text)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/encryptor.rb#L115-L119'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='115' data-end='119'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/encryption/encryptor.rb', line 115</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_payload_type'>validate_payload_type</span>(<span class='id identifier rubyid_clear_text'>clear_text</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_clear_text'>clear_text</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../String.html" title="String (class)">String</a></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span><span class='op'>::</span><span class='const'><a href="Errors.html" title="ActiveRecord::Encryption::Errors (module)">Errors</a></span><span class='op'>::</span><span class='const'><a href="Errors/ForbiddenClass.html" title="ActiveRecord::Encryption::Errors::ForbiddenClass (class)">ForbiddenClass</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The encryptor can only encrypt string values (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_clear_text'>clear_text</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>