<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::QueryMethods &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::QueryMethods",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_Q'>Index (Q)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>QueryMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::QueryMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a class='nodoc' href="QueryMethods/CTEJoin.html" title="ActiveRecord::QueryMethods::CTEJoin (class)"><code>CTEJoin</code></a>,
        <a href="QueryMethods/WhereChain.html" title="ActiveRecord::QueryMethods::WhereChain (class)"><code>WhereChain</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a class='nodoc' href="AssociationRelation.html" title="ActiveRecord::AssociationRelation (class)"><code>AssociationRelation</code></a>,
          <a href="Associations/CollectionProxy.html" title="ActiveRecord::Associations::CollectionProxy (class)"><code>Associations::CollectionProxy</code></a>,
          <a class='nodoc' href="DisableJoinsAssociationRelation.html" title="ActiveRecord::DisableJoinsAssociationRelation (class)"><code>DisableJoinsAssociationRelation</code></a>,
          <a href="Relation.html" title="ActiveRecord::Relation (class)"><code>Relation</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="../ActiveModel/ForbiddenAttributesProtection.html" title="ActiveModel::ForbiddenAttributesProtection (module)"><code>::ActiveModel::ForbiddenAttributesProtection</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L9'>activerecord/lib/active_record/relation/query_methods.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='FROZEN_EMPTY_ARRAY-constant' class='summary_signature'>FROZEN_EMPTY_ARRAY =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L159-L159'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 159</a>    <pre class='code ruby'>[].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='FROZEN_EMPTY_HASH-constant' class='summary_signature'>FROZEN_EMPTY_HASH =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L160-L160'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 160</a>    <pre class='code ruby'>{}.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='STRUCTURAL_VALUE_METHODS-constant' class='summary_signature nodoc'>STRUCTURAL_VALUE_METHODS =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2271-L2274'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2271</a>    <pre class='code ruby'>(
  <span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span><span class='op'>::</span><span class='const'><a href="Relation.html#VALUE_METHODS-constant" title="ActiveRecord::Relation::VALUE_METHODS (constant)">VALUE_METHODS</a></span> <span class='op'>-</span>
  [<span class='symbeg'>:</span><span class='id identifier rubyid_extending'><a href="#extending-instance_method" title="ActiveRecord::QueryMethods#extending (method)">extending</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_having'><a href="#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">having</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unscope'><a href="#unscope-instance_method" title="ActiveRecord::QueryMethods#unscope (method)">unscope</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_annotate'><a href="#annotate-instance_method" title="ActiveRecord::QueryMethods#annotate (method)">annotate</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optimizer_hints'><a href="#optimizer_hints-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints (method)">optimizer_hints</a></span>]
).<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='VALID_DIRECTIONS-constant' class='summary_signature nodoc'>VALID_DIRECTIONS =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2070-L2071'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2070</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_asc'>asc</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_desc'>desc</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>ASC</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>DESC</span><span class='comma'>,</span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>asc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>desc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ASC</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DESC</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_to_set'>to_set</span></pre>
  </li>
  <li>
    <span id='VALID_UNSCOPING_VALUES-constant' class='summary_signature'>VALID_UNSCOPING_VALUES =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L768-L771'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 768</a>    <pre class='code ruby'><span class='const'>Set</span>.<span class='id identifier rubyid_new'>new</span>([<span class='symbeg'>:</span><span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_group'><a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">group</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_lock'><a href="#lock-instance_method" title="ActiveRecord::QueryMethods#lock (method)">lock</a></span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="ActiveRecord::QueryMethods#limit (method)">limit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_offset'><a href="#offset-instance_method" title="ActiveRecord::QueryMethods#offset (method)">offset</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_outer_joins'><a href="#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">left_outer_joins</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_annotate'><a href="#annotate-instance_method" title="ActiveRecord::QueryMethods#annotate (method)">annotate</a></span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_includes'><a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">includes</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_eager_load'><a href="#eager_load-instance_method" title="ActiveRecord::QueryMethods#eager_load (method)">eager_load</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload'><a href="#preload-instance_method" title="ActiveRecord::QueryMethods#preload (method)">preload</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_readonly'><a href="#readonly-instance_method" title="ActiveRecord::QueryMethods#readonly (method)">readonly</a></span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_having'><a href="#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">having</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optimizer_hints'><a href="#optimizer_hints-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints (method)">optimizer_hints</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_with'><a href="#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">with</a></span>])</pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#null_relation%3F-instance_method" title="#null_relation? (instance method)">#<strong>null_relation?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#and-instance_method" title="#and (instance method)">#<strong>and</strong>(other)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a new relation, which is the logical intersection of this relation and the one passed as an argument.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#annotate-instance_method" title="#annotate (instance method)">#<strong>annotate</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Adds an SQL comment to queries generated from this relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_with-instance_method" title="#create_with (instance method)">#<strong>create_with</strong>(value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets attributes to be used when creating new records from a relation object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#distinct-instance_method" title="#distinct (instance method)">#<strong>distinct</strong>(value = true)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specifies whether the records should be unique or not.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#eager_load-instance_method" title="#eager_load (instance method)">#<strong>eager_load</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specify associations <code>args</code> to be eager loaded using a <code>LEFT OUTER JOIN</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#excluding-instance_method" title="#excluding (instance method)">#<strong>excluding</strong>(*records)  </a>
      (also: #without)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Excludes the specified record (or collection of records) from the resulting relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#extending-instance_method" title="#extending (instance method)">#<strong>extending</strong>(*modules, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Used to extend a scope with additional methods, either through a module or through a block provided.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#extensions-instance_method" title="#extensions (instance method)">#<strong>extensions</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#extract_associated-instance_method" title="#extract_associated (instance method)">#<strong>extract_associated</strong>(association)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Extracts a named <code>association</code> from the relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#from-instance_method" title="#from (instance method)">#<strong>from</strong>(value, subquery_name = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specifies the table from which the records will be fetched.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#group-instance_method" title="#group (instance method)">#<strong>group</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows to specify a group attribute:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#having-instance_method" title="#having (instance method)">#<strong>having</strong>(opts, *rest)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows to specify a HAVING clause.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#in_order_of-instance_method" title="#in_order_of (instance method)">#<strong>in_order_of</strong>(column, values, filter: true)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Applies an <code>ORDER BY</code> clause based on a given <code>column</code>, ordered and filtered by a specific set of <code>values</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#includes-instance_method" title="#includes (instance method)">#<strong>includes</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specify associations <code>args</code> to be eager loaded to prevent N + 1 queries.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#invert_where-instance_method" title="#invert_where (instance method)">#<strong>invert_where</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows you to invert an entire where clause instead of manually applying conditions.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#joins-instance_method" title="#joins (instance method)">#<strong>joins</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Performs JOINs on <code>args</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#left_joins-instance_method" title="#left_joins (instance method)">#<strong>left_joins</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">#left_outer_joins</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#left_outer_joins-instance_method" title="#left_outer_joins (instance method)">#<strong>left_outer_joins</strong>(*args)  </a>
      (also: #left_joins)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Performs LEFT OUTER JOINs on <code>args</code>:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#limit-instance_method" title="#limit (instance method)">#<strong>limit</strong>(value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specifies a limit for the number of records to retrieve.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#lock-instance_method" title="#lock (instance method)">#<strong>lock</strong>(locks = true)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specifies locking settings (default to <code>true</code>).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#none-instance_method" title="#none (instance method)">#<strong>none</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a chainable relation with zero records.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#offset-instance_method" title="#offset (instance method)">#<strong>offset</strong>(value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specifies the number of rows to skip before returning rows.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#optimizer_hints-instance_method" title="#optimizer_hints (instance method)">#<strong>optimizer_hints</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specify optimizer hints to be used in the SELECT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#or-instance_method" title="#or (instance method)">#<strong>or</strong>(other)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a new relation, which is the logical union of this relation and the one passed as an argument.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#order-instance_method" title="#order (instance method)">#<strong>order</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Applies an <code>ORDER BY</code> clause to a query.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#preload-instance_method" title="#preload (instance method)">#<strong>preload</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Specify associations <code>args</code> to be eager loaded using separate queries.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#readonly-instance_method" title="#readonly (instance method)">#<strong>readonly</strong>(value = true)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Mark a relation as readonly.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#references-instance_method" title="#references (instance method)">#<strong>references</strong>(*table_names)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Use to indicate that the given <code>table_names</code> are referenced by an SQL string, and should therefore be <code>JOIN</code>ed in any query rather than loaded separately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#regroup-instance_method" title="#regroup (instance method)">#<strong>regroup</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows you to change a previously set group statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reorder-instance_method" title="#reorder (instance method)">#<strong>reorder</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Replaces any existing order defined on the relation with the specified order.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reselect-instance_method" title="#reselect (instance method)">#<strong>reselect</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows you to change a previously set select statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reverse_order-instance_method" title="#reverse_order (instance method)">#<strong>reverse_order</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reverse the existing order clause on the relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#rewhere-instance_method" title="#rewhere (instance method)">#<strong>rewhere</strong>(conditions)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows you to change a previously set where condition for a given attribute, instead of appending to that condition.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#select-instance_method" title="#select (instance method)">#<strong>select</strong>(*fields)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Works in two unique ways.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#strict_loading-instance_method" title="#strict_loading (instance method)">#<strong>strict_loading</strong>(value = true)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the returned relation to strict_loading mode.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#structurally_compatible%3F-instance_method" title="#structurally_compatible? (instance method)">#<strong>structurally_compatible?</strong>(other)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks whether the given relation is structurally compatible with this relation, to determine if it’s possible to use the <a href="#and-instance_method" title="ActiveRecord::QueryMethods#and (method)">#and</a> and <a href="#or-instance_method" title="ActiveRecord::QueryMethods#or (method)">#or</a> methods without raising an error.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uniq!-instance_method" title="#uniq! (instance method)">#<strong>uniq!</strong>(name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deduplicate multiple values.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#unscope-instance_method" title="#unscope (instance method)">#<strong>unscope</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes an unwanted relation that is already defined on a chain of relations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#where-instance_method" title="#where (instance method)">#<strong>where</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a new relation, which is the result of filtering the current relation according to the conditions in the arguments.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add a Common Table Expression (CTE) that you can then reference within another SELECT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_recursive-instance_method" title="#with_recursive (instance method)">#<strong>with_recursive</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add a recursive Common Table Expression (CTE) that you can then reference within another SELECT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#without-instance_method" title="#without (instance method)">#<strong>without</strong>(*records)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#excluding-instance_method" title="ActiveRecord::QueryMethods#excluding (method)">#excluding</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature prot'>
      <a href="#build_having_clause-instance_method" title="#build_having_clause (instance method)">#<strong>build_having_clause</strong>(opts, rest = [])  </a>
    </span>
    <span class='note title protected'>protected</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#build_where_clause-instance_method" title="ActiveRecord::QueryMethods#build_where_clause (method)">#build_where_clause</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_reverse_order_columns-instance_method" title="#_reverse_order_columns (instance method)">#<strong>_reverse_order_columns</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#arel_column-instance_method" title="#arel_column (instance method)">#<strong>arel_column</strong>(field)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#arel_column_aliases_from_hash-instance_method" title="#arel_column_aliases_from_hash (instance method)">#<strong>arel_column_aliases_from_hash</strong>(fields)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#arel_column_with_table-instance_method" title="#arel_column_with_table (instance method)">#<strong>arel_column_with_table</strong>(table_name, column_name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#arel_columns_from_hash-instance_method" title="#arel_columns_from_hash (instance method)">#<strong>arel_columns_from_hash</strong>(fields)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#assert_modifiable!-instance_method" title="#assert_modifiable! (instance method)">#<strong>assert_modifiable!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#async-instance_method" title="#async (instance method)">#<strong>async</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_arel-instance_method" title="#build_arel (instance method)">#<strong>build_arel</strong>(aliases)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_bound_sql_literal-instance_method" title="#build_bound_sql_literal (instance method)">#<strong>build_bound_sql_literal</strong>(statement, values)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_case_for_value_position-instance_method" title="#build_case_for_value_position (instance method)">#<strong>build_case_for_value_position</strong>(column, values, filter: true)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_cast_value-instance_method" title="#build_cast_value (instance method)">#<strong>build_cast_value</strong>(name, value)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_from-instance_method" title="#build_from (instance method)">#<strong>build_from</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_join_buckets-instance_method" title="#build_join_buckets (instance method)">#<strong>build_join_buckets</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_join_dependencies-instance_method" title="#build_join_dependencies (instance method)">#<strong>build_join_dependencies</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_joins-instance_method" title="#build_joins (instance method)">#<strong>build_joins</strong>(join_sources, aliases = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_named_bound_sql_literal-instance_method" title="#build_named_bound_sql_literal (instance method)">#<strong>build_named_bound_sql_literal</strong>(statement, values)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_order-instance_method" title="#build_order (instance method)">#<strong>build_order</strong>(arel)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_select-instance_method" title="#build_select (instance method)">#<strong>build_select</strong>(arel)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_with-instance_method" title="#build_with (instance method)">#<strong>build_with</strong>(arel)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_with_expression_from_value-instance_method" title="#build_with_expression_from_value (instance method)">#<strong>build_with_expression_from_value</strong>(value, nested = false)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_with_join_node-instance_method" title="#build_with_join_node (instance method)">#<strong>build_with_join_node</strong>(name, kind = Arel::Nodes::InnerJoin)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_with_value_from_hash-instance_method" title="#build_with_value_from_hash (instance method)">#<strong>build_with_value_from_hash</strong>(hash)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#check_if_method_has_arguments!-instance_method" title="#check_if_method_has_arguments! (instance method)">#<strong>check_if_method_has_arguments!</strong>(method_name, args, message = nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks to make sure that the arguments are not blank.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#column_references-instance_method" title="#column_references (instance method)">#<strong>column_references</strong>(order_args)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#does_not_support_reverse%3F-instance_method" title="#does_not_support_reverse? (instance method)">#<strong>does_not_support_reverse?</strong>(order)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#each_join_dependencies-instance_method" title="#each_join_dependencies (instance method)">#<strong>each_join_dependencies</strong>(join_dependencies = build_join_dependencies, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#extract_table_name_from-instance_method" title="#extract_table_name_from (instance method)">#<strong>extract_table_name_from</strong>(string)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#flattened_args-instance_method" title="#flattened_args (instance method)">#<strong>flattened_args</strong>(args)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#lookup_table_klass_from_join_dependencies-instance_method" title="#lookup_table_klass_from_join_dependencies (instance method)">#<strong>lookup_table_klass_from_join_dependencies</strong>(table_name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#order_column-instance_method" title="#order_column (instance method)">#<strong>order_column</strong>(field)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#preprocess_order_args-instance_method" title="#preprocess_order_args (instance method)">#<strong>preprocess_order_args</strong>(order_args)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#process_select_args-instance_method" title="#process_select_args (instance method)">#<strong>process_select_args</strong>(fields)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#process_with_args-instance_method" title="#process_with_args (instance method)">#<strong>process_with_args</strong>(args)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#resolve_arel_attributes-instance_method" title="#resolve_arel_attributes (instance method)">#<strong>resolve_arel_attributes</strong>(attrs)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#reverse_sql_order-instance_method" title="#reverse_sql_order (instance method)">#<strong>reverse_sql_order</strong>(order_query)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#sanitize_order_arguments-instance_method" title="#sanitize_order_arguments (instance method)">#<strong>sanitize_order_arguments</strong>(order_args)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#select_association_list-instance_method" title="#select_association_list (instance method)">#<strong>select_association_list</strong>(associations, stashed_joins = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#select_named_joins-instance_method" title="#select_named_joins (instance method)">#<strong>select_named_joins</strong>(join_names, stashed_joins = nil, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#table_name_matches%3F-instance_method" title="#table_name_matches? (instance method)">#<strong>table_name_matches?</strong>(from)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_order_args-instance_method" title="#validate_order_args (instance method)">#<strong>validate_order_args</strong>(args)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_select!-instance_method" title="#_select! (instance method)">#<strong>_select!</strong>(*fields)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#all-instance_method" title="#all (instance method)">#<strong>all</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#and!-instance_method" title="#and! (instance method)">#<strong>and!</strong>(other)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#annotate!-instance_method" title="#annotate! (instance method)">#<strong>annotate!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#annotate-instance_method" title="ActiveRecord::QueryMethods#annotate (method)">#annotate</a>, but modifies relation in place.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#arel-instance_method" title="#arel (instance method)">#<strong>arel</strong>(aliases = nil)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the <a href="../Arel.html" title="Arel (module)"><code>::Arel</code></a> object associated with the relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#construct_join_dependency-instance_method" title="#construct_join_dependency (instance method)">#<strong>construct_join_dependency</strong>(associations, join_type)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#create_with!-instance_method" title="#create_with! (instance method)">#<strong>create_with!</strong>(value)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#distinct!-instance_method" title="#distinct! (instance method)">#<strong>distinct!</strong>(value = true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#distinct-instance_method" title="ActiveRecord::QueryMethods#distinct (method)">#distinct</a>, but modifies relation in place.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#eager_load!-instance_method" title="#eager_load! (instance method)">#<strong>eager_load!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#excluding!-instance_method" title="#excluding! (instance method)">#<strong>excluding!</strong>(records)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#extending!-instance_method" title="#extending! (instance method)">#<strong>extending!</strong>(*modules, &amp;block)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#from!-instance_method" title="#from! (instance method)">#<strong>from!</strong>(value, subquery_name = nil)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#group!-instance_method" title="#group! (instance method)">#<strong>group!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#having!-instance_method" title="#having! (instance method)">#<strong>having!</strong>(opts, *rest)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#includes!-instance_method" title="#includes! (instance method)">#<strong>includes!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#invert_where!-instance_method" title="#invert_where! (instance method)">#<strong>invert_where!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#joins!-instance_method" title="#joins! (instance method)">#<strong>joins!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#left_outer_joins!-instance_method" title="#left_outer_joins! (instance method)">#<strong>left_outer_joins!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#limit!-instance_method" title="#limit! (instance method)">#<strong>limit!</strong>(value)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#lock!-instance_method" title="#lock! (instance method)">#<strong>lock!</strong>(locks = true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#none!-instance_method" title="#none! (instance method)">#<strong>none!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#offset!-instance_method" title="#offset! (instance method)">#<strong>offset!</strong>(value)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#optimizer_hints!-instance_method" title="#optimizer_hints! (instance method)">#<strong>optimizer_hints!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#or!-instance_method" title="#or! (instance method)">#<strong>or!</strong>(other)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#order!-instance_method" title="#order! (instance method)">#<strong>order!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">#order</a> but operates on relation in-place instead of copying.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#preload!-instance_method" title="#preload! (instance method)">#<strong>preload!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#readonly!-instance_method" title="#readonly! (instance method)">#<strong>readonly!</strong>(value = true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#references!-instance_method" title="#references! (instance method)">#<strong>references!</strong>(*table_names)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#regroup!-instance_method" title="#regroup! (instance method)">#<strong>regroup!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#regroup-instance_method" title="ActiveRecord::QueryMethods#regroup (method)">#regroup</a> but operates on relation in-place instead of copying.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#reorder!-instance_method" title="#reorder! (instance method)">#<strong>reorder!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#reorder-instance_method" title="ActiveRecord::QueryMethods#reorder (method)">#reorder</a> but operates on relation in-place instead of copying.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#reselect!-instance_method" title="#reselect! (instance method)">#<strong>reselect!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#reselect-instance_method" title="ActiveRecord::QueryMethods#reselect (method)">#reselect</a> but operates on relation in-place instead of copying.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#reverse_order!-instance_method" title="#reverse_order! (instance method)">#<strong>reverse_order!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#skip_preloading!-instance_method" title="#skip_preloading! (instance method)">#<strong>skip_preloading!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#skip_query_cache!-instance_method" title="#skip_query_cache! (instance method)">#<strong>skip_query_cache!</strong>(value = true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#strict_loading!-instance_method" title="#strict_loading! (instance method)">#<strong>strict_loading!</strong>(value = true)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#unscope!-instance_method" title="#unscope! (instance method)">#<strong>unscope!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#where!-instance_method" title="#where! (instance method)">#<strong>where!</strong>(opts, *rest)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#with!-instance_method" title="#with! (instance method)">#<strong>with!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">#with</a>, but modifies relation in place.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#with_recursive!-instance_method" title="#with_recursive! (instance method)">#<strong>with_recursive!</strong>(*args)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#with_recursive-instance_method" title="ActiveRecord::QueryMethods#with_recursive (method)">#with_recursive</a> but modifies the relation in place.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature prot nodoc'>
      <a href="#arel_columns-instance_method" title="#arel_columns (instance method)">#<strong>arel_columns</strong>(columns)  </a>
    </span>
    <span class='note title protected'>protected</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature prot nodoc'>
      <a href="#async!-instance_method" title="#async! (instance method)">#<strong>async!</strong>  </a>
    </span>
    <span class='note title protected'>protected</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature prot nodoc'>
      <a href="#build_subquery-instance_method" title="#build_subquery (instance method)">#<strong>build_subquery</strong>(subquery_alias, select_value)  </a>
    </span>
    <span class='note title protected'>protected</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature prot nodoc'>
      <a href="#build_where_clause-instance_method" title="#build_where_clause (instance method)">#<strong>build_where_clause</strong>(opts, rest = [])  </a>
      (also: #build_having_clause)
    </span>
    <span class='note title protected'>protected</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#structurally_incompatible_values_for-instance_method" title="#structurally_incompatible_values_for (instance method)">#<strong>structurally_incompatible_values_for</strong>(other)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="../ActiveModel/ForbiddenAttributesProtection.html" title="ActiveModel::ForbiddenAttributesProtection (module)"><code>::ActiveModel::ForbiddenAttributesProtection</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="../ActiveModel/ForbiddenAttributesProtection.html#sanitize_for_mass_assignment-instance_method" title="ActiveModel::ForbiddenAttributesProtection#sanitize_for_mass_assignment (method)">#sanitize_for_mass_assignment</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../ActiveModel/ForbiddenAttributesProtection.html#sanitize_forbidden_attributes-instance_method" title="ActiveModel::ForbiddenAttributesProtection#sanitize_forbidden_attributes (method)">#sanitize_forbidden_attributes</a></td>
      <td><div class='inline'><p>Alias for <a href="../ActiveModel/ForbiddenAttributesProtection.html#sanitize_for_mass_assignment-instance_method" title="ActiveModel::ForbiddenAttributesProtection#sanitize_for_mass_assignment (method)">ActiveModel::ForbiddenAttributesProtection#sanitize_for_mass_assignment</a>.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="null_relation?-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>null_relation?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1294-L1296'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1294' data-end='1296'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1294</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_null_relation?'>null_relation?</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@none</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_reverse_order_columns-instance_method">
  <h3 class='signature priv first'>
    #<strong>_reverse_order_columns</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2047-L2052'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2047' data-end='2052'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2047</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__reverse_order_columns'>_reverse_order_columns</span>
  <span class='id identifier rubyid_roc'>roc</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_roc'>roc</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_implicit_order_column'>implicit_order_column</span> <span class='kw'>if</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_implicit_order_column'>implicit_order_column</span>
  <span class='id identifier rubyid_roc'>roc</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_primary_key'>primary_key</span> <span class='kw'>if</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>
  <span class='id identifier rubyid_roc'>roc</span>.<span class='id identifier rubyid_flatten'>flatten</span>.<span class='id identifier rubyid_uniq'>uniq</span>.<span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_select!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>_select!</strong>(*fields)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L428-L431'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='428' data-end='431'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 428</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__select!'>_select!</span>(<span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_select_values'>select_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_fields'>fields</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="all-instance_method">
  <h3 class='signature nodoc'>
    #<strong>all</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L260-L262'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='260' data-end='262'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_all'>all</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_spawn'>spawn</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and-instance_method">
  <h3 class='signature '>
    #<strong>and</strong>(other)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a new relation, which is the logical intersection of this relation and the one passed as an argument.</p>

<p>The two relations must be structurally compatible: they must be scoping the same model, and they must differ only by <a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">#where</a> (if no <a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a> has been defined) or <a href="#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">#having</a> (if a <a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a> is present).</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>id:</span> [<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span>]).<span class='id identifier rubyid_and'>and</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>id:</span> [<span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span>]))
<span class='comment'># SELECT {posts}.* FROM {posts} WHERE {posts}.`id` IN (1, 2) AND {posts}.`id` IN (2, 3)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1135-L1141'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1135' data-end='1141'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>and</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span>)
    <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_and!'><a href="#and!-instance_method" title="ActiveRecord::QueryMethods#and! (method)">and!</a></span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You have passed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> object to #and. Pass an ActiveRecord::Relation object instead.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>and!</strong>(other)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1143-L1155'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1143' data-end='1155'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1143</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and!'>and!</span>(<span class='id identifier rubyid_other'>other</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_incompatible_values'>incompatible_values</span> <span class='op'>=</span> <span class='id identifier rubyid_structurally_incompatible_values_for'><a href="#structurally_incompatible_values_for-instance_method" title="ActiveRecord::QueryMethods#structurally_incompatible_values_for (method)">structurally_incompatible_values_for</a></span>(<span class='id identifier rubyid_other'>other</span>)

  <span class='kw'>unless</span> <span class='id identifier rubyid_incompatible_values'>incompatible_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Relation passed to #and must be structurally compatible. Incompatible values: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_incompatible_values'>incompatible_values</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>|=</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_where_clause'>where_clause</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_having_clause'>having_clause</span> <span class='op'>|=</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_having_clause'>having_clause</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_references_values'>references_values</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="annotate-instance_method">
  <h3 class='signature '>
    #<strong>annotate</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Adds an SQL comment to queries generated from this relation. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_annotate'>annotate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>selecting user names</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
<span class='comment'># SELECT &quot;users&quot;.&quot;name&quot; FROM &quot;users&quot; /* selecting user names */
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_annotate'>annotate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>selecting</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
<span class='comment'># SELECT &quot;users&quot;.&quot;name&quot; FROM &quot;users&quot; /* selecting */ /* user */ /* names */</span></code></pre>

<p>The SQL block comment delimiters, “/*” and “*/”, will be added automatically.</p>

<p>Some escaping is performed, however untrusted user input should not be used.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1530-L1533'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1530' data-end='1533'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1530</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_annotate'>annotate</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_annotate!'><a href="#annotate!-instance_method" title="ActiveRecord::QueryMethods#annotate! (method)">annotate!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="annotate!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>annotate!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#annotate-instance_method" title="ActiveRecord::QueryMethods#annotate (method)">#annotate</a>, but modifies relation in place.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1536-L1539'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1536' data-end='1539'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1536</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_annotate!'>annotate!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_annotate_values'>annotate_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="arel-instance_method">
  <h3 class='signature nodoc'>
    #<strong>arel</strong>(aliases = nil)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the <a href="../Arel.html" title="Arel (module)"><code>::Arel</code></a> object associated with the relation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1595-L1597'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1595' data-end='1597'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1595</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_arel'>arel</span>(<span class='id identifier rubyid_aliases'>aliases</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :nodoc:
</span>  <span class='ivar'>@arel</span> <span class='op'>||=</span> <span class='id identifier rubyid_build_arel'><a href="#build_arel-instance_method" title="ActiveRecord::QueryMethods#build_arel (method)">build_arel</a></span>(<span class='id identifier rubyid_aliases'>aliases</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="arel_column-instance_method">
  <h3 class='signature priv'>
    #<strong>arel_column</strong>(field)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1985-L2004'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1985' data-end='2004'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1985</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_arel_column'>arel_column</span>(<span class='id identifier rubyid_field'>field</span>)
  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='id identifier rubyid_is_symbol'>is_symbol</span> <span class='op'>=</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>)

  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_attribute_aliases'>attribute_aliases</span>[<span class='id identifier rubyid_field'>field</span>] <span class='op'>||</span> <span class='id identifier rubyid_field'>field</span>
  <span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span> <span class='op'>=</span> <span class='id identifier rubyid_from_clause'>from_clause</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>||</span> <span class='id identifier rubyid_from_clause'>from_clause</span>.<span class='id identifier rubyid_value'>value</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_columns_hash'>columns_hash</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_field'>field</span>) <span class='op'>&amp;&amp;</span> (<span class='op'>!</span><span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span> <span class='op'>||</span> <span class='id identifier rubyid_table_name_matches?'><a href="#table_name_matches%3F-instance_method" title="ActiveRecord::QueryMethods#table_name_matches? (method)">table_name_matches?</a></span>(<span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span>))
    <span class='id identifier rubyid_table'>table</span>[<span class='id identifier rubyid_field'>field</span>]
  <span class='kw'>elsif</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?&lt;table&gt;(?:\w\.)?\w)\.(?&lt;column&gt;\w+)\z</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_field'>field</span>
    <span class='id identifier rubyid_arel_column_with_table'><a href="#arel_column_with_table-instance_method" title="ActiveRecord::QueryMethods#arel_column_with_table (method)">arel_column_with_table</a></span>(<span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_field'>field</span>
  <span class='kw'>elsif</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_arel_node?'><a href="../Arel.html#arel_node%3F-class_method" title="Arel.arel_node? (method)">arel_node?</a></span>(<span class='id identifier rubyid_field'>field</span>)
    <span class='id identifier rubyid_field'>field</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_is_symbol'>is_symbol</span>
    <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_quote_table_name'>quote_table_name</span>(<span class='id identifier rubyid_field'>field</span>)<span class='comma'>,</span> <span class='label'>retryable:</span> <span class='kw'>true</span>)
  <span class='kw'>else</span>
    <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_field'>field</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="arel_column_aliases_from_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>arel_column_aliases_from_hash</strong>(fields)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2244-L2262'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2244' data-end='2262'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_arel_column_aliases_from_hash'>arel_column_aliases_from_hash</span>(<span class='id identifier rubyid_fields'>fields</span>)
  <span class='id identifier rubyid_fields'>fields</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_columns_aliases'>columns_aliases</span><span class='op'>|</span>
    <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>) <span class='op'>?</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>:</span> <span class='id identifier rubyid_key'>key</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_columns_aliases'>columns_aliases</span>
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
      <span class='id identifier rubyid_columns_aliases'>columns_aliases</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_column_alias'>column_alias</span><span class='op'>|</span>
        <span class='id identifier rubyid_arel_column_with_table'><a href="#arel_column_with_table-instance_method" title="ActiveRecord::QueryMethods#arel_column_with_table (method)">arel_column_with_table</a></span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>)
          .<span class='id identifier rubyid_as'>as</span>(<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_quote_column_name'>quote_column_name</span>(<span class='id identifier rubyid_column_alias'>column_alias</span>.<span class='id identifier rubyid_to_s'>to_s</span>))
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>
      <span class='id identifier rubyid_columns_aliases'>columns_aliases</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span>
        <span class='id identifier rubyid_arel_column_with_table'><a href="#arel_column_with_table-instance_method" title="ActiveRecord::QueryMethods#arel_column_with_table (method)">arel_column_with_table</a></span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>)
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='comma'>,</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
      <span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span>(<span class='id identifier rubyid_key'>key</span>)
        .<span class='id identifier rubyid_as'>as</span>(<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_quote_column_name'>quote_column_name</span>(<span class='id identifier rubyid_columns_aliases'>columns_aliases</span>.<span class='id identifier rubyid_to_s'>to_s</span>))
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="arel_column_with_table-instance_method">
  <h3 class='signature priv'>
    #<strong>arel_column_with_table</strong>(table_name, column_name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1973-L1983'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1973' data-end='1983'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1973</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_arel_column_with_table'>arel_column_with_table</span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_column_name'>column_name</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> [<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='label'>retryable:</span> <span class='kw'>true</span>)]

  <span class='kw'>if</span> <span class='id identifier rubyid_column_name'>column_name</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>) <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_column_name'>column_name</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\W</span><span class='regexp_end'>/</span></span>)
    <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>.<span class='id identifier rubyid_resolve_arel_attribute'>resolve_arel_attribute</span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_column_name'>column_name</span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_lookup_table_klass_from_join_dependencies'><a href="#lookup_table_klass_from_join_dependencies-instance_method" title="ActiveRecord::QueryMethods#lookup_table_klass_from_join_dependencies (method)">lookup_table_klass_from_join_dependencies</a></span>(<span class='id identifier rubyid_table_name'>table_name</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_quote_table_name'>quote_table_name</span>(<span class='id identifier rubyid_table_name'>table_name</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_column_name'>column_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="arel_columns-instance_method">
  <h3 class='signature prot  nodoc'>
    #<strong>arel_columns</strong>(columns)   <span class="extras">(<span class='prot'>protected</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1662-L1675'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1662' data-end='1675'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1662</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_arel_columns'>arel_columns</span>(<span class='id identifier rubyid_columns'>columns</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_columns'>columns</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_field'>field</span>
    <span class='kw'>when</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span><span class='comma'>,</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span>
      <span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span>(<span class='id identifier rubyid_field'>field</span>)
    <span class='kw'>when</span> <span class='const'>Proc</span>
      <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_call'>call</span>
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
      <span class='id identifier rubyid_arel_columns_from_hash'><a href="#arel_columns_from_hash-instance_method" title="ActiveRecord::QueryMethods#arel_columns_from_hash (method)">arel_columns_from_hash</a></span>(<span class='id identifier rubyid_field'>field</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_field'>field</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="arel_columns_from_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>arel_columns_from_hash</strong>(fields)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1957-L1971'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1957' data-end='1971'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1957</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_arel_columns_from_hash'>arel_columns_from_hash</span>(<span class='id identifier rubyid_fields'>fields</span>)
  <span class='id identifier rubyid_fields'>fields</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='op'>|</span>
    <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='id identifier rubyid_table_name'>table_name</span>.<span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='id identifier rubyid_table_name'>table_name</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>)
    <span class='kw'>case</span> <span class='id identifier rubyid_columns'>columns</span>
    <span class='kw'>when</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span><span class='comma'>,</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span>
      <span class='id identifier rubyid_arel_column_with_table'><a href="#arel_column_with_table-instance_method" title="ActiveRecord::QueryMethods#arel_column_with_table (method)">arel_column_with_table</a></span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span>)
    <span class='kw'>when</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>
      <span class='id identifier rubyid_columns'>columns</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span>
        <span class='id identifier rubyid_arel_column_with_table'><a href="#arel_column_with_table-instance_method" title="ActiveRecord::QueryMethods#arel_column_with_table (method)">arel_column_with_table</a></span>(<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>)
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Expected Symbol, String or Array, got: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_columns'>columns</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="assert_modifiable!-instance_method">
  <h3 class='signature priv'>
    #<strong>assert_modifiable!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="UnmodifiableRelation.html" title="ActiveRecord::UnmodifiableRelation (class)">UnmodifiableRelation</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1746-L1748'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1746' data-end='1748'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1746</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assert_modifiable!'>assert_modifiable!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="UnmodifiableRelation.html" title="ActiveRecord::UnmodifiableRelation (class)">UnmodifiableRelation</a></span> <span class='kw'>if</span> <span class='ivar'>@loaded</span> <span class='op'>||</span> <span class='ivar'>@arel</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="async-instance_method">
  <h3 class='signature priv'>
    #<strong>async</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1678-L1680'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1678' data-end='1680'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1678</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_async'>async</span>
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_async!'><a href="#async!-instance_method" title="ActiveRecord::QueryMethods#async! (method)">async!</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="async!-instance_method">
  <h3 class='signature prot  nodoc'>
    #<strong>async!</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1657-L1660'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1657' data-end='1660'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1657</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_async!'>async!</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@async</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_arel-instance_method">
  <h3 class='signature priv'>
    #<strong>build_arel</strong>(aliases)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1750-L1772'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1750' data-end='1772'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1750</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_arel'>build_arel</span>(<span class='id identifier rubyid_aliases'>aliases</span>)
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span> <span class='op'>=</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/SelectManager.html" title="Arel::SelectManager (class)">SelectManager</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/SelectManager.html#new-class_method" title="Arel::SelectManager.new (method)">new</a></span>(<span class='id identifier rubyid_table'>table</span>)

  <span class='id identifier rubyid_build_joins'><a href="#build_joins-instance_method" title="ActiveRecord::QueryMethods#build_joins (method)">build_joins</a></span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_join_sources'>join_sources</span><span class='comma'>,</span> <span class='id identifier rubyid_aliases'>aliases</span>)

  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_ast'>ast</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_having'><a href="#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">having</a></span>(<span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_ast'>ast</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_take'>take</span>(<span class='id identifier rubyid_build_cast_value'><a href="#build_cast_value-instance_method" title="ActiveRecord::QueryMethods#build_cast_value (method)">build_cast_value</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LIMIT</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_limit_value'>limit_value</span>)) <span class='kw'>if</span> <span class='id identifier rubyid_limit_value'>limit_value</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_skip'>skip</span>(<span class='id identifier rubyid_build_cast_value'><a href="#build_cast_value-instance_method" title="ActiveRecord::QueryMethods#build_cast_value (method)">build_cast_value</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OFFSET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_offset_value'>offset_value</span>.<span class='id identifier rubyid_to_i'>to_i</span>)) <span class='kw'>if</span> <span class='id identifier rubyid_offset_value'>offset_value</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_group'><a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">group</a></span>(<span class='op'>*</span><span class='id identifier rubyid_arel_columns'><a href="#arel_columns-instance_method" title="ActiveRecord::QueryMethods#arel_columns (method)">arel_columns</a></span>(<span class='id identifier rubyid_group_values'>group_values</span>)) <span class='kw'>unless</span> <span class='id identifier rubyid_group_values'>group_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_build_order'><a href="#build_order-instance_method" title="ActiveRecord::QueryMethods#build_order (method)">build_order</a></span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>)
  <span class='id identifier rubyid_build_with'><a href="#build_with-instance_method" title="ActiveRecord::QueryMethods#build_with (method)">build_with</a></span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>)
  <span class='id identifier rubyid_build_select'><a href="#build_select-instance_method" title="ActiveRecord::QueryMethods#build_select (method)">build_select</a></span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>)

  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_optimizer_hints'><a href="#optimizer_hints-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints (method)">optimizer_hints</a></span>(<span class='op'>*</span><span class='id identifier rubyid_optimizer_hints_values'>optimizer_hints_values</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_optimizer_hints_values'>optimizer_hints_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='op'>*</span><span class='id identifier rubyid_annotate_values'>annotate_values</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_annotate_values'>annotate_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_distinct'><a href="#distinct-instance_method" title="ActiveRecord::QueryMethods#distinct (method)">distinct</a></span>(<span class='id identifier rubyid_distinct_value'>distinct_value</span>)
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span>(<span class='id identifier rubyid_build_from'><a href="#build_from-instance_method" title="ActiveRecord::QueryMethods#build_from (method)">build_from</a></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_from_clause'>from_clause</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_lock'><a href="#lock-instance_method" title="ActiveRecord::QueryMethods#lock (method)">lock</a></span>(<span class='id identifier rubyid_lock_value'>lock_value</span>) <span class='kw'>if</span> <span class='id identifier rubyid_lock_value'>lock_value</span>

  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_bound_sql_literal-instance_method">
  <h3 class='signature priv'>
    #<strong>build_bound_sql_literal</strong>(statement, values)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1702-L1720'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1702' data-end='1720'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1702</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_bound_sql_literal'>build_bound_sql_literal</span>(<span class='id identifier rubyid_statement'>statement</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span>)
  <span class='id identifier rubyid_bound_values'>bound_values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span> <span class='op'>===</span> <span class='id identifier rubyid_value'>value</span>
      <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_to_sql'>to_sql</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_map'>map</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_acts_like?'>acts_like?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span>)
      <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id_for_database'>id_for_database</span>) <span class='op'>?</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_id_for_database'>id_for_database</span> <span class='op'>:</span> <span class='id identifier rubyid_v'>v</span> }
      <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_values'>values</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_id_for_database'>id_for_database</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id_for_database'>id_for_database</span>)
      <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/BoundSqlLiteral.html" title="Arel::Nodes::BoundSqlLiteral (class)">BoundSqlLiteral</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/BoundSqlLiteral.html#new-class_method" title="Arel::Nodes::BoundSqlLiteral.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_statement'>statement</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_bound_values'>bound_values</span><span class='comma'>,</span> <span class='kw'>nil</span>)
  <span class='kw'>rescue</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/BindError.html" title="Arel::BindError (class)">BindError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="PreparedStatementInvalid.html" title="ActiveRecord::PreparedStatementInvalid (class)">PreparedStatementInvalid</a></span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_message'>message</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_case_for_value_position-instance_method">
  <h3 class='signature priv'>
    #<strong>build_case_for_value_position</strong>(column, values, filter: true)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2173-L2181'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2173' data-end='2181'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2173</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_case_for_value_position'>build_case_for_value_position</span>(<span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='label'>filter:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Case.html" title="Arel::Nodes::Case (class)">Case</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/Case.html#new-class_method" title="Arel::Nodes::Case.new (method)">new</a></span>
  <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_each'>each</span>.<span class='id identifier rubyid_with_index'>with_index</span>(<span class='int'>1</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span><span class='op'>|</span>
    <span class='id identifier rubyid_node'>node</span>.<span class='id identifier rubyid_when'>when</span>(<span class='id identifier rubyid_column'>column</span>.<span class='id identifier rubyid_eq'>eq</span>(<span class='id identifier rubyid_value'>value</span>)).<span class='id identifier rubyid_then'>then</span>(<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span>.<span class='id identifier rubyid_else'>else</span>(<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='int'>1</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_filter'>filter</span>
  <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Ascending.html" title="Arel::Nodes::Ascending (class)">Ascending</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/Unary.html#new-class_method" title="Arel::Nodes::Unary.new (method)">new</a></span>(<span class='id identifier rubyid_node'>node</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_cast_value-instance_method">
  <h3 class='signature priv'>
    #<strong>build_cast_value</strong>(name, value)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1774-L1776'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1774' data-end='1776'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1774</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_cast_value'>build_cast_value</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
  <span class='const'><a href="../ActiveModel.html" title="ActiveModel (module)">ActiveModel</a></span><span class='op'>::</span><span class='const'><a href="../ActiveModel/Attribute.html" title="ActiveModel::Attribute (class)">Attribute</a></span>.<span class='id identifier rubyid_with_cast_value'><a href="../ActiveModel/Attribute.html#with_cast_value-class_method" title="ActiveModel::Attribute.with_cast_value (method)">with_cast_value</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='const'><a href="Type.html" title="ActiveRecord::Type (module)">Type</a></span>.<span class='id identifier rubyid_default_value'><a href="Type.html#default_value-class_method" title="ActiveRecord::Type.default_value (method)">default_value</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_from-instance_method">
  <h3 class='signature priv'>
    #<strong>build_from</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1778-L1791'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1778' data-end='1791'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1778</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_from'>build_from</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_from_clause'>from_clause</span>.<span class='id identifier rubyid_value'>value</span>
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_from_clause'>from_clause</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>when</span> <span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_eager_loading?'>eager_loading?</span>
      <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_apply_join_dependency'>apply_join_dependency</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subquery</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_as'>as</span>(<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_having_clause-instance_method">
  <h3 class='signature prot'>
    #<strong>build_having_clause</strong>(opts, rest = [])   <span class="extras">(<span class='prot'>protected</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#build_where_clause-instance_method" title="ActiveRecord::QueryMethods#build_where_clause (method)">#build_where_clause</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1655-L1655'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1655' data-end='1655'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1655</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_build_having_clause'>build_having_clause</span> <span class='symbeg'>:</span><span class='id identifier rubyid_build_where_clause'><a href="#build_where_clause-instance_method" title="ActiveRecord::QueryMethods#build_where_clause (method)">build_where_clause</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_join_buckets-instance_method">
  <h3 class='signature priv'>
    #<strong>build_join_buckets</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1820-L1874'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1820' data-end='1874'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1820</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_join_buckets'>build_join_buckets</span>
  <span class='id identifier rubyid_buckets'>buckets</span> <span class='op'>=</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>.<span class='id identifier rubyid_new'>new</span> { <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span>[<span class='id identifier rubyid_k'>k</span>] <span class='op'>=</span> [] }

  <span class='kw'>unless</span> <span class='id identifier rubyid_left_outer_joins_values'>left_outer_joins_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span> <span class='op'>=</span> []
    <span class='id identifier rubyid_left_joins'><a href="#left_joins-instance_method" title="ActiveRecord::QueryMethods#left_joins (method)">left_joins</a></span> <span class='op'>=</span> <span class='id identifier rubyid_select_named_joins'><a href="#select_named_joins-instance_method" title="ActiveRecord::QueryMethods#select_named_joins (method)">select_named_joins</a></span>(<span class='id identifier rubyid_left_outer_joins_values'>left_outer_joins_values</span><span class='comma'>,</span> <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_left_join'>left_join</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_left_join'>left_join</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="QueryMethods/CTEJoin.html" title="ActiveRecord::QueryMethods::CTEJoin (class)">CTEJoin</a></span>)
        <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_join_node'>join_node</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_build_with_join_node'><a href="#build_with_join_node-instance_method" title="ActiveRecord::QueryMethods#build_with_join_node (method)">build_with_join_node</a></span>(<span class='id identifier rubyid_left_join'>left_join</span>.<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/OuterJoin.html" title="Arel::Nodes::OuterJoin (class)">OuterJoin</a></span>)
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>only Hash, Symbol and Array are allowed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_joins_values'>joins_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_named_join'>named_join</span>] <span class='op'>=</span> <span class='id identifier rubyid_left_joins'><a href="#left_joins-instance_method" title="ActiveRecord::QueryMethods#left_joins (method)">left_joins</a></span>
      <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_stashed_join'>stashed_join</span>] <span class='op'>=</span> <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_buckets'>buckets</span><span class='comma'>,</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/OuterJoin.html" title="Arel::Nodes::OuterJoin (class)">OuterJoin</a></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span>.<span class='id identifier rubyid_unshift'>unshift</span> <span class='id identifier rubyid_construct_join_dependency'><a href="#construct_join_dependency-instance_method" title="ActiveRecord::QueryMethods#construct_join_dependency (method)">construct_join_dependency</a></span>(<span class='id identifier rubyid_left_joins'><a href="#left_joins-instance_method" title="ActiveRecord::QueryMethods#left_joins (method)">left_joins</a></span><span class='comma'>,</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/OuterJoin.html" title="Arel::Nodes::OuterJoin (class)">OuterJoin</a></span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span> <span class='op'>=</span> <span class='id identifier rubyid_joins_values'>joins_values</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/JoinDependency.html" title="ActiveRecord::Associations::JoinDependency (class)">JoinDependency</a></span>)
    <span class='id identifier rubyid_stashed_eager_load'>stashed_eager_load</span> <span class='op'>=</span> <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>.<span class='id identifier rubyid_pop'>pop</span> <span class='kw'>if</span> <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_base_klass'>base_klass</span> <span class='op'>==</span> <span class='id identifier rubyid_model'>model</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_join'>join</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>[<span class='id identifier rubyid_i'>i</span>] <span class='op'>=</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/StringJoin.html" title="Arel::Nodes::StringJoin (class)">StringJoin</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/StringJoin.html#new-class_method" title="Arel::Nodes::StringJoin.new (method)">new</a></span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_strip'>strip</span>)) <span class='kw'>if</span> <span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../String.html" title="String (class)">String</a></span>)
  <span class='kw'>end</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'>Join</span>)
    <span class='id identifier rubyid_join_node'>join_node</span> <span class='op'>=</span> <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>.<span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_join_node'>join_node</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/LeadingJoin.html" title="Arel::Nodes::LeadingJoin (class)">LeadingJoin</a></span>) <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_stashed_eager_load'>stashed_eager_load</span> <span class='op'>||</span> <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span>)
      <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_join_node'>join_node</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_join_node'>join_node</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_leading_join'>leading_join</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_join_node'>join_node</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_named_join'>named_join</span>] <span class='op'>=</span> <span class='id identifier rubyid_select_named_joins'><a href="#select_named_joins-instance_method" title="ActiveRecord::QueryMethods#select_named_joins (method)">select_named_joins</a></span>(<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span><span class='comma'>,</span> <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_stashed_join'>stashed_join</span>]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_join'>join</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'>Join</span>)
      <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_join_node'>join_node</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_join'>join</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="QueryMethods/CTEJoin.html" title="ActiveRecord::QueryMethods::CTEJoin (class)">CTEJoin</a></span>)
      <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_join_node'>join_node</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_build_with_join_node'><a href="#build_with_join_node-instance_method" title="ActiveRecord::QueryMethods#build_with_join_node (method)">build_with_join_node</a></span>(<span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_name'>name</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown class: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_stashed_join'>stashed_join</span>].<span class='id identifier rubyid_concat'>concat</span> <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span> <span class='kw'>if</span> <span class='id identifier rubyid_stashed_left_joins'>stashed_left_joins</span>
  <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_stashed_join'>stashed_join</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_stashed_eager_load'>stashed_eager_load</span> <span class='kw'>if</span> <span class='id identifier rubyid_stashed_eager_load'>stashed_eager_load</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_buckets'>buckets</span><span class='comma'>,</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/InnerJoin.html" title="Arel::Nodes::InnerJoin (class)">InnerJoin</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_join_dependencies-instance_method">
  <h3 class='signature priv'>
    #<strong>build_join_dependencies</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1735-L1744'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1735' data-end='1744'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1735</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_join_dependencies'>build_join_dependencies</span>
  <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span> <span class='op'>=</span> <span class='id identifier rubyid_joins_values'>joins_values</span> <span class='op'>|</span> <span class='id identifier rubyid_left_outer_joins_values'>left_outer_joins_values</span>
  <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span> <span class='op'>|=</span> <span class='id identifier rubyid_eager_load_values'>eager_load_values</span> <span class='kw'>unless</span> <span class='id identifier rubyid_eager_load_values'>eager_load_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span> <span class='op'>|=</span> <span class='id identifier rubyid_includes_values'>includes_values</span> <span class='kw'>unless</span> <span class='id identifier rubyid_includes_values'>includes_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_join_dependencies'>join_dependencies</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_join_dependencies'>join_dependencies</span>.<span class='id identifier rubyid_unshift'>unshift</span> <span class='id identifier rubyid_construct_join_dependency'><a href="#construct_join_dependency-instance_method" title="ActiveRecord::QueryMethods#construct_join_dependency (method)">construct_join_dependency</a></span>(
    <span class='id identifier rubyid_select_named_joins'><a href="#select_named_joins-instance_method" title="ActiveRecord::QueryMethods#select_named_joins (method)">select_named_joins</a></span>(<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span><span class='comma'>,</span> <span class='id identifier rubyid_join_dependencies'>join_dependencies</span>)<span class='comma'>,</span> <span class='kw'>nil</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_joins-instance_method">
  <h3 class='signature priv'>
    #<strong>build_joins</strong>(join_sources, aliases = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1876-L1896'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1876' data-end='1896'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1876</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_joins'>build_joins</span>(<span class='id identifier rubyid_join_sources'>join_sources</span><span class='comma'>,</span> <span class='id identifier rubyid_aliases'>aliases</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_join_sources'>join_sources</span> <span class='kw'>if</span> <span class='id identifier rubyid_joins_values'>joins_values</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_left_outer_joins_values'>left_outer_joins_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_buckets'>buckets</span><span class='comma'>,</span> <span class='id identifier rubyid_join_type'>join_type</span> <span class='op'>=</span> <span class='id identifier rubyid_build_join_buckets'><a href="#build_join_buckets-instance_method" title="ActiveRecord::QueryMethods#build_join_buckets (method)">build_join_buckets</a></span>

  <span class='id identifier rubyid_named_joins'>named_joins</span>   <span class='op'>=</span> <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_named_join'>named_join</span>]
  <span class='id identifier rubyid_stashed_joins'>stashed_joins</span> <span class='op'>=</span> <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_stashed_join'>stashed_join</span>]
  <span class='id identifier rubyid_leading_joins'>leading_joins</span> <span class='op'>=</span> <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_leading_join'>leading_join</span>]
  <span class='id identifier rubyid_join_nodes'>join_nodes</span>    <span class='op'>=</span> <span class='id identifier rubyid_buckets'>buckets</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_join_node'>join_node</span>]

  <span class='id identifier rubyid_join_sources'>join_sources</span>.<span class='id identifier rubyid_concat'>concat</span>(<span class='id identifier rubyid_leading_joins'>leading_joins</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_leading_joins'>leading_joins</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_named_joins'>named_joins</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_stashed_joins'>stashed_joins</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_alias_tracker'>alias_tracker</span> <span class='op'>=</span> <span class='id identifier rubyid_alias_tracker'>alias_tracker</span>(<span class='id identifier rubyid_leading_joins'>leading_joins</span> <span class='op'>+</span> <span class='id identifier rubyid_join_nodes'>join_nodes</span><span class='comma'>,</span> <span class='id identifier rubyid_aliases'>aliases</span>)
    <span class='id identifier rubyid_join_dependency'>join_dependency</span> <span class='op'>=</span> <span class='id identifier rubyid_construct_join_dependency'><a href="#construct_join_dependency-instance_method" title="ActiveRecord::QueryMethods#construct_join_dependency (method)">construct_join_dependency</a></span>(<span class='id identifier rubyid_named_joins'>named_joins</span><span class='comma'>,</span> <span class='id identifier rubyid_join_type'>join_type</span>)
    <span class='id identifier rubyid_join_sources'>join_sources</span>.<span class='id identifier rubyid_concat'>concat</span>(<span class='id identifier rubyid_join_dependency'>join_dependency</span>.<span class='id identifier rubyid_join_constraints'>join_constraints</span>(<span class='id identifier rubyid_stashed_joins'>stashed_joins</span><span class='comma'>,</span> <span class='id identifier rubyid_alias_tracker'>alias_tracker</span><span class='comma'>,</span> <span class='id identifier rubyid_references_values'>references_values</span>))
  <span class='kw'>end</span>

  <span class='id identifier rubyid_join_sources'>join_sources</span>.<span class='id identifier rubyid_concat'>concat</span>(<span class='id identifier rubyid_join_nodes'>join_nodes</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_join_nodes'>join_nodes</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_join_sources'>join_sources</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_named_bound_sql_literal-instance_method">
  <h3 class='signature priv'>
    #<strong>build_named_bound_sql_literal</strong>(statement, values)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1682-L1700'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1682' data-end='1700'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1682</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_named_bound_sql_literal'>build_named_bound_sql_literal</span>(<span class='id identifier rubyid_statement'>statement</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span>)
  <span class='id identifier rubyid_bound_values'>bound_values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_transform_values'>transform_values</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span> <span class='op'>===</span> <span class='id identifier rubyid_value'>value</span>
      <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_to_sql'>to_sql</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_map'>map</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_acts_like?'>acts_like?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span>)
      <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id_for_database'>id_for_database</span>) <span class='op'>?</span> <span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_id_for_database'>id_for_database</span> <span class='op'>:</span> <span class='id identifier rubyid_v'>v</span> }
      <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_values'>values</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_id_for_database'>id_for_database</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id_for_database'>id_for_database</span>)
      <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/BoundSqlLiteral.html" title="Arel::Nodes::BoundSqlLiteral (class)">BoundSqlLiteral</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/BoundSqlLiteral.html#new-class_method" title="Arel::Nodes::BoundSqlLiteral.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_statement'>statement</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_bound_values'>bound_values</span>)
  <span class='kw'>rescue</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/BindError.html" title="Arel::BindError (class)">BindError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'>error</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="PreparedStatementInvalid.html" title="ActiveRecord::PreparedStatementInvalid (class)">PreparedStatementInvalid</a></span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_message'>message</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_order-instance_method">
  <h3 class='signature priv'>
    #<strong>build_order</strong>(arel)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2065-L2068'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2065' data-end='2068'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2065</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_order'>build_order</span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>)
  <span class='id identifier rubyid_orders'>orders</span> <span class='op'>=</span> <span class='id identifier rubyid_order_values'>order_values</span>.<span class='id identifier rubyid_compact_blank'>compact_blank</span>
  <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='op'>*</span><span class='id identifier rubyid_orders'>orders</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_orders'>orders</span>.<span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_select-instance_method">
  <h3 class='signature priv'>
    #<strong>build_select</strong>(arel)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1898-L1906'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1898' data-end='1906'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1898</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_select'>build_select</span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_select_values'>select_values</span>.<span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_project'>project</span>(<span class='op'>*</span><span class='id identifier rubyid_arel_columns'><a href="#arel_columns-instance_method" title="ActiveRecord::QueryMethods#arel_columns (method)">arel_columns</a></span>(<span class='id identifier rubyid_select_values'>select_values</span>))
  <span class='kw'>elsif</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_ignored_columns'>ignored_columns</span>.<span class='id identifier rubyid_any?'>any?</span> <span class='op'>||</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_enumerate_columns_in_select_statements'>enumerate_columns_in_select_statements</span>
    <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_project'>project</span>(<span class='op'>*</span><span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_column_names'>column_names</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span> <span class='id identifier rubyid_table'>table</span>[<span class='id identifier rubyid_field'>field</span>] })
  <span class='kw'>else</span>
    <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_project'>project</span>(<span class='id identifier rubyid_table'>table</span>[<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_star'><a href="../Arel.html#star-class_method" title="Arel.star (method)">star</a></span>])
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_subquery-instance_method">
  <h3 class='signature prot  nodoc'>
    #<strong>build_subquery</strong>(subquery_alias, select_value)   <span class="extras">(<span class='prot'>protected</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1606-L1612'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1606' data-end='1612'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1606</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_subquery'>build_subquery</span>(<span class='id identifier rubyid_subquery_alias'>subquery_alias</span><span class='comma'>,</span> <span class='id identifier rubyid_select_value'>select_value</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_subquery'>subquery</span> <span class='op'>=</span> <span class='id identifier rubyid_except'>except</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_optimizer_hints'><a href="#optimizer_hints-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints (method)">optimizer_hints</a></span>).<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_as'>as</span>(<span class='id identifier rubyid_subquery_alias'>subquery_alias</span>)

  <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/SelectManager.html" title="Arel::SelectManager (class)">SelectManager</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/SelectManager.html#new-class_method" title="Arel::SelectManager.new (method)">new</a></span>(<span class='id identifier rubyid_subquery'>subquery</span>).<span class='id identifier rubyid_project'><a href="../Arel/SelectManager.html#project-instance_method" title="Arel::SelectManager#project (method)">project</a></span>(<span class='id identifier rubyid_select_value'>select_value</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span><span class='op'>|</span>
    <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_optimizer_hints'><a href="#optimizer_hints-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints (method)">optimizer_hints</a></span>(<span class='op'>*</span><span class='id identifier rubyid_optimizer_hints_values'>optimizer_hints_values</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_optimizer_hints_values'>optimizer_hints_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_where_clause-instance_method">
  <h3 class='signature prot  nodoc'>
    #<strong>build_where_clause</strong>(opts, rest = [])   <span class="extras">(<span class='prot'>protected</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#build_having_clause</span></span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1614-L1654'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1614' data-end='1654'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1614</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_where_clause'>build_where_clause</span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> []) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_sanitize_forbidden_attributes'>sanitize_forbidden_attributes</span>(<span class='id identifier rubyid_opts'>opts</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_rest'>rest</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> [<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_opts'>opts</span>)]
    <span class='kw'>elsif</span> <span class='id identifier rubyid_rest'>rest</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>) <span class='op'>&amp;&amp;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:\w+</span><span class='regexp_end'>/</span></span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='id identifier rubyid_opts'>opts</span>)
      <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> [<span class='id identifier rubyid_build_named_bound_sql_literal'><a href="#build_named_bound_sql_literal-instance_method" title="ActiveRecord::QueryMethods#build_named_bound_sql_literal (method)">build_named_bound_sql_literal</a></span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span>.<span class='id identifier rubyid_first'>first</span>)]
    <span class='kw'>elsif</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> [<span class='id identifier rubyid_build_bound_sql_literal'><a href="#build_bound_sql_literal-instance_method" title="ActiveRecord::QueryMethods#build_bound_sql_literal (method)">build_bound_sql_literal</a></span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span>)]
    <span class='kw'>else</span>
      <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> [<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_sanitize_sql'>sanitize_sql</span>([<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span>]))]
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_transform_keys'>transform_keys</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
        <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_attribute_aliases'>attribute_aliases</span>[<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span>] <span class='op'>||</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span> }
      <span class='kw'>else</span>
        <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>
        <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_attribute_aliases'>attribute_aliases</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>||</span> <span class='id identifier rubyid_key'>key</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span> <span class='op'>=</span> <span class='const'><a href="PredicateBuilder.html" title="ActiveRecord::PredicateBuilder (class)">PredicateBuilder</a></span>.<span class='id identifier rubyid_references'><a href="PredicateBuilder.html#references-class_method" title="ActiveRecord::PredicateBuilder.references (method)">references</a></span>(<span class='id identifier rubyid_opts'>opts</span>)
    <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>.<span class='id identifier rubyid_build_from_hash'>build_from_hash</span>(<span class='id identifier rubyid_opts'>opts</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_table_name'>table_name</span><span class='op'>|</span>
      <span class='id identifier rubyid_lookup_table_klass_from_join_dependencies'><a href="#lookup_table_klass_from_join_dependencies-instance_method" title="ActiveRecord::QueryMethods#lookup_table_klass_from_join_dependencies (method)">lookup_table_klass_from_join_dependencies</a></span>(<span class='id identifier rubyid_table_name'>table_name</span>)
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Node.html" title="Arel::Nodes::Node (class)">Node</a></span>
    <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> [<span class='id identifier rubyid_opts'>opts</span>]
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported argument type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span><span class='op'>::</span><span class='const'><a href="Relation/WhereClause.html" title="ActiveRecord::Relation::WhereClause (class)">WhereClause</a></span>.<span class='id identifier rubyid_new'><a href="Relation/WhereClause.html#new-class_method" title="ActiveRecord::Relation::WhereClause.new (method)">new</a></span>(<span class='id identifier rubyid_parts'>parts</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_with-instance_method">
  <h3 class='signature priv'>
    #<strong>build_with</strong>(arel)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1908-L1916'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1908' data-end='1916'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1908</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_with'>build_with</span>(<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>)
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_with_values'>with_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_with_statements'>with_statements</span> <span class='op'>=</span> <span class='id identifier rubyid_with_values'>with_values</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_with_value'>with_value</span><span class='op'>|</span>
    <span class='id identifier rubyid_build_with_value_from_hash'><a href="#build_with_value_from_hash-instance_method" title="ActiveRecord::QueryMethods#build_with_value_from_hash (method)">build_with_value_from_hash</a></span>(<span class='id identifier rubyid_with_value'>with_value</span>)
  <span class='kw'>end</span>

  <span class='ivar'>@with_is_recursive</span> <span class='op'>?</span> <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_with'><a href="#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">with</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_recursive'>recursive</span><span class='comma'>,</span> <span class='id identifier rubyid_with_statements'>with_statements</span>) <span class='op'>:</span> <span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_with'><a href="#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">with</a></span>(<span class='id identifier rubyid_with_statements'>with_statements</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_with_expression_from_value-instance_method">
  <h3 class='signature priv'>
    #<strong>build_with_expression_from_value</strong>(value, nested = false)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1924-L1947'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1924' data-end='1947'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1924</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_with_expression_from_value'>build_with_expression_from_value</span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_nested'>nested</span> <span class='op'>=</span> <span class='kw'>false</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/SqlLiteral.html" title="Arel::Nodes::SqlLiteral (class)">SqlLiteral</a></span> <span class='kw'>then</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Grouping.html" title="Arel::Nodes::Grouping (class)">Grouping</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/Unary.html#new-class_method" title="Arel::Nodes::Unary.new (method)">new</a></span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>when</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_nested'>nested</span>
      <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>.<span class='id identifier rubyid_ast'>ast</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_arel'><a href="#arel-instance_method" title="ActiveRecord::QueryMethods#arel (method)">arel</a></span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/SelectManager.html" title="Arel::SelectManager (class)">SelectManager</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>when</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_build_with_expression_from_value'>build_with_expression_from_value</span>(<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='kw'>false</span>) <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>

    <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
      <span class='id identifier rubyid_build_with_expression_from_value'>build_with_expression_from_value</span>(<span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='kw'>true</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_parts'>parts</span>.<span class='id identifier rubyid_reduce'>reduce</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
      <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'>UnionAll</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported argument type: `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>` </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_with_join_node-instance_method">
  <h3 class='signature priv'>
    #<strong>build_with_join_node</strong>(name, kind = Arel::Nodes::InnerJoin)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1949-L1955'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1949' data-end='1955'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1949</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_with_join_node'>build_with_join_node</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_kind'>kind</span> <span class='op'>=</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/InnerJoin.html" title="Arel::Nodes::InnerJoin (class)">InnerJoin</a></span>)
  <span class='id identifier rubyid_with_table'>with_table</span> <span class='op'>=</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Table.html" title="Arel::Table (class)">Table</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Table.html#new-class_method" title="Arel::Table.new (method)">new</a></span>(<span class='id identifier rubyid_name'>name</span>)

  <span class='id identifier rubyid_table'>table</span>.<span class='id identifier rubyid_join'>join</span>(<span class='id identifier rubyid_with_table'>with_table</span><span class='comma'>,</span> <span class='id identifier rubyid_kind'>kind</span>).<span class='id identifier rubyid_on'>on</span>(
    <span class='id identifier rubyid_with_table'>with_table</span>[<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_model_name'>model_name</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_foreign_key'>foreign_key</span>].<span class='id identifier rubyid_eq'>eq</span>(<span class='id identifier rubyid_table'>table</span>[<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>])
  ).<span class='id identifier rubyid_join_sources'>join_sources</span>.<span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_with_value_from_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>build_with_value_from_hash</strong>(hash)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1918-L1922'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1918' data-end='1922'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1918</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_with_value_from_hash'>build_with_value_from_hash</span>(<span class='id identifier rubyid_hash'>hash</span>)
  <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/TableAlias.html" title="Arel::Nodes::TableAlias (class)">TableAlias</a></span>.<span class='id identifier rubyid_new'><a href="../Arel/Nodes/Binary.html#new-class_method" title="Arel::Nodes::Binary.new (method)">new</a></span>(<span class='id identifier rubyid_build_with_expression_from_value'><a href="#build_with_expression_from_value-instance_method" title="ActiveRecord::QueryMethods#build_with_expression_from_value (method)">build_with_expression_from_value</a></span>(<span class='id identifier rubyid_value'>value</span>)<span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_if_method_has_arguments!-instance_method">
  <h3 class='signature priv'>
    #<strong>check_if_method_has_arguments!</strong>(method_name, args, message = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks to make sure that the arguments are not blank. Note that if some blank-like object were initially passed into the query method, then this method will not raise an error.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span>()   <span class='comment'># raises an error
</span><span class='const'>Post</span>.<span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span>([]) <span class='comment'># does not raise an error</span></code></pre>

<p>This particular method should be called with a method_name (__callee__) and the args passed into that method as an input. For example:</p>

<p>def references(*args)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_check_if_method_has_arguments!'>check_if_method_has_arguments!</span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
<span class='comment'>#...</span></code></pre>

<p>end</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2223-L2232'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2223' data-end='2232'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2223</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_if_method_has_arguments!'>check_if_method_has_arguments!</span>(<span class='id identifier rubyid_method_name'>method_name</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The method .</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_name'>method_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>() must contain arguments.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_args'>args</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_flatten!'>flatten!</span>
    <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_compact_blank!'>compact_blank!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="column_references-instance_method">
  <h3 class='signature priv'>
    #<strong>column_references</strong>(order_args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2134-L2157'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2134' data-end='2157'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2134</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_column_references'>column_references</span>(<span class='id identifier rubyid_order_args'>order_args</span>)
  <span class='id identifier rubyid_order_args'>order_args</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_arg'>arg</span>
    <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='comma'>,</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
      <span class='id identifier rubyid_extract_table_name_from'><a href="#extract_table_name_from-instance_method" title="ActiveRecord::QueryMethods#extract_table_name_from (method)">extract_table_name_from</a></span>(<span class='id identifier rubyid_arg'>arg</span>)
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
      <span class='id identifier rubyid_arg'>arg</span>
        .<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
          <span class='kw'>case</span> <span class='id identifier rubyid_value'>value</span>
          <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
            <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_extract_table_name_from'><a href="#extract_table_name_from-instance_method" title="ActiveRecord::QueryMethods#extract_table_name_from (method)">extract_table_name_from</a></span>(<span class='id identifier rubyid_key'>key</span>) <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../String.html" title="String (class)">String</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>)
          <span class='kw'>end</span>
        <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel.html#Attribute-constant" title="Arel::Attribute (constant)">Attribute</a></span>
      <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_relation'>relation</span>.<span class='id identifier rubyid_name'>name</span>
    <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Ordering.html" title="Arel::Nodes::Ordering (class)">Ordering</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_expr'>expr</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel.html#Attribute-constant" title="Arel::Attribute (constant)">Attribute</a></span>)
        <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_expr'>expr</span>.<span class='id identifier rubyid_relation'>relation</span>.<span class='id identifier rubyid_name'>name</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_filter_map'>filter_map</span> { <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_ref'>ref</span><span class='comma'>,</span> <span class='label'>retryable:</span> <span class='kw'>true</span>) <span class='kw'>if</span> <span class='id identifier rubyid_ref'>ref</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="construct_join_dependency-instance_method">
  <h3 class='signature nodoc'>
    #<strong>construct_join_dependency</strong>(associations, join_type)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1599-L1603'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1599' data-end='1603'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1599</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_construct_join_dependency'>construct_join_dependency</span>(<span class='id identifier rubyid_associations'>associations</span><span class='comma'>,</span> <span class='id identifier rubyid_join_type'>join_type</span>) <span class='comment'># :nodoc:
</span>  <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/JoinDependency.html" title="ActiveRecord::Associations::JoinDependency (class)">JoinDependency</a></span>.<span class='id identifier rubyid_new'><a href="Associations/JoinDependency.html#new-class_method" title="ActiveRecord::Associations::JoinDependency.new (method)">new</a></span>(
    <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_associations'>associations</span><span class='comma'>,</span> <span class='id identifier rubyid_join_type'>join_type</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_with-instance_method">
  <h3 class='signature '>
    #<strong>create_with</strong>(value)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets attributes to be used when creating new records from a relation object.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Oscar</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &#39;Oscar&#39;
</span>
<span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create_with'>create_with</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &#39;DHH&#39;</span></code></pre>

<p>You can pass <code>nil</code> to <code>#create_with</code> to reset attributes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create_with'>create_with</span>(<span class='kw'>nil</span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &#39;Oscar&#39;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1347-L1349'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1347' data-end='1349'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1347</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_with'>create_with</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_create_with!'><a href="#create_with!-instance_method" title="ActiveRecord::QueryMethods#create_with! (method)">create_with!</a></span>(<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_with!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>create_with!</strong>(value)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1351-L1360'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1351' data-end='1360'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1351</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_with!'>create_with!</span>(<span class='id identifier rubyid_value'>value</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_sanitize_forbidden_attributes'>sanitize_forbidden_attributes</span>(<span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>self</span>.<span class='id identifier rubyid_create_with_value'>create_with_value</span> <span class='op'>=</span> <span class='id identifier rubyid_create_with_value'>create_with_value</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>else</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_create_with_value'>create_with_value</span> <span class='op'>=</span> <span class='const'><a href="#FROZEN_EMPTY_HASH-constant" title="ActiveRecord::QueryMethods::FROZEN_EMPTY_HASH (constant)">FROZEN_EMPTY_HASH</a></span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="distinct-instance_method">
  <h3 class='signature '>
    #<strong>distinct</strong>(value = true)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specifies whether the records should be unique or not. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
<span class='comment'># Might return two records with the same name
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>).<span class='id identifier rubyid_distinct'>distinct</span>
<span class='comment'># Returns 1 record per distinct name
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>).<span class='id identifier rubyid_distinct'>distinct</span>.<span class='id identifier rubyid_distinct'>distinct</span>(<span class='kw'>false</span>)
<span class='comment'># You can also remove the uniqueness</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1411-L1413'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1411' data-end='1413'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1411</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_distinct'>distinct</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_distinct!'><a href="#distinct!-instance_method" title="ActiveRecord::QueryMethods#distinct! (method)">distinct!</a></span>(<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="distinct!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>distinct!</strong>(value = true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#distinct-instance_method" title="ActiveRecord::QueryMethods#distinct (method)">#distinct</a>, but modifies relation in place.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1416-L1419'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1416' data-end='1419'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1416</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_distinct!'>distinct!</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_distinct_value'>distinct_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="does_not_support_reverse?-instance_method">
  <h3 class='signature priv'>
    #<strong>does_not_support_reverse?</strong>(order)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2054-L2063'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2054' data-end='2063'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2054</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_does_not_support_reverse?'>does_not_support_reverse?</span>(<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>)
  <span class='comment'># Account for String subclasses like Arel::Nodes::SqlLiteral that
</span>  <span class='comment'># override methods like #count.
</span>  <span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span> <span class='op'>=</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>.<span class='id identifier rubyid_instance_of?'>instance_of?</span>(<span class='const'><a href="../String.html" title="String (class)">String</a></span>)

  <span class='comment'># Uses SQL function with multiple arguments.
</span>  (<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_find'>find</span> { <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='op'>|</span> <span class='id identifier rubyid_section'>section</span>.<span class='id identifier rubyid_count'>count</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>!=</span> <span class='id identifier rubyid_section'>section</span>.<span class='id identifier rubyid_count'>count</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>) }) <span class='op'>||</span>
    <span class='comment'># Uses &quot;nulls first&quot; like construction.
</span>    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\bnulls\s+(?:first|last)\b</span><span class='regexp_end'>/i</span></span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each_join_dependencies-instance_method">
  <h3 class='signature priv'>
    #<strong>each_join_dependencies</strong>(join_dependencies = build_join_dependencies, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1729-L1733'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1729' data-end='1733'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1729</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_each_join_dependencies'>each_join_dependencies</span>(<span class='id identifier rubyid_join_dependencies'>join_dependencies</span> <span class='op'>=</span> <span class='id identifier rubyid_build_join_dependencies'><a href="#build_join_dependencies-instance_method" title="ActiveRecord::QueryMethods#build_join_dependencies (method)">build_join_dependencies</a></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_join_dependencies'>join_dependencies</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_join_dependency'>join_dependency</span><span class='op'>|</span>
    <span class='id identifier rubyid_join_dependency'>join_dependency</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="eager_load-instance_method">
  <h3 class='signature '>
    #<strong>eager_load</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specify associations <code>args</code> to be eager loaded using a <code>LEFT OUTER JOIN</code>. Performs a single query joining all specified associations. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_eager_load'>eager_load</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="ActiveRecord::QueryMethods#limit (method)">limit</a></span>(<span class='int'>5</span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
  <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_city'>city</span>
<span class='kw'>end</span>

<span class='comment'># SELECT &quot;users&quot;.&quot;id&quot; AS t0_r0, &quot;users&quot;.&quot;name&quot; AS t0_r1, ... FROM &quot;users&quot;
</span><span class='comment'>#   LEFT OUTER JOIN &quot;addresses&quot; ON &quot;addresses&quot;.&quot;id&quot; = &quot;users&quot;.&quot;address_id&quot;
</span><span class='comment'>#   LIMIT 5</span></code></pre>

<p>Instead of loading the 5 addresses with 5 separate queries, all addresses are loaded with a single joined query.</p>

<p>Loading multiple and nested associations is possible using Hashes and Arrays, similar to <a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">#includes</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_eager_load'>eager_load</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='label'>friends:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_followers'>followers</span>])
<span class='comment'># SELECT &quot;users&quot;.&quot;id&quot; AS t0_r0, &quot;users&quot;.&quot;name&quot; AS t0_r1, ... FROM &quot;users&quot;
</span><span class='comment'>#   LEFT OUTER JOIN &quot;addresses&quot; ON &quot;addresses&quot;.&quot;id&quot; = &quot;users&quot;.&quot;address_id&quot;
</span><span class='comment'>#   LEFT OUTER JOIN &quot;friends&quot; ON &quot;friends&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;
</span><span class='comment'>#   ...</span></code></pre>

<p>NOTE: Loading the associations in a join can result in many rows that contain redundant data and it performs poorly at scale.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L290-L293'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='290' data-end='293'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 290</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_eager_load'>eager_load</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_eager_load!'><a href="#eager_load!-instance_method" title="ActiveRecord::QueryMethods#eager_load! (method)">eager_load!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="eager_load!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>eager_load!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L295-L298'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='295' data-end='298'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 295</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_eager_load!'>eager_load!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_eager_load_values'>eager_load_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="excluding-instance_method">
  <h3 class='signature '>
    #<strong>excluding</strong>(*records)  
    <span class='aliases'>Also known as: <span class='names'>#without</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Excludes the specified record (or collection of records) from the resulting relation. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_excluding'>excluding</span>(<span class='id identifier rubyid_post'>post</span>)
<span class='comment'># SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;id&quot; != 1
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_excluding'>excluding</span>(<span class='id identifier rubyid_post_one'>post_one</span><span class='comma'>,</span> <span class='id identifier rubyid_post_two'>post_two</span>)
<span class='comment'># SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;id&quot; NOT IN (1, 2)
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_excluding'>excluding</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_drafts'>drafts</span>)
<span class='comment'># SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;id&quot; NOT IN (3, 4, 5)</span></code></pre>

<p>This can also be called on associations. As with the above example, either a single record of collection thereof may be specified:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='const'>Comment</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>2</span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_excluding'>excluding</span>(<span class='id identifier rubyid_comment'>comment</span>)
<span class='comment'># SELECT &quot;comments&quot;.* FROM &quot;comments&quot; WHERE &quot;comments&quot;.&quot;post_id&quot; = 1 AND &quot;comments&quot;.&quot;id&quot; != 2</span></code></pre>

<p>This is short-hand for <code>.where.not(id: post.id)</code> and <code>.where.not(id: [post_one.id, post_two.id])</code>.</p>

<p>An <code>ArgumentError</code> will be raised if either no records are specified, or if any of the records in the collection (if a collection is passed in) are not instances of the same model that the relation is scoping.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1575-L1585'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1575' data-end='1585'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1575</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_excluding'>excluding</span>(<span class='op'>*</span><span class='id identifier rubyid_records'>records</span>)
  <span class='id identifier rubyid_relations'>relations</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_extract!'>extract!</span> { <span class='op'>|</span><span class='id identifier rubyid_element'>element</span><span class='op'>|</span> <span class='id identifier rubyid_element'>element</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span>) }
  <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_flatten!'>flatten!</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_compact!'>compact!</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_all?'>all?</span>(<span class='id identifier rubyid_model'>model</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_relations'>relations</span>.<span class='id identifier rubyid_all?'>all?</span> { <span class='op'>|</span><span class='id identifier rubyid_relation'>relation</span><span class='op'>|</span> <span class='id identifier rubyid_relation'>relation</span>.<span class='id identifier rubyid_model'>model</span> <span class='op'>==</span> <span class='id identifier rubyid_model'>model</span> }
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must only pass a single or collection of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> objects to #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___callee__'>__callee__</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_excluding!'><a href="#excluding!-instance_method" title="ActiveRecord::QueryMethods#excluding! (method)">excluding!</a></span>(<span class='id identifier rubyid_records'>records</span> <span class='op'>+</span> <span class='id identifier rubyid_relations'>relations</span>.<span class='id identifier rubyid_flat_map'>flat_map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_ids'>ids</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="excluding!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>excluding!</strong>(records)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1588-L1592'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1588' data-end='1592'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1588</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_excluding!'>excluding!</span>(<span class='id identifier rubyid_records'>records</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_predicates'>predicates</span> <span class='op'>=</span> [ <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>[<span class='id identifier rubyid_primary_key'>primary_key</span><span class='comma'>,</span> <span class='id identifier rubyid_records'>records</span>].<span class='id identifier rubyid_invert'>invert</span> ]
  <span class='kw'>self</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>+=</span> <span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span><span class='op'>::</span><span class='const'><a href="Relation/WhereClause.html" title="ActiveRecord::Relation::WhereClause (class)">WhereClause</a></span>.<span class='id identifier rubyid_new'><a href="Relation/WhereClause.html#new-class_method" title="ActiveRecord::Relation::WhereClause.new (method)">new</a></span>(<span class='id identifier rubyid_predicates'>predicates</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extending-instance_method">
  <h3 class='signature '>
    #<strong>extending</strong>(*modules, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Used to extend a scope with additional methods, either through a module or through a block provided.</p>

<p>The object returned is a relation, which can be further extended.</p>

<h4 id="label-Using+a+Module">Using a Module</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>Pagination</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_page'>page</span>(<span class='id identifier rubyid_number'>number</span>)
    <span class='comment'># pagination code goes here
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='const'>Model</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span>.<span class='id identifier rubyid_extending'>extending</span>(<span class='const'>Pagination</span>)
<span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_page'>page</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_page'>page</span>])</code></pre>

<p>You can also pass a list of modules:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='const'>Model</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span>.<span class='id identifier rubyid_extending'>extending</span>(<span class='const'>Pagination</span><span class='comma'>,</span> <span class='const'>SomethingElse</span>)</code></pre>

<h4 id="label-Using+a+Block">Using a Block</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='const'>Model</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span>.<span class='id identifier rubyid_extending'>extending</span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_page'>page</span>(<span class='id identifier rubyid_number'>number</span>)
    <span class='comment'># pagination code goes here
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_page'>page</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_page'>page</span>])</code></pre>

<p>You can also use a block and a module list:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='const'>Model</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span>.<span class='id identifier rubyid_extending'>extending</span>(<span class='const'>Pagination</span>) <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_per_page'>per_page</span>(<span class='id identifier rubyid_number'>number</span>)
    <span class='comment'># pagination code goes here
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1457-L1463'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1457' data-end='1463'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1457</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extending'>extending</span>(<span class='op'>*</span><span class='id identifier rubyid_modules'>modules</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_modules'>modules</span>.<span class='id identifier rubyid_any?'>any?</span> <span class='op'>||</span> <span class='id identifier rubyid_block'>block</span>
    <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_extending!'><a href="#extending!-instance_method" title="ActiveRecord::QueryMethods#extending! (method)">extending!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_modules'>modules</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>else</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extending!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>extending!</strong>(*modules, &amp;block)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1465-L1473'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1465' data-end='1473'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1465</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extending!'>extending!</span>(<span class='op'>*</span><span class='id identifier rubyid_modules'>modules</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_modules'>modules</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="../Module.html" title="Module (class)">Module</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_modules'>modules</span>.<span class='id identifier rubyid_flatten!'>flatten!</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_extending_values'>extending_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_modules'>modules</span>
  <span class='id identifier rubyid_extend'>extend</span>(<span class='op'>*</span><span class='id identifier rubyid_extending_values'>extending_values</span>) <span class='kw'>if</span> <span class='id identifier rubyid_extending_values'>extending_values</span>.<span class='id identifier rubyid_any?'>any?</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extensions-instance_method">
  <h3 class='signature '>
    #<strong>extensions</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L185-L185'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='185' data-end='185'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 185</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='id identifier rubyid_extending_values'>extending_values</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extract_associated-instance_method">
  <h3 class='signature '>
    #<strong>extract_associated</strong>(association)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Extracts a named <code>association</code> from the relation. The named association is first preloaded, then the individual association records are collected from the relation. Like so:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_memberships'>memberships</span>.<span class='id identifier rubyid_extract_associated'>extract_associated</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>)
<span class='comment'># =&gt; Returns collection of User records</span></code></pre>

<p>This is short-hand for:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_memberships'>memberships</span>.<span class='id identifier rubyid_preload'><a href="#preload-instance_method" title="ActiveRecord::QueryMethods#preload (method)">preload</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>).<span class='id identifier rubyid_collect'>collect</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L341-L343'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='341' data-end='343'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 341</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_associated'>extract_associated</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='id identifier rubyid_preload'><a href="#preload-instance_method" title="ActiveRecord::QueryMethods#preload (method)">preload</a></span>(<span class='id identifier rubyid_association'>association</span>).<span class='id identifier rubyid_collect'>collect</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_association'>association</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extract_table_name_from-instance_method">
  <h3 class='signature priv'>
    #<strong>extract_table_name_from</strong>(string)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2159-L2161'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2159' data-end='2161'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2159</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_table_name_from'>extract_table_name_from</span>(<span class='id identifier rubyid_string'>string</span>)
  <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_match'>match</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\W?(\w+)\W?\.</span><span class='regexp_end'>/</span></span>) <span class='op'>&amp;&amp;</span> <span class='backref'>$1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="flattened_args-instance_method">
  <h3 class='signature priv'>
    #<strong>flattened_args</strong>(args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2087-L2089'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2087' data-end='2089'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2087</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_flattened_args'>flattened_args</span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> { <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> (<span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)) <span class='op'>?</span> <span class='id identifier rubyid_flattened_args'>flattened_args</span>(<span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_to_a'>to_a</span>) <span class='op'>:</span> <span class='id identifier rubyid_e'>e</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="from-instance_method">
  <h3 class='signature '>
    #<strong>from</strong>(value, subquery_name = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specifies the table from which the records will be fetched. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_from'>from</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>posts</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># SELECT title FROM posts</span></code></pre>

<p>Can accept other relation objects. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_from'>from</span>(<span class='const'>Topic</span>.<span class='id identifier rubyid_approved'>approved</span>)
<span class='comment'># SELECT title FROM (SELECT * FROM topics WHERE approved = &#39;t&#39;) subquery</span></code></pre>

<p>Passing a second argument (string or symbol), creates the alias for the SQL from clause. Otherwise the alias “subquery” is used:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a.title</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_from'>from</span>(<span class='const'>Topic</span>.<span class='id identifier rubyid_approved'>approved</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_a'>a</span>)
<span class='comment'># SELECT a.title FROM (SELECT * FROM topics WHERE approved = &#39;t&#39;) a</span></code></pre>

<p>It does not add multiple arguments to the SQL from clause. The last <code>from</code> chained is the one used:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_from'>from</span>(<span class='const'>Topic</span>.<span class='id identifier rubyid_approved'>approved</span>).<span class='id identifier rubyid_from'>from</span>(<span class='const'>Topic</span>.<span class='id identifier rubyid_inactive'>inactive</span>)
<span class='comment'># SELECT title FROM (SELECT topics.* FROM topics WHERE topics.active = &#39;f&#39;) subquery</span></code></pre>

<p>For multiple arguments for the SQL from clause, you can pass a string with the exact elements in the SQL from list:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_color'>color</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>red</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Color</span>
  .<span class='id identifier rubyid_from'>from</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>colors c, JSONB_ARRAY_ELEMENTS(colored_things) AS colorvalues(colorvalue)</span><span class='tstring_end'>&quot;</span></span>)
  .<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>colorvalue-&gt;&gt;&#39;color&#39; = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_color'>color</span>)
  .<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c.*</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_to_a'>to_a</span>
<span class='comment'># SELECT c.*
</span><span class='comment'># FROM colors c, JSONB_ARRAY_ELEMENTS(colored_things) AS colorvalues(colorvalue)
</span><span class='comment'># WHERE (colorvalue-&gt;&gt;&#39;color&#39; = &#39;red&#39;)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1392-L1394'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1392' data-end='1394'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1392</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_from'>from</span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_subquery_name'>subquery_name</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_from!'><a href="#from!-instance_method" title="ActiveRecord::QueryMethods#from! (method)">from!</a></span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_subquery_name'>subquery_name</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="from!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>from!</strong>(value, subquery_name = nil)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1396-L1399'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1396' data-end='1399'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1396</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_from!'>from!</span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_subquery_name'>subquery_name</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_from_clause'>from_clause</span> <span class='op'>=</span> <span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span><span class='op'>::</span><span class='const'><a href="Relation/FromClause.html" title="ActiveRecord::Relation::FromClause (class)">FromClause</a></span>.<span class='id identifier rubyid_new'><a href="Relation/FromClause.html#new-class_method" title="ActiveRecord::Relation::FromClause.new (method)">new</a></span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_subquery_name'>subquery_name</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="group-instance_method">
  <h3 class='signature '>
    #<strong>group</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows to specify a group attribute:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_group'>group</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; GROUP BY name</span></code></pre>

<p>Returns an array with distinct records based on the <code>group</code> attribute:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>([<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>])
<span class='comment'># =&gt; [#&lt;User id: 1, name: &quot;Oscar&quot;&gt;, #&lt;User id: 2, name: &quot;Oscar&quot;&gt;, #&lt;User id: 3, name: &quot;Foo&quot;&gt;]
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_group'>group</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
<span class='comment'># =&gt; [#&lt;User id: 3, name: &quot;Foo&quot;, ...&gt;, #&lt;User id: 2, name: &quot;Oscar&quot;, ...&gt;]
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_group'>group</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name AS grouped_name, age</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;User id: 3, name: &quot;Foo&quot;, age: 21, ...&gt;, #&lt;User id: 2, name: &quot;Oscar&quot;, age: 21, ...&gt;, #&lt;User id: 5, name: &quot;Foo&quot;, age: 23, ...&gt;]</span></code></pre>

<p>Passing in an array of attributes to group by is also supported.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>([<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_name'>first_name</span>]).<span class='id identifier rubyid_group'>group</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_name'>first_name</span>).<span class='id identifier rubyid_first'>first</span>(<span class='int'>3</span>)
<span class='comment'># =&gt; [#&lt;User id: 1, first_name: &quot;Bill&quot;&gt;, #&lt;User id: 2, first_name: &quot;Earl&quot;&gt;, #&lt;User id: 3, first_name: &quot;Beto&quot;&gt;]</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L573-L576'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='573' data-end='576'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 573</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_group'>group</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_group!'><a href="#group!-instance_method" title="ActiveRecord::QueryMethods#group! (method)">group!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="group!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>group!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L578-L581'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='578' data-end='581'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 578</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_group!'>group!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_group_values'>group_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="having-instance_method">
  <h3 class='signature '>
    #<strong>having</strong>(opts, *rest)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows to specify a HAVING clause. Note that you can’t use HAVING without also specifying a GROUP clause.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Order</span>.<span class='id identifier rubyid_having'>having</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SUM(price) &gt; 30</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_group'><a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">group</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_id</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1197-L1199'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1197' data-end='1199'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1197</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_having'>having</span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span>)
  <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='kw'>self</span> <span class='op'>:</span> <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_having!'><a href="#having!-instance_method" title="ActiveRecord::QueryMethods#having! (method)">having!</a></span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="having!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>having!</strong>(opts, *rest)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1201-L1204'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1201' data-end='1204'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1201</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_having!'>having!</span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_having_clause'>having_clause</span> <span class='op'>+=</span> <span class='id identifier rubyid_build_having_clause'><a href="#build_having_clause-instance_method" title="ActiveRecord::QueryMethods#build_having_clause (method)">build_having_clause</a></span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="in_order_of-instance_method">
  <h3 class='signature '>
    #<strong>in_order_of</strong>(column, values, filter: true)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Applies an <code>ORDER BY</code> clause based on a given <code>column</code>, ordered and filtered by a specific set of <code>values</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_in_order_of'>in_order_of</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> [<span class='int'>1</span><span class='comma'>,</span> <span class='int'>5</span><span class='comma'>,</span> <span class='int'>3</span>])
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot;
</span><span class='comment'>#   WHERE &quot;users&quot;.&quot;id&quot; IN (1, 5, 3)
</span><span class='comment'>#   ORDER BY CASE
</span><span class='comment'>#     WHEN &quot;users&quot;.&quot;id&quot; = 1 THEN 1
</span><span class='comment'>#     WHEN &quot;users&quot;.&quot;id&quot; = 5 THEN 2
</span><span class='comment'>#     WHEN &quot;users&quot;.&quot;id&quot; = 3 THEN 3
</span><span class='comment'>#   END ASC</span></code></pre>

<p><code>column</code> can point to an enum column; the actual query generated may be different depending on the database adapter and the column definition.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Conversation</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_enum'>enum</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> [ <span class='symbeg'>:</span><span class='id identifier rubyid_active'>active</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_archived'>archived</span> ]
<span class='kw'>end</span>

<span class='const'>Conversation</span>.<span class='id identifier rubyid_in_order_of'>in_order_of</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_archived'>archived</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_active'>active</span>])
<span class='comment'># SELECT &quot;conversations&quot;.* FROM &quot;conversations&quot;
</span><span class='comment'>#   WHERE &quot;conversations&quot;.&quot;status&quot; IN (1, 0)
</span><span class='comment'>#   ORDER BY CASE
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; = 1 THEN 1
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; = 0 THEN 2
</span><span class='comment'>#   END ASC</span></code></pre>

<p><code>values</code> can also include <code>nil</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Conversation</span>.<span class='id identifier rubyid_in_order_of'>in_order_of</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> [<span class='kw'>nil</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_archived'>archived</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_active'>active</span>])
<span class='comment'># SELECT &quot;conversations&quot;.* FROM &quot;conversations&quot;
</span><span class='comment'>#   WHERE (&quot;conversations&quot;.&quot;status&quot; IN (1, 0) OR &quot;conversations&quot;.&quot;status&quot; IS NULL)
</span><span class='comment'>#   ORDER BY CASE
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; IS NULL THEN 1
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; = 1 THEN 2
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; = 0 THEN 3
</span><span class='comment'>#   END ASC</span></code></pre>

<p><code>filter</code> can be set to <code>false</code> to include all results instead of only the ones specified in <code>values</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Conversation</span>.<span class='id identifier rubyid_in_order_of'>in_order_of</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_archived'>archived</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_active'>active</span>]<span class='comma'>,</span> <span class='label'>filter:</span> <span class='kw'>false</span>)
<span class='comment'># SELECT &quot;conversations&quot;.* FROM &quot;conversations&quot;
</span><span class='comment'>#   ORDER BY CASE
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; = 1 THEN 1
</span><span class='comment'>#     WHEN &quot;conversations&quot;.&quot;status&quot; = 0 THEN 2
</span><span class='comment'>#     ELSE 3
</span><span class='comment'>#   END ASC</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L717-L741'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='717' data-end='741'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 717</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_in_order_of'>in_order_of</span>(<span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='label'>filter:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_disallow_raw_sql!'>disallow_raw_sql!</span>([<span class='id identifier rubyid_column'>column</span>]<span class='comma'>,</span> <span class='label'>permit:</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_column_name_with_order_matcher'>column_name_with_order_matcher</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_none!'><a href="#none!-instance_method" title="ActiveRecord::QueryMethods#none! (method)">none!</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span> <span class='op'>=</span> <span class='id identifier rubyid_column_references'><a href="#column_references-instance_method" title="ActiveRecord::QueryMethods#column_references (method)">column_references</a></span>([<span class='id identifier rubyid_column'>column</span>])
  <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_type_caster'>type_caster</span>.<span class='id identifier rubyid_type_cast_for_database'>type_cast_for_database</span>(<span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>) }
  <span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span> <span class='op'>=</span> <span class='id identifier rubyid_column'>column</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/SqlLiteral.html" title="Arel::Nodes::SqlLiteral (class)">SqlLiteral</a></span>) <span class='op'>?</span> <span class='id identifier rubyid_column'>column</span> <span class='op'>:</span> <span class='id identifier rubyid_order_column'><a href="#order_column-instance_method" title="ActiveRecord::QueryMethods#order_column (method)">order_column</a></span>(<span class='id identifier rubyid_column'>column</span>.<span class='id identifier rubyid_to_s'>to_s</span>)

  <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_order!'><a href="#order!-instance_method" title="ActiveRecord::QueryMethods#order! (method)">order!</a></span>(<span class='id identifier rubyid_build_case_for_value_position'><a href="#build_case_for_value_position-instance_method" title="ActiveRecord::QueryMethods#build_case_for_value_position (method)">build_case_for_value_position</a></span>(<span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='label'>filter:</span> <span class='id identifier rubyid_filter'>filter</span>))

  <span class='kw'>if</span> <span class='id identifier rubyid_filter'>filter</span>
    <span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>=</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='kw'>nil</span>)
        <span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span>.<span class='id identifier rubyid_in'>in</span>(<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_compact'>compact</span>).<span class='id identifier rubyid_or'><a href="#or-instance_method" title="ActiveRecord::QueryMethods#or (method)">or</a></span>(<span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span>.<span class='id identifier rubyid_eq'>eq</span>(<span class='kw'>nil</span>))
      <span class='kw'>else</span>
        <span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span>.<span class='id identifier rubyid_in'>in</span>(<span class='id identifier rubyid_values'>values</span>)
      <span class='kw'>end</span>

    <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_where!'><a href="#where!-instance_method" title="ActiveRecord::QueryMethods#where! (method)">where!</a></span>(<span class='id identifier rubyid_where_clause'>where_clause</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_scope'>scope</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="includes-instance_method">
  <h3 class='signature '>
    #<strong>includes</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specify associations <code>args</code> to be eager loaded to prevent N + 1 queries. A separate query is performed for each association, unless a join is required by conditions.</p>

<p>For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="ActiveRecord::QueryMethods#limit (method)">limit</a></span>(<span class='int'>5</span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
  <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_city'>city</span>
<span class='kw'>end</span>

<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; LIMIT 5
</span><span class='comment'># SELECT &quot;addresses&quot;.* FROM &quot;addresses&quot; WHERE &quot;addresses&quot;.&quot;id&quot; IN (1,2,3,4,5)</span></code></pre>

<p>Instead of loading the 5 addresses with 5 separate queries, all addresses are loaded with a single query.</p>

<p>Loading the associations in a separate query will often result in a performance improvement over a simple join, as a join can result in many rows that contain redundant data and it performs poorly at scale.</p>

<p>You can also specify multiple associations. Each association will result in an additional query:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_friends'>friends</span>).<span class='id identifier rubyid_to_a'>to_a</span>
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot;
</span><span class='comment'># SELECT &quot;addresses&quot;.* FROM &quot;addresses&quot; WHERE &quot;addresses&quot;.&quot;id&quot; IN (1,2,3,4,5)
</span><span class='comment'># SELECT &quot;friends&quot;.* FROM &quot;friends&quot; WHERE &quot;friends&quot;.&quot;user_id&quot; IN (1,2,3,4,5)</span></code></pre>

<p>Loading nested associations is possible using a <a href="../Hash.html" title="Hash (class)"><code>::Hash</code></a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='label'>friends:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_followers'>followers</span>])</code></pre>

<h4 id="label-Conditions">Conditions</h4>

<p>If you want to add string conditions to your included models, you’ll have to explicitly reference them. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>posts.name = ?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_to_a'>to_a</span></code></pre>

<p>Will throw an error, but this will work:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>posts.name = ?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_to_a'>to_a</span>
<span class='comment'># SELECT &quot;users&quot;.&quot;id&quot; AS t0_r0, ... FROM &quot;users&quot;
</span><span class='comment'>#   LEFT OUTER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;
</span><span class='comment'>#   WHERE &quot;posts&quot;.&quot;name&quot; = ?  [[&quot;name&quot;, &quot;example&quot;]]</span></code></pre>

<p>As the <code>LEFT OUTER JOIN</code> already contains the posts, the second query for the posts is no longer performed.</p>

<p>Note that <code>#includes</code> works with association names while <a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">#references</a> needs the actual table name.</p>

<p>If you pass the conditions via a <a href="../Hash.html" title="Hash (class)"><code>::Hash</code></a>, you don’t need to call <a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">#references</a> explicitly, as <a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">#where</a> references the tables for you. For example, this will work correctly:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>posts:</span> { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example</span><span class='tstring_end'>&#39;</span></span> })</code></pre>

<p>NOTE: Conditions affect both sides of an association. For example, the above code will return only users that have a post named “example”, <em>and will only include posts named “example”</em>, even when a matching user has other additional posts.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L250-L253'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='250' data-end='253'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 250</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_includes'>includes</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_includes!'><a href="#includes!-instance_method" title="ActiveRecord::QueryMethods#includes! (method)">includes!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="includes!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>includes!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L255-L258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='255' data-end='258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 255</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_includes!'>includes!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_includes_values'>includes_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invert_where-instance_method">
  <h3 class='signature '>
    #<strong>invert_where</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows you to invert an entire where clause instead of manually applying conditions.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>User</span>
  <span class='id identifier rubyid_scope'>scope</span> <span class='symbeg'>:</span><span class='id identifier rubyid_active'>active</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>accepted:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>locked:</span> <span class='kw'>false</span>) }
<span class='kw'>end</span>

<span class='const'>User</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>accepted:</span> <span class='kw'>true</span>)
<span class='comment'># WHERE {accepted} = 1
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>accepted:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_invert_where'>invert_where</span>
<span class='comment'># WHERE {accepted} != 1
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_active'>active</span>
<span class='comment'># WHERE {accepted} = 1 AND {locked} = 0
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_active'>active</span>.<span class='id identifier rubyid_invert_where'>invert_where</span>
<span class='comment'># WHERE NOT (`accepted` = 1 AND {locked} = 0)</span></code></pre>

<p>Be careful because this inverts all conditions before <code>invert_where</code> call.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>User</span>
  <span class='id identifier rubyid_scope'>scope</span> <span class='symbeg'>:</span><span class='id identifier rubyid_active'>active</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>accepted:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>locked:</span> <span class='kw'>false</span>) }
  <span class='id identifier rubyid_scope'>scope</span> <span class='symbeg'>:</span><span class='id identifier rubyid_inactive'>inactive</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_active'>active</span>.<span class='id identifier rubyid_invert_where'>invert_where</span> } <span class='comment'># Do not attempt it
</span><span class='kw'>end</span>

<span class='comment'># It also inverts `where(role: &#39;admin&#39;)` unexpectedly.
</span><span class='const'>User</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>role:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_inactive'>inactive</span>
<span class='comment'># WHERE NOT (`role` = &#39;admin&#39; AND {accepted} = 1 AND {locked} = 0)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1101-L1103'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1101' data-end='1103'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1101</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invert_where'>invert_where</span>
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_invert_where!'><a href="#invert_where!-instance_method" title="ActiveRecord::QueryMethods#invert_where! (method)">invert_where!</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invert_where!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>invert_where!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1105-L1108'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1105' data-end='1108'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1105</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invert_where!'>invert_where!</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_invert'>invert</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="joins-instance_method">
  <h3 class='signature '>
    #<strong>joins</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Performs JOINs on <code>args</code>. The given symbol(s) should match the name of the association(s).</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>)
<span class='comment'># SELECT &quot;users&quot;.*
</span><span class='comment'># FROM &quot;users&quot;
</span><span class='comment'># INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;</span></code></pre>

<p>Multiple joins:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_account'>account</span>)
<span class='comment'># SELECT &quot;users&quot;.*
</span><span class='comment'># FROM &quot;users&quot;
</span><span class='comment'># INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;
</span><span class='comment'># INNER JOIN &quot;accounts&quot; ON &quot;accounts&quot;.&quot;id&quot; = &quot;users&quot;.&quot;account_id&quot;</span></code></pre>

<p>Nested joins:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='label'>posts:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>])
<span class='comment'># SELECT &quot;users&quot;.*
</span><span class='comment'># FROM &quot;users&quot;
</span><span class='comment'># INNER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;
</span><span class='comment'># INNER JOIN &quot;comments&quot; ON &quot;comments&quot;.&quot;post_id&quot; = &quot;posts&quot;.&quot;id&quot;</span></code></pre>

<p>You can use strings in order to customize your joins:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LEFT JOIN bookmarks ON bookmarks.bookmarkable_type = &#39;Post&#39; AND bookmarks.user_id = users.id</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; LEFT JOIN bookmarks ON bookmarks.bookmarkable_type = &#39;Post&#39; AND bookmarks.user_id = users.id</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L868-L871'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='868' data-end='871'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 868</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_joins'>joins</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_joins!'><a href="#joins!-instance_method" title="ActiveRecord::QueryMethods#joins! (method)">joins!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="joins!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>joins!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L873-L876'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='873' data-end='876'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 873</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_joins!'>joins!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_joins_values'>joins_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="left_joins-instance_method">
  <h3 class='signature '>
    #<strong>left_joins</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">#left_outer_joins</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L887-L887'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='887' data-end='887'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 887</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_joins'>left_joins</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_outer_joins'><a href="#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">left_outer_joins</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="left_outer_joins-instance_method">
  <h3 class='signature '>
    #<strong>left_outer_joins</strong>(*args)  
    <span class='aliases'>Also known as: <span class='names'>#left_joins</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Performs LEFT OUTER JOINs on <code>args</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_left_outer_joins'>left_outer_joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; LEFT OUTER JOIN &quot;posts&quot; ON &quot;posts&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L883-L886'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='883' data-end='886'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 883</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_left_outer_joins'>left_outer_joins</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_left_outer_joins!'><a href="#left_outer_joins!-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins! (method)">left_outer_joins!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="left_outer_joins!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>left_outer_joins!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L889-L892'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='889' data-end='892'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 889</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_left_outer_joins!'>left_outer_joins!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_left_outer_joins_values'>left_outer_joins_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="limit-instance_method">
  <h3 class='signature '>
    #<strong>limit</strong>(value)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specifies a limit for the number of records to retrieve.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_limit'>limit</span>(<span class='int'>10</span>) <span class='comment'># generated SQL has &#39;LIMIT 10&#39;
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_limit'>limit</span>(<span class='int'>10</span>).<span class='id identifier rubyid_limit'>limit</span>(<span class='int'>20</span>) <span class='comment'># generated SQL has &#39;LIMIT 20&#39;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1211-L1213'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1211' data-end='1213'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_limit!'><a href="#limit!-instance_method" title="ActiveRecord::QueryMethods#limit! (method)">limit!</a></span>(<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="limit!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>limit!</strong>(value)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1215-L1219'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1215' data-end='1219'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1215</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_limit!'>limit!</span>(<span class='id identifier rubyid_value'>value</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='const'><a href="../Integer.html" title="Integer (class)">Integer</a></span>(<span class='id identifier rubyid_value'>value</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_limit_value'>limit_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="lock-instance_method">
  <h3 class='signature '>
    #<strong>lock</strong>(locks = true)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specifies locking settings (default to <code>true</code>). For more information on locking, please see <a href="Locking.html" title="ActiveRecord::Locking (module)"><code>Locking</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1239-L1241'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1239' data-end='1241'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1239</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_lock'>lock</span>(<span class='id identifier rubyid_locks'>locks</span> <span class='op'>=</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_lock!'><a href="#lock!-instance_method" title="ActiveRecord::QueryMethods#lock! (method)">lock!</a></span>(<span class='id identifier rubyid_locks'>locks</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="lock!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>lock!</strong>(locks = true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1243-L1252'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1243' data-end='1252'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1243</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_lock!'>lock!</span>(<span class='id identifier rubyid_locks'>locks</span> <span class='op'>=</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_locks'>locks</span>
  <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='comma'>,</span> <span class='const'><a href="../TrueClass.html" title="TrueClass (class)">TrueClass</a></span><span class='comma'>,</span> <span class='const'><a href="../NilClass.html" title="NilClass (class)">NilClass</a></span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_lock_value'>lock_value</span> <span class='op'>=</span> <span class='id identifier rubyid_locks'>locks</span> <span class='op'>||</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_lock_value'>lock_value</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="lookup_table_klass_from_join_dependencies-instance_method">
  <h3 class='signature priv'>
    #<strong>lookup_table_klass_from_join_dependencies</strong>(table_name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1722-L1727'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1722' data-end='1727'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1722</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_lookup_table_klass_from_join_dependencies'>lookup_table_klass_from_join_dependencies</span>(<span class='id identifier rubyid_table_name'>table_name</span>)
  <span class='id identifier rubyid_each_join_dependencies'><a href="#each_join_dependencies-instance_method" title="ActiveRecord::QueryMethods#each_join_dependencies (method)">each_join_dependencies</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_join'>join</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_base_klass'>base_klass</span> <span class='kw'>if</span> <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>==</span> <span class='id identifier rubyid_join'>join</span>.<span class='id identifier rubyid_table_name'>table_name</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="none-instance_method">
  <h3 class='signature '>
    #<strong>none</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a chainable relation with zero records.</p>

<p>The returned relation implements the Null Object pattern. It is an object with defined null behavior and always returns an empty array of records without querying the database.</p>

<p>Any subsequent condition chained to the returned relation will continue generating an empty relation and will not fire any query to the database.</p>

<p>Used in cases where a method or scope could return zero records but the result needs to be chainable.</p>

<p>For example:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@posts</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span>.<span class='id identifier rubyid_visible_posts'>visible_posts</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>name:</span> <span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>])
<span class='comment'># the visible_posts method is expected to return a chainable Relation
</span>
<span class='kw'>def</span> <span class='id identifier rubyid_visible_posts'>visible_posts</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_role'>role</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Country Manager</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>country:</span> <span class='id identifier rubyid_country'>country</span>)
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reviewer</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Post</span>.<span class='id identifier rubyid_published'>published</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Bad User</span><span class='tstring_end'>&#39;</span></span>
    <span class='const'>Post</span>.<span class='id identifier rubyid_none'>none</span> <span class='comment'># It can&#39;t be chained if [] is returned.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1282-L1284'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1282' data-end='1284'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1282</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_none!'><a href="#none!-instance_method" title="ActiveRecord::QueryMethods#none! (method)">none!</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="none!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>none!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1286-L1292'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1286' data-end='1292'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1286</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_none!'>none!</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>unless</span> <span class='ivar'>@none</span>
    <span class='id identifier rubyid_where!'><a href="#where!-instance_method" title="ActiveRecord::QueryMethods#where! (method)">where!</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1=0</span><span class='tstring_end'>&quot;</span></span>)
    <span class='ivar'>@none</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="offset-instance_method">
  <h3 class='signature '>
    #<strong>offset</strong>(value)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specifies the number of rows to skip before returning rows.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_offset'>offset</span>(<span class='int'>10</span>) <span class='comment'># generated SQL has &quot;OFFSET 10&quot;</span></code></pre>

<p>Should be used with order.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_offset'>offset</span>(<span class='int'>10</span>).<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name ASC</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1228-L1230'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1228' data-end='1230'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1228</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_offset'>offset</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_offset!'><a href="#offset!-instance_method" title="ActiveRecord::QueryMethods#offset! (method)">offset!</a></span>(<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="offset!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>offset!</strong>(value)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1232-L1235'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1232' data-end='1235'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1232</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_offset!'>offset!</span>(<span class='id identifier rubyid_value'>value</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_offset_value'>offset_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="optimizer_hints-instance_method">
  <h3 class='signature '>
    #<strong>optimizer_hints</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specify optimizer hints to be used in the SELECT statement.</p>

<p>Example (for MySQL):</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_optimizer_hints'>optimizer_hints</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAX_EXECUTION_TIME(50000)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NO_INDEX_MERGE(topics)</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># SELECT /*+ MAX_EXECUTION_TIME(50000) NO_INDEX_MERGE(topics) */ {topics}.* FROM {topics}</span></code></pre>

<p>Example (for PostgreSQL with pg_hint_plan):</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_optimizer_hints'>optimizer_hints</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SeqScan(topics)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Parallel(topics 8)</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># SELECT /*+ SeqScan(topics) Parallel(topics 8) */ &quot;topics&quot;.* FROM &quot;topics&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1486-L1489'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1486' data-end='1489'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1486</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_optimizer_hints'>optimizer_hints</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_optimizer_hints!'><a href="#optimizer_hints!-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints! (method)">optimizer_hints!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="optimizer_hints!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>optimizer_hints!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1491-L1494'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1491' data-end='1494'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1491</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_optimizer_hints!'>optimizer_hints!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_optimizer_hints_values'>optimizer_hints_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="or-instance_method">
  <h3 class='signature '>
    #<strong>or</strong>(other)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a new relation, which is the logical union of this relation and the one passed as an argument.</p>

<p>The two relations must be structurally compatible: they must be scoping the same model, and they must differ only by <a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">#where</a> (if no <a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a> has been defined) or <a href="#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">#having</a> (if a <a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a> is present).</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id = 1</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_or'>or</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>author_id = 3</span><span class='tstring_end'>&quot;</span></span>))
<span class='comment'># SELECT {posts}.* FROM {posts} WHERE ((id = 1) OR (author_id = 3))</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1167-L1177'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1167' data-end='1177'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1167</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>or</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span>)
    <span class='kw'>if</span> <span class='ivar'>@none</span>
      <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_spawn'>spawn</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_or!'><a href="#or!-instance_method" title="ActiveRecord::QueryMethods#or! (method)">or!</a></span>(<span class='id identifier rubyid_other'>other</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You have passed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> object to #or. Pass an ActiveRecord::Relation object instead.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="or!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>or!</strong>(other)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1179-L1191'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1179' data-end='1191'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1179</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_or!'>or!</span>(<span class='id identifier rubyid_other'>other</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_incompatible_values'>incompatible_values</span> <span class='op'>=</span> <span class='id identifier rubyid_structurally_incompatible_values_for'><a href="#structurally_incompatible_values_for-instance_method" title="ActiveRecord::QueryMethods#structurally_incompatible_values_for (method)">structurally_incompatible_values_for</a></span>(<span class='id identifier rubyid_other'>other</span>)

  <span class='kw'>unless</span> <span class='id identifier rubyid_incompatible_values'>incompatible_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Relation passed to #or must be structurally compatible. Incompatible values: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_incompatible_values'>incompatible_values</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_or'><a href="#or-instance_method" title="ActiveRecord::QueryMethods#or (method)">or</a></span>(<span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_where_clause'>where_clause</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_having_clause'>having_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_or'><a href="#or-instance_method" title="ActiveRecord::QueryMethods#or (method)">or</a></span>(<span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_having_clause'>having_clause</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_references_values'>references_values</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="order-instance_method">
  <h3 class='signature '>
    #<strong>order</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Applies an <code>ORDER BY</code> clause to a query.</p>

<p><code>#order</code> accepts arguments in one of several formats.</p>

<h4 id="label-symbols">symbols</h4>

<p>The symbol represents the name of the column you want to order the results by.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY &quot;users&quot;.&quot;name&quot; ASC</span></code></pre>

<p>By default, the order is ascending. If you want descending order, you can map the column name symbol to <code>:desc</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='label'>email:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_desc'>desc</span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY &quot;users&quot;.&quot;email&quot; DESC</span></code></pre>

<p>Multiple columns can be passed this way, and they will be applied in the order specified.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>email:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_desc'>desc</span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY &quot;users&quot;.&quot;name&quot; ASC, &quot;users&quot;.&quot;email&quot; DESC</span></code></pre>

<h4 id="label-strings">strings</h4>

<p>Strings are passed directly to the database, allowing you to specify simple SQL expressions.</p>

<p>This could be a source of SQL injection, so only strings composed of plain column names and simple <code>function(column_name)</code> expressions with optional <code>ASC+/+DESC</code> modifiers are allowed.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY name
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name DESC</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY name DESC
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name DESC, email</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY name DESC, email</span></code></pre>

<h4 id="label-Arel">Arel</h4>

<p>If you need to pass in complicated expressions that you have verified are safe for the database, you can use <a href="../Arel.html" title="Arel (module)"><code>::Arel</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>end_date - start_date</span><span class='tstring_end'>&#39;</span></span>))
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY end_date - start_date</span></code></pre>

<p>Custom query syntax, like JSON columns for PostgreSQL, is supported in this way.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'>order</span>(<span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>payload-&gt;&gt;&#39;kind&#39;</span><span class='tstring_end'>&quot;</span></span>))
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; ORDER BY payload-&gt;&gt;&#39;kind&#39;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L656-L661'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='656' data-end='661'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 656</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_order'>order</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_sanitize_order_arguments'><a href="#sanitize_order_arguments-instance_method" title="ActiveRecord::QueryMethods#sanitize_order_arguments (method)">sanitize_order_arguments</a></span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_order!'><a href="#order!-instance_method" title="ActiveRecord::QueryMethods#order! (method)">order!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="order!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>order!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">#order</a> but operates on relation in-place instead of copying.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L664-L668'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='664' data-end='668'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 664</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_order!'>order!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_preprocess_order_args'><a href="#preprocess_order_args-instance_method" title="ActiveRecord::QueryMethods#preprocess_order_args (method)">preprocess_order_args</a></span>(<span class='id identifier rubyid_args'>args</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_order_values'>order_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="order_column-instance_method">
  <h3 class='signature priv'>
    #<strong>order_column</strong>(field)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2163-L2171'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2163' data-end='2171'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2163</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_order_column'>order_column</span>(<span class='id identifier rubyid_field'>field</span>)
  <span class='id identifier rubyid_arel_column'><a href="#arel_column-instance_method" title="ActiveRecord::QueryMethods#arel_column (method)">arel_column</a></span>(<span class='id identifier rubyid_field'>field</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr_name'>attr_name</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_attr_name'>attr_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>count</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_group_values'>group_values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_table'>table</span>[<span class='id identifier rubyid_attr_name'>attr_name</span>]
    <span class='kw'>else</span>
      <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_quote_table_name'>quote_table_name</span>(<span class='id identifier rubyid_attr_name'>attr_name</span>)<span class='comma'>,</span> <span class='label'>retryable:</span> <span class='kw'>true</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="preload-instance_method">
  <h3 class='signature '>
    #<strong>preload</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specify associations <code>args</code> to be eager loaded using separate queries. A separate query is performed for each association.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_preload'>preload</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="ActiveRecord::QueryMethods#limit (method)">limit</a></span>(<span class='int'>5</span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
  <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_city'>city</span>
<span class='kw'>end</span>

<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; LIMIT 5
</span><span class='comment'># SELECT &quot;addresses&quot;.* FROM &quot;addresses&quot; WHERE &quot;addresses&quot;.&quot;id&quot; IN (1,2,3,4,5)</span></code></pre>

<p>Instead of loading the 5 addresses with 5 separate queries, all addresses are loaded with a separate query.</p>

<p>Loading multiple and nested associations is possible using Hashes and Arrays, similar to <a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">#includes</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_preload'>preload</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='label'>friends:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_followers'>followers</span>])
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot;
</span><span class='comment'># SELECT &quot;addresses&quot;.* FROM &quot;addresses&quot; WHERE &quot;addresses&quot;.&quot;id&quot; IN (1,2,3,4,5)
</span><span class='comment'># SELECT &quot;friends&quot;.* FROM &quot;friends&quot; WHERE &quot;friends&quot;.&quot;user_id&quot; IN (1,2,3,4,5)
</span><span class='comment'># SELECT ...</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L322-L325'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='322' data-end='325'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 322</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_preload'>preload</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_preload!'><a href="#preload!-instance_method" title="ActiveRecord::QueryMethods#preload! (method)">preload!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="preload!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>preload!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L327-L330'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='327' data-end='330'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 327</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_preload!'>preload!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_preload_values'>preload_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="preprocess_order_args-instance_method">
  <h3 class='signature priv'>
    #<strong>preprocess_order_args</strong>(order_args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2091-L2126'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2091' data-end='2126'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2091</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_preprocess_order_args'>preprocess_order_args</span>(<span class='id identifier rubyid_order_args'>order_args</span>)
  <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_disallow_raw_sql!'>disallow_raw_sql!</span>(
    <span class='id identifier rubyid_flattened_args'><a href="#flattened_args-instance_method" title="ActiveRecord::QueryMethods#flattened_args (method)">flattened_args</a></span>(<span class='id identifier rubyid_order_args'>order_args</span>)<span class='comma'>,</span>
    <span class='label'>permit:</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_column_name_with_order_matcher'>column_name_with_order_matcher</span>
  )

  <span class='id identifier rubyid_validate_order_args'><a href="#validate_order_args-instance_method" title="ActiveRecord::QueryMethods#validate_order_args (method)">validate_order_args</a></span>(<span class='id identifier rubyid_order_args'>order_args</span>)

  <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span> <span class='op'>=</span> <span class='id identifier rubyid_column_references'><a href="#column_references-instance_method" title="ActiveRecord::QueryMethods#column_references (method)">column_references</a></span>(<span class='id identifier rubyid_order_args'>order_args</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_references'><a href="#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">references</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># if a symbol is given we prepend the quoted table name
</span>  <span class='id identifier rubyid_order_args'>order_args</span>.<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_arg'>arg</span>
    <span class='kw'>when</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
      <span class='id identifier rubyid_order_column'><a href="#order_column-instance_method" title="ActiveRecord::QueryMethods#order_column (method)">order_column</a></span>(<span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_to_s'>to_s</span>).<span class='id identifier rubyid_asc'>asc</span>
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
      <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)
          <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
            <span class='id identifier rubyid_order_column'><a href="#order_column-instance_method" title="ActiveRecord::QueryMethods#order_column (method)">order_column</a></span>([<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_to_s'>to_s</span>].<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>)).<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_dir'>dir</span>.<span class='id identifier rubyid_downcase'>downcase</span>)
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='kw'>case</span> <span class='id identifier rubyid_key'>key</span>
          <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/SqlLiteral.html" title="Arel::Nodes::SqlLiteral (class)">SqlLiteral</a></span><span class='comma'>,</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Node.html" title="Arel::Nodes::Node (class)">Node</a></span><span class='comma'>,</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel.html#Attribute-constant" title="Arel::Attribute (constant)">Attribute</a></span>
            <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_downcase'>downcase</span>)
          <span class='kw'>else</span>
            <span class='id identifier rubyid_order_column'><a href="#order_column-instance_method" title="ActiveRecord::QueryMethods#order_column (method)">order_column</a></span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>).<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_downcase'>downcase</span>)
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_arg'>arg</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_flatten!'>flatten!</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_select_args-instance_method">
  <h3 class='signature priv'>
    #<strong>process_select_args</strong>(fields)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2234-L2242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2234' data-end='2242'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2234</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_select_args'>process_select_args</span>(<span class='id identifier rubyid_fields'>fields</span>)
  <span class='id identifier rubyid_fields'>fields</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)
      <span class='id identifier rubyid_arel_column_aliases_from_hash'><a href="#arel_column_aliases_from_hash-instance_method" title="ActiveRecord::QueryMethods#arel_column_aliases_from_hash (method)">arel_column_aliases_from_hash</a></span>(<span class='id identifier rubyid_field'>field</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_field'>field</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_with_args-instance_method">
  <h3 class='signature priv'>
    #<strong>process_with_args</strong>(args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2264-L2269'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2264' data-end='2269'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2264</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_with_args'>process_with_args</span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported argument type: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg'>arg</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)
    <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> { <span class='id identifier rubyid_k'>k</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_v'>v</span> } }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="readonly-instance_method">
  <h3 class='signature '>
    #<strong>readonly</strong>(value = true)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Mark a relation as readonly. Attempting to update a record will result in an error.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_readonly'>readonly</span>
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_save'>save</span>
<span class='comment'># =&gt; ActiveRecord::ReadOnlyRecord: User is marked as readonly</span></code></pre>

<p>To make a readonly relation writable, pass <code>false</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_readonly'>readonly</span>(<span class='kw'>false</span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_save'>save</span>
<span class='comment'># =&gt; true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1310-L1312'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1310' data-end='1312'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1310</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_readonly'>readonly</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_readonly!'><a href="#readonly!-instance_method" title="ActiveRecord::QueryMethods#readonly! (method)">readonly!</a></span>(<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="readonly!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>readonly!</strong>(value = true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1314-L1317'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1314' data-end='1317'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1314</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_readonly!'>readonly!</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_readonly_value'>readonly_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="references-instance_method">
  <h3 class='signature '>
    #<strong>references</strong>(*table_names)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Use to indicate that the given <code>table_names</code> are referenced by an SQL string, and should therefore be <code>JOIN</code>ed in any query rather than loaded separately. This method only works in conjunction with <a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">#includes</a>. See <a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">#includes</a> for more details.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_includes'><a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">includes</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts.name = &#39;foo&#39;</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># Doesn&#39;t JOIN the posts table, resulting in an error.
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_includes'><a href="#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">includes</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts.name = &#39;foo&#39;</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_references'>references</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>)
<span class='comment'># Query now knows the string references posts, so adds a JOIN</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L355-L358'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='355' data-end='358'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 355</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_references'>references</span>(<span class='op'>*</span><span class='id identifier rubyid_table_names'>table_names</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_table_names'>table_names</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_references!'><a href="#references!-instance_method" title="ActiveRecord::QueryMethods#references! (method)">references!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_table_names'>table_names</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="references!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>references!</strong>(*table_names)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L360-L363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='360' data-end='363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 360</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_references!'>references!</span>(<span class='op'>*</span><span class='id identifier rubyid_table_names'>table_names</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_references_values'>references_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_table_names'>table_names</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="regroup-instance_method">
  <h3 class='signature '>
    #<strong>regroup</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows you to change a previously set group statement.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_group'><a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">group</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
<span class='comment'># SELECT {posts}.`*` FROM {posts} GROUP BY {posts}.`title`, {posts}.`body`
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_group'><a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">group</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>).<span class='id identifier rubyid_regroup'>regroup</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span>)
<span class='comment'># SELECT {posts}.`*` FROM {posts} GROUP BY {posts}.`title`</span></code></pre>

<p>This is short-hand for <code>unscope(:group).group(fields)</code>. Note that we’re unscoping the entire group statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L593-L596'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='593' data-end='596'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 593</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_regroup'>regroup</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_regroup!'><a href="#regroup!-instance_method" title="ActiveRecord::QueryMethods#regroup! (method)">regroup!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="regroup!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>regroup!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#regroup-instance_method" title="ActiveRecord::QueryMethods#regroup (method)">#regroup</a> but operates on relation in-place instead of copying.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L599-L602'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='599' data-end='602'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 599</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_regroup!'>regroup!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_group_values'>group_values</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reorder-instance_method">
  <h3 class='signature '>
    #<strong>reorder</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Replaces any existing order defined on the relation with the specified order.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email DESC</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_reorder'>reorder</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id ASC</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># generated SQL has &#39;ORDER BY id ASC&#39;</span></code></pre>

<p>Subsequent calls to order on the same relation will be appended. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email DESC</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_reorder'>reorder</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id ASC</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name ASC</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>generates a query with <code>ORDER BY id ASC, name ASC</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L752-L757'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='752' data-end='757'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 752</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reorder'>reorder</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_sanitize_order_arguments'><a href="#sanitize_order_arguments-instance_method" title="ActiveRecord::QueryMethods#sanitize_order_arguments (method)">sanitize_order_arguments</a></span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_reorder!'><a href="#reorder!-instance_method" title="ActiveRecord::QueryMethods#reorder! (method)">reorder!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reorder!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>reorder!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#reorder-instance_method" title="ActiveRecord::QueryMethods#reorder (method)">#reorder</a> but operates on relation in-place instead of copying.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L760-L766'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='760' data-end='766'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 760</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reorder!'>reorder!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_preprocess_order_args'><a href="#preprocess_order_args-instance_method" title="ActiveRecord::QueryMethods#preprocess_order_args (method)">preprocess_order_args</a></span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_uniq!'><a href="#uniq!-instance_method" title="ActiveRecord::QueryMethods#uniq! (method)">uniq!</a></span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_reordering_value'>reordering_value</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_order_values'>order_values</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reselect-instance_method">
  <h3 class='signature '>
    #<strong>reselect</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows you to change a previously set select statement.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
<span class='comment'># SELECT {posts}.`title`, {posts}.`body` FROM {posts}
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>).<span class='id identifier rubyid_reselect'>reselect</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_created_at'>created_at</span>)
<span class='comment'># SELECT {posts}.`created_at` FROM {posts}</span></code></pre>

<p>This is short-hand for <code>unscope(:select).select(fields)</code>. Note that we’re unscoping the entire select statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L541-L545'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='541' data-end='545'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 541</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reselect'>reselect</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='id identifier rubyid_process_select_args'><a href="#process_select_args-instance_method" title="ActiveRecord::QueryMethods#process_select_args (method)">process_select_args</a></span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_reselect!'><a href="#reselect!-instance_method" title="ActiveRecord::QueryMethods#reselect! (method)">reselect!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reselect!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>reselect!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#reselect-instance_method" title="ActiveRecord::QueryMethods#reselect (method)">#reselect</a> but operates on relation in-place instead of copying.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L548-L551'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='548' data-end='551'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 548</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reselect!'>reselect!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_select_values'>select_values</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="resolve_arel_attributes-instance_method">
  <h3 class='signature priv'>
    #<strong>resolve_arel_attributes</strong>(attrs)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2183-L2205'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2183' data-end='2205'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2183</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_arel_attributes'>resolve_arel_attributes</span>(<span class='id identifier rubyid_attrs'>attrs</span>)
  <span class='id identifier rubyid_attrs'>attrs</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_attr'>attr</span>
    <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Predications.html" title="Arel::Predications (module)">Predications</a></span>
      <span class='id identifier rubyid_attr'>attr</span>
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
      <span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='op'>|</span>
        <span class='id identifier rubyid_table'>table</span> <span class='op'>=</span> <span class='id identifier rubyid_table'>table</span>.<span class='id identifier rubyid_to_s'>to_s</span>
        <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_columns'>columns</span>).<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span>
          <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>.<span class='id identifier rubyid_resolve_arel_attribute'>resolve_arel_attribute</span>(<span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>)
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_attr'>attr</span> <span class='op'>=</span> <span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>)
        <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span> <span class='op'>=</span> <span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span>)
        <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>.<span class='id identifier rubyid_resolve_arel_attribute'>resolve_arel_attribute</span>(<span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>)
      <span class='kw'>else</span>
        <span class='id identifier rubyid_attr'>attr</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reverse_order-instance_method">
  <h3 class='signature '>
    #<strong>reverse_order</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reverse the existing order clause on the relation.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name ASC</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_reverse_order'>reverse_order</span> <span class='comment'># generated SQL has &#39;ORDER BY name DESC&#39;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1499-L1501'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1499' data-end='1501'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1499</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reverse_order'>reverse_order</span>
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_reverse_order!'><a href="#reverse_order!-instance_method" title="ActiveRecord::QueryMethods#reverse_order! (method)">reverse_order!</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reverse_order!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>reverse_order!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1503-L1507'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1503' data-end='1507'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1503</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reverse_order!'>reverse_order!</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_orders'>orders</span> <span class='op'>=</span> <span class='id identifier rubyid_order_values'>order_values</span>.<span class='id identifier rubyid_compact_blank'>compact_blank</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_order_values'>order_values</span> <span class='op'>=</span> <span class='id identifier rubyid_reverse_sql_order'><a href="#reverse_sql_order-instance_method" title="ActiveRecord::QueryMethods#reverse_sql_order (method)">reverse_sql_order</a></span>(<span class='id identifier rubyid_orders'>orders</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reverse_sql_order-instance_method">
  <h3 class='signature priv'>
    #<strong>reverse_sql_order</strong>(order_query)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2012-L2045'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2012' data-end='2045'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2012</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reverse_sql_order'>reverse_sql_order</span>(<span class='id identifier rubyid_order_query'>order_query</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_order_query'>order_query</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid__reverse_order_columns'><a href="#_reverse_order_columns-instance_method" title="ActiveRecord::QueryMethods#_reverse_order_columns (method)">_reverse_order_columns</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='kw'>return</span> <span class='id identifier rubyid__reverse_order_columns'><a href="#_reverse_order_columns-instance_method" title="ActiveRecord::QueryMethods#_reverse_order_columns (method)">_reverse_order_columns</a></span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span> <span class='id identifier rubyid_table'>table</span>[<span class='id identifier rubyid_column'>column</span>].<span class='id identifier rubyid_desc'>desc</span> }
    <span class='kw'>end</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="IrreversibleOrderError.html" title="ActiveRecord::IrreversibleOrderError (class)">IrreversibleOrderError</a></span><span class='comma'>,</span> <span class='heredoc_beg'>&lt;&lt;~MSG</span>.<span class='id identifier rubyid_squish'>squish</span>
<span class='ignored_sp'>      </span><span class='tstring_content'>Relation has no order values, and </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model'>model</span><span class='embexpr_end'>}</span><span class='tstring_content'> has no order columns to use as a default.
</span><span class='ignored_sp'>      </span><span class='tstring_content'>Set at least one of `implicit_order_column`, or `primary_key` on the model when no
</span><span class='ignored_sp'>      </span><span class='tstring_content'>`order `is specified on the relation.
</span><span class='heredoc_end'>    MSG
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_order_query'>order_query</span>.<span class='id identifier rubyid_flat_map'>flat_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_o'>o</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_o'>o</span>
    <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel.html#Attribute-constant" title="Arel::Attribute (constant)">Attribute</a></span>
      <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_desc'>desc</span>
    <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/Ordering.html" title="Arel::Nodes::Ordering (class)">Ordering</a></span>
      <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_reverse'>reverse</span>
    <span class='kw'>when</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Arel/Nodes/NodeExpression.html" title="Arel::Nodes::NodeExpression (class)">NodeExpression</a></span>
      <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_desc'>desc</span>
    <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_does_not_support_reverse?'><a href="#does_not_support_reverse%3F-instance_method" title="ActiveRecord::QueryMethods#does_not_support_reverse? (method)">does_not_support_reverse?</a></span>(<span class='id identifier rubyid_o'>o</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="IrreversibleOrderError.html" title="ActiveRecord::IrreversibleOrderError (class)">IrreversibleOrderError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Order </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> cannot be reversed automatically</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
        <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_strip!'>strip!</span>
        <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_gsub!'>gsub!</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\sasc\Z</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> DESC</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>||</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_gsub!'>gsub!</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\sdesc\Z</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> ASC</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>||</span> (<span class='id identifier rubyid_s'>s</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> DESC</span><span class='tstring_end'>&quot;</span></span>)
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_o'>o</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rewhere-instance_method">
  <h3 class='signature '>
    #<strong>rewhere</strong>(conditions)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows you to change a previously set where condition for a given attribute, instead of appending to that condition.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>trashed:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>trashed:</span> <span class='kw'>false</span>)
<span class='comment'># WHERE {trashed} = 1 AND {trashed} = 0
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>trashed:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_rewhere'>rewhere</span>(<span class='label'>trashed:</span> <span class='kw'>false</span>)
<span class='comment'># WHERE {trashed} = 0
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>active:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>trashed:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_rewhere'>rewhere</span>(<span class='label'>trashed:</span> <span class='kw'>false</span>)
<span class='comment'># WHERE {active} = 1 AND {trashed} = 0</span></code></pre>

<p>This is short-hand for <code>unscope(where: conditions.keys).where(conditions)</code>. Note that unlike reorder, we’re only unscoping the named conditions – not the entire where statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1061-L1070'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1061' data-end='1070'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1061</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rewhere'>rewhere</span>(<span class='id identifier rubyid_conditions'>conditions</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_unscope'><a href="#unscope-instance_method" title="ActiveRecord::QueryMethods#unscope (method)">unscope</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>) <span class='kw'>if</span> <span class='id identifier rubyid_conditions'>conditions</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span>
  <span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_build_where_clause'><a href="#build_where_clause-instance_method" title="ActiveRecord::QueryMethods#build_where_clause (method)">build_where_clause</a></span>(<span class='id identifier rubyid_conditions'>conditions</span>)

  <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_unscope!'><a href="#unscope!-instance_method" title="ActiveRecord::QueryMethods#unscope! (method)">unscope!</a></span>(<span class='label'>where:</span> <span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_extract_attributes'>extract_attributes</span>)
  <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>+=</span> <span class='id identifier rubyid_where_clause'>where_clause</span>
  <span class='id identifier rubyid_scope'>scope</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sanitize_order_arguments-instance_method">
  <h3 class='signature priv'>
    #<strong>sanitize_order_arguments</strong>(order_args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2128-L2132'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2128' data-end='2132'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2128</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sanitize_order_arguments'>sanitize_order_arguments</span>(<span class='id identifier rubyid_order_args'>order_args</span>)
  <span class='id identifier rubyid_order_args'>order_args</span>.<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_sanitize_sql_for_order'>sanitize_sql_for_order</span>(<span class='id identifier rubyid_arg'>arg</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="select-instance_method">
  <h3 class='signature '>
    #<strong>select</strong>(*fields)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Works in two unique ways.</p>

<p>First: takes a block so it can be used just like <code>Array#select</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span>.<span class='id identifier rubyid_select'>select</span> { <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span>.<span class='id identifier rubyid_field'>field</span> <span class='op'>==</span> <span class='id identifier rubyid_value'>value</span> }</code></pre>

<p>This will build an array of objects from the database for the scope, converting them into an array and iterating through them using <code>Array#select</code>.</p>

<p>Second: Modifies the SELECT statement for the query so that only certain fields are retrieved:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_field'>field</span>)
<span class='comment'># =&gt; [#&lt;Model id: nil, field: &quot;value&quot;&gt;]</span></code></pre>

<p>Although in the above example it looks as though this method returns an array, it actually returns a relation object and can have other query methods appended to it, such as the other methods in <code>QueryMethods</code>.</p>

<p>The argument to the method can also be an array of fields.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_other_field'>other_field</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_and_one_more'>and_one_more</span>)
<span class='comment'># =&gt; [#&lt;Model id: nil, field: &quot;value&quot;, other_field: &quot;value&quot;, and_one_more: &quot;value&quot;&gt;]</span></code></pre>

<p>The argument also can be a hash of fields and aliases.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='label'>models:</span> { <span class='label'>field:</span> <span class='symbeg'>:</span><span class='kw'>alias</span><span class='comma'>,</span> <span class='label'>other_field:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_other_alias'>other_alias</span> })
<span class='comment'># =&gt; [#&lt;Model id: nil, alias: &quot;value&quot;, other_alias: &quot;value&quot;&gt;]
</span>
<span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='label'>models:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_other_field'>other_field</span>])
<span class='comment'># =&gt; [#&lt;Model id: nil, field: &quot;value&quot;, other_field: &quot;value&quot;&gt;]</span></code></pre>

<p>You can also use one or more strings, which will be used unchanged as SELECT fields.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>field AS field_one</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>other_field AS field_two</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;Model id: nil, field_one: &quot;value&quot;, field_two: &quot;value&quot;&gt;]</span></code></pre>

<p>If an alias was specified, it will be accessible from the resulting objects:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>field AS field_one</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_field_one'>field_one</span>
<span class='comment'># =&gt; &quot;value&quot;</span></code></pre>

<p>Accessing attributes of an object that do not have fields retrieved by a select except <code>id</code> will throw <a href="../ActiveModel/MissingAttributeError.html" title="ActiveModel::MissingAttributeError (class)"><code>::ActiveModel::MissingAttributeError</code></a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Model</span>.<span class='id identifier rubyid_select'>select</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_field'>field</span>).<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_other_field'>other_field</span>
<span class='comment'># =&gt; ActiveModel::MissingAttributeError: missing attribute &#39;other_field&#39; for Model</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L413-L426'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='413' data-end='426'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 413</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_select'>select</span>(<span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_fields'>fields</span>.<span class='id identifier rubyid_any?'>any?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`select&#39; with block doesn&#39;t take arguments.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>super</span>()
  <span class='kw'>end</span>

  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_fields'>fields</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Call `select&#39; with at least one field.</span><span class='tstring_end'>&quot;</span></span>)

  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='id identifier rubyid_process_select_args'><a href="#process_select_args-instance_method" title="ActiveRecord::QueryMethods#process_select_args (method)">process_select_args</a></span>(<span class='id identifier rubyid_fields'>fields</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid__select!'><a href="#_select!-instance_method" title="ActiveRecord::QueryMethods#_select! (method)">_select!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_fields'>fields</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="select_association_list-instance_method">
  <h3 class='signature priv'>
    #<strong>select_association_list</strong>(associations, stashed_joins = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1805-L1818'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1805' data-end='1818'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1805</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_select_association_list'>select_association_list</span>(<span class='id identifier rubyid_associations'>associations</span><span class='comma'>,</span> <span class='id identifier rubyid_stashed_joins'>stashed_joins</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_associations'>associations</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_association'>association</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_association'>association</span>
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span><span class='comma'>,</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span><span class='comma'>,</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_association'>association</span>
    <span class='kw'>when</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/JoinDependency.html" title="ActiveRecord::Associations::JoinDependency (class)">JoinDependency</a></span>
      <span class='id identifier rubyid_stashed_joins'>stashed_joins</span><span class='op'>&amp;.</span><span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_association'>association</span>
    <span class='kw'>else</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_association'>association</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="select_named_joins-instance_method">
  <h3 class='signature priv'>
    #<strong>select_named_joins</strong>(join_names, stashed_joins = nil, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1793-L1803'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1793' data-end='1803'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1793</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_select_named_joins'>select_named_joins</span>(<span class='id identifier rubyid_join_names'>join_names</span><span class='comma'>,</span> <span class='id identifier rubyid_stashed_joins'>stashed_joins</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_cte_joins'>cte_joins</span><span class='comma'>,</span> <span class='id identifier rubyid_associations'>associations</span> <span class='op'>=</span> <span class='id identifier rubyid_join_names'>join_names</span>.<span class='id identifier rubyid_partition'>partition</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_join_name'>join_name</span><span class='op'>|</span>
    <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span> <span class='op'>===</span> <span class='id identifier rubyid_join_name'>join_name</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_with_values'>with_values</span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='id identifier rubyid__1'>_1</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_join_name'>join_name</span>) }
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cte_joins'>cte_joins</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cte_name'>cte_name</span><span class='op'>|</span>
    <span class='id identifier rubyid_block'>block</span><span class='op'>&amp;.</span><span class='id identifier rubyid_call'>call</span>(<span class='const'><a href="QueryMethods/CTEJoin.html" title="ActiveRecord::QueryMethods::CTEJoin (class)">CTEJoin</a></span>.<span class='id identifier rubyid_new'><a href="QueryMethods/CTEJoin.html#new-class_method" title="ActiveRecord::QueryMethods::CTEJoin.new (method)">new</a></span>(<span class='id identifier rubyid_cte_name'>cte_name</span>))
  <span class='kw'>end</span>

  <span class='id identifier rubyid_select_association_list'><a href="#select_association_list-instance_method" title="ActiveRecord::QueryMethods#select_association_list (method)">select_association_list</a></span>(<span class='id identifier rubyid_associations'>associations</span><span class='comma'>,</span> <span class='id identifier rubyid_stashed_joins'>stashed_joins</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skip_preloading!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>skip_preloading!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1514-L1517'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1514' data-end='1517'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1514</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_skip_preloading!'>skip_preloading!</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_skip_preloading_value'>skip_preloading_value</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skip_query_cache!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>skip_query_cache!</strong>(value = true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1509-L1512'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1509' data-end='1512'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1509</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_skip_query_cache!'>skip_query_cache!</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_skip_query_cache_value'>skip_query_cache_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="strict_loading-instance_method">
  <h3 class='signature '>
    #<strong>strict_loading</strong>(value = true)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the returned relation to strict_loading mode. This will raise an error if the record tries to lazily load an association.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_strict_loading'>strict_loading</span>.<span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_to_a'>to_a</span>
<span class='comment'># =&gt; ActiveRecord::StrictLoadingViolationError</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1325-L1327'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1325' data-end='1327'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1325</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_strict_loading'>strict_loading</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_strict_loading!'><a href="#strict_loading!-instance_method" title="ActiveRecord::QueryMethods#strict_loading! (method)">strict_loading!</a></span>(<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="strict_loading!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>strict_loading!</strong>(value = true)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1329-L1332'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1329' data-end='1332'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1329</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_strict_loading!'>strict_loading!</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>true</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_strict_loading_value'>strict_loading_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="structurally_compatible?-instance_method">
  <h3 class='signature '>
    #<strong>structurally_compatible?</strong>(other)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks whether the given relation is structurally compatible with this relation, to determine if it’s possible to use the <a href="#and-instance_method" title="ActiveRecord::QueryMethods#and (method)">#and</a> and <a href="#or-instance_method" title="ActiveRecord::QueryMethods#or (method)">#or</a> methods without raising an error. Structurally compatible is defined as: they must be scoping the same model, and they must differ only by <a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">#where</a> (if no <a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a> has been defined) or <a href="#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">#having</a> (if a <a href="#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a> is present).</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id = 1</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_structurally_compatible?'>structurally_compatible?</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>author_id = 3</span><span class='tstring_end'>&quot;</span></span>))
<span class='comment'># =&gt; true
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>).<span class='id identifier rubyid_structurally_compatible?'>structurally_compatible?</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id = 1</span><span class='tstring_end'>&quot;</span></span>))
<span class='comment'># =&gt; false</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1121-L1123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1121' data-end='1123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1121</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_structurally_compatible?'>structurally_compatible?</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='id identifier rubyid_structurally_incompatible_values_for'><a href="#structurally_incompatible_values_for-instance_method" title="ActiveRecord::QueryMethods#structurally_incompatible_values_for (method)">structurally_incompatible_values_for</a></span>(<span class='id identifier rubyid_other'>other</span>).<span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="structurally_incompatible_values_for-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>structurally_incompatible_values_for</strong>(other)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2276-L2287'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2276' data-end='2287'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2276</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_structurally_incompatible_values_for'>structurally_incompatible_values_for</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_values'>values</span>
  <span class='const'><a href="#STRUCTURAL_VALUE_METHODS-constant" title="ActiveRecord::QueryMethods::STRUCTURAL_VALUE_METHODS (constant)">STRUCTURAL_VALUE_METHODS</a></span>.<span class='id identifier rubyid_reject'>reject</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='id identifier rubyid_v1'>v1</span><span class='comma'>,</span> <span class='id identifier rubyid_v2'>v2</span> <span class='op'>=</span> <span class='ivar'>@values</span>[<span class='id identifier rubyid_method'>method</span>]<span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span>[<span class='id identifier rubyid_method'>method</span>]

    <span class='comment'># `and`/`or` are focused to combine where-like clauses, so it relaxes
</span>    <span class='comment'># the difference when other&#39;s multi values are uninitialized.
</span>    <span class='kw'>next</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_v1'>v1</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v2'>v2</span>.<span class='id identifier rubyid_nil?'>nil?</span>

    <span class='id identifier rubyid_v1'>v1</span> <span class='op'>==</span> <span class='id identifier rubyid_v2'>v2</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="table_name_matches?-instance_method">
  <h3 class='signature priv'>
    #<strong>table_name_matches?</strong>(from)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2006-L2010'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2006' data-end='2010'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2006</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_table_name_matches?'>table_name_matches?</span>(<span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span>)
  <span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='const'><a href="../Regexp.html" title="Regexp (class)">Regexp</a></span>.<span class='id identifier rubyid_escape'>escape</span>(<span class='id identifier rubyid_table'>table</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_quoted_table_name'>quoted_table_name</span> <span class='op'>=</span> <span class='const'><a href="../Regexp.html" title="Regexp (class)">Regexp</a></span>.<span class='id identifier rubyid_escape'>escape</span>(<span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_adapter_class'>adapter_class</span>.<span class='id identifier rubyid_quote_table_name'>quote_table_name</span>(<span class='id identifier rubyid_table'>table</span>.<span class='id identifier rubyid_name'>name</span>))
  <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?:\A|(?&lt;!FROM)\s)(?:\b</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_table_name'>table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>\b|</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_quoted_table_name'>quoted_table_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>)(?!\.)</span><span class='regexp_end'>/i</span></span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span>.<span class='id identifier rubyid_to_s'>to_s</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uniq!-instance_method">
  <h3 class='signature '>
    #<strong>uniq!</strong>(name)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deduplicate multiple values.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1542-L1547'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1542' data-end='1547'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1542</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uniq!'>uniq!</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='ivar'>@values</span>[<span class='id identifier rubyid_name'>name</span>]
    <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_uniq!'>uniq!</span> <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unscope-instance_method">
  <h3 class='signature '>
    #<strong>unscope</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes an unwanted relation that is already defined on a chain of relations. This is useful when passing around chains of relations and would like to modify the relations without reconstructing the entire chain.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email DESC</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_unscope'>unscope</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>) <span class='op'>==</span> <span class='const'>User</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span></code></pre>

<p>The method arguments are symbols which correspond to the names of the methods which should be unscoped. The valid arguments are given in <a href="#VALID_UNSCOPING_VALUES-constant" title="ActiveRecord::QueryMethods::VALID_UNSCOPING_VALUES (constant)">VALID_UNSCOPING_VALUES</a>. The method can also be called with multiple arguments. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email DESC</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John</span><span class='tstring_end'>&quot;</span></span>)
    .<span class='id identifier rubyid_unscope'>unscope</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_select'><a href="#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>) <span class='op'>==</span> <span class='const'>User</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span></code></pre>

<p>One can additionally pass a hash as an argument to unscope specific <code>:where</code> values. This is done by passing a hash with a single key-value pair. The key should be <code>:where</code> and the value should be the where value to unscope. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_unscope'>unscope</span>(<span class='label'>where:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>)
    <span class='op'>==</span> <span class='const'>User</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>active:</span> <span class='kw'>true</span>)</code></pre>

<p>This method is similar to <code>#except</code>, but unlike <code>#except</code>, it persists across merges:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_merge'>merge</span>(<span class='const'>User</span>.<span class='id identifier rubyid_except'>except</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>))
    <span class='op'>==</span> <span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email</span><span class='tstring_end'>&#39;</span></span>)

<span class='const'>User</span>.<span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_merge'>merge</span>(<span class='const'>User</span>.<span class='id identifier rubyid_unscope'>unscope</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_order'><a href="#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">order</a></span>))
    <span class='op'>==</span> <span class='const'>User</span>.<span class='id identifier rubyid_all'><a href="#all-instance_method" title="ActiveRecord::QueryMethods#all (method)">all</a></span></code></pre>

<p>This means it can be used in association definitions:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_unscope'>unscope</span>(<span class='label'>where:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_trashed'>trashed</span>) }</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L806-L809'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='806' data-end='809'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 806</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unscope'>unscope</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_unscope!'><a href="#unscope!-instance_method" title="ActiveRecord::QueryMethods#unscope! (method)">unscope!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unscope!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>unscope!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L811-L838'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='811' data-end='838'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 811</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unscope!'>unscope!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_unscope_values'>unscope_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>

  <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_scope'>scope</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_scope'>scope</span>
    <span class='kw'>when</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
      <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_outer_joins'><a href="#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">left_outer_joins</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_scope'>scope</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_joins'><a href="#left_joins-instance_method" title="ActiveRecord::QueryMethods#left_joins (method)">left_joins</a></span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='const'><a href="#VALID_UNSCOPING_VALUES-constant" title="ActiveRecord::QueryMethods::VALID_UNSCOPING_VALUES (constant)">VALID_UNSCOPING_VALUES</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_scope'>scope</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Called unscope() with invalid unscoping argument &#39;:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'>scope</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;. Valid arguments are :</span><span class='embexpr_beg'>#{</span><span class='const'><a href="#VALID_UNSCOPING_VALUES-constant" title="ActiveRecord::QueryMethods::VALID_UNSCOPING_VALUES (constant)">VALID_UNSCOPING_VALUES</a></span>.<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, :</span><span class='tstring_end'>&quot;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_assert_modifiable!'><a href="#assert_modifiable!-instance_method" title="ActiveRecord::QueryMethods#assert_modifiable! (method)">assert_modifiable!</a></span>
      <span class='ivar'>@values</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_scope'>scope</span>)
    <span class='kw'>when</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
      <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_target_value'>target_value</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hash arguments in .unscope(*args) must have :where as the key.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_target_values'>target_values</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_arel_attributes'><a href="#resolve_arel_attributes-instance_method" title="ActiveRecord::QueryMethods#resolve_arel_attributes (method)">resolve_arel_attributes</a></span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_wrap'><a href="../Array.html#wrap-class_method" title="Array.wrap (method)">wrap</a></span>(<span class='id identifier rubyid_target_value'>target_value</span>))
        <span class='kw'>self</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_except'>except</span>(<span class='op'>*</span><span class='id identifier rubyid_target_values'>target_values</span>)
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unrecognized scoping: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Use .unscope(where: :attribute_name) or .unscope(:order), for example.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_order_args-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_order_args</strong>(args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L2073-L2085'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2073' data-end='2085'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 2073</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_order_args'>validate_order_args</span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)
    <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__key'>_key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)
        <span class='id identifier rubyid_validate_order_args'>validate_order_args</span>([<span class='id identifier rubyid_value'>value</span>])
      <span class='kw'>elsif</span> <span class='const'><a href="#VALID_DIRECTIONS-constant" title="ActiveRecord::QueryMethods::VALID_DIRECTIONS (constant)">VALID_DIRECTIONS</a></span>.<span class='id identifier rubyid_exclude?'>exclude?</span>(<span class='id identifier rubyid_value'>value</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Direction \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_content'>\&quot; is invalid. Valid directions are: </span><span class='embexpr_beg'>#{</span><span class='const'><a href="#VALID_DIRECTIONS-constant" title="ActiveRecord::QueryMethods::VALID_DIRECTIONS (constant)">VALID_DIRECTIONS</a></span>.<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="where-instance_method">
  <h3 class='signature '>
    #<strong>where</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a new relation, which is the result of filtering the current relation according to the conditions in the arguments.</p>

<p><code>#where</code> accepts conditions in one of several formats. In the examples below, the resulting SQL is given as an illustration; the actual query generated may be different depending on the database adapter.</p>

<h4 id="label-String">String</h4>

<p>A single string, without additional arguments, is passed to the query constructor as an SQL fragment, and used in the where clause of the query.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Client</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>orders_count = &#39;2&#39;</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># SELECT * from clients where orders_count = &#39;2&#39;;</span></code></pre>

<p>Note that building your own string from user input may expose your application to injection attacks if not done properly. As an alternative, it is recommended to use one of the following methods.</p>

<h4 id="label-Array">Array</h4>

<p>If an array is passed, then the first element of the array is treated as a template, and the remaining elements are inserted into the template to generate the condition. Active Record takes care of building the query to avoid injection attacks, and will convert from the ruby type to the database type where needed. Elements are inserted into the string in the order in which they appear.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name = ? and email = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>joe@example.com</span><span class='tstring_end'>&quot;</span></span>])
<span class='comment'># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span></code></pre>

<p>Alternatively, you can use named placeholders in the template, and pass a hash as the second element of the array. The names in the template are replaced with the corresponding values from the hash.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name = :name and email = :email</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>email:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>joe@example.com</span><span class='tstring_end'>&quot;</span></span> }])
<span class='comment'># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span></code></pre>

<p>This can make for more readable code in complex queries.</p>

<p>Lastly, you can use sprintf-style % escapes in the template. This works slightly differently than the previous methods; you are responsible for ensuring that the values in the template are properly quoted. The values are passed to the connector for quoting, but the caller is responsible for ensuring they are enclosed in quotes in the resulting SQL. After quoting, the values are inserted using the same escapes as the Ruby core method <code>Kernel::sprintf</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name = &#39;%s&#39; and email = &#39;%s&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>joe@example.com</span><span class='tstring_end'>&quot;</span></span>])
<span class='comment'># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span></code></pre>

<p>If <code>#where</code> is called with multiple arguments, these are treated as if they were passed as the elements of a single array.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name = :name and email = :email</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>email:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>joe@example.com</span><span class='tstring_end'>&quot;</span></span> })
<span class='comment'># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;;</span></code></pre>

<p>When using strings to specify conditions, you can use any operator available from the database. While this provides the most flexibility, you can also unintentionally introduce dependencies on the underlying database. If your code is intended for general consumption, test with multiple database backends.</p>

<h4 id="label-Hash">Hash</h4>

<p><code>#where</code> will also accept a hash condition, in which the keys are fields and the values are values to be searched for.</p>

<p>Fields can be symbols or strings. Values can be single values, arrays, or ranges.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Joe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>email:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>joe@example.com</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># SELECT * FROM users WHERE name = &#39;Joe&#39; AND email = &#39;joe@example.com&#39;
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Alice</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&quot;</span></span>])
<span class='comment'># SELECT * FROM users WHERE name IN (&#39;Alice&#39;, &#39;Bob&#39;)
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>created_at:</span> (<span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>.<span class='id identifier rubyid_midnight'>midnight</span> <span class='op'>-</span> <span class='int'>1</span>.<span class='id identifier rubyid_day'>day</span>)<span class='op'>..</span><span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>.<span class='id identifier rubyid_midnight'>midnight</span>)
<span class='comment'># SELECT * FROM users WHERE (created_at BETWEEN &#39;2012-06-09 07:00:00.000000&#39; AND &#39;2012-06-10 07:00:00.000000&#39;)</span></code></pre>

<p>In the case of a belongs_to relationship, an association key can be used to specify the model if an <a href="../ActiveRecord.html" title="ActiveRecord (module)"><code>::ActiveRecord</code></a> object is used as the value.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> <span class='const'>Author</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>)

<span class='comment'># The following queries will be equivalent:
</span><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>author:</span> <span class='id identifier rubyid_author'>author</span>)
<span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>author_id:</span> <span class='id identifier rubyid_author'>author</span>)</code></pre>

<p>This also works with polymorphic belongs_to relationships:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_treasure'>treasure</span> <span class='op'>=</span> <span class='const'>Treasure</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gold coins</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_treasure'>treasure</span>.<span class='id identifier rubyid_price_estimates'>price_estimates</span> <span class='op'>&lt;&lt;</span> <span class='const'>PriceEstimate</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>price:</span> <span class='int'>125</span>)

<span class='comment'># The following queries will be equivalent:
</span><span class='const'>PriceEstimate</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>estimate_of:</span> <span class='id identifier rubyid_treasure'>treasure</span>)
<span class='const'>PriceEstimate</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>estimate_of_type:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Treasure</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>estimate_of_id:</span> <span class='id identifier rubyid_treasure'>treasure</span>)</code></pre>

<p><a href="../Hash.html" title="Hash (class)"><code>::Hash</code></a> conditions may also be specified in a tuple-like syntax. <a href="../Hash.html" title="Hash (class)"><code>::Hash</code></a> keys may be an array of columns with an array of tuples as values.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_where'>where</span>([<span class='symbeg'>:</span><span class='id identifier rubyid_author_id'>author_id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>] <span class='op'>=&gt;</span> [[<span class='int'>15</span><span class='comma'>,</span> <span class='int'>1</span>]<span class='comma'>,</span> [<span class='int'>15</span><span class='comma'>,</span> <span class='int'>2</span>]])
<span class='comment'># SELECT * FROM articles WHERE author_id = 15 AND id = 1 OR author_id = 15 AND id = 2</span></code></pre>

<h4 id="label-Joins">Joins</h4>

<p>If the relation is the result of a join, you may create a condition which uses any of the tables in the join. For string and array conditions, use the table name in the condition.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts.created_at &lt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>)</code></pre>

<p>For hash conditions, you can either use the table name in the key, or use a sub-hash.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts.published</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)
<span class='const'>User</span>.<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_where'>where</span>(<span class='label'>posts:</span> { <span class='label'>published:</span> <span class='kw'>true</span> })</code></pre>

<h4 id="label-No+Argument">No Argument</h4>

<p>If no argument is passed, <code>#where</code> returns a new instance of <a href="QueryMethods/WhereChain.html" title="ActiveRecord::QueryMethods::WhereChain (class)"><code>QueryMethods::WhereChain</code></a>, that can be chained with <a href="QueryMethods/WhereChain.html#not-instance_method" title="ActiveRecord::QueryMethods::WhereChain#not (method)">WhereChain#not</a>, <a href="QueryMethods/WhereChain.html#missing-instance_method" title="ActiveRecord::QueryMethods::WhereChain#missing (method)">WhereChain#missing</a>, or <a href="QueryMethods/WhereChain.html#associated-instance_method" title="ActiveRecord::QueryMethods::WhereChain#associated (method)">WhereChain#associated</a>.</p>

<p>Chaining with <a href="QueryMethods/WhereChain.html#not-instance_method" title="ActiveRecord::QueryMethods::WhereChain#not (method)">WhereChain#not</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>.<span class='id identifier rubyid_not'>not</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jon</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># SELECT * FROM users WHERE name != &#39;Jon&#39;</span></code></pre>

<p>Chaining with <a href="QueryMethods/WhereChain.html#associated-instance_method" title="ActiveRecord::QueryMethods::WhereChain#associated (method)">WhereChain#associated</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>.<span class='id identifier rubyid_associated'>associated</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>)
<span class='comment'># SELECT &quot;posts&quot;.* FROM &quot;posts&quot;
</span><span class='comment'># INNER JOIN &quot;authors&quot; ON &quot;authors&quot;.&quot;id&quot; = &quot;posts&quot;.&quot;author_id&quot;
</span><span class='comment'># WHERE &quot;authors&quot;.&quot;id&quot; IS NOT NULL</span></code></pre>

<p>Chaining with <a href="QueryMethods/WhereChain.html#missing-instance_method" title="ActiveRecord::QueryMethods::WhereChain#missing (method)">WhereChain#missing</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>.<span class='id identifier rubyid_missing'>missing</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>)
<span class='comment'># SELECT &quot;posts&quot;.* FROM &quot;posts&quot;
</span><span class='comment'># LEFT OUTER JOIN &quot;authors&quot; ON &quot;authors&quot;.&quot;id&quot; = &quot;posts&quot;.&quot;author_id&quot;
</span><span class='comment'># WHERE &quot;authors&quot;.&quot;id&quot; IS NULL</span></code></pre>

<h4 id="label-Blank+Condition">Blank Condition</h4>

<p>If the condition is any blank-ish object, then <code>#where</code> is a no-op and returns the current relation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1033-L1041'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1033' data-end='1041'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1033</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_where'>where</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'><a href="QueryMethods/WhereChain.html" title="ActiveRecord::QueryMethods::WhereChain (class)">WhereChain</a></span>.<span class='id identifier rubyid_new'><a href="QueryMethods/WhereChain.html#new-class_method" title="ActiveRecord::QueryMethods::WhereChain.new (method)">new</a></span>(<span class='id identifier rubyid_spawn'>spawn</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>self</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_where!'><a href="#where!-instance_method" title="ActiveRecord::QueryMethods#where! (method)">where!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="where!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>where!</strong>(opts, *rest)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1043-L1046'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1043' data-end='1046'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1043</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_where!'>where!</span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_where_clause'>where_clause</span> <span class='op'>+=</span> <span class='id identifier rubyid_build_where_clause'><a href="#build_where_clause-instance_method" title="ActiveRecord::QueryMethods#build_where_clause (method)">build_where_clause</a></span>(<span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with-instance_method">
  <h3 class='signature '>
    #<strong>with</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add a Common Table Expression (CTE) that you can then reference within another SELECT statement.</p>

<p>Note: CTE’s are only supported in MySQL for versions 8.0 and above. You will not be able to use CTE’s with MySQL 5.7.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>posts_with_tags:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>))
<span class='comment'># =&gt; ActiveRecord::Relation
</span><span class='comment'># WITH posts_with_tags AS (
</span><span class='comment'>#   SELECT * FROM posts WHERE (tags_count &gt; 0)
</span><span class='comment'># )
</span><span class='comment'># SELECT * FROM posts</span></code></pre>

<p>You can also pass an array of sub-queries to be joined in a <tt>UNION ALL</tt>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>posts_with_tags_or_comments:</span> [<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)<span class='comma'>,</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)])
<span class='comment'># =&gt; ActiveRecord::Relation
</span><span class='comment'># WITH posts_with_tags_or_comments AS (
</span><span class='comment'>#  (SELECT * FROM posts WHERE (tags_count &gt; 0))
</span><span class='comment'>#  UNION ALL
</span><span class='comment'>#  (SELECT * FROM posts WHERE (comments_count &gt; 0))
</span><span class='comment'># )
</span><span class='comment'># SELECT * FROM posts</span></code></pre>

<p>Once you define Common Table Expression you can use custom <code>FROM</code> value or <code>JOIN</code> to reference it.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>posts_with_tags:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)).<span class='id identifier rubyid_from'><a href="#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">from</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts_with_tags AS posts</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; ActiveRecord::Relation
</span><span class='comment'># WITH posts_with_tags AS (
</span><span class='comment'>#  SELECT * FROM posts WHERE (tags_count &gt; 0)
</span><span class='comment'># )
</span><span class='comment'># SELECT * FROM posts_with_tags AS posts
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>posts_with_tags:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)).<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JOIN posts_with_tags ON posts_with_tags.id = posts.id</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; ActiveRecord::Relation
</span><span class='comment'># WITH posts_with_tags AS (
</span><span class='comment'>#   SELECT * FROM posts WHERE (tags_count &gt; 0)
</span><span class='comment'># )
</span><span class='comment'># SELECT * FROM posts JOIN posts_with_tags ON posts_with_tags.id = posts.id</span></code></pre>

<p>It is recommended to pass a query as <a href="Relation.html" title="ActiveRecord::Relation (class)"><code>Relation</code></a>. If that is not possible and you have verified it is safe for the database, you can pass it as SQL literal using <a href="../Arel.html" title="Arel (module)"><code>::Arel</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>popular_posts:</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>... complex sql to calculate posts popularity ...</span><span class='tstring_end'>&quot;</span></span>))</code></pre>

<p>Great caution should be taken to avoid SQL injection vulnerabilities. This method should not be used with unsafe values that include unsanitized input.</p>

<p>To add multiple CTEs just pass multiple key-value pairs</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with'>with</span>(
  <span class='label'>posts_with_comments:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)<span class='comma'>,</span>
  <span class='label'>posts_with_tags:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>)
)</code></pre>

<p>or chain multiple <code>#with</code> calls</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>
  .<span class='id identifier rubyid_with'>with</span>(<span class='label'>posts_with_comments:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>))
  .<span class='id identifier rubyid_with'>with</span>(<span class='label'>posts_with_tags:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tags_count &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>))</code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L493-L497'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='493' data-end='497'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 493</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with'>with</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ActiveRecord::Relation#with does not accept a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_with!'><a href="#with!-instance_method" title="ActiveRecord::QueryMethods#with! (method)">with!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>with!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">#with</a>, but modifies relation in place.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L500-L504'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='500' data-end='504'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 500</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with!'>with!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='id identifier rubyid_process_with_args'><a href="#process_with_args-instance_method" title="ActiveRecord::QueryMethods#process_with_args (method)">process_with_args</a></span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_with_values'>with_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_recursive-instance_method">
  <h3 class='signature '>
    #<strong>with_recursive</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add a recursive Common Table Expression (CTE) that you can then reference within another SELECT statement.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with_recursive'>with_recursive</span>(<span class='label'>post_and_replies:</span> [<span class='const'>Post</span>.<span class='id identifier rubyid_where'><a href="#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">where</a></span>(<span class='label'>id:</span> <span class='int'>42</span>)<span class='comma'>,</span> <span class='const'>Post</span>.<span class='id identifier rubyid_joins'><a href="#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">joins</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>JOIN post_and_replies ON posts.in_reply_to_id = post_and_replies.id</span><span class='tstring_end'>&#39;</span></span>)])
<span class='comment'># =&gt; ActiveRecord::Relation
</span><span class='comment'># WITH RECURSIVE post_and_replies AS (
</span><span class='comment'>#   (SELECT * FROM posts WHERE id = 42)
</span><span class='comment'>#   UNION ALL
</span><span class='comment'>#   (SELECT * FROM posts JOIN post_and_replies ON posts.in_reply_to_id = post_and_replies.id)
</span><span class='comment'># )
</span><span class='comment'># SELECT * FROM posts</span></code></pre>

<p>See <a href="#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">#with</a> for more information.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L518-L521'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='518' data-end='521'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 518</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_recursive'>with_recursive</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_check_if_method_has_arguments!'><a href="#check_if_method_has_arguments!-instance_method" title="ActiveRecord::QueryMethods#check_if_method_has_arguments! (method)">check_if_method_has_arguments!</a></span>(<span class='id identifier rubyid___callee__'>__callee__</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_spawn'>spawn</span>.<span class='id identifier rubyid_with_recursive!'><a href="#with_recursive!-instance_method" title="ActiveRecord::QueryMethods#with_recursive! (method)">with_recursive!</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_recursive!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>with_recursive!</strong>(*args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#with_recursive-instance_method" title="ActiveRecord::QueryMethods#with_recursive (method)">#with_recursive</a> but modifies the relation in place.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L524-L529'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='524' data-end='529'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 524</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_recursive!'>with_recursive!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='id identifier rubyid_process_with_args'><a href="#process_with_args-instance_method" title="ActiveRecord::QueryMethods#process_with_args (method)">process_with_args</a></span>(<span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_with_values'>with_values</span> <span class='op'>|=</span> <span class='id identifier rubyid_args'>args</span>
  <span class='ivar'>@with_is_recursive</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="without-instance_method">
  <h3 class='signature '>
    #<strong>without</strong>(*records)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#excluding-instance_method" title="ActiveRecord::QueryMethods#excluding (method)">#excluding</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/relation/query_methods.rb#L1586-L1586'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1586' data-end='1586'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation/query_methods.rb', line 1586</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_without'>without</span> <span class='symbeg'>:</span><span class='id identifier rubyid_excluding'><a href="#excluding-instance_method" title="ActiveRecord::QueryMethods#excluding (method)">excluding</a></span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>