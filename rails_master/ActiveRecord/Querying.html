<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Querying &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Querying",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_Q'>Index (Q)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Querying&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::Querying</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This module is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Extended In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActiveRecord::Base (class)"><code>Base</code></a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L4'>activerecord/lib/active_record/querying.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='QUERYING_METHODS-constant' class='summary_signature nodoc'>QUERYING_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L5-L22'># File 'activerecord/lib/active_record/querying.rb', line 5</a>    <pre class='code ruby'>[
  <span class='symbeg'>:</span><span class='id identifier rubyid_find'>find</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_find_by'>find_by</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_find_by!'>find_by!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_take'>take</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_take!'>take!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_sole'>sole</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_find_sole_by'>find_sole_by</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first!'>first!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_last'>last</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_last!'>last!</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_second'>second</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_second!'>second!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_third'>third</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_third!'>third!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fourth'>fourth</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fourth!'>fourth!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fifth'>fifth</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fifth!'>fifth!</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_forty_two'>forty_two</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_forty_two!'>forty_two!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_third_to_last'>third_to_last</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_third_to_last!'>third_to_last!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_second_to_last'>second_to_last</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_second_to_last!'>second_to_last!</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_exists?'>exists?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_any?'>any?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_many?'>many?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_none?'>none?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_one?'>one?</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_first_or_create'>first_or_create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_or_create!'>first_or_create!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_first_or_initialize'>first_or_initialize</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_find_or_create_by!'>find_or_create_by!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_find_or_initialize_by'>find_or_initialize_by</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_create_or_find_by'>create_or_find_by</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create_or_find_by!'>create_or_find_by!</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_destroy_all'>destroy_all</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete_all'>delete_all</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update_all'>update_all</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_touch_all'>touch_all</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy_by'>destroy_by</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete_by'>delete_by</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_find_each'>find_each</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_find_in_batches'>find_in_batches</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_in_batches'>in_batches</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_select'>select</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reselect'>reselect</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_order'>order</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_regroup'>regroup</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_in_order_of'>in_order_of</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reorder'>reorder</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_group'>group</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_joins'>joins</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_joins'>left_joins</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_outer_joins'>left_outer_joins</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_where'>where</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rewhere'>rewhere</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invert_where'>invert_where</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload'>preload</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_extract_associated'>extract_associated</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_eager_load'>eager_load</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_includes'>includes</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_lock'>lock</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_readonly'>readonly</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='kw'>and</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='kw'>or</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_annotate'>annotate</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optimizer_hints'>optimizer_hints</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_extending'>extending</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_having'>having</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create_with'>create_with</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_distinct'>distinct</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_references'>references</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unscope'>unscope</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_merge'>merge</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_except'>except</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_only'>only</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_average'>average</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_minimum'>minimum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_maximum'>maximum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_calculate'>calculate</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_pluck'>pluck</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pick'>pick</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ids'>ids</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_ids'>async_ids</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_strict_loading'>strict_loading</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_excluding'>excluding</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_without'>without</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_with'>with</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_async_count'>async_count</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_average'>async_average</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_minimum'>async_minimum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_maximum'>async_maximum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_sum'>async_sum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_pluck'>async_pluck</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async_pick'>async_pick</span><span class='comma'>,</span>
].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_load_from_sql-instance_method" title="#_load_from_sql (instance method)">#<strong>_load_from_sql</strong>(result_set, &amp;block)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_query_by_sql-instance_method" title="#_query_by_sql (instance method)">#<strong>_query_by_sql</strong>(sql, binds = [], preparable: nil, async: false)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#async_count_by_sql-instance_method" title="#async_count_by_sql (instance method)">#<strong>async_count_by_sql</strong>(sql)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#count_by_sql-instance_method" title="ActiveRecord::Querying#count_by_sql (method)">#count_by_sql</a> but perform the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#async_find_by_sql-instance_method" title="#async_find_by_sql (instance method)">#<strong>async_find_by_sql</strong>(sql, binds = [], preparable: nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#find_by_sql-instance_method" title="ActiveRecord::Querying#find_by_sql (method)">#find_by_sql</a> but perform the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#count_by_sql-instance_method" title="#count_by_sql (instance method)">#<strong>count_by_sql</strong>(sql)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the result of an SQL statement that should only include a COUNT(*) in the SELECT part.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#find_by_sql-instance_method" title="#find_by_sql (instance method)">#<strong>find_by_sql</strong>(sql, binds = [], preparable: nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Executes a custom SQL query against your database and returns all the results.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_load_from_sql-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>_load_from_sql</strong>(result_set, &amp;block)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L65-L87'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='65' data-end='87'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 65</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__load_from_sql'>_load_from_sql</span>(<span class='id identifier rubyid_result_set'>result_set</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_column_types'>column_types</span> <span class='op'>=</span> <span class='id identifier rubyid_result_set'>result_set</span>.<span class='id identifier rubyid_column_types'>column_types</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_column_types'>column_types</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_column_types'>column_types</span> <span class='op'>=</span> <span class='id identifier rubyid_column_types'>column_types</span>.<span class='id identifier rubyid_reject'>reject</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_attribute_types'>attribute_types</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_k'>k</span>) }
  <span class='kw'>end</span>

  <span class='id identifier rubyid_message_bus'>message_bus</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Notifications.html" title="ActiveSupport::Notifications (module)">Notifications</a></span>.<span class='id identifier rubyid_instrumenter'><a href="../ActiveSupport/Notifications.html#instrumenter-class_method" title="ActiveSupport::Notifications.instrumenter (method)">instrumenter</a></span>

  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> {
    <span class='label'>record_count:</span> <span class='id identifier rubyid_result_set'>result_set</span>.<span class='id identifier rubyid_length'>length</span><span class='comma'>,</span>
    <span class='label'>class_name:</span> <span class='id identifier rubyid_name'>name</span>
  }

  <span class='id identifier rubyid_message_bus'>message_bus</span>.<span class='id identifier rubyid_instrument'>instrument</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>instantiation.active_record</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span>) <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_result_set'>result_set</span>.<span class='id identifier rubyid_includes_column?'>includes_column?</span>(<span class='id identifier rubyid_inheritance_column'>inheritance_column</span>)
      <span class='id identifier rubyid_result_set'>result_set</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_instantiate'>instantiate</span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
    <span class='kw'>else</span>
      <span class='comment'># Instantiate a homogeneous set
</span>      <span class='id identifier rubyid_result_set'>result_set</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_instantiate_instance_of'>instantiate_instance_of</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_query_by_sql-instance_method">
  <h3 class='signature nodoc'>
    #<strong>_query_by_sql</strong>(sql, binds = [], preparable: nil, async: false)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L61-L63'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='61' data-end='63'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 61</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__query_by_sql'>_query_by_sql</span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span> <span class='op'>=</span> []<span class='comma'>,</span> <span class='label'>preparable:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>async:</span> <span class='kw'>false</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_lease_connection'>lease_connection</span>.<span class='id identifier rubyid_select_all'>select_all</span>(<span class='id identifier rubyid_sanitize_sql'>sanitize_sql</span>(<span class='id identifier rubyid_sql'>sql</span>)<span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> Load</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='comma'>,</span> <span class='label'>preparable:</span> <span class='id identifier rubyid_preparable'>preparable</span><span class='comma'>,</span> <span class='label'>async:</span> <span class='id identifier rubyid_async'>async</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="async_count_by_sql-instance_method">
  <h3 class='signature nodoc'>
    #<strong>async_count_by_sql</strong>(sql)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#count_by_sql-instance_method" title="ActiveRecord::Querying#count_by_sql (method)">#count_by_sql</a> but perform the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L106-L108'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='106' data-end='108'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 106</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_async_count_by_sql'>async_count_by_sql</span>(<span class='id identifier rubyid_sql'>sql</span>)
  <span class='id identifier rubyid_lease_connection'>lease_connection</span>.<span class='id identifier rubyid_select_value'>select_value</span>(<span class='id identifier rubyid_sanitize_sql'>sanitize_sql</span>(<span class='id identifier rubyid_sql'>sql</span>)<span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> Count</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>async:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_then'>then</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_i'>to_i</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="async_find_by_sql-instance_method">
  <h3 class='signature nodoc'>
    #<strong>async_find_by_sql</strong>(sql, binds = [], preparable: nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#find_by_sql-instance_method" title="ActiveRecord::Querying#find_by_sql (method)">#find_by_sql</a> but perform the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L55-L59'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='55' data-end='59'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 55</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_async_find_by_sql'>async_find_by_sql</span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span> <span class='op'>=</span> []<span class='comma'>,</span> <span class='label'>preparable:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid__query_by_sql'><a href="#_query_by_sql-instance_method" title="ActiveRecord::Querying#_query_by_sql (method)">_query_by_sql</a></span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='comma'>,</span> <span class='label'>preparable:</span> <span class='id identifier rubyid_preparable'>preparable</span><span class='comma'>,</span> <span class='label'>async:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
    <span class='id identifier rubyid__load_from_sql'><a href="#_load_from_sql-instance_method" title="ActiveRecord::Querying#_load_from_sql (method)">_load_from_sql</a></span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="count_by_sql-instance_method">
  <h3 class='signature nodoc'>
    #<strong>count_by_sql</strong>(sql)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the result of an SQL statement that should only include a COUNT(*) in the SELECT part. The use of this method should be restricted to complicated SQL queries that can’t be executed using the <a href="Calculations.html" title="ActiveRecord::Calculations (module)"><code>Calculations</code></a> class methods. Look into those before using this method, as it could lock you into a specific database engine or require a code change to switch database engines.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Product</span>.<span class='id identifier rubyid_count_by_sql'>count_by_sql</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT COUNT(*) FROM sales s, customers c WHERE s.customer_id = c.id</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># =&gt; 12</span></code></pre>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>sql</code> - An SQL statement which should return a count query from the database, see the example above.</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L101-L103'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='101' data-end='103'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 101</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_count_by_sql'>count_by_sql</span>(<span class='id identifier rubyid_sql'>sql</span>)
  <span class='id identifier rubyid_lease_connection'>lease_connection</span>.<span class='id identifier rubyid_select_value'>select_value</span>(<span class='id identifier rubyid_sanitize_sql'>sanitize_sql</span>(<span class='id identifier rubyid_sql'>sql</span>)<span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> Count</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_by_sql-instance_method">
  <h3 class='signature nodoc'>
    #<strong>find_by_sql</strong>(sql, binds = [], preparable: nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Executes a custom SQL query against your database and returns all the results. The results will be returned as an array, with the requested columns encapsulated as attributes of the model you call this method from. For example, if you call <code>Product.find_by_sql</code>, then the results will be returned in a <code>Product</code> object with the attributes you specified in the SQL query.</p>

<p>If you call a complicated SQL query which spans multiple tables, the columns specified by the SELECT will be attributes of the model, whether or not they are columns of the corresponding table.</p>

<p>The <code>sql</code> parameter is a full SQL query as a string. It will be called as is; there will be no database agnostic conversions performed. This should be a last resort because using database-specific terms will lock you into using that particular database engine, or require you to change your call if you switch engines.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># A simple SQL query spanning multiple tables
</span><span class='const'>Post</span>.<span class='id identifier rubyid_find_by_sql'>find_by_sql</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT p.title, c.author FROM posts p, comments c WHERE p.id = c.post_id</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># =&gt; [#&lt;Post:0x36bff9c @attributes={&quot;title&quot;=&gt;&quot;Ruby Meetup&quot;, &quot;author&quot;=&gt;&quot;Quentin&quot;}&gt;, ...]</span></code></pre>

<p>You can use the same string replacement techniques as you can with <a href="QueryMethods.html#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">QueryMethods#where</a> :</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_find_by_sql'>find_by_sql</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT title FROM posts WHERE author = ? AND created &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_author_id'>author_id</span><span class='comma'>,</span> <span class='id identifier rubyid_start_date'>start_date</span>]
<span class='const'>Post</span>.<span class='id identifier rubyid_find_by_sql'>find_by_sql</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT body FROM comments WHERE author = :user_id OR approved_by = :user_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span> }]</code></pre>

<p>Note that building your own SQL query string from user input may expose your application to injection attacks (<a href="https://guides.rubyonrails.org/security.html#sql-injection">guides.rubyonrails.org/security.html#sql-injection</a>).</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/active_record/querying.rb#L50-L52'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='52'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_by_sql'>find_by_sql</span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span> <span class='op'>=</span> []<span class='comma'>,</span> <span class='label'>preparable:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid__load_from_sql'><a href="#_load_from_sql-instance_method" title="ActiveRecord::Querying#_load_from_sql (method)">_load_from_sql</a></span>(<span class='id identifier rubyid__query_by_sql'><a href="#_query_by_sql-instance_method" title="ActiveRecord::Querying#_query_by_sql (method)">_query_by_sql</a></span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='comma'>,</span> <span class='label'>preparable:</span> <span class='id identifier rubyid_preparable'>preparable</span>)<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>