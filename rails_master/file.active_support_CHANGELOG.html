<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Active Support CHANGELOG &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "active_support_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Active Support CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<ul>
<li><p>Remove deprecated passing a <a href="Time.html" title="Time (class)"><code>Time</code></a> object to <a href="Time.html#since-instance_method" title="Time#since (method)">Time#since</a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>Benchmark.ms</code> method. It is now defined in the <code>benchmark</code> gem.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated addition for <a href="Time.html" title="Time (class)"><code>Time</code></a> instances with <a href="ActiveSupport/TimeWithZone.html" title="ActiveSupport::TimeWithZone (class)"><code>::ActiveSupport::TimeWithZone</code></a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support for <code>to_time</code> to preserve the system local time. It will now always preserve the receiver
timezone.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>config.active_support.to_time_preserves_timezone</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Standardize event name formatting in <code>assert_event_reported</code> error messages.</p>

<p>The event name in failure messages now uses <code>.inspect</code> (e.g., <code>name: &quot;user.created&quot;</code>)
to match <code>assert_events_reported</code> and provide type clarity between strings and symbols.
This only affects tests that assert on the failure message format itself.</p>

<p><em>George Ma</em></p></li>
<li><p>Fix <a href="Enumerable.html#sole-instance_method" title="Enumerable#sole (method)">Enumerable#sole</a> to return the full tuple instead of just the first element of the tuple.</p>

<p><em>Olivier Bellone</em></p></li>
<li><p>Fix parallel tests hanging when worker processes die abruptly.</p>

<p>Previously, if a worker process was killed (e.g., OOM killed, <code>kill -9</code>) during parallel
test execution, the test suite would hang forever waiting for the dead worker.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Add <code>config.active_support.escape_js_separators_in_json</code>.</p>

<p>Introduce a new framework default to skip escaping LINE SEPARATOR (U+2028) and PARAGRAPH SEPARATOR (U+2029) in JSON.</p>

<p>Historically these characters were not valid inside JavaScript literal strings but that changed in ECMAScript 2019.
As such it&#39;s no longer a concern in modern browsers: <a href="https://caniuse.com/mdn-javascript_builtins_json_json_superset">https://caniuse.com/mdn-javascript_builtins_json_json_superset</a>.</p>

<p><em>Étienne Barrié</em>, <em>Jean Boussier</em></p></li>
<li><p>Fix <a href="NameError.html" title="NameError (class)"><code>NameError</code></a> when <code>class_attribute</code> is defined on instance singleton classes.</p>

<p>Previously, calling <code>class_attribute</code> on an instance&#39;s singleton class would raise
a <a href="NameError.html" title="NameError (class)"><code>NameError</code></a> when accessing the attribute through the instance.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='const'>MyClass</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_singleton_class'>singleton_class</span>.<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_foo'>foo</span> <span class='comment'># previously raised NameError, now returns &quot;bar&quot;</span></code></pre>

<p><em>Joshua Young</em></p></li>
<li><p>Introduce <a href="ActiveSupport/Testing/EventReporterAssertions.html#with_debug_event_reporting-instance_method" title="ActiveSupport::Testing::EventReporterAssertions#with_debug_event_reporting (method)">ActiveSupport::Testing::EventReporterAssertions#with_debug_event_reporting</a>
to enable event reporter debug mode in tests.</p>

<p>The previous way to enable debug mode is by using <code>#with_debug</code> on the
event reporter itself, which is too verbose. This new helper will help
clear up any confusion on how to test debug events.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Add <a href="ActiveSupport/StructuredEventSubscriber.html" title="ActiveSupport::StructuredEventSubscriber (class)"><code>::ActiveSupport::StructuredEventSubscriber</code></a> for consuming notifications and
emitting structured event logs. Events may be emitted with the <code>#emit_event</code>
or <code>#emit_debug_event</code> methods.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyStructuredEventSubscriber</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/StructuredEventSubscriber.html" title="ActiveSupport::StructuredEventSubscriber (class)">StructuredEventSubscriber</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_notification'>notification</span>(<span class='id identifier rubyid_event'>event</span>)
    <span class='id identifier rubyid_emit_event'>emit_event</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my.notification</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>data:</span> <span class='int'>1</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Adrianna Chang</em></p></li>
<li><p><a href="ActiveSupport/FileUpdateChecker.html" title="ActiveSupport::FileUpdateChecker (class)"><code>::ActiveSupport::FileUpdateChecker</code></a> does not depend on <code>Time.now</code> to prevent unecessary reloads with time travel test helpers</p>

<p><em>Jan Grodowski</em></p></li>
</ul>

<h2>Rails 8.1.0.beta1 (September 04, 2025)</h2>

<ul>
<li><p>Add <a href="ActiveSupport/Cache/Store.html#namespace=-instance_method" title="ActiveSupport::Cache::Store#namespace= (method)">ActiveSupport::Cache::Store#namespace=</a> and <code>#namespace</code>.</p>

<p>Can be used as an alternative to <code>Store#clear</code> in some situations such as parallel
testing.</p>

<p><em>Nick Schwaderer</em></p></li>
<li><p>Create <code>parallel_worker_id</code> helper for running parallel tests. This allows users to
know which worker they are currently running in.</p>

<p><em>Nick Schwaderer</em></p></li>
<li><p>Make the cache of <a href="ActiveSupport/Cache/Strategy/LocalCache/Middleware.html" title="ActiveSupport::Cache::Strategy::LocalCache::Middleware (class)"><code>::ActiveSupport::Cache::Strategy::LocalCache::Middleware</code></a> updatable.</p>

<p>If the cache client at <a href="Rails.html#cache-class_method" title="Rails.cache (method)">Rails.cache</a> of a booted application changes, the corresponding
mounted middleware needs to update in order for request-local caches to be setup properly.
Otherwise, redundant cache operations will erroneously hit the datastore.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Add <code>assert_events_reported</code> test helper for <a href="ActiveSupport/EventReporter.html" title="ActiveSupport::EventReporter (class)"><code>::ActiveSupport::EventReporter</code></a>.</p>

<p>This new assertion allows testing multiple events in a single block, regardless of order:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert_events_reported'>assert_events_reported</span>([
  { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>payload:</span> { <span class='label'>id:</span> <span class='int'>123</span> } }<span class='comma'>,</span>
  { <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email.sent</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>payload:</span> { <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user@example.com</span><span class='tstring_end'>&quot;</span></span> } }
]) <span class='kw'>do</span>
  <span class='id identifier rubyid_create_user_and_send_welcome_email'>create_user_and_send_welcome_email</span>
<span class='kw'>end</span></code></pre>

<p><em>George Ma</em></p></li>
<li><p>Add <a href="ActiveSupport/TimeZone.html#standard_name-instance_method" title="ActiveSupport::TimeZone#standard_name (method)">ActiveSupport::TimeZone#standard_name</a> method.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_zone'>zone</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TimeZone.html" title="ActiveSupport::TimeZone (class)">TimeZone</a></span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hawaii</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'># Old way
</span><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TimeZone.html" title="ActiveSupport::TimeZone (class)">TimeZone</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TimeZone.html#MAPPING-constant" title="ActiveSupport::TimeZone::MAPPING (constant)">MAPPING</a></span>[<span class='id identifier rubyid_zone'>zone</span>.<span class='id identifier rubyid_name'>name</span>]
<span class='comment'># New way
</span><span class='id identifier rubyid_zone'>zone</span>.<span class='id identifier rubyid_standard_name'>standard_name</span> <span class='comment'># =&gt; &#39;Pacific/Honolulu&#39;</span></code></pre>

<p><em>Bogdan Gusiev</em></p></li>
<li><p>Add Structured Event Reporter, accessible via <a href="Rails.html#event-class_method" title="Rails.event (method)">Rails.event</a>.</p>

<p>The Event Reporter provides a unified interface for producing structured events in Rails
applications:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'>notify</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.signup</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='int'>123</span><span class='comma'>,</span> <span class='label'>email:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user@example.com</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>It supports adding tags to events:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'>tagged</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>graphql</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='comment'># Event includes tags: { graphql: true }
</span>  <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'>notify</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.signup</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='int'>123</span><span class='comma'>,</span> <span class='label'>email:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user@example.com</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span></code></pre>

<p>As well as context:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># All events will contain context: {request_id: &quot;abc123&quot;, shop_id: 456}
</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_set_context'>set_context</span>(<span class='label'>request_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>abc123</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>shop_id:</span> <span class='int'>456</span>)</code></pre>

<p>Events are emitted to subscribers. Applications register subscribers to
control how events are serialized and emitted. Subscribers must implement
an <code>#emit</code> method, which receives the event hash:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>LogSubscriber</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_emit'>emit</span>(<span class='id identifier rubyid_event'>event</span>)
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_payload'>payload</span>].<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_source_location'>source_location</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_source_location'>source_location</span>]
    <span class='id identifier rubyid_log'>log</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_payload'>payload</span><span class='embexpr_end'>}</span><span class='tstring_content'> at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_location'>source_location</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_filepath'>filepath</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_location'>source_location</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lineno'>lineno</span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_logger'><a href="Rails.html#logger-class_method" title="Rails.logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span>(<span class='id identifier rubyid_log'>log</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Adrianna Chang</em></p></li>
<li><p>Make <a href="ActiveSupport/Logger.html" title="ActiveSupport::Logger (class)"><code>::ActiveSupport::Logger</code></a> <code>#freeze</code>-friendly.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Make <a href="ActiveSupport/Gzip.html#compress-class_method" title="ActiveSupport::Gzip.compress (method)">ActiveSupport::Gzip.compress</a> deterministic based on input.</p>

<p><a href="ActiveSupport/Gzip.html#compress-class_method" title="ActiveSupport::Gzip.compress (method)">ActiveSupport::Gzip.compress</a> used to include a timestamp in the output,
causing consecutive calls with the same input data to have different output
if called during different seconds. It now always sets the timestamp to <code>0</code>
so that the output is identical for any given input.</p>

<p><em>Rob Brackett</em></p></li>
<li><p>Given an array of <a href="Thread/Backtrace/Location.html" title="Thread::Backtrace::Location (class)"><code>::Thread::Backtrace::Location</code></a> objects, the new method
<a href="ActiveSupport/BacktraceCleaner.html#clean_locations-instance_method" title="ActiveSupport::BacktraceCleaner#clean_locations (method)">ActiveSupport::BacktraceCleaner#clean_locations</a> returns an array with the
clean ones:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_clean_locations'>clean_locations</span> <span class='op'>=</span> <span class='id identifier rubyid_backtrace_cleaner'>backtrace_cleaner</span>.<span class='id identifier rubyid_clean_locations'>clean_locations</span>(<span class='id identifier rubyid_caller_locations'>caller_locations</span>)</code></pre>

<p>Filters and silencers receive strings as usual. However, the <code>path</code>
attributes of the locations in the returned array are the original,
unfiltered ones, since locations are immutable.</p>

<p><em>Xavier Noria</em></p></li>
<li><p>Improve <code>CurrentAttributes</code> and <code>ExecutionContext</code> state managment in test cases.</p>

<p>Previously these two global state would be entirely cleared out whenever calling
into code that is wrapped by the Rails executor, typically Action Controller or
Active Job helpers:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#index works</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='const'>CurrentUser</span>.<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='int'>42</span>
  <span class='id identifier rubyid_get'>get</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
  <span class='const'>CurrentUser</span>.<span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='kw'>nil</span>
<span class='kw'>end</span></code></pre>

<p>Now re-entering the executor properly save and restore that state.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>The new method <a href="ActiveSupport/BacktraceCleaner.html#first_clean_location-instance_method" title="ActiveSupport::BacktraceCleaner#first_clean_location (method)">ActiveSupport::BacktraceCleaner#first_clean_location</a>
returns the first clean location of the caller&#39;s call stack, or <code>nil</code>.
Locations are <a href="Thread/Backtrace/Location.html" title="Thread::Backtrace::Location (class)"><code>::Thread::Backtrace::Location</code></a> objects. Useful when you want to
report the application-level location where something happened as an object.</p>

<p><em>Xavier Noria</em></p></li>
<li><p>FileUpdateChecker and EventedFileUpdateChecker ignore changes in Gem.path now.</p>

<p><em>Ermolaev Andrey</em>, <em>zzak</em></p></li>
<li><p>The new method <a href="ActiveSupport/BacktraceCleaner.html#first_clean_frame-instance_method" title="ActiveSupport::BacktraceCleaner#first_clean_frame (method)">ActiveSupport::BacktraceCleaner#first_clean_frame</a> returns
the first clean frame of the caller&#39;s backtrace, or <code>nil</code>. Useful when you
want to report the application-level frame where something happened as a
string.</p>

<p><em>Xavier Noria</em></p></li>
<li><p>Always clear <code>CurrentAttributes</code> instances.</p>

<p>Previously <code>CurrentAttributes</code> instance would be reset at the end of requests.
Meaning its attributes would be re-initialized.</p>

<p>This is problematic because it assume these objects don&#39;t hold any state
other than their declared attribute, which isn&#39;t always the case, and
can lead to state leak across request.</p>

<p>Now <code>CurrentAttributes</code> instances are abandoned at the end of a request,
and a new instance is created at the start of the next request.</p>

<p><em>Jean Boussier</em>, <em>Janko Marohnić</em></p></li>
<li><p>Add public API for <code>before_fork_hook</code> in parallel testing.</p>

<p>Introduces a public API for calling the before fork hooks implemented by parallel testing.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_parallelize_before_fork'>parallelize_before_fork</span> <span class='kw'>do</span>
    <span class='comment'># perform an action before test processes are forked
</span><span class='kw'>end</span></code></pre>

<p><em>Eileen M. Uchitelle</em></p></li>
<li><p>Implement ability to skip creating parallel testing databases.</p>

<p>With parallel testing, Rails will create a database per process. If this isn&#39;t
desirable or you would like to implement databases handling on your own, you can
now turn off this default behavior.</p>

<p>To skip creating a database per process, you can change it via the
<code>parallelize</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_parallelize'>parallelize</span>(<span class='label'>workers:</span> <span class='int'>10</span><span class='comma'>,</span> <span class='label'>parallelize_databases:</span> <span class='kw'>false</span>)</code></pre>

<p>or via the application configuration:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_active_support'>active_support</span>.<span class='id identifier rubyid_parallelize_databases'>parallelize_databases</span> <span class='op'>=</span> <span class='kw'>false</span></code></pre>

<p><em>Eileen M. Uchitelle</em></p></li>
<li><p>Allow to configure maximum cache key sizes</p>

<p>When the key exceeds the configured limit (250 bytes by default), it will be truncated and
the digest of the rest of the key appended to it.</p>

<p>Note that previously <a href="ActiveSupport/Cache/RedisCacheStore.html" title="ActiveSupport::Cache::RedisCacheStore (class)"><code>::ActiveSupport::Cache::RedisCacheStore</code></a> allowed up to 1kb cache keys before
truncation, which is now reduced to 250 bytes.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_cache_store'>cache_store</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redis_cache_store'>redis_cache_store</span><span class='comma'>,</span> { <span class='label'>max_key_size:</span> <span class='int'>64</span> }</code></pre>

<p><em>fatkodima</em></p></li>
<li><p>Use <code>UNLINK</code> command instead of <code>DEL</code> in <a href="ActiveSupport/Cache/RedisCacheStore.html" title="ActiveSupport::Cache::RedisCacheStore (class)"><code>::ActiveSupport::Cache::RedisCacheStore</code></a> for non-blocking deletion.</p>

<p><em>Aron Roh</em></p></li>
<li><p>Add <code>Cache#read_counter</code> and <code>Cache#write_counter</code></p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_write_counter'>write_counter</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1</span>)
<span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_read_counter'>read_counter</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; 1
</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_increment'>increment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>)
<span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_read_counter'>read_counter</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; 2</span></code></pre>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Introduce ActiveSupport::Testing::ErrorReporterAssertions#capture_error_reports</p>

<p>Captures all reported errors from within the block that match the given
error class.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_reports'>reports</span> <span class='op'>=</span> <span class='id identifier rubyid_capture_error_reports'>capture_error_reports</span>(<span class='const'>IOError</span>) <span class='kw'>do</span>
  <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_error'><a href="Rails.html#error-class_method" title="Rails.error (method)">error</a></span>.<span class='id identifier rubyid_report'>report</span>(<span class='const'>IOError</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Oops</span><span class='tstring_end'>&quot;</span></span>))
  <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_error'><a href="Rails.html#error-class_method" title="Rails.error (method)">error</a></span>.<span class='id identifier rubyid_report'>report</span>(<span class='const'>IOError</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Oh no</span><span class='tstring_end'>&quot;</span></span>))
  <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_error'><a href="Rails.html#error-class_method" title="Rails.error (method)">error</a></span>.<span class='id identifier rubyid_report'>report</span>(<span class='const'>StandardError</span>.<span class='id identifier rubyid_new'>new</span>)
<span class='kw'>end</span>

<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_reports'>reports</span>.<span class='id identifier rubyid_size'>size</span>
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Oops</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_reports'>reports</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_message'>message</span>
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Oh no</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_reports'>reports</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_message'>message</span></code></pre>

<p><em>Andrew Novoselac</em></p></li>
<li><p>Introduce ActiveSupport::ErrorReporter#add_middleware</p>

<p>When reporting an error, the error context middleware will be called with the reported error
and base execution context. The stack may mutate the context hash. The mutated context will
then be passed to error subscribers. Middleware receives the same parameters as <code>ErrorReporter#report</code>.</p>

<p><em>Andrew Novoselac</em>, <em>Sam Schmidt</em></p></li>
<li><p>Change execution wrapping to report all exceptions, including <a href="Exception.html" title="Exception (class)"><code>Exception</code></a>.</p>

<p>If a more serious error like <code>SystemStackError</code> or <code>NoMemoryError</code> happens,
the error reporter should be able to report these kinds of exceptions.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p><a href="ActiveSupport/Testing/Parallelization.html#before_fork_hook-class_method" title="ActiveSupport::Testing::Parallelization.before_fork_hook (method)">ActiveSupport::Testing::Parallelization.before_fork_hook</a> allows declaration of callbacks that
are invoked immediately before forking test workers.</p>

<p><em>Mike Dalessio</em></p></li>
<li><p>Allow the <code>#freeze_time</code> testing helper to accept a date or time argument.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="Time.html#current-class_method" title="Time.current (method)">current</a></span> <span class='comment'># =&gt; Sun, 09 Jul 2024 15:34:49 EST -05:00
</span><span class='id identifier rubyid_freeze_time'>freeze_time</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="Time.html#current-class_method" title="Time.current (method)">current</a></span> <span class='op'>+</span> <span class='int'>1</span>.<span class='id identifier rubyid_day'>day</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="Time.html#current-class_method" title="Time.current (method)">current</a></span> <span class='comment'># =&gt; Mon, 10 Jul 2024 15:34:49 EST -05:00</span></code></pre>

<p><em>Joshua Young</em></p></li>
<li><p><a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a> now accepts options</p>

<p>It is now possible to pass options to <a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)">JSON</a></span>.<span class='id identifier rubyid_decode'><a href="ActiveSupport/JSON.html#decode-class_method" title="ActiveSupport::JSON.decode (method)">decode</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>{&quot;key&quot;: &quot;value&quot;}</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>symbolize_names:</span> <span class='kw'>true</span>) <span class='comment'># =&gt; { key: &quot;value&quot; }</span></code></pre>

<p><em>matthaigh27</em></p></li>
<li><p><a href="ActiveSupport/Testing/NotificationAssertions.html" title="ActiveSupport::Testing::NotificationAssertions (module)"><code>::ActiveSupport::Testing::NotificationAssertions</code></a>&#39;s <code>assert_notification</code> now matches against payload subsets by default.</p>

<p>Previously the following assertion would fail due to excess key vals in the notification payload. Now with payload subset matching, it will pass.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert_notification'>assert_notification</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>post.submitted</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cool Post</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Notifications.html" title="ActiveSupport::Notifications (module)">Notifications</a></span>.<span class='id identifier rubyid_instrument'><a href="ActiveSupport/Notifications.html#instrument-class_method" title="ActiveSupport::Notifications.instrument (method)">instrument</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>post.submitted</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cool Post</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cool Body</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span></code></pre>

<p>Additionally, you can now persist a matched notification for more customized assertions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_notification'>notification</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_notification'>assert_notification</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>post.submitted</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cool Post</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Notifications.html" title="ActiveSupport::Notifications (module)">Notifications</a></span>.<span class='id identifier rubyid_instrument'><a href="ActiveSupport/Notifications.html#instrument-class_method" title="ActiveSupport::Notifications.instrument (method)">instrument</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>post.submitted</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cool Post</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>body:</span> <span class='const'>Body</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cool Body</span><span class='tstring_end'>&quot;</span></span>))
<span class='kw'>end</span>

<span class='id identifier rubyid_assert_instance_of'>assert_instance_of</span>(<span class='const'>Body</span><span class='comma'>,</span> <span class='id identifier rubyid_notification'>notification</span>.<span class='id identifier rubyid_payload'>payload</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>])</code></pre>

<p><em>Nicholas La Roux</em></p></li>
<li><p>Deprecate <a href="String.html#mb_chars-instance_method" title="String#mb_chars (method)">String#mb_chars</a> and <a href="ActiveSupport/Multibyte/Chars.html" title="ActiveSupport::Multibyte::Chars (class)"><code>::ActiveSupport::Multibyte::Chars</code></a>.</p>

<p>These APIs are a relic of the Ruby 1.8 days when Ruby strings weren&#39;t encoding
aware. There is no legitimate reasons to need these APIs today.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Deprecate <a href="ActiveSupport/Configurable.html" title="ActiveSupport::Configurable (module)"><code>::ActiveSupport::Configurable</code></a></p>

<p><em>Sean Doyle</em></p></li>
<li><p><code>nil.to_query(&quot;key&quot;)</code> now returns <code>key</code>.</p>

<p>Previously it would return <code>key=</code>, preventing round tripping with <code>Rack::Utils.parse_nested_query</code>.</p>

<p><em>Erol Fornoles</em></p></li>
<li><p>Avoid wrapping redis in a <code>ConnectionPool</code> when using <a href="ActiveSupport/Cache/RedisCacheStore.html" title="ActiveSupport::Cache::RedisCacheStore (class)"><code>::ActiveSupport::Cache::RedisCacheStore</code></a> if the <code>:redis</code>
option is already a <code>ConnectionPool</code>.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Alter <a href="ERB/Util.html#tokenize-class_method" title="ERB::Util.tokenize (method)">ERB::Util.tokenize</a> to return <code>:PLAIN</code> token with full input string when string doesn&#39;t contain <a href="ERB.html" title="ERB (class)"><code>ERB</code></a> tags.</p>

<p><em>Martin Emde</em></p></li>
<li><p>Fix a bug in <a href="ERB/Util.html#tokenize-class_method" title="ERB::Util.tokenize (method)">ERB::Util.tokenize</a> that causes incorrect tokenization when <a href="ERB.html" title="ERB (class)"><code>ERB</code></a> tags are preceded by multibyte characters.</p>

<p><em>Martin Emde</em></p></li>
<li><p>Add <a href="ActiveSupport/Testing/NotificationAssertions.html" title="ActiveSupport::Testing::NotificationAssertions (module)"><code>::ActiveSupport::Testing::NotificationAssertions</code></a> module to help with testing <a href="ActiveSupport/Notifications.html" title="ActiveSupport::Notifications (module)"><code>::ActiveSupport::Notifications</code></a>.</p>

<p><em>Nicholas La Roux</em>, <em>Yishu See</em>, <em>Sean Doyle</em></p></li>
<li><p><a href="ActiveSupport/CurrentAttributes.html#attributes-instance_method" title="ActiveSupport::CurrentAttributes#attributes (method)">ActiveSupport::CurrentAttributes#attributes</a> now will return a new hash object on each call.</p>

<p>Previously, the same hash object was returned each time that method was called.</p>

<p><em>fatkodima</em></p></li>
<li><p><a href="ActiveSupport/JSON.html#encode-class_method" title="ActiveSupport::JSON.encode (method)">ActiveSupport::JSON.encode</a> supports CIDR notation.</p>

<p>Previously:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)">JSON</a></span>.<span class='id identifier rubyid_encode'><a href="ActiveSupport/JSON.html#encode-class_method" title="ActiveSupport::JSON.encode (method)">encode</a></span>(<span class='const'><a href="IPAddr.html" title="IPAddr (class)">IPAddr</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>172.16.0.0/24</span><span class='tstring_end'>&quot;</span></span>)) <span class='comment'># =&gt; &quot;\&quot;172.16.0.0\&quot;&quot;</span></code></pre>

<p>After this change:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)">JSON</a></span>.<span class='id identifier rubyid_encode'><a href="ActiveSupport/JSON.html#encode-class_method" title="ActiveSupport::JSON.encode (method)">encode</a></span>(<span class='const'><a href="IPAddr.html" title="IPAddr (class)">IPAddr</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>172.16.0.0/24</span><span class='tstring_end'>&quot;</span></span>)) <span class='comment'># =&gt; &quot;\&quot;172.16.0.0/24\&quot;&quot;</span></code></pre>

<p><em>Taketo Takashima</em></p></li>
<li><p>Make <a href="ActiveSupport/FileUpdateChecker.html" title="ActiveSupport::FileUpdateChecker (class)"><code>::ActiveSupport::FileUpdateChecker</code></a> faster when checking many file-extensions.</p>

<p><em>Jonathan del Strother</em></p></li>
</ul>

<p>Please check [8-0-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>