<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Getting Started &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "getting_started",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Getting Started&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<p><strong>DO NOT READ THIS FILE ON GITHUB, GUIDES ARE PUBLISHED ON <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p>

<h1>Getting Started with <a href="Rails.html" title="Rails (module)"><code>Rails</code></a></h1>

<p>This guide covers getting up and running with Ruby on <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>.</p>

<p>After reading this guide, you will know:</p>

<ul>
<li>How to install <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>, create a new <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> application, and connect your
application to a database.</li>
<li>The general layout of a <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> application.</li>
<li>The basic principles of MVC (Model, View, Controller) and RESTful design.</li>
<li>How to quickly generate the starting pieces of a <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> application.</li>
</ul>

<hr>

<h2>Guide Assumptions</h2>

<p>This guide is designed for beginners who want to get started with creating a <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>
application from scratch. It does not assume that you have any prior experience
with <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>.</p>

<p><a href="Rails.html" title="Rails (module)"><code>Rails</code></a> is a web application framework running on the Ruby programming language.
If you have no prior experience with Ruby, you will find a very steep learning
curve diving straight into <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>. There are several curated lists of online resources
for learning Ruby:</p>

<ul>
<li><a href="https://www.ruby-lang.org/en/documentation/">Official Ruby Programming Language website</a></li>
<li>[List of Free Programming Books]#ruby)</li>
</ul>

<p>Be aware that some resources, while still excellent, cover older versions of
Ruby, and may not include some syntax that you will see in day-to-day
development with <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>.</p>

<h2>What is Rails?</h2>

<p><a href="Rails.html" title="Rails (module)"><code>Rails</code></a> is a web application development framework written in the Ruby programming language.
It is designed to make programming web applications easier by making assumptions
about what every developer needs to get started. It allows you to write less
code while accomplishing more than many other languages and frameworks.
Experienced Rails developers also report that it makes web application
development more fun.</p>

<p><a href="Rails.html" title="Rails (module)"><code>Rails</code></a> is opinionated software. It makes the assumption that there is a &quot;best&quot;
way to do things, and it&#39;s designed to encourage that way - and in some cases to
discourage alternatives. If you learn &quot;The <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> Way&quot; you&#39;ll probably discover a
tremendous increase in productivity. If you persist in bringing old habits from
other languages to your <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> development, and trying to use patterns you
learned elsewhere, you may have a less happy experience.</p>

<p>The Rails philosophy includes two major guiding principles:</p>

<ul>
<li><strong>Don&#39;t Repeat Yourself:</strong> DRY is a principle of software development which
states that &quot;Every piece of knowledge must have a single, unambiguous, authoritative
representation within a system&quot;. By not writing the same information over and over
again, our code is more maintainable, more extensible, and less buggy.</li>
<li><strong>Convention Over Configuration:</strong> <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> has opinions about the best way to do many
things in a web application, and defaults to this set of conventions, rather than
require that you specify minutiae through endless configuration files.</li>
</ul>

<h2>Creating a New Rails Project</h2>

<p>The best way to read this guide is to follow it step by step. All steps are
essential to run this example application and no additional code or steps are
needed.</p>

<p>By following along with this guide, you&#39;ll create a <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> project called
<code>blog</code>, a (very) simple weblog. Before you can start building the application,
you need to make sure that you have <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> itself installed.</p>

<p>NOTE: The examples below use <code>$</code> to represent your terminal prompt in a UNIX-like OS,
though it may have been customized to appear differently. If you are using Windows,
your prompt will look something like <code>C:\source_code></code>.</p>

<h3>Installing Rails</h3>

<p>Before you install <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>, you should check to make sure that your system has the
proper prerequisites installed. These include:</p>

<ul>
<li>Ruby</li>
<li>SQLite3</li>
</ul>

<h4>Installing Ruby</h4>

<p>Open up a command line prompt. On macOS open Terminal.app; on Windows choose
&quot;Run&quot; from your Start menu and type <code>cmd.exe</code>. Any commands prefaced with a
dollar sign <code>$</code> should be run in the command line. Verify that you have a
current version of Ruby installed:</p>

<pre class="code bash"><code class="bash">$ ruby --version
ruby 3.1.0
</code></pre>

<p>Rails requires Ruby version 3.1.0 or later. It is preferred to use the latest Ruby version.
If the version number returned is less than that number (such as 2.3.7, or 1.8.7),
you&#39;ll need to install a fresh copy of Ruby.</p>

<p>To install Rails on Windows, you&#39;ll first need to install <a href="https://rubyinstaller.org/">Ruby Installer</a>.</p>

<p>For more installation methods for most Operating Systems take a look at
<a href="https://www.ruby-lang.org/en/documentation/installation/">ruby-lang.org</a>.</p>

<h4>Installing SQLite3</h4>

<p>You will also need an installation of the SQLite3 database.
Many popular UNIX-like OSes ship with an acceptable version of SQLite3.
Others can find installation instructions at the <a href="https://www.sqlite.org">SQLite3 website</a>.</p>

<p>Verify that it is correctly installed and in your load <code>PATH</code>:</p>

<pre class="code bash"><code class="bash">$ sqlite3 --version
</code></pre>

<p>The program should report its version.</p>

<h4>Installing Rails</h4>

<p>To install Rails, use the <code>gem install</code> command provided by RubyGems:</p>

<pre class="code bash"><code class="bash">$ gem install rails
</code></pre>

<p>To verify that you have everything installed correctly, you should be able to
run the following in a new terminal:</p>

<pre class="code bash"><code class="bash">$ rails --version
Rails 7.2.0
</code></pre>

<p>If it says something like &quot;Rails 7.2.0&quot;, you are ready to continue.</p>

<h3>Creating the Blog Application</h3>

<p>Rails comes with a number of scripts called generators that are designed to make
your development life easier by creating everything that&#39;s necessary to start
working on a particular task. One of these is the new application generator,
which will provide you with the foundation of a fresh Rails application so that
you don&#39;t have to write it yourself.</p>

<p>To use this generator, open a terminal, navigate to a directory where you have
rights to create files, and run:</p>

<pre class="code bash"><code class="bash">$ rails new blog
</code></pre>

<p>This will create a Rails application called Blog in a <code>blog</code> directory and
install the gem dependencies that are already mentioned in <code>Gemfile</code> using
<code>bundle install</code>.</p>

<p>TIP: You can see all of the command line options that the Rails application
generator accepts by running <code>rails new --help</code>.</p>

<p>After you create the blog application, switch to its folder:</p>

<pre class="code bash"><code class="bash">$ cd blog
</code></pre>

<p>The <code>blog</code> directory will have a number of generated files and folders that make
up the structure of a Rails application. Most of the work in this tutorial will
happen in the <code>app</code> folder, but here&#39;s a basic rundown on the function of each
of the files and folders that Rails creates by default:</p>

<table><thead>
<tr>
<th>File/Folder</th>
<th>Purpose</th>
</tr>
</thead><tbody>
<tr>
<td>app/</td>
<td>Contains the controllers, models, views, helpers, mailers, channels, jobs, and assets for your application. You&#39;ll focus on this folder for the remainder of this guide.</td>
</tr>
<tr>
<td>bin/</td>
<td>Contains the <code>rails</code> script that starts your app and can contain other scripts you use to set up, update, deploy, or run your application.</td>
</tr>
<tr>
<td>config/</td>
<td>Contains configuration for your application&#39;s routes, database, and more. This is covered in more detail in <a href="configuring.html">Configuring Rails Applications</a>.</td>
</tr>
<tr>
<td>config.ru</td>
<td>Rack configuration for Rack-based servers used to start the application. For more information about Rack, see the <a href="https://rack.github.io/">Rack website</a>.</td>
</tr>
<tr>
<td>db/</td>
<td>Contains your current database schema, as well as the database migrations.</td>
</tr>
<tr>
<td>Dockerfile</td>
<td>Configuration file for Docker.</td>
</tr>
<tr>
<td>Gemfile<br>Gemfile.lock</td>
<td>These files allow you to specify what gem dependencies are needed for your Rails application. These files are used by the Bundler gem. For more information about Bundler, see the <a href="https://bundler.io">Bundler website</a>.</td>
</tr>
<tr>
<td>lib/</td>
<td>Extended modules for your application.</td>
</tr>
<tr>
<td>log/</td>
<td>Application log files.</td>
</tr>
<tr>
<td>public/</td>
<td>Contains static files and compiled assets. When your app is running, this directory will be exposed as-is.</td>
</tr>
<tr>
<td>Rakefile</td>
<td>This file locates and loads tasks that can be run from the command line. The task definitions are defined throughout the components of Rails. Rather than changing <code>Rakefile</code>, you should add your own tasks by adding files to the <code>lib/tasks</code> directory of your application.</td>
</tr>
<tr>
<td>README.md</td>
<td>This is a brief instruction manual for your application. You should edit this file to tell others what your application does, how to set it up, and so on.</td>
</tr>
<tr>
<td>storage/</td>
<td>Active Storage files for Disk Service. This is covered in <a href="active_storage_overview.html">Active Storage Overview</a>.</td>
</tr>
<tr>
<td>test/</td>
<td>Unit tests, fixtures, and other test apparatus. These are covered in <a href="testing.html">Testing Rails Applications</a>.</td>
</tr>
<tr>
<td>tmp/</td>
<td>Temporary files (like cache and pid files).</td>
</tr>
<tr>
<td>vendor/</td>
<td>A place for all third-party code. In a typical Rails application this includes vendored gems.</td>
</tr>
<tr>
<td>.dockerignore</td>
<td>This file tells Docker which files it should not copy into the container.</td>
</tr>
<tr>
<td>.gitattributes</td>
<td>This file defines metadata for specific paths in a git repository. This metadata can be used by git and other tools to enhance their behavior. See the <a href="https://git-scm.com/docs/gitattributes">gitattributes documentation</a> for more information.</td>
</tr>
<tr>
<td>.github/</td>
<td>Contains GitHub specific files.</td>
</tr>
<tr>
<td>.gitignore</td>
<td>This file tells git which files (or patterns) it should ignore. See <a href="https://help.github.com/articles/ignoring-files">GitHub - Ignoring files</a> for more information about ignoring files.</td>
</tr>
<tr>
<td>.rubocop.yml</td>
<td>This file contains the configuration for RuboCop.</td>
</tr>
<tr>
<td>.ruby-version</td>
<td>This file contains the default Ruby version.</td>
</tr>
</tbody></table>

<h2>Hello, Rails!</h2>

<p>To begin with, let&#39;s get some text up on screen quickly. To do this, you need to
get your Rails application server running.</p>

<h3>Starting Up the Web Server</h3>

<p>You actually have a functional Rails application already. To see it, you need to
start a web server on your development machine. You can do this by running the
following command in the <code>blog</code> directory:</p>

<pre class="code bash"><code class="bash">$ bin/rails server
</code></pre>

<p>TIP: If you are using Windows, you have to pass the scripts under the <code>bin</code>
folder directly to the Ruby interpreter e.g. <code>ruby bin\rails server</code>.</p>

<p>TIP: JavaScript asset compression requires you to
have a JavaScript runtime available on your system, in the absence
of a runtime you will see an <code>execjs</code> error during asset compression.
Usually macOS and Windows come with a JavaScript runtime installed.
<code>therubyrhino</code> is the recommended runtime for JRuby users and is added by
default to the <code>Gemfile</code> in apps generated under JRuby. You can investigate
all the supported runtimes at <a href="https://github.com/rails/execjs#readme">ExecJS</a>.</p>

<p>This will start up Puma, a web server distributed with Rails by default. To see
your application in action, open a browser window and navigate to
<a href="http://localhost:3000">http://localhost:3000</a>. You should see the Rails default information page:</p>

<p><img src="images/getting_started/rails_welcome.png" alt="Rails startup page screenshot"></p>

<p>When you want to stop the web server, hit Ctrl+C in the terminal window where
it&#39;s running. In the development environment, Rails does not generally
require you to restart the server; changes you make in files will be
automatically picked up by the server.</p>

<p>The Rails startup page is the <em>smoke test</em> for a new Rails
application: it makes sure that you have your software configured correctly
enough to serve a page.</p>

<h3>Say &quot;Hello&quot;, Rails</h3>

<p>To get Rails saying &quot;Hello&quot;, you need to create at minimum a <em>route</em>, a
<em>controller</em> with an <em>action</em>, and a <em>view</em>. A route maps a request to a
controller action. A controller action performs the necessary work to handle the
request, and prepares any data for the view. A view displays data in a desired
format.</p>

<p>In terms of implementation: Routes are rules written in a Ruby <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL
(Domain-Specific Language)</a>.
Controllers are Ruby classes, and their public methods are actions. And views
are templates, usually written in a mixture of HTML and Ruby.</p>

<p>Let&#39;s start by adding a route to our routes file, <code>config/routes.rb</code>, at the
top of the <code>Rails.application.routes.draw</code> block:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/articles</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html
</span><span class='kw'>end</span></code></pre>

<p>The route above declares that <code>GET /articles</code> requests are mapped to the <code>index</code>
action of <code>ArticlesController</code>.</p>

<p>To create <code>ArticlesController</code> and its <code>index</code> action, we&#39;ll run the controller
generator (with the <code>--skip-routes</code> option because we already have an
appropriate route):</p>

<pre class="code bash"><code class="bash">$ bin/rails generate controller Articles index --skip-routes
</code></pre>

<p>Rails will create several files for you:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create'>create</span>  <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_articles_controller'>articles_controller</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid_index'>index</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_test_unit'>test_unit</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_articles_controller_test'>articles_controller_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_helper'>helper</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_helpers'>helpers</span><span class='op'>/</span><span class='id identifier rubyid_articles_helper'>articles_helper</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_test_unit'>test_unit</span></code></pre>

<p>The most important of these is the controller file,
<code>app/controllers/articles_controller.rb</code>. Let&#39;s take a look at it:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>index</code> action is empty. When an action does not explicitly render a view
(or otherwise trigger an HTTP response), Rails will automatically render a view
that matches the name of the controller and action. Convention Over
Configuration! Views are located in the <code>app/views</code> directory. So the <code>index</code>
action will render <code>app/views/articles/index.html.erb</code> by default.</p>

<p>Let&#39;s open <code>app/views/articles/index.html.erb</code>, and replace its contents with:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Hello, Rails!&lt;/h1&gt;
</code></pre>

<p>If you previously stopped the web server to run the controller generator,
restart it with <code>bin/rails server</code>. Now visit <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>,
and see our text displayed!</p>

<h3>Setting the Application Home Page</h3>

<p>At the moment, <a href="http://localhost:3000">http://localhost:3000</a> still displays a page with the Ruby on Rails logo.
Let&#39;s display our &quot;Hello, Rails!&quot; text at <a href="http://localhost:3000">http://localhost:3000</a> as well. To do
so, we will add a route that maps the <em>root path</em> of our application to the
appropriate controller and action.</p>

<p>Let&#39;s open <code>config/routes.rb</code>, and add the following <code>root</code> route to the top of
the <code>Rails.application.routes.draw</code> block:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_root'>root</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/articles</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Now we can see our &quot;Hello, Rails!&quot; text when we visit <a href="http://localhost:3000">http://localhost:3000</a>,
confirming that the <code>root</code> route is also mapped to the <code>index</code> action of
<code>ArticlesController</code>.</p>

<p>TIP: To learn more about routing, see <a href="routing.html">Rails Routing from the Outside In</a>.</p>

<h2>Autoloading</h2>

<p>Rails applications <strong>do not</strong> use <code>require</code> to load application code.</p>

<p>You may have noticed that <code>ArticlesController</code> inherits from <code>ApplicationController</code>, but <code>app/controllers/articles_controller.rb</code> does not have anything like</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application_controller</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># DON&#39;T DO THIS.</span></code></pre>

<p>Application classes and modules are available everywhere, you do not need and <strong>should not</strong> load anything under <code>app</code> with <code>require</code>. This feature is called <em>autoloading</em>, and you can learn more about it in <a href="autoloading_and_reloading_constants.html"><em>Autoloading and Reloading Constants</em></a>.</p>

<p>You only need <code>require</code> calls for two use cases:</p>

<ul>
<li>To load files under the <code>lib</code> directory.</li>
<li>To load gem dependencies that have <code>require: false</code> in the <code>Gemfile</code>.</li>
</ul>

<h2>MVC and You</h2>

<p>So far, we&#39;ve discussed routes, controllers, actions, and views. All of these
are typical pieces of a web application that follows the <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC (Model-View-Controller)</a> pattern.
MVC is a design pattern that divides the responsibilities of an application to
make it easier to reason about. Rails follows this design pattern by convention.</p>

<p>Since we have a controller and a view to work with, let&#39;s generate the next
piece: a model.</p>

<h3>Generating a Model</h3>

<p>A <em>model</em> is a Ruby class that is used to represent data. Additionally, models
can interact with the application&#39;s database through a feature of Rails called
<em>Active Record</em>.</p>

<p>To define a model, we will use the model generator:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate model Article title:string body:text
</code></pre>

<p>NOTE: Model names are <strong>singular</strong>, because an instantiated model represents a
single data record. To help remember this convention, think of how you would
call the model&#39;s constructor: we want to write <code>Article.new(...)</code>, <strong>not</strong>
<code>Articles.new(...)</code>.</p>

<p>This will create several files:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_active_record'>active_record</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_db'>db</span><span class='op'>/</span><span class='id identifier rubyid_migrate'>migrate</span><span class='op'>/</span><span class='op'>&lt;</span><span class='id identifier rubyid_timestamp'>timestamp</span><span class='op'>&gt;</span><span class='id identifier rubyid__create_articles'>_create_articles</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_article'>article</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_test_unit'>test_unit</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_article_test'>article_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_fixtures'>fixtures</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span>.<span class='id identifier rubyid_yml'>yml</span></code></pre>

<p>The two files we&#39;ll focus on are the migration file
(<code>db/migrate/&lt;timestamp&gt;_create_articles.rb</code>) and the model file
(<code>app/models/article.rb</code>).</p>

<h3>Database Migrations</h3>

<p><em>Migrations</em> are used to alter the structure of an application&#39;s database. In
Rails applications, migrations are written in Ruby so that they can be
database-agnostic.</p>

<p>Let&#39;s take a look at the contents of our new migration file:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CreateArticles</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Migration.html" title="ActiveRecord::Migration (class)">Migration</a></span>[<span class='float'>7.2</span>]
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_string'>string</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_text'>text</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>

      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_timestamps'>timestamps</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The call to <code>create_table</code> specifies how the <code>articles</code> table should be
constructed. By default, the <code>create_table</code> method adds an <code>id</code> column as an
auto-incrementing primary key. So the first record in the table will have an
<code>id</code> of 1, the next record will have an <code>id</code> of 2, and so on.</p>

<p>Inside the block for <code>create_table</code>, two columns are defined: <code>title</code> and
<code>body</code>. These were added by the generator because we included them in our
generate command (<code>bin/rails generate model Article title:string body:text</code>).</p>

<p>On the last line of the block is a call to <code>t.timestamps</code>. This method defines
two additional columns named <code>created_at</code> and <code>updated_at</code>. As we will see,
Rails will manage these for us, setting the values when we create or update a
model object.</p>

<p>Let&#39;s run our migration with the following command:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate
</code></pre>

<p>The command will display output indicating that the table was created:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>==</span>  <span class='const'>CreateArticles</span><span class='op'>:</span> <span class='id identifier rubyid_migrating'>migrating</span> <span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>==</span>
<span class='op'>-</span><span class='op'>-</span> <span class='id identifier rubyid_create_table'>create_table</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span>)
   <span class='comment'>#=&gt; 0.0018s
</span><span class='op'>==</span>  <span class='const'>CreateArticles</span><span class='op'>:</span> <span class='id identifier rubyid_migrated'>migrated</span> (<span class='float'>0.0018</span><span class='id identifier rubyid_s'>s</span>) <span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>==</span></code></pre>

<p>TIP: To learn more about migrations, see <a href="active_record_migrations.html">Active Record Migrations</a>.</p>

<p>Now we can interact with the table using our model.</p>

<h3>Using a Model to Interact with the Database</h3>

<p>To play with our model a bit, we&#39;re going to use a feature of Rails called the
<em>console</em>. The console is an interactive coding environment just like <code>irb</code>, but
it also automatically loads Rails and our application code.</p>

<p>Let&#39;s launch the console with this command:</p>

<pre class="code bash"><code class="bash">$ bin/rails console
</code></pre>

<p>You should see an <code>irb</code> prompt like:</p>

<pre class="code irb"><code class="irb">Loading development environment (Rails 7.2.0)
irb(main):001:0&gt;
</code></pre>

<p>At this prompt, we can initialize a new <code>Article</code> object:</p>

<pre class="code irb"><code class="irb">irb&gt; article = Article.new(title: &quot;Hello Rails&quot;, body: &quot;I am on Rails!&quot;)
</code></pre>

<p>It&#39;s important to note that we have only <em>initialized</em> this object. This object
is not saved to the database at all. It&#39;s only available in the console at the
moment. To save the object to the database, we must call <a href="https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-save"><code>save</code></a>:</p>

<pre class="code irb"><code class="irb">irb&gt; article.save
(0.1ms)  begin transaction
Article Create (0.4ms)  INSERT INTO &quot;articles&quot; (&quot;title&quot;, &quot;body&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?, ?)  [[&quot;title&quot;, &quot;Hello Rails&quot;], [&quot;body&quot;, &quot;I am on Rails!&quot;], [&quot;created_at&quot;, &quot;2020-01-18 23:47:30.734416&quot;], [&quot;updated_at&quot;, &quot;2020-01-18 23:47:30.734416&quot;]]
(0.9ms)  commit transaction
=&gt; true
</code></pre>

<p>The above output shows an <code>INSERT INTO &quot;articles&quot; ...</code> database query. This
indicates that the article has been inserted into our table. And if we take a
look at the <code>article</code> object again, we see something interesting has happened:</p>

<pre class="code irb"><code class="irb">irb&gt; article
=&gt; #&lt;Article id: 1, title: &quot;Hello Rails&quot;, body: &quot;I am on Rails!&quot;, created_at: &quot;2020-01-18 23:47:30&quot;, updated_at: &quot;2020-01-18 23:47:30&quot;&gt;
</code></pre>

<p>The <code>id</code>, <code>created_at</code>, and <code>updated_at</code> attributes of the object are now set.
Rails did this for us when we saved the object.</p>

<p>When we want to fetch this article from the database, we can call <a href="https://api.rubyonrails.org/classes/ActiveRecord/FinderMethods.html#method-i-find"><code>find</code></a>
on the model and pass the <code>id</code> as an argument:</p>

<pre class="code irb"><code class="irb">irb&gt; Article.find(1)
=&gt; #&lt;Article id: 1, title: &quot;Hello Rails&quot;, body: &quot;I am on Rails!&quot;, created_at: &quot;2020-01-18 23:47:30&quot;, updated_at: &quot;2020-01-18 23:47:30&quot;&gt;
</code></pre>

<p>And when we want to fetch all articles from the database, we can call <a href="https://api.rubyonrails.org/classes/ActiveRecord/Scoping/Named/ClassMethods.html#method-i-all"><code>all</code></a>
on the model:</p>

<pre class="code irb"><code class="irb">irb&gt; Article.all
=&gt; #&lt;ActiveRecord::Relation [#&lt;Article id: 1, title: &quot;Hello Rails&quot;, body: &quot;I am on Rails!&quot;, created_at: &quot;2020-01-18 23:47:30&quot;, updated_at: &quot;2020-01-18 23:47:30&quot;&gt;]&gt;
</code></pre>

<p>This method returns an <a href="https://api.rubyonrails.org/classes/ActiveRecord/Relation.html"><a href="ActiveRecord/Relation.html" title="ActiveRecord::Relation (class)"><code>::ActiveRecord::Relation</code></a></a> object, which
you can think of as a super-powered array.</p>

<p>TIP: To learn more about models, see <a href="active_record_basics.html">Active Record Basics</a> and <a href="active_record_querying.html">Active Record Query Interface</a>.</p>

<p>Models are the final piece of the MVC puzzle. Next, we will connect all of the
pieces together.</p>

<h3>Showing a List of Articles</h3>

<p>Let&#39;s go back to our controller in <code>app/controllers/articles_controller.rb</code>, and
change the <code>index</code> action to fetch all articles from the database:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Controller instance variables can be accessed by the view. That means we can
reference <code>@articles</code> in <code>app/views/articles/index.html.erb</code>. Let&#39;s open that
file, and replace its contents with:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= article.title %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</code></pre>

<p>The above code is a mixture of HTML and <em>ERB</em>. ERB, short for <a href="https://docs.ruby-lang.org/en/3.2/ERB.html">Embedded Ruby</a>, is a templating system that
evaluates Ruby code embedded in a document. Here, we can see two types of ERB
tags: <code>&lt;% %&gt;</code> and <code>&lt;%= %&gt;</code>. The <code>&lt;% %&gt;</code> tag means &quot;evaluate the enclosed Ruby
code.&quot; The <code>&lt;%= %&gt;</code> tag means &quot;evaluate the enclosed Ruby code, and output the
value it returns.&quot; Anything you could write in a regular Ruby program can go
inside these ERB tags, though it&#39;s usually best to keep the contents of ERB tags
short, for readability.</p>

<p>Since we don&#39;t want to output the value returned by <code>@articles.each</code>, we&#39;ve
enclosed that code in <code>&lt;% %&gt;</code>. But, since we <em>do</em> want to output the value
returned by <code>article.title</code> (for each article), we&#39;ve enclosed that code in
<code>&lt;%= %&gt;</code>.</p>

<p>We can see the final result by visiting <a href="http://localhost:3000">http://localhost:3000</a>. (Remember that
<code>bin/rails server</code> must be running!) Here&#39;s what happens when we do that:</p>

<ol>
<li>The browser makes a request: <code>GET http://localhost:3000</code>.</li>
<li>Our Rails application receives this request.</li>
<li>The Rails router maps the root route to the <code>index</code> action of <code>ArticlesController</code>.</li>
<li>The <code>index</code> action uses the <code>Article</code> model to fetch all articles in the database.</li>
<li>Rails automatically renders the <code>app/views/articles/index.html.erb</code> view.</li>
<li>The ERB code in the view is evaluated to output HTML.</li>
<li>The server sends a response containing the HTML back to the browser.</li>
</ol>

<p>We&#39;ve connected all the MVC pieces together, and we have our first controller
action! Next, we&#39;ll move on to the second action.</p>

<h2>CRUDit Where CRUDit Is Due</h2>

<p>Almost all web applications involve <a href="https://en.wikipedia.org/wiki/Create,_read,_update,_and_delete">CRUD (Create, Read, Update, and Delete)</a> operations. You
may even find that the majority of the work your application does is CRUD. Rails
acknowledges this, and provides many features to help simplify code doing CRUD.</p>

<p>Let&#39;s begin exploring these features by adding more functionality to our
application.</p>

<h3>Showing a Single Article</h3>

<p>We currently have a view that lists all articles in our database. Let&#39;s add a
new view that shows the title and body of a single article.</p>

<p>We start by adding a new route that maps to a new controller action (which we
will add next). Open <code>config/routes.rb</code>, and insert the last route shown here:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_root'>root</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/articles</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/articles/:id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#show</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>The new route is another <code>get</code> route, but it has something extra in its path:
<code>:id</code>. This designates a route <em>parameter</em>. A route parameter captures a segment
of the request&#39;s path, and puts that value into the <code>params</code> Hash, which is
accessible by the controller action. For example, when handling a request like
<code>GET http://localhost:3000/articles/1</code>, <code>1</code> would be captured as the value for
<code>:id</code>, which would then be accessible as <code>params[:id]</code> in the <code>show</code> action of
<code>ArticlesController</code>.</p>

<p>Let&#39;s add that <code>show</code> action now, below the <code>index</code> action in
<code>app/controllers/articles_controller.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>show</code> action calls <code>Article.find</code> (<a href="#using-a-model-to-interact-with-the-database">mentioned
previously</a>) with the ID captured
by the route parameter. The returned article is stored in the <code>@article</code>
instance variable, so it is accessible by the view. By default, the <code>show</code>
action will render <code>app/views/articles/show.html.erb</code>.</p>

<p>Let&#39;s create <code>app/views/articles/show.html.erb</code>, with the following contents:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;
</code></pre>

<p>Now we can see the article when we visit <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>!</p>

<p>To finish up, let&#39;s add a convenient way to get to an article&#39;s page. We&#39;ll link
each article&#39;s title in <code>app/views/articles/index.html.erb</code> to its page:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href=&quot;/articles/&lt;%= article.id %&gt;&quot;&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</code></pre>

<h3>Resourceful Routing</h3>

<p>So far, we&#39;ve covered the &quot;R&quot; (Read) of CRUD. We will eventually cover the &quot;C&quot;
(Create), &quot;U&quot; (Update), and &quot;D&quot; (Delete). As you might have guessed, we will do
so by adding new routes, controller actions, and views. Whenever we have such a
combination of routes, controller actions, and views that work together to
perform CRUD operations on an entity, we call that entity a <em>resource</em>. For
example, in our application, we would say an article is a resource.</p>

<p>Rails provides a routes method named <a href="https://api.rubyonrails.org/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-resources"><code>resources</code></a>
that maps all of the conventional routes for a collection of resources, such as
articles. So before we proceed to the &quot;C&quot;, &quot;U&quot;, and &quot;D&quot; sections, let&#39;s replace
the two <code>get</code> routes in <code>config/routes.rb</code> with <code>resources</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_root'>root</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span>
<span class='kw'>end</span></code></pre>

<p>We can inspect what routes are mapped by running the <code>bin/rails routes</code> command:</p>

<pre class="code bash"><code class="bash">$ bin/rails routes
      Prefix Verb   URI Pattern                  Controller#Action
        root GET    /                            articles#index
    articles GET    /articles(.:format)          articles#index
 new_article GET    /articles/new(.:format)      articles#new
     article GET    /articles/:id(.:format)      articles#show
             POST   /articles(.:format)          articles#create
edit_article GET    /articles/:id/edit(.:format) articles#edit
             PATCH  /articles/:id(.:format)      articles#update
             DELETE /articles/:id(.:format)      articles#destroy
</code></pre>

<p>The <code>resources</code> method also sets up URL and path helper methods that we can use
to keep our code from depending on a specific route configuration. The values
in the &quot;Prefix&quot; column above plus a suffix of <code>_url</code> or <code>_path</code> form the names
of these helpers. For example, the <code>article_path</code> helper returns
<code>&quot;/articles/#{article.id}&quot;</code> when given an article. We can use it to tidy up our
links in <code>app/views/articles/index.html.erb</code>:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href=&quot;&lt;%= article_path(article) %&gt;&quot;&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</code></pre>

<p>However, we will take this one step further by using the <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to"><code>link_to</code></a>
helper. The <code>link_to</code> helper renders a link with its first argument as the
link&#39;s text and its second argument as the link&#39;s destination. If we pass a
model object as the second argument, <code>link_to</code> will call the appropriate path
helper to convert the object to a path. For example, if we pass an article,
<code>link_to</code> will call <code>article_path</code>. So <code>app/views/articles/index.html.erb</code>
becomes:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</code></pre>

<p>Nice!</p>

<p>TIP: To learn more about routing, see <a href="routing.html">Rails Routing from the Outside In</a>.</p>

<h3>Creating a New Article</h3>

<p>Now we move on to the &quot;C&quot; (Create) of CRUD. Typically, in web applications,
creating a new resource is a multi-step process. First, the user requests a form
to fill out. Then, the user submits the form. If there are no errors, then the
resource is created and some kind of confirmation is displayed. Else, the form
is redisplayed with error messages, and the process is repeated.</p>

<p>In a Rails application, these steps are conventionally handled by a controller&#39;s
<code>new</code> and <code>create</code> actions. Let&#39;s add a typical implementation of these actions
to <code>app/controllers/articles_controller.rb</code>, below the <code>show</code> action:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span>)

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>new</code> action instantiates a new article, but does not save it. This article
will be used in the view when building the form. By default, the <code>new</code> action
will render <code>app/views/articles/new.html.erb</code>, which we will create next.</p>

<p>The <code>create</code> action instantiates a new article with values for the title and
body, and attempts to save it. If the article is saved successfully, the action
redirects the browser to the article&#39;s page at <code>&quot;http://localhost:3000/articles/#{@article.id}&quot;</code>.
Else, the action redisplays the form by rendering <code>app/views/articles/new.html.erb</code>
with status code <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422">422 Unprocessable Entity</a>.
The title and body here are dummy values. After we create the form, we will come
back and change these.</p>

<p>NOTE: <a href="https://api.rubyonrails.org/classes/ActionController/Redirecting.html#method-i-redirect_to"><code>redirect_to</code></a>
will cause the browser to make a new request,
whereas <a href="https://api.rubyonrails.org/classes/AbstractController/Rendering.html#method-i-render"><code>render</code></a>
renders the specified view for the current request.
It is important to use <code>redirect_to</code> after mutating the database or application state.
Otherwise, if the user refreshes the page, the browser will make the same request, and the mutation will be repeated.</p>

<h4>Using a Form Builder</h4>

<p>We will use a feature of Rails called a <em>form builder</em> to create our form. Using
a form builder, we can write a minimal amount of code to output a form that is
fully configured and follows Rails conventions.</p>

<p>Let&#39;s create <code>app/views/articles/new.html.erb</code> with the following contents:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p>The <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>
helper method instantiates a form builder. In the <code>form_with</code> block we call
methods like <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-label"><code>label</code></a>
and <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormBuilder.html#method-i-text_field"><code>text_field</code></a>
on the form builder to output the appropriate form elements.</p>

<p>The resulting output from our <code>form_with</code> call will look like:</p>

<pre class="code xml"><code class="xml">&lt;form action=&quot;/articles&quot; accept-charset=&quot;UTF-8&quot; method=&quot;post&quot;&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;authenticity_token&quot; value=&quot;...&quot;&gt;

  &lt;div&gt;
    &lt;label for=&quot;article_title&quot;&gt;Title&lt;/label&gt;&lt;br&gt;
    &lt;input type=&quot;text&quot; name=&quot;article[title]&quot; id=&quot;article_title&quot;&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;label for=&quot;article_body&quot;&gt;Body&lt;/label&gt;&lt;br&gt;
    &lt;textarea name=&quot;article[body]&quot; id=&quot;article_body&quot;&gt;&lt;/textarea&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;input type=&quot;submit&quot; name=&quot;commit&quot; value=&quot;Create Article&quot; data-disable-with=&quot;Create Article&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;
</code></pre>

<p>TIP: To learn more about form builders, see <a href="form_helpers.html">Action View Form Helpers</a>.</p>

<h4>Using Strong Parameters</h4>

<p>Submitted form data is put into the <code>params</code> Hash, alongside captured route
parameters. Thus, the <code>create</code> action can access the submitted title via
<code>params[:article][:title]</code> and the submitted body via <code>params[:article][:body]</code>.
We could pass these values individually to <code>Article.new</code>, but that would be
verbose and possibly error-prone. And it would become worse as we add more
fields.</p>

<p>Instead, we will pass a single Hash that contains the values. However, we must
still specify what values are allowed in that Hash. Otherwise, a malicious user
could potentially submit extra form fields and overwrite private data. In fact,
if we pass the unfiltered <code>params[:article]</code> Hash directly to <code>Article.new</code>,
Rails will raise a <code>ForbiddenAttributesError</code> to alert us about the problem.
So we will use a feature of Rails called <em>Strong Parameters</em> to filter <code>params</code>.
Think of it as <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strong typing</a>
for <code>params</code>.</p>

<p>Let&#39;s add a private method to the bottom of <code>app/controllers/articles_controller.rb</code>
named <code>article_params</code> that filters <code>params</code>. And let&#39;s change <code>create</code> to use
it:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_article_params'>article_params</span>)

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_article_params'>article_params</span>
      <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>TIP: To learn more about Strong Parameters, see <a href="action_controller_overview.html#strong-parameters">Action Controller Overview §
Strong Parameters</a>.</p>

<h4>Validations and Displaying Error Messages</h4>

<p>As we have seen, creating a resource is a multi-step process. Handling invalid
user input is another step of that process. Rails provides a feature called
<em>validations</em> to help us deal with invalid user input. Validations are rules
that are checked before a model object is saved. If any of the checks fail, the
save will be aborted, and appropriate error messages will be added to the
<code>errors</code> attribute of the model object.</p>

<p>Let&#39;s add some validations to our model in <code>app/models/article.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>length:</span> { <span class='label'>minimum:</span> <span class='int'>10</span> }
<span class='kw'>end</span></code></pre>

<p>The first validation declares that a <code>title</code> value must be present. Because
<code>title</code> is a string, this means that the <code>title</code> value must contain at least one
non-whitespace character.</p>

<p>The second validation declares that a <code>body</code> value must also be present.
Additionally, it declares that the <code>body</code> value must be at least 10 characters
long.</p>

<p>NOTE: You may be wondering where the <code>title</code> and <code>body</code> attributes are defined.
Active Record automatically defines model attributes for every table column, so
you don&#39;t have to declare those attributes in your model file.</p>

<p>With our validations in place, let&#39;s modify <code>app/views/articles/new.html.erb</code> to
display any error messages for <code>title</code> and <code>body</code>:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;% @article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;% @article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p>The <a href="https://api.rubyonrails.org/classes/ActiveModel/Errors.html#method-i-full_messages_for"><code>full_messages_for</code></a>
method returns an array of user-friendly error messages for a specified
attribute. If there are no errors for that attribute, the array will be empty.</p>

<p>To understand how all of this works together, let&#39;s take another look at the
<code>new</code> and <code>create</code> controller actions:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_article_params'>article_params</span>)

  <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_save'>save</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>When we visit <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>, the <code>GET /articles/new</code>
request is mapped to the <code>new</code> action. The <code>new</code> action does not attempt to save
<code>@article</code>. Therefore, validations are not checked, and there will be no error
messages.</p>

<p>When we submit the form, the <code>POST /articles</code> request is mapped to the <code>create</code>
action. The <code>create</code> action <em>does</em> attempt to save <code>@article</code>. Therefore,
validations <em>are</em> checked. If any validation fails, <code>@article</code> will not be
saved, and <code>app/views/articles/new.html.erb</code> will be rendered with error
messages.</p>

<p>TIP: To learn more about validations, see <a href="active_record_validations.html">Active Record Validations</a>. To learn more about validation error messages,
see <a href="active_record_validations.html#working-with-validation-errors">Active Record Validations § Working with Validation Errors</a>.</p>

<h4>Finishing Up</h4>

<p>We can now create an article by visiting <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>.
To finish up, let&#39;s link to that page from the bottom of
<code>app/views/articles/index.html.erb</code>:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to &quot;New Article&quot;, new_article_path %&gt;
</code></pre>

<h3>Updating an Article</h3>

<p>We&#39;ve covered the &quot;CR&quot; of CRUD. Now let&#39;s move on to the &quot;U&quot; (Update). Updating
a resource is very similar to creating a resource. They are both multi-step
processes. First, the user requests a form to edit the data. Then, the user
submits the form. If there are no errors, then the resource is updated. Else,
the form is redisplayed with error messages, and the process is repeated.</p>

<p>These steps are conventionally handled by a controller&#39;s <code>edit</code> and <code>update</code>
actions. Let&#39;s add a typical implementation of these actions to
<code>app/controllers/articles_controller.rb</code>, below the <code>create</code> action:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_article_params'>article_params</span>)

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_article_params'>article_params</span>)
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_edit'>edit</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_article_params'>article_params</span>
      <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Notice how the <code>edit</code> and <code>update</code> actions resemble the <code>new</code> and <code>create</code>
actions.</p>

<p>The <code>edit</code> action fetches the article from the database, and stores it in
<code>@article</code> so that it can be used when building the form. By default, the <code>edit</code>
action will render <code>app/views/articles/edit.html.erb</code>.</p>

<p>The <code>update</code> action (re-)fetches the article from the database, and attempts
to update it with the submitted form data filtered by <code>article_params</code>. If no
validations fail and the update is successful, the action redirects the browser
to the article&#39;s page. Else, the action redisplays the form — with error
messages — by rendering <code>app/views/articles/edit.html.erb</code>.</p>

<h4>Using Partials to Share View Code</h4>

<p>Our <code>edit</code> form will look the same as our <code>new</code> form. Even the code will be the
same, thanks to the Rails form builder and resourceful routing. The form builder
automatically configures the form to make the appropriate kind of request, based
on whether the model object has been previously saved.</p>

<p>Because the code will be the same, we&#39;re going to factor it out into a shared
view called a <em>partial</em>. Let&#39;s create <code>app/views/articles/_form.html.erb</code> with
the following contents:</p>

<pre class="code xml"><code class="xml">&lt;%= form_with model: article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;% article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;% article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>

<p>The above code is the same as our form in <code>app/views/articles/new.html.erb</code>,
except that all occurrences of <code>@article</code> have been replaced with <code>article</code>.
Because partials are shared code, it is best practice that they do not depend on
specific instance variables set by a controller action. Instead, we will pass
the article to the partial as a local variable.</p>

<p>Let&#39;s update <code>app/views/articles/new.html.erb</code> to use the partial via <a href="https://api.rubyonrails.org/classes/ActionView/Helpers/RenderingHelper.html#method-i-render"><code>render</code></a>:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= render &quot;form&quot;, article: @article %&gt;
</code></pre>

<p>NOTE: A partial&#39;s filename must be prefixed <strong>with</strong> an underscore, e.g.
<code>_form.html.erb</code>. But when rendering, it is referenced <strong>without</strong> the
underscore, e.g. <code>render &quot;form&quot;</code>.</p>

<p>And now, let&#39;s create a very similar <code>app/views/articles/edit.html.erb</code>:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Edit Article&lt;/h1&gt;

&lt;%= render &quot;form&quot;, article: @article %&gt;
</code></pre>

<p>TIP: To learn more about partials, see <a href="layouts_and_rendering.html#using-partials">Layouts and Rendering in Rails § Using
Partials</a>.</p>

<h4>Finishing Up</h4>

<p>We can now update an article by visiting its edit page, e.g.
<a href="http://localhost:3000/articles/1/edit">http://localhost:3000/articles/1/edit</a>. To finish up, let&#39;s link to the edit
page from the bottom of <code>app/views/articles/show.html.erb</code>:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<h3>Deleting an Article</h3>

<p>Finally, we arrive at the &quot;D&quot; (Delete) of CRUD. Deleting a resource is a simpler
process than creating or updating. It only requires a route and a controller
action. And our resourceful routing (<code>resources :articles</code>) already provides the
route, which maps <code>DELETE /articles/:id</code> requests to the <code>destroy</code> action of
<code>ArticlesController</code>.</p>

<p>So, let&#39;s add a typical <code>destroy</code> action to <code>app/controllers/articles_controller.rb</code>,
below the <code>update</code> action:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_article_params'>article_params</span>)

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_article_params'>article_params</span>)
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@article</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_edit'>edit</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unprocessable_entity'>unprocessable_entity</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
    <span class='ivar'>@article</span>.<span class='id identifier rubyid_destroy'>destroy</span>

    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_path'>root_path</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_see_other'>see_other</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_article_params'>article_params</span>
      <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>destroy</code> action fetches the article from the database, and calls <a href="https://api.rubyonrails.org/classes/ActiveRecord/Persistence.html#method-i-destroy"><code>destroy</code></a>
on it. Then, it redirects the browser to the root path with status code
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/303">303 See Other</a>.</p>

<p>We have chosen to redirect to the root path because that is our main access
point for articles. But, in other circumstances, you might choose to redirect to
e.g. <code>articles_path</code>.</p>

<p>Now let&#39;s add a link at the bottom of <code>app/views/articles/show.html.erb</code> so that
we can delete an article from its own page:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to &quot;Destroy&quot;, article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: &quot;Are you sure?&quot;
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>In the above code, we use the <code>data</code> option to set the <code>data-turbo-method</code> and
<code>data-turbo-confirm</code> HTML attributes of the &quot;Destroy&quot; link. Both of these
attributes hook into <a href="https://turbo.hotwired.dev/">Turbo</a>, which is included by
default in fresh Rails applications. <code>data-turbo-method=&quot;delete&quot;</code> will cause the
link to make a <code>DELETE</code> request instead of a <code>GET</code> request.
<code>data-turbo-confirm=&quot;Are you sure?&quot;</code> will cause a confirmation dialog to appear
when the link is clicked. If the user cancels the dialog, the request will be
aborted.</p>

<p>And that&#39;s it! We can now list, show, create, update, and delete articles!
InCRUDable!</p>

<h2>Adding a Second Model</h2>

<p>It&#39;s time to add a second model to the application. The second model will handle
comments on articles.</p>

<h3>Generating a Model</h3>

<p>We&#39;re going to see the same generator that we used before when creating
the <code>Article</code> model. This time we&#39;ll create a <code>Comment</code> model to hold a
reference to an article. Run this command in your terminal:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate model Comment commenter:string body:text article:references
</code></pre>

<p>This command will generate four files:</p>

<table><thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead><tbody>
<tr>
<td>db/migrate/20140120201010_create_comments.rb</td>
<td>Migration to create the comments table in your database (your name will include a different timestamp)</td>
</tr>
<tr>
<td>app/models/comment.rb</td>
<td>The Comment model</td>
</tr>
<tr>
<td>test/models/comment_test.rb</td>
<td>Testing harness for the comment model</td>
</tr>
<tr>
<td>test/fixtures/comments.yml</td>
<td>Sample comments for use in testing</td>
</tr>
</tbody></table>

<p>First, take a look at <code>app/models/comment.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Comment</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>
<span class='kw'>end</span></code></pre>

<p>This is very similar to the <code>Article</code> model that you saw earlier. The difference
is the line <code>belongs_to :article</code>, which sets up an Active Record <em>association</em>.
You&#39;ll learn a little about associations in the next section of this guide.</p>

<p>The (<code>:references</code>) keyword used in the shell command is a special data type for models.
It creates a new column on your database table with the provided model name appended with an <code>_id</code>
that can hold integer values. To get a better understanding, analyze the
<code>db/schema.rb</code> file after running the migration.</p>

<p>In addition to the model, Rails has also made a migration to create the
corresponding database table:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CreateComments</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Migration.html" title="ActiveRecord::Migration (class)">Migration</a></span>[<span class='float'>7.2</span>]
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_string'>string</span> <span class='symbeg'>:</span><span class='id identifier rubyid_commenter'>commenter</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_text'>text</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_references'>references</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span><span class='comma'>,</span> <span class='label'>null:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_timestamps'>timestamps</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>t.references</code> line creates an integer column called <code>article_id</code>, an index
for it, and a foreign key constraint that points to the <code>id</code> column of the <code>articles</code>
table. Go ahead and run the migration:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate
</code></pre>

<p>Rails is smart enough to only execute the migrations that have not already been
run against the current database, so in this case you will just see:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>==</span>  <span class='const'>CreateComments</span><span class='op'>:</span> <span class='id identifier rubyid_migrating'>migrating</span> <span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>=</span>
<span class='op'>-</span><span class='op'>-</span> <span class='id identifier rubyid_create_table'>create_table</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>)
   <span class='comment'>#=&gt; 0.0115s
</span><span class='op'>==</span>  <span class='const'>CreateComments</span><span class='op'>:</span> <span class='id identifier rubyid_migrated'>migrated</span> (<span class='float'>0.0119</span><span class='id identifier rubyid_s'>s</span>) <span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>===</span><span class='op'>=</span></code></pre>

<h3>Associating Models</h3>

<p>Active Record associations let you easily declare the relationship between two
models. In the case of comments and articles, you could write out the
relationships this way:</p>

<ul>
<li>Each comment belongs to one article.</li>
<li>One article can have many comments.</li>
</ul>

<p>In fact, this is very close to the syntax that Rails uses to declare this
association. You&#39;ve already seen the line of code inside the <code>Comment</code> model
(app/models/comment.rb) that makes each comment belong to an Article:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Comment</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>
<span class='kw'>end</span></code></pre>

<p>You&#39;ll need to edit <code>app/models/article.rb</code> to add the other side of the
association:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>

  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>length:</span> { <span class='label'>minimum:</span> <span class='int'>10</span> }
<span class='kw'>end</span></code></pre>

<p>These two declarations enable a good bit of automatic behavior. For example, if
you have an instance variable <code>@article</code> containing an article, you can retrieve
all the comments belonging to that article as an array using
<code>@article.comments</code>.</p>

<p>TIP: For more information on Active Record associations, see the <a href="association_basics.html">Active Record
Associations</a> guide.</p>

<h3>Adding a Route for Comments</h3>

<p>As with the <code>articles</code> controller, we will need to add a route so that Rails
knows where we would like to navigate to see <code>comments</code>. Open up the
<code>config/routes.rb</code> file again, and edit it as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_root'>root</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This creates <code>comments</code> as a <em>nested resource</em> within <code>articles</code>. This is
another part of capturing the hierarchical relationship that exists between
articles and comments.</p>

<p>TIP: For more information on routing, see the <a href="routing.html">Rails Routing</a>
guide.</p>

<h3>Generating a Controller</h3>

<p>With the model in hand, you can turn your attention to creating a matching
controller. Again, we&#39;ll use the same generator we used before:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate controller Comments
</code></pre>

<p>This creates three files and one empty directory:</p>

<table><thead>
<tr>
<th>File/Directory</th>
<th>Purpose</th>
</tr>
</thead><tbody>
<tr>
<td>app/controllers/comments_controller.rb</td>
<td>The Comments controller</td>
</tr>
<tr>
<td>app/views/comments/</td>
<td>Views of the controller are stored here</td>
</tr>
<tr>
<td>test/controllers/comments_controller_test.rb</td>
<td>The test for the controller</td>
</tr>
<tr>
<td>app/helpers/comments_helper.rb</td>
<td>A view helper file</td>
</tr>
</tbody></table>

<p>Like with any blog, our readers will create their comments directly after
reading the article, and once they have added their comment, will be sent back
to the article show page to see their comment now listed. Due to this, our
<code>CommentsController</code> is there to provide a method to create comments and delete
spam comments when they arrive.</p>

<p>So first, we&#39;ll wire up the Article show template
(<code>app/views/articles/show.html.erb</code>) to let us make a new comment:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to &quot;Destroy&quot;, article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: &quot;Are you sure?&quot;
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>This adds a form on the <code>Article</code> show page that creates a new comment by
calling the <code>CommentsController</code> <code>create</code> action. The <code>form_with</code> call here uses
an array, which will build a nested route, such as <code>/articles/1/comments</code>.</p>

<p>Let&#39;s wire up the <code>create</code> in <code>app/controllers/comments_controller.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CommentsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_article_id'>article_id</span>])
    <span class='ivar'>@comment</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_comment_params'>comment_params</span>)
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_article_path'>article_path</span>(<span class='ivar'>@article</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_comment_params'>comment_params</span>
      <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_commenter'>commenter</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You&#39;ll see a bit more complexity here than you did in the controller for
articles. That&#39;s a side-effect of the nesting that you&#39;ve set up. Each request
for a comment has to keep track of the article to which the comment is attached,
thus the initial call to the <code>find</code> method of the <code>Article</code> model to get the
article in question.</p>

<p>In addition, the code takes advantage of some of the methods available for an
association. We use the <code>create</code> method on <code>@article.comments</code> to create and
save the comment. This will automatically link the comment so that it belongs to
that particular article.</p>

<p>Once we have made the new comment, we send the user back to the original article
using the <code>article_path(@article)</code> helper. As we have already seen, this calls
the <code>show</code> action of the <code>ArticlesController</code> which in turn renders the
<code>show.html.erb</code> template. This is where we want the comment to show, so let&#39;s
add that to the <code>app/views/articles/show.html.erb</code>.</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to &quot;Destroy&quot;, article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: &quot;Are you sure?&quot;
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;% @article.comments.each do |comment| %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>Now you can add articles and comments to your blog and have them show up in the
right places.</p>

<p><img src="images/getting_started/article_with_comments.png" alt="Article with Comments"></p>

<h2>Refactoring</h2>

<p>Now that we have articles and comments working, take a look at the
<code>app/views/articles/show.html.erb</code> template. It is getting long and awkward. We
can use partials to clean it up.</p>

<h3>Rendering Partial Collections</h3>

<p>First, we will make a comment partial to extract showing all the comments for
the article. Create the file <code>app/views/comments/_comment.html.erb</code> and put the
following into it:</p>

<pre class="code xml"><code class="xml">&lt;p&gt;
  &lt;strong&gt;Commenter:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comment:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;
</code></pre>

<p>Then you can change <code>app/views/articles/show.html.erb</code> to look like the
following:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to &quot;Destroy&quot;, article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: &quot;Are you sure?&quot;
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>This will now render the partial in <code>app/views/comments/_comment.html.erb</code> once
for each comment that is in the <code>@article.comments</code> collection. As the <code>render</code>
method iterates over the <code>@article.comments</code> collection, it assigns each
comment to a local variable named the same as the partial, in this case
<code>comment</code>, which is then available in the partial for us to show.</p>

<h3>Rendering a Partial Form</h3>

<p>Let us also move that new comment section out to its own partial. Again, you
create a file <code>app/views/comments/_form.html.erb</code> containing:</p>

<pre class="code xml"><code class="xml">&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>Then you make the <code>app/views/articles/show.html.erb</code> look like the following:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to &quot;Edit&quot;, edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to &quot;Destroy&quot;, article_path(@article), data: {
                    turbo_method: :delete,
                    turbo_confirm: &quot;Are you sure?&quot;
                  } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= render &#39;comments/form&#39; %&gt;
</code></pre>

<p>The second render just defines the partial template we want to render,
<code>comments/form</code>. Rails is smart enough to spot the forward slash in that
string and realize that you want to render the <code>_form.html.erb</code> file in
the <code>app/views/comments</code> directory.</p>

<p>The <code>@article</code> object is available to any partials rendered in the view because
we defined it as an instance variable.</p>

<h3>Using Concerns</h3>

<p>Concerns are a way to make large controllers or models easier to understand and manage. This also has the advantage of reusability when multiple models (or controllers) share the same concerns. Concerns are implemented using modules that contain methods representing a well-defined slice of the functionality that a model or controller is responsible for. In other languages, modules are often known as mixins.</p>

<p>You can use concerns in your controller or model the same way you would use any module. When you first created your app with <code>rails new blog</code>, two folders were created within <code>app/</code> along with the rest:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_concerns'>concerns</span>
<span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_concerns'>concerns</span></code></pre>

<p>In the example below, we will implement a new feature for our blog that would benefit from using a concern. Then, we will create a concern, and refactor the code to use it, making the code more DRY and maintainable.</p>

<p>A blog article might have various statuses - for instance, it might be visible to everyone (i.e. <code>public</code>), or only visible to the author (i.e. <code>private</code>). It may also be hidden to all but still retrievable (i.e. <code>archived</code>). Comments may similarly be hidden or visible. This could be represented using a <code>status</code> column in each model.</p>

<p>First, let&#39;s run the following migrations to add <code>status</code> to <code>Articles</code> and <code>Comments</code>:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate migration AddStatusToArticles status:string
$ bin/rails generate migration AddStatusToComments status:string
</code></pre>

<p>And next, let&#39;s update the database with the generated migrations:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate
</code></pre>

<p>To choose the status for the existing articles and comments you can add a default value to the generated migration files by adding the <code>default: &quot;public&quot;</code> option and launch the migrations again. You can also call in a rails console <code>Article.update_all(status: &quot;public&quot;)</code> and <code>Comment.update_all(status: &quot;public&quot;)</code>.</p>

<p>TIP: To learn more about migrations, see <a href="active_record_migrations.html">Active Record Migrations</a>.</p>

<p>We also have to permit the <code>:status</code> key as part of the strong parameter, in <code>app/controllers/articles_controller.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_private'>private</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_article_params'>article_params</span>
    <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span>)
  <span class='kw'>end</span></code></pre>

<p>and in <code>app/controllers/comments_controller.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_private'>private</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_comment_params'>comment_params</span>
    <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_commenter'>commenter</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span>)
  <span class='kw'>end</span></code></pre>

<p>Within the <code>article</code> model, after running a migration to add a <code>status</code> column using <code>bin/rails db:migrate</code> command, you would add:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>

  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>length:</span> { <span class='label'>minimum:</span> <span class='int'>10</span> }

  <span class='const'>VALID_STATUSES</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>public</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>private</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>]

  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='label'>inclusion:</span> { <span class='label'>in:</span> <span class='const'>VALID_STATUSES</span> }

  <span class='kw'>def</span> <span class='id identifier rubyid_archived?'>archived?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>and in the <code>Comment</code> model:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Comment</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>

  <span class='const'>VALID_STATUSES</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>public</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>private</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>]

  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='label'>inclusion:</span> { <span class='label'>in:</span> <span class='const'>VALID_STATUSES</span> }

  <span class='kw'>def</span> <span class='id identifier rubyid_archived?'>archived?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Then, in our <code>index</code> action template (<code>app/views/articles/index.html.erb</code>) we would use the <code>archived?</code> method to avoid displaying any article that is archived:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;% unless article.archived? %&gt;
      &lt;li&gt;
        &lt;%= link_to article.title, article %&gt;
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to &quot;New Article&quot;, new_article_path %&gt;
</code></pre>

<p>Similarly, in our comment partial view (<code>app/views/comments/_comment.html.erb</code>) we would use the <code>archived?</code> method to avoid displaying any comment that is archived:</p>

<pre class="code xml"><code class="xml">&lt;% unless comment.archived? %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>However, if you look again at our models now, you can see that the logic is duplicated. If in the future we increase the functionality of our blog - to include private messages, for instance -  we might find ourselves duplicating the logic yet again. This is where concerns come in handy.</p>

<p>A concern is only responsible for a focused subset of the model&#39;s responsibility; the methods in our concern will all be related to the visibility of a model. Let&#39;s call our new concern (module) <code>Visible</code>. We can create a new file inside <code>app/models/concerns</code> called <code>visible.rb</code> , and store all of the status methods that were duplicated in the models.</p>

<p><code>app/models/concerns/visible.rb</code></p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>Visible</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_archived?'>archived?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>We can add our status validation to the concern, but this is slightly more complex as validations are methods called at the class level. The <a href="ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> (<a href="https://api.rubyonrails.org/classes/ActiveSupport/Concern.html">API Guide</a>) gives us a simpler way to include them:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>Visible</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">Concern</a></span>

  <span class='const'>VALID_STATUSES</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>public</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>private</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>]

  <span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='label'>inclusion:</span> { <span class='label'>in:</span> <span class='const'>VALID_STATUSES</span> }
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_archived?'>archived?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Now, we can remove the duplicated logic from each model and instead include our new <code>Visible</code> module:</p>

<p>In <code>app/models/article.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Visible</span>

  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>

  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>length:</span> { <span class='label'>minimum:</span> <span class='int'>10</span> }
<span class='kw'>end</span></code></pre>

<p>and in <code>app/models/comment.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Comment</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Visible</span>

  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>
<span class='kw'>end</span></code></pre>

<p>Class methods can also be added to concerns. If we want to display a count of public articles or comments on our main page, we might add a class method to Visible as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>Visible</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">Concern</a></span>

  <span class='const'>VALID_STATUSES</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>public</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>private</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>]

  <span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='label'>inclusion:</span> { <span class='label'>in:</span> <span class='const'>VALID_STATUSES</span> }
  <span class='kw'>end</span>

  <span class='id identifier rubyid_class_methods'>class_methods</span> <span class='kw'>do</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_public_count'>public_count</span>
      <span class='id identifier rubyid_where'>where</span>(<span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>public</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_count'>count</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_archived?'>archived?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>archived</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Then in the view, you can call it like any class method:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;

Our blog has &lt;%= Article.public_count %&gt; articles and counting!

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;% unless article.archived? %&gt;
      &lt;li&gt;
        &lt;%= link_to article.title, article %&gt;
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to &quot;New Article&quot;, new_article_path %&gt;
</code></pre>

<p>To finish up, we will add a select box to the forms, and let the user select the status when they create a new article or post a new comment. We can also select the status of the object, or a default of <code>public</code> if it hasn&#39;t been set yet. In <code>app/views/articles/_form.html.erb</code>, we can add:</p>

<pre class="code xml"><code class="xml">&lt;div&gt;
  &lt;%= form.label :status %&gt;&lt;br&gt;
  &lt;%= form.select :status, Visible::VALID_STATUSES, selected: article.status || &#39;public&#39; %&gt;
&lt;/div&gt;
</code></pre>

<p>and in <code>app/views/comments/_form.html.erb</code>:</p>

<pre class="code xml"><code class="xml">&lt;p&gt;
  &lt;%= form.label :status %&gt;&lt;br&gt;
  &lt;%= form.select :status, Visible::VALID_STATUSES, selected: &#39;public&#39; %&gt;
&lt;/p&gt;
</code></pre>

<h2>Deleting Comments</h2>

<p>Another important feature of a blog is being able to delete spam comments. To do
this, we need to implement a link of some sort in the view and a <code>destroy</code>
action in the <code>CommentsController</code>.</p>

<p>So first, let&#39;s add the delete link in the
<code>app/views/comments/_comment.html.erb</code> partial:</p>

<pre class="code xml"><code class="xml">&lt;% unless comment.archived? %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= link_to &quot;Destroy Comment&quot;, [comment.article, comment], data: {
                  turbo_method: :delete,
                  turbo_confirm: &quot;Are you sure?&quot;
                } %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</code></pre>

<p>Clicking this new &quot;Destroy Comment&quot; link will fire off a <code>DELETE
/articles/:article_id/comments/:id</code> to our <code>CommentsController</code>, which can then
use this to find the comment we want to delete, so let&#39;s add a <code>destroy</code> action
to our controller (<code>app/controllers/comments_controller.rb</code>):</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CommentsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_article_id'>article_id</span>])
    <span class='ivar'>@comment</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_comment_params'>comment_params</span>)
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_article_path'>article_path</span>(<span class='ivar'>@article</span>)
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_article_id'>article_id</span>])
    <span class='ivar'>@comment</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
    <span class='ivar'>@comment</span>.<span class='id identifier rubyid_destroy'>destroy</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_article_path'>article_path</span>(<span class='ivar'>@article</span>)<span class='comma'>,</span> <span class='label'>status:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_see_other'>see_other</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_comment_params'>comment_params</span>
      <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_require'>require</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span>).<span class='id identifier rubyid_permit'>permit</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_commenter'>commenter</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span>)
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>destroy</code> action will find the article we are looking at, locate the comment
within the <code>@article.comments</code> collection, and then remove it from the
database and send us back to the show action for the article.</p>

<h3>Deleting Associated Objects</h3>

<p>If you delete an article, its associated comments will also need to be
deleted, otherwise they would simply occupy space in the database. Rails allows
you to use the <code>dependent</code> option of an association to achieve this. Modify the
Article model, <code>app/models/article.rb</code>, as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Visible</span>

  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>

  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>length:</span> { <span class='label'>minimum:</span> <span class='int'>10</span> }
<span class='kw'>end</span></code></pre>

<h2>Security</h2>

<h3>Basic Authentication</h3>

<p>If you were to publish your blog online, anyone would be able to add, edit and
delete articles or delete comments.</p>

<p>Rails provides an HTTP authentication system that will work nicely in
this situation.</p>

<p>In the <code>ArticlesController</code> we need to have a way to block access to the
various actions if the person is not authenticated. Here we can use the Rails
<code>http_basic_authenticate_with</code> method, which allows access to the requested
action if that method allows it.</p>

<p>To use the authentication system, we specify it at the top of our
<code>ArticlesController</code> in <code>app/controllers/articles_controller.rb</code>. In our case,
we want the user to be authenticated on every action except <code>index</code> and <code>show</code>,
so we write that:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_http_basic_authenticate_with'>http_basic_authenticate_with</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dhh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>except:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_show'>show</span>]

  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='kw'>end</span>

  <span class='comment'># snippet for brevity
</span><span class='kw'>end</span></code></pre>

<p>We also want to allow only authenticated users to delete comments, so in the
<code>CommentsController</code> (<code>app/controllers/comments_controller.rb</code>) we write:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CommentsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_http_basic_authenticate_with'>http_basic_authenticate_with</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dhh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>only:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_article_id'>article_id</span>])
    <span class='comment'># ...
</span>  <span class='kw'>end</span>

  <span class='comment'># snippet for brevity
</span><span class='kw'>end</span></code></pre>

<p>Now if you try to create a new article, you will be greeted with a basic HTTP
Authentication challenge:</p>

<p><img src="images/getting_started/challenge.png" alt="Basic HTTP Authentication Challenge"></p>

<p>After entering the correct username and password, you will remain authenticated
until a different username and password is required or the browser is closed.</p>

<p>Other authentication methods are available for Rails applications. Two popular
authentication add-ons for Rails are the
<a href="https://github.com/plataformatec/devise">Devise</a> rails engine and
the <a href="https://github.com/binarylogic/authlogic">Authlogic</a> gem,
along with a number of others.</p>

<h3>Other Security Considerations</h3>

<p>Security, especially in web applications, is a broad and detailed area. Security
in your Rails application is covered in more depth in
the <a href="security.html">Ruby on Rails Security Guide</a>.</p>

<h2>What&#39;s Next?</h2>

<p>Now that you&#39;ve seen your first Rails application, you should feel free to
update it and experiment on your own.</p>

<p>Remember, you don&#39;t have to do everything without help. As you need assistance
getting up and running with Rails, feel free to consult these support
resources:</p>

<ul>
<li>The <a href="index.html">Ruby on Rails Guides</a></li>
<li>The <a href="https://discuss.rubyonrails.org/c/rubyonrails-talk">Ruby on Rails mailing list</a></li>
</ul>

<h2>Configuration Gotchas</h2>

<p>The easiest way to work with Rails is to store all external data as UTF-8. If
you don&#39;t, Ruby libraries and Rails will often be able to convert your native
data into UTF-8, but this doesn&#39;t always work reliably, so you&#39;re better off
ensuring that all external data is UTF-8.</p>

<p>If you have made a mistake in this area, the most common symptom is a black
diamond with a question mark inside appearing in the browser. Another common
symptom is characters like &quot;Ã¼&quot; appearing instead of &quot;ü&quot;. Rails takes a number
of internal steps to mitigate common causes of these problems that can be
automatically detected and corrected. However, if you have external data that is
not stored as UTF-8, it can occasionally result in these kinds of issues that
cannot be automatically detected by Rails and corrected.</p>

<p>Two very common sources of data that are not UTF-8:</p>

<ul>
<li>Your text editor: Most text editors (such as TextMate), default to saving
files as UTF-8. If your text editor does not, this can result in special
characters that you enter in your templates (such as é) to appear as a diamond
with a question mark inside in the browser. This also applies to your i18n
translation files. Most editors that do not already default to UTF-8 (such as
some versions of Dreamweaver) offer a way to change the default to UTF-8. Do
so.</li>
<li>Your database: Rails defaults to converting data from your database into UTF-8
at the boundary. However, if your database is not using UTF-8 internally, it
may not be able to store all characters that your users enter. For instance,
if your database is using Latin-1 internally, and your user enters a Russian,
Hebrew, or Japanese character, the data will be lost forever once it enters
the database. If possible, use UTF-8 as the internal storage of your database.</li>
</ul>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>