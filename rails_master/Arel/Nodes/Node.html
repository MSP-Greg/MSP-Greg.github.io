<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Arel::Nodes::Node &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Arel::Nodes::Node",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails main</a> &raquo; 
      <a href='../../_index.html#alpha_N'>Index (N)</a> &raquo; 
        <a href="../../Arel.html" title="Arel (module)">Arel</a> &raquo; 
        <a class='nodoc' href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Node&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Arel::Nodes::Node</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a class='nodoc' href="Addition.html" title="Arel::Nodes::Addition (class)">Addition</a>, <a class='nodoc' href="As.html" title="Arel::Nodes::As (class)">As</a>, <a class='nodoc' href="Ascending.html" title="Arel::Nodes::Ascending (class)">Ascending</a>, <a class='nodoc' href="Between.html" title="Arel::Nodes::Between (class)">Between</a>, <a class='nodoc' href="Binary.html" title="Arel::Nodes::Binary (class)">Binary</a>, <a class='nodoc' href="BindParam.html" title="Arel::Nodes::BindParam (class)">BindParam</a>, <a class='nodoc' href="BitwiseAnd.html" title="Arel::Nodes::BitwiseAnd (class)">BitwiseAnd</a>, <a class='nodoc' href="BitwiseNot.html" title="Arel::Nodes::BitwiseNot (class)">BitwiseNot</a>, <a class='nodoc' href="BitwiseOr.html" title="Arel::Nodes::BitwiseOr (class)">BitwiseOr</a>, <a class='nodoc' href="BitwiseShiftLeft.html" title="Arel::Nodes::BitwiseShiftLeft (class)">BitwiseShiftLeft</a>, <a class='nodoc' href="BitwiseShiftRight.html" title="Arel::Nodes::BitwiseShiftRight (class)">BitwiseShiftRight</a>, <a class='nodoc' href="BitwiseXor.html" title="Arel::Nodes::BitwiseXor (class)">BitwiseXor</a>, <a class='nodoc' href="BoundSqlLiteral.html" title="Arel::Nodes::BoundSqlLiteral (class)">BoundSqlLiteral</a>, <a class='nodoc' href="Case.html" title="Arel::Nodes::Case (class)">Case</a>, <a class='nodoc' href="CaseInsensitiveEquality.html" title="Arel::Nodes::CaseInsensitiveEquality (class)">CaseInsensitiveEquality</a>, <a class='nodoc' href="CaseSensitiveEquality.html" title="Arel::Nodes::CaseSensitiveEquality (class)">CaseSensitiveEquality</a>, <a class='nodoc' href="Casted.html" title="Arel::Nodes::Casted (class)">Casted</a>, <a class='nodoc' href="Comment.html" title="Arel::Nodes::Comment (class)">Comment</a>, <a class='nodoc' href="Concat.html" title="Arel::Nodes::Concat (class)">Concat</a>, <a class='nodoc' href="Contains.html" title="Arel::Nodes::Contains (class)">Contains</a>, <a class='nodoc' href="Count.html" title="Arel::Nodes::Count (class)">Count</a>, <a class='nodoc' href="Cte.html" title="Arel::Nodes::Cte (class)">Cte</a>, <a class='nodoc' href="CurrentRow.html" title="Arel::Nodes::CurrentRow (class)">CurrentRow</a>, <a class='nodoc' href="DeleteStatement.html" title="Arel::Nodes::DeleteStatement (class)">DeleteStatement</a>, <a class='nodoc' href="Descending.html" title="Arel::Nodes::Descending (class)">Descending</a>, <a class='nodoc' href="Distinct.html" title="Arel::Nodes::Distinct (class)">Distinct</a>, <a class='nodoc' href="Division.html" title="Arel::Nodes::Division (class)">Division</a>, <a class='nodoc' href="DoesNotMatch.html" title="Arel::Nodes::DoesNotMatch (class)">DoesNotMatch</a>, <a class='nodoc' href="Else.html" title="Arel::Nodes::Else (class)">Else</a>, <a class='nodoc' href="Equality.html" title="Arel::Nodes::Equality (class)">Equality</a>, <a class='nodoc' href="Extract.html" title="Arel::Nodes::Extract (class)">Extract</a>, <a class='nodoc' href="False.html" title="Arel::Nodes::False (class)">False</a>, <a class='nodoc' href="Filter.html" title="Arel::Nodes::Filter (class)">Filter</a>, <a class='nodoc' href="Following.html" title="Arel::Nodes::Following (class)">Following</a>, <a class='nodoc' href="Fragments.html" title="Arel::Nodes::Fragments (class)">Fragments</a>, <a class='nodoc' href="Function.html" title="Arel::Nodes::Function (class)">Function</a>, <a class='nodoc' href="GreaterThan.html" title="Arel::Nodes::GreaterThan (class)">GreaterThan</a>, <a class='nodoc' href="GreaterThanOrEqual.html" title="Arel::Nodes::GreaterThanOrEqual (class)">GreaterThanOrEqual</a>, <a class='nodoc' href="Grouping.html" title="Arel::Nodes::Grouping (class)">Grouping</a>, <a class='nodoc' href="HomogeneousIn.html" title="Arel::Nodes::HomogeneousIn (class)">HomogeneousIn</a>, <a class='nodoc' href="In.html" title="Arel::Nodes::In (class)">In</a>, <a class='nodoc' href="InfixOperation.html" title="Arel::Nodes::InfixOperation (class)">InfixOperation</a>, <a class='nodoc' href="InsertStatement.html" title="Arel::Nodes::InsertStatement (class)">InsertStatement</a>, <a class='nodoc' href="IsDistinctFrom.html" title="Arel::Nodes::IsDistinctFrom (class)">IsDistinctFrom</a>, <a class='nodoc' href="IsNotDistinctFrom.html" title="Arel::Nodes::IsNotDistinctFrom (class)">IsNotDistinctFrom</a>, <a class='nodoc' href="JoinSource.html" title="Arel::Nodes::JoinSource (class)">JoinSource</a>, <a class='nodoc' href="LessThan.html" title="Arel::Nodes::LessThan (class)">LessThan</a>, <a class='nodoc' href="LessThanOrEqual.html" title="Arel::Nodes::LessThanOrEqual (class)">LessThanOrEqual</a>, <a class='nodoc' href="Matches.html" title="Arel::Nodes::Matches (class)">Matches</a>, <a class='nodoc' href="Multiplication.html" title="Arel::Nodes::Multiplication (class)">Multiplication</a>, <a class='nodoc' href="NamedFunction.html" title="Arel::Nodes::NamedFunction (class)">NamedFunction</a>, <a class='nodoc' href="NamedWindow.html" title="Arel::Nodes::NamedWindow (class)">NamedWindow</a>, <a class='nodoc' href="Nary.html" title="Arel::Nodes::Nary (class)">Nary</a>, <a class='nodoc' href="NodeExpression.html" title="Arel::Nodes::NodeExpression (class)">NodeExpression</a>, <a class='nodoc' href="NotEqual.html" title="Arel::Nodes::NotEqual (class)">NotEqual</a>, <a class='nodoc' href="NotIn.html" title="Arel::Nodes::NotIn (class)">NotIn</a>, <a class='nodoc' href="NotRegexp.html" title="Arel::Nodes::NotRegexp (class)">NotRegexp</a>, <a class='nodoc' href="NullsFirst.html" title="Arel::Nodes::NullsFirst (class)">NullsFirst</a>, <a class='nodoc' href="NullsLast.html" title="Arel::Nodes::NullsLast (class)">NullsLast</a>, <a class='nodoc' href="Ordering.html" title="Arel::Nodes::Ordering (class)">Ordering</a>, <a class='nodoc' href="Over.html" title="Arel::Nodes::Over (class)">Over</a>, <a class='nodoc' href="Overlaps.html" title="Arel::Nodes::Overlaps (class)">Overlaps</a>, <a class='nodoc' href="Preceding.html" title="Arel::Nodes::Preceding (class)">Preceding</a>, <a class='nodoc' href="Quoted.html" title="Arel::Nodes::Quoted (class)">Quoted</a>, <a class='nodoc' href="Range.html" title="Arel::Nodes::Range (class)">Range</a>, <a class='nodoc' href="Regexp.html" title="Arel::Nodes::Regexp (class)">Regexp</a>, <a class='nodoc' href="Rows.html" title="Arel::Nodes::Rows (class)">Rows</a>, <a class='nodoc' href="SelectCore.html" title="Arel::Nodes::SelectCore (class)">SelectCore</a>, <a class='nodoc' href="SelectStatement.html" title="Arel::Nodes::SelectStatement (class)">SelectStatement</a>, <a class='nodoc' href="Subtraction.html" title="Arel::Nodes::Subtraction (class)">Subtraction</a>, <a class='nodoc' href="TableAlias.html" title="Arel::Nodes::TableAlias (class)">TableAlias</a>, <a class='nodoc' href="True.html" title="Arel::Nodes::True (class)">True</a>, <a class='nodoc' href="Unary.html" title="Arel::Nodes::Unary (class)">Unary</a>, <a class='nodoc' href="UnaryOperation.html" title="Arel::Nodes::UnaryOperation (class)">UnaryOperation</a>, <a class='nodoc' href="UnqualifiedColumn.html" title="Arel::Nodes::UnqualifiedColumn (class)">UnqualifiedColumn</a>, <a class='nodoc' href="UpdateStatement.html" title="Arel::Nodes::UpdateStatement (class)">UpdateStatement</a>, <a class='nodoc' href="ValuesList.html" title="Arel::Nodes::ValuesList (class)">ValuesList</a>, <a class='nodoc' href="When.html" title="Arel::Nodes::When (class)">When</a>, <a class='nodoc' href="Window.html" title="Arel::Nodes::Window (class)">Window</a>, <a class='nodoc' href="With.html" title="Arel::Nodes::With (class)">With</a>, <a class='nodoc' href="WithRecursive.html" title="Arel::Nodes::WithRecursive (class)">WithRecursive</a>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="../FactoryMethods.html" title="Arel::FactoryMethods (module)"><code>::Arel::FactoryMethods</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L116'>activerecord/lib/arel/nodes/node.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Using+-7BArel-3A-3ANodes-3A-3ANode-7D">Using <code>Node</code></h3>

<p>Active Record uses <a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> to compose SQL statements. Instead of building SQL strings directly, it’s building an abstract syntax tree (AST) of the statement using various types of <code>Node</code>. Each node represents a fragment of an SQL statement.</p>

<p>The intermediate representation allows <a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> to compile the statement into the database’s specific SQL dialect only before sending it without having to care about the nuances of each database when building the statement. It also allows easier composition of statements without having to resort to (brittle and unsafe) string manipulation.</p>

<h4 id="label-Building+constraints">Building constraints</h4>

<p>One of the most common use cases of <a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> is generating constraints for <code>SELECT</code> statements. To help with that, most nodes include a couple of useful factory methods to create subtree structures for common constraints. For a full list of those, please refer to <a href="../Predications.html" title="Arel::Predications (module)"><code>::Arel::Predications</code></a>.</p>

<p>The following example creates an equality constraint where the value of the name column on the users table matches the value DHH.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Table.html" title="Arel::Table (class)">Table</a></span>.<span class='id identifier rubyid_new'><a href="../Table.html#new-class_method" title="Arel::Table.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span>)
<span class='id identifier rubyid_constraint'>constraint</span> <span class='op'>=</span> <span class='id identifier rubyid_users'>users</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_eq'>eq</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&quot;</span></span>)

<span class='comment'># =&gt; Arel::Nodes::Equality.new(
</span><span class='comment'>#      Arel::Attributes::Attribute.new(users, &quot;name&quot;),
</span><span class='comment'>#      Arel::Nodes::Casted.new(
</span><span class='comment'>#        &quot;DHH&quot;,
</span><span class='comment'>#        Arel::Attributes::Attribute.new(users, &quot;name&quot;)
</span><span class='comment'>#      )
</span><span class='comment'>#    )</span></code></pre>

<p>The resulting SQL fragment will look like this:</p>

<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span>.<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>The constraint fragments can be used with regular <a href="../../ActiveRecord/Relation.html" title="ActiveRecord::Relation (class)"><code>::ActiveRecord::Relation</code></a> objects instead of a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a>. The following two examples show two ways of creating the same query.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;name&quot; = &#39;DHH&#39;
</span>
<span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_arel_table'>arel_table</span>

<span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_users'>users</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_eq'>eq</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&#39;</span></span>))

<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;name&quot; = &#39;DHH&#39;</span></code></pre>

<h4 id="label-Functions">Functions</h4>

<p><a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> comes with built-in support for SQL functions like <code>COUNT</code>, <code>SUM</code>, <code>MIN</code>, <code>MAX</code>, and <code>AVG</code>. The <a href="../Expressions.html" title="Arel::Expressions (module)"><code>::Arel::Expressions</code></a> module includes factory methods for the default functions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_employees'>employees</span> <span class='op'>=</span> <span class='const'>Employee</span>.<span class='id identifier rubyid_arel_table'>arel_table</span>

<span class='const'>Employee</span>.<span class='id identifier rubyid_select'>select</span>(<span class='id identifier rubyid_employees'>employees</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_department_id'>department_id</span>]<span class='comma'>,</span> <span class='id identifier rubyid_employees'>employees</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_salary'>salary</span>].<span class='id identifier rubyid_average'>average</span>).<span class='id identifier rubyid_group'>group</span>(<span class='id identifier rubyid_employees'>employees</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_department_id'>department_id</span>])

<span class='comment'># SELECT &quot;employees&quot;.&quot;department_id&quot;, AVG(&quot;employees&quot;.&quot;salary&quot;)
</span><span class='comment'>#   FROM &quot;employees&quot; GROUP BY &quot;employees&quot;.&quot;department_id&quot;</span></code></pre>

<p>It’s also possible to use custom functions by using the <a href="NamedFunction.html" title="Arel::Nodes::NamedFunction (class)"><code>NamedFunction</code></a> node type. It accepts a function name and an array of parameters.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="NamedFunction.html" title="Arel::Nodes::NamedFunction (class)">NamedFunction</a></span>.<span class='id identifier rubyid_new'><a href="NamedFunction.html#new-class_method" title="Arel::Nodes::NamedFunction.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date_trunc</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> [<span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span>.<span class='id identifier rubyid_build_quoted'><a href="../Nodes.html#build_quoted-class_method" title="Arel::Nodes.build_quoted (method)">build_quoted</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>day</span><span class='tstring_end'>&#39;</span></span>)<span class='comma'>,</span> <span class='const'>User</span>.<span class='id identifier rubyid_arel_table'>arel_table</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_created_at'>created_at</span>]])

<span class='comment'># date_trunc(&#39;day&#39;, &quot;users&quot;.&quot;created_at&quot;)</span></code></pre>

<h4 id="label-Quoting+-26+bind+params">Quoting &amp; bind params</h4>

<p>Values that you pass to <a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> nodes need to be quoted or wrapped in bind params. This ensures they are properly converted into the correct format without introducing a possible SQL injection vulnerability. Most factory methods (like <code>eq</code>, <code>gt</code>, <code>lteq</code>, …) quote passed values automatically. <a href="When.html" title="Arel::Nodes::When (class)"><code>When</code></a> not using a factory method, it’s possible to convert a value and wrap it in an <a href="Quoted.html" title="Arel::Nodes::Quoted (class)"><code>Quoted</code></a> node (if necessary) by calling <tt>Arel::Nodes. build_quoted</tt>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span>.<span class='id identifier rubyid_build_quoted'><a href="../Nodes.html#build_quoted-class_method" title="Arel::Nodes.build_quoted (method)">build_quoted</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># &#39;foo&#39;
</span><span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span>.<span class='id identifier rubyid_build_quoted'><a href="../Nodes.html#build_quoted-class_method" title="Arel::Nodes.build_quoted (method)">build_quoted</a></span>(<span class='float'>12.3</span>)  <span class='comment'># 12.3</span></code></pre>

<p>Instead of quoting values and embedding them directly in the SQL statement, it’s also possible to create bind params. This keeps the actual values outside of the statement and allows using the prepared statement feature of some databases.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_attribute'>attribute</span> <span class='op'>=</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveRecord/Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveRecord/Relation/QueryAttribute.html" title="ActiveRecord::Relation::QueryAttribute (class)">QueryAttribute</a></span>.<span class='id identifier rubyid_new'><a href="../../ActiveRecord/Relation/QueryAttribute.html#new-class_method" title="ActiveRecord::Relation::QueryAttribute.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveRecord/Type.html" title="ActiveRecord::Type (module)">Type</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveRecord/Type.html#String-constant" title="ActiveRecord::Type::String (constant)">String</a></span>.<span class='id identifier rubyid_new'>new</span>)
<span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="BindParam.html" title="Arel::Nodes::BindParam (class)">BindParam</a></span>.<span class='id identifier rubyid_new'><a href="BindParam.html#new-class_method" title="Arel::Nodes::BindParam.new (method)">new</a></span>(<span class='id identifier rubyid_attribute'>attribute</span>)</code></pre>

<p><a href="When.html" title="Arel::Nodes::When (class)"><code>When</code></a> ActiveRecord runs the query, bind params are replaced by placeholders (like <code>$1</code>) and the values are passed separately.</p>

<h4 id="label-SQL+Literals">SQL Literals</h4>

<p>For cases where there is no way to represent a particular SQL fragment using <a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> nodes, you can use an SQL literal. SQL literals are strings that <a href="../../Arel.html" title="Arel (module)"><code>::Arel</code></a> will treat “as is”.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LOWER(&quot;users&quot;.&quot;name&quot;)</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_eq'>eq</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>dhh</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># LOWER(&quot;users&quot;.&quot;name&quot;) = &#39;dhh&#39;</span></code></pre>

<p>Please keep in mind that passing data as raw SQL literals might introduce a possible SQL injection. However, <a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">Arel.sql</a> supports binding parameters which will ensure proper quoting. This can be useful when you need to control the exact SQL you run, but you still have potentially user-supplied values.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LOWER(&quot;users&quot;.&quot;name&quot;) = ?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>dhh</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># LOWER(&quot;users&quot;.&quot;name&quot;) = &#39;dhh&#39;</span></code></pre>

<p>You can also combine SQL literals.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span> <span class='op'>=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SELECT * FROM &quot;users&quot; WHERE </span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span> <span class='op'>+=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LOWER(&quot;users&quot;.&quot;name&quot;) = :name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>dhh</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span> <span class='op'>+=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AND &quot;users&quot;.&quot;age&quot; &gt; :age</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>age:</span> <span class='int'>35</span>)

<span class='comment'># SELECT * FROM &quot;users&quot; WHERE LOWER(&quot;users&quot;.&quot;name&quot;) = &#39;dhh&#39; AND &quot;users&quot;.&quot;age&quot; &gt; &#39;35&#39;</span></code></pre>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#equality%3F-instance_method" title="#equality? (instance method)">#<strong>equality?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#and-instance_method" title="#and (instance method)">#<strong>and</strong>(right)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Factory method to create an <a href="../Nodes.html#And-constant" title="Arel::Nodes::And (constant)">And</a> node.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#fetch_attribute-instance_method" title="#fetch_attribute (instance method)">#<strong>fetch_attribute</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#invert-instance_method" title="#invert (instance method)">#<strong>invert</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#not-instance_method" title="#not (instance method)">#<strong>not</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Factory method to create a <code>Nodes::Not</code> node that has the recipient of the caller as a child.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#or-instance_method" title="#or (instance method)">#<strong>or</strong>(right)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Factory method to create a <a href="Grouping.html" title="Arel::Nodes::Grouping (class)"><code>Grouping</code></a> node that has an <a href="../Nodes.html#Or-constant" title="Arel::Nodes::Or (constant)">Or</a> node as a child.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_sql-instance_method" title="#to_sql (instance method)">#<strong>to_sql</strong>(engine = Table.engine)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>FIXME: this method should go away.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="../FactoryMethods.html" title="Arel::FactoryMethods (module)"><code>::Arel::FactoryMethods</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../FactoryMethods.html#cast-instance_method" title="Arel::FactoryMethods#cast (method)">#cast</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#coalesce-instance_method" title="Arel::FactoryMethods#coalesce (method)">#coalesce</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_and-instance_method" title="Arel::FactoryMethods#create_and (method)">#create_and</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_false-instance_method" title="Arel::FactoryMethods#create_false (method)">#create_false</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_join-instance_method" title="Arel::FactoryMethods#create_join (method)">#create_join</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_on-instance_method" title="Arel::FactoryMethods#create_on (method)">#create_on</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_string_join-instance_method" title="Arel::FactoryMethods#create_string_join (method)">#create_string_join</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_table_alias-instance_method" title="Arel::FactoryMethods#create_table_alias (method)">#create_table_alias</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#create_true-instance_method" title="Arel::FactoryMethods#create_true (method)">#create_true</a>,
        <a class='i_m nodoc' href="../FactoryMethods.html#grouping-instance_method" title="Arel::FactoryMethods#grouping (method)">#grouping</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../FactoryMethods.html#lower-instance_method" title="Arel::FactoryMethods#lower (method)">#lower</a></td>
      <td><div class='inline'><p>Create a LOWER() function.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="equality?-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>equality?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L158-L158'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='158' data-end='158'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 158</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_equality?'>equality?</span><span class='semicolon'>;</span> <span class='kw'>false</span><span class='semicolon'>;</span> <span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="and-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>and</strong>(right)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Factory method to create an <a href="../Nodes.html#And-constant" title="Arel::Nodes::And (constant)">And</a> node.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L135-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='135' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>and</span>(<span class='id identifier rubyid_right'>right</span>)
  <span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html#And-constant" title="Arel::Nodes::And (constant)">And</a></span>.<span class='id identifier rubyid_new'>new</span> [<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_right'>right</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch_attribute-instance_method">
  <h3 class='signature nodoc'>
    #<strong>fetch_attribute</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L155-L156'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='155' data-end='156'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 155</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_attribute'>fetch_attribute</span>(<span class='op'>&amp;</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invert-instance_method">
  <h3 class='signature nodoc'>
    #<strong>invert</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L139-L141'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='139' data-end='141'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 139</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invert'>invert</span>
  <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'>Not</span>.<span class='id identifier rubyid_new'>new</span>(<span class='kw'>self</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="not-instance_method">
  <h3 class='signature nodoc'>
    #<strong>not</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Factory method to create a <code>Nodes::Not</code> node that has the recipient of the caller as a child.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L122-L124'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='122' data-end='124'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 122</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>not</span>
  <span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'>Not</span>.<span class='id identifier rubyid_new'>new</span> <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="or-instance_method">
  <h3 class='signature nodoc'>
    #<strong>or</strong>(right)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Factory method to create a <a href="Grouping.html" title="Arel::Nodes::Grouping (class)"><code>Grouping</code></a> node that has an <a href="../Nodes.html#Or-constant" title="Arel::Nodes::Or (constant)">Or</a> node as a child.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L129-L131'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='129' data-end='131'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 129</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>or</span>(<span class='id identifier rubyid_right'>right</span>)
  <span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="Grouping.html" title="Arel::Nodes::Grouping (class)">Grouping</a></span>.<span class='id identifier rubyid_new'><a href="Unary.html#new-class_method" title="Arel::Nodes::Unary.new (method)">new</a></span> <span class='const'><a href="../Nodes.html" title="Arel::Nodes (module)">Nodes</a></span><span class='op'>::</span><span class='const'><a href="../Nodes.html#Or-constant" title="Arel::Nodes::Or (constant)">Or</a></span>.<span class='id identifier rubyid_new'>new</span>([<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_right'>right</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_sql-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_sql</strong>(engine = Table.engine)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>FIXME: this method should go away.  I don’t like people calling to_sql on non-head nodes.  This forces us to walk the AST until we can find a node that has a “relation” member.</p>

<p>Maybe we should just use <a href="../Table.html#engine-class_method" title="Arel::Table.engine (method)">Table.engine</a>?  :‘(</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activerecord/lib/arel/nodes/node.rb#L148-L153'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='148' data-end='153'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/arel/nodes/node.rb', line 148</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_sql'>to_sql</span>(<span class='id identifier rubyid_engine'>engine</span> <span class='op'>=</span> <span class='const'><a href="../Table.html" title="Arel::Table (class)">Table</a></span>.<span class='id identifier rubyid_engine'><a href="../Table.html#engine-class_method" title="Arel::Table.engine (method)">engine</a></span>)
  <span class='id identifier rubyid_collector'>collector</span> <span class='op'>=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../Collectors.html" title="Arel::Collectors (module)">Collectors</a></span><span class='op'>::</span><span class='const'><a href="../Collectors/SQLString.html" title="Arel::Collectors::SQLString (class)">SQLString</a></span>.<span class='id identifier rubyid_new'><a href="../Collectors/SQLString.html#new-class_method" title="Arel::Collectors::SQLString.new (method)">new</a></span>
  <span class='id identifier rubyid_engine'>engine</span>.<span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
    <span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_visitor'>visitor</span>.<span class='id identifier rubyid_accept'>accept</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_collector'>collector</span>).<span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>