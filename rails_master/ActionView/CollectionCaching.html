<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionView::CollectionCaching &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionView::CollectionCaching",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../ActionView.html" title="ActionView (module)">ActionView</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>CollectionCaching&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionView::CollectionCaching</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This module is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a class='nodoc' href="CollectionRenderer.html" title="ActionView::CollectionRenderer (class)"><code>CollectionRenderer</code></a>,
          <a class='nodoc' href="ObjectRenderer.html" title="ActionView::ObjectRenderer (class)"><code>ObjectRenderer</code></a>,
          <a href="PartialRenderer.html" title="ActionView::PartialRenderer (class)"><code>PartialRenderer</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L6'>actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#prepend_features-instance_method" title="ActiveSupport::Concern#prepend_features (method)">prepend_features</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#callable_cache_key%3F-instance_method" title="#callable_cache_key? (instance method)">#<strong>callable_cache_key?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#cache_collection_render-instance_method" title="#cache_collection_render (instance method)">#<strong>cache_collection_render</strong>(instrumentation_payload, view, template, collection)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#collection_by_cache_keys-instance_method" title="#collection_by_cache_keys (instance method)">#<strong>collection_by_cache_keys</strong>(view, template, collection)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#expanded_cache_key-instance_method" title="#expanded_cache_key (instance method)">#<strong>expanded_cache_key</strong>(key, view, template, digest_path)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#fetch_or_cache_partial-instance_method" title="#fetch_or_cache_partial (instance method)">#<strong>fetch_or_cache_partial</strong>(cached_partials, template, order_by:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p><code>order_by</code> is an enumerable object containing keys of the cache, all keys are  passed in whether found already or not.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#will_cache%3F-instance_method" title="#will_cache? (instance method)">#<strong>will_cache?</strong>(options, view)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L9-L13'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


9
10
11
12
13</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 9</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='comment'># Fallback cache store if Action View is used without Rails.
</span>  <span class='comment'># Otherwise overridden in Railtie to use Rails.cache.
</span>  <span class='id identifier rubyid_mattr_accessor'>mattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_collection_cache'>collection_cache</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Cache.html" title="ActiveSupport::Cache (module)">Cache</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Cache/MemoryStore.html" title="ActiveSupport::Cache::MemoryStore (class)">MemoryStore</a></span>.<span class='id identifier rubyid_new'><a href="../ActiveSupport/Cache/MemoryStore.html#new-class_method" title="ActiveSupport::Cache::MemoryStore.new (method)">new</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="callable_cache_key?-instance_method">
  <h3 class='signature ro priv  nodoc first'>
    #<strong>callable_cache_key?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L54-L56'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='54' data-end='56'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 54</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_callable_cache_key?'>callable_cache_key?</span>
  <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cached'>cached</span>].<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="cache_collection_render-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>cache_collection_render</strong>(instrumentation_payload, view, template, collection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L20-L52'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='20' data-end='52'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 20</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_collection_render'>cache_collection_render</span>(<span class='id identifier rubyid_instrumentation_payload'>instrumentation_payload</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_collection'>collection</span>)
  <span class='kw'>return</span> <span class='kw'>yield</span>(<span class='id identifier rubyid_collection'>collection</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_will_cache?'><a href="#will_cache%3F-instance_method" title="ActionView::CollectionCaching#will_cache? (method)">will_cache?</a></span>(<span class='ivar'>@options</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span>)

  <span class='id identifier rubyid_collection_iterator'>collection_iterator</span> <span class='op'>=</span> <span class='id identifier rubyid_collection'>collection</span>

  <span class='comment'># Result is a hash with the key represents the
</span>  <span class='comment'># key used for cache lookup and the value is the item
</span>  <span class='comment'># on which the partial is being rendered
</span>  <span class='id identifier rubyid_keyed_collection'>keyed_collection</span><span class='comma'>,</span> <span class='id identifier rubyid_ordered_keys'>ordered_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_collection_by_cache_keys'><a href="#collection_by_cache_keys-instance_method" title="ActionView::CollectionCaching#collection_by_cache_keys (method)">collection_by_cache_keys</a></span>(<span class='id identifier rubyid_view'>view</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_collection'>collection</span>)

  <span class='comment'># Pull all partials from cache
</span>  <span class='comment'># Result is a hash, key matches the entry in
</span>  <span class='comment'># `keyed_collection` where the cache was retrieved and the
</span>  <span class='comment'># value is the value that was present in the cache
</span>  <span class='id identifier rubyid_cached_partials'>cached_partials</span> <span class='op'>=</span> <span class='id identifier rubyid_collection_cache'>collection_cache</span>.<span class='id identifier rubyid_read_multi'>read_multi</span>(<span class='op'>*</span><span class='id identifier rubyid_keyed_collection'>keyed_collection</span>.<span class='id identifier rubyid_keys'>keys</span>)
  <span class='id identifier rubyid_instrumentation_payload'>instrumentation_payload</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cache_hits'>cache_hits</span>] <span class='op'>=</span> <span class='id identifier rubyid_cached_partials'>cached_partials</span>.<span class='id identifier rubyid_size'>size</span>

  <span class='comment'># Extract the items for the keys that are not found
</span>  <span class='id identifier rubyid_collection'>collection</span> <span class='op'>=</span> <span class='id identifier rubyid_keyed_collection'>keyed_collection</span>.<span class='id identifier rubyid_reject'>reject</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_cached_partials'>cached_partials</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_key'>key</span>) }.<span class='id identifier rubyid_values'>values</span>

  <span class='id identifier rubyid_rendered_partials'>rendered_partials</span> <span class='op'>=</span> <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> [] <span class='op'>:</span> <span class='kw'>yield</span>(<span class='id identifier rubyid_collection_iterator'>collection_iterator</span>.<span class='id identifier rubyid_from_collection'>from_collection</span>(<span class='id identifier rubyid_collection'>collection</span>))

  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_keyed_partials'>keyed_partials</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_or_cache_partial'><a href="#fetch_or_cache_partial-instance_method" title="ActionView::CollectionCaching#fetch_or_cache_partial (method)">fetch_or_cache_partial</a></span>(<span class='id identifier rubyid_cached_partials'>cached_partials</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='label'>order_by:</span> <span class='id identifier rubyid_keyed_collection'>keyed_collection</span>.<span class='id identifier rubyid_each_key'>each_key</span>) <span class='kw'>do</span>
    <span class='comment'># This block is called once
</span>    <span class='comment'># for every cache miss while preserving order.
</span>    <span class='id identifier rubyid_rendered_partials'>rendered_partials</span>[<span class='id identifier rubyid_index'>index</span>].<span class='id identifier rubyid_tap'>tap</span> { <span class='id identifier rubyid_index'>index</span> <span class='op'>+=</span> <span class='int'>1</span> }
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ordered_keys'>ordered_keys</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_keyed_partials'>keyed_partials</span>[<span class='id identifier rubyid_key'>key</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="collection_by_cache_keys-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>collection_by_cache_keys</strong>(view, template, collection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L58-L69'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='58' data-end='69'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 58</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_collection_by_cache_keys'>collection_by_cache_keys</span>(<span class='id identifier rubyid_view'>view</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_collection'>collection</span>)
  <span class='id identifier rubyid_seed'>seed</span> <span class='op'>=</span> <span class='id identifier rubyid_callable_cache_key?'><a href="#callable_cache_key%3F-instance_method" title="ActionView::CollectionCaching#callable_cache_key? (method)">callable_cache_key?</a></span> <span class='op'>?</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cached'>cached</span>] <span class='op'>:</span> <span class='tlambda'>-&gt;</span>(<span class='id identifier rubyid_i'>i</span>) <span class='tlambeg'>{</span> <span class='id identifier rubyid_i'>i</span> }

  <span class='id identifier rubyid_digest_path'>digest_path</span> <span class='op'>=</span> <span class='id identifier rubyid_view'>view</span>.<span class='id identifier rubyid_digest_path_from_template'>digest_path_from_template</span>(<span class='id identifier rubyid_template'>template</span>)
  <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_preload!'>preload!</span> <span class='kw'>if</span> <span class='id identifier rubyid_callable_cache_key?'><a href="#callable_cache_key%3F-instance_method" title="ActionView::CollectionCaching#callable_cache_key? (method)">callable_cache_key?</a></span>

  <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_each_with_object'>each_with_object</span>([{}<span class='comma'>,</span> []]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='comma'>,</span> (<span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_ordered_keys'>ordered_keys</span>)<span class='op'>|</span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_expanded_cache_key'><a href="#expanded_cache_key-instance_method" title="ActionView::CollectionCaching#expanded_cache_key (method)">expanded_cache_key</a></span>(<span class='id identifier rubyid_seed'>seed</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_item'>item</span>)<span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_digest_path'>digest_path</span>)
    <span class='id identifier rubyid_ordered_keys'>ordered_keys</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_key'>key</span>
    <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_item'>item</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="expanded_cache_key-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>expanded_cache_key</strong>(key, view, template, digest_path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L71-L74'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='74'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expanded_cache_key'>expanded_cache_key</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_digest_path'>digest_path</span>)
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_view'>view</span>.<span class='id identifier rubyid_combined_fragment_cache_key'>combined_fragment_cache_key</span>(<span class='id identifier rubyid_view'>view</span>.<span class='id identifier rubyid_cache_fragment_name'>cache_fragment_name</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='label'>digest_path:</span> <span class='id identifier rubyid_digest_path'>digest_path</span>))
  <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_frozen?'>frozen?</span> <span class='op'>?</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_dup'>dup</span> <span class='op'>:</span> <span class='id identifier rubyid_key'>key</span> <span class='comment'># #read_multi &amp; #write may require mutability, Dalli 2.6.0.
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch_or_cache_partial-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>fetch_or_cache_partial</strong>(cached_partials, template, order_by:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>order_by</code> is an enumerable object containing keys of the cache, all keys are  passed in whether found already or not.</p>

<p><code>cached_partials</code> is a hash. If the value exists it represents the rendered partial from the cache otherwise <code>Hash#fetch</code> will take the value of its block.</p>

<p>This method expects a block that will return the rendered partial. An example is to render all results for each element that was not found in the cache and store it as an array. Order it so that the first empty cache element in <code>cached_partials</code> corresponds to the first element in <code>rendered_partials</code>.</p>

<p>If the partial is not already cached it will also be written back to the underlying cache store.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L91-L118'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='91' data-end='118'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 91</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_or_cache_partial'>fetch_or_cache_partial</span>(<span class='id identifier rubyid_cached_partials'>cached_partials</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='label'>order_by:</span>)
  <span class='id identifier rubyid_entries_to_write'>entries_to_write</span> <span class='op'>=</span> {}

  <span class='id identifier rubyid_keyed_partials'>keyed_partials</span> <span class='op'>=</span> <span class='id identifier rubyid_order_by'>order_by</span>.<span class='id identifier rubyid_index_with'>index_with</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cache_key'>cache_key</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_cached_partials'>cached_partials</span>[<span class='id identifier rubyid_cache_key'>cache_key</span>]
      <span class='id identifier rubyid_build_rendered_template'>build_rendered_template</span>(<span class='id identifier rubyid_content'>content</span><span class='comma'>,</span> <span class='id identifier rubyid_template'>template</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_rendered_partial'>rendered_partial</span> <span class='op'>=</span> <span class='kw'>yield</span>
      <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='id identifier rubyid_rendered_partial'>rendered_partial</span>.<span class='id identifier rubyid_body'>body</span>

      <span class='comment'># We want to cache buffers as raw strings. This both improve performance and
</span>      <span class='comment'># avoid creating forward compatibility issues with the internal representation
</span>      <span class='comment'># of these two types.
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../ActionView.html" title="ActionView (module)">ActionView</a></span><span class='op'>::</span><span class='const'><a href="OutputBuffer.html" title="ActionView::OutputBuffer (class)">OutputBuffer</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SafeBuffer.html" title="ActiveSupport::SafeBuffer (class)">SafeBuffer</a></span>)
        <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_to_str'>to_str</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_entries_to_write'>entries_to_write</span>[<span class='id identifier rubyid_cache_key'>cache_key</span>] <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>
      <span class='id identifier rubyid_rendered_partial'>rendered_partial</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_entries_to_write'>entries_to_write</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_collection_cache'>collection_cache</span>.<span class='id identifier rubyid_write_multi'>write_multi</span>(<span class='id identifier rubyid_entries_to_write'>entries_to_write</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_keyed_partials'>keyed_partials</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="will_cache?-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>will_cache?</strong>(options, view)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb#L16-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='16' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/renderer/partial_renderer/collection_caching.rb', line 16</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_will_cache?'>will_cache?</span>(<span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='id identifier rubyid_view'>view</span>)
  <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cached'>cached</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_view'>view</span>.<span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_perform_caching'>perform_caching</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_view'>view</span>.<span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_perform_caching'>perform_caching</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>