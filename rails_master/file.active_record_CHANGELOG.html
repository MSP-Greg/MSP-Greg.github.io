<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Active Record CHANGELOG &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "active_record_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Active Record CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<ul>
<li><p>Added support for recursive common table expressions.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_with_recursive'>with_recursive</span>(
  <span class='label'>post_and_replies:</span> [
    <span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>id:</span> <span class='int'>42</span>)<span class='comma'>,</span>
    <span class='const'>Post</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>JOIN post_and_replies ON posts.in_reply_to_id = post_and_replies.id</span><span class='tstring_end'>&#39;</span></span>)<span class='comma'>,</span>
  ]
)</code></pre>

<p>Generates the following SQL:</p>

<pre class="code sql"><code class="sql">WITH RECURSIVE &quot;post_and_replies&quot; AS (
  (SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;id&quot; = 42)
  UNION ALL
  (SELECT &quot;posts&quot;.* FROM &quot;posts&quot; JOIN post_and_replies ON posts.in_reply_to_id = post_and_replies.id)
)
SELECT &quot;posts&quot;.* FROM &quot;posts&quot;
</code></pre>

<p><em>ClearlyClaire</em></p></li>
<li><p><code>validate_constraint</code> can be called in a <code>change_table</code> block.</p>

<p>ex:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_change_table'>change_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_products'>products</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_check_constraint'>check_constraint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price &gt; discounted_price</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price_check</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>validate:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_validate_check_constraint'>validate_check_constraint</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price_check</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p><em>Cody Cutrer</em></p></li>
<li><p><code>PostgreSQLAdapter</code> now decodes columns of type date to <a href="Date.html" title="Date (class)"><code>Date</code></a> instead of string.</p>

<p>Ex:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>.<span class='id identifier rubyid_connection'><a href="ActiveRecord/ConnectionHandling.html#connection-instance_method" title="ActiveRecord::ConnectionHandling#connection (method)">connection</a></span>
     .<span class='id identifier rubyid_select_value'>select_value</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select &#39;2024-01-01&#39;::date</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_class'>class</span> <span class='comment'>#=&gt; Date</span></code></pre>

<p><em>Joé Dupuis</em></p></li>
<li><p>Strict loading using <code>:n_plus_one_only</code> does not eagerly load child associations.</p>

<p>With this change, child associations are no longer eagerly loaded, to
match intended behavior and to prevent non-deterministic order issues caused
by calling methods like <code>first</code> or <code>last</code>. As <code>first</code> and <code>last</code> don&#39;t cause
an N+1 by themselves, calling child associations will no longer raise.
Fixes #49473.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_person'>person</span> <span class='op'>=</span> <span class='const'>Person</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_strict_loading!'>strict_loading!</span>(<span class='label'>mode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_n_plus_one_only'>n_plus_one_only</span>)
<span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_first'>first</span>
<span class='comment'># SELECT * FROM posts WHERE person_id = 1; -- non-deterministic order
</span><span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_firm'>firm</span> <span class='comment'># raises ActiveRecord::StrictLoadingViolationError</span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_person'>person</span> <span class='op'>=</span> <span class='const'>Person</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_strict_loading!'>strict_loading!</span>(<span class='label'>mode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_n_plus_one_only'>n_plus_one_only</span>)
<span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_first'>first</span> <span class='comment'># this is 1+1, not N+1
</span><span class='comment'># SELECT * FROM posts WHERE person_id = 1 ORDER BY id LIMIT 1;
</span><span class='id identifier rubyid_person'>person</span>.<span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_firm'>firm</span> <span class='comment'># no longer raises</span></code></pre>

<p><em>Reid Lynch</em></p></li>
<li><p>Allow <code>Sqlite3Adapter</code> to use <code>sqlite3</code> gem version <code>2.x</code></p>

<p><em>Mike Dalessio</em></p></li>
<li><p>Allow <code>ActiveRecord::Base#pluck</code> to accept hash values</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='const'>Post</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>).<span class='id identifier rubyid_pluck'>pluck</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts.id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments.id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments.body</span><span class='tstring_end'>&quot;</span></span>)

<span class='comment'># After
</span><span class='const'>Post</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>).<span class='id identifier rubyid_pluck'>pluck</span>(<span class='label'>posts:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>]<span class='comma'>,</span> <span class='label'>comments:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>])</code></pre>

<p><em>fatkodima</em></p></li>
<li><p>Raise an <a href="ActiveRecord/ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>::ActiveRecord::ActiveRecordError</code></a> error when the MySQL database returns an invalid version string.</p>

<p><em>Kevin McPhillips</em></p></li>
<li><p><code>ActiveRecord::Base.transaction</code> now yields an <a href="ActiveRecord/Transaction.html" title="ActiveRecord::Transaction (class)"><code>::ActiveRecord::Transaction</code></a> object.</p>

<p>This allows to register callbacks on it.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_transaction'>transaction</span><span class='op'>|</span>
  <span class='id identifier rubyid_article'>article</span>.<span class='id identifier rubyid_update'>update</span>(<span class='label'>published:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_transaction'>transaction</span>.<span class='id identifier rubyid_after_commit'>after_commit</span> <span class='kw'>do</span>
    <span class='const'>PublishNotificationMailer</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>article:</span> <span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_deliver_later'>deliver_later</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Add <code>ActiveRecord::Base.current_transaction</code>.</p>

<p>Returns the current transaction, to allow registering callbacks on it.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_current_transaction'>current_transaction</span>.<span class='id identifier rubyid_after_commit'>after_commit</span> <span class='kw'>do</span>
  <span class='const'>PublishNotificationMailer</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>article:</span> <span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_deliver_later'>deliver_later</span>
<span class='kw'>end</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Add <a href="ActiveRecord.html#after_all_transactions_commit-class_method" title="ActiveRecord.after_all_transactions_commit (method)">ActiveRecord.after_all_transactions_commit</a> callback.</p>

<p>Useful for code that may run either inside or outside a transaction and needs
to perform work after the state changes have been properly persisted.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_publish_article'>publish_article</span>(<span class='id identifier rubyid_article'>article</span>)
  <span class='id identifier rubyid_article'>article</span>.<span class='id identifier rubyid_update'>update</span>(<span class='label'>published:</span> <span class='kw'>true</span>)
  <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span>.<span class='id identifier rubyid_after_all_transactions_commit'><a href="ActiveRecord.html#after_all_transactions_commit-class_method" title="ActiveRecord.after_all_transactions_commit (method)">after_all_transactions_commit</a></span> <span class='kw'>do</span>
    <span class='const'>PublishNotificationMailer</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>article:</span> <span class='id identifier rubyid_article'>article</span>).<span class='id identifier rubyid_deliver_later'>deliver_later</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>In the above example, the block is either executed immediately if called outside
of a transaction, or called after the open transaction is committed.</p>

<p>If the transaction is rolled back, the block isn&#39;t called.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Add the ability to ignore counter cache columns until they are backfilled.</p>

<p>Starting to use counter caches on existing large tables can be troublesome, because the column
values must be backfilled separately of the column addition (to not lock the table for too long)
and before the use of <code>:counter_cache</code> (otherwise methods like <code>size</code>/<code>any?</code>/etc, which use
counter caches internally, can produce incorrect results). People usually use database triggers
or callbacks on child associations while backfilling before introducing a counter cache
configuration to the association.</p>

<p>Now, to safely backfill the column, while keeping the column updated with child records added/removed, use:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Comment</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_post'>post</span><span class='comma'>,</span> <span class='label'>counter_cache:</span> { <span class='label'>active:</span> <span class='kw'>false</span> }
<span class='kw'>end</span></code></pre>

<p>While the counter cache is not &quot;active&quot;, the methods like <code>size</code>/<code>any?</code>/etc will not use it,
but get the results directly from the database. After the counter cache column is backfilled, simply
remove the <code>{ active: false }</code> part from the counter cache definition, and it will now be used by the
mentioned methods.</p>

<p><em>fatkodima</em></p></li>
<li><p>Retry known idempotent SELECT queries on connection-related exceptions.</p>

<p>SELECT queries we construct by walking the Arel tree and / or with known model attributes
are idempotent and can safely be retried in the case of a connection error. Previously,
adapters such as <code>TrilogyAdapter</code> would raise <code>ActiveRecord::ConnectionFailed: Trilogy::EOFError</code>
when encountering a connection error mid-request.</p>

<p><em>Adrianna Chang</em></p></li>
<li><p>Allow association&#39;s <code>foreign_key</code> to be composite.</p>

<p><code>query_constraints</code> option was the only way to configure a composite foreign key by passing an <a href="Array.html" title="Array (class)"><code>Array</code></a>.
Now it&#39;s possible to pass an Array value as <code>foreign_key</code> to achieve the same behavior of an association.</p>

<p><em>Nikita Vasilevsky</em></p></li>
<li><p>Allow association&#39;s <code>primary_key</code> to be composite.</p>

<p>Association&#39;s <code>primary_key</code> can be composite when derived from associated model <code>primary_key</code> or <code>query_constraints</code>.
Now it&#39;s possible to explicitly set it as composite on the association.</p>

<p><em>Nikita Vasilevsky</em></p></li>
<li><p>Add <code>config.active_record.permanent_connection_checkout</code> setting.</p>

<p>Controls whether <code>ActiveRecord::Base.connection</code> raises an error, emits a deprecation warning, or neither.</p>

<p><code>ActiveRecord::Base.connection</code> checkouts a database connection from the pool and keeps it leased until the end of
the request or job. This behavior can be undesirable in environments that use many more threads or fibers than there
is available connections.</p>

<p>This configuration can be used to track down and eliminate code that calls <code>ActiveRecord::Base.connection</code> and
migrate it to use <code>ActiveRecord::Base.with_connection</code> instead.</p>

<p>The default behavior remains unchanged, and there is currently no plans to change the default.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Add dirties option to uncached.</p>

<p>This adds a <code>dirties</code> option to <code>ActiveRecord::Base.uncached</code> and
<code>ActiveRecord::ConnectionAdapters::ConnectionPool#uncached</code>.</p>

<p>When set to <code>true</code> (the default), writes will clear all query caches belonging to the current thread.
When set to <code>false</code>, writes to the affected connection pool will not clear any query cache.</p>

<p>This is needed by Solid Cache so that cache writes do not clear query caches.</p>

<p><em>Donal McBreen</em></p></li>
<li><p>Deprecate <code>ActiveRecord::Base.connection</code> in favor of <code>.lease_connection</code>.</p>

<p>The method has been renamed as <code>lease_connection</code> to better reflect that the returned
connection will be held for the duration of the request or job.</p>

<p>This deprecation is a soft deprecation, no warnings will be issued and there is no
current plan to remove the method.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Deprecate <a href="ActiveRecord/ConnectionAdapters/ConnectionPool.html#connection-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool#connection (method)">ActiveRecord::ConnectionAdapters::ConnectionPool#connection</a>.</p>

<p>The method has been renamed as <code>lease_connection</code> to better reflect that the returned
connection will be held for the duration of the request or job.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Expose a generic fixture accessor for fixture names that may conflict with <a href="Minitest.html" title="Minitest (module)"><code>Minitest</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby on Rails</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_web_sites'>web_sites</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rubyonrails'>rubyonrails</span>).<span class='id identifier rubyid_name'>name</span>
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby on Rails</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_fixture'>fixture</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_web_sites'>web_sites</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rubyonrails'>rubyonrails</span>).<span class='id identifier rubyid_name'>name</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Using <code>Model.query_constraints</code> with a single non-primary-key column used to raise as expected, but with an
incorrect error message. This has been fixed to raise with a more appropriate error message.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Fix <code>has_one</code> association autosave setting the foreign key attribute when it is unchanged.</p>

<p>This behaviour is also inconsistent with autosaving <code>belongs_to</code> and can have unintended side effects like raising
an <code>ActiveRecord::ReadOnlyAttributeError</code> when the foreign key attribute is marked as read-only.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Remove deprecated behavior that would rollback a transaction block when exited using <code>return</code>, <code>break</code> or <code>throw</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>Rails.application.config.active_record.commit_transaction_on_non_local_return</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to pass <code>rewhere</code> to <code>ActiveRecord::Relation#merge</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to pass <code>deferrable: true</code> to <code>add_foreign_key</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to quote <a href="ActiveSupport/Duration.html" title="ActiveSupport::Duration (class)"><code>::ActiveSupport::Duration</code></a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>#quote_bound_value</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::ConnectionAdapters::ConnectionPool#connection_klass</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to apply <code>#connection_pool_list</code>, <code>#active_connections?</code>, <code>#clear_active_connections!</code>,
<code>#clear_reloadable_connections!</code>, <code>#clear_all_connections!</code> and <code>#flush_idle_connections!</code> to the connections pools
for the current role when the <code>role</code> argument isn&#39;t provided.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>#all_connection_pools</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::ConnectionAdapters::SchemaCache#data_sources</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::ConnectionAdapters::SchemaCache.load_from</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>#all_foreign_keys_valid?</code> from database adapters.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to passing coder and class as second argument to <code>serialize</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to <code>ActiveRecord::Base#read_attribute(:id)</code> to return the custom primary key value.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>TestFixtures.fixture_path</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated behavior to support referring to a singular association by its plural name.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>Rails.application.config.active_record.allow_deprecated_singular_associations_name</code></p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to passing <code>SchemaMigration</code> and <code>InternalMetadata</code> classes as arguments to
<a href="ActiveRecord/MigrationContext.html" title="ActiveRecord::MigrationContext (class)"><code>::ActiveRecord::MigrationContext</code></a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::Migration.check_pending</code> method.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::LogSubscriber.runtime</code> method.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::LogSubscriber.runtime=</code> method.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::LogSubscriber.reset_runtime</code> method.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to define <code>explain</code> in the connection adapter with 2 arguments.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::ActiveJobRequiredError</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::Base.clear_active_connections!</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::Base.clear_reloadable_connections!</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::Base.clear_all_connections!</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveRecord::Base.flush_idle_connections!</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>name</code> argument from <code>ActiveRecord::Base.remove_connection</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to call <code>alias_attribute</code> with non-existent attribute names.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>Rails.application.config.active_record.suppress_multiple_database_warning</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Add ActiveRecord::Encryption::MessagePackMessageSerializer</p>

<p>Serialize data to the MessagePack format, for efficient storage in binary columns.</p>

<p>The binary encoding requires around 30% less space than the base64 encoding
used by the default serializer.</p>

<p><em>Donal McBreen</em></p></li>
<li><p>Add support for encrypting binary columns</p>

<p>Ensure encryption and decryption pass <code>Type::Binary::Data</code> around for binary data.</p>

<p>Previously encrypting binary columns with the <a href="ActiveRecord/Encryption/MessageSerializer.html" title="ActiveRecord::Encryption::MessageSerializer (class)"><code>::ActiveRecord::Encryption::MessageSerializer</code></a>
incidentally worked for MySQL and SQLite, but not PostgreSQL.</p>

<p><em>Donal McBreen</em></p></li>
<li><p>Deprecated <code>ENV["SCHEMA_CACHE"]</code> in favor of <code>schema_cache_path</code> in the database configuration.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Add <code>ActiveRecord::Base.with_connection</code> as a shortcut for leasing a connection for a short duration.</p>

<p>The leased connection is yielded, and for the duration of the block, any call to <code>ActiveRecord::Base.connection</code>
will yield that same connection.</p>

<p>This is useful to perform a few database operations without causing a connection to be leased for the
entire duration of the request or job.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Deprecate <code>config.active_record.warn_on_records_fetched_greater_than</code> now that <code>sql.active_record</code>
notification includes <code>:row_count</code> field.</p>

<p><em>Jason Nochlin</em></p></li>
<li><p>The fix ensures that the association is joined using the appropriate join type
(either inner join or left outer join) based on the existing joins in the scope.</p>

<p>This prevents unintentional overrides of existing join types and ensures consistency in the generated SQL queries.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># `associated` will use `LEFT JOIN` instead of using {JOIN}
</span><span class='const'>Post</span>.<span class='id identifier rubyid_left_joins'>left_joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>).<span class='id identifier rubyid_where'>where</span>.<span class='id identifier rubyid_associated'>associated</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>)</code></pre>

<p><em>Saleh Alhaddad</em></p></li>
<li><p>Fix an issue where <a href="ActiveRecord/Encryption.html" title="ActiveRecord::Encryption (module)"><code>::ActiveRecord::Encryption</code></a> configurations are not ready before the loading
of Active Record models, when an application is eager loaded. As a result, encrypted attributes
could be misconfigured in some cases.</p>

<p><em>Maxime Réty</em></p></li>
<li><p>Deprecate defining an <code>enum</code> with keyword arguments.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Function</span> <span class='op'>&gt;</span> <span class='const'>ApplicationRecord</span>
  <span class='comment'># BAD
</span>  <span class='id identifier rubyid_enum'>enum</span> <span class='label'>color:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_red'>red</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_blue'>blue</span>]<span class='comma'>,</span>
       <span class='label'>type:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_instance'>instance</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='kw'>class</span>]

  <span class='comment'># GOOD
</span>  <span class='id identifier rubyid_enum'>enum</span> <span class='symbeg'>:</span><span class='id identifier rubyid_color'>color</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_red'>red</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_blue'>blue</span>]
  <span class='id identifier rubyid_enum'>enum</span> <span class='symbeg'>:</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_instance'>instance</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='kw'>class</span>]
<span class='kw'>end</span></code></pre>

<p><em>Hartley McGuire</em></p></li>
<li><p>Add <code>config.active_record.validate_migration_timestamps</code> option for validating migration timestamps.</p>

<p>When set, validates that the timestamp prefix for a migration is no more than a day ahead of
the timestamp associated with the current time. This is designed to prevent migrations prefixes
from being hand-edited to future timestamps, which impacts migration generation and other
migration commands.</p>

<p><em>Adrianna Chang</em></p></li>
<li><p>Properly synchronize <code>Mysql2Adapter#active?</code> and <code>TrilogyAdapter#active?</code></p>

<p>As well as <code>disconnect!</code> and <code>verify!</code>.</p>

<p>This generally isn&#39;t a big problem as connections must not be shared between
threads, but is required when running transactional tests or system tests
and could lead to a SEGV.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Support <code>:source_location</code> tag option for query log tags</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_active_record'>active_record</span>.<span class='id identifier rubyid_query_log_tags'>query_log_tags</span> <span class='op'>&lt;&lt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_source_location'>source_location</span></code></pre>

<p>Calculating the caller location is a costly operation and should be used primarily in development
(note, there is also a <code>config.active_record.verbose_query_logs</code> that serves the same purpose)
or occasionally on production for debugging purposes.</p>

<p><em>fatkodima</em></p></li>
<li><p>Add an option to <a href="ActiveRecord/Encryption/Encryptor.html" title="ActiveRecord::Encryption::Encryptor (class)"><code>::ActiveRecord::Encryption::Encryptor</code></a> to disable compression</p>

<p>Allow compression to be disabled by setting <code>compress: false</code></p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>User</span>
  <span class='id identifier rubyid_encrypts'>encrypts</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>encryptor:</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Encryption.html" title="ActiveRecord::Encryption (module)">Encryption</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Encryption/Encryptor.html" title="ActiveRecord::Encryption::Encryptor (class)">Encryptor</a></span>.<span class='id identifier rubyid_new'><a href="ActiveRecord/Encryption/Encryptor.html#new-class_method" title="ActiveRecord::Encryption::Encryptor.new (method)">new</a></span>(<span class='label'>compress:</span> <span class='kw'>false</span>)
<span class='kw'>end</span></code></pre>

<p><em>Donal McBreen</em></p></li>
<li><p>Deprecate passing strings to <a href="ActiveRecord/Tasks/DatabaseTasks.html#cache_dump_filename-instance_method" title="ActiveRecord::Tasks::DatabaseTasks#cache_dump_filename (method)">ActiveRecord::Tasks::DatabaseTasks#cache_dump_filename</a>.</p>

<p>A <a href="ActiveRecord/DatabaseConfigurations/DatabaseConfig.html" title="ActiveRecord::DatabaseConfigurations::DatabaseConfig (class)"><code>::ActiveRecord::DatabaseConfigurations::DatabaseConfig</code></a> object should be passed instead.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Add row_count field to sql.active_record notification</p>

<p>This field returns the amount of rows returned by the query that emitted the notification.</p>

<p>This metric is useful in cases where one wants to detect queries with big result sets.</p>

<p><em>Marvin Bitterlich</em></p></li>
<li><p>Consistently raise an <code>ArgumentError</code> when passing an invalid argument to a nested attributes association writer.</p>

<p>Previously, this would only raise on collection associations and produce a generic error on singular associations.</p>

<p>Now, it will raise on both collection and singular associations.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Fix single quote escapes on default generated MySQL columns</p>

<p>MySQL 5.7.5+ supports generated columns, which can be used to create a column that is computed from an expression.</p>

<p>Previously, the schema dump would output a string with double escapes for generated columns with single quotes in the default expression.</p>

<p>This would result in issues when importing the schema on a fresh instance of a MySQL database.</p>

<p>Now, the string will not be escaped and will be valid Ruby upon importing of the schema.</p>

<p><em>Yash Kapadia</em></p></li>
<li><p>Fix Migrations with versions older than 7.1 validating options given to
<code>add_reference</code> and <code>t.references</code>.</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Add <code>&lt;role&gt;_types</code> class method to <a href="ActiveRecord/DelegatedType.html" title="ActiveRecord::DelegatedType (module)"><code>::ActiveRecord::DelegatedType</code></a> so that the delegated types can be instrospected</p>

<p><em>JP Rosevear</em></p></li>
<li><p>Make <code>schema_dump</code>, <code>query_cache</code>, <code>replica</code> and <code>database_tasks</code> configurable via <code>DATABASE_URL</code></p>

<p>This wouldn&#39;t always work previously because boolean values would be interpreted as strings.</p>

<p>e.g. <a href="DATABASE_URL=postgres://localhost/foo?schema_dump=false" target="_parent" title="DATABASE_URL=postgres://localhost/foo?schema_dump=false">DATABASE_URL=postgres://localhost/foo?schema_dump=false</a> now properly disable dumping the schema
cache.</p>

<p><em>Mike Coutermarsh</em>, <em>Jean Boussier</em></p></li>
<li><p>Introduce <a href="ActiveRecord/Transactions/ClassMethods.html#set_callback-instance_method" title="ActiveRecord::Transactions::ClassMethods#set_callback (method)">ActiveRecord::Transactions::ClassMethods#set_callback</a></p>

<p>It is identical to <a href="ActiveSupport/Callbacks/ClassMethods.html#set_callback-instance_method" title="ActiveSupport::Callbacks::ClassMethods#set_callback (method)">ActiveSupport::Callbacks::ClassMethods#set_callback</a>
 but with support for <code>after_commit</code> and <code>after_rollback</code> callback options.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Make <a href="ActiveRecord/Encryption/Encryptor.html" title="ActiveRecord::Encryption::Encryptor (class)"><code>::ActiveRecord::Encryption::Encryptor</code></a> agnostic of the serialization format used for encrypted data.</p>

<p>Previously, the encryptor instance only allowed an encrypted value serialized as a <a href="String.html" title="String (class)"><code>String</code></a> to be passed to the message serializer.</p>

<p>Now, the encryptor lets the configured <code>message_serializer</code> decide which types of serialized encrypted values are supported. A custom serialiser is therefore allowed to serialize <a href="ActiveRecord/Encryption/Message.html" title="ActiveRecord::Encryption::Message (class)"><code>::ActiveRecord::Encryption::Message</code></a> objects using a type other than <a href="String.html" title="String (class)"><code>String</code></a>.</p>

<p>The default <a href="ActiveRecord/Encryption/MessageSerializer.html" title="ActiveRecord::Encryption::MessageSerializer (class)"><code>::ActiveRecord::Encryption::MessageSerializer</code></a> already ensures that only <a href="String.html" title="String (class)"><code>String</code></a> objects are passed for deserialization.</p>

<p><em>Maxime Réty</em></p></li>
<li><p>Fix <code>encrypted_attribute?</code> to take into account context properties passed to <code>encrypts</code>.</p>

<p><em>Maxime Réty</em></p></li>
<li><p>The object returned by <code>explain</code> now responds to <code>pluck</code>, <code>first</code>,
<code>last</code>, <code>average</code>, <code>count</code>, <code>maximum</code>, <code>minimum</code>, and <code>sum</code>. Those
new methods run <code>EXPLAIN</code> on the corresponding queries:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_explain'>explain</span>.<span class='id identifier rubyid_count'>count</span>
<span class='comment'># EXPLAIN SELECT COUNT(*) FROM `users`
</span><span class='comment'># ...
</span>
<span class='const'>User</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_explain'>explain</span>.<span class='id identifier rubyid_maximum'>maximum</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>)
<span class='comment'># EXPLAIN SELECT MAX(`users`.`id`) FROM `users`
</span><span class='comment'># ...</span></code></pre>

<p><em>Petrik de Heus</em></p></li>
<li><p>Fixes an issue where <code>validates_associated</code> <code>:on</code>  option wasn&#39;t respected
when validating associated records.</p>

<p><em>Austen Madden</em>, <em>Alex Ghiculescu</em>, <em>Rafał Brize</em></p></li>
<li><p>Allow overriding SQLite defaults from <code>database.yml</code>.</p>

<p>Any PRAGMA configuration set under the <code>pragmas</code> key in the configuration
file takes precedence over Rails&#39; defaults, and additional PRAGMAs can be
set as well.</p>

<pre class="code yaml"><code class="yaml">database: storage/development.sqlite3
timeout: 5000
pragmas:
  journal_mode: off
  temp_store: memory
</code></pre>

<p><em>Stephen Margheim</em></p></li>
<li><p>Remove warning message when running SQLite in production, but leave it unconfigured.</p>

<p>There are valid use cases for running SQLite in production. However, it must be done
with care, so instead of a warning most users won&#39;t see anyway, it&#39;s preferable to
leave the configuration commented out to force them to think about having the database
on a persistent volume etc.</p>

<p><em>Jacopo Beschi</em>, <em>Jean Boussier</em></p></li>
<li><p>Add support for generated columns to the SQLite3 adapter.</p>

<p>Generated columns (both stored and dynamic) are supported since version 3.31.0 of SQLite.
This adds support for those to the SQLite3 adapter.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_string'>string</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_virtual'>virtual</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name_upper'>name_upper</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='label'>as:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UPPER(name)</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_virtual'>virtual</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name_lower'>name_lower</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='label'>as:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LOWER(name)</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>stored:</span> <span class='kw'>true</span>
<span class='kw'>end</span></code></pre>

<p><em>Stephen Margheim</em></p></li>
<li><p>TrilogyAdapter: ignore <code>host</code> if <code>socket</code> parameter is set.</p>

<p>This allows to configure a connection on a UNIX socket via <code>DATABASE_URL</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>DATABASE_URL</span><span class='op'>=</span><span class='id identifier rubyid_trilogy'>trilogy</span><span class='symbeg'>:</span><span class='op'>/</span><span class='op'>/</span><span class='id identifier rubyid_does'>does</span><span class='op'>-</span><span class='kw'>not</span><span class='op'>-</span><span class='id identifier rubyid_matter'>matter</span><span class='op'>/</span><span class='id identifier rubyid_my_db_production?'>my_db_production?</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>=</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>var</span><span class='regexp_end'>/run</span></span><span class='op'>/</span><span class='id identifier rubyid_mysql'>mysql</span>.<span class='id identifier rubyid_sock'>sock</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Make <code>assert_queries_count</code>, <code>assert_no_queries</code>, <code>assert_queries_match</code>, and
<code>assert_no_queries_match</code> assertions public.</p>

<p>To assert the expected number of queries are made, Rails internally uses <code>assert_queries_count</code> and
<code>assert_no_queries</code>. To assert that specific SQL queries are made, <code>assert_queries_match</code> and
<code>assert_no_queries_match</code> are used. These assertions can now be used in applications as well.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticleTest</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TestCase.html" title="ActiveSupport::TestCase (class)">TestCase</a></span>
  <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>queries are made</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assert_queries_count'>assert_queries_count</span>(<span class='int'>1</span>) { <span class='const'>Article</span>.<span class='id identifier rubyid_first'>first</span> }
  <span class='kw'>end</span>

  <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>creates a foreign key</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assert_queries_match'>assert_queries_match</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>ADD FOREIGN KEY</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='label'>include_schema:</span> <span class='kw'>true</span>) <span class='kw'>do</span>
      <span class='ivar'>@connection</span>.<span class='id identifier rubyid_add_foreign_key'>add_foreign_key</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Petrik de Heus</em>, <em>fatkodima</em></p></li>
<li><p>Fix <code>has_secure_token</code> calls the setter method on initialize.</p>

<p><em>Abeid Ahmed</em></p></li>
<li><p>When using a <code>DATABASE_URL</code>, allow for a configuration to map the protocol in the URL to a specific database
adapter. This allows decoupling the adapter the application chooses to use from the database connection details
set in the deployment environment.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># ENV[&#39;DATABASE_URL&#39;] = &quot;mysql://localhost/example_database&quot;
</span><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_active_record'>active_record</span>.<span class='id identifier rubyid_protocol_adapters'>protocol_adapters</span>.<span class='id identifier rubyid_mysql'>mysql</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>trilogy</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># will connect to MySQL using the trilogy adapter</span></code></pre>

<p><em>Jean Boussier</em>, <em>Kevin McPhillips</em></p></li>
<li><p>In cases where MySQL returns <code>warning_count</code> greater than zero, but returns no warnings when
the <code>SHOW WARNINGS</code> query is executed, <a href="ActiveRecord.html#db_warnings_action-class_method" title="ActiveRecord.db_warnings_action (method)">ActiveRecord.db_warnings_action</a> proc will still be
called with a generic warning message rather than silently ignoring the warning(s).</p>

<p><em>Kevin McPhillips</em></p></li>
<li><p><code>DatabaseConfigurations#configs_for</code> accepts a symbol in the <code>name</code> parameter.</p>

<p><em>Andrew Novoselac</em></p></li>
<li><p>Fix <code>where(field: values)</code> queries when <code>field</code> is a serialized attribute
(for example, when <code>field</code> uses <code>ActiveRecord::Base.serialize</code> or is a JSON
column).</p>

<p><em>João Alves</em></p></li>
<li><p>Make the output of <a href="ActiveRecord/Core.html#inspect-instance_method" title="ActiveRecord::Core#inspect (method)">ActiveRecord::Core#inspect</a> configurable.</p>

<p>By default, calling <code>inspect</code> on a record will yield a formatted string including just the <code>id</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'>#=&gt; &quot;#&lt;Post id: 1&gt;&quot;</span></code></pre>

<p>The attributes to be included in the output of <code>inspect</code> can be configured with
<a href="ActiveRecord/Core.html#attributes_for_inspect-instance_method" title="ActiveRecord::Core#attributes_for_inspect (method)">ActiveRecord::Core#attributes_for_inspect</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_attributes_for_inspect'>attributes_for_inspect</span> <span class='op'>=</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span>]
<span class='const'>Post</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'>#=&gt; &quot;#&lt;Post id: 1, title: &quot;Hello, World!&quot;&gt;&quot;</span></code></pre>

<p>With <code>attributes_for_inspect</code> set to <code>:all</code>, <code>inspect</code> will list all the record&#39;s attributes.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_attributes_for_inspect'>attributes_for_inspect</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'>#=&gt; &quot;#&lt;Post id: 1, title: &quot;Hello, World!&quot;, published_at: &quot;2023-10-23 14:28:11 +0000&quot;&gt;&quot;</span></code></pre>

<p>In <code>development</code> and <code>test</code> mode, <code>attributes_for_inspect</code> will be set to <code>:all</code> by default.</p>

<p>You can also call <code>full_inspect</code> to get an inspection with all the attributes.</p>

<p>The attributes in <code>attribute_for_inspect</code> will also be used for <code>pretty_print</code>.</p>

<p><em>Andrew Novoselac</em></p></li>
<li><p>Don&#39;t mark attributes as changed when reassigned to <code>Float::INFINITY</code> or
<code>-Float::INFINITY</code>.</p>

<p><em>Maicol Bentancor</em></p></li>
<li><p>Support the <code>RETURNING</code> clause for MariaDB.</p>

<p><em>fatkodima</em>, <em>Nikolay Kondratyev</em></p></li>
<li><p>The SQLite3 adapter now implements the <code>supports_deferrable_constraints?</code> contract.</p>

<p>Allows foreign keys to be deferred by adding the <code>:deferrable</code> key to the <code>foreign_key</code> options.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_add_reference'>add_reference</span> <span class='symbeg'>:</span><span class='id identifier rubyid_person'>person</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='kw'>alias</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> { <span class='label'>deferrable:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_deferred'>deferred</span> }
<span class='id identifier rubyid_add_reference'>add_reference</span> <span class='symbeg'>:</span><span class='kw'>alias</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_person'>person</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> { <span class='label'>deferrable:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_deferred'>deferred</span> }</code></pre>

<p><em>Stephen Margheim</em></p></li>
<li><p>Add the <code>set_constraints</code> helper to PostgreSQL connections.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_create!'>create!</span>(<span class='label'>user_id:</span> <span class='op'>-</span><span class='int'>1</span>) <span class='comment'># =&gt; ActiveRecord::InvalidForeignKey
</span>
<span class='const'>Post</span>.<span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
  <span class='const'>Post</span>.<span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_set_constraints'>set_constraints</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deferred'>deferred</span>)
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_create!'>create!</span>(<span class='label'>user_id:</span> <span class='op'>-</span><span class='int'>1</span>)
  <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_create!'>create!</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_save!'>save!</span>
<span class='kw'>end</span></code></pre>

<p><em>Cody Cutrer</em></p></li>
<li><p>Include <a href="ActiveModel/API.html" title="ActiveModel::API (module)"><code>::ActiveModel::API</code></a> in <a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)"><code>::ActiveRecord::Base</code></a>.</p>

<p><em>Sean Doyle</em></p></li>
<li><p>Ensure <code>#signed_id</code> outputs <code>url_safe</code> strings.</p>

<p><em>Jason Meller</em></p></li>
<li><p>Add <code>nulls_last</code> and working <code>desc.nulls_first</code> for MySQL.</p>

<p><em>Tristan Fellows</em></p></li>
<li><p>Allow for more complex hash arguments for <code>order</code> which mimics <code>where</code> in <a href="ActiveRecord/Relation.html" title="ActiveRecord::Relation (class)"><code>::ActiveRecord::Relation</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span>.<span class='id identifier rubyid_includes'>includes</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_order'>order</span>(<span class='label'>posts:</span> { <span class='label'>created_at:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_desc'>desc</span> })</code></pre>

<p><em>Myles Boone</em></p></li>
</ul>

<p>Please check [7-1-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>