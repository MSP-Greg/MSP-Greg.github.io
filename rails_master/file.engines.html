<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Engines &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "engines",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Engines&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<p><strong>DO NOT READ THIS FILE ON GITHUB, GUIDES ARE PUBLISHED ON <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p>

<h1><a href="Rails.html" title="Rails (module)"><code>Rails</code></a> Engines Overview</h1>

<p>In this guide you will learn about engines and how they can be used to provide
additional functionality to their host applications through a clean and
easy-to-use interface.</p>

<p>After reading this guide, you will know:</p>

<ul>
<li>What is an engine.</li>
<li>How to generate an engine.</li>
<li>How to build features for the engine.</li>
<li>How to hook the engine into an application.</li>
<li>How to override engine functionality in the application.</li>
<li>How to avoid loading <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> frameworks with Load and Configuration Hooks.</li>
</ul>

<hr>

<h2>What are Engines?</h2>

<p>Engines can be thought of as miniature applications that encapsulate specific
functionality and integrate with a larger <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> application. An engine extends a
<a href="plugins.html">plugin</a>, with the
<a href="https://api.rubyonrails.org/classes/Rails/Engine.html"><a href="Rails/Engine.html" title="Rails::Engine (class)"><code>::Rails::Engine</code></a></a> class
<a href="engines.html#the-inheritance-hierarchy">inheriting</a> behavior from
<a href="https://api.rubyonrails.org/classes/Rails/Railtie.html"><a href="Rails/Railtie.html" title="Rails::Railtie (class)"><code>::Rails::Railtie</code></a></a>.</p>

<p>Some examples of engines in action:</p>

<ul>
<li><a href="https://github.com/heartcombo/devise">Devise</a> which provides authentication
for its parent applications</li>
<li><a href="https://github.com/thredded/thredded">Thredded</a> which provides forum
functionality</li>
<li><a href="https://github.com/refinery/refinerycms">Refinery CMS</a> which provides a CMS
engine</li>
<li><a href="https://github.com/rails/rails/tree/main/activestorage">Active Storage</a> which
provides file storage as an engine.</li>
<li><a href="https://github.com/rails/rails/tree/main/actiontext">Action Text</a> which
provides a rich text editor as an engine.</li>
<li><a href="https://api.rubyonrails.org/classes/Rails/Application.html"><a href="Rails/Application.html" title="Rails::Application (class)"><code>::Rails::Application</code></a></a>
inheriting much of its behavior from <a href="Rails/Engine.html" title="Rails::Engine (class)"><code>::Rails::Engine</code></a>.</li>
</ul>

<p>NOTE: The main application is always the final authority in a <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> environment.
While engines can extend or enhance the application&#39;s functionality, they are
meant to support the app — not override or redefine its behavior. Engines exist
to serve the application, not the other way around.</p>

<h3>Inheritance Hierarchy</h3>

<p>At the base of this hierarchy,
<a href="https://api.rubyonrails.org/classes/Rails/Railtie.html"><code>Railtie</code></a> is the core
building block of the <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> framework. It provides hooks into the <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>
initialization process and allows extensions, such as frameworks (e.g. Active
Record, Action Mailer) or third-party libraries, to tie into the <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> boot
sequence.</p>

<p>The <a href="https://api.rubyonrails.org/classes/Rails/Engine.html"><code>Rails Engine</code></a>
builds on <code>Railtie</code> by adding support for things like routes, isolated
namespaces, and load paths, making it possible to package complete <a href="Rails.html" title="Rails (module)"><code>Rails</code></a>
components. Engines and applications also share a common directory structure.</p>

<p>While an engine is packaged like a miniature <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> application, it runs inside a
host <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> application. The host
<a href="https://api.rubyonrails.org/classes/Rails/Application.html">Rails::Application</a>
coordinates boot, executes engine initializers, and builds the overall
middleware stack. Engines can also define their own configuration and contribute
middleware, but these take effect when the host application boots.</p>

<h3>Engines and Plugins</h3>

<p>Engines are also closely related to plugins - all engines are plugins, but not
all plugins are engines. The two share a common <code>lib</code> directory structure, and
are both generated using the <code>rails plugin new</code> generator.</p>

<p>While a plugin is generated using <code>rails plugin new &lt;plugin_name&gt;</code>, an engine is
generated using either:</p>

<pre class="code bash"><code class="bash">rails plugin new &lt;engine_name&gt; --full
# or
rails plugin new &lt;engine_name&gt; --mountable
</code></pre>

<p>The <code>--full</code> option tells the generator to create an engine with its own
models/controllers that share the host app’s namespace. The <code>--mountable</code> option
creates a fully isolated, mountable engine with its own namespace.</p>

<p>You can read more about the different generator options in the <a href="plugins.html#generator-options">Rails Plugins
Generator Options</a> section.</p>

<h3>Using an Engine</h3>

<p>You add an engine to your host application&#39;s <code>Gemfile</code>, and depending on how the
engine is designed, you may need to mount it in the main app&#39;s routes. Mounting
is required when the engine provides its own routes, as this makes any routes,
controllers, views, or assets defined in the engine available at that mount
point in the host application. This is covered later in the section <a href="#using-the-engine-in-a-host-application">Using the
Engine in a Host Application</a>.</p>

<p>Some engines, however, don&#39;t need to be mounted. These are often backend-only
engines, such as those that provide Active Record models, rake tasks, or other
internal functionality without exposing routes. In these cases, adding the gem
to your application&#39;s Gemfile is enough to make its features available.</p>

<p>When an engine is mounted, it has an isolated namespace. This means the host
application and the mounted engine can have a routing helper with the same name
(such as <code>articles_path</code>) without clashing. Along with this, controllers,
models, and table names are also namespaced. You&#39;ll see how to do this later in
the <a href="#routes">Routes section</a>.</p>

<h2>Generating an Engine</h2>

<p>In the following example, you will be building an engine, called &quot;blorgh&quot; that
provides blogging functionality to its host applications, allowing for new
articles and comments to be created. It will use the <a href="plugins.html#generator-options"><code>--mountable</code>
option</a> to generate the engine.</p>

<p>To generate an engine, you will need to run the plugin generator and pass it
options as needed. For the &quot;blorgh&quot; example, you will need to create a
&quot;mountable&quot; engine, running this command in a terminal:</p>

<pre class="code bash"><code class="bash">$ rails plugin new blorgh --mountable
</code></pre>

<p>The <code>--mountable</code> option allows the engine to behave like a self-contained
mini-application that can be easily integrated into a host Rails application
without polluting its global namespace. It will:</p>

<ul>
<li>namespace all controllers, routes, views, helpers, and assets under the
<code>Blorgh</code> module, preventing conflicts with similarly named components in the
host app.</li>
<li>isolate routing to the engine, allowing you to mount it at a specific path in
the host app (e.g., <code>/blorgh</code>), while keeping its internal route structure
independent.</li>
<li>make the engine more modular and reusable, so it can be plugged into different
applications with minimal configuration.</li>
</ul>

<h3>The Directory Structure</h3>

<p>The structure of the <code>--mountable</code> engine will be as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_app'>app</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>
│   ├── assets</span><span class='regexp_end'>/</span></span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_images'>images</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_stylesheets'>stylesheets</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>           <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application'>application</span>.<span class='id identifier rubyid_css'>css</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_concerns'>concerns</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application_controller'>application_controller</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_helpers'>helpers</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application_helper'>application_helper</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_jobs'>jobs</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application_job'>application_job</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_mailers'>mailers</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application_mailer'>application_mailer</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_models'>models</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_concerns'>concerns</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application_record'>application_record</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_views'>views</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_layouts'>layouts</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>           <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>               <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_application'>application</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_bin'>bin</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_rails'>rails</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_rubocop'>rubocop</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_config'>config</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_tasks'>tasks</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_blorgh_tasks'>blorgh_tasks</span>.<span class='id identifier rubyid_rake'>rake</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_engine'>engine</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_version'>version</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_blorgh'>blorgh</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_test'>test</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_dummy'>dummy</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_app'>app</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_bin'>bin</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_config'>config</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_log'>log</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_public'>public</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_storage'>storage</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>       <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_tmp'>tmp</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_fixtures'>fixtures</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_files'>files</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_helpers'>helpers</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_integration'>integration</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_└──'>└──</span> <span class='id identifier rubyid_navigation_test'>navigation_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_mailers'>mailers</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_models'>models</span><span class='op'>/</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_blorgh_test'>blorgh_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_│'>│</span>   <span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_test_helper'>test_helper</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='const'>Gemfile</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='const'>Rakefile</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='const'>README</span>.<span class='id identifier rubyid_md'>md</span>
<span class='id identifier rubyid_├──'>├──</span> <span class='id identifier rubyid_blorgh'>blorgh</span>.<span class='id identifier rubyid_gemspec'>gemspec</span></code></pre>

<p>It provides the following:</p>

<ul>
<li>An <code>app</code> directory tree</li>
<li><p>A <code>config/routes.rb</code> file:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
<span class='kw'>end</span></code></pre></li>
<li><p>A file at <code>lib/blorgh/engine.rb</code>, which is identical in function to a
standard Rails application&#39;s <code>config/application.rb</code> file:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># lib/blorgh/engine.rb
</span>
<span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>Engine</span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span><span class='op'>::</span><span class='const'><a href="Rails/Engine.html" title="Rails::Engine (class)">Engine</a></span>
    <span class='id identifier rubyid_isolate_namespace'>isolate_namespace</span> <span class='const'>Blorgh</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre></li>
</ul>

<p><code>--mountable</code> engines, like above, contain some files that are not present in
the <code>--full</code> option, these are:</p>

<ul>
<li>A namespaced <code>ApplicationController</code> stub</li>
<li>A namespaced <code>ApplicationHelper</code> stub</li>
<li>A layout view template for the engine</li>
<li><p>Namespace isolation to <code>config/routes.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Engine</span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
<span class='kw'>end</span></code></pre></li>
<li><p>Namespace isolation to <code>lib/blorgh/engine.rb</code> as described above.</p></li>
</ul>

<p>Additionally, the <code>--mountable</code> option tells the generator to mount the engine
inside the dummy testing application located at <code>test/dummy</code> by adding the
following to the dummy application&#39;s routes file at
<code>test/dummy/config/routes.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mount'>mount</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Engine</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/blorgh</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>A full list of options for the plugin generator can be seen by running:</p>

<pre class="code bash"><code class="bash">$ rails plugin --help
</code></pre>

<h3>Core Engine Setup</h3>

<h4>The <code>.gemspec</code> File</h4>

<p>At the root of your engine, you’ll find a file named <code>blorgh.gemspec</code>. This file
defines your engine as a gem. It includes metadata like the gem name, version,
authors, dependencies, and which files to include when it&#39;s packaged.</p>

<p>To use this engine in a host Rails application, you reference it in the app’s
<code>Gemfile</code> like so:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blorgh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>path:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>../blorgh</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>Then run:</p>

<pre class="code bash"><code class="bash">bundle install
</code></pre>

<p>This tells Bundler to treat the engine as a gem and load it accordingly.</p>

<p>INFO: Instead of publishing an engine as a standalone gem, you can generate an
engine inside your application and deploy it for use by that application only.
For example, placing the engine under <code>engines/blorgh</code> and referencing it in
your <code>Gemfile</code> allows you to keep it within the same codebase.</p>

<h4>The Engine Entry Point: <code>lib/blorgh.rb</code>:</h4>

<p>Bundler looks for a file matching the gem name, <code>lib/blorgh.rb</code>. This file is
the main entry point of the engine. It typically requires the engine definition
and sets up a base module:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># lib/blorgh.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blorgh/engine</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>module</span> <span class='const'>Blorgh</span>
<span class='kw'>end</span></code></pre>

<p>TIP: Some engines choose to use this file to put global configuration options
for their engine. It&#39;s a relatively good idea, so if you want to offer
configuration options, the file where your engine&#39;s <code>module</code> is defined is
perfect for that. Place the methods inside the module and you&#39;ll be good to go.</p>

<h4>The Engine Class Definition: <code>lib/blorgh/engine.rb</code></h4>

<p>This file defines the engine class and tells Rails how to load and isolate it:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># lib/blorgh/engine.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>Engine</span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span><span class='op'>::</span><span class='const'><a href="Rails/Engine.html" title="Rails::Engine (class)">Engine</a></span>
    <span class='id identifier rubyid_isolate_namespace'>isolate_namespace</span> <span class='const'>Blorgh</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>By inheriting from the <a href="Rails/Engine.html" title="Rails::Engine (class)"><code>::Rails::Engine</code></a> class, this gem notifies Rails that
there&#39;s an engine at the specified path. Rails will automatically:</p>

<ul>
<li>Add the engine’s <code>app/</code> folder to the load path.</li>
<li>Load the engine’s models, mailers, controllers, and views.</li>
</ul>

<p>The <code>isolate_namespace Blorgh</code> from the Engine class is crucial. It prevents
your engine’s components (like models, routes, helpers, and controllers) from
clashing with those in the host application or other engines.</p>

<p>For example:</p>

<ul>
<li>A generated model becomes <code>Blorgh::Article</code> rather than <code>Article</code>.</li>
<li>The table name is <code>blorgh_articles</code>, not <code>articles</code>.</li>
<li>A controller becomes <code>Blorgh::ArticlesController</code>, with views in
<code>app/views/blorgh/articles</code>.</li>
<li>A helper becomes <code>Blorgh::ArticlesHelper</code>.</li>
<li>Mailers and Jobs are namespaced as well.</li>
<li>Engine routes are kept isolated and don’t mix with the main app’s routes. This
is discussed later in the <a href="#routes">Routes</a> section of this guide.</li>
</ul>

<p>NOTE: It is recommended that the <code>isolate_namespace</code> line be left within the
<code>Engine</code> class definition. Without this isolation, files from the engine might
&quot;leak&quot; into the host app’s namespace or identically named classes might override
each other.</p>

<h3>Understanding the <code>app</code> Directory</h3>

<p>The <code>app</code> directory in a mountable engine mirrors the familiar structure of a
standard Rails application. It includes subdirectories like <code>assets</code>,
<code>controllers</code>, <code>helpers</code>, <code>jobs</code>, <code>mailers</code>, <code>models</code>, and <code>views</code>.</p>

<p>Here’s what you should know about each of these, especially in the context of a
namespaced engine like <code>blorgh</code>:</p>

<h4><code>app/assets</code></h4>

<p>Inside <code>app/assets</code>, you’ll find directories for <code>images</code> and <code>stylesheets</code>.
Each of these contains a subdirectory named after your engine—<code>blorgh</code> in this
case.</p>

<p>This namespacing is important because it ensures that your engine’s assets don’t
conflict with those from other engines or the host application. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_assets'>assets</span><span class='op'>/</span><span class='id identifier rubyid_stylesheets'>stylesheets</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_application'>application</span>.<span class='id identifier rubyid_css'>css</span></code></pre>

<h4><code>app/controllers</code></h4>

<p>The <code>controllers</code> folder contains a <code>blorgh/</code> subdirectory where all engine
controllers live. It starts with an <code>application_controller.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/controllers/blorgh/application_controller.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This controller acts as the base for all controllers in the engine, much like
<code>ApplicationController</code> does in a full app. Placing it (and all other
controllers) in the <code>blorgh/</code> module ensures they won’t clash with similarly
named controllers in the host app or other engines.</p>

<h4>Other Namespaced Directories</h4>

<p>Similar to <code>app/controllers</code>, you’ll find a <code>blorgh/</code> subdirectory under these
other top-level folders:</p>

<ul>
<li><code>app/helpers/blorgh/</code></li>
<li><code>app/jobs/blorgh/</code></li>
<li><code>app/mailers/blorgh/</code></li>
<li><code>app/models/blorgh/</code></li>
</ul>

<p>Each of these may include a corresponding <code>application_*.rb</code> file (e.g.,
<code>application_helper.rb</code>) for defining shared behavior.</p>

<p>This consistent namespacing helps prevent naming collisions and keeps your
engine modular and encapsulated.</p>

<h4><code>app/views</code></h4>

<p>Inside <code>app/views/layouts</code>, you’ll find a layout file for the engine:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_layouts'>layouts</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_application'>application</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span></code></pre>

<p>This is the default layout used by views inside the engine. It’s useful if your
engine is meant to be used as a self-contained application (e.g., admin
dashboards, wikis, etc.). If this engine is to be used as a stand-alone engine,
then you would add any customization to its layout in this file, rather than the
application&#39;s <code>app/views/layouts/application.html.erb</code> file.</p>

<p>If you don&#39;t want to use a specific layout in the views of the engine, then you
can delete this file and reference a different layout in the controllers of your
engine.</p>

<h4><code>/bin</code></h4>

<p>This directory contains one file, <code>bin/rails</code>, which enables you to use the
<code>rails</code> sub-commands and generators just like you would within an application.
This means that you are able to generate new controllers and models for this
engine very easily by running commands like this:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate model
</code></pre>

<p>Keep in mind, of course, that anything generated with these commands inside of
an engine that has <code>isolate_namespace</code> in the <code>Engine</code> class will be namespaced.</p>

<h4><code>/test</code></h4>

<p>The <code>test</code> directory is where tests for the engine will go. To test the engine,
there is a cut-down version of a Rails application embedded within it at
<code>test/dummy</code>. This application will mount the engine at <code>/blorgh</code>, which will
make it accessible through the application&#39;s routes at that path.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># test/dummy/config/routes.rb
</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_mount'>mount</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Engine</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/blorgh</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Inside the test directory there is the <code>test/integration</code> directory, where
integration tests for the engine should be placed. Other directories can be
created in the <code>test</code> directory as well. For example, you may wish to create a
<code>test/models</code> directory for your model tests.</p>

<h2>Providing Engine Functionality</h2>

<p>The engine that we&#39;ll build, <code>blorgh</code>, will allow you to add article submissions
and comment functionality when added to any Rails application.</p>

<h3>Generating an Article Resource</h3>

<p>The first thing to generate for a blog engine is the <code>Article</code> model and related
controller. To quickly generate this, you can use the Rails scaffold generator.</p>

<pre class="code bash"><code class="bash">$ bin/rails generate scaffold article title:string text:text
</code></pre>

<p>This command will output this information:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_active_record'>active_record</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_db'>db</span><span class='op'>/</span><span class='id identifier rubyid_migrate'>migrate</span><span class='op'>/</span><span class='op'>&lt;</span><span class='id identifier rubyid_timestamp'>timestamp</span><span class='op'>&gt;</span><span class='id identifier rubyid__create_blorgh_articles'>_create_blorgh_articles</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_article'>article</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_test_unit'>test_unit</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_article_test'>article_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_fixtures'>fixtures</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span>.<span class='id identifier rubyid_yml'>yml</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_resource_route'>resource_route</span>
 <span class='id identifier rubyid_route'>route</span>    <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_scaffold_controller'>scaffold_controller</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles_controller'>articles_controller</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid_index'>index</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid_edit'>edit</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid_show'>show</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid__form'>_form</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles'>articles</span><span class='op'>/</span><span class='id identifier rubyid__article'>_article</span>.<span class='id identifier rubyid_html'>html</span>.<span class='id identifier rubyid_erb'>erb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_resource_route'>resource_route</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_test_unit'>test_unit</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles_controller_test'>articles_controller_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_system'>system</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles_test'>articles_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_helper'>helper</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_helpers'>helpers</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_articles_helper'>articles_helper</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>      <span class='id identifier rubyid_test_unit'>test_unit</span></code></pre>

<h4>The Migration and Model</h4>

<p>The scaffold generator invokes the <code>active_record</code> generator, which generates a
<em>migration</em> and a <em>model</em> for the resource.</p>

<p>NOTE: The migration is named <code>create_blorgh_articles</code> instead of the usual
<code>create_articles</code>, and the model is located at <code>app/models/blorgh/article.rb</code>
rather than <code>app/models/article.rb</code>, since we used the <code>isolate_namespace</code>
method in the <code>Blorgh::Engine</code> class.</p>

<h4>The Test and Fixture</h4>

<p>Next, the <code>test_unit</code> generator is invoked for this model, generating a model
test at <code>test/models/blorgh/article_test.rb</code> (rather than
<code>test/models/article_test.rb</code>) and a fixture at
<code>test/fixtures/blorgh/articles.yml</code> (rather than <code>test/fixtures/articles.yml</code>).</p>

<h4>The Route</h4>

<p>Thereafter,<code>resources :articles</code>, for the <code>article</code> resource, is inserted into
the <code>config/routes.rb</code> file for the engine.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Engine</span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span>
<span class='kw'>end</span></code></pre>

<p>NOTE: The routes are created on the <code>Blorgh::Engine</code> object rather than the
<code>YourApp::Application</code> class. This ensures that the engine routes are confined
to the engine itself and can be mounted at a specific point, as shown in the
<a href="#writing-tests">Writing Tests</a> section. It also allows the engine&#39;s routes to
be isolated from routes that are within the application. The <a href="#routes">Routes</a>
section of this guide describes it in detail.</p>

<h4>The Controller and Views</h4>

<p>Next, the <code>scaffold_controller</code> generator is invoked, generating a controller
called <code>Blorgh::ArticlesController</code> (at
<code>app/controllers/blorgh/articles_controller.rb</code>) and its related views are
created at <code>app/views/blorgh/articles</code>.</p>

<p>This generator also generates tests for the controller
(<code>test/controllers/blorgh/articles_controller_test.rb</code> and
<code>test/system/blorgh/articles_test.rb</code>) and a helper
(<code>app/helpers/blorgh/articles_helper.rb</code>).</p>

<p>Once again, everything is namespaced. The controller&#39;s class is defined within
the <code>Blorgh</code> module:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>NOTE: The <code>ArticlesController</code> class inherits from
<code>Blorgh::ApplicationController</code>, not the application&#39;s <code>ApplicationController</code>.</p>

<h4>The Helper</h4>

<p>The helper inside <code>app/helpers/blorgh/articles_helper.rb</code> is also namespaced:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>module</span> <span class='const'>ArticlesHelper</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This prevents conflicts with any other engine or application that may have an
article resource as well.</p>

<h4>Exploring the Engine in the Browser</h4>

<p>You can explore the engine by first running <code>bin/rails db:migrate</code> at the root
of the engine. Then run <code>bin/rails server</code> in the engine&#39;s root directory to
start the server.</p>

<p>When you open <code>http://localhost:3000/blorgh/articles</code> you will see the default
scaffold that has been generated.</p>

<p>Congratulations, you&#39;ve just generated your first engine!</p>

<h4>Exploring the Engine in the Console</h4>

<p>If you&#39;d rather explore in the console, you can run <code>bin/rails console</code> in the
root directory of the engine. Remember: the <code>Article</code> model is namespaced, so to
reference it you must call it as <code>Blorgh::Article</code>.</p>

<pre class="code irb"><code class="irb">irb&gt; Blorgh::Article.create(title: &quot;Hello, world!&quot;, text: &quot;This is a test article.&quot;)
=&gt;  #&lt;Blorgh::Article id: 1, title: &quot;Hello, world!&quot;, text: &quot;This is a test article.&quot;, created_at: &quot;2025-07-13 07:55:27.610591000 +0000&quot;, updated_at: &quot;2025-07-13 07:55:27.610591000 +0000&quot;&gt;

irb&gt; Blorgh::Article.find(1)
=&gt; #&lt;Blorgh::Article id: 1, title: &quot;Hello, world!&quot; ...&gt;
</code></pre>

<p>Whenever someone goes to the root path where the engine is mounted, they should
be shown a list of articles. To do this, add the following line</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_root'>root</span> <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles#index</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>to the <code>config/routes.rb</code> file inside the engine.</p>

<p>Now you will only need to go to the root of the engine to see all the articles,
rather than visiting <code>/articles</code>. This means that instead of visiting
<code>http://localhost:3000/blorgh/articles</code>, you can now go to
<code>http://localhost:3000/blorgh</code>.</p>

<h3>Generating a Comments Resource</h3>

<p>Now that the engine can create new articles, add the ability to comment. To do
this, you&#39;ll need to generate a comment model, a comment controller, and then
modify the articles scaffold to display comments and allow people to create new
ones.</p>

<p>From the engine root, run the model generator to generate a <code>Comment</code> model,
with the related table having two columns: an <code>article</code> references column and a
<code>text</code> text column.</p>

<pre class="code bash"><code class="bash">$ bin/rails generate model Comment article:references text:text
</code></pre>

<p>This will output the following:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_active_record'>active_record</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_db'>db</span><span class='op'>/</span><span class='id identifier rubyid_migrate'>migrate</span><span class='op'>/</span><span class='op'>&lt;</span><span class='id identifier rubyid_timestamp'>timestamp</span><span class='op'>&gt;</span><span class='id identifier rubyid__create_blorgh_comments'>_create_blorgh_comments</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comment'>comment</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_test_unit'>test_unit</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_models'>models</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comment_test'>comment_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_create'>create</span>      <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_fixtures'>fixtures</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_yml'>yml</span></code></pre>

<p>This will generate a <code>Blorgh::Comment</code> model and a migration to create the
<code>blorgh_comments</code> table.</p>

<p>The generated migration will look like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># db/migrate/&lt;timestamp&gt;_create_blorgh_comments.rb
</span><span class='kw'>class</span> <span class='const'>CreateBlorghComments</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Migration.html" title="ActiveRecord::Migration (class)">Migration</a></span>[<span class='float'>8.0</span>]
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_blorgh_comments'>blorgh_comments</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_references'>references</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span><span class='comma'>,</span> <span class='label'>null:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_text'>text</span> <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span>

      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_timestamps'>timestamps</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>However, since you&#39;re building an isolated engine, the model <code>Blorgh::Comment</code>
references <code>Blorgh::Article</code>, so the <code>article_id</code> foreign key should point to
the <code>blorgh_articles</code> table, not an <code>articles</code> table.</p>

<p>To fix this, you can modify the existing migration file to look like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># db/migrate/&lt;timestamp&gt;_create_blorgh_comments.rb
</span><span class='kw'>class</span> <span class='const'>CreateBlorghComments</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Migration.html" title="ActiveRecord::Migration (class)">Migration</a></span>[<span class='float'>8.0</span>]
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbeg'>:</span><span class='id identifier rubyid_blorgh_comments'>blorgh_comments</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_references'>references</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span><span class='comma'>,</span> <span class='label'>null:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>foreign_key:</span> { <span class='label'>to_table:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_blorgh_articles'>blorgh_articles</span> }
      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_text'>text</span> <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span>

      <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_timestamps'>timestamps</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Now, you can run the migration to create the <code>blorgh_comments</code> table:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate
</code></pre>

<h4>Updating the View to Show the Comments</h4>

<p>To show the comments on an article, edit
<code>app/views/blorgh/articles/show.html.erb</code> and add this line before the &quot;Edit&quot;
link:</p>

<pre class="code xml"><code class="xml">&lt;h3&gt;Comments&lt;/h3&gt;
&lt;%= render @article.comments %&gt;
</code></pre>

<p>To get the comments to display on an article, define a <code>has_many</code> association on
the <code>Blorgh::Article</code> model:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/models/blorgh/article.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
    <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>NOTE: Since the <code>has_many</code> association is defined inside a class that is inside
the <code>Blorgh</code> module, Rails knows that you want to use the <code>Blorgh::Comment</code>
model for these objects, so there&#39;s no need to specify the <code>:class_name</code> option.</p>

<h4>Adding a Form and Resource Route to Create Comments</h4>

<p>Next, create a form so that comments can be added to an article. Render the
<code>blorgh/comments/form</code> partial in <code>app/views/blorgh/articles/show.html.erb</code>
underneath the <code>render @article.comments</code> line.</p>

<pre class="code erb"><code class="erb">...
  &lt;%= render @article.comments %&gt;

  &lt;!-- Render the comments form --&gt;
  &lt;%= render &quot;blorgh/comments/form&quot; %&gt;
...
</code></pre>

<p>Next, create the <code>blorgh/comments/form</code> partial that we just referenced. To do
this, create a new directory at <code>app/views/blorgh/comments</code> and in it a new file
called <code>_form.html.erb</code> with the following content:</p>

<pre class="code xml"><code class="xml">&lt;h3&gt;New comment&lt;/h3&gt;
&lt;%= form_with model: [@article, @article.comments.build] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :text %&gt;&lt;br&gt;
    &lt;%= form.textarea :text %&gt;
  &lt;/p&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;
</code></pre>

<p>When this form is submitted, it will attempt to perform a <code>POST</code> request to the
<code>/articles/:article_id/comments</code> route within the engine. You can read more
about the <a href="form_helpers.html#working-with-basic-forms"><code>form_with</code> helper</a> in
the guides.</p>

<p>However, this route doesn&#39;t exist yet. You can create it by nesting the
<code>comments</code> resource inside the <code>articles</code> resource in <code>config/routes.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>
<span class='kw'>end</span></code></pre>

<p>Now, create the controller that will handle the <code>POST</code> request to the
<code>/articles/:article_id/comments</code> route:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate controller comments
</code></pre>

<p>This will generate the following things:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_create'>create</span>  <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comments_controller'>comments_controller</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_erb'>erb</span>
 <span class='id identifier rubyid_exist'>exist</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comments'>comments</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_test_unit'>test_unit</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comments_controller_test'>comments_controller_test</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>  <span class='id identifier rubyid_helper'>helper</span>
<span class='id identifier rubyid_create'>create</span>    <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_helpers'>helpers</span><span class='op'>/</span><span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comments_helper'>comments_helper</span>.<span class='id identifier rubyid_rb'>rb</span>
<span class='id identifier rubyid_invoke'>invoke</span>    <span class='id identifier rubyid_test_unit'>test_unit</span></code></pre>

<p>As mentioned, the form will make a <code>POST</code> request to
<code>/articles/:article_id/comments</code>, so we&#39;ll need a <code>create</code> action in
<code>Blorgh::CommentsController</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/controllers/blorgh/comments_controller.rb
</span><span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_article_id'>article_id</span>])
  <span class='ivar'>@comment</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_comment_params'>comment_params</span>)
  <span class='id identifier rubyid_flash'>flash</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_notice'>notice</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Comment has been created!</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_articles_path'>articles_path</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_private'>private</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_comment_params'>comment_params</span>
    <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_expect'>expect</span>(<span class='label'>comment:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span>])
  <span class='kw'>end</span></code></pre>

<p>However, if you were to create a comment, you would see an error where the
engine is unable to find the partial required for rendering the comments:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Missing</span> <span class='id identifier rubyid_partial'>partial</span> <span class='id identifier rubyid_blorgh'>blorgh</span><span class='op'>/</span><span class='id identifier rubyid_comments'>comments</span><span class='op'>/</span><span class='id identifier rubyid__comment'>_comment</span> <span class='id identifier rubyid_with'>with</span> {<span class='symbeg'>:</span><span class='id identifier rubyid_locale'>locale</span><span class='op'>=&gt;</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_en'>en</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_formats'>formats</span><span class='op'>=&gt;</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_html'>html</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_variants'>variants</span><span class='op'>=&gt;</span>[]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_handlers'>handlers</span><span class='op'>=&gt;</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_raw'>raw</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_erb'>erb</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_html'>html</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_builder'>builder</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ruby'>ruby</span>]}.</code></pre>

<p>NOTE: Rails will first look in the application&#39;s (<code>test/dummy</code>) <code>app/views</code>
directory and then in the engine&#39;s <code>app/views</code> directory. When it can&#39;t find the
file, it will throw this error. The engine looks for <code>blorgh/comments/_comment</code>
because the comment object it&#39;s rendering is an instance of the
<code>Blorgh::Comment</code> class.</p>

<p>Create a new file at <code>app/views/blorgh/comments/_comment.html.erb</code> and add the
following line to display the comment text:</p>

<pre class="code xml"><code class="xml">&lt;%= comment_counter + 1 %&gt;. &lt;%= comment.text %&gt;
</code></pre>

<p>The <code>comment_counter</code> local variable is given to us by the <code>&lt;%= render
@article.comments %&gt;</code> call, which will define it automatically and increment the
counter as it iterates through each comment. It&#39;s used in this example to
display a small number next to each comment when it&#39;s created.</p>

<p>That completes the comment functionality of the blogging engine. Now it&#39;s time
to use it within an application.</p>

<h2>Using the Engine in a Host Application</h2>

<p>This section explains how to mount the engine into an application, perform the
initial setup, and connect the engine to an existing class defined by the host
application.</p>

<h3>Mounting the Engine</h3>

<p>To use the engine in a host application, add it to the application&#39;s <code>Gemfile</code>.
If you don&#39;t already have an application to test with, you can generate one
outside the engine directory using the <code>rails new</code> command:</p>

<pre class="code bash"><code class="bash">$ cd .. # Exit the engine folder
$ rails new host_application
</code></pre>

<p>This means the host application and the engine will live side by side in your
filesystem, like this:</p>

<pre class="code bash"><code class="bash">/your_project_root/
├── blorgh/           # The engine
└── host_application/ # The app where you test the engine
</code></pre>

<p>In a production application, once your gem has been published, you would add the
engine to your Gemfile, like you do with other gems. For example, to add Devise
to your application, you would add the following line to your Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>devise</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>However, since the engine is not published as a gem yet, and you&#39;re developing
it locally, you need to link to it using a relative path in the host
application&#39;s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blorgh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>path:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>../blorgh</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>Now that the local path to the gem is specified, run <code>bundle install</code> to install
it.</p>

<p>NOTE: By including the engine in the application&#39;s <code>Gemfile</code>, it will be loaded
automatically when Rails boots. Rails will first require the engine’s entry
point file at <code>lib/blorgh.rb</code>. This file typically sets up the namespace and
requires additional files, including <code>lib/blorgh/engine.rb</code>, which defines the
<code>Blorgh::Engine</code> class. This <code>Engine</code> class is responsible for hooking into the
Rails application and mounting the engine&#39;s initializers, and other
configurations.</p>

<p>To make the engine&#39;s functionality available within a host application, you need
to mount it in the application&#39;s <code>config/routes.rb</code> file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mount'>mount</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Engine</span><span class='comma'>,</span> <span class='label'>at:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/blog</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This mounts the engine at the <code>/blog</code> path, making its routes accessible at
<code>http://localhost:3000/blog</code> when the application is running.</p>

<p>NOTE: Some engines, like Devise, expose custom routing helpers (such as
<code>devise_for</code>) instead of using <code>mount</code>. These helpers internally mount parts of
the engine&#39;s functionality at specific paths and provide additional
configuration options tailored to the engine&#39;s domain.</p>

<p>However, if you try to run the application at this point, you will see an error
like this:</p>

<pre class="code bash"><code class="bash">SQLite3::SQLException: no such table: blorgh_articles:
SELECT &quot;blorgh_articles&quot;.* FROM &quot;blorgh_articles&quot; /*action=&#39;index&#39;,application=&#39;HostApplication&#39;,controller=&#39;articles&#39;*/
</code></pre>

<p>This is because the engine&#39;s migrations haven&#39;t been copied over to the host
application&#39;s database yet. The next section explains how to do this.</p>

<h3>Engine Setup</h3>

<p>The engine contains migrations for the <code>blorgh_articles</code> and <code>blorgh_comments</code>
tables which need to be created in the application&#39;s database so that the
engine&#39;s models can query them correctly.</p>

<h4>Copying the Migrations</h4>

<p>To copy these migrations into the application run the following command from the
application&#39;s root:</p>

<pre class="code bash"><code class="bash">$ bin/rails blorgh:install:migrations
</code></pre>

<p>which will output something like this:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Copied</span> <span class='id identifier rubyid_migration'>migration</span> <span class='op'>&lt;</span><span class='id identifier rubyid_timestamp_1'>timestamp_1</span><span class='op'>&gt;</span><span class='id identifier rubyid__create_blorgh_articles'>_create_blorgh_articles</span>.<span class='id identifier rubyid_blorgh'>blorgh</span>.<span class='id identifier rubyid_rb'>rb</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_blorgh'>blorgh</span>
<span class='const'>Copied</span> <span class='id identifier rubyid_migration'>migration</span> <span class='op'>&lt;</span><span class='id identifier rubyid_timestamp_2'>timestamp_2</span><span class='op'>&gt;</span><span class='id identifier rubyid__create_blorgh_comments'>_create_blorgh_comments</span>.<span class='id identifier rubyid_blorgh'>blorgh</span>.<span class='id identifier rubyid_rb'>rb</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_blorgh'>blorgh</span></code></pre>

<p>INFO: When run for the first time, <code>bin/rails blorgh:install:migrations</code> copies
over all the migrations from the engine. When run the next time, it will only
copy over migrations that haven&#39;t been copied over already. This is useful if
you want to revert the migrations from the engine.</p>

<h4>Migrations for Multiple Engines</h4>

<p>If you have multiple engines referenced in the host application, that need
migrations copied over, use <code>railties:install:migrations</code> instead:</p>

<pre class="code bash"><code class="bash">$ bin/rails railties:install:migrations
</code></pre>

<p>This will save you from having to run a separate <code>install:migrations</code> task for
each engine individually.</p>

<h4>Referencing a Custom Path for the Migrations</h4>

<p>If your engine stores its migrations in the non-default location, you can
specify a custom path in the source engine for the migrations using
<code>MIGRATIONS_PATH</code>:</p>

<pre class="code bash"><code class="bash">$ bin/rails railties:install:migrations MIGRATIONS_PATH=db_blorgh
</code></pre>

<h4>Migrations for Multiple Databases</h4>

<p>If you have multiple databases within an engine, you can specify the target
database by specifying the <code>DATABASE</code> option:</p>

<pre class="code bash"><code class="bash">$ bin/rails railties:install:migrations DATABASE=animals
</code></pre>

<p>NOTE: These tasks are provided by
<a href="https://api.rubyonrails.org/classes/Rails/Railtie.html"><a href="ActiveRecord/Railtie.html" title="ActiveRecord::Railtie (class)"><code>::ActiveRecord::Railtie</code></a></a>,
the Rails component responsible for managing how Active Record integrates into
an application. When run, it looks through all loaded engines and copies any
exposed migrations into the host application&#39;s <code>db/migrate</code> folder, saving you
from having to run a separate <code>install:migrations</code> task for each engine
individually.</p>

<h4>Running Migrations</h4>

<p>To run these migrations within the context of the application, run:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate
</code></pre>

<h4>Running and Reverting Migrations for Only One Engine</h4>

<p>If you have multiple engines referenced in the host application, and you would
like to run migrations only from one engine, you can do it by specifying
<code>SCOPE</code>:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate SCOPE=blorgh
</code></pre>

<p>This scope may also be useful if you want to revert an engine&#39;s migrations
before removing it.</p>

<p>To revert all migrations from blorgh engine you can run code such as:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate SCOPE=blorgh VERSION=0
</code></pre>

<p>Once you&#39;ve run the migrations, you can access the engine through
<code>http://localhost:3000/blog</code>.</p>

<p>The articles will be empty, because the table created inside the application is
different from the one created within the engine. You can explore the engine
through the host application, in the same way as you did when it was only an
engine.</p>

<h3>Connecting Engine Records to Application Models</h3>

<p>When building a Rails engine, you may want to connect the engine&#39;s records to
models defined by the host application. For example, in the blorgh engine, you
might want each <code>article</code> or <code>comment</code> to have an associated <code>author</code>. While the
engine sets up the <code>author</code> relationship, the actual model, <code>User</code> in this case,
comes from the host application.</p>

<p>This section explains how to associate an <code>Article</code> from the engine with a
<code>User</code> from the host application. For simplicity, assume the host application
uses a model called <code>User</code>, but there could be a case where a different host
application calls this class something different, such as <code>Person</code>. For this
reason, the engine should not hardcode associations specifically for a <code>User</code>
class. Instead, it should be configurable. This is covered in the <a href="#configuring-the-engine-to-use-a-custom-class">next
section</a>.</p>

<h4>Generating a User Model in the Host Application</h4>

<p>To keep it simple in this case, the application will have a class called <code>User</code>
that represents the users of the application. It can be generated using this
command inside the application&#39;s root directory:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate model user name:string
</code></pre>

<p>The <code>bin/rails db:migrate</code> command needs to be run here to ensure that our
application has the <code>users</code> table for future use.</p>

<h4>Associating <code>author_name</code> from the Engine to a Class in the Host Application</h4>

<p>The article form will include a new text field called <code>author_name</code>, where users
can enter their name. The engine will use this name to either find an existing
<code>User</code> object or create a new one. It will then associate the article with that
<code>User</code> (or whatever class the host application uses to represent authors) as the
article&#39;s author.</p>

<p>Add the <code>author_name</code> text field to the
<code>app/views/blorgh/articles/_form.html.erb</code> partial inside the engine. This can
be added above the <code>title</code> field with the following code:</p>

<pre class="code xml"><code class="xml">&lt;%= form_with(model: article) do |form| %&gt;
  &lt;%# ... %&gt;

  &lt;div class=&quot;field&quot;&gt;
    &lt;%= form.label :author_name %&gt;&lt;br&gt;
    &lt;%= form.text_field :author_name %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :title, style: &quot;display: block&quot; %&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;
  &lt;%# ... %&gt;
&lt;% end %&gt;
</code></pre>

<p>The author&#39;s name should also be displayed on the article&#39;s page. Add this code
above the &quot;Title&quot; output inside <code>app/views/blorgh/articles/_article.html.erb</code>:</p>

<pre class="code xml"><code class="xml">&lt;p&gt;
  &lt;strong&gt;Author:&lt;/strong&gt;
  &lt;%= article.author.name %&gt;
&lt;/p&gt;
</code></pre>

<p>Next, we need to update the <code>Blorgh::ArticlesController#article_params</code> method
to permit the new form parameter:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_article_params'>article_params</span>
  <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_expect'>expect</span>(<span class='label'>article:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author_name'>author_name</span>])
<span class='kw'>end</span></code></pre>

<p>The <code>Blorgh::Article</code> model should include logic to convert the <code>author_name</code>
field into an actual <code>User</code> object (or whatever class the host application uses
for authors) and associate it with the article before it is saved. It should
also define an <code>attr_accessor</code> for <code>author_name</code> to provide getter and setter
methods for this attribute.</p>

<p>Start by adding the <code>attr_accessor</code> for <code>author_name</code>, the association for the
author and the <code>before_validation</code> call into <code>app/models/blorgh/article.rb</code>.</p>

<pre class="code ruby#7-10"><code class="ruby#7-10"># app/models/blorgh/article.rb
module Blorgh
  class Article &lt; ApplicationRecord
    has_many :comments

    # Add the author association to the model
    attr_accessor :author_name
    belongs_to :author, class_name: &quot;User&quot; # The User class exists in the host application

    before_validation :set_author

    private
      def set_author
        self.author = User.find_or_create_by(name: author_name)
      end
  end
end
</code></pre>

<p>For now, this setup allows the engine to associate an author name with the
<code>User</code> model defined by the host application, even though it introduces a
coupling that will be removed later. It will be made more configurable in the
<a href="#configuring-the-engine-to-use-a-custom-class">next section</a>.</p>

<p>There also needs to be a way of associating the records in the <code>blorgh_articles</code>
table with the records in the <code>users</code> table. Because the association in the
engine is called <code>author</code>, there should be an <code>author_id</code> column added to the
<code>blorgh_articles</code> table.</p>

<p>To generate this new column, run this command within the engine&#39;s root
directory:</p>

<pre class="code bash"><code class="bash">$ bin/rails generate migration add_author_id_to_blorgh_articles author_id:integer
</code></pre>

<h4>Copying and Running the Migration in the Host Application</h4>

<p>As discussed in the <a href="#copying-the-migrations">Copying the Migrations</a> section,
this new migration will need to be copied to the host application:</p>

<pre class="code bash"><code class="bash">$ bin/rails blorgh:install:migrations
</code></pre>

<pre class="code ruby"><code class="ruby"><span class='const'>Copied</span> <span class='id identifier rubyid_migration'>migration</span> <span class='op'>&lt;</span><span class='id identifier rubyid_timestamp'>timestamp</span><span class='op'>&gt;</span><span class='id identifier rubyid__add_author_id_to_blorgh_articles'>_add_author_id_to_blorgh_articles</span>.<span class='id identifier rubyid_blorgh'>blorgh</span>.<span class='id identifier rubyid_rb'>rb</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_blorgh'>blorgh</span></code></pre>

<p>Notice that only <em>the latest</em> migration was copied over. This is because the
first two migrations were copied over the first time this command was run in a
<a href="#copying-the-migrations">previous section</a>.</p>

<p>Run the migration using:</p>

<pre class="code bash"><code class="bash">$ bin/rails db:migrate
</code></pre>

<h4>Viewing the Association in the Rails console</h4>

<p>Now that you&#39;ve associated the <code>author_name</code> from the engine to the <code>User</code> model
in the host application, you can go to the form in the host application at
<code>http://localhost:3000/blog/articles/new</code> and create an article with an author
name that will create and link to a <code>User</code> record in the host application.</p>

<p>If you open up the rails console in the host application, you can view the
<code>Blorgh::Article</code> record that was created, and see that it is associated with
the <code>User</code> record from the host application:</p>

<pre class="code irb"><code class="irb">irb&gt; article = Blorgh::Article.last
=&gt; #&lt;Blorgh::Article id: 1, title: &quot;Hello, World!&quot;, text: &quot;This is a test article.&quot;, created_at: &quot;2025-07-16 19:04:54.552457000 +0000&quot;, updated_at: &quot;2025-07-16 19:04:54.552457000 +0000&quot;, author_id: 1&gt;

irb&gt; user = article.author
=&gt; #&lt;User id: 1, name: &quot;Fake Author 1&quot;, created_at: &quot;2025-07-16 19:04:54.542709000 +0000&quot;, updated_at: &quot;2025-07-16 19:04:54.542709000 +0000&quot;&gt;
</code></pre>

<h4>Using a Controller Provided by the Application</h4>

<p>In a typical Rails application, all controllers inherit from
<code>ApplicationController</code>, which often contains shared logic like authentication
methods or session helpers.</p>

<p>Rails engines, however, are isolated by default. Each engine has its own
<code>ApplicationController</code> (like <code>Blorgh::ApplicationController</code>) to avoid
conflicts with the main app. However, sometimes, the engine&#39;s controllers need
to access methods defined in the main application&#39;s <code>ApplicationController</code>.
This is often necessary for features like authentication (<code>current_user</code>),
authorization checks, or helper methods that manage things like user
preferences, flash messages, or layout logic. This is shared functionality
that&#39;s already defined in the main application and shouldn&#39;t be re-implemented
in the engine.</p>

<p>To make this possible, you can update the engine’s <code>ApplicationController</code> so
that it inherits from the main app’s <code>ApplicationController</code> instead of being
isolated. In the Blorgh engine, you would change the file
<code>app/controllers/blorgh/application_controller.rb</code> to:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/controllers/blorgh/application_controller.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'>ApplicationController</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The <code>::ApplicationController</code> here refers to the main application&#39;s controller.
With this change, all controllers in the engine (which inherit from
<code>Blorgh::ApplicationController</code> by default) will now also have access to methods
from the main app’s controller, like <code>current_user</code>, authentication helpers, or
anything else defined there.</p>

<p>Keep in mind that this setup only works when the engine is being used inside a
host application that has its own <code>ApplicationController</code>.</p>

<h3>Configuring the Engine to Use a Custom Class</h3>

<p>Earlier, we hard-coded the author association to the <code>User</code> class. However, this
approach isn&#39;t ideal, because the engine shouldn&#39;t assume the existence of a
specific class in the host application. For example, some applications might use
a differently named class, such as <code>Person</code>, to represent authors.</p>

<p>In this section we&#39;ll make the class that represents a <code>User</code> in the application
customizable for the engine, allowing the engine to work with any model the host
application chooses to use. This will be followed by general configuration tips
for the engine.</p>

<h4>Creating the <code>author_class_name</code> Configuration Setting in the Engine</h4>

<p>To make the class that represents a <code>User</code> in the application customizable for
the engine, the engine should have a configuration setting called
<code>author_class_name</code> that will be used to specify which class name represents
<code>authors</code> within the host application.</p>

<p>To define this configuration setting, you should use a
<a href="https://api.rubyonrails.org/classes/Module.html#method-i-mattr_accessor"><code>mattr_accessor</code></a>
inside the <code>Blorgh</code> module for the engine. Add this line to the <code>Blorgh</code> module:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># lib/blorgh.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='id identifier rubyid_mattr_accessor'>mattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author_class_name'>author_class_name</span>
<span class='kw'>end</span></code></pre>

<p>This method provides a getter and setter method on the module with the specified
name. To use it, it must be referenced using <code>Blorgh.author_class_name</code>.</p>

<p>The next step is to switch the <code>Blorgh::Article</code> model over to this new setting.
Replace <code>belongs_to :author, class_name: &quot;User&quot;</code> with <code>Blorgh.author_class_name</code>
in the <code>Blorgh::Article</code> model:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/models/blorgh/article.rb
</span><span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='const'>Blorgh</span>.<span class='id identifier rubyid_author_class_name'>author_class_name</span></code></pre>

<p>The line <code>self.author = User.find_or_create_by(name: author_name)</code> in the
<code>Blorgh::Article</code> model should also use this class name instead of <code>User</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/models/blorgh/article.rb
</span>
<span class='kw'>def</span> <span class='id identifier rubyid_set_author'>set_author</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> <span class='const'>Blorgh</span>.<span class='id identifier rubyid_author_class_name'>author_class_name</span>.<span class='id identifier rubyid_constantize'>constantize</span>.<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>name:</span> <span class='id identifier rubyid_author_name'>author_name</span>)
<span class='kw'>end</span></code></pre>

<p>To save having to call <code>constantize</code> on the <code>author_class_name</code> result all the
time, you could create a convenience helper to <code>constantize</code> on demand when you
need the Class.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># lib/blorgh.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='id identifier rubyid_mattr_accessor'>mattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author_class_name'>author_class_name</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_author_class'>author_class</span>
    <span class='id identifier rubyid_author_class_name'>author_class_name</span>.<span class='id identifier rubyid_constantize'>constantize</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This would then turn the above code for <code>set_author</code> into this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/models/blorgh/article.rb
</span><span class='kw'>self</span>.<span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> <span class='const'>Blorgh</span>.<span class='id identifier rubyid_author_class'>author_class</span>.<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>name:</span> <span class='id identifier rubyid_author_name'>author_name</span>)</code></pre>

<h4>Setting the <code>author_class_name</code> Configuration Setting in the Host Application</h4>

<p>To set this configuration setting within the host application, an initializer
can be used. By using an initializer, the configuration will be set up before
the application starts and before it calls the engine&#39;s models. This is
important because the engine&#39;s models may depend on this configuration setting
existing.</p>

<p>Create a new initializer at <code>config/initializers/blorgh.rb</code> inside the host
application and set the <code>author_class_name</code> configuration setting to <code>User</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Blorgh</span>.<span class='id identifier rubyid_author_class_name'>author_class_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>In a different host application where the model is called <code>Person</code>, you would
set the <code>author_class_name</code> configuration setting to <code>Person</code>.</p>

<p>WARNING: Be sure to pass the class name as a string (e.g., <code>&quot;User&quot;</code>), not as a
constant (<code>User</code>). If you use the class directly, Rails may try to load it and
its associated table before the application has fully initialized. This can
cause errors if the table hasn&#39;t been created yet. By using a string, the engine
can safely convert it to a class later using <code>constantize</code>, after initialization
is complete.</p>

<p>Try creating a new article - everything should work just as before. The key
difference is that the engine now uses the <code>author_class_name</code> configuration set
in <code>config/initializers/blorgh.rb</code> to determine which model to associate as the
author.</p>

<p>At this point, the engine no longer has a hardcoded dependency on a specific
class name like <code>User</code>. Instead, it relies on whatever class name is specified
in the configuration. The only requirement is that the configured class name is
a class that responds to <code>find_or_create_by</code> and returns an object that can be
associated with an article. That object should also have an identifiable
attribute (such as an <code>id</code>) that can be used for lookup and display.</p>

<h4>General Engine Configuration</h4>

<p>Within an engine, there may come a time where you wish to use things such as
initializers, internationalization, or other configuration options. The great
news is that these things are entirely possible, because a Rails engine shares
much the same functionality as a Rails application. In fact, a Rails
application&#39;s functionality is actually a superset of what is provided by
engines!</p>

<p>If you wish to use an initializer - code that should run before the engine is
loaded - the place for it is the <code>config/initializers</code> folder. This directory&#39;s
functionality is explained in the <a href="configuring.html#initializers">Initializers
section</a> of the Configuring Rails Applications
guide, and works precisely the same way as the <code>config/initializers</code> directory
inside an application. The same thing goes if you want to use a standard
initializer.</p>

<p>For locales, simply place the <a href="i18n.html#providing-translations-for-internationalized-strings">locale files in the <code>config/locales</code> directory</a>,
just like you would in an application.</p>

<h2>Improving the Engine</h2>

<p>This section explains how to add and/or override engine functionality in the
main Rails application.</p>

<h3>Overriding Models and Controllers</h3>

<p>Engine models and controllers can be reopened and extended by the host
application to customize or override their behavior. This is useful when the
host application needs to make changes, such as adding validations to a model or
adjusting controller logic, without modifying the engine’s source code directly.</p>

<p>A common approach is to place override files in a dedicated directory, such as
<code>app/overrides</code>, and manually load them during application initialization. This
directory is ignored by the Rails autoloader to prevent naming conflicts and to
prevent unintended constant loading.</p>

<p>Here’s how you can set this up in the host application:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/application.rb
</span><span class='kw'>module</span> <span class='const'>HostApplication</span>
  <span class='kw'>class</span> <span class='const'>Application</span> <span class='op'>&lt;</span> <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span><span class='op'>::</span><span class='const'><a href="Rails/Application.html" title="Rails::Application (class)">Application</a></span>
    <span class='comment'># ...
</span>
    <span class='id identifier rubyid_overrides'>overrides</span> <span class='op'>=</span> <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_root'><a href="Rails.html#root-class_method" title="Rails.root (method)">root</a></span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>app/overrides</span><span class='tstring_end'>&quot;</span></span>)
    <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_autoloaders'><a href="Rails.html#autoloaders-class_method" title="Rails.autoloaders (method)">autoloaders</a></span>.<span class='id identifier rubyid_main'>main</span>.<span class='id identifier rubyid_ignore'>ignore</span>(<span class='id identifier rubyid_overrides'>overrides</span>)

    <span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_to_prepare'>to_prepare</span> <span class='kw'>do</span>
      <span class='const'>Dir</span>.<span class='id identifier rubyid_glob'>glob</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_overrides'>overrides</span><span class='embexpr_end'>}</span><span class='tstring_content'>/**/*_override.rb</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_sort'>sort</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_override'>override</span><span class='op'>|</span>
        <span class='id identifier rubyid_load'>load</span> <span class='id identifier rubyid_override'>override</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h4>Why Use <code>to_prepare</code> and <code>load</code></h4>

<p>The <code>to_prepare</code> block ensures that overrides are reloaded on each request in
development (and only once in production), which is helpful when working with
engines during development. Using <code>load</code> instead of <code>require</code> allows the
override files to be reloaded without restarting the server.</p>

<h4>Why Ignore Autoloading</h4>

<p>The <code>app/overrides</code> directory is ignored by Zeitwerk (Rails’ autoloader) so that
you can control exactly when the files are loaded. This prevents potential
conflicts with similarly named classes or modules elsewhere in the application.</p>

<h4>Naming Convention</h4>

<p>It’s recommended to suffix override files with <code>_override.rb</code> (e.g.,
<code>article_override.rb</code>) to clearly distinguish them from standard models and
controllers and to avoid any conflicts with autoloaded files.</p>

<h4>Reopening Existing Classes Using <code>class_eval</code></h4>

<p>In order to override the engine model</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># blorgh/app/models/blorgh/article.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>you can create a file that <em>reopens</em> that class. This example reopens the
<code>Blorgh::Article</code> model and adds a validation for the <code>title</code> attribute.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># host_application/app/overrides/models/blorgh/article_override.rb
</span><span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Article</span>.<span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_validates'>validates</span> <span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>presence:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>length:</span> { <span class='label'>minimum:</span> <span class='int'>10</span> }
<span class='kw'>end</span></code></pre>

<p>It is very important that the override <em>reopens</em> the class or module. Using the
<code>class</code> or <code>module</code> keywords would define them if they were not already in
memory, which would be incorrect because the definition lives in the engine.
Using
<a href="https://api.rubyonrails.org/classes/Module.html#method-i-class_eval"><code>class_eval</code></a>
as shown above ensures you are reopening an existing module.</p>

<h4>Reopening Existing Classes Using ActiveSupport::Concern</h4>

<p>While
<a href="https://api.rubyonrails.org/classes/Module.html#method-i-class_eval"><code>Class#class_eval</code></a>
is useful for making simple runtime changes to a class, more complex
modifications—especially those involving multiple modules with dependencies—are
often better handled using
<a href="https://api.rubyonrails.org/classes/ActiveSupport/Concern.html"><a href="ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a></a>.
It provides a structured way to define module behavior and dependencies,
ensuring consistent load order and making it easier to organize and compose
reusable code.</p>

<p>Suppose you want to extend the <code>Blorgh::Article</code> model from the host application
by:</p>

<ul>
<li>Adding a new instance method: <code>time_since_created</code></li>
<li>Overriding the existing <code>summary</code> method</li>
</ul>

<p>Here’s how you can do it cleanly using <a href="ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>:</p>

<h5>Defining a Concern</h5>

<p>First, define a concern that contains the shared behavior:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># blorgh/lib/concerns/models/article.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Concerns</span><span class='op'>::</span><span class='const'>Models</span><span class='op'>::</span><span class='const'>Article</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">Concern</a></span>

  <span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author_name'>author_name</span>
    <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span><span class='comma'>,</span> <span class='label'>class_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_before_validation'>before_validation</span> <span class='symbeg'>:</span><span class='id identifier rubyid_set_author'>set_author</span>

    <span class='id identifier rubyid_private'>private</span>
      <span class='kw'>def</span> <span class='id identifier rubyid_set_author'>set_author</span>
        <span class='kw'>self</span>.<span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>name:</span> <span class='id identifier rubyid_author_name'>author_name</span>)
      <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_title'>title</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>module</span> <span class='const'>ClassMethods</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_some_class_method'>some_class_method</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some class method string</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h5>Setting Up the Engine’s Base Model</h5>

<p>Next, include the concern in the engine’s <code>Article</code> model. This ensures that
engine users who don’t override the model still benefit from the concern’s
behavior:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># blorgh/app/models/blorgh/article.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
    <span class='id identifier rubyid_include'>include</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Concerns</span><span class='op'>::</span><span class='const'>Models</span><span class='op'>::</span><span class='const'>Article</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h5>Extending in the Host Application</h5>

<p>Finally, the host application can override and extend the model by reopening it.
Here we add a new instance method and override the existing <code>summary</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># host_application/app/models/blorgh/article.rb
</span><span class='kw'>class</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Concerns</span><span class='op'>::</span><span class='const'>Models</span><span class='op'>::</span><span class='const'>Article</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_time_since_created'>time_since_created</span>
    <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_current'><a href="Time.html#current-class_method" title="Time.current (method)">current</a></span> <span class='op'>-</span> <span class='id identifier rubyid_created_at'>created_at</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_title'>title</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_truncate'>truncate</span>(<span class='id identifier rubyid_text'>text</span>)<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h3>Autoloading and Engines</h3>

<p>Please check the <a href="autoloading_and_reloading_constants.html#autoloading-and-engines">Autoloading and Reloading
Constants</a>
guide for more information about autoloading and engines.</p>

<h3>Overriding Views</h3>

<p>When the host application looks for a view to render, it will first look in the
<code>app/views</code> directory of the application. If it cannot find the view there, it
will then check in the <code>app/views</code> directories of all engines that have this
directory.</p>

<p>For example, when the host application is asked to render the view for
<code>Blorgh::ArticlesController</code>&#39;s index action, it will first look for the path
<code>app/views/blorgh/articles/index.html.erb</code> within the application. If it cannot
find it, it will then look inside the engine.</p>

<p>You can override this view in the host application by creating a new file at
<code>app/views/blorgh/articles/index.html.erb</code>. Then you can completely change what
this view would normally output, like the following:</p>

<pre class="code xml"><code class="xml">&lt;h1&gt;Articles&lt;/h1&gt;
&lt;%= link_to &quot;New Article&quot;, new_article_path %&gt;
&lt;% @articles.each do |article| %&gt;
  &lt;h2&gt;&lt;%= article.title %&gt;&lt;/h2&gt;
  &lt;small&gt;By &lt;%= article.author.name %&gt;&lt;/small&gt;
  &lt;%= simple_format(article.text) %&gt;
  &lt;hr&gt;
&lt;% end %&gt;
</code></pre>

<p>The new view at <code>localhost:3000/blog/articles</code> will now display the updated view
with the new content.</p>

<h3>Routes</h3>

<p>Routes defined inside a Rails engine are isolated from the main application by
default. This isolation is established by the
<a href="#the-engine-class-definition-lib-blorgh-engine-rb"><code>isolate_namespace</code></a> call in
the engine’s <code>Engine</code> class. It allows both the engine and the application to
define routes with the same names—like <code>articles_path</code>—without conflict.</p>

<h4>Defining Engine Routes</h4>

<p>You can define routes inside the engine using the engine&#39;s route set:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># blorgh/config/routes.rb
</span><span class='const'>Blorgh</span><span class='op'>::</span><span class='const'>Engine</span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span>
<span class='kw'>end</span></code></pre>

<p>When your engine is mounted into a host application (e.g., at <code>/blog</code>), this
creates routes like:</p>

<ul>
<li><code>/blog/articles</code> → <code>Blorgh::ArticlesController#index</code></li>
</ul>

<h4>Linking to Engine Routes from the Application</h4>

<p>Because routes are namespaced and isolated, route helpers like <code>articles_path</code>
may refer to either the engine&#39;s route or the application&#39;s route, depending on
where the view is rendered from.</p>

<p>For example:</p>

<pre class="code xml"><code class="xml">&lt;%= link_to &quot;Blog articles&quot;, articles_path %&gt;
</code></pre>

<p>If rendered from the application, it will likely resolve to the application&#39;s
<code>articles_path</code>. If rendered from inside the engine, it may resolve to the
engine&#39;s <code>articles_path</code>.</p>

<p>To ensure you&#39;re linking to the engine&#39;s route, use the engine&#39;s named routing
proxy. For the <code>blorgh</code> engine, that would be:</p>

<pre class="code xml"><code class="xml">&lt;%= link_to &quot;Blog articles&quot;, blorgh.articles_path %&gt;
</code></pre>

<p>This explicitly tells Rails to use the <code>articles_path</code> defined in the <code>Blorgh</code>
engine.</p>

<p>The name of the proxy method (<code>blorgh</code>) matches the name of the engine as
declared in <code>engine.rb</code> via <code>isolate_namespace Blorgh</code>.</p>

<h4>Linking to Application Routes from the Engine</h4>

<p>If you need to reference a route defined in the main application from within the
engine (for example, linking to the homepage), you can use the <code>main_app</code>
routing proxy:</p>

<pre class="code xml"><code class="xml">&lt;%= link_to &quot;Home&quot;, main_app.root_path %&gt;
</code></pre>

<p>This ensures the route always points to the host application, even when called
from within engine views.</p>

<h4>Targeted Routes</h4>

<p>If you call a route helper like <code>root_path</code> from inside an engine view, and both
the engine and application define a root route, Rails may not know which one to
use. Or worse, it may raise an error if the route doesn&#39;t exist in the engine.</p>

<p>To prevent this, use <code>main_app.root_path</code> to target the application, and set
<code>blorgh.root_path</code> (or your engine&#39;s namespace) to target the engine.</p>

<p>Being explicit with routing proxies ensures that your routes behave consistently
and avoids surprising bugs when working across engines and applications.</p>

<h3>Assets</h3>

<p>Assets in a Rails engine work just like they do in a full Rails application.
Because your engine inherits from Rails::Engine, Rails will automatically look
for assets in the engine’s <code>app/assets</code> and <code>lib/assets</code> directories.</p>

<p>To avoid naming conflicts with the host application, all engine assets should be
namespaced under a subdirectory that matches the engine’s name. For example,
instead of placing a stylesheet directly at <code>app/assets/stylesheets/style.css</code>,
you should place it at <code>app/assets/stylesheets/&lt;engine_name&gt;/style.css</code>, which
would be <code>app/assets/stylesheets/blorgh/style.css</code> for the <code>blorgh</code> engine.</p>

<p>This prevents collisions with assets in the host application that may have the
same filename.</p>

<p>To include a namespaced engine asset in the host application, reference it using
its full path with the <code>stylesheet_link_tag</code> (or similar helpers):</p>

<pre class="code xml"><code class="xml">&lt;%= stylesheet_link_tag &quot;blorgh/style.css&quot; %&gt;
</code></pre>

<p>This will correctly load the stylesheet located at
<code>app/assets/stylesheets/blorgh/style.css</code> within the engine.</p>

<p>If you’re using the Asset Pipeline (Sprockets), you can also include engine
assets as dependencies within other stylesheets using a <code>require</code> directive:</p>

<pre class="code css"><code class="css">/*
 *= require blorgh/style
 */
</code></pre>

<p>This allows engine styles to be bundled into application-wide stylesheets.</p>

<p>INFO: Remember that in order to use languages like Sass or Haml, you should add
the relevant library to your engine&#39;s <code>.gemspec</code>.</p>

<h3>Separate Assets and Precompiling</h3>

<p>In some cases, your engine may include assets that are not required by the host
application. For example, suppose your engine provides an admin interface with
its own layout and styles. These assets, such as <code>admin.css</code> or <code>admin.js</code>, are
only used within the engine and don&#39;t need to be included in the host
application&#39;s asset pipeline.</p>

<p>In such situations, it doesn’t make sense for the host app to reference these
assets manually (e.g., via <code>stylesheet_link_tag &quot;blorgh/admin&quot;</code>). Instead, you
should explicitly tell Rails to precompile these assets so they’re available
when the engine is used.</p>

<p>To do this, you can add a precompilation hook in your engine&#39;s engine.rb file:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># lib/blorgh/engine.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>Engine</span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span><span class='op'>::</span><span class='const'><a href="Rails/Engine.html" title="Rails::Engine (class)">Engine</a></span>
    <span class='id identifier rubyid_isolate_namespace'>isolate_namespace</span> <span class='const'>Blorgh</span>

    <span class='id identifier rubyid_initializer'>initializer</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blorgh.assets.precompile</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_app'>app</span><span class='op'>|</span>
      <span class='id identifier rubyid_app'>app</span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_assets'>assets</span>.<span class='id identifier rubyid_precompile'>precompile</span> <span class='op'>+=</span> <span class='qwords'><span class='qwords_beg'>%w(</span><span class='words_sep'> </span><span class='tstring_content'>blorgh/admin.js</span><span class='words_sep'> </span><span class='tstring_content'>blorgh/admin.css</span><span class='words_sep'> </span><span class='tstring_end'>)</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This ensures that these engine-specific assets will be compiled when running:</p>

<pre class="code bash"><code class="bash">bin/rails assets:precompile
</code></pre>

<p>NOTE: Be sure to include the full namespaced paths (e.g. <code>blorgh/admin.css</code>) so
Sprockets can locate the correct files within your engine.</p>

<p>For more information, read the <a href="asset_pipeline.html">Asset Pipeline guide</a>.</p>

<h3>Writing Tests</h3>

<p>The <code>test/</code> directory works just like it does in a standard Rails application.
You can write unit tests, functional tests, and integration tests to ensure your
engine behaves as expected.</p>

<p>When a Rails engine is generated, it includes a minimal host application inside
the <code>test/dummy</code> directory. This &quot;dummy app&quot; is used solely for development and
testing—it simulates how your engine will behave when used in a real
application. You can extend the dummy app by adding controllers, models, or
views as needed to help you test the engine’s functionality in context.</p>

<h4>Functional and Integration Tests</h4>

<p>Since engines are not full applications, they need to be mounted into a host in
order to test things like routing and controllers. That’s where the dummy app
comes in.</p>

<p>When writing controller or integration tests, your tests need to be aware of the
engine’s routing context. Rails doesn’t automatically assume you’re using the
engine’s routes, so if you write a test like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># test/controllers/blorgh/articles_controller_test.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ArticlesControllerTest</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/IntegrationTest.html" title="ActionDispatch::IntegrationTest (class)">IntegrationTest</a></span>
    <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can get index</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_get'>get</span> <span class='id identifier rubyid_articles_path'>articles_path</span>
      <span class='id identifier rubyid_assert_response'>assert_response</span> <span class='symbeg'>:</span><span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>It might fail because <code>articles_path</code> could resolve to the dummy app (or not at
all), rather than your engine. To fix this, you must tell Rails explicitly to
use the engine&#39;s routes in your test setup:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># test/controllers/blorgh/articles_controller_test.rb
</span><span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ArticlesControllerTest</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/IntegrationTest.html" title="ActionDispatch::IntegrationTest (class)">IntegrationTest</a></span>
    <span class='id identifier rubyid_setup'>setup</span> <span class='kw'>do</span>
      <span class='ivar'>@routes</span> <span class='op'>=</span> <span class='const'>Engine</span>.<span class='id identifier rubyid_routes'>routes</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can get index</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_get'>get</span> <span class='id identifier rubyid_articles_path'>articles_path</span>
      <span class='id identifier rubyid_assert_response'>assert_response</span> <span class='symbeg'>:</span><span class='id identifier rubyid_success'>success</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This ensures the test uses the routing context defined in
<code>Blorgh::Engine.routes</code>, and that the path helpers like <code>articles_path</code> map
correctly to <code>/blog/articles</code> (since your engine is mounted at <code>/blog</code>).</p>

<p>NOTE: Even though the engine is mounted at <code>/blog</code> in the host app, you don&#39;t
need to include that prefix in test paths. Setting <code>@routes = Engine.routes</code>
scopes everything correctly for you.</p>

<p>The following test checks that the index page for articles loads successfully
and renders the expected heading.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># test/controllers/blorgh/articles_controller_test.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_helper</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ArticlesControllerTest</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/IntegrationTest.html" title="ActionDispatch::IntegrationTest (class)">IntegrationTest</a></span>
    <span class='id identifier rubyid_setup'>setup</span> <span class='kw'>do</span>
      <span class='ivar'>@routes</span> <span class='op'>=</span> <span class='const'>Engine</span>.<span class='id identifier rubyid_routes'>routes</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can get index</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_get'>get</span> <span class='id identifier rubyid_articles_path'>articles_path</span>
      <span class='id identifier rubyid_assert_response'>assert_response</span> <span class='symbeg'>:</span><span class='id identifier rubyid_success'>success</span>
      <span class='id identifier rubyid_assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>h1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Articles</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h4>Unit and Model Tests</h4>

<p>You can test your engine’s models just like in a regular Rails app:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># test/models/blorgh/article_test.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test_helper</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>module</span> <span class='const'>Blorgh</span>
  <span class='kw'>class</span> <span class='const'>ArticleTest</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TestCase.html" title="ActiveSupport::TestCase (class)">TestCase</a></span>
    <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title is required</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_article'>article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>text:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Some content</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_assert_not'>assert_not</span> <span class='id identifier rubyid_article'>article</span>.<span class='id identifier rubyid_valid?'>valid?</span>
      <span class='id identifier rubyid_assert_includes'>assert_includes</span> <span class='id identifier rubyid_article'>article</span>.<span class='id identifier rubyid_errors'>errors</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_title'>title</span>]<span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can&#39;t be blank</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h3>Gem Dependencies</h3>

<p>Gem dependencies inside an engine should be specified inside the <code>.gemspec</code> file
at the root of the engine to allow the engine to be installed as a gem.</p>

<p>NOTE: If the dependencies were to be specified inside the <code>Gemfile</code>, instead of
the <code>.gemspec</code> file, these would not be recognized by a traditional <code>gem
install</code> and so they would not be installed, causing the engine to malfunction.</p>

<p>To specify a dependency that should be installed with the engine during a <code>gem
install</code>, specify it inside the <code>Gem::Specification</code> block inside the <code>.gemspec</code>
file in the engine:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_add_dependency'>add_dependency</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>moo</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>To specify a dependency that should only be installed as a development
dependency of the application, specify it like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_add_development_dependency'>add_development_dependency</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>moo</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>Both kinds of dependencies will be installed when <code>bundle install</code> is run inside
of the application. The development dependencies for the gem will only be used
when the development and tests for the engine are running.</p>

<p>If you want to immediately require dependencies when the engine is required, you
should require them before the engine&#39;s initialization. For example, in the
<code>engine.rb</code> file :</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>other_engine/engine</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yet_another_engine/engine</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>module</span> <span class='const'>MyEngine</span>
  <span class='kw'>class</span> <span class='const'>Engine</span> <span class='op'>&lt;</span> <span class='op'>::</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span><span class='op'>::</span><span class='const'><a href="Rails/Engine.html" title="Rails::Engine (class)">Engine</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>