<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Action Pack CHANGELOG &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "action_pack_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Action Pack CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<ul>
<li><p>Make <code>event_backtrace</code> attribute in <code>rescue_from_handled.action_controller</code> notifications the full backtrace, when <code>config.action_controller.rescue_from_event_backtrace</code> is <code>:array</code>.</p>

<p>This also affects <code>action_controller.rescue_from_handled</code> events.</p>

<p><em>zzak</em></p></li>
<li><p>Avoid loading <a href="ActionController/Live.html" title="ActionController::Live (module)"><code>::ActionController::Live</code></a> early in initializer, and introduce
<code>action_controller_live</code> load hook.</p>

<p><em>Adrianna Chang</em></p></li>
<li><p>Make CSRF header-only protection compatible with local installs using HTTP</p>

<p>In local installations that don&#39;t use HTTPS and where the app is
accessed within a local network, requests won&#39;t be performed from a
secure context. In this case, the browser won&#39;t send the
<code>Sec-Fetch-Site</code> header. This means non-GET requests will be rejected
because CSRF protection will fail when using the header-only approach.</p>

<p>With this change, we allow these requests with missing <code>Sec-Fetch-Site</code>
headers if:</p>

<ul>
<li>They happen over HTTP</li>
<li>The app is not configured to force SSL</li>
</ul>

<p>The <code>Origin</code> check always happens in any case.</p>

<p><em>Rosa Gutierrez</em></p></li>
<li><p>Deprecate calling <code>protect_from_forgery</code> without specifying a strategy.</p>

<p>When <code>protect_from_forgery</code> is called without the <code>:with</code> option, it currently defaults to
<code>:null_session</code>. This is inconsistent with <code>config.action_controller.default_protect_from_forgery</code>,
which uses <code>:exception</code>.</p>

<p>A new configuration option <code>config.action_controller.default_protect_from_forgery_with</code> has been
added to allow applications to configure the default strategy. It currently defaults to <code>:null_session</code>
for backwards compatibility, but will change to <code>:exception</code> in a future version of Rails.</p>

<p>Applications can opt into the new behavior now by setting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_action_controller'>action_controller</span>.<span class='id identifier rubyid_default_protect_from_forgery_with'>default_protect_from_forgery_with</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_exception'>exception</span></code></pre>

<p>To silence the deprecation warning without changing behavior, explicitly pass the strategy:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>with:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_null_session'>null_session</span></code></pre>

<p><em>Said Kaldybaev</em></p></li>
<li><p>Add <a href="ActionDispatch/Request.html#bearer_token-instance_method" title="ActionDispatch::Request#bearer_token (method)">ActionDispatch::Request#bearer_token</a> to extract the bearer token from the Authorization header.
Bearer tokens are commonly used for API and MCP requests.</p>

<p><em>DHH</em></p></li>
<li><p>Add block support to <a href="ActionController/Parameters.html#merge-instance_method" title="ActionController::Parameters#merge (method)">ActionController::Parameters#merge</a></p>

<p><a href="ActionController/Parameters.html#merge-instance_method" title="ActionController::Parameters#merge (method)">ActionController::Parameters#merge</a> now accepts a block to resolve conflicts,
consistent with <code>Hash#merge</code> and <code>Parameters#merge!</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_params1'>params1</span> <span class='op'>=</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Parameters.html" title="ActionController::Parameters (class)">Parameters</a></span>.<span class='id identifier rubyid_new'><a href="ActionController/Parameters.html#new-class_method" title="ActionController::Parameters.new (method)">new</a></span>(<span class='label'>a:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>b:</span> <span class='int'>2</span>)
<span class='id identifier rubyid_params2'>params2</span> <span class='op'>=</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Parameters.html" title="ActionController::Parameters (class)">Parameters</a></span>.<span class='id identifier rubyid_new'><a href="ActionController/Parameters.html#new-class_method" title="ActionController::Parameters.new (method)">new</a></span>(<span class='label'>b:</span> <span class='int'>3</span><span class='comma'>,</span> <span class='label'>c:</span> <span class='int'>4</span>)
<span class='id identifier rubyid_params1'>params1</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_params2'>params2</span>) { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_old_val'>old_val</span><span class='comma'>,</span> <span class='id identifier rubyid_new_val'>new_val</span><span class='op'>|</span> <span class='id identifier rubyid_old_val'>old_val</span> <span class='op'>+</span> <span class='id identifier rubyid_new_val'>new_val</span> }
<span class='comment'># =&gt; #&lt;ActionController::Parameters {&quot;a&quot;=&gt;1, &quot;b&quot;=&gt;5, &quot;c&quot;=&gt;4} permitted: false&gt;</span></code></pre>

<p><em>Said Kaldybaev</em></p></li>
<li><p>Yield key to <a href="ActionController/Parameters.html#fetch-instance_method" title="ActionController::Parameters#fetch (method)">ActionController::Parameters#fetch</a> block</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_missing'>missing</span>) { <span class='op'>|</span><span class='id identifier rubyid_missing_key'>missing_key</span><span class='op'>|</span> <span class='id identifier rubyid_missing_key'>missing_key</span> }
<span class='id identifier rubyid_key'>key</span> <span class='comment'># =&gt; :missing
</span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>missing</span><span class='tstring_end'>&quot;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_missing_key'>missing_key</span><span class='op'>|</span> <span class='id identifier rubyid_missing_key'>missing_key</span> }
<span class='id identifier rubyid_key'>key</span> <span class='comment'># =&gt; &quot;missing&quot;</span></code></pre>

<p><em>Sean Doyle</em></p></li>
<li><p>Add <code>config.action_controller.live_streaming_excluded_keys</code> to control execution state sharing in <a href="ActionController/Live.html" title="ActionController::Live (module)"><code>::ActionController::Live</code></a>.</p>

<p>When using ActionController::Live, actions are executed in a separate thread that shares
state from the parent thread. This new configuration allows applications to opt-out specific
state keys that should not be shared.</p>

<p>This is useful when streaming inside a <code>connected_to</code> block, where you may want
the streaming thread to use its own database connection context.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/application.rb
</span><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_action_controller'>action_controller</span>.<span class='id identifier rubyid_live_streaming_excluded_keys'>live_streaming_excluded_keys</span> <span class='op'>=</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_active_record_connected_to_stack'>active_record_connected_to_stack</span>]</code></pre>

<p>By default, all keys are shared.</p>

<p><em>Eileen M. Uchitelle</em></p></li>
<li><p>Add controller action source location to routes inspector.</p>

<p>The routes inspector now shows where controller actions are defined.
In <code>rails routes --expanded</code>, a new &quot;Action Location&quot; field displays
the file and line number of each action method.</p>

<p>On the routing error page, when <code>RAILS_EDITOR</code> or <code>EDITOR</code> is set,
a clickable ✏️ icon appears next to each Controller#Action that opens
the action directly in the editor.</p>

<p><em>Guillermo Iguaran</em></p></li>
<li><p>Active Support notifications for CSRF warnings.</p>

<p>Switches from direct logging to event-driven logging, allowing others to
subscribe to and act on CSRF events:</p>

<ul>
<li><code>csrf_token_fallback.action_controller</code></li>
<li><code>csrf_request_blocked.action_controller</code></li>
<li><code>csrf_javascript_blocked.action_controller</code></li>
</ul>

<p><em>Jeremy Daer</em></p></li>
<li><p>Modern header-based CSRF protection.</p>

<p>Modern browsers send the <code>Sec-Fetch-Site</code> header to indicate the relationship
between request initiator and target origins. Rails now uses this header to
verify same-origin requests without requiring authenticity tokens.</p>

<p>Two verification strategies are available via <code>protect_from_forgery using:</code>:</p>

<ul>
<li><code>:header_only</code> - Uses <code>Sec-Fetch-Site</code> header only. Rejects requests
without a valid header. Default for new Rails 8.2 applications.</li>
<li><code>:header_or_legacy_token</code> - Uses <code>Sec-Fetch-Site</code> header when present,
falls back to authenticity token verification for older browsers.</li>
</ul>

<p>Configure trusted origins for legitimate cross-site requests (OAuth callbacks,
third-party embeds) with <code>trusted_origins:</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>trusted_origins:</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='words_sep'> </span><span class='tstring_content'>https://accounts.google.com</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span></code></pre>

<p><code>InvalidAuthenticityToken</code> is deprecated in favor of <code>InvalidCrossOriginRequest</code>.</p>

<p><em>Rosa Gutierrez</em></p></li>
<li><p>Fix <code>action_dispatch_request</code> early load hook call when building
Rails app middleware.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Emit a structured event when <code>action_on_open_redirect</code> is set to <code>:notify</code>
in addition to the existing Active Support Notification.</p>

<p><em>Adrianna Chang</em>, <em>Hartley McGuire</em></p></li>
<li><p>Support <code>text/markdown</code> format in <code>DebugExceptions</code> middleware.</p>

<p>When <code>text/markdown</code> is requested via the Accept header, error responses
are returned with <code>Content-Type: text/markdown</code> instead of HTML.
The existing text templates are reused for markdown output, allowing
CLI tools and other clients to receive byte-efficient error information.</p>

<p><em>Guillermo Iguaran</em></p></li>
<li><p>Support dynamic <code>to:</code> and <code>within:</code> options in <code>rate_limit</code>.</p>

<p>The <code>to:</code> and <code>within:</code> options now accept callables (lambdas or procs) and
method names (as symbols), in addition to static values. This allows for
dynamic rate limiting based on user attributes or other runtime conditions.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>APIController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_rate_limit'>rate_limit</span> <span class='label'>to:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_requests'>max_requests</span><span class='comma'>,</span> <span class='label'>within:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_time_window'>time_window</span><span class='comma'>,</span> <span class='label'>by:</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_current_user'>current_user</span>.<span class='id identifier rubyid_id'>id</span> }

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_max_requests'>max_requests</span>
      <span class='id identifier rubyid_current_user'>current_user</span>.<span class='id identifier rubyid_premium?'>premium?</span> <span class='op'>?</span> <span class='int'>1000</span> <span class='op'>:</span> <span class='int'>100</span>
    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_time_window'>time_window</span>
      <span class='id identifier rubyid_current_user'>current_user</span>.<span class='id identifier rubyid_premium?'>premium?</span> <span class='op'>?</span> <span class='int'>1</span>.<span class='id identifier rubyid_hour'>hour</span> <span class='op'>:</span> <span class='int'>1</span>.<span class='id identifier rubyid_minute'>minute</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Murilo Duarte</em></p></li>
<li><p>Define <a href="ActionController/Parameters.html#deconstruct_keys-instance_method" title="ActionController::Parameters#deconstruct_keys (method)">ActionController::Parameters#deconstruct_keys</a> to support pattern matching</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span> <span class='kw'>in</span> { <span class='label'>search:</span><span class='comma'>,</span> <span class='label'>page:</span> }
  <span class='const'>Article</span>.<span class='id identifier rubyid_search'>search</span>(<span class='id identifier rubyid_search'>search</span>).<span class='id identifier rubyid_limit'>limit</span>(<span class='id identifier rubyid_page'>page</span>)
<span class='kw'>else</span>
  <span class='id identifier rubyid_…'>…</span>
<span class='kw'>end</span>

<span class='kw'>case</span> (<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_string_or_hash_with_nested_key'>string_or_hash_with_nested_key</span>])
<span class='kw'>in</span> <span class='const'><a href="String.html" title="String (class)">String</a></span>
  <span class='comment'># do something with a String `value`…
</span><span class='kw'>in</span> { <span class='label'>nested_key:</span> }
  <span class='comment'># do something with `nested_key` or `value`
</span><span class='kw'>else</span>
  <span class='comment'># …
</span><span class='kw'>end</span></code></pre>

<p><em>Sean Doyle</em></p></li>
<li><p>Submit test requests using <code>as: :html</code> with <code>Content-Type: x-www-form-urlencoded</code></p>

<p><em>Sean Doyle</em></p></li>
<li><p>Add <code>svg:</code> renderer:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Page</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_to_svg'>to_svg</span>
    <span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>PagesController</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@page</span> <span class='op'>=</span> <span class='const'>Page</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='id identifier rubyid_format'>format</span>.<span class='id identifier rubyid_html'>html</span>
      <span class='id identifier rubyid_format'>format</span>.<span class='id identifier rubyid_svg'>svg</span> { <span class='id identifier rubyid_render'>render</span> <span class='label'>svg:</span> <span class='ivar'>@page</span> }
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Thiago Youssef</em></p></li>
</ul>

<p>Please check [8-1-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>