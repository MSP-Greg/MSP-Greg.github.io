<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Action Pack CHANGELOG &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "action_pack_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Action Pack CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<ul>
<li><p>Add link-local IP ranges to <a href="ActionDispatch/RemoteIp.html" title="ActionDispatch::RemoteIp (class)"><code>::ActionDispatch::RemoteIp</code></a> default proxies.</p>

<p>Link-local addresses (<code>169.254.0.0/16</code> for IPv4 and <code>fe80::/10</code> for IPv6)
are now included in the default trusted proxy list, similar to private IP ranges.</p>

<p><em>Adam Daniels</em></p></li>
<li><p><code>remote_ip</code> will no longer ignore IPs in X-Forwarded-For headers if they
are accompanied by port information.</p>

<p><em>Duncan Brown</em>, <em>Prevenios Marinos</em>, <em>Masafumi Koba</em>, <em>Adam Daniels</em></p></li>
<li><p>Add <code>action_dispatch.verbose_redirect_logs</code> setting that logs where redirects were called from.</p>

<p>Similar to <code>active_record.verbose_query_logs</code> and <code>active_job.verbose_enqueue_logs</code>, this adds a line in your logs that shows where a redirect was called from.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Redirected</span> <span class='id identifier rubyid_to'>to</span> <span class='label'>http:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/localhost</span></span><span class='op'>:</span><span class='int'>3000</span><span class='op'>/</span><span class='id identifier rubyid_posts'>posts</span><span class='op'>/</span><span class='int'>1</span>
<span class='id identifier rubyid_↳'>↳</span> <span class='id identifier rubyid_app'>app</span><span class='op'>/</span><span class='id identifier rubyid_controllers'>controllers</span><span class='op'>/</span><span class='id identifier rubyid_posts_controller'>posts_controller</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>32</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>block (2 levels) in create&#39;</span></code></pre>

<p><em>Dennis Paagman</em></p></li>
<li><p>Add engine route filtering and better formatting in <code>bin/rails routes</code>.</p>

<p>Allow engine routes to be filterable in the routing inspector, and
improve formatting of engine routing output.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>&gt;</span> <span class='id identifier rubyid_bin'>bin</span><span class='op'>/</span><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_routes'>routes</span> <span class='op'>-</span><span class='id identifier rubyid_e'>e</span> <span class='id identifier rubyid_engine_only'>engine_only</span>
<span class='const'>No</span> <span class='id identifier rubyid_routes'>routes</span> <span class='id identifier rubyid_were'>were</span> <span class='id identifier rubyid_found'>found</span> <span class='kw'>for</span> <span class='id identifier rubyid_this'>this</span> <span class='id identifier rubyid_grep'>grep</span> <span class='id identifier rubyid_pattern'>pattern</span>.
<span class='const'>For</span> <span class='id identifier rubyid_more'>more</span> <span class='id identifier rubyid_information'>information</span> <span class='id identifier rubyid_about'>about</span> <span class='id identifier rubyid_routes'>routes</span><span class='comma'>,</span> <span class='id identifier rubyid_see'>see</span> <span class='id identifier rubyid_the'>the</span> <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span> <span class='label'>guide:</span> <span class='label'>https:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/guides</span></span>.<span class='id identifier rubyid_rubyonrails'>rubyonrails</span>.<span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_routing'>routing</span>.<span class='id identifier rubyid_html'>html</span>.</code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>&gt;</span> <span class='id identifier rubyid_bin'>bin</span><span class='op'>/</span><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_routes'>routes</span> <span class='op'>-</span><span class='id identifier rubyid_e'>e</span> <span class='id identifier rubyid_engine_only'>engine_only</span>
<span class='const'>Routes</span> <span class='kw'>for</span> <span class='id identifier rubyid_application'>application</span><span class='op'>:</span>
<span class='const'>No</span> <span class='id identifier rubyid_routes'>routes</span> <span class='id identifier rubyid_were'>were</span> <span class='id identifier rubyid_found'>found</span> <span class='kw'>for</span> <span class='id identifier rubyid_this'>this</span> <span class='id identifier rubyid_grep'>grep</span> <span class='id identifier rubyid_pattern'>pattern</span>.
<span class='const'>For</span> <span class='id identifier rubyid_more'>more</span> <span class='id identifier rubyid_information'>information</span> <span class='id identifier rubyid_about'>about</span> <span class='id identifier rubyid_routes'>routes</span><span class='comma'>,</span> <span class='id identifier rubyid_see'>see</span> <span class='id identifier rubyid_the'>the</span> <span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span> <span class='label'>guide:</span> <span class='label'>https:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/guides</span></span>.<span class='id identifier rubyid_rubyonrails'>rubyonrails</span>.<span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_routing'>routing</span>.<span class='id identifier rubyid_html'>html</span>.

<span class='const'>Routes</span> <span class='kw'>for</span> <span class='const'>Test</span><span class='op'>::</span><span class='const'>Engine</span><span class='op'>:</span>
<span class='const'>Prefix</span> <span class='const'>Verb</span> <span class='const'>URI</span> <span class='const'>Pattern</span>       <span class='const'>Controller</span><span class='comment'>#Action
</span><span class='id identifier rubyid_engine'>engine</span> <span class='const'>GET</span>  <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>engine_only(.:format) a#b</span></code></pre>

<p><em>Dennis Paagman</em>, <em>Gannon McGibbon</em></p></li>
<li><p>Add structured events for Action Pack and Action Dispatch:</p>

<ul>
<li><code>action_dispatch.redirect</code></li>
<li><code>action_controller.request_started</code></li>
<li><code>action_controller.request_completed</code></li>
<li><code>action_controller.callback_halted</code></li>
<li><code>action_controller.rescue_from_handled</code></li>
<li><code>action_controller.file_sent</code></li>
<li><code>action_controller.redirected</code></li>
<li><code>action_controller.data_sent</code></li>
<li><code>action_controller.unpermitted_parameters</code></li>
<li><code>action_controller.fragment_cache</code></li>
</ul>

<p><em>Adrianna Chang</em></p></li>
<li><p>URL helpers for engines mounted at the application root handle <code>SCRIPT_NAME</code> correctly.</p>

<p>Fixed an issue where <code>SCRIPT_NAME</code> is not applied to paths generated for routes in an engine
mounted at &quot;/&quot;.</p>

<p><em>Mike Dalessio</em></p></li>
<li><p>Update <code>ActionController::Metal::RateLimiting</code> to support passing method names to <code>:by</code> and <code>:with</code></p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>SignupsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_rate_limit'>rate_limit</span> <span class='label'>to:</span> <span class='int'>10</span><span class='comma'>,</span> <span class='label'>within:</span> <span class='int'>1</span>.<span class='id identifier rubyid_minute'>minute</span><span class='comma'>,</span> <span class='label'>with:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redirect_with_flash'>redirect_with_flash</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_redirect_with_flash'>redirect_with_flash</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_url'>root_url</span><span class='comma'>,</span> <span class='label'>alert:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many requests!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Sean Doyle</em></p></li>
<li><p>Optimize <a href="ActionDispatch/Http/URL.html#build_host_url-class_method" title="ActionDispatch::Http::URL.build_host_url (method)">ActionDispatch::Http::URL.build_host_url</a> when protocol is included in host.</p>

<p>When using URL helpers with a host that includes the protocol (e.g., <code>{ host: &quot;https://example.com&quot; }</code>),
skip unnecessary protocol normalization and string duplication since the extracted protocol is already
in the correct format. This eliminates 2 string allocations per URL generation and provides a ~10%
performance improvement for this case.</p>

<p><em>Joshua Young</em>, <em>Hartley McGuire</em></p></li>
<li><p>Allow <code>action_controller.logger</code> to be disabled by setting it to <code>nil</code> or <code>false</code> instead of always defaulting to <a href="Rails.html#logger-class_method" title="Rails.logger (method)">Rails.logger</a>.</p>

<p><em>Roberto Miranda</em></p></li>
</ul>

<h2>Rails 8.1.0.beta1 (September 04, 2025)</h2>

<ul>
<li><p>Remove deprecated support to a route to multiple paths.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support for using semicolons as a query string separator.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/QueryParser.html" title="ActionDispatch::QueryParser (class)">QueryParser</a></span>.<span class='id identifier rubyid_each_pair'><a href="ActionDispatch/QueryParser.html#each_pair-class_method" title="ActionDispatch::QueryParser.each_pair (method)">each_pair</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo=bar;baz=quux</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_to_a'>to_a</span>
<span class='comment'># =&gt; [[&quot;foo&quot;, &quot;bar&quot;], [&quot;baz&quot;, &quot;quux&quot;]]</span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/QueryParser.html" title="ActionDispatch::QueryParser (class)">QueryParser</a></span>.<span class='id identifier rubyid_each_pair'><a href="ActionDispatch/QueryParser.html#each_pair-class_method" title="ActionDispatch::QueryParser.each_pair (method)">each_pair</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo=bar;baz=quux</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_to_a'>to_a</span>
<span class='comment'># =&gt; [[&quot;foo&quot;, &quot;bar;baz=quux&quot;]]</span></code></pre>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated support to skipping over leading brackets in parameter names in the parameter parser.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/ParamBuilder.html" title="ActionDispatch::ParamBuilder (class)">ParamBuilder</a></span>.<span class='id identifier rubyid_from_query_string'><a href="ActionDispatch/ParamBuilder.html#from_query_string-instance_method" title="ActionDispatch::ParamBuilder#from_query_string (method)">from_query_string</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[foo]=bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; { &quot;foo&quot; =&gt; &quot;bar&quot; }
</span><span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/ParamBuilder.html" title="ActionDispatch::ParamBuilder (class)">ParamBuilder</a></span>.<span class='id identifier rubyid_from_query_string'><a href="ActionDispatch/ParamBuilder.html#from_query_string-instance_method" title="ActionDispatch::ParamBuilder#from_query_string (method)">from_query_string</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[foo][bar]=baz</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; { &quot;foo&quot; =&gt; { &quot;bar&quot; =&gt; &quot;baz&quot; } }</span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/ParamBuilder.html" title="ActionDispatch::ParamBuilder (class)">ParamBuilder</a></span>.<span class='id identifier rubyid_from_query_string'><a href="ActionDispatch/ParamBuilder.html#from_query_string-instance_method" title="ActionDispatch::ParamBuilder#from_query_string (method)">from_query_string</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[foo]=bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; { &quot;[foo]&quot; =&gt; &quot;bar&quot; }
</span><span class='const'><a href="ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span><span class='op'>::</span><span class='const'><a href="ActionDispatch/ParamBuilder.html" title="ActionDispatch::ParamBuilder (class)">ParamBuilder</a></span>.<span class='id identifier rubyid_from_query_string'><a href="ActionDispatch/ParamBuilder.html#from_query_string-instance_method" title="ActionDispatch::ParamBuilder#from_query_string (method)">from_query_string</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[foo][bar]=baz</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; { &quot;[foo]&quot; =&gt; { &quot;bar&quot; =&gt; &quot;baz&quot; } }</span></code></pre>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>Rails.application.config.action_dispatch.ignore_leading_brackets</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Raise <a href="ActionController/TooManyRequests.html" title="ActionController::TooManyRequests (class)"><code>::ActionController::TooManyRequests</code></a> error from <a href="ActionController/RateLimiting.html" title="ActionController::RateLimiting (module)"><code>::ActionController::RateLimiting</code></a></p>

<p>Requests that exceed the rate limit raise an <a href="ActionController/TooManyRequests.html" title="ActionController::TooManyRequests (class)"><code>::ActionController::TooManyRequests</code></a> error.
By default, Action Dispatch rescues the error and responds with a <code>429 Too Many Requests</code> status.</p>

<p><em>Sean Doyle</em></p></li>
<li><p>Add .md/.markdown as Markdown extensions and add a default <code>markdown:</code> renderer:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Page</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_to_markdown'>to_markdown</span>
    <span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>PagesController</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@page</span> <span class='op'>=</span> <span class='const'>Page</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='id identifier rubyid_format'>format</span>.<span class='id identifier rubyid_html'>html</span>
      <span class='id identifier rubyid_format'>format</span>.<span class='id identifier rubyid_md'>md</span> { <span class='id identifier rubyid_render'>render</span> <span class='label'>markdown:</span> <span class='ivar'>@page</span> }
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>DHH</em></p></li>
<li><p>Add headers to engine routes inspection command</p>

<p><em>Petrik de Heus</em></p></li>
<li><p>Add &quot;Copy as text&quot; button to error pages</p>

<p><em>Mikkel Malmberg</em></p></li>
<li><p>Add <code>scope:</code> option to <code>rate_limit</code> method.</p>

<p>Previously, it was not possible to share a rate limit count between several controllers, since the count was by
default separate for each controller.</p>

<p>Now, the <code>scope:</code> option solves this problem.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>APIController</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/API.html" title="ActionController::API (class)">API</a></span>
  <span class='id identifier rubyid_rate_limit'>rate_limit</span> <span class='label'>to:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>within:</span> <span class='int'>2</span>.<span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>api</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>API</span><span class='op'>::</span><span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>APIController</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>API</span><span class='op'>::</span><span class='const'>UsersController</span> <span class='op'>&lt;</span> <span class='const'>APIController</span>
  <span class='comment'># ...
</span><span class='kw'>end</span></code></pre>

<p><em>ArthurPV</em>, <em>Kamil Hanus</em></p></li>
<li><p>Add support for <code>rack.response_finished</code> callbacks in <a href="ActionDispatch/Executor.html" title="ActionDispatch::Executor (class)"><code>::ActionDispatch::Executor</code></a>.</p>

<p>The executor middleware now supports deferring completion callbacks to later
in the request lifecycle by utilizing Rack&#39;s <code>rack.response_finished</code> mechanism,
when available. This enables applications to define <code>rack.response_finished</code> callbacks
that may rely on state that would be cleaned up by the executor&#39;s completion callbacks.</p>

<p><em>Adrianna Chang</em>, <em>Hartley McGuire</em></p></li>
<li><p>Produce a log when <code>rescue_from</code> is invoked.</p>

<p><em>Steven Webb</em>, <em>Jean Boussier</em></p></li>
<li><p>Allow hosts redirects from <code>hosts</code> <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> configuration</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_action_controller'>action_controller</span>.<span class='id identifier rubyid_allowed_redirect_hosts'>allowed_redirect_hosts</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>example.com</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><em>Kevin Robatel</em></p></li>
<li><p><code>rate_limit.action_controller</code> notification has additional payload</p>

<p>additional values: count, to, within, by, name, cache_key</p>

<p><em>Jonathan Rochkind</em></p></li>
<li><p>Add JSON support to the built-in health controller.</p>

<p>The health controller now responds to JSON requests with a structured response
containing status and timestamp information. This makes it easier for monitoring
tools and load balancers to consume health check data programmatically.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># /up.json
</span>{
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>status</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>up</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timestamp</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2025-09-19T12:00:00Z</span><span class='tstring_end'>&quot;</span></span>
}</code></pre>

<p><em>Francesco Loreti</em>, <em>Juan Vásquez</em></p></li>
<li><p>Allow to open source file with a crash from the browser.</p>

<p><em>Igor Kasyanchuk</em></p></li>
<li><p>Always check query string keys for valid encoding just like values are checked.</p>

<p><em>Casper Smits</em></p></li>
<li><p>Always return empty body for HEAD requests in <code>PublicExceptions</code> and
<code>DebugExceptions</code>.</p>

<p>This is required by <code>Rack::Lint</code> (per RFC9110).</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Add comprehensive support for HTTP Cache-Control request directives according to RFC 9111.</p>

<p>Provides a <code>request.cache_control_directives</code> object that gives access to request cache directives:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Boolean directives
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_only_if_cached?'>only_if_cached?</span>  <span class='comment'># =&gt; true/false
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_no_cache?'>no_cache?</span>        <span class='comment'># =&gt; true/false
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_no_store?'>no_store?</span>        <span class='comment'># =&gt; true/false
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_no_transform?'>no_transform?</span>    <span class='comment'># =&gt; true/false
</span>
<span class='comment'># Value directives
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_max_age'>max_age</span>          <span class='comment'># =&gt; integer or nil
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_max_stale'>max_stale</span>        <span class='comment'># =&gt; integer or nil (or true for valueless max-stale)
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_min_fresh'>min_fresh</span>        <span class='comment'># =&gt; integer or nil
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_stale_if_error'>stale_if_error</span>   <span class='comment'># =&gt; integer or nil
</span>
<span class='comment'># Special helpers for max-stale
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_max_stale?'>max_stale?</span>         <span class='comment'># =&gt; true if max-stale present (with or without value)
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_max_stale_unlimited?'>max_stale_unlimited?</span> <span class='comment'># =&gt; true only for valueless max-stale</span></code></pre>

<p>Example usage:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cache_control_directives'>cache_control_directives</span>.<span class='id identifier rubyid_only_if_cached?'>only_if_cached?</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find_cached'>find_cached</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
    <span class='kw'>return</span> <span class='id identifier rubyid_head'>head</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_gateway_timeout'>gateway_timeout</span>) <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>else</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='kw'>end</span>

  <span class='id identifier rubyid_render'>render</span> <span class='symbeg'>:</span><span class='id identifier rubyid_show'>show</span>
<span class='kw'>end</span></code></pre>

<p><em>egg528</em></p></li>
<li><p>Add assert_in_body/assert_not_in_body as the simplest way to check if a piece of text is in the response body.</p>

<p><em>DHH</em></p></li>
<li><p>Include cookie name when calculating maximum allowed size.</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Implement <code>must-understand</code> directive according to RFC 9111.</p>

<p>The <code>must-understand</code> directive indicates that a cache must understand the semantics of the response status code, or discard the response. This directive is enforced to be used only with <code>no-store</code> to ensure proper cache behavior.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ArticlesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
    <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

    <span class='kw'>if</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_special_format?'>special_format?</span>
      <span class='id identifier rubyid_must_understand'>must_understand</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>status:</span> <span class='int'>203</span> <span class='comment'># Non-Authoritative Information
</span>    <span class='kw'>else</span>
      <span class='id identifier rubyid_fresh_when'>fresh_when</span> <span class='ivar'>@article</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>heka1024</em></p></li>
<li><p>The JSON renderer doesn&#39;t escape HTML entities or Unicode line separators anymore.</p>

<p>Using <code>render json:</code> will no longer escape <code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, <code>U+2028</code> and <code>U+2029</code> characters that can cause errors
when the resulting JSON is embedded in JavaScript, or vulnerabilities when the resulting JSON is embedded in HTML.</p>

<p>Since the renderer is used to return a JSON document as <code>application/json</code>, it&#39;s typically not necessary to escape
those characters, and it improves performance.</p>

<p>Escaping will still occur when the <code>:callback</code> option is set, since the JSON is used as JavaScript code in this
situation (JSONP).</p>

<p>You can use the <code>:escape</code> option or set <code>config.action_controller.escape_json_responses</code> to <code>true</code> to restore the
escaping behavior.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='const'>Post</span>.<span class='id identifier rubyid_last'>last</span>(<span class='int'>30</span>)<span class='comma'>,</span> <span class='label'>escape:</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Étienne Barrié</em>, <em>Jean Boussier</em></p></li>
<li><p>Load lazy route sets before inserting test routes</p>

<p>Without loading lazy route sets early, we miss <code>after_routes_loaded</code> callbacks, or risk
invoking them with the test routes instead of the real ones if another load is triggered by an engine.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Raise <a href="AbstractController/DoubleRenderError.html" title="AbstractController::DoubleRenderError (class)"><code>::AbstractController::DoubleRenderError</code></a> if <code>head</code> is called after rendering.</p>

<p>After this change, invoking <code>head</code> will lead to an error if response body is already set:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>PostController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>locals:</span> {}
    <span class='id identifier rubyid_head'>head</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ok'>ok</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Iaroslav Kurbatov</em></p></li>
<li><p>The Cookie Serializer can now serialize an Active Support SafeBuffer when using message pack.</p>

<p>Such code would previously produce an error if an application was using messagepack as its cookie serializer.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>PostController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='id identifier rubyid_flash'>flash</span>.<span class='id identifier rubyid_notice'>notice</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_hello_html'>hello_html</span>) <span class='comment'># This would try to serialize a SafeBuffer, which was not possible.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Edouard Chin</em></p></li>
<li><p>Fix <code>Rails.application.reload_routes!</code> from clearing almost all routes.</p>

<p>When calling <code>Rails.application.reload_routes!</code> inside a middleware of
a Rake task, it was possible under certain conditions that all routes would be cleared.
If ran inside a middleware, this would result in getting a 404 on most page you visit.
This issue was only happening in development.</p>

<p><em>Edouard Chin</em></p></li>
<li><p>Add resource name to the <code>ArgumentError</code> that&#39;s raised when invalid <code>:only</code> or <code>:except</code> options are given to <code>#resource</code> or <code>#resources</code></p>

<p>This makes it easier to locate the source of the problem, especially for routes drawn by gems.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='symbeg'>:</span><span class='id identifier rubyid_only'>only</span> <span class='kw'>and</span> <span class='symbeg'>:</span><span class='id identifier rubyid_except'>except</span> <span class='id identifier rubyid_must'>must</span> <span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_only'>only</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_show'>show</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'>update</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_edit'>edit</span>]<span class='comma'>,</span> <span class='id identifier rubyid_but'>but</span> <span class='id identifier rubyid_also'>also</span> <span class='id identifier rubyid_included'>included</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_bar'>bar</span>]</code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Route</span> <span class='backtick'>`</span><span class='tstring_content'>resources :products</span><span class='tstring_end'>`</span></span> <span class='op'>-</span> <span class='symbeg'>:</span><span class='id identifier rubyid_only'>only</span> <span class='kw'>and</span> <span class='symbeg'>:</span><span class='id identifier rubyid_except'>except</span> <span class='id identifier rubyid_must'>must</span> <span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_only'>only</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_show'>show</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'>update</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_edit'>edit</span>]<span class='comma'>,</span> <span class='id identifier rubyid_but'>but</span> <span class='id identifier rubyid_also'>also</span> <span class='id identifier rubyid_included'>included</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_bar'>bar</span>]</code></pre>

<p><em>Jeremy Green</em></p></li>
<li><p>A route pointing to a non-existing controller now returns a 500 instead of a 404.</p>

<p>A controller not existing isn&#39;t a routing error that should result
in a 404, but a programming error that should result in a 500 and
be reported.</p>

<p>Until recently, this was hard to untangle because of the support
for dynamic <code>:controller</code> segment in routes, but since this is
deprecated and will be removed in Rails 8.1, we can now easily
not consider missing controllers as routing errors.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Add <code>check_collisions</code> option to <a href="ActionDispatch/Session/CacheStore.html" title="ActionDispatch::Session::CacheStore (class)"><code>::ActionDispatch::Session::CacheStore</code></a>.</p>

<p>Newly generated session ids use 128 bits of randomness, which is more than
enough to ensure collisions can&#39;t happen, but if you need to harden sessions
even more, you can enable this option to check in the session store that the id
is indeed free you can enable that option. This however incurs an extra write
on session creation.</p>

<p><em>Shia</em></p></li>
<li><p>In ExceptionWrapper, match backtrace lines with built templates more often,
allowing improved highlighting of errors within do-end blocks in templates.
Fix for Ruby 3.4 to match new method labels in backtrace.</p>

<p><em>Martin Emde</em></p></li>
<li><p>Allow setting content type with a symbol of the <a href="Mime.html" title="Mime (module)"><code>Mime</code></a> type.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_content_type'>content_type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/html</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># After
</span><span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_content_type'>content_type</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_html'>html</span></code></pre>

<p><em>Petrik de Heus</em></p></li>
</ul>

<p>Please check [8-0-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>