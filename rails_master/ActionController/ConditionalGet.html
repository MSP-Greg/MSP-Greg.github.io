<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::ConditionalGet &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionController::ConditionalGet",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ConditionalGet&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionController::ConditionalGet</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="ConditionalGet/ClassMethods.html" title="ActionController::ConditionalGet::ClassMethods (module)"><code>ClassMethods</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="API.html" title="ActionController::API (class)"><code>API</code></a>,
          <a href="Base.html" title="ActionController::Base (class)"><code>Base</code></a>,
          <a href="EtagWithFlash.html" title="ActionController::EtagWithFlash (module)"><code>EtagWithFlash</code></a>,
          <a href="EtagWithTemplateDigest.html" title="ActionController::EtagWithTemplateDigest (module)"><code>EtagWithTemplateDigest</code></a>,
          <a href="../ActionView/TestCase/TestController.html" title="ActionView::TestCase::TestController (class)"><code>::ActionView::TestCase::TestController</code></a>,
          <a class='nodoc' href="../Rails/ApplicationController.html" title="Rails::ApplicationController (class)"><code>::Rails::ApplicationController</code></a>,
          <a href="../Rails/HealthController.html" title="Rails::HealthController (class)"><code>::Rails::HealthController</code></a>,
          <a class='nodoc' href="../Rails/InfoController.html" title="Rails::InfoController (class)"><code>::Rails::InfoController</code></a>,
          <a class='nodoc' href="../Rails/MailersController.html" title="Rails::MailersController (class)"><code>::Rails::MailersController</code></a>,
          <a class='nodoc' href="../Rails/PwaController.html" title="Rails::PwaController (class)"><code>::Rails::PwaController</code></a>,
          <a class='nodoc' href="../Rails/WelcomeController.html" title="Rails::WelcomeController (class)"><code>::Rails::WelcomeController</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Head.html" title="ActionController::Head (module)"><code>Head</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L9'>actionpack/lib/action_controller/metal/conditional_get.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#prepend_features-instance_method" title="ActiveSupport::Concern#prepend_features (method)">prepend_features</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#expires_in-instance_method" title="#expires_in (instance method)">#<strong>expires_in</strong>(seconds, options = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the <code>Cache-Control</code> header, overwriting existing directives.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#expires_now-instance_method" title="#expires_now (instance method)">#<strong>expires_now</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets an HTTP 1.1 <code>Cache-Control</code> header of <code>no-cache</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fresh_when-instance_method" title="#fresh_when (instance method)">#<strong>fresh_when</strong>(object = nil, etag: nil, weak_etag: nil, strong_etag: nil, last_modified: nil, public: false, cache_control: {}, template: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the <code>etag</code>, <code>last_modified</code>, or both on the response, and renders a ‘304 Not Modified` response if the request is already fresh.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#http_cache_forever-instance_method" title="#http_cache_forever (instance method)">#<strong>http_cache_forever</strong>(public: false)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cache or yield the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#no_store-instance_method" title="#no_store (instance method)">#<strong>no_store</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets an HTTP 1.1 <code>Cache-Control</code> header of <code>no-store</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stale%3F-instance_method" title="#stale? (instance method)">#<strong>stale?</strong>(object = nil, **freshness_kwargs)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the <code>etag</code> and/or <code>last_modified</code> on the response and checks them against the request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#combine_etags-instance_method" title="#combine_etags (instance method)">#<strong>combine_etags</strong>(validator, options)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="Head.html" title="ActionController::Head (module)"><code>Head</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Head.html#head-instance_method" title="ActionController::Head#head (method)">#head</a></td>
      <td><div class='inline'><p>Returns a response that has no content (merely headers).</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Head.html#include_content%3F-instance_method" title="ActionController::Head#include_content? (method)">#include_content?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L14-L16'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


14
15
16</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 14</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_etaggers'>etaggers</span><span class='comma'>,</span> <span class='label'>default:</span> []
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="combine_etags-instance_method">
  <h3 class='signature priv first'>
    #<strong>combine_etags</strong>(validator, options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L325-L327'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='325' data-end='327'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 325</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_combine_etags'>combine_etags</span>(<span class='id identifier rubyid_validator'>validator</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
  [<span class='id identifier rubyid_validator'>validator</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_etaggers'>etaggers</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_etagger'>etagger</span><span class='op'>|</span> <span class='id identifier rubyid_instance_exec'>instance_exec</span>(<span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_etagger'>etagger</span>) }].<span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="expires_in-instance_method">
  <h3 class='signature '>
    #<strong>expires_in</strong>(seconds, options = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the <code>Cache-Control</code> header, overwriting existing directives. This method will also ensure an HTTP <a href="../Date.html" title="Date (class)"><code>::Date</code></a> header for client compatibility.</p>

<p>Defaults to issuing the <code>private</code> directive, so that intermediate caches must not cache the response.</p>

<p>#### Options</p>

<p><code>:public</code> :   If true, replaces the default <code>private</code> directive with the <code>public</code></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_directive'>directive</span>.</code></pre>

<p><code>:must_revalidate</code> :   If true, adds the <code>must-revalidate</code> directive. <code>:stale_while_revalidate</code> :   Sets the value of the <code>stale-while-revalidate</code> directive. <code>:stale_if_error</code> :   Sets the value of the <code>stale-if-error</code> directive.</p>

<p>Any additional key-value pairs are concatenated as directives. For a list of supported <code>Cache-Control</code> directives, see the [article on MDN](<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control</a>).</p>

<p>#### Examples</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>10</span>.<span class='id identifier rubyid_minutes'>minutes</span>
<span class='comment'># =&gt; Cache-Control: max-age=600, private
</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>10</span>.<span class='id identifier rubyid_minutes'>minutes</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span>
<span class='comment'># =&gt; Cache-Control: max-age=600, public
</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>10</span>.<span class='id identifier rubyid_minutes'>minutes</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>must_revalidate:</span> <span class='kw'>true</span>
<span class='comment'># =&gt; Cache-Control: max-age=600, public, must-revalidate
</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>1</span>.<span class='id identifier rubyid_hour'>hour</span><span class='comma'>,</span> <span class='label'>stale_while_revalidate:</span> <span class='int'>60</span>.<span class='id identifier rubyid_seconds'>seconds</span>
<span class='comment'># =&gt; Cache-Control: max-age=3600, private, stale-while-revalidate=60
</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>1</span>.<span class='id identifier rubyid_hour'>hour</span><span class='comma'>,</span> <span class='label'>stale_if_error:</span> <span class='int'>5</span>.<span class='id identifier rubyid_minutes'>minutes</span>
<span class='comment'># =&gt; Cache-Control: max-age=3600, private, stale-if-error=300
</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>1</span>.<span class='id identifier rubyid_hour'>hour</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s-maxage</span><span class='label_end'>&quot;:</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no-transform</span><span class='label_end'>&quot;:</span> <span class='kw'>true</span>
<span class='comment'># =&gt; Cache-Control: max-age=3600, public, s-maxage=10800, no-transform=true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L279-L292'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='279' data-end='292'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 279</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expires_in'>expires_in</span>(<span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_no_store'><a href="#no_store-instance_method" title="ActionController::ConditionalGet#no_store (method)">no_store</a></span>)
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_merge!'>merge!</span>(
    <span class='label'>max_age:</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span>
    <span class='label'>public:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span>)<span class='comma'>,</span>
    <span class='label'>must_revalidate:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_must_revalidate'>must_revalidate</span>)<span class='comma'>,</span>
    <span class='label'>stale_while_revalidate:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stale_while_revalidate'>stale_while_revalidate</span>)<span class='comma'>,</span>
    <span class='label'>stale_if_error:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stale_if_error'>stale_if_error</span>)<span class='comma'>,</span>
  )
  <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_private'>private</span>)

  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_extras'>extras</span>] <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_date'>date</span> <span class='op'>=</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span> <span class='kw'>unless</span> <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_date?'>date?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="expires_now-instance_method">
  <h3 class='signature '>
    #<strong>expires_now</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets an HTTP 1.1 <code>Cache-Control</code> header of <code>no-cache</code>. This means the resource will be marked as stale, so clients must always revalidate. Intermediate/browser caches may still store the asset.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L297-L299'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='297' data-end='299'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 297</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expires_now'>expires_now</span>
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_replace'>replace</span>(<span class='label'>no_cache:</span> <span class='kw'>true</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fresh_when-instance_method">
  <h3 class='signature '>
    #<strong>fresh_when</strong>(object = nil, etag: nil, weak_etag: nil, strong_etag: nil, last_modified: nil, public: false, cache_control: {}, template: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the <code>etag</code>, <code>last_modified</code>, or both on the response, and renders a ‘304 Not Modified` response if the request is already fresh.</p>

<p>#### Options</p>

<p><code>:etag</code> :   Sets a “weak” ETag validator on the response. See the <code>:weak_etag</code> option. <code>:weak_etag</code> :   Sets a “weak” ETag validator on the response. Requests that specify an</p>

<pre class="code ruby"><code class="ruby"><span class='backtick'>`</span><span class='tstring_content'>If-None-Match</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_header'>header</span> <span class='id identifier rubyid_may'>may</span> <span class='id identifier rubyid_receive'>receive</span> <span class='id identifier rubyid_a'>a</span> <span class='backtick'>`</span><span class='tstring_content'>304 Not Modified</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_response'>response</span> <span class='kw'>if</span> <span class='id identifier rubyid_the'>the</span>
<span class='const'>ETag</span> <span class='id identifier rubyid_matches'>matches</span> <span class='id identifier rubyid_exactly'>exactly</span>.

<span class='const'>A</span> <span class='id identifier rubyid_weak'>weak</span> <span class='const'>ETag</span> <span class='id identifier rubyid_indicates'>indicates</span> <span class='id identifier rubyid_semantic'>semantic</span> <span class='id identifier rubyid_equivalence'>equivalence</span><span class='comma'>,</span> <span class='kw'>not</span> <span class='id identifier rubyid_byte'>byte</span><span class='op'>-</span><span class='kw'>for</span><span class='op'>-</span><span class='id identifier rubyid_byte'>byte</span> <span class='id identifier rubyid_equality'>equality</span><span class='comma'>,</span> <span class='id identifier rubyid_so'>so</span>
<span class='id identifier rubyid_they'>they</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>re good for caching HTML pages in browser caches. They can</span><span class='tstring_end'>&#39;</span></span><span class='id identifier rubyid_t'>t</span> <span class='id identifier rubyid_be'>be</span> <span class='id identifier rubyid_used'>used</span>
<span class='kw'>for</span> <span class='id identifier rubyid_responses'>responses</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_must'>must</span> <span class='id identifier rubyid_be'>be</span> <span class='id identifier rubyid_byte'>byte</span><span class='op'>-</span><span class='id identifier rubyid_identical'>identical</span><span class='comma'>,</span> <span class='id identifier rubyid_like'>like</span> <span class='id identifier rubyid_serving'>serving</span> <span class='backtick'>`</span><span class='tstring_content'>Range</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_requests'>requests</span>
<span class='id identifier rubyid_within'>within</span> <span class='id identifier rubyid_a'>a</span> <span class='const'>PDF</span> <span class='id identifier rubyid_file'>file</span>.</code></pre>

<p><code>:strong_etag</code> :   Sets a “strong” ETag validator on the response. Requests that specify an</p>

<pre class="code ruby"><code class="ruby"><span class='backtick'>`</span><span class='tstring_content'>If-None-Match</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_header'>header</span> <span class='id identifier rubyid_may'>may</span> <span class='id identifier rubyid_receive'>receive</span> <span class='id identifier rubyid_a'>a</span> <span class='backtick'>`</span><span class='tstring_content'>304 Not Modified</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_response'>response</span> <span class='kw'>if</span> <span class='id identifier rubyid_the'>the</span>
<span class='const'>ETag</span> <span class='id identifier rubyid_matches'>matches</span> <span class='id identifier rubyid_exactly'>exactly</span>.

<span class='const'>A</span> <span class='id identifier rubyid_strong'>strong</span> <span class='const'>ETag</span> <span class='id identifier rubyid_implies'>implies</span> <span class='id identifier rubyid_exact'>exact</span> <span class='id identifier rubyid_equality'>equality</span> <span class='op'>-</span><span class='op'>-</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_response'>response</span> <span class='id identifier rubyid_must'>must</span> <span class='id identifier rubyid_match'>match</span> <span class='id identifier rubyid_byte'>byte</span> <span class='kw'>for</span>
<span class='id identifier rubyid_byte'>byte</span>. <span class='const'>This</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_necessary'>necessary</span> <span class='kw'>for</span> <span class='id identifier rubyid_serving'>serving</span> <span class='backtick'>`</span><span class='tstring_content'>Range</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_requests'>requests</span> <span class='id identifier rubyid_within'>within</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_large'>large</span> <span class='id identifier rubyid_video'>video</span>
<span class='kw'>or</span> <span class='const'>PDF</span> <span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='kw'>for</span> <span class='id identifier rubyid_example'>example</span><span class='comma'>,</span> <span class='kw'>or</span> <span class='kw'>for</span> <span class='id identifier rubyid_compatibility'>compatibility</span> <span class='id identifier rubyid_with'>with</span> <span class='id identifier rubyid_some'>some</span> <span class='const'>CDNs</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_don'>don</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>t
support weak ETags.</span></code></pre>

<p><code>:last_modified</code> :   Sets a “weak” last-update validator on the response. Subsequent requests</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_specify'>specify</span> <span class='id identifier rubyid_an'>an</span> <span class='backtick'>`</span><span class='tstring_content'>If-Modified-Since</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_header'>header</span> <span class='id identifier rubyid_may'>may</span> <span class='id identifier rubyid_receive'>receive</span> <span class='id identifier rubyid_a'>a</span> <span class='backtick'>`</span><span class='tstring_content'>304 Not
Modified</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_response'>response</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>last_modified</span><span class='tstring_end'>`</span></span> <span class='op'>&lt;=</span> <span class='backtick'>`</span><span class='tstring_content'>If-Modified-Since</span><span class='tstring_end'>`</span></span>.</code></pre>

<p><code>:public</code> :   By default the <code>Cache-Control</code> header is private. Set this option to</p>

<pre class="code ruby"><code class="ruby"><span class='backtick'>`</span><span class='tstring_content'>true</span><span class='tstring_end'>`</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_you'>you</span> <span class='id identifier rubyid_want'>want</span> <span class='id identifier rubyid_your'>your</span> <span class='id identifier rubyid_application'>application</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_be'>be</span> <span class='id identifier rubyid_cacheable'>cacheable</span> <span class='id identifier rubyid_by'>by</span> <span class='id identifier rubyid_other'>other</span> <span class='id identifier rubyid_devices'>devices</span><span class='comma'>,</span> <span class='id identifier rubyid_such'>such</span>
<span class='id identifier rubyid_as'>as</span> <span class='id identifier rubyid_proxy'>proxy</span> <span class='id identifier rubyid_caches'>caches</span>.</code></pre>

<p><code>:cache_control</code> :   When given, will overwrite an existing <code>Cache-Control</code> header. For a list</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_of'>of</span> <span class='backtick'>`</span><span class='tstring_content'>Cache-Control</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_directives'>directives</span><span class='comma'>,</span> <span class='id identifier rubyid_see'>see</span> <span class='id identifier rubyid_the'>the</span> [<span class='id identifier rubyid_article'>article</span> <span class='id identifier rubyid_on'>on</span>
<span class='const'>MDN</span>](<span class='label'>https:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/developer</span></span>.<span class='id identifier rubyid_mozilla'>mozilla</span>.<span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_en'>en</span><span class='op'>-</span><span class='const'>US</span><span class='op'>/</span><span class='id identifier rubyid_docs'>docs</span><span class='op'>/</span><span class='const'>Web</span><span class='op'>/</span><span class='const'>HTTP</span><span class='op'>/</span><span class='const'>Headers</span><span class='op'>/</span><span class='const'>Cache</span><span class='op'>-</span><span class='const'>Contr</span>
<span class='id identifier rubyid_ol'>ol</span>).</code></pre>

<p><code>:template</code> :   By default, the template digest for the current controller/action is</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_included'><a href="#included-dslcall" title="ActionController::ConditionalGet::included (dslcall)">included</a></span> <span class='kw'>in</span> <span class='const'>ETags</span>. <span class='const'>If</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_action'>action</span> <span class='id identifier rubyid_renders'>renders</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_different'>different</span> <span class='id identifier rubyid_template'>template</span><span class='comma'>,</span> <span class='id identifier rubyid_you'>you</span> <span class='id identifier rubyid_can'>can</span>
<span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_its'>its</span> <span class='id identifier rubyid_digest'>digest</span> <span class='id identifier rubyid_instead'>instead</span>. <span class='const'>If</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_action'>action</span> <span class='id identifier rubyid_doesn'>doesn</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>t render a template at
all, you can pass `template: false` to skip any attempt to check for a
template digest.</span></code></pre>

<p>#### Examples</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='label'>etag:</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>last_modified:</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_updated_at'>updated_at</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span>)
<span class='kw'>end</span></code></pre>

<p>This will send a <code>304 Not Modified</code> response if the request specifies a matching ETag and <code>If-Modified-Since</code> header. Otherwise, it will render the <code>show</code> template.</p>

<p>You can also just pass a record:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='ivar'>@article</span>)
<span class='kw'>end</span></code></pre>

<p><code>etag</code> will be set to the record, and <code>last_modified</code> will be set to the record’s <code>updated_at</code>.</p>

<p>You can also pass an object that responds to <code>maximum</code>, such as a collection of records:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='ivar'>@articles</span>)
<span class='kw'>end</span></code></pre>

<p>In this case, <code>etag</code> will be set to the collection, and <code>last_modified</code> will be set to <code>maximum(:updated_at)</code> (the timestamp of the most recently updated record).</p>

<p>When passing a record or a collection, you can still specify other options, such as <code>:public</code> and ‘:cache_control`:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>cache_control:</span> { <span class='label'>no_cache:</span> <span class='kw'>true</span> })
<span class='kw'>end</span></code></pre>

<p>The above will set <code>Cache-Control: public, no-cache</code> in the response.</p>

<p>When rendering a different template than the controller/action’s default template, you can indicate which digest to include in the ETag:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before_action'>before_action</span> { <span class='id identifier rubyid_fresh_when'>fresh_when</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>widgets/show</span><span class='tstring_end'>&quot;</span></span> }</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L132-L150'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='132' data-end='150'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>etag:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>weak_etag:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>strong_etag:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>last_modified:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>cache_control:</span> {}<span class='comma'>,</span> <span class='label'>template:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_no_store'><a href="#no_store-instance_method" title="ActionController::ConditionalGet#no_store (method)">no_store</a></span>)
  <span class='id identifier rubyid_weak_etag'>weak_etag</span> <span class='op'>||=</span> <span class='id identifier rubyid_etag'>etag</span> <span class='op'>||</span> <span class='id identifier rubyid_object'>object</span> <span class='kw'>unless</span> <span class='id identifier rubyid_strong_etag'>strong_etag</span>
  <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>||=</span> <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_updated_at'>updated_at</span>) <span class='op'>||</span> <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_maximum'>maximum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_updated_at'>updated_at</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_strong_etag'>strong_etag</span>
    <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_strong_etag'>strong_etag</span> <span class='op'>=</span> <span class='id identifier rubyid_combine_etags'><a href="#combine_etags-instance_method" title="ActionController::ConditionalGet#combine_etags (method)">combine_etags</a></span> <span class='id identifier rubyid_strong_etag'>strong_etag</span><span class='comma'>,</span>
      <span class='label'>last_modified:</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='id identifier rubyid_template'>template</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_weak_etag'>weak_etag</span> <span class='op'>||</span> <span class='id identifier rubyid_template'>template</span>
    <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_weak_etag'>weak_etag</span> <span class='op'>=</span> <span class='id identifier rubyid_combine_etags'><a href="#combine_etags-instance_method" title="ActionController::ConditionalGet#combine_etags (method)">combine_etags</a></span> <span class='id identifier rubyid_weak_etag'>weak_etag</span><span class='comma'>,</span>
      <span class='label'>last_modified:</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='id identifier rubyid_template'>template</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>=</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='kw'>if</span> <span class='id identifier rubyid_last_modified'>last_modified</span>
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span>] <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_public'>public</span>
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='id identifier rubyid_cache_control'>cache_control</span>)

  <span class='id identifier rubyid_head'>head</span> <span class='symbeg'>:</span><span class='id identifier rubyid_not_modified'>not_modified</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fresh?'>fresh?</span>(<span class='id identifier rubyid_response'>response</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="http_cache_forever-instance_method">
  <h3 class='signature '>
    #<strong>http_cache_forever</strong>(public: false)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cache or yield the block. The cache is supposed to never expire.</p>

<p>You can use this method when you have an HTTP response that never changes, and the browser and proxies should cache it indefinitely.</p>
<ul><li>
<p><code>public</code>: By default, HTTP responses are private, cached only on the user’s web browser. To allow proxies to cache the response, set ‘true` to indicate that they can serve the cached response to all users.</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L310-L316'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='310' data-end='316'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 310</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_http_cache_forever'>http_cache_forever</span>(<span class='label'>public:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_expires_in'><a href="#expires_in-instance_method" title="ActionController::ConditionalGet#expires_in (method)">expires_in</a></span> <span class='int'>100</span>.<span class='id identifier rubyid_years'>years</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span>

  <span class='kw'>yield</span> <span class='kw'>if</span> <span class='id identifier rubyid_stale?'><a href="#stale%3F-instance_method" title="ActionController::ConditionalGet#stale? (method)">stale?</a></span>(<span class='label'>etag:</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fullpath'>fullpath</span><span class='comma'>,</span>
                  <span class='label'>last_modified:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2011</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_utc'>utc</span><span class='comma'>,</span>
                  <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="no_store-instance_method">
  <h3 class='signature '>
    #<strong>no_store</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets an HTTP 1.1 <code>Cache-Control</code> header of <code>no-store</code>. This means the resource may not be stored in any cache.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L320-L322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='320' data-end='322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 320</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_no_store'>no_store</span>
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_replace'>replace</span>(<span class='label'>no_store:</span> <span class='kw'>true</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stale?-instance_method">
  <h3 class='signature '>
    #<strong>stale?</strong>(object = nil, **freshness_kwargs)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the <code>etag</code> and/or <code>last_modified</code> on the response and checks them against the request. If the request doesn’t match the provided options, it is considered stale, and the response should be rendered from scratch. Otherwise, it is fresh, and a <code>304 Not Modified</code> is sent.</p>

<p>#### Options</p>

<p>See <a href="#fresh_when-instance_method" title="ActionController::ConditionalGet#fresh_when (method)">#fresh_when</a> for supported options.</p>

<p>#### Examples</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='label'>etag:</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>last_modified:</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_updated_at'>updated_at</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You can also just pass a record:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@article</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><code>etag</code> will be set to the record, and <code>last_modified</code> will be set to the record’s <code>updated_at</code>.</p>

<p>You can also pass an object that responds to <code>maximum</code>, such as a collection of records:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@articles</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@articles</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>In this case, <code>etag</code> will be set to the collection, and <code>last_modified</code> will be set to <code>maximum(:updated_at)</code> (the timestamp of the most recently updated record).</p>

<p>When passing a record or a collection, you can still specify other options, such as <code>:public</code> and ‘:cache_control`:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>cache_control:</span> { <span class='label'>no_cache:</span> <span class='kw'>true</span> })
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@articles</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The above will set <code>Cache-Control: public, no-cache</code> in the response.</p>

<p>When rendering a different template than the controller/action’s default template, you can indicate which digest to include in the ETag:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='kw'>super</span> <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>widgets/show</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/metal/conditional_get.rb#L231-L234'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='231' data-end='234'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 231</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_freshness_kwargs'>freshness_kwargs</span>)
  <span class='id identifier rubyid_fresh_when'><a href="#fresh_when-instance_method" title="ActionController::ConditionalGet#fresh_when (method)">fresh_when</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_freshness_kwargs'>freshness_kwargs</span>)
  <span class='op'>!</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fresh?'>fresh?</span>(<span class='id identifier rubyid_response'>response</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>