<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveJob::Continuation &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveJob::Continuation",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../ActiveJob.html" title="ActiveJob (module)">ActiveJob</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Continuation&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveJob::Continuation</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Continuation/TestHelper.html" title="ActiveJob::Continuation::TestHelper (module)"><code>TestHelper</code></a>,
        <a class='nodoc' href="Continuation/Validation.html" title="ActiveJob::Continuation::Validation (module)"><code>Validation</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Continuation/Step.html" title="ActiveJob::Continuation::Step (class)"><code>Step</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="Continuation/CheckpointError.html" title="ActiveJob::Continuation::CheckpointError (class)"><code>CheckpointError</code></a>,
        <a href="Continuation/Error.html" title="ActiveJob::Continuation::Error (class)"><code>Error</code></a>,
        <a href="Continuation/Interrupt.html" title="ActiveJob::Continuation::Interrupt (class)"><code>Interrupt</code></a>,
        <a href="Continuation/InvalidStepError.html" title="ActiveJob::Continuation::InvalidStepError (class)"><code>InvalidStepError</code></a>,
        <a href="Continuation/ResumeLimitError.html" title="ActiveJob::Continuation::ResumeLimitError (class)"><code>ResumeLimitError</code></a>,
        <a href="Continuation/UnadvanceableCursorError.html" title="ActiveJob::Continuation::UnadvanceableCursorError (class)"><code>UnadvanceableCursorError</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Autoload.html" title="ActiveSupport::Autoload (module)"><code>::ActiveSupport::Autoload</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="Continuation/Validation.html" title="ActiveJob::Continuation::Validation (module)"><code>Validation</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L186'>activejob/lib/active_job/continuation.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation/step.rb#L4'>activejob/lib/active_job/continuation/step.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation/test_helper.rb#L7'>activejob/lib/active_job/continuation/test_helper.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation/validation.rb#L4'>activejob/lib/active_job/continuation/validation.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Continuations provide a mechanism for interrupting and resuming jobs. This allows long-running jobs to make progress across application restarts.</p>

<p>Jobs should include the <a href="Continuable.html" title="ActiveJob::Continuable (module)"><code>Continuable</code></a> module to enable continuations. Continuable jobs are automatically retried when interrupted.</p>

<p>Use the <a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">#step</a> method to define the steps in your job. Steps can use an optional cursor to track progress in the step.</p>

<p>Steps are executed as soon as they are encountered. If a job is interrupted, previously completed steps will be skipped. If a step is in progress, it will be resumed with the last recorded cursor.</p>

<p>Code that is not part of a step will be executed on each job run.</p>

<p>You can pass a block or a method name to the step method. The block will be called with the step object as an argument. Methods can either take no arguments or a single argument for the step object.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ProcessImportJob</span> <span class='op'>&lt;</span> <span class='const'>ApplicationJob</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><a href="../ActiveJob.html" title="ActiveJob (module)">ActiveJob</a></span><span class='op'>::</span><span class='const'><a href="Continuable.html" title="ActiveJob::Continuable (module)">Continuable</a></span>

  <span class='kw'>def</span> <span class='id identifier rubyid_perform'>perform</span>(<span class='id identifier rubyid_import_id'>import_id</span>)
    <span class='comment'># This always runs, even if the job is resumed.
</span>    <span class='ivar'>@import</span> <span class='op'>=</span> <span class='const'>Import</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_import_id'>import_id</span>)

    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_validate'>validate</span> <span class='kw'>do</span>
      <span class='ivar'>@import</span>.<span class='id identifier rubyid_validate!'>validate!</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_process_records'>process_records</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
      <span class='ivar'>@import</span>.<span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_find_each'>find_each</span>(<span class='label'>start:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
        <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_process'>process</span>
        <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_advance!'>advance!</span> <span class='label'>from:</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_id'>id</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_reprocess_records'>reprocess_records</span>
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_finalize'>finalize</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reprocess_records'>reprocess_records</span>(<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>)
    <span class='ivar'>@import</span>.<span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_find_each'>find_each</span>(<span class='label'>start:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
      <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_reprocess'>reprocess</span>
      <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_advance!'>advance!</span> <span class='label'>from:</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_id'>id</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_finalize'>finalize</span>
    <span class='ivar'>@import</span>.<span class='id identifier rubyid_finalize!'>finalize!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h3 id="label-Cursors">Cursors</h3>

<p>Cursors are used to track progress within a step. The cursor can be any object that is serializable as an argument to <code>ActiveJob::Base.serialize</code>. It defaults to <code>nil</code>.</p>

<p>When a step is resumed, the last cursor value is restored. The code in the step is responsible for using the cursor to continue from the right point.</p>

<p><code>set!</code> sets the cursor to a specific value.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_iterate_items'>iterate_items</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_items'>items</span>[<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span><span class='op'>..</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='id identifier rubyid_process'>process</span>(<span class='id identifier rubyid_item'>item</span>)
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_set!'>set!</span> (<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span> <span class='op'>||</span> <span class='int'>0</span>) <span class='op'>+</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>An starting value for the cursor can be set when defining the step:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_iterate_items'>iterate_items</span><span class='comma'>,</span> <span class='label'>start:</span> <span class='int'>0</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_items'>items</span>[<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span><span class='op'>..</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='id identifier rubyid_process'>process</span>(<span class='id identifier rubyid_item'>item</span>)
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_set!'>set!</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The cursor can be advanced with <code>advance!</code>. This calls <code>succ</code> on the current cursor value. It raises an <a href="Continuation/UnadvanceableCursorError.html" title="ActiveJob::Continuation::UnadvanceableCursorError (class)"><code>UnadvanceableCursorError</code></a> if the cursor does not implement <code>succ</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_iterate_items'>iterate_items</span><span class='comma'>,</span> <span class='label'>start:</span> <span class='int'>0</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_items'>items</span>[<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span><span class='op'>..</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='id identifier rubyid_process'>process</span>(<span class='id identifier rubyid_item'>item</span>)
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_advance!'>advance!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You can optionally pass a <code>from</code> argument to <code>advance!</code>. This is useful when iterating over a collection of records where IDs may not be contiguous.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_process_records'>process_records</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_import'>import</span>.<span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_find_each'>find_each</span>(<span class='label'>start:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_process'>process</span>
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_advance!'>advance!</span> <span class='label'>from:</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_id'>id</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You can use an array to iterate over nested records:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_process_nested_records'>process_nested_records</span><span class='comma'>,</span> <span class='label'>start:</span> [ <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span> ] <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
  <span class='const'>Account</span>.<span class='id identifier rubyid_find_each'>find_each</span>(<span class='label'>start:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span>[<span class='int'>0</span>]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_account'>account</span><span class='op'>|</span>
    <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_find_each'>find_each</span>(<span class='label'>start:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_cursor'>cursor</span>[<span class='int'>1</span>]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
      <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_process'>process</span>
      <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_set!'>set!</span> [ <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_id'>id</span> <span class='op'>+</span> <span class='int'>1</span> ]
    <span class='kw'>end</span>
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_set!'>set!</span> [ <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_id'>id</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span> ]
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Setting or advancing the cursor creates a checkpoint. You can also create a checkpoint manually by calling the <code>checkpoint!</code> method on the step. This is useful if you want to allow interruptions, but don’t need to update the cursor.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy_records'>destroy_records</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_import'>import</span>.<span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_find_each'>find_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroy!'>destroy!</span>
    <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>.<span class='id identifier rubyid_checkpoint!'>checkpoint!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h3 id="label-Checkpoints">Checkpoints</h3>

<p>A checkpoint is where a job can be interrupted. At a checkpoint the job will call <code>queue_adapter.stopping?</code>. If it returns true, the job will raise an <a href="Continuation/Interrupt.html" title="ActiveJob::Continuation::Interrupt (class)"><code>Interrupt</code></a> exception.</p>

<p>There is an automatic checkpoint before the start of each step except for the first for each job execution. Within a step one is created when calling <code>set!</code>, <code>advance!</code> or <code>checkpoint!</code>.</p>

<p>Jobs are not automatically interrupted when the queue adapter is marked as stopping - they will continue to run either until the next checkpoint, or when the process is stopped.</p>

<p>This is to allow jobs to be interrupted at a safe point, but it also means that the jobs should checkpoint more frequently than the shutdown timeout to ensure a graceful restart.</p>

<p>When interrupted, the job will automatically retry with the progress serialized in the job data under the <code>continuation</code> key.</p>

<p>The serialized progress contains:</p>
<ul><li>
<p>a list of the completed steps</p>
</li><li>
<p>the current step and its cursor value (if one is in progress)</p>
</li></ul>

<h3 id="label-Isolated+Steps">Isolated Steps</h3>

<p>Steps run sequentially in a single job execution, unless the job is interrupted.</p>

<p>You can specify that a step should always run in its own execution by passing the <tt>isolated: true</tt> option.</p>

<p>This is useful for long-running steps where it may not be possible to checkpoint within the job grace period - it ensures that progress is serialized back into the job data before the step starts.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_quick_step1'>quick_step1</span>
<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_slow_step'>slow_step</span><span class='comma'>,</span> <span class='label'>isolated:</span> <span class='kw'>true</span>
<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_quick_step2'>quick_step2</span>
<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_quick_step3'>quick_step3</span></code></pre>

<h3 id="label-Errors">Errors</h3>

<p>If a job raises an error and is not retried via Active Job, it will be passed back to the underlying queue backend and any progress in this execution will be lost.</p>

<p>To mitigate this, the job will be automatically retried if it raises an error after it has made progress. Making progress is defined as having completed a step or advanced the cursor within the current step.</p>

<h3 id="label-Configuration">Configuration</h3>

<p><a href="Continuable.html" title="ActiveJob::Continuable (module)"><code>Continuable</code></a> jobs have several configuration options:</p>
<ul><li>
<p><code>:max_resumptions</code> - The maximum number of times a job can be resumed. Defaults to <code>nil</code> which means unlimited resumptions.</p>
</li><li>
<p><code>:resume_options</code> - Options to pass to <code>retry_job</code> when resuming the job. Defaults to <code>{ wait: 5.seconds }</code>. See <a href="Exceptions.html#retry_job-instance_method" title="ActiveJob::Exceptions#retry_job (method)">ActiveJob::Exceptions#retry_job</a> for available options.</p>
</li><li>
<p><code>:resume_errors_after_advancing</code> - Whether to resume errors after advancing the continuation. Defaults to <code>true</code>.</p>
</li></ul>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(job, serialized_progress)  &#x21d2; Continuation </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited'><a href="../ActiveSupport/Autoload.html" title="ActiveSupport::Autoload (module)"><code>::ActiveSupport::Autoload</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../ActiveSupport/Autoload.html#autoload-instance_method" title="ActiveSupport::Autoload#autoload (method)">autoload</a>,
        <a class='i_m ' href="../ActiveSupport/Autoload.html#autoload_at-instance_method" title="ActiveSupport::Autoload#autoload_at (method)">autoload_at</a>,
        <a class='i_m ' href="../ActiveSupport/Autoload.html#autoload_under-instance_method" title="ActiveSupport::Autoload#autoload_under (method)">autoload_under</a>,
        <a class='i_m ' href="../ActiveSupport/Autoload.html#eager_autoload-instance_method" title="ActiveSupport::Autoload#eager_autoload (method)">eager_autoload</a>,
        <a class='i_m ' href="../ActiveSupport/Autoload.html#eager_load!-instance_method" title="ActiveSupport::Autoload#eager_load! (method)">eager_load!</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#advanced%3F-instance_method" title="#advanced? (instance method)">#<strong>advanced?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#started%3F-instance_method" title="#started? (instance method)">#<strong>started?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#completed%3F-instance_method" title="#completed? (instance method)">#<strong>completed?</strong>(name)  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#current-instance_method" title="#current (instance method)">#<strong>current</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#encountered-instance_method" title="#encountered (instance method)">#<strong>encountered</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#isolating%3F-instance_method" title="#isolating? (instance method)">#<strong>isolating?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#job-instance_method" title="#job (instance method)">#<strong>job</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#running_step%3F-instance_method" title="#running_step? (instance method)">#<strong>running_step?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#instrumentation-instance_method" title="#instrumentation (instance method)">#<strong>instrumentation</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#completed-instance_method" title="#completed (instance method)">#<strong>completed</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#instrument-instance_method" title="#instrument (instance method)">#<strong>instrument</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#instrumenting_step-instance_method" title="#instrumenting_step (instance method)">#<strong>instrumenting_step</strong>(step, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#new_step-instance_method" title="#new_step (instance method)">#<strong>new_step</strong>(*args, **options)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#run_step-instance_method" title="#run_step (instance method)">#<strong>run_step</strong>(name, start:, isolated:, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#run_step_inline-instance_method" title="#run_step_inline (instance method)">#<strong>run_step_inline</strong>(name, start:, **options, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#skip_step-instance_method" title="#skip_step (instance method)">#<strong>skip_step</strong>(name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#description-instance_method" title="#description (instance method)">#<strong>description</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#step-instance_method" title="#step (instance method)">#<strong>step</strong>(name, **options, &amp;block)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_h-instance_method" title="#to_h (instance method)">#<strong>to_h</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="Continuation/Validation.html" title="ActiveJob::Continuation::Validation (module)"><code>Validation</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Continuation/Validation.html#raise_step_error!-instance_method" title="ActiveJob::Continuation::Validation#raise_step_error! (method)">#raise_step_error!</a>,
        <a class='i_m priv nodoc' href="Continuation/Validation.html#validate_step!-instance_method" title="ActiveJob::Continuation::Validation#validate_step! (method)">#validate_step!</a>,
        <a class='i_m priv nodoc' href="Continuation/Validation.html#validate_step_expected_order!-instance_method" title="ActiveJob::Continuation::Validation#validate_step_expected_order! (method)">#validate_step_expected_order!</a>,
        <a class='i_m priv nodoc' href="Continuation/Validation.html#validate_step_not_encountered!-instance_method" title="ActiveJob::Continuation::Validation#validate_step_not_encountered! (method)">#validate_step_not_encountered!</a>,
        <a class='i_m priv nodoc' href="Continuation/Validation.html#validate_step_not_nested!-instance_method" title="ActiveJob::Continuation::Validation#validate_step_not_nested! (method)">#validate_step_not_nested!</a>,
        <a class='i_m priv nodoc' href="Continuation/Validation.html#validate_step_resume_expected!-instance_method" title="ActiveJob::Continuation::Validation#validate_step_resume_expected! (method)">#validate_step_resume_expected!</a>,
        <a class='i_m priv nodoc' href="Continuation/Validation.html#validate_step_symbol!-instance_method" title="ActiveJob::Continuation::Validation#validate_step_symbol! (method)">#validate_step_symbol!</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature nodoc first'>
    .<strong>new</strong>(job, serialized_progress)  &#x21d2; <code>Continuation</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L214-L222'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='214' data-end='222'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 214</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span><span class='comma'>,</span> <span class='id identifier rubyid_serialized_progress'>serialized_progress</span>) <span class='comment'># :nodoc:
</span>  <span class='ivar'>@job</span> <span class='op'>=</span> <span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span>
  <span class='ivar'>@completed</span> <span class='op'>=</span> <span class='id identifier rubyid_serialized_progress'>serialized_progress</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>completed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> []).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_sym'>to_sym</span>)
  <span class='ivar'>@current</span> <span class='op'>=</span> <span class='id identifier rubyid_new_step'><a href="#new_step-instance_method" title="ActiveJob::Continuation#new_step (method)">new_step</a></span>(<span class='op'>*</span><span class='id identifier rubyid_serialized_progress'>serialized_progress</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='label'>resumed:</span> <span class='kw'>true</span>) <span class='kw'>if</span> <span class='id identifier rubyid_serialized_progress'>serialized_progress</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current</span><span class='tstring_end'>&quot;</span></span>)
  <span class='ivar'>@encountered</span> <span class='op'>=</span> []
  <span class='ivar'>@advanced</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@running_step</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@isolating</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="advanced?-instance_method">
  <h3 class='signature ro first'>
    #<strong>advanced?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L256-L258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='256' data-end='258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 256</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_advanced?'>advanced?</span>
  <span class='ivar'>@advanced</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="completed?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>completed?</strong>(name)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L277-L279'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='277' data-end='279'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 277</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_completed?'>completed?</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_name'>name</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="current-instance_method">
  <h3 class='signature ro priv'>
    #<strong>current</strong>   <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L267-L267'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='267' data-end='267'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_encountered'><a href="#encountered-instance_method" title="ActiveJob::Continuation#encountered (method)">encountered</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current'>current</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encountered-instance_method">
  <h3 class='signature ro priv'>
    #<strong>encountered</strong>   <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L267-L267'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='267' data-end='267'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_encountered'>encountered</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="isolating?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>isolating?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L273-L275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='273' data-end='275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 273</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_isolating?'>isolating?</span>
  <span class='ivar'>@isolating</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="job-instance_method">
  <h3 class='signature ro priv'>
    #<strong>job</strong>   <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L267-L267'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='267' data-end='267'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_job'>job</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_encountered'><a href="#encountered-instance_method" title="ActiveJob::Continuation#encountered (method)">encountered</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="running_step?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>running_step?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L269-L271'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='269' data-end='271'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 269</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_running_step?'>running_step?</span>
  <span class='ivar'>@running_step</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="started?-instance_method">
  <h3 class='signature ro'>
    #<strong>started?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L252-L254'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='252' data-end='254'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 252</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_started?'>started?</span>
  <span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span>.<span class='id identifier rubyid_any?'>any?</span> <span class='op'>||</span> <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>.<span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="completed-instance_method">
  <h3 class='signature ro priv first'>
    #<strong>completed</strong>   <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L267-L267'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='267' data-end='267'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_encountered'><a href="#encountered-instance_method" title="ActiveJob::Continuation#encountered (method)">encountered</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_completed'>completed</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="description-instance_method">
  <h3 class='signature nodoc'>
    #<strong>description</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L242-L250'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='242' data-end='250'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 242</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_description'>description</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>
    <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>.<span class='id identifier rubyid_description'>description</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span>.<span class='id identifier rubyid_any?'>any?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>after &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span>.<span class='id identifier rubyid_last'>last</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not started</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instrument-instance_method">
  <h3 class='signature priv'>
    #<strong>instrument</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L326-L328'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='326' data-end='328'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 326</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instrument'>instrument</span>(<span class='op'>...</span>)
  <span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span>.<span class='id identifier rubyid_instrument'>instrument</span>(<span class='op'>...</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instrumentation-instance_method">
  <h3 class='signature '>
    #<strong>instrumentation</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L260-L264'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='260' data-end='264'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instrumentation'>instrumentation</span>
  { <span class='label'>description:</span> <span class='id identifier rubyid_description'><a href="#description-instance_method" title="ActiveJob::Continuation#description (method)">description</a></span><span class='comma'>,</span>
    <span class='label'>completed_steps:</span> <span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span><span class='comma'>,</span>
    <span class='label'>current_step:</span> <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instrumenting_step-instance_method">
  <h3 class='signature priv'>
    #<strong>instrumenting_step</strong>(step, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L315-L324'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='315' data-end='324'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 315</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instrumenting_step'>instrumenting_step</span>(<span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_instrument'><a href="#instrument-instance_method" title="ActiveJob::Continuation#instrument (method)">instrument</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='comma'>,</span> <span class='label'>step:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span><span class='comma'>,</span> <span class='label'>interrupted:</span> <span class='kw'>false</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_payload'>payload</span><span class='op'>|</span>
    <span class='id identifier rubyid_instrument'><a href="#instrument-instance_method" title="ActiveJob::Continuation#instrument (method)">instrument</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_step_started'>step_started</span><span class='comma'>,</span> <span class='label'>step:</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="ActiveJob::Continuation#step (method)">step</a></span>

    <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_call'>call</span>
  <span class='kw'>rescue</span> <span class='const'><a href="Continuation/Interrupt.html" title="ActiveJob::Continuation::Interrupt (class)">Interrupt</a></span>
    <span class='id identifier rubyid_payload'>payload</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_interrupted'>interrupted</span>] <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new_step-instance_method">
  <h3 class='signature priv'>
    #<strong>new_step</strong>(*args, **options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L281-L283'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='281' data-end='283'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 281</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_new_step'>new_step</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
  <span class='const'><a href="Continuation/Step.html" title="ActiveJob::Continuation::Step (class)">Step</a></span>.<span class='id identifier rubyid_new'><a href="Continuation/Step.html#new-class_method" title="ActiveJob::Continuation::Step.new (method)">new</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>job:</span> <span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run_step-instance_method">
  <h3 class='signature priv'>
    #<strong>run_step</strong>(name, start:, isolated:, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L289-L297'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='289' data-end='297'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 289</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run_step'>run_step</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>start:</span><span class='comma'>,</span> <span class='label'>isolated:</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='ivar'>@isolating</span> <span class='op'>||=</span> <span class='id identifier rubyid_isolated'>isolated</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_isolating?'><a href="#isolating%3F-instance_method" title="ActiveJob::Continuation#isolating? (method)">isolating?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_advanced?'><a href="#advanced%3F-instance_method" title="ActiveJob::Continuation#advanced? (method)">advanced?</a></span>
    <span class='id identifier rubyid_job'><a href="#job-instance_method" title="ActiveJob::Continuation#job (method)">job</a></span>.<span class='id identifier rubyid_interrupt!'>interrupt!</span>(<span class='label'>reason:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isolating'>isolating</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_run_step_inline'><a href="#run_step_inline-instance_method" title="ActiveJob::Continuation#run_step_inline (method)">run_step_inline</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>start:</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run_step_inline-instance_method">
  <h3 class='signature priv'>
    #<strong>run_step_inline</strong>(name, start:, **options, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L299-L313'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='299' data-end='313'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 299</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run_step_inline'>run_step_inline</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>start:</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='ivar'>@running_step</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@current</span> <span class='op'>||=</span> <span class='id identifier rubyid_new_step'><a href="#new_step-instance_method" title="ActiveJob::Continuation#new_step (method)">new_step</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='label'>resumed:</span> <span class='kw'>false</span>)

  <span class='id identifier rubyid_instrumenting_step'><a href="#instrumenting_step-instance_method" title="ActiveJob::Continuation#instrumenting_step (method)">instrumenting_step</a></span>(<span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>)
  <span class='kw'>end</span>

  <span class='ivar'>@completed</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span>.<span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@current</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@advanced</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@running_step</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@advanced</span> <span class='op'>||=</span> <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span><span class='op'>&amp;.</span><span class='id identifier rubyid_advanced?'><a href="#advanced%3F-instance_method" title="ActiveJob::Continuation#advanced? (method)">advanced?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skip_step-instance_method">
  <h3 class='signature priv'>
    #<strong>skip_step</strong>(name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L285-L287'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='285' data-end='287'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 285</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_skip_step'>skip_step</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_instrument'><a href="#instrument-instance_method" title="ActiveJob::Continuation#instrument (method)">instrument</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_step_skipped'>step_skipped</span><span class='comma'>,</span> <span class='label'>step:</span> <span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="step-instance_method">
  <h3 class='signature nodoc'>
    #<strong>step</strong>(name, **options, &amp;block)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L224-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='224' data-end='233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 224</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_step'>step</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_validate_step!'>validate_step!</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_encountered'><a href="#encountered-instance_method" title="ActiveJob::Continuation#encountered (method)">encountered</a></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_completed?'><a href="#completed%3F-instance_method" title="ActiveJob::Continuation#completed? (method)">completed?</a></span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='id identifier rubyid_skip_step'><a href="#skip_step-instance_method" title="ActiveJob::Continuation#skip_step (method)">skip_step</a></span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_run_step'><a href="#run_step-instance_method" title="ActiveJob::Continuation#run_step (method)">run_step</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_h-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_h</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activejob/lib/active_job/continuation.rb#L235-L240'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='235' data-end='240'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activejob/lib/active_job/continuation.rb', line 235</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_h'>to_h</span> <span class='comment'># :nodoc:
</span>  {
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>completed</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_completed'><a href="#completed-instance_method" title="ActiveJob::Continuation#completed (method)">completed</a></span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current'><a href="#current-instance_method" title="ActiveJob::Continuation#current (method)">current</a></span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='comma'>,</span>
  }.<span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>