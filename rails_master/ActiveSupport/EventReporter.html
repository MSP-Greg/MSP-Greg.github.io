<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveSupport::EventReporter &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveSupport::EventReporter",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_E'>Index (E)</a> &raquo; 
        <a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>EventReporter&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveSupport::EventReporter</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a class='nodoc' href="EventReporter/TestHelper.html" title="ActiveSupport::EventReporter::TestHelper (module)"><code>TestHelper</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="EventReporter/LogSubscriber.html" title="ActiveSupport::EventReporter::LogSubscriber (class)"><code>LogSubscriber</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Autoload.html" title="ActiveSupport::Autoload (module)"><code>Autoload</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L270'>activesupport/lib/active_support/event_reporter.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter/log_subscriber.rb#L4'>activesupport/lib/active_support/event_reporter/log_subscriber.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>EventReporter</code> provides an interface for reporting structured events to subscribers.</p>

<p>To report an event, you can use the <a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">#notify</a> method:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user_created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<p>The <a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">#notify</a> API can receive either an event name and a payload hash, or an event object. Names are coerced to strings.</p>

<h3 id="label-Event+Objects">Event Objects</h3>

<p>If an event object is passed to the <a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">#notify</a> API, it will be passed through to subscribers as-is, and the name of the object’s class will be used as the event name.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>UserCreatedEvent</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='label'>id:</span><span class='comma'>,</span> <span class='label'>name:</span>)
    <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>
    <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_serialize'>serialize</span>
    {
      <span class='label'>id:</span> <span class='ivar'>@id</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='ivar'>@name</span>
    }
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='const'>UserCreatedEvent</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::EventReporter.new (method)">new</a></span>(<span class='label'>id:</span> <span class='int'>123</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John Doe</span><span class='tstring_end'>&quot;</span></span>))
<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;UserCreatedEvent&quot;,
</span><span class='comment'>#    payload: #&lt;UserCreatedEvent:0x111&gt;,
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<p>An event is any Ruby object representing a schematized event. While payload hashes allow arbitrary, implicitly-structured data, event objects are intended to enforce a particular schema.</p>

<p>Subscribers are responsible for serializing event objects.</p>

<h3 id="label-Subscribers">Subscribers</h3>

<p>Subscribers must implement the <code>emit</code> method, which will be called with the event hash.</p>

<p>The event hash has the following keys:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_name'>name</span><span class='op'>:</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span>)
<span class='id identifier rubyid_payload'>payload</span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span><span class='comma'>,</span> <span class='const'><a href="../Object.html" title="Object (class)">Object</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_payload'>payload</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>or</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span> <span class='id identifier rubyid_object'>object</span> <span class='id identifier rubyid_itself'>itself</span>)
<span class='id identifier rubyid_tags'>tags</span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_tags'>tags</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span>)
<span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span>)
<span class='id identifier rubyid_timestamp'>timestamp</span><span class='op'>:</span> <span class='const'><a href="../Float.html" title="Float (class)">Float</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_timestamp'>timestamp</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>in</span> <span class='id identifier rubyid_nanoseconds'>nanoseconds</span>)
<span class='id identifier rubyid_source_location'>source_location</span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_source'>source</span> <span class='id identifier rubyid_location'>location</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_containing'>containing</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_filepath'>filepath</span><span class='comma'>,</span> <span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span> <span class='kw'>and</span> <span class='id identifier rubyid_label'>label</span>)</code></pre>

<p>Subscribers are responsible for encoding events to their desired format before emitting them to their target destination, such as a streaming platform, a log device, or an alerting service.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>JSONEventSubscriber</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_emit'>emit</span>(<span class='id identifier rubyid_event'>event</span>)
    <span class='id identifier rubyid_json_data'>json_data</span> <span class='op'>=</span> <span class='const'><a href="JSON.html" title="ActiveSupport::JSON (module)">JSON</a></span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='id identifier rubyid_event'>event</span>)
    <span class='const'>LogExporter</span>.<span class='id identifier rubyid_export'>export</span>(<span class='id identifier rubyid_json_data'>json_data</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'><a href="EventReporter/LogSubscriber.html" title="ActiveSupport::EventReporter::LogSubscriber (class)">LogSubscriber</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_emit'>emit</span>(<span class='id identifier rubyid_event'>event</span>)
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_payload'>payload</span>].<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_source_location'>source_location</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_source_location'>source_location</span>]
    <span class='id identifier rubyid_log'>log</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_payload'>payload</span><span class='embexpr_end'>}</span><span class='tstring_content'> at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_location'>source_location</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_filepath'>filepath</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source_location'>source_location</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lineno'>lineno</span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_logger'><a href="../Rails.html#logger-class_method" title="Rails.logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span>(<span class='id identifier rubyid_log'>log</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Note that event objects are passed through to subscribers as-is, and may need to be serialized before being encoded:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>UserCreatedEvent</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='label'>id:</span><span class='comma'>,</span> <span class='label'>name:</span>)
    <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>
    <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_serialize'>serialize</span>
    {
      <span class='label'>id:</span> <span class='ivar'>@id</span><span class='comma'>,</span>
      <span class='label'>name:</span> <span class='ivar'>@name</span>
    }
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'><a href="EventReporter/LogSubscriber.html" title="ActiveSupport::EventReporter::LogSubscriber (class)">LogSubscriber</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_emit'>emit</span>(<span class='id identifier rubyid_event'>event</span>)
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_payload'>payload</span>]
    <span class='id identifier rubyid_json_data'>json_data</span> <span class='op'>=</span> <span class='const'><a href="JSON.html" title="ActiveSupport::JSON (module)">JSON</a></span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='id identifier rubyid_payload'>payload</span>.<span class='id identifier rubyid_serialize'>serialize</span>)
    <span class='const'>LogExporter</span>.<span class='id identifier rubyid_export'>export</span>(<span class='id identifier rubyid_json_data'>json_data</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h4 id="label-Filtered+Subscriptions">Filtered Subscriptions</h4>

<p>Subscribers can be configured with an optional filter proc to only receive a subset of events, based on their name:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Only receive events with names starting with &quot;user.&quot;
</span><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_subscribe'><a href="#subscribe-instance_method" title="ActiveSupport::EventReporter#subscribe (method)">subscribe</a></span>(<span class='id identifier rubyid_user_subscriber'>user_subscriber</span>) { <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.</span><span class='tstring_end'>&quot;</span></span>) }</code></pre>

<p>Note that only the <code>:name</code> key is available to filters, not the entire payload.</p>

<h3 id="label-Debug+Events">Debug Events</h3>

<p>You can use the <a href="#debug-instance_method" title="ActiveSupport::EventReporter#debug (method)">#debug</a> method to report an event that will only be reported if the event reporter is in debug mode:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_debug'><a href="#debug-instance_method" title="ActiveSupport::EventReporter#debug (method)">debug</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_debug_event</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>foo:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> })</code></pre>

<h3 id="label-Tags">Tags</h3>

<p>To add additional context to an event, separate from the event payload, you can add tags via the <a href="#tagged-instance_method" title="ActiveSupport::EventReporter#tagged (method)">#tagged</a> method:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'><a href="#tagged-instance_method" title="ActiveSupport::EventReporter#tagged (method)">tagged</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>graphql</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
<span class='kw'>end</span>

<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user_created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: { graphql: true },
</span><span class='comment'>#    context: {},
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<h3 id="label-Context+Store">Context Store</h3>

<p>You may want to attach metadata to every event emitted by the reporter. While tags provide domain-specific context for a series of events, context is scoped to the job / request and should be used for metadata associated with the execution context. Context can be set via the <a href="#set_context-instance_method" title="ActiveSupport::EventReporter#set_context (method)">#set_context</a> method:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_set_context'><a href="#set_context-instance_method" title="ActiveSupport::EventReporter#set_context (method)">set_context</a></span>(<span class='label'>request_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>abcd123</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>user_agent:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TestAgent</span><span class='tstring_end'>&quot;</span></span>)
<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })

<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user_created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: {},
</span><span class='comment'>#    context: { request_id: &quot;abcd123&quot;, user_agent: &quot;TestAgent&quot; },
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<p>Context is reset automatically before and after each request.</p>

<p>A custom context store can be configured via <code>config.active_support.event_reporter_context_store</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/application.rb
</span><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_active_support'>active_support</span>.<span class='id identifier rubyid_event_reporter_context_store'>event_reporter_context_store</span> <span class='op'>=</span> <span class='const'>CustomContextStore</span>

<span class='kw'>class</span> <span class='const'>CustomContextStore</span>
  <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span>
      <span class='comment'># Return the context.
</span>    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_set_context'><a href="#set_context-instance_method" title="ActiveSupport::EventReporter#set_context (method)">set_context</a></span>(<span class='id identifier rubyid_context_hash'>context_hash</span>)
      <span class='comment'># Append context_hash to the existing context store.
</span>    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>
      <span class='comment'># Delete the stored context.
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The Event Reporter standardizes on symbol keys for all payload data, tags, and context store entries. <a href="../String.html" title="String (class)"><code>::String</code></a> keys are automatically converted to symbols for consistency.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>123</span> })
<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user.created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#  }</span></code></pre>

<h3 id="label-Security">Security</h3>

<p>When reporting events, Hash-based payloads are automatically filtered to remove sensitive data based on <a href="https://guides.rubyonrails.org/configuring.html#config-filter-parameters" target="_parent" title="{Rails.application">{Rails.application</a>.filter_parameters}.</p>

<p>If an <a href="EventReporter.html#label-Event+Objects" title="event object">event object</a> is given instead, subscribers will need to filter sensitive data themselves, e.g. with <a href="ParameterFilter.html" title="ActiveSupport::ParameterFilter (class)"><code>ParameterFilter</code></a>.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#filter_parameters-class_method" title=".filter_parameters (class method)">.<strong>filter_parameters</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Filter parameters used to filter event payloads.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#context_store-class_method" title=".context_store (class method)">.<strong>context_store</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(*subscribers, raise_on_error: false)  &#x21d2; EventReporter </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>

<h3 class='inherited'><a href="Autoload.html" title="ActiveSupport::Autoload (module)"><code>Autoload</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Autoload.html#autoload-instance_method" title="ActiveSupport::Autoload#autoload (method)">autoload</a>,
        <a class='i_m ' href="Autoload.html#autoload_at-instance_method" title="ActiveSupport::Autoload#autoload_at (method)">autoload_at</a>,
        <a class='i_m ' href="Autoload.html#autoload_under-instance_method" title="ActiveSupport::Autoload#autoload_under (method)">autoload_under</a>,
        <a class='i_m ' href="Autoload.html#eager_autoload-instance_method" title="ActiveSupport::Autoload#eager_autoload (method)">eager_autoload</a>,
        <a class='i_m ' href="Autoload.html#eager_load!-instance_method" title="ActiveSupport::Autoload#eager_load! (method)">eager_load!</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#debug_mode%3F-instance_method" title="#debug_mode? (instance method)">#<strong>debug_mode?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if debug mode is currently enabled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#raise_on_error=-instance_method" title="#raise_on_error= (instance method)">#<strong>raise_on_error=</strong>(value)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets whether to raise an error if a subscriber raises an error during event emission, or when unexpected arguments are passed to <a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">#notify</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#subscribers-instance_method" title="#subscribers (instance method)">#<strong>subscribers</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p><code>:nodoc</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw priv'>
      <a href="#raise_on_error%3F-instance_method" title="#raise_on_error? (instance method)">#<strong>raise_on_error?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature rw nodoc'>
      <a href="#debug_mode=-instance_method" title="#debug_mode= (instance method)">#<strong>debug_mode=</strong>(value)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#clear_context-instance_method" title="#clear_context (instance method)">#<strong>clear_context</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Clears all context data.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#context-instance_method" title="#context (instance method)">#<strong>context</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the current context data.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#debug-instance_method" title="#debug (instance method)">#<strong>debug</strong>(name_or_object, payload = nil, caller_depth: 1, **kwargs)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Report an event only when in debug mode.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#notify-instance_method" title="#notify (instance method)">#<strong>notify</strong>(name_or_object, payload = nil, caller_depth: 1, **kwargs)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reports an event to all registered subscribers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set_context-instance_method" title="#set_context (instance method)">#<strong>set_context</strong>(context)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets context data that will be included with all events emitted by the reporter.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#subscribe-instance_method" title="#subscribe (instance method)">#<strong>subscribe</strong>(subscriber, &amp;filter)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Registers a new event subscriber.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#tagged-instance_method" title="#tagged (instance method)">#<strong>tagged</strong>(*args, **kwargs, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add tags to events to supply additional context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#unsubscribe-instance_method" title="#unsubscribe (instance method)">#<strong>unsubscribe</strong>(subscriber)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Unregister an event subscriber.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_debug-instance_method" title="#with_debug (instance method)">#<strong>with_debug</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Temporarily enables debug mode for the duration of the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#context_store-instance_method" title="#context_store (instance method)">#<strong>context_store</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#filter_parameters-instance_method" title="#filter_parameters (instance method)">#<strong>filter_parameters</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#handle_unexpected_args-instance_method" title="#handle_unexpected_args (instance method)">#<strong>handle_unexpected_args</strong>(name_or_object, payload, kwargs)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#payload_filter-instance_method" title="#payload_filter (instance method)">#<strong>payload_filter</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#resolve_name-instance_method" title="#resolve_name (instance method)">#<strong>resolve_name</strong>(name_or_object)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#resolve_payload-instance_method" title="#resolve_payload (instance method)">#<strong>resolve_payload</strong>(name_or_object, payload, **kwargs)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#reload_payload_filter-instance_method" title="#reload_payload_filter (instance method)">#<strong>reload_payload_filter</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(*subscribers, raise_on_error: false)  &#x21d2; <code>EventReporter</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L292-L297'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='292' data-end='297'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 292</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='op'>*</span><span class='id identifier rubyid_subscribers'><a href="#subscribers-instance_method" title="ActiveSupport::EventReporter#subscribers (method)">subscribers</a></span><span class='comma'>,</span> <span class='label'>raise_on_error:</span> <span class='kw'>false</span>)
  <span class='ivar'>@subscribers</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_subscribers'><a href="#subscribers-instance_method" title="ActiveSupport::EventReporter#subscribers (method)">subscribers</a></span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='op'>|</span> <span class='id identifier rubyid_subscribe'><a href="#subscribe-instance_method" title="ActiveSupport::EventReporter#subscribe (method)">subscribe</a></span>(<span class='id identifier rubyid_subscriber'>subscriber</span>) }
  <span class='ivar'>@debug_mode</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@raise_on_error</span> <span class='op'>=</span> <span class='id identifier rubyid_raise_on_error'>raise_on_error</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="context_store-class_method">
  <h3 class='signature rw  nodoc first'>
    .<strong>context_store</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L287-L287'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='287' data-end='287'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 287</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_context_store'>context_store</span> <span class='comment'># :nodoc:</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="filter_parameters-class_method">
  <h3 class='signature rw'>
    .<strong>filter_parameters</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Filter parameters used to filter event payloads. If nil, Active Support’s filter parameters will be used instead.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L286-L286'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='286' data-end='286'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 286</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_filter_parameters'>filter_parameters</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="debug_mode=-instance_method">
  <h3 class='signature rw  nodoc first'>
    #<strong>debug_mode=</strong>(value)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L279-L279'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='279' data-end='279'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 279</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_writer'>attr_writer</span> <span class='symbeg'>:</span><span class='id identifier rubyid_debug_mode'>debug_mode</span> <span class='comment'># :nodoc:</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="debug_mode?-instance_method">
  <h3 class='signature rw'>
    #<strong>debug_mode?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if debug mode is currently enabled. Debug mode is enabled on the reporter via <a href="#with_debug-instance_method" title="ActiveSupport::EventReporter#with_debug (method)">#with_debug</a>, and in local environments.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L434-L436'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='434' data-end='436'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 434</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_debug_mode?'>debug_mode?</span>
  <span class='ivar'>@debug_mode</span> <span class='op'>||</span> <span class='const'>Fiber</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_event_reporter_debug_mode'>event_reporter_debug_mode</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_on_error=-instance_method">
  <h3 class='signature rw'>
    #<strong>raise_on_error=</strong>(value)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets whether to raise an error if a subscriber raises an error during event emission, or when unexpected arguments are passed to <a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">#notify</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L277-L277'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='277' data-end='277'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 277</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_writer'>attr_writer</span> <span class='symbeg'>:</span><span class='id identifier rubyid_raise_on_error'>raise_on_error</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_on_error?-instance_method">
  <h3 class='signature rw priv'>
    #<strong>raise_on_error?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L558-L560'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='558' data-end='560'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 558</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_raise_on_error?'>raise_on_error?</span>
  <span class='ivar'>@raise_on_error</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="subscribers-instance_method">
  <h3 class='signature ro'>
    #<strong>subscribers</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>:nodoc</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L281-L281'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='281' data-end='281'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 281</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subscribers'>subscribers</span> <span class='comment'># :nodoc</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="clear_context-instance_method">
  <h3 class='signature  first'>
    #<strong>clear_context</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Clears all context data.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L539-L541'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='539' data-end='541'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 539</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_context'>clear_context</span>
  <span class='id identifier rubyid_context_store'><a href="#context_store-class_method" title="ActiveSupport::EventReporter.context_store (method)">context_store</a></span>.<span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="context-instance_method">
  <h3 class='signature '>
    #<strong>context</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the current context data.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L544-L546'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='544' data-end='546'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 544</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_context'>context</span>
  <span class='id identifier rubyid_context_store'><a href="#context_store-class_method" title="ActiveSupport::EventReporter.context_store (method)">context_store</a></span>.<span class='id identifier rubyid_context'>context</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="context_store-instance_method">
  <h3 class='signature priv'>
    #<strong>context_store</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L562-L564'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='562' data-end='564'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 562</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_context_store'>context_store</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_context_store'>context_store</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="debug-instance_method">
  <h3 class='signature '>
    #<strong>debug</strong>(name_or_object, payload = nil, caller_depth: 1, **kwargs)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Report an event only when in debug mode. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_debug'>debug</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sql.query</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>sql:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span> })</code></pre>

<h4 id="label-Arguments">Arguments</h4>
<ul><li>
<p><code>:payload</code> - The event payload when using string/symbol event names.</p>
</li><li>
<p><code>:caller_depth</code> - The stack depth to use for source location (default: 1).</p>
</li><li>
<p><code>:kwargs</code> - Additional payload data when using string/symbol event names.</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L449-L457'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='449' data-end='457'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 449</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_debug'>debug</span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>caller_depth:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_debug_mode?'><a href="#debug_mode%3F-instance_method" title="ActiveSupport::EventReporter#debug_mode? (method)">debug_mode?</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='label'>caller_depth:</span> <span class='id identifier rubyid_caller_depth'>caller_depth</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='kw'>yield</span>))
    <span class='kw'>else</span>
      <span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='label'>caller_depth:</span> <span class='id identifier rubyid_caller_depth'>caller_depth</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="filter_parameters-instance_method">
  <h3 class='signature priv'>
    #<strong>filter_parameters</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L554-L556'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='554' data-end='556'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 554</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_filter_parameters'>filter_parameters</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_filter_parameters'>filter_parameters</span> <span class='op'>||</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span>.<span class='id identifier rubyid_filter_parameters'><a href="../ActiveSupport.html#filter_parameters-class_method" title="ActiveSupport.filter_parameters (method)">filter_parameters</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_unexpected_args-instance_method">
  <h3 class='signature priv'>
    #<strong>handle_unexpected_args</strong>(name_or_object, payload, kwargs)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L597-L608'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='597' data-end='608'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 597</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_unexpected_args'>handle_unexpected_args</span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='id identifier rubyid_kwargs'>kwargs</span>)
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;~MESSAGE</span>
<span class='ignored_sp'>    </span><span class='tstring_content'>Rails.event.notify accepts either an event object, a payload hash, or keyword arguments.
</span><span class='ignored_sp'>    </span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name_or_object'>name_or_object</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_payload'>payload</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_kwargs'>kwargs</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>
</span><span class='heredoc_end'>  MESSAGE
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_raise_on_error?'><a href="#raise_on_error%3F-instance_method" title="ActiveSupport::EventReporter#raise_on_error? (method)">raise_on_error?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span>
  <span class='kw'>else</span>
    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span>.<span class='id identifier rubyid_error_reporter'><a href="../ActiveSupport.html#error_reporter-instance_method" title="ActiveSupport#error_reporter (method)">error_reporter</a></span>.<span class='id identifier rubyid_report'>report</span>(<span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::EventReporter.new (method)">new</a></span>(<span class='id identifier rubyid_message'>message</span>)<span class='comma'>,</span> <span class='label'>handled:</span> <span class='kw'>true</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="notify-instance_method">
  <h3 class='signature '>
    #<strong>notify</strong>(name_or_object, payload = nil, caller_depth: 1, **kwargs)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reports an event to all registered subscribers. An event name and payload can be provided:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'>notify</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user.created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: {},
</span><span class='comment'>#    context: {},
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<p>Alternatively, an event object can be provided:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'>notify</span>(<span class='const'>UserCreatedEvent</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::EventReporter.new (method)">new</a></span>(<span class='label'>id:</span> <span class='int'>123</span>))
<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;UserCreatedEvent&quot;,
</span><span class='comment'>#    payload: #&lt;UserCreatedEvent:0x111&gt;,
</span><span class='comment'>#    tags: {},
</span><span class='comment'>#    context: {},
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<h4 id="label-Arguments">Arguments</h4>
<ul><li>
<p><code>:payload</code> - The event payload when using string/symbol event names.</p>
</li><li>
<p><code>:caller_depth</code> - The stack depth to use for source location (default: 1).</p>
</li><li>
<p><code>:kwargs</code> - Additional payload data when using string/symbol event names.</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L369-L416'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='369' data-end='416'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 369</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_notify'>notify</span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>caller_depth:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_name'><a href="#resolve_name-instance_method" title="ActiveSupport::EventReporter#resolve_name (method)">resolve_name</a></span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span>)
  <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> { <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span> }

  <span class='id identifier rubyid_subscribers'><a href="#subscribers-instance_method" title="ActiveSupport::EventReporter#subscribers (method)">subscribers</a></span> <span class='op'>=</span> <span class='ivar'>@subscribers</span>.<span class='id identifier rubyid_filter_map'>filter_map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subscriber_entry'>subscriber_entry</span><span class='op'>|</span>
    <span class='id identifier rubyid_subscriber'>subscriber</span> <span class='op'>=</span> <span class='id identifier rubyid_subscriber_entry'>subscriber_entry</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_subscriber'>subscriber</span>]
    <span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> <span class='id identifier rubyid_subscriber_entry'>subscriber_entry</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_filter'>filter</span>]

    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_filter'>filter</span> <span class='op'>||</span> <span class='id identifier rubyid_filter'>filter</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_event'>event</span>)
      <span class='id identifier rubyid_subscriber'>subscriber</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_subscribers'><a href="#subscribers-instance_method" title="ActiveSupport::EventReporter#subscribers (method)">subscribers</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_payload'><a href="#resolve_payload-instance_method" title="ActiveSupport::EventReporter#resolve_payload (method)">resolve_payload</a></span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)

  <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> {
    <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='label'>payload:</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span>
    <span class='label'>tags:</span> <span class='const'><a href="TagStack.html" title="ActiveSupport::TagStack (class)">TagStack</a></span>.<span class='id identifier rubyid_tags'><a href="TagStack.html#tags-class_method" title="ActiveSupport::TagStack.tags (method)">tags</a></span><span class='comma'>,</span>
    <span class='label'>context:</span> <span class='id identifier rubyid_context_store'><a href="#context_store-class_method" title="ActiveSupport::EventReporter.context_store (method)">context_store</a></span>.<span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span><span class='comma'>,</span>
    <span class='label'>timestamp:</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_REALTIME</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_nanosecond'>nanosecond</span>)<span class='comma'>,</span>
  }

  <span class='id identifier rubyid_caller_location'>caller_location</span> <span class='op'>=</span> <span class='id identifier rubyid_caller_locations'>caller_locations</span>(<span class='id identifier rubyid_caller_depth'>caller_depth</span><span class='comma'>,</span> <span class='int'>1</span>)<span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_caller_location'>caller_location</span>
    <span class='id identifier rubyid_source_location'>source_location</span> <span class='op'>=</span> {
      <span class='label'>filepath:</span> <span class='id identifier rubyid_caller_location'>caller_location</span>.<span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
      <span class='label'>lineno:</span> <span class='id identifier rubyid_caller_location'>caller_location</span>.<span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span>
      <span class='label'>label:</span> <span class='id identifier rubyid_caller_location'>caller_location</span>.<span class='id identifier rubyid_label'>label</span><span class='comma'>,</span>
    }
    <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_source_location'>source_location</span>] <span class='op'>=</span> <span class='id identifier rubyid_source_location'>source_location</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_subscribers'><a href="#subscribers-instance_method" title="ActiveSupport::EventReporter#subscribers (method)">subscribers</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='op'>|</span>
    <span class='id identifier rubyid_subscriber'>subscriber</span>.<span class='id identifier rubyid_emit'>emit</span>(<span class='id identifier rubyid_event'>event</span>)
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_subscriber_error'>subscriber_error</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_raise_on_error?'><a href="#raise_on_error%3F-instance_method" title="ActiveSupport::EventReporter#raise_on_error? (method)">raise_on_error?</a></span>
      <span class='id identifier rubyid_raise'>raise</span>
    <span class='kw'>else</span>
      <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span>.<span class='id identifier rubyid_error_reporter'><a href="../ActiveSupport.html#error_reporter-instance_method" title="ActiveSupport#error_reporter (method)">error_reporter</a></span>.<span class='id identifier rubyid_report'>report</span>(<span class='id identifier rubyid_subscriber_error'>subscriber_error</span><span class='comma'>,</span> <span class='label'>handled:</span> <span class='kw'>true</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="payload_filter-instance_method">
  <h3 class='signature priv'>
    #<strong>payload_filter</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L566-L571'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='566' data-end='571'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 566</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_payload_filter'>payload_filter</span>
  <span class='ivar'>@payload_filter</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_mask'>mask</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ParameterFilter.html" title="ActiveSupport::ParameterFilter (class)">ParameterFilter</a></span><span class='op'>::</span><span class='const'><a href="ParameterFilter.html#FILTERED-constant" title="ActiveSupport::ParameterFilter::FILTERED (constant)">FILTERED</a></span>
    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ParameterFilter.html" title="ActiveSupport::ParameterFilter (class)">ParameterFilter</a></span>.<span class='id identifier rubyid_new'><a href="ParameterFilter.html#new-class_method" title="ActiveSupport::ParameterFilter.new (method)">new</a></span>(<span class='id identifier rubyid_filter_parameters'><a href="#filter_parameters-class_method" title="ActiveSupport::EventReporter.filter_parameters (method)">filter_parameters</a></span><span class='comma'>,</span> <span class='label'>mask:</span> <span class='id identifier rubyid_mask'>mask</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reload_payload_filter-instance_method">
  <h3 class='signature nodoc'>
    #<strong>reload_payload_filter</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L548-L551'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='548' data-end='551'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 548</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reload_payload_filter'>reload_payload_filter</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@payload_filter</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_payload_filter'><a href="#payload_filter-instance_method" title="ActiveSupport::EventReporter#payload_filter (method)">payload_filter</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="resolve_name-instance_method">
  <h3 class='signature priv'>
    #<strong>resolve_name</strong>(name_or_object)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L573-L580'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='573' data-end='580'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 573</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_name'>resolve_name</span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_name_or_object'>name_or_object</span>
  <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='comma'>,</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
    <span class='id identifier rubyid_name_or_object'>name_or_object</span>.<span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_name_or_object'>name_or_object</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="resolve_payload-instance_method">
  <h3 class='signature priv'>
    #<strong>resolve_payload</strong>(name_or_object, payload, **kwargs)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L582-L595'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='582' data-end='595'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 582</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_resolve_payload'>resolve_payload</span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_name_or_object'>name_or_object</span>
  <span class='kw'>when</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='comma'>,</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
    <span class='id identifier rubyid_handle_unexpected_args'><a href="#handle_unexpected_args-instance_method" title="ActiveSupport::EventReporter#handle_unexpected_args (method)">handle_unexpected_args</a></span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='id identifier rubyid_kwargs'>kwargs</span>) <span class='kw'>if</span> <span class='id identifier rubyid_payload'>payload</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_kwargs'>kwargs</span>.<span class='id identifier rubyid_any?'>any?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_kwargs'>kwargs</span>.<span class='id identifier rubyid_any?'>any?</span>
      <span class='id identifier rubyid_payload_filter'><a href="#payload_filter-instance_method" title="ActiveSupport::EventReporter#payload_filter (method)">payload_filter</a></span>.<span class='id identifier rubyid_filter'>filter</span>(<span class='id identifier rubyid_kwargs'>kwargs</span>.<span class='id identifier rubyid_transform_keys'>transform_keys</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_sym'>to_sym</span>))
    <span class='kw'>elsif</span> <span class='id identifier rubyid_payload'>payload</span>
      <span class='id identifier rubyid_payload_filter'><a href="#payload_filter-instance_method" title="ActiveSupport::EventReporter#payload_filter (method)">payload_filter</a></span>.<span class='id identifier rubyid_filter'>filter</span>(<span class='id identifier rubyid_payload'>payload</span>.<span class='id identifier rubyid_transform_keys'>transform_keys</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_sym'>to_sym</span>))
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_handle_unexpected_args'><a href="#handle_unexpected_args-instance_method" title="ActiveSupport::EventReporter#handle_unexpected_args (method)">handle_unexpected_args</a></span>(<span class='id identifier rubyid_name_or_object'>name_or_object</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='comma'>,</span> <span class='id identifier rubyid_kwargs'>kwargs</span>) <span class='kw'>if</span> <span class='id identifier rubyid_payload'>payload</span> <span class='op'>||</span> <span class='id identifier rubyid_kwargs'>kwargs</span>.<span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_name_or_object'>name_or_object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_context-instance_method">
  <h3 class='signature '>
    #<strong>set_context</strong>(context)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets context data that will be included with all events emitted by the reporter. Context data should be scoped to the job or request, and is reset automatically before and after each request and job.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_set_context'>set_context</span>(<span class='label'>user_agent:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TestAgent</span><span class='tstring_end'>&quot;</span></span>)
<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_set_context'>set_context</span>(<span class='label'>job_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>abc123</span><span class='tstring_end'>&quot;</span></span>)
<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'><a href="#tagged-instance_method" title="ActiveSupport::EventReporter#tagged (method)">tagged</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>graphql</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
<span class='kw'>end</span>

<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user_created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: { graphql: true },
</span><span class='comment'>#    context: { user_agent: &quot;TestAgent&quot;, job_id: &quot;abc123&quot; },
</span><span class='comment'>#    timestamp: 1738964843208679035
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L534-L536'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='534' data-end='536'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 534</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_context'>set_context</span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span>)
  <span class='id identifier rubyid_context_store'><a href="#context_store-class_method" title="ActiveSupport::EventReporter.context_store (method)">context_store</a></span>.<span class='id identifier rubyid_set_context'>set_context</span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="subscribe-instance_method">
  <h3 class='signature '>
    #<strong>subscribe</strong>(subscriber, &amp;filter)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Registers a new event subscriber. The subscriber must respond to</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_emit'>emit</span>(<span class='label'>event:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)</code></pre>

<p>The event hash will have the following keys:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_name'>name</span><span class='op'>:</span> <span class='const'><a href="../String.html" title="String (class)">String</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span>)
<span class='id identifier rubyid_payload'>payload</span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span><span class='comma'>,</span> <span class='const'><a href="../Object.html" title="Object (class)">Object</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_payload'>payload</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>or</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span> <span class='id identifier rubyid_object'>object</span> <span class='id identifier rubyid_itself'>itself</span>)
<span class='id identifier rubyid_tags'>tags</span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_tags'>tags</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span>)
<span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="ActiveSupport::EventReporter#context (method)">context</a></span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span>)
<span class='id identifier rubyid_timestamp'>timestamp</span><span class='op'>:</span> <span class='const'><a href="../Float.html" title="Float (class)">Float</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_timestamp'>timestamp</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='kw'>in</span> <span class='id identifier rubyid_nanoseconds'>nanoseconds</span>)
<span class='id identifier rubyid_source_location'>source_location</span><span class='op'>:</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span> (<span class='const'>The</span> <span class='id identifier rubyid_source'>source</span> <span class='id identifier rubyid_location'>location</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_containing'>containing</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_filepath'>filepath</span><span class='comma'>,</span> <span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span> <span class='kw'>and</span> <span class='id identifier rubyid_label'>label</span>)</code></pre>

<p>An optional filter proc can be provided to only receive a subset of events:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_subscribe'>subscribe</span>(<span class='id identifier rubyid_subscriber'>subscriber</span>) { <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.</span><span class='tstring_end'>&quot;</span></span>) }
<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_subscribe'>subscribe</span>(<span class='id identifier rubyid_subscriber'>subscriber</span>) { <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span> <span class='id identifier rubyid_event'>event</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_payload'>payload</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>UserEvent</span>) }</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L317-L322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='317' data-end='322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 317</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_subscribe'>subscribe</span>(<span class='id identifier rubyid_subscriber'>subscriber</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_filter'>filter</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_subscriber'>subscriber</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_emit'>emit</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Event subscriber </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_subscriber'>subscriber</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to #emit</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@subscribers</span> <span class='op'>&lt;&lt;</span> { <span class='label'>subscriber:</span> <span class='id identifier rubyid_subscriber'>subscriber</span><span class='comma'>,</span> <span class='label'>filter:</span> <span class='id identifier rubyid_filter'>filter</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tagged-instance_method">
  <h3 class='signature '>
    #<strong>tagged</strong>(*args, **kwargs, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add tags to events to supply additional context. Tags operate in a stack-oriented manner, so all events emitted within the block inherit the same set of tags. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'>tagged</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>graphql</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
<span class='kw'>end</span>

<span class='comment'># Emits event:
</span><span class='comment'># {
</span><span class='comment'>#    name: &quot;user.created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: { graphql: true },
</span><span class='comment'>#    context: {},
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<p>Tags can be provided as arguments or as keyword arguments, and can be nested:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'>tagged</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>graphql</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
<span class='comment'># Other code here...
</span>  <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'>tagged</span>(<span class='label'>section:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
    <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user.created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: { section: &quot;admin&quot;, graphql: true },
</span><span class='comment'>#    context: {},
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

<p>The <code>tagged</code> API can also receive a tag object:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_graphql_tag'>graphql_tag</span> <span class='op'>=</span> <span class='const'>GraphqlTag</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::EventReporter.new (method)">new</a></span>(<span class='label'>operation_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user_created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>operation_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mutation</span><span class='tstring_end'>&quot;</span></span>)
<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_tagged'>tagged</span>(<span class='id identifier rubyid_graphql_tag'>graphql_tag</span>) <span class='kw'>do</span>
  <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_notify'><a href="#notify-instance_method" title="ActiveSupport::EventReporter#notify (method)">notify</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.created</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>id:</span> <span class='int'>123</span> })
<span class='kw'>end</span>

<span class='comment'># Emits event:
</span><span class='comment'>#  {
</span><span class='comment'>#    name: &quot;user.created&quot;,
</span><span class='comment'>#    payload: { id: 123 },
</span><span class='comment'>#    tags: { &quot;GraphqlTag&quot;: #&lt;GraphqlTag:0x111&gt; },
</span><span class='comment'>#    context: {},
</span><span class='comment'>#    timestamp: 1738964843208679035,
</span><span class='comment'>#    source_location: { filepath: &quot;path/to/file.rb&quot;, lineno: 123, label: &quot;UserService#create&quot; }
</span><span class='comment'>#  }</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L511-L513'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='511' data-end='513'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 511</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_tagged'>tagged</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='const'><a href="TagStack.html" title="ActiveSupport::TagStack (class)">TagStack</a></span>.<span class='id identifier rubyid_with_tags'><a href="TagStack.html#with_tags-class_method" title="ActiveSupport::TagStack.with_tags (method)">with_tags</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unsubscribe-instance_method">
  <h3 class='signature '>
    #<strong>unsubscribe</strong>(subscriber)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Unregister an event subscriber. Accepts either a subscriber or a class.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_subscriber'>subscriber</span> <span class='op'>=</span> <span class='const'>MyEventSubscriber</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::EventReporter.new (method)">new</a></span>
<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_subscribe'><a href="#subscribe-instance_method" title="ActiveSupport::EventReporter#subscribe (method)">subscribe</a></span>(<span class='id identifier rubyid_subscriber'>subscriber</span>)

<span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_unsubscribe'>unsubscribe</span>(<span class='id identifier rubyid_subscriber'>subscriber</span>)
<span class='comment'># or
</span><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_unsubscribe'>unsubscribe</span>(<span class='const'>MyEventSubscriber</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L332-L334'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='332' data-end='334'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 332</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unsubscribe'>unsubscribe</span>(<span class='id identifier rubyid_subscriber'>subscriber</span>)
  <span class='ivar'>@subscribers</span>.<span class='id identifier rubyid_delete_if'>delete_if</span> { <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_subscriber'>subscriber</span> <span class='op'>===</span> <span class='id identifier rubyid_s'>s</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_subscriber'>subscriber</span>] }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_debug-instance_method">
  <h3 class='signature '>
    #<strong>with_debug</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Temporarily enables debug mode for the duration of the block. Calls to <a href="#debug-instance_method" title="ActiveSupport::EventReporter#debug (method)">#debug</a> will only be reported if debug mode is enabled.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_with_debug'>with_debug</span> <span class='kw'>do</span>
  <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_event'><a href="../Rails.html#event-class_method" title="Rails.event (method)">event</a></span>.<span class='id identifier rubyid_debug'><a href="#debug-instance_method" title="ActiveSupport::EventReporter#debug (method)">debug</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sql.query</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> { <span class='label'>sql:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span> })
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/event_reporter.rb#L424-L430'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='424' data-end='430'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/event_reporter.rb', line 424</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_debug'>with_debug</span>
  <span class='id identifier rubyid_prior'>prior</span> <span class='op'>=</span> <span class='const'>Fiber</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_event_reporter_debug_mode'>event_reporter_debug_mode</span>]
  <span class='const'>Fiber</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_event_reporter_debug_mode'>event_reporter_debug_mode</span>] <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='const'>Fiber</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_event_reporter_debug_mode'>event_reporter_debug_mode</span>] <span class='op'>=</span> <span class='id identifier rubyid_prior'>prior</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>