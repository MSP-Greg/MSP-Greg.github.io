<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveSupport::MessageVerifier &mdash; Rails main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveSupport::MessageVerifier",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails main</a> &raquo; 
      <a href='../_index.html#alpha_M'>Index (M)</a> &raquo; 
        <a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>MessageVerifier&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveSupport::MessageVerifier</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)"><code>InvalidSignature</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)"><code>Messages::Codec</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="Messages/Rotator.html" title="ActiveSupport::Messages::Rotator (module)"><code>Messages::Rotator</code></a>,
          <a class='nodoc' href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)"><code>Messages::Codec</code></a>,
          <a class='nodoc' href="Messages/Metadata.html" title="ActiveSupport::Messages::Metadata (module)"><code>Messages::Metadata</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a class='nodoc' href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)">ActiveSupport::Messages::Codec</a></span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a class='nodoc' href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)">ActiveSupport::Messages::Codec</a></li>
          <li class='next'>ActiveSupport::MessageVerifier</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L110'>activesupport/lib/active_support/message_verifier.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>MessageVerifier</code> makes it easy to generate and verify messages which are signed to prevent tampering.</p>

<p>In a Rails application, you can use <code>Rails.application.message_verifier</code> to manage unique instances of verifiers for each use case. <a href="classes/Rails/Application.html#method-i-message_verifier">Learn more</a>.</p>

<p>This is useful for cases like remember-me tokens and auto-unsubscribe links where the session store isn’t suitable or available.</p>

<p>First, generate a signed message:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cookies'>cookies</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_remember_me'>remember_me</span>] <span class='op'>=</span> <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="../Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_message_verifier'>message_verifier</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_remember_me'>remember_me</span>).<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>([<span class='ivar'>@user</span>.<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='int'>2</span>.<span class='id identifier rubyid_weeks'>weeks</span>.<span class='id identifier rubyid_from_now'>from_now</span>])</code></pre>

<p>Later verify that message:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="../Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_message_verifier'>message_verifier</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_remember_me'>remember_me</span>).<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_cookies'>cookies</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_remember_me'>remember_me</span>])
<span class='kw'>if</span> <span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_future?'>future?</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_current_user'>current_user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>)
<span class='kw'>end</span></code></pre>

<h3 id="label-Signing+is+not+encryption">Signing is not encryption</h3>

<p>The signed messages are not encrypted. The payload is merely encoded (Base64 by default) and can be decoded by anyone. The signature is just assuring that the message wasn’t tampered with. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="../Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_message_verifier'>message_verifier</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my_purpose</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>never put secrets here</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; &quot;BAhJIhtuZXZlciBwdXQgc2VjcmV0cyBoZXJlBjoGRVQ=--a0c1c0827919da5e949e989c971249355735e140&quot;
</span><span class='const'>Base64</span>.<span class='id identifier rubyid_decode64'>decode64</span>(<span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_first'>first</span>) <span class='comment'># no key needed
</span><span class='comment'># =&gt; &#39;never put secrets here&#39;</span></code></pre>

<p>If you also need to encrypt the contents, you must use <a href="MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)"><code>MessageEncryptor</code></a> instead.</p>

<h3 id="label-Confine+messages+to+a+specific+purpose">Confine messages to a specific purpose</h3>

<p>It’s not recommended to use the same verifier for different purposes in your application. Doing so could allow a malicious actor to re-use a signed message to perform an unauthorized action. You can reduce this risk by confining signed messages to a specific <code>:purpose</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_login'>login</span>)</code></pre>

<p>Then that same purpose must be passed when verifying to get the data back out:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_login'>login</span>)    <span class='comment'># =&gt; &quot;signed message&quot;
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_shipping'>shipping</span>) <span class='comment'># =&gt; nil
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_token'>token</span>)                     <span class='comment'># =&gt; nil
</span>
<span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_login'>login</span>)      <span class='comment'># =&gt; &quot;signed message&quot;
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_shipping'>shipping</span>)   <span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_token'>token</span>)                       <span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature</span></code></pre>

<p>Likewise, if a message has no purpose it won’t be returned when verifying with a specific purpose.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span>)
<span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redirect'>redirect</span>) <span class='comment'># =&gt; nil
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_token'>token</span>)                     <span class='comment'># =&gt; &quot;signed message&quot;
</span>
<span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redirect'>redirect</span>)   <span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_token'>token</span>)                       <span class='comment'># =&gt; &quot;signed message&quot;</span></code></pre>

<h3 id="label-Expiring+messages">Expiring messages</h3>

<p>By default messages last forever and verifying one year from now will still return the original value. But messages can be set to expire at a given time with <code>:expires_in</code> or <code>:expires_at</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='int'>1</span>.<span class='id identifier rubyid_month'>month</span>)
<span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires_at:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>.<span class='id identifier rubyid_end_of_year'>end_of_year</span>)</code></pre>

<p><a href="Messages.html" title="ActiveSupport::Messages (module)"><code>Messages</code></a> can then be verified and returned until expiry. Thereafter, the <a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">#verified</a> method returns <code>nil</code> while <a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">#verify</a> raises <a href="MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)"><code>InvalidSignature</code></a>.</p>

<h3 id="label-Rotating+keys">Rotating keys</h3>

<p><code>MessageVerifier</code> also supports rotating out old configurations by falling back to a stack of verifiers. Call <code>rotate</code> to build and add a verifier so either <a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">#verified</a> or <a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">#verify</a> will also try verifying with the fallback.</p>

<p>By default any rotated verifiers use the values of the primary verifier unless specified otherwise.</p>

<p>You’d give your verifier the new defaults:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='ivar'>@secret</span><span class='comma'>,</span> <span class='label'>digest:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA512</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>serializer:</span> <span class='const'><a href="JSON.html" title="ActiveSupport::JSON (module)">JSON</a></span>)</code></pre>

<p>Then gradually rotate the old values out by adding them as fallbacks. Any message generated with the old values will then work until the rotation is removed.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_rotate'>rotate</span>(<span class='id identifier rubyid_old_secret'>old_secret</span>)          <span class='comment'># Fallback to an old secret instead of @secret.
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_rotate'>rotate</span>(<span class='label'>digest:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&quot;</span></span>)    <span class='comment'># Fallback to an old digest instead of SHA512.
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_rotate'>rotate</span>(<span class='label'>serializer:</span> <span class='const'>Marshal</span>) <span class='comment'># Fallback to an old serializer instead of JSON.</span></code></pre>

<p>Though the above would most likely be combined into one rotation:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_rotate'>rotate</span>(<span class='id identifier rubyid_old_secret'>old_secret</span><span class='comma'>,</span> <span class='label'>digest:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>serializer:</span> <span class='const'>Marshal</span>)</code></pre>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='SEPARATOR-constant' class='summary_signature nodoc'>SEPARATOR =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L115-L115'># File 'activesupport/lib/active_support/message_verifier.rb', line 115</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='SEPARATOR_LENGTH-constant' class='summary_signature nodoc'>SEPARATOR_LENGTH =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L116-L116'># File 'activesupport/lib/active_support/message_verifier.rb', line 116</a>    <pre class='code ruby'><span class='const'><a href="#SEPARATOR-constant" title="ActiveSupport::MessageVerifier::SEPARATOR (constant)">SEPARATOR</a></span>.<span class='id identifier rubyid_length'>length</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="Messages/Metadata.html" title="ActiveSupport::Messages::Metadata (module)"><code>Messages::Metadata</code></a> - Included</h3>
  <p  class='inherited'>
    <a class='nodoc' href="Messages/Metadata.html#ENVELOPE_SERIALIZERS-constant" title="ActiveSupport::Messages::Metadata::ENVELOPE_SERIALIZERS (constant)">ENVELOPE_SERIALIZERS</a>, 
    <a class='nodoc' href="Messages/Metadata.html#TIMESTAMP_SERIALIZERS-constant" title="ActiveSupport::Messages::Metadata::TIMESTAMP_SERIALIZERS (constant)">TIMESTAMP_SERIALIZERS</a>
  </p>
</div>

<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited nodoc'><a href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)"><code>Messages::Codec</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m rw nodoc' href="Messages/Codec.html#default_serializer-class_method" title="ActiveSupport::Messages::Codec.default_serializer (method)">.default_serializer</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(secret, **options)  &#x21d2; MessageVerifier </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Initialize a new <code>MessageVerifier</code> with a secret for the signature.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)"><code>Messages::Codec</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Messages/Codec.html#new-class_method" title="ActiveSupport::Messages::Codec.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited nodoc'><a href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)"><code>Messages::Codec</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro priv nodoc' href="Messages/Codec.html#serializer-instance_method" title="ActiveSupport::Messages::Codec#serializer (method)">#serializer</a>,
        <a class='i_m ro priv nodoc' href="Messages/Codec.html#use_message_serializer_for_metadata%3F-instance_method" title="ActiveSupport::Messages::Codec#use_message_serializer_for_metadata? (method)">#use_message_serializer_for_metadata?</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited nodoc'><a href="Messages/Metadata.html" title="ActiveSupport::Messages::Metadata (module)"><code>Messages::Metadata</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m rw nodoc' href="Messages/Metadata.html#use_message_serializer_for_metadata-instance_method" title="ActiveSupport::Messages::Metadata#use_message_serializer_for_metadata (method)">#use_message_serializer_for_metadata</a>,
        <a class='i_m rw priv nodoc' href="Messages/Metadata.html#use_message_serializer_for_metadata%3F-instance_method" title="ActiveSupport::Messages::Metadata#use_message_serializer_for_metadata? (method)">#use_message_serializer_for_metadata?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#generate-instance_method" title="#generate (instance method)">#<strong>generate</strong>(value, **options)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generates a signed message for the provided value.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#valid_message%3F-instance_method" title="#valid_message? (instance method)">#<strong>valid_message?</strong>(message)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if a signed message could have been generated by signing an object with the <code>MessageVerifier</code>‘s secret.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#verified-instance_method" title="#verified (instance method)">#<strong>verified</strong>(message, **options)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Decodes the signed message using the <code>MessageVerifier</code>‘s secret.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#verify-instance_method" title="#verify (instance method)">#<strong>verify</strong>(message, **options)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Decodes the signed message using the <code>MessageVerifier</code>‘s secret.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#decode-instance_method" title="#decode (instance method)">#<strong>decode</strong>(encoded, url_safe: @url_safe)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#digest_length_in_hex-instance_method" title="#digest_length_in_hex (instance method)">#<strong>digest_length_in_hex</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#digest_matches_data%3F-instance_method" title="#digest_matches_data? (instance method)">#<strong>digest_matches_data?</strong>(digest, data)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#extract_encoded-instance_method" title="#extract_encoded (instance method)">#<strong>extract_encoded</strong>(signed)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#generate_digest-instance_method" title="#generate_digest (instance method)">#<strong>generate_digest</strong>(data)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#separator_at%3F-instance_method" title="#separator_at? (instance method)">#<strong>separator_at?</strong>(signed_message, index)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#separator_index_for-instance_method" title="#separator_index_for (instance method)">#<strong>separator_index_for</strong>(signed_message)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#sign_encoded-instance_method" title="#sign_encoded (instance method)">#<strong>sign_encoded</strong>(encoded)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#create_message-instance_method" title="#create_message (instance method)">#<strong>create_message</strong>(value, **options)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#read_message-instance_method" title="#read_message (instance method)">#<strong>read_message</strong>(message, **options)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="Messages/Rotator.html" title="ActiveSupport::Messages::Rotator (module)"><code>Messages::Rotator</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Messages/Rotator.html#fall_back_to-instance_method" title="ActiveSupport::Messages::Rotator#fall_back_to (method)">#fall_back_to</a>,
        <a class='i_m nodoc' href="Messages/Rotator.html#initialize-instance_method" title="ActiveSupport::Messages::Rotator#initialize (method)">#initialize</a>,
        <a class='i_m nodoc' href="Messages/Rotator.html#initialize_dup-instance_method" title="ActiveSupport::Messages::Rotator#initialize_dup (method)">#initialize_dup</a>,
        <a class='i_m nodoc' href="Messages/Rotator.html#on_rotation-instance_method" title="ActiveSupport::Messages::Rotator#on_rotation (method)">#on_rotation</a>,
        <a class='i_m nodoc' href="Messages/Rotator.html#read_message-instance_method" title="ActiveSupport::Messages::Rotator#read_message (method)">#read_message</a>,
        <a class='i_m nodoc' href="Messages/Rotator.html#rotate-instance_method" title="ActiveSupport::Messages::Rotator#rotate (method)">#rotate</a>,
        <a class='i_m priv nodoc' href="Messages/Rotator.html#build_rotation-instance_method" title="ActiveSupport::Messages::Rotator#build_rotation (method)">#build_rotation</a>,
        <a class='i_m priv nodoc' href="Messages/Rotator.html#catch_rotation_error-instance_method" title="ActiveSupport::Messages::Rotator#catch_rotation_error (method)">#catch_rotation_error</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited nodoc'><a href="Messages/Codec.html" title="ActiveSupport::Messages::Codec (class)"><code>Messages::Codec</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Messages/Codec.html#catch_and_ignore-instance_method" title="ActiveSupport::Messages::Codec#catch_and_ignore (method)">#catch_and_ignore</a>,
        <a class='i_m priv nodoc' href="Messages/Codec.html#catch_and_raise-instance_method" title="ActiveSupport::Messages::Codec#catch_and_raise (method)">#catch_and_raise</a>,
        <a class='i_m priv nodoc' href="Messages/Codec.html#decode-instance_method" title="ActiveSupport::Messages::Codec#decode (method)">#decode</a>,
        <a class='i_m priv nodoc' href="Messages/Codec.html#deserialize-instance_method" title="ActiveSupport::Messages::Codec#deserialize (method)">#deserialize</a>,
        <a class='i_m priv nodoc' href="Messages/Codec.html#encode-instance_method" title="ActiveSupport::Messages::Codec#encode (method)">#encode</a>,
        <a class='i_m priv nodoc' href="Messages/Codec.html#serialize-instance_method" title="ActiveSupport::Messages::Codec#serialize (method)">#serialize</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited nodoc'><a href="Messages/Metadata.html" title="ActiveSupport::Messages::Metadata (module)"><code>Messages::Metadata</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Messages/Metadata.html#deserialize_from_json-instance_method" title="ActiveSupport::Messages::Metadata#deserialize_from_json (method)">#deserialize_from_json</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#deserialize_from_json_safe_string-instance_method" title="ActiveSupport::Messages::Metadata#deserialize_from_json_safe_string (method)">#deserialize_from_json_safe_string</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#deserialize_with_metadata-instance_method" title="ActiveSupport::Messages::Metadata#deserialize_with_metadata (method)">#deserialize_with_metadata</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#dual_serialized_metadata_envelope_json%3F-instance_method" title="ActiveSupport::Messages::Metadata#dual_serialized_metadata_envelope_json? (method)">#dual_serialized_metadata_envelope_json?</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#extract_from_metadata_envelope-instance_method" title="ActiveSupport::Messages::Metadata#extract_from_metadata_envelope (method)">#extract_from_metadata_envelope</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#metadata_envelope%3F-instance_method" title="ActiveSupport::Messages::Metadata#metadata_envelope? (method)">#metadata_envelope?</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#parse_expiry-instance_method" title="ActiveSupport::Messages::Metadata#parse_expiry (method)">#parse_expiry</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#pick_expiry-instance_method" title="ActiveSupport::Messages::Metadata#pick_expiry (method)">#pick_expiry</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#serialize_to_json-instance_method" title="ActiveSupport::Messages::Metadata#serialize_to_json (method)">#serialize_to_json</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#serialize_to_json_safe_string-instance_method" title="ActiveSupport::Messages::Metadata#serialize_to_json_safe_string (method)">#serialize_to_json_safe_string</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#serialize_with_metadata-instance_method" title="ActiveSupport::Messages::Metadata#serialize_with_metadata (method)">#serialize_with_metadata</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#wrap_in_metadata_envelope-instance_method" title="ActiveSupport::Messages::Metadata#wrap_in_metadata_envelope (method)">#wrap_in_metadata_envelope</a>,
        <a class='i_m priv nodoc' href="Messages/Metadata.html#wrap_in_metadata_legacy_envelope-instance_method" title="ActiveSupport::Messages::Metadata#wrap_in_metadata_legacy_envelope (method)">#wrap_in_metadata_legacy_envelope</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(secret, **options)  &#x21d2; <code>MessageVerifier</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initialize a new <code>MessageVerifier</code> with a secret for the signature.</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:digest</code></dt>
<dd>
<p>Digest used for signing. The default is <code>&quot;SHA1&quot;</code>. See <code>OpenSSL::Digest</code> for alternatives.</p>
</dd><dt><code>:serializer</code></dt>
<dd>
<p>The serializer used to serialize message data. You can specify any object that responds to <code>dump</code> and <code>load</code>, or you can choose from several preconfigured serializers: <code>:marshal</code>, <code>:json_allow_marshal</code>, <code>:json</code>, <code>:message_pack_allow_marshal</code>, <code>:message_pack</code>.</p>

<p>The preconfigured serializers include a fallback mechanism to support multiple deserialization formats. For example, the <code>:marshal</code> serializer will serialize using <code>Marshal</code>, but can deserialize using <code>Marshal</code>, ActiveSupport::JSON, or ActiveSupport::MessagePack. This makes it easy to migrate between serializers.</p>

<p>The <code>:marshal</code>, <code>:json_allow_marshal</code>, and <code>:message_pack_allow_marshal</code> serializers support deserializing using <code>Marshal</code>, but the others do not. Beware that <code>Marshal</code> is a potential vector for deserialization attacks in cases where a message signing secret has been leaked. <em>If possible, choose a serializer that does not support <code>Marshal</code>.</em></p>

<p>The <code>:message_pack</code> and <code>:message_pack_allow_marshal</code> serializers use ActiveSupport::MessagePack, which can roundtrip some Ruby types that are not supported by JSON, and may provide improved performance. However, these require the <code>msgpack</code> gem.</p>

<p>When using Rails, the default depends on <code>config.active_support.message_serializer</code>. Otherwise, the default is <code>:marshal</code>.</p>
</dd><dt><code>:url_safe</code></dt>
<dd>
<p>By default, MessageVerifier generates RFC 4648 compliant strings which are not URL-safe. In other words, they can contain “+” and “/”. If you want to generate URL-safe strings (in compliance with “Base 64 Encoding with URL and Filename Safe Alphabet” in RFC 4648), you can pass <code>true</code>. Note that MessageVerifier will always accept both URL-safe and URL-unsafe encoded messages, to allow a smooth transition between the two settings.</p>
</dd><dt><code>:force_legacy_metadata_serializer</code></dt>
<dd>
<p>Whether to use the legacy metadata serializer, which serializes the message first, then wraps it in an envelope which is also serialized. This was the default in Rails 7.0 and below.</p>

<p>If you don’t pass a truthy value, the default is set using <code>config.active_support.use_message_serializer_for_metadata</code>.</p>
</dd></dl>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L167-L172'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='167' data-end='172'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 167</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Secret should not be nil.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_secret'>secret</span>
  <span class='kw'>super</span>(<span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
  <span class='ivar'>@secret</span> <span class='op'>=</span> <span class='id identifier rubyid_secret'>secret</span>
  <span class='ivar'>@digest</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_digest'>digest</span>]<span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA1</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="create_message-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>create_message</strong>(value, **options)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L310-L312'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='310' data-end='312'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 310</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_message'>create_message</span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_sign_encoded'><a href="#sign_encoded-instance_method" title="ActiveSupport::MessageVerifier#sign_encoded (method)">sign_encoded</a></span>(<span class='id identifier rubyid_encode'>encode</span>(<span class='id identifier rubyid_serialize_with_metadata'>serialize_with_metadata</span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decode-instance_method">
  <h3 class='signature priv'>
    #<strong>decode</strong>(encoded, url_safe: @url_safe)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L323-L328'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='323' data-end='328'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 323</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decode'>decode</span>(<span class='id identifier rubyid_encoded'>encoded</span><span class='comma'>,</span> <span class='label'>url_safe:</span> <span class='ivar'>@url_safe</span>)
  <span class='id identifier rubyid_catch'>catch</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_format'>invalid_message_format</span> <span class='kw'>do</span>
    <span class='kw'>return</span> <span class='kw'>super</span>
  <span class='kw'>end</span>
  <span class='kw'>super</span>(<span class='id identifier rubyid_encoded'>encoded</span><span class='comma'>,</span> <span class='label'>url_safe:</span> <span class='op'>!</span><span class='id identifier rubyid_url_safe'>url_safe</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="digest_length_in_hex-instance_method">
  <h3 class='signature priv'>
    #<strong>digest_length_in_hex</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L356-L362'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='356' data-end='362'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 356</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_digest_length_in_hex'>digest_length_in_hex</span>
  <span class='comment'># In hexadecimal (AKA base16) it takes 4 bits to represent a character,
</span>  <span class='comment'># hence we multiply the digest&#39;s length (in bytes) by 8 to get it in
</span>  <span class='comment'># bits and divide by 4 to get its number of characters it hex. Well, 8
</span>  <span class='comment'># divided by 4 is 2.
</span>  <span class='ivar'>@digest_length_in_hex</span> <span class='op'>||=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'><a href="Digest.html" title="ActiveSupport::Digest (class)">Digest</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='ivar'>@digest</span>).<span class='id identifier rubyid_digest_length'>digest_length</span> <span class='op'>*</span> <span class='int'>2</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="digest_matches_data?-instance_method">
  <h3 class='signature priv'>
    #<strong>digest_matches_data?</strong>(digest, data)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L373-L375'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='373' data-end='375'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 373</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_digest_matches_data?'>digest_matches_data?</span>(<span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>)
  <span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_digest'>digest</span>.<span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span>.<span class='id identifier rubyid_secure_compare'><a href="SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">secure_compare</a></span>(<span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_generate_digest'><a href="#generate_digest-instance_method" title="ActiveSupport::MessageVerifier#generate_digest (method)">generate_digest</a></span>(<span class='id identifier rubyid_data'>data</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extract_encoded-instance_method">
  <h3 class='signature priv'>
    #<strong>extract_encoded</strong>(signed)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L335-L350'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='335' data-end='350'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 335</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_encoded'>extract_encoded</span>(<span class='id identifier rubyid_signed'>signed</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_signed'>signed</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_signed'>signed</span>.<span class='id identifier rubyid_valid_encoding?'>valid_encoding?</span>
    <span class='id identifier rubyid_throw'>throw</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_format'>invalid_message_format</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid message string</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_separator_index'>separator_index</span> <span class='op'>=</span> <span class='id identifier rubyid_separator_index_for'><a href="#separator_index_for-instance_method" title="ActiveSupport::MessageVerifier#separator_index_for (method)">separator_index_for</a></span>(<span class='id identifier rubyid_signed'>signed</span>)
    <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_signed'>signed</span>[<span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_separator_index'>separator_index</span>]
    <span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='id identifier rubyid_signed'>signed</span>[<span class='id identifier rubyid_separator_index'>separator_index</span> <span class='op'>+</span> <span class='const'><a href="#SEPARATOR_LENGTH-constant" title="ActiveSupport::MessageVerifier::SEPARATOR_LENGTH (constant)">SEPARATOR_LENGTH</a></span><span class='comma'>,</span> <span class='id identifier rubyid_digest_length_in_hex'><a href="#digest_length_in_hex-instance_method" title="ActiveSupport::MessageVerifier#digest_length_in_hex (method)">digest_length_in_hex</a></span>]
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_digest_matches_data?'><a href="#digest_matches_data%3F-instance_method" title="ActiveSupport::MessageVerifier#digest_matches_data? (method)">digest_matches_data?</a></span>(<span class='id identifier rubyid_digest'>digest</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded'>encoded</span>)
    <span class='id identifier rubyid_throw'>throw</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_format'>invalid_message_format</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mismatched digest</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_encoded'>encoded</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generate-instance_method">
  <h3 class='signature '>
    #<strong>generate</strong>(value, **options)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generates a signed message for the provided value.</p>

<p>The message is signed with the <code>MessageVerifier</code>‘s secret. Returns Base64-encoded message joined with the generated signature.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; &quot;BAhJIhNzaWduZWQgbWVzc2FnZQY6BkVU--f67d5f27c3ee0b8483cebf2103757455e947493b&quot;</span></code></pre>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:expires_at</code></dt>
<dd>
<p>The datetime at which the message expires. After this datetime, verification of the message will fail.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires_at:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>.<span class='id identifier rubyid_tomorrow'>tomorrow</span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_message'>message</span>) <span class='comment'># =&gt; &quot;hello&quot;
</span><span class='comment'># 24 hours later...
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_message'>message</span>) <span class='comment'># =&gt; nil
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_message'>message</span>)   <span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature</span></code></pre>
</dd><dt><code>:expires_in</code></dt>
<dd>
<p>The duration for which the message is valid. After this duration has elapsed, verification of the message will fail.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='int'>24</span>.<span class='id identifier rubyid_hours'>hours</span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_message'>message</span>) <span class='comment'># =&gt; &quot;hello&quot;
</span><span class='comment'># 24 hours later...
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'><a href="#verified-instance_method" title="ActiveSupport::MessageVerifier#verified (method)">verified</a></span>(<span class='id identifier rubyid_message'>message</span>) <span class='comment'># =&gt; nil
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'><a href="#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">verify</a></span>(<span class='id identifier rubyid_message'>message</span>)   <span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature</span></code></pre>
</dd><dt><code>:purpose</code></dt>
<dd>
<p>The purpose of the message. If specified, the same purpose must be specified when verifying the message; otherwise, verification will fail. (See #verified and #verify.)</p>
</dd></dl>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L306-L308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='306' data-end='308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 306</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_generate'>generate</span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
  <span class='id identifier rubyid_create_message'><a href="#create_message-instance_method" title="ActiveSupport::MessageVerifier#create_message (method)">create_message</a></span>(<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generate_digest-instance_method">
  <h3 class='signature priv'>
    #<strong>generate_digest</strong>(data)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L352-L354'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='352' data-end='354'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 352</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_digest'>generate_digest</span>(<span class='id identifier rubyid_data'>data</span>)
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span>.<span class='id identifier rubyid_hexdigest'>hexdigest</span>(<span class='ivar'>@digest</span><span class='comma'>,</span> <span class='ivar'>@secret</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature nodoc'>
    #<strong>inspect</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L318-L320'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='318' data-end='320'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 318</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'># :nodoc:
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%#016x</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> (<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_message-instance_method">
  <h3 class='signature nodoc'>
    #<strong>read_message</strong>(message, **options)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L314-L316'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='314' data-end='316'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 314</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_message'>read_message</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_deserialize_with_metadata'>deserialize_with_metadata</span>(<span class='id identifier rubyid_decode'><a href="#decode-instance_method" title="ActiveSupport::MessageVerifier#decode (method)">decode</a></span>(<span class='id identifier rubyid_extract_encoded'><a href="#extract_encoded-instance_method" title="ActiveSupport::MessageVerifier#extract_encoded (method)">extract_encoded</a></span>(<span class='id identifier rubyid_message'>message</span>))<span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="separator_at?-instance_method">
  <h3 class='signature priv'>
    #<strong>separator_at?</strong>(signed_message, index)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L364-L366'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='364' data-end='366'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 364</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_separator_at?'>separator_at?</span>(<span class='id identifier rubyid_signed_message'>signed_message</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span>)
  <span class='id identifier rubyid_signed_message'>signed_message</span>[<span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='const'><a href="#SEPARATOR_LENGTH-constant" title="ActiveSupport::MessageVerifier::SEPARATOR_LENGTH (constant)">SEPARATOR_LENGTH</a></span>] <span class='op'>==</span> <span class='const'><a href="#SEPARATOR-constant" title="ActiveSupport::MessageVerifier::SEPARATOR (constant)">SEPARATOR</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="separator_index_for-instance_method">
  <h3 class='signature priv'>
    #<strong>separator_index_for</strong>(signed_message)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L368-L371'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='368' data-end='371'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 368</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_separator_index_for'>separator_index_for</span>(<span class='id identifier rubyid_signed_message'>signed_message</span>)
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_signed_message'>signed_message</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='id identifier rubyid_digest_length_in_hex'><a href="#digest_length_in_hex-instance_method" title="ActiveSupport::MessageVerifier#digest_length_in_hex (method)">digest_length_in_hex</a></span> <span class='op'>-</span> <span class='const'><a href="#SEPARATOR_LENGTH-constant" title="ActiveSupport::MessageVerifier::SEPARATOR_LENGTH (constant)">SEPARATOR_LENGTH</a></span>
  <span class='id identifier rubyid_index'>index</span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span>.<span class='id identifier rubyid_negative?'>negative?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_separator_at?'><a href="#separator_at%3F-instance_method" title="ActiveSupport::MessageVerifier#separator_at? (method)">separator_at?</a></span>(<span class='id identifier rubyid_signed_message'>signed_message</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sign_encoded-instance_method">
  <h3 class='signature priv'>
    #<strong>sign_encoded</strong>(encoded)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L330-L333'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='330' data-end='333'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 330</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sign_encoded'>sign_encoded</span>(<span class='id identifier rubyid_encoded'>encoded</span>)
  <span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_digest'><a href="#generate_digest-instance_method" title="ActiveSupport::MessageVerifier#generate_digest (method)">generate_digest</a></span>(<span class='id identifier rubyid_encoded'>encoded</span>)
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="#SEPARATOR-constant" title="ActiveSupport::MessageVerifier::SEPARATOR (constant)">SEPARATOR</a></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_digest'>digest</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_message?-instance_method">
  <h3 class='signature '>
    #<strong>valid_message?</strong>(message)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if a signed message could have been generated by signing an object with the <code>MessageVerifier</code>‘s secret.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_signed_message'>signed_message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_valid_message?'>valid_message?</span>(<span class='id identifier rubyid_signed_message'>signed_message</span>) <span class='comment'># =&gt; true
</span>
<span class='id identifier rubyid_tampered_message'>tampered_message</span> <span class='op'>=</span> <span class='id identifier rubyid_signed_message'>signed_message</span>.<span class='id identifier rubyid_chop'>chop</span> <span class='comment'># editing the message invalidates the signature
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_valid_message?'>valid_message?</span>(<span class='id identifier rubyid_tampered_message'>tampered_message</span>) <span class='comment'># =&gt; false</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L183-L185'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='183' data-end='185'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 183</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_message?'>valid_message?</span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_catch_and_ignore'>catch_and_ignore</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_format'>invalid_message_format</span>) { <span class='id identifier rubyid_extract_encoded'><a href="#extract_encoded-instance_method" title="ActiveSupport::MessageVerifier#extract_encoded (method)">extract_encoded</a></span>(<span class='id identifier rubyid_message'>message</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verified-instance_method">
  <h3 class='signature '>
    #<strong>verified</strong>(message, **options)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Decodes the signed message using the <code>MessageVerifier</code>‘s secret.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span>)

<span class='id identifier rubyid_signed_message'>signed_message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_signed_message'>signed_message</span>) <span class='comment'># =&gt; &quot;signed message&quot;</span></code></pre>

<p>Returns <code>nil</code> if the message was not signed with the same secret.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_other_verifier'>other_verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>different_secret</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_other_verifier'>other_verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_signed_message'>signed_message</span>) <span class='comment'># =&gt; nil</span></code></pre>

<p>Returns <code>nil</code> if the message is not Base64-encoded.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_invalid_message'>invalid_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>f--46a0120593880c733a53b6dad75b42ddc1c8996d</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_invalid_message'>invalid_message</span>) <span class='comment'># =&gt; nil</span></code></pre>

<p>Raises any error raised while decoding the signed message.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_incompatible_message'>incompatible_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test--dad7b06c94abba8d46a15fafaef56c327665d5ff</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_incompatible_message'>incompatible_message</span>) <span class='comment'># =&gt; TypeError: incompatible marshal file format</span></code></pre>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:purpose</code></dt>
<dd>
<p>The purpose that the message was generated with. If the purpose does not match, <code>verified</code> will return <code>nil</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greeting</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greeting</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; &quot;hello&quot;
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chatting</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; nil
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>)                      <span class='comment'># =&gt; nil
</span>
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bye</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>)                      <span class='comment'># =&gt; &quot;bye&quot;
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greeting</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; nil</span></code></pre>
</dd></dl>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L224-L232'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='224' data-end='232'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 224</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
  <span class='id identifier rubyid_catch_and_ignore'>catch_and_ignore</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_format'>invalid_message_format</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_catch_and_raise'>catch_and_raise</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_serialization'>invalid_message_serialization</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_catch_and_ignore'>catch_and_ignore</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_content'>invalid_message_content</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_read_message'><a href="#read_message-instance_method" title="ActiveSupport::MessageVerifier#read_message (method)">read_message</a></span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify-instance_method">
  <h3 class='signature '>
    #<strong>verify</strong>(message, **options)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Decodes the signed message using the <code>MessageVerifier</code>‘s secret.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_signed_message'>signed_message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signed message</span><span class='tstring_end'>&quot;</span></span>)

<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_signed_message'>signed_message</span>) <span class='comment'># =&gt; &quot;signed message&quot;</span></code></pre>

<p>Raises <a href="MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)"><code>MessageVerifier::InvalidSignature</code></a> if the message was not signed with the same secret or was not Base64-encoded.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_other_verifier'>other_verifier</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>MessageVerifier</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>different_secret</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_other_verifier'>other_verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_signed_message'>signed_message</span>) <span class='comment'># =&gt; ActiveSupport::MessageVerifier::InvalidSignature</span></code></pre>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt><code>:purpose</code></dt>
<dd>
<p>The purpose that the message was generated with. If the purpose does not match, <code>verify</code> will raise ActiveSupport::MessageVerifier::InvalidSignature.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greeting</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greeting</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; &quot;hello&quot;
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>chatting</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; raises InvalidSignature
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span>)                      <span class='comment'># =&gt; raises InvalidSignature
</span>
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'><a href="#generate-instance_method" title="ActiveSupport::MessageVerifier#generate (method)">generate</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bye</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span>)                      <span class='comment'># =&gt; &quot;bye&quot;
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>greeting</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; raises InvalidSignature</span></code></pre>
</dd></dl>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/main/activesupport/lib/active_support/message_verifier.rb#L262-L270'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='262' data-end='270'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/message_verifier.rb', line 262</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
  <span class='id identifier rubyid_catch_and_raise'>catch_and_raise</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_format'>invalid_message_format</span><span class='comma'>,</span> <span class='label'>as:</span> <span class='const'><a href="MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)">InvalidSignature</a></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_catch_and_raise'>catch_and_raise</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_serialization'>invalid_message_serialization</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_catch_and_raise'>catch_and_raise</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invalid_message_content'>invalid_message_content</span><span class='comma'>,</span> <span class='label'>as:</span> <span class='const'><a href="MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)">InvalidSignature</a></span> <span class='kw'>do</span>
        <span class='id identifier rubyid_read_message'><a href="#read_message-instance_method" title="ActiveSupport::MessageVerifier#read_message (method)">read_message</a></span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>