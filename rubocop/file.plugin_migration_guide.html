<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Plugin Migration Guide &mdash; RuboCop master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "plugin_migration_guide",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>RuboCop master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Plugin Migration Guide&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The plugin system was introduced in RuboCop 1.72.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An improved API for RuboCop extensions, called plugins, is being introduced to provide officially documented ways to extend RuboCop.
This API is provided by the <a href="https://github.com/standardrb/lint_roller">lint_roller</a> library and is intended to replace previous undocumented
and unofficial methods that emerged out of necessity.</p>
</div>
<div class="paragraph">
<p>As a user, you will need to adjust your <code>.rubocop.yml</code> to load extensions that support this new API differently than before.
As an extension developer, you will need to modify your extension accordingly, as explained below.</p>
</div>
<div class="paragraph">
<p>This page provides guidance on migrating to RuboCop extensions using plugins. It is divided into two main sections:
one for plugin users and the other for plugin developers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_for_plugin_users">For Plugin Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please update the RuboCop extension cops specified in configuration files like <code>.rubocop.yml</code> from <code>require</code> to <code>plugins</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">plugins:
  - rubocop-performance</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifically, those that trigger warnings like the following should be updated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ bundle exec rubocop
rubocop-performance extension supports plugin, specify `plugins: rubocop-performance`
instead of `require: rubocop-performance` in /Users/user/src/github.com/rubocop/rubocop/.rubocop.yml.
For more information, see https://docs.rubocop.org/rubocop/plugin_migration_guide.html.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Non-plugin extension Ruby files can continue to use <code>require</code> for file requiring.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_for_plugin_developers">For Plugin Developers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Converting an existing RuboCop extension using <code>Inject.defaults!</code> into a plugin can generally be done in the following three steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <code>Plugin</code> class</p>
</li>
<li>
<p>Update gemspec file</p>
</li>
<li>
<p>Remove <code>Inject.defaults!</code> code</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>rubocop-performance</code> extension gem is used as an example here.
Replace "performance" with the name of your extension as appropriate.</p>
</div>
<div class="sect2">
<h3 id="_1_create_plugin_class">1. Create <code>Plugin</code> class</h3>
<div class="paragraph">
<p>Prepare the plugin class. It is typically placed under the department directory, such as <code>rubocop/performance/plugin.rb</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="code ruby"><code class="ruby"><span class='comment'># frozen_string_literal: true
</span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lint_roller</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>module</span> <span class='const'><a href="RuboCop.html" title="RuboCop (module)">RuboCop</a></span>
  <span class='kw'>module</span> <span class='const'>Performance</span>
    <span class='comment'># A plugin that integrates RuboCop Performance with RuboCop&#39;s plugin system.
</span>    <span class='kw'>class</span> <span class='const'>Plugin</span> <span class='op'>&lt;</span> <span class='const'>LintRoller</span><span class='op'>::</span><span class='const'>Plugin</span>
      <span class='kw'>def</span> <span class='id identifier rubyid_about'>about</span>
        <span class='const'>LintRoller</span><span class='op'>::</span><span class='const'>About</span>.<span class='id identifier rubyid_new'>new</span>(
          <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubocop-performance</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
          <span class='label'>version:</span> <span class='const'>VERSION</span><span class='comma'>,</span>
          <span class='label'>homepage:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://github.com/rubocop/rubocop-performance</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
          <span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>A collection of RuboCop cops to check for performance optimizations in Ruby code.</span><span class='tstring_end'>&#39;</span></span>
        )
      <span class='kw'>end</span>

      <span class='kw'>def</span> <span class='id identifier rubyid_supported?'>supported?</span>(<span class='id identifier rubyid_context'>context</span>)
        <span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_engine'>engine</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rubocop'>rubocop</span>
      <span class='kw'>end</span>

      <span class='kw'>def</span> <span class='id identifier rubyid_rules'>rules</span>(<span class='id identifier rubyid__context'>_context</span>)
        <span class='const'>LintRoller</span><span class='op'>::</span><span class='const'>Rules</span>.<span class='id identifier rubyid_new'>new</span>(
          <span class='label'>type:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
          <span class='label'>config_format:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rubocop'>rubocop</span><span class='comma'>,</span>
          <span class='label'>value:</span> <span class='const'>Pathname</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid___dir__'>__dir__</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>../../../config/default.yml</span><span class='tstring_end'>&#39;</span></span>)
        )
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For details on configurations, refer to the lint_roller documentation:
<a href="https://github.com/standardrb/lint_roller?tab=readme-ov-file#how-to-make-a-plugin" class="bare">https://github.com/standardrb/lint_roller?tab=readme-ov-file#how-to-make-a-plugin</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_2_update_gemspec_file">2. Update gemspec file</h3>
<div class="paragraph">
<p>Set the plugin class name in <code>spec.metadata['default_lint_roller_plugin']</code> and add a runtime dependency on <code>lint_roller</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_metadata'>metadata</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>default_lint_roller_plugin</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RuboCop::Performance::Plugin</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_add_dependency'>add_dependency</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>lint_roller</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Update <code>rubocop</code> to a version that supports plugins or higher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_add_dependency'>add_dependency</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubocop</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;= 1.72.0</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_3_replace_inject_defaults_code">3. Replace <code>Inject.defaults!</code> code</h3>
<div class="paragraph">
<p>Replace <code>rubocop/performance/inject</code>, where the <code>RuboCop::Performance::Inject</code> class is defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ rm 'rubocop/performance/inject'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remove the call to <code>RuboCop::Performance::Inject.defaults!</code> and the related <code>require_relative</code> code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubocop/performance/inject</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><a href="RuboCop.html" title="RuboCop (module)">RuboCop</a></span><span class='op'>::</span><span class='const'>Performance</span><span class='op'>::</span><span class='const'>Inject</span>.<span class='id identifier rubyid_defaults!'>defaults!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And use <code>require_relative</code> for the plugin class file instead of the above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubocop/performance/plugin</span><span class='tstring_end'>&#39;</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>