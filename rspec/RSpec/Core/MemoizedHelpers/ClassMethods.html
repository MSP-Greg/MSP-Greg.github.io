<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: RSpec::Core::MemoizedHelpers::ClassMethods &mdash; RSpec main</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RSpec::Core::MemoizedHelpers::ClassMethods",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>RSpec main</a> &raquo; 
      <a href='../../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../../RSpec.html" title="RSpec (module)">RSpec</a> &raquo; 
        <a href="../../Core.html" title="RSpec::Core (module)">Core</a> &raquo; 
        <a href="../MemoizedHelpers.html" title="RSpec::Core::MemoizedHelpers (module)">MemoizedHelpers</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: RSpec::Core::MemoizedHelpers::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Extended In:</div>
      <div class='box_11'>
        <a href="../AnonymousExampleGroup.html" title="RSpec::Core::AnonymousExampleGroup (class)"><code>::RSpec::Core::AnonymousExampleGroup</code></a>,
          <a href="../ExampleGroup.html" title="RSpec::Core::ExampleGroup (class)"><code>::RSpec::Core::ExampleGroup</code></a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rspec/rspec-core/blob/main/lib/rspec/core/memoized_helpers.rb#L274'>rspec-core/lib/rspec/core/memoized_helpers.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This module is extended onto <a href="../ExampleGroup.html" title="RSpec::Core::ExampleGroup (class)"><code>::RSpec::Core::ExampleGroup</code></a>, making the methods available to be called from within example group blocks. You can think of them as being analagous to class macros.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#let-instance_method" title="#let (instance method)">#<strong>let</strong>(name, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generates a method whose return value is memoized after the first call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#let!-instance_method" title="#let! (instance method)">#<strong>let!</strong>(name, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Just like ‘let`, except the block is invoked by an implicit <code>before</code> hook.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#subject-instance_method" title="#subject (instance method)">#<strong>subject</strong>(name = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Declares a ‘subject` for an example group which can then be wrapped with <code>expect</code> using <a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">#is_expected</a> to make it the target of an expectation in a concise, one-line example.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#subject!-instance_method" title="#subject! (instance method)">#<strong>subject!</strong>(name = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Just like ‘subject`, except the block is invoked by an implicit <code>before</code> hook.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="let-instance_method">
  <h3 class='signature  first'>
    #<strong>let</strong>(name, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>‘let` <em>can</em> enhance readability when used sparingly (1,2, or maybe 3 declarations) in any given example group, but that can quickly degrade with overuse. YMMV.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>‘let` can be configured to be threadsafe or not. If it is threadsafe, it will take longer to access the value. If it is not threadsafe, it may behave in surprising ways in examples that spawn separate threads. Specify this on <a href="../../../RSpec.html#configure-class_method" title="RSpec.configure (method)">RSpec.configure</a></p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Because ‘let` is designed to create state that is reset between each example, and <code>before(:context)</code> is designed to setup state that is shared across <em>all</em> examples in an example group, <code>let</code> is <em>not</em> intended to be used in a <code>before(:context)</code> hook.</p>
</div>
  </div>


<p>Generates a method whose return value is memoized after the first call. Useful for reducing duplication between examples that assign values to the same local variable.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='const'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_describe'>describe</span> <span class='const'>Thing</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_let'>let</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_thing'>thing</span>) { <span class='const'>Thing</span>.<span class='id identifier rubyid_new'>new</span> }

  <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>does something</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='comment'># First invocation, executes block, memoizes and returns result.
</span>    <span class='id identifier rubyid_thing'>thing</span>.<span class='id identifier rubyid_do_something'>do_something</span>

    <span class='comment'># Second invocation, returns the memoized value.
</span>    <span class='id identifier rubyid_thing'>thing</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_be_something'>be_something</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-core/blob/main/lib/rspec/core/memoized_helpers.rb#L306-L345'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='306' data-end='345'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-core/lib/rspec/core/memoized_helpers.rb', line 306</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_let'>let</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='comment'># We have to pass the block directly to `define_method` to
</span>  <span class='comment'># allow it to use method constructs like `super` and `return`.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#let or #subject called without a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># A list of reserved words that can&#39;t be used as a name for a memoized helper
</span>  <span class='comment'># Matches for both symbols and passed strings
</span>  <span class='kw'>if</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_initialize'><a href="../MemoizedHelpers.html#initialize-instance_method" title="RSpec::Core::MemoizedHelpers#initialize (method)">initialize</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>].<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#let or #subject called with reserved name `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>`</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_our_module'>our_module</span> <span class='op'>=</span> <span class='const'><a href="../MemoizedHelpers.html" title="RSpec::Core::MemoizedHelpers (module)">MemoizedHelpers</a></span>.<span class='id identifier rubyid_module_for'><a href="../MemoizedHelpers.html#module_for-class_method" title="RSpec::Core::MemoizedHelpers.module_for (method)">module_for</a></span>(<span class='kw'>self</span>)

  <span class='comment'># If we have a module clash in our helper module
</span>  <span class='comment'># then we need to remove it to prevent a warning.
</span>  <span class='comment'>#
</span>  <span class='comment'># Note we do not check ancestor modules (see: `instance_methods(false)`)
</span>  <span class='comment'># as we can override them.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_our_module'>our_module</span>.<span class='id identifier rubyid_instance_methods'>instance_methods</span>(<span class='kw'>false</span>).<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='id identifier rubyid_our_module'>our_module</span>.<span class='id identifier rubyid___send__'>__send__</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_remove_method'>remove_method</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_our_module'>our_module</span>.<span class='id identifier rubyid___send__'>__send__</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_define_method'>define_method</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)

  <span class='comment'># If we have a module clash in the example module
</span>  <span class='comment'># then we need to remove it to prevent a warning.
</span>  <span class='comment'>#
</span>  <span class='comment'># Note we do not check ancestor modules (see: `instance_methods(false)`)
</span>  <span class='comment'># as we can override them.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_instance_methods'>instance_methods</span>(<span class='kw'>false</span>).<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='id identifier rubyid_remove_method'>remove_method</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>end</span>

  <span class='comment'># Apply the memoization. The method has been defined in an ancestor
</span>  <span class='comment'># module so we can use `super` here to get the value.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='id identifier rubyid_define_method'>define_method</span>(<span class='id identifier rubyid_name'>name</span>) { <span class='id identifier rubyid___memoized'><a href="../MemoizedHelpers.html#__memoized-instance_method" title="RSpec::Core::MemoizedHelpers#__memoized (method)">__memoized</a></span>.<span class='id identifier rubyid_fetch_or_store'>fetch_or_store</span>(<span class='id identifier rubyid_name'>name</span>) { <span class='kw'>super</span>(<span class='const'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_current_example'><a href="../../../RSpec.html#current_example-class_method" title="RSpec.current_example (method)">current_example</a></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='kw'>nil</span>) } }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_define_method'>define_method</span>(<span class='id identifier rubyid_name'>name</span>) { <span class='id identifier rubyid___memoized'><a href="../MemoizedHelpers.html#__memoized-instance_method" title="RSpec::Core::MemoizedHelpers#__memoized (method)">__memoized</a></span>.<span class='id identifier rubyid_fetch_or_store'>fetch_or_store</span>(<span class='id identifier rubyid_name'>name</span>) { <span class='kw'>super</span>(<span class='op'>&amp;</span><span class='kw'>nil</span>) } }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="let!-instance_method">
  <h3 class='signature '>
    #<strong>let!</strong>(name, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Just like ‘let`, except the block is invoked by an implicit <code>before</code> hook. This serves a dual purpose of setting up state and providing a memoized reference to that state.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='kw'>class</span> <span class='const'>Thing</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_count'>count</span>
    <span class='ivar'>@count</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_count='>count=</span>(<span class='id identifier rubyid_val'>val</span>)
    <span class='ivar'>@count</span> <span class='op'>+=</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_reset_count'>reset_count</span>
    <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../MemoizedHelpers.html#initialize-instance_method" title="RSpec::Core::MemoizedHelpers#initialize (method)">initialize</a></span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_describe'>describe</span> <span class='const'>Thing</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_after'>after</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_example'>example</span>) { <span class='const'>Thing</span>.<span class='id identifier rubyid_reset_count'>reset_count</span> }

  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using let</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_let'><a href="#let-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#let (method)">let</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_thing'>thing</span>) { <span class='const'>Thing</span>.<span class='id identifier rubyid_new'>new</span> }

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is not invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>0</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can be invoked explicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_thing'>thing</span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>1</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using let!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_let!'>let!</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_thing'>thing</span>) { <span class='const'>Thing</span>.<span class='id identifier rubyid_new'>new</span> }

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>1</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns memoized version on first invocation</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_thing'>thing</span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>1</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-core/blob/main/lib/rspec/core/memoized_helpers.rb#L400-L403'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='400' data-end='403'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-core/lib/rspec/core/memoized_helpers.rb', line 400</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_let!'>let!</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_let'><a href="#let-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#let (method)">let</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_before'>before</span> { <span class='id identifier rubyid___send__'>__send__</span>(<span class='id identifier rubyid_name'>name</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="subject-instance_method">
  <h3 class='signature '>
    #<strong>subject</strong>(name = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>‘subject` can be configured to be threadsafe or not. If it is threadsafe, it will take longer to access the value. If it is not threadsafe, it may behave in surprising ways in examples that spawn separate threads. Specify this on <a href="../../../RSpec.html#configure-class_method" title="RSpec.configure (method)">RSpec.configure</a></p>
</div>
  </div>


<p>Declares a ‘subject` for an example group which can then be wrapped with <code>expect</code> using <a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">RSpec::Core::MemoizedHelpers#is_expected</a> to make it the target of an expectation in a concise, one-line example.</p>

<p>Given a ‘name`, defines a method with that name which returns the <code>subject</code>. This lets you declare the subject once and access it implicitly in one-liners and explicitly using an intention revealing name.</p>

<p>When given a ‘name`, calling <code>super</code> in the block is not supported.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='const'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_describe'>describe</span> <span class='const'>CheckingAccount</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>with $50</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_subject'>subject</span> { <span class='const'>CheckingAccount</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>Money</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>50</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>USD</span>)) }
  <span class='id identifier rubyid_it'>it</span> { <span class='id identifier rubyid_is_expected'><a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">is_expected</a></span>.<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_have_a_balance_of'>have_a_balance_of</span>(<span class='const'>Money</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>50</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>USD</span>)) }
  <span class='id identifier rubyid_it'>it</span> { <span class='id identifier rubyid_is_expected'><a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">is_expected</a></span>.<span class='id identifier rubyid_not_to'>not_to</span> <span class='id identifier rubyid_be_overdrawn'>be_overdrawn</span> }
<span class='kw'>end</span>

<span class='const'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_describe'>describe</span> <span class='const'>CheckingAccount</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>with a non-zero starting balance</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_subject'>subject</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_account'>account</span>) { <span class='const'>CheckingAccount</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>Money</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>50</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>USD</span>)) }
  <span class='id identifier rubyid_it'>it</span> { <span class='id identifier rubyid_is_expected'><a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">is_expected</a></span>.<span class='id identifier rubyid_not_to'>not_to</span> <span class='id identifier rubyid_be_overdrawn'>be_overdrawn</span> }
  <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has a balance equal to the starting balance</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_balance'>balance</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='const'>Money</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>50</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='const'>USD</span>))
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>name</span>
    <span class='type'>(<code>String</code>, <code>Symbol</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>used to define an accessor with an intention revealing name</p>
</div>
  </li>
  <li>
    <span class='name'>block</span>
    <span class='type'></span>
&mdash;    <div class='inline'>
<p>defines the value to be returned by ‘subject` in examples</p>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">RSpec::Core::MemoizedHelpers#should</a></li>
          <li><a href="../MemoizedHelpers.html#should_not-instance_method" title="RSpec::Core::MemoizedHelpers#should_not (method)">RSpec::Core::MemoizedHelpers#should_not</a></li>
          <li><a href="../MemoizedHelpers.html#is_expected-instance_method" title="RSpec::Core::MemoizedHelpers#is_expected (method)">RSpec::Core::MemoizedHelpers#is_expected</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-core/blob/main/lib/rspec/core/memoized_helpers.rb#L444-L455'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='444' data-end='455'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-core/lib/rspec/core/memoized_helpers.rb', line 444</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_subject'>subject</span>(<span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>
    <span class='id identifier rubyid_let'><a href="#let-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#let (method)">let</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>

    <span class='kw'>self</span><span class='op'>::</span><span class='const'>NamedSubjectPreventSuper</span>.<span class='id identifier rubyid___send__'>__send__</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_define_method'>define_method</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`super` in named subjects is not supported</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_let'><a href="#let-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#let (method)">let</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="subject!-instance_method">
  <h3 class='signature '>
    #<strong>subject!</strong>(name = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Just like ‘subject`, except the block is invoked by an implicit <code>before</code> hook. This serves a dual purpose of setting up state and providing a memoized reference to that state.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='kw'>class</span> <span class='const'>Thing</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_count'>count</span>
    <span class='ivar'>@count</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_count='>count=</span>(<span class='id identifier rubyid_val'>val</span>)
    <span class='ivar'>@count</span> <span class='op'>+=</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_reset_count'>reset_count</span>
    <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../MemoizedHelpers.html#initialize-instance_method" title="RSpec::Core::MemoizedHelpers#initialize (method)">initialize</a></span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'><a href="../../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_describe'>describe</span> <span class='const'>Thing</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_after'>after</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_example'>example</span>) { <span class='const'>Thing</span>.<span class='id identifier rubyid_reset_count'>reset_count</span> }

  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using subject</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_subject'><a href="#subject-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#subject (method)">subject</a></span> { <span class='const'>Thing</span>.<span class='id identifier rubyid_new'>new</span> }

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is not invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>0</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can be invoked explicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_subject'><a href="#subject-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#subject (method)">subject</a></span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>1</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_context'>context</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>using subject!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_subject!'>subject!</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_thing'>thing</span>) { <span class='const'>Thing</span>.<span class='id identifier rubyid_new'>new</span> }

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>is invoked implicitly</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>1</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_it'>it</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>returns memoized version on first invocation</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_subject'><a href="#subject-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#subject (method)">subject</a></span>
      <span class='const'>Thing</span>.<span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_should'><a href="../MemoizedHelpers.html#should-instance_method" title="RSpec::Core::MemoizedHelpers#should (method)">should</a></span> <span class='id identifier rubyid_eq'>eq</span>(<span class='int'>1</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-core/blob/main/lib/rspec/core/memoized_helpers.rb#L510-L513'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='510' data-end='513'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-core/lib/rspec/core/memoized_helpers.rb', line 510</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_subject!'>subject!</span>(<span class='id identifier rubyid_name'>name</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_subject'><a href="#subject-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#subject (method)">subject</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_before'>before</span> { <span class='id identifier rubyid_subject'><a href="#subject-instance_method" title="RSpec::Core::MemoizedHelpers::ClassMethods#subject (method)">subject</a></span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>