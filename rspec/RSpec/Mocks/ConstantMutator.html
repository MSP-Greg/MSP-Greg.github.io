<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: RSpec::Mocks::ConstantMutator &mdash; RSpec main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RSpec::Mocks::ConstantMutator",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>RSpec main</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../RSpec.html" title="RSpec (module)">RSpec</a> &raquo; 
        <a href="../Mocks.html" title="RSpec::Mocks (module)">Mocks</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ConstantMutator&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: RSpec::Mocks::ConstantMutator</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="ConstantMutator/BaseMutator.html" title="RSpec::Mocks::ConstantMutator::BaseMutator (class)"><code>BaseMutator</code></a>,
        <a href="ConstantMutator/ConstantHider.html" title="RSpec::Mocks::ConstantMutator::ConstantHider (class)"><code>ConstantHider</code></a>,
        <a href="ConstantMutator/DefinedConstantReplacer.html" title="RSpec::Mocks::ConstantMutator::DefinedConstantReplacer (class)"><code>DefinedConstantReplacer</code></a>,
        <a href="ConstantMutator/UndefinedConstantSetter.html" title="RSpec::Mocks::ConstantMutator::UndefinedConstantSetter (class)"><code>UndefinedConstantSetter</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../Support/RecursiveConstMethods.html" title="RSpec::Support::RecursiveConstMethods (module)"><code>::RSpec::Support::RecursiveConstMethods</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/mutate_const.rb#L93'>rspec-mocks/lib/rspec/mocks/mutate_const.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Provides a means to stub constants.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#hide-class_method" title=".hide (class method)">.<strong>hide</strong>(constant_name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Hides a constant.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#mutate-class_method" title=".mutate (class method)">.<strong>mutate</strong>(mutator)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Uses the mutator to mutate (stub or hide) a constant.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#raise_on_invalid_const-class_method" title=".raise_on_invalid_const (class method)">.<strong>raise_on_invalid_const</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Used internally by the constant stubbing to raise a helpful error when a constant like “A::B::C” is stubbed and A::B is not a module (and thus, it’s impossible to define “A::B::C” since only modules can have nested constants).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stub-class_method" title=".stub (class method)">.<strong>stub</strong>(constant_name, value, options = {})  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Stubs a constant.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../Support/RecursiveConstMethods.html" title="RSpec::Support::RecursiveConstMethods (module)"><code>::RSpec::Support::RecursiveConstMethods</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Support/RecursiveConstMethods.html#const_defined_on%3F-instance_method" title="RSpec::Support::RecursiveConstMethods#const_defined_on? (method)">const_defined_on?</a></td>
      <td><div class='inline'><p>See additional method definition at line 31.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Support/RecursiveConstMethods.html#constants_defined_on-instance_method" title="RSpec::Support::RecursiveConstMethods#constants_defined_on (method)">constants_defined_on</a></td>
      <td><div class='inline'><p>See additional method definition at line 41.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Support/RecursiveConstMethods.html#get_const_defined_on-instance_method" title="RSpec::Support::RecursiveConstMethods#get_const_defined_on (method)">get_const_defined_on</a></td>
      <td><div class='inline'><p>See additional method definition at line 35.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../Support/RecursiveConstMethods.html#normalize_const_name-instance_method" title="RSpec::Support::RecursiveConstMethods#normalize_const_name (method)">normalize_const_name</a>,
        <a class='i_m ' href="../Support/RecursiveConstMethods.html#recursive_const_defined%3F-instance_method" title="RSpec::Support::RecursiveConstMethods#recursive_const_defined? (method)">recursive_const_defined?</a>,
        <a class='i_m ' href="../Support/RecursiveConstMethods.html#recursive_const_get-instance_method" title="RSpec::Support::RecursiveConstMethods#recursive_const_get (method)">recursive_const_get</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="hide-class_method">
  <h3 class='signature  first'>
    .<strong>hide</strong>(constant_name)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>It’s recommended that you use ‘hide_const` in your examples. This is an alternate public API that is provided so you can hide constants in other contexts (e.g. helper classes).</p>
</div>
  </div>


<p>Hides a constant.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>constant_name</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The fully qualified name of the constant. The current constant scoping at the point of call is not considered.</p>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="ExampleMethods.html#hide_const-instance_method" title="RSpec::Mocks::ExampleMethods#hide_const (method)">ExampleMethods#hide_const</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/mutate_const.rb#L131-L134'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='131' data-end='134'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/mutate_const.rb', line 131</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_hide'>hide</span>(<span class='id identifier rubyid_constant_name'>constant_name</span>)
  <span class='id identifier rubyid_mutate'><a href="#mutate-class_method" title="RSpec::Mocks::ConstantMutator.mutate (method)">mutate</a></span>(<span class='const'><a href="ConstantMutator/ConstantHider.html" title="RSpec::Mocks::ConstantMutator::ConstantHider (class)">ConstantHider</a></span>.<span class='id identifier rubyid_new'><a href="ConstantMutator/BaseMutator.html#new-class_method" title="RSpec::Mocks::ConstantMutator::BaseMutator.new (method)">new</a></span>(<span class='id identifier rubyid_constant_name'>constant_name</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> {}))
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="mutate-class_method">
  <h3 class='signature nodoc'>
    .<strong>mutate</strong>(mutator)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Uses the mutator to mutate (stub or hide) a constant. Ensures that the mutator is correctly registered so it can be backed out at the end of the test.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/mutate_const.rb#L320-L323'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='320' data-end='323'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/mutate_const.rb', line 320</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_mutate'>mutate</span>(<span class='id identifier rubyid_mutator'>mutator</span>)
  <span class='op'>::</span><span class='const'><a href="../../RSpec.html" title="RSpec (module)">RSpec</a></span><span class='op'>::</span><span class='const'><a href="../Mocks.html" title="RSpec::Mocks (module)">Mocks</a></span>.<span class='id identifier rubyid_space'><a href="../Mocks.html#space-class_method" title="RSpec::Mocks.space (method)">space</a></span>.<span class='id identifier rubyid_register_constant_mutator'>register_constant_mutator</span>(<span class='id identifier rubyid_mutator'>mutator</span>)
  <span class='id identifier rubyid_mutator'>mutator</span>.<span class='id identifier rubyid_mutate'>mutate</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_on_invalid_const-class_method">
  <h3 class='signature nodoc'>
    .<strong>raise_on_invalid_const</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Used internally by the constant stubbing to raise a helpful error when a constant like “A::B::C” is stubbed and A::B is not a module (and thus, it’s impossible to define “A::B::C” since only modules can have nested constants).</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/mutate_const.rb#L331-L336'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='331' data-end='336'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/mutate_const.rb', line 331</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_raise_on_invalid_const'>raise_on_invalid_const</span>
  <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_const_name'>const_name</span><span class='comma'>,</span> <span class='id identifier rubyid_failed_name'>failed_name</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot stub constant </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_failed_name'>failed_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_const_name'>const_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> \
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>since </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_const_name'>const_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not a module.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stub-class_method">
  <h3 class='signature '>
    .<strong>stub</strong>(constant_name, value, options = {})  &#x21d2; <code>Object</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>It’s recommended that you use ‘stub_const` in your examples. This is an alternate public API that is provided so you can stub constants in other contexts (e.g. helper classes).</p>
</div>
  </div>


<p>Stubs a constant.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>constant_name</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The fully qualified name of the constant. The current constant scoping at the point of call is not considered.</p>
</div>
  </li>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The value to make the constant refer to. When the example completes, the constant will be restored to its prior state.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>Stubbing options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:transfer_nested_constants</span>
          <span class='type'>(<code>Boolean</code>, <code>Array</code>&lt;<code>Symbol</code>&gt;)</span>
            &mdash; <div class='inline'>
<p>Determines what nested constants, if any, will be transferred from the original value of the constant to the new value of the constant. This only works if both the original and new values are modules (or classes).</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>the stubbed value of the constant</p>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="ExampleMethods.html#stub_const-instance_method" title="RSpec::Mocks::ExampleMethods#stub_const (method)">ExampleMethods#stub_const</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/mutate_const.rb#L107-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='107' data-end='120'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/mutate_const.rb', line 107</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stub'><a href="../../top-level-namespace.html#stub-instance_method" title="#stub (method)">stub</a></span>(<span class='id identifier rubyid_constant_name'>constant_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span>{})
  <span class='kw'>unless</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_constant_name'>constant_name</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`stub_const` requires a String, but you provided a </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_constant_name'>constant_name</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mutator'>mutator</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_recursive_const_defined?'>recursive_const_defined?</span>(<span class='id identifier rubyid_constant_name'>constant_name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_raise_on_invalid_const'><a href="#raise_on_invalid_const-class_method" title="RSpec::Mocks::ConstantMutator.raise_on_invalid_const (method)">raise_on_invalid_const</a></span>)
              <span class='const'><a href="ConstantMutator/DefinedConstantReplacer.html" title="RSpec::Mocks::ConstantMutator::DefinedConstantReplacer (class)">DefinedConstantReplacer</a></span>
            <span class='kw'>else</span>
              <span class='const'><a href="ConstantMutator/UndefinedConstantSetter.html" title="RSpec::Mocks::ConstantMutator::UndefinedConstantSetter (class)">UndefinedConstantSetter</a></span>
            <span class='kw'>end</span>

  <span class='id identifier rubyid_mutate'><a href="#mutate-class_method" title="RSpec::Mocks::ConstantMutator.mutate (method)">mutate</a></span>(<span class='id identifier rubyid_mutator'>mutator</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_constant_name'>constant_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_transfer_nested_constants'>transfer_nested_constants</span>]))
  <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>