<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: RSpec::Mocks::MessageExpectation &mdash; RSpec main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RSpec::Mocks::MessageExpectation",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>RSpec main</a> &raquo; 
      <a href='../../_index.html#alpha_M'>Index (M)</a> &raquo; 
        <a href="../../RSpec.html" title="RSpec (module)">RSpec</a> &raquo; 
        <a href="../Mocks.html" title="RSpec::Mocks (module)">Mocks</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>MessageExpectation&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: RSpec::Mocks::MessageExpectation</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="MessageExpectation/ImplementationDetails.html" title="RSpec::Mocks::MessageExpectation::ImplementationDetails (module)"><code>ImplementationDetails</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <span class='nodoc_h'>RSpec::Mocks::VerifyingMessageExpectation</span>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="MessageExpectation/ImplementationDetails.html" title="RSpec::Mocks::MessageExpectation::ImplementationDetails (module)"><code>ImplementationDetails</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L44'>rspec-mocks/lib/rspec/mocks/message_expectation.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Represents an individual method stub or message expectation. The methods defined here can be used to configure how it behaves. The methods return <code>self</code> so that they can be chained together to form a fluent interface.</p>

  </div>
</div>
</div>
<h2 class='h2_sum'>Configuring Responses</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#and_call_original-instance_method" title="#and_call_original (instance method)">#<strong>and_call_original</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tells the object to delegate to the original unmodified method when it receives the message.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#and_invoke-instance_method" title="#and_invoke (instance method)">#<strong>and_invoke</strong>(first_proc, *procs, &amp;_block)  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tells the object to invoke a Proc when it receives the message.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#and_raise-instance_method" title="#and_raise (instance method)">#<strong>and_raise</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tells the object to raise an exception when the message is received.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#and_return-instance_method" title="#and_return (instance method)">#<strong>and_return</strong>(value)  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tells the object to return a value when it receives the message.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#and_throw-instance_method" title="#and_throw (instance method)">#<strong>and_throw</strong>(symbol)  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tells the object to throw a symbol (with the object if that form is used) when the message is received.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#and_wrap_original-instance_method" title="#and_wrap_original (instance method)">#<strong>and_wrap_original</strong>(&amp;block)  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Decorates the stubbed method with the supplied block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#and_yield-instance_method" title="#and_yield (instance method)">#<strong>and_yield</strong>(*args) {|@eval_context = Object.new| ... } &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tells the object to yield one or more args to a block when the message is received.</p></div>
    </div>
  </li>
</ul>
</div>

<h2 class='h2_sum'>Constraining Receive Counts</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#at_least-instance_method" title="#at_least (instance method)">#<strong>at_least</strong>(n, &amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Constrain a message expectation to be received at least a specific number of times.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#at_most-instance_method" title="#at_most (instance method)">#<strong>at_most</strong>(n, &amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Constrain a message expectation to be received at most a specific number of times.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exactly-instance_method" title="#exactly (instance method)">#<strong>exactly</strong>(n, &amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Constrain a message expectation to be received a specific number of times.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#never-instance_method" title="#never (instance method)">#<strong>never</strong>  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Expect a message not to be received at all.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#once-instance_method" title="#once (instance method)">#<strong>once</strong>(&amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Expect a message to be received exactly one time.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thrice-instance_method" title="#thrice (instance method)">#<strong>thrice</strong>(&amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Expect a message to be received exactly three times.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#time-instance_method" title="#time (instance method)">#<strong>time</strong>(&amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">#times</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#times-instance_method" title="#times (instance method)">#<strong>times</strong>(&amp;block)  &#x21d2; MessageExpectation </a>
      (also: #time)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Syntactic sugar for <a href="#exactly-instance_method" title="RSpec::Mocks::MessageExpectation#exactly (method)">#exactly</a>, <a href="#at_least-instance_method" title="RSpec::Mocks::MessageExpectation#at_least (method)">#at_least</a> and <a href="#at_most-instance_method" title="RSpec::Mocks::MessageExpectation#at_most (method)">#at_most</a></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#twice-instance_method" title="#twice (instance method)">#<strong>twice</strong>(&amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Expect a message to be received exactly two times.</p></div>
    </div>
  </li>
</ul>
</div>

<h2 class='h2_sum'>Other Constraints</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#to_s-instance_method" title="RSpec::Mocks::MessageExpectation#to_s (method)">#to_s</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#ordered-instance_method" title="#ordered (instance method)">#<strong>ordered</strong>(&amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Expect messages to be received in a specific order.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
      (also: #inspect)
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(*args, &amp;block)  &#x21d2; MessageExpectation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Constrains a stub or message expectation to invocations with specific arguments.</p></div>
    </div>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="MessageExpectation/ImplementationDetails.html" title="RSpec::Mocks::MessageExpectation::ImplementationDetails (module)"><code>ImplementationDetails</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#actual_received_count_matters%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#actual_received_count_matters? (method)">#actual_received_count_matters?</a>,
        <a class='i_m wo' href="MessageExpectation/ImplementationDetails.html#argument_list_matcher=-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#argument_list_matcher= (method)">#argument_list_matcher=</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#called_max_times%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#called_max_times? (method)">#called_max_times?</a>,
        <a class='i_m rw' href="MessageExpectation/ImplementationDetails.html#error_generator-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#error_generator (method)">#error_generator</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#expected_messages_received%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#expected_messages_received? (method)">#expected_messages_received?</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#ignoring_args%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#ignoring_args? (method)">#ignoring_args?</a>,
        <a class='i_m rw' href="MessageExpectation/ImplementationDetails.html#implementation-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#implementation (method)">#implementation</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#matches_at_least_count%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#matches_at_least_count? (method)">#matches_at_least_count?</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#matches_at_most_count%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#matches_at_most_count? (method)">#matches_at_most_count?</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#matches_exact_count%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#matches_exact_count? (method)">#matches_exact_count?</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#message-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#message (method)">#message</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#negative%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#negative? (method)">#negative?</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#ordered%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#ordered? (method)">#ordered?</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#orig_object-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#orig_object (method)">#orig_object</a>,
        <a class='i_m ro nodoc' href="MessageExpectation/ImplementationDetails.html#type-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#type (method)">#type</a>,
        <a class='i_m ro' href="MessageExpectation/ImplementationDetails.html#yield_receiver_to_implementation_block%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#yield_receiver_to_implementation_block? (method)">#yield_receiver_to_implementation_block?</a>,
        <a class='i_m wo prot' href="MessageExpectation/ImplementationDetails.html#expected_from=-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#expected_from= (method)">#expected_from=</a>,
        <a class='i_m wo prot' href="MessageExpectation/ImplementationDetails.html#expected_received_count=-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#expected_received_count= (method)">#expected_received_count=</a>,
        <a class='i_m ro priv' href="MessageExpectation/ImplementationDetails.html#has_been_invoked%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#has_been_invoked? (method)">#has_been_invoked?</a>,
        <a class='i_m wo priv' href="MessageExpectation/ImplementationDetails.html#initial_implementation_action=-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#initial_implementation_action= (method)">#initial_implementation_action=</a>,
        <a class='i_m wo priv' href="MessageExpectation/ImplementationDetails.html#inner_implementation_action=-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#inner_implementation_action= (method)">#inner_implementation_action=</a>,
        <a class='i_m wo priv' href="MessageExpectation/ImplementationDetails.html#terminal_implementation_action=-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#terminal_implementation_action= (method)">#terminal_implementation_action=</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="MessageExpectation/ImplementationDetails.html" title="RSpec::Mocks::MessageExpectation::ImplementationDetails (module)"><code>ImplementationDetails</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#additional_expected_calls-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#additional_expected_calls (method)">#additional_expected_calls</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#advise-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#advise (method)">#advise</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#and_yield_receiver_to_implementation-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#and_yield_receiver_to_implementation (method)">#and_yield_receiver_to_implementation</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#description_for-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#description_for (method)">#description_for</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#ensure_expected_ordering_received!-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#ensure_expected_ordering_received! (method)">#ensure_expected_ordering_received!</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#expectation_count_type-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#expectation_count_type (method)">#expectation_count_type</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#expected_args-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#expected_args (method)">#expected_args</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#generate_error-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#generate_error (method)">#generate_error</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#increase_actual_received_count!-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#increase_actual_received_count! (method)">#increase_actual_received_count!</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#initialize-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#initialize (method)">#initialize</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#invoke-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#invoke (method)">#invoke</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#invoke_without_incrementing_received_count-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#invoke_without_incrementing_received_count (method)">#invoke_without_incrementing_received_count</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#matches%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#matches? (method)">#matches?</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#matches_name_but_not_args-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#matches_name_but_not_args (method)">#matches_name_but_not_args</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#negative_expectation_for%3F-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#negative_expectation_for? (method)">#negative_expectation_for?</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#raise_out_of_order_error-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#raise_out_of_order_error (method)">#raise_out_of_order_error</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#raise_unexpected_message_args_error-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#raise_unexpected_message_args_error (method)">#raise_unexpected_message_args_error</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#safe_invoke-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#safe_invoke (method)">#safe_invoke</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#similar_messages-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#similar_messages (method)">#similar_messages</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#unadvise-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#unadvise (method)">#unadvise</a>,
        <a class='i_m ' href="MessageExpectation/ImplementationDetails.html#verify_messages_received-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#verify_messages_received (method)">#verify_messages_received</a>,
        <a class='i_m priv' href="MessageExpectation/ImplementationDetails.html#exception_source_id-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#exception_source_id (method)">#exception_source_id</a>,
        <a class='i_m priv' href="MessageExpectation/ImplementationDetails.html#invoke_incrementing_actual_calls_by-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#invoke_incrementing_actual_calls_by (method)">#invoke_incrementing_actual_calls_by</a>,
        <a class='i_m priv' href="MessageExpectation/ImplementationDetails.html#raise_already_invoked_error_if_necessary-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#raise_already_invoked_error_if_necessary (method)">#raise_already_invoked_error_if_necessary</a>,
        <a class='i_m priv' href="MessageExpectation/ImplementationDetails.html#set_expected_received_count-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#set_expected_received_count (method)">#set_expected_received_count</a>,
        <a class='i_m priv' href="MessageExpectation/ImplementationDetails.html#warn_about_stub_override-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#warn_about_stub_override (method)">#warn_about_stub_override</a>,
        <a class='i_m priv' href="MessageExpectation/ImplementationDetails.html#wrap_original-instance_method" title="RSpec::Mocks::MessageExpectation::ImplementationDetails#wrap_original (method)">#wrap_original</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="and_call_original-instance_method">
  <h3 class='signature  first'>
    #<strong>and_call_original</strong>  &#x21d2; <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This is only available on partial doubles.</p>
</div>
  </div>


<p>Tells the object to delegate to the original unmodified method when it receives the message.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_counter'>counter</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_increment'>increment</span>).<span class='id identifier rubyid_and_call_original'>and_call_original</span>
<span class='id identifier rubyid_original_count'>original_count</span> <span class='op'>=</span> <span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span>
<span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_increment'>increment</span>
<span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_eq'>eq</span>(<span class='id identifier rubyid_original_count'>original_count</span> <span class='op'>+</span> <span class='int'>1</span>)</code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>No further chaining is supported after this.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L141-L148'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='141' data-end='148'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 141</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_call_original'>and_call_original</span>
  <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_original'>original</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
    <span class='id identifier rubyid_original'>original</span>.<span class='id identifier rubyid_call'>call</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_ruby2_keywords'>ruby2_keywords</span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ruby2_keywords'>ruby2_keywords</span>)

  <span class='id identifier rubyid_wrap_original'>wrap_original</span>(<span class='id identifier rubyid___method__'>__method__</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and_invoke-instance_method">
  <h3 class='signature '>
    #<strong>and_invoke</strong>(first_proc, *procs, &amp;_block)  &#x21d2; <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tells the object to invoke a Proc when it receives the message. Given more than one value, the result of the first Proc is returned the first time the message is received, the result of the second Proc is returned the next time, etc, etc.</p>

<p>If the message is received more times than there are Procs, the result of the last Proc is returned for every subsequent call.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_api'>api</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_get_foo'>get_foo</span>).<span class='id identifier rubyid_and_invoke'>and_invoke</span>(<span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ApiTimeout</span> })
<span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; raises ApiTimeout
</span><span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; raises ApiTimeout
</span>
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_api'>api</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_get_foo'>get_foo</span>).<span class='id identifier rubyid_and_invoke'>and_invoke</span>(<span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ApiTimeout</span> }<span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ApiTimeout</span> }<span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='symbeg'>:</span><span class='id identifier rubyid_a_foo'>a_foo</span> })
<span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; raises ApiTimeout
</span><span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; raises ApiTimeout
</span><span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; :a_foo
</span><span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; :a_foo
</span><span class='id identifier rubyid_api'>api</span>.<span class='id identifier rubyid_get_foo'>get_foo</span> <span class='comment'># =&gt; :a_foo
</span><span class='comment'># etc</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>No further chaining is supported after this.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L109-L128'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='109' data-end='128'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 109</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_invoke'>and_invoke</span>(<span class='id identifier rubyid_first_proc'>first_proc</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_procs'>procs</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid__block'>_block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_negative?'>negative?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`and_invoke` is not supported with negative message expectations</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Implementation blocks aren&#39;t supported with `and_invoke`</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_procs'>procs</span>.<span class='id identifier rubyid_unshift'>unshift</span>(<span class='id identifier rubyid_first_proc'>first_proc</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_procs'>procs</span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='op'>!</span><span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>) }
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Arguments to `and_invoke` must be callable.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@expected_received_count</span> <span class='op'>=</span> [<span class='ivar'>@expected_received_count</span><span class='comma'>,</span> <span class='id identifier rubyid_procs'>procs</span>.<span class='id identifier rubyid_size'>size</span>].<span class='id identifier rubyid_max'>max</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ignoring_args?'>ignoring_args?</span> <span class='op'>||</span> (<span class='ivar'>@expected_received_count</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@at_least</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_terminal_implementation_action'>terminal_implementation_action</span> <span class='op'>=</span> <span class='const'><a href="AndInvokeImplementation.html" title="RSpec::Mocks::AndInvokeImplementation (class)">AndInvokeImplementation</a></span>.<span class='id identifier rubyid_new'><a href="AndInvokeImplementation.html#new-class_method" title="RSpec::Mocks::AndInvokeImplementation.new (method)">new</a></span>(<span class='id identifier rubyid_procs'>procs</span>)

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and_raise-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>and_raise</strong>  &#x21d2; <code>nil</code> </span>
      <span class='overload'>#<strong>and_raise</strong>(ExceptionClass)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>#<strong>and_raise</strong>(ExceptionClass, message)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>#<strong>and_raise</strong>(exception_instance)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>When you pass an exception class, the <code>MessageExpectation</code> will raise an instance of it, creating it with <code>exception</code> and passing <code>message</code> if specified.  If the exception class initializer requires more than one parameters, you must pass in an instance and not the class, otherwise this method will raise an ArgumentError exception.</p>
</div>
  </div>


<p>Tells the object to raise an exception when the message is received.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_and_raise'>and_raise</span>
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_and_raise'>and_raise</span>(<span class='const'>OutOfGas</span>)
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_and_raise'>and_raise</span>(<span class='const'>OutOfGas</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>At least 2 oz of gas needed to drive</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_and_raise'>and_raise</span>(<span class='const'>OutOfGas</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_oz'>oz</span>))</code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>No further chaining is supported after this.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L186-L190'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='186' data-end='190'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 186</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_raise'>and_raise</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_terminal_implementation_action'>terminal_implementation_action</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_raise'>raise</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) }
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and_return-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>and_return</strong>(value)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>#<strong>and_return</strong>(first_value, second_value)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tells the object to return a value when it receives the message.  Given more than one value, the first value is returned the first time the message is received, the second value is returned the next time, etc, etc.</p>

<p>If the message is received more times than there are values, the last value is returned for every subsequent call.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_counter'>counter</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_count'>count</span>).<span class='id identifier rubyid_and_return'>and_return</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 1
</span><span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 1
</span>
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_counter'>counter</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_count'>count</span>).<span class='id identifier rubyid_and_return'>and_return</span>(<span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span>)
<span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 1
</span><span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 2
</span><span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 3
</span><span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 3
</span><span class='id identifier rubyid_counter'>counter</span>.<span class='id identifier rubyid_count'>count</span> <span class='comment'># =&gt; 3
</span><span class='comment'># etc</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>No further chaining is supported after this.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L71-L86'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='86'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_return'>and_return</span>(<span class='id identifier rubyid_first_value'>first_value</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid__block'>_block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_negative?'>negative?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`and_return` is not supported with negative message expectations</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Implementation blocks aren&#39;t supported with `and_return`</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_unshift'>unshift</span>(<span class='id identifier rubyid_first_value'>first_value</span>)
  <span class='ivar'>@expected_received_count</span> <span class='op'>=</span> [<span class='ivar'>@expected_received_count</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_size'>size</span>].<span class='id identifier rubyid_max'>max</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ignoring_args?'>ignoring_args?</span> <span class='op'>||</span> (<span class='ivar'>@expected_received_count</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@at_least</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_terminal_implementation_action'>terminal_implementation_action</span> <span class='op'>=</span> <span class='const'><a href="AndReturnImplementation.html" title="RSpec::Mocks::AndReturnImplementation (class)">AndReturnImplementation</a></span>.<span class='id identifier rubyid_new'><a href="AndReturnImplementation.html#new-class_method" title="RSpec::Mocks::AndReturnImplementation.new (method)">new</a></span>(<span class='id identifier rubyid_values'>values</span>)

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and_throw-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>and_throw</strong>(symbol)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>#<strong>and_throw</strong>(symbol, object)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tells the object to throw a symbol (with the object if that form is used) when the message is received.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_and_throw'>and_throw</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_out_of_gas'>out_of_gas</span>)
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_and_throw'>and_throw</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_out_of_gas'>out_of_gas</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span> <span class='op'>=&gt;</span> <span class='float'>0.1</span>)</code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>No further chaining is supported after this.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L202-L206'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='202' data-end='206'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 202</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_throw'>and_throw</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_terminal_implementation_action'>terminal_implementation_action</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_throw'>throw</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) }
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and_wrap_original-instance_method">
  <h3 class='signature '>
    #<strong>and_wrap_original</strong>(&amp;block)  &#x21d2; <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This is only available on partial doubles.</p>
</div>
  </div>


<p>Decorates the stubbed method with the supplied block. The original unmodified method is passed to the block along with any method call arguments so you can delegate to it, whilst still being able to change what args are passed to it and/or change the return value.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_api'>api</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_large_list'>large_list</span>).<span class='id identifier rubyid_and_wrap_original'>and_wrap_original</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_original_method'>original_method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
  <span class='id identifier rubyid_original_method'>original_method</span>.<span class='id identifier rubyid_call'>call</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>).<span class='id identifier rubyid_first'>first</span>(<span class='int'>10</span>)
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>No further chaining is supported after this.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L162-L164'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='162' data-end='164'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 162</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_wrap_original'>and_wrap_original</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_wrap_original'>wrap_original</span>(<span class='id identifier rubyid___method__'>__method__</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="and_yield-instance_method">
  <h3 class='signature '>
    #<strong>and_yield</strong>(*args) {|@eval_context = Object.new| ... } &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tells the object to yield one or more args to a block when the message is received.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_stub'><a href="../../top-level-namespace.html#stub-instance_method" title="#stub (method)">stub</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_open'>open</span>).<span class='id identifier rubyid_and_yield'>and_yield</span>(<span class='const'>StringIO</span>.<span class='id identifier rubyid_new'>new</span>)</code></pre>
  </div>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(@<code>eval_context</code> = <code>Object</code>.<code>new</code>)</span>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L214-L225'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='214' data-end='225'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 214</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_and_yield'>and_yield</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>yield</span> <span class='ivar'>@eval_context</span> <span class='op'>=</span> <span class='const'>Object</span>.<span class='id identifier rubyid_new'>new</span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>

  <span class='comment'># Initialize args to yield now that it&#39;s being used, see also: comment
</span>  <span class='comment'># in constructor.
</span>  <span class='ivar'>@args_to_yield</span> <span class='op'>||=</span> []

  <span class='ivar'>@args_to_yield</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_args'>args</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_initial_implementation_action'>initial_implementation_action</span> <span class='op'>=</span> <span class='const'><a href="AndYieldImplementation.html" title="RSpec::Mocks::AndYieldImplementation (class)">AndYieldImplementation</a></span>.<span class='id identifier rubyid_new'><a href="AndYieldImplementation.html#new-class_method" title="RSpec::Mocks::AndYieldImplementation.new (method)">new</a></span>(<span class='ivar'>@args_to_yield</span><span class='comma'>,</span> <span class='ivar'>@eval_context</span><span class='comma'>,</span> <span class='ivar'>@error_generator</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="at_least-instance_method">
  <h3 class='signature '>
    #<strong>at_least</strong>(n, &amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Constrain a message expectation to be received at least a specific number of times.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_dealer'>dealer</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deal_card'>deal_card</span>).<span class='id identifier rubyid_at_least'>at_least</span>(<span class='int'>9</span>).<span class='id identifier rubyid_times'><a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">times</a></span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L249-L260'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='249' data-end='260'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 249</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_at_least'>at_least</span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='id identifier rubyid_set_expected_received_count'>set_expected_received_count</span> <span class='symbeg'>:</span><span class='id identifier rubyid_at_least'>at_least</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>at_least(0) has been removed, use allow(...).to receive(:message) instead</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="at_most-instance_method">
  <h3 class='signature '>
    #<strong>at_most</strong>(n, &amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Constrain a message expectation to be received at most a specific number of times.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_dealer'>dealer</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deal_card'>deal_card</span>).<span class='id identifier rubyid_at_most'>at_most</span>(<span class='int'>10</span>).<span class='id identifier rubyid_times'><a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">times</a></span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L268-L273'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='268' data-end='273'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 268</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_at_most'>at_most</span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_set_expected_received_count'>set_expected_received_count</span> <span class='symbeg'>:</span><span class='id identifier rubyid_at_most'>at_most</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exactly-instance_method">
  <h3 class='signature '>
    #<strong>exactly</strong>(n, &amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Constrain a message expectation to be received a specific number of times.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_dealer'>dealer</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deal_card'>deal_card</span>).<span class='id identifier rubyid_exactly'>exactly</span>(<span class='int'>10</span>).<span class='id identifier rubyid_times'><a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">times</a></span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L236-L241'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='236' data-end='241'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 236</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exactly'>exactly</span>(<span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_set_expected_received_count'>set_expected_received_count</span> <span class='symbeg'>:</span><span class='id identifier rubyid_exactly'>exactly</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#to_s-instance_method" title="RSpec::Mocks::MessageExpectation#to_s (method)">#to_s</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L401-L401'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='401' data-end='401'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 401</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_inspect'>inspect</span> <span class='id identifier rubyid_to_s'><a href="#to_s-instance_method" title="RSpec::Mocks::MessageExpectation#to_s (method)">to_s</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="never-instance_method">
  <h3 class='signature '>
    #<strong>never</strong>  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expect a message not to be received at all.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stop'>stop</span>).<span class='id identifier rubyid_never'>never</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L293-L297'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='293' data-end='297'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 293</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_never'>never</span>
  <span class='id identifier rubyid_error_generator'><a href="../Mocks.html#error_generator-class_method" title="RSpec::Mocks.error_generator (method)">error_generator</a></span>.<span class='id identifier rubyid_raise_double_negation_error'>raise_double_negation_error</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expect(obj)</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>if</span> <span class='id identifier rubyid_negative?'>negative?</span>
  <span class='ivar'>@expected_received_count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="once-instance_method">
  <h3 class='signature '>
    #<strong>once</strong>(&amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expect a message to be received exactly one time.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_once'>once</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L304-L308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='304' data-end='308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 304</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_once'>once</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_set_expected_received_count'>set_expected_received_count</span> <span class='symbeg'>:</span><span class='id identifier rubyid_exactly'><a href="#exactly-instance_method" title="RSpec::Mocks::MessageExpectation#exactly (method)">exactly</a></span><span class='comma'>,</span> <span class='int'>1</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ordered-instance_method">
  <h3 class='signature '>
    #<strong>ordered</strong>(&amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expect messages to be received in a specific order.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_api'>api</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_prepare'>prepare</span>).<span class='id identifier rubyid_ordered'>ordered</span>
<span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_api'>api</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_run'>run</span>).<span class='id identifier rubyid_ordered'>ordered</span>
<span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_api'>api</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_finish'>finish</span>).<span class='id identifier rubyid_ordered'>ordered</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L379-L393'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='379' data-end='393'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 379</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ordered'>ordered</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stub'><a href="../../top-level-namespace.html#stub-instance_method" title="#stub (method)">stub</a></span>
    <span class='const'><a href="../../RSpec.html" title="RSpec (module)">RSpec</a></span>.<span class='id identifier rubyid_warning'><a href="../Support/Warnings.html#warning-instance_method" title="RSpec::Support::Warnings#warning (method)">warning</a></span>(
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`allow(...).to receive(..).ordered` is not supported and will </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>have no effect, use `and_return(*ordered_values)` instead.</span><span class='tstring_end'>&quot;</span></span>
    )
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_additional_expected_calls'>additional_expected_calls</span>.<span class='id identifier rubyid_times'><a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">times</a></span> <span class='kw'>do</span>
    <span class='ivar'>@order_group</span>.<span class='id identifier rubyid_register'>register</span>(<span class='kw'>self</span>)
  <span class='kw'>end</span>
  <span class='ivar'>@ordered</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thrice-instance_method">
  <h3 class='signature '>
    #<strong>thrice</strong>(&amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expect a message to be received exactly three times.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_thrice'>thrice</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L326-L330'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='326' data-end='330'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 326</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_thrice'>thrice</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_set_expected_received_count'>set_expected_received_count</span> <span class='symbeg'>:</span><span class='id identifier rubyid_exactly'><a href="#exactly-instance_method" title="RSpec::Mocks::MessageExpectation#exactly (method)">exactly</a></span><span class='comma'>,</span> <span class='int'>3</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="time-instance_method">
  <h3 class='signature '>
    #<strong>time</strong>(&amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">#times</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L286-L286'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='286' data-end='286'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 286</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_time'>time</span> <span class='id identifier rubyid_times'><a href="#times-instance_method" title="RSpec::Mocks::MessageExpectation#times (method)">times</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="times-instance_method">
  <h3 class='signature '>
    #<strong>times</strong>(&amp;block)  &#x21d2; <code>MessageExpectation</code> 
    <span class='aliases'>Also known as: <span class='names'>#time</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Syntactic sugar for <a href="#exactly-instance_method" title="RSpec::Mocks::MessageExpectation#exactly (method)">#exactly</a>, <a href="#at_least-instance_method" title="RSpec::Mocks::MessageExpectation#at_least (method)">#at_least</a> and <a href="#at_most-instance_method" title="RSpec::Mocks::MessageExpectation#at_most (method)">#at_most</a></p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_dealer'>dealer</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deal_card'>deal_card</span>).<span class='id identifier rubyid_exactly'><a href="#exactly-instance_method" title="RSpec::Mocks::MessageExpectation#exactly (method)">exactly</a></span>(<span class='int'>10</span>).<span class='id identifier rubyid_times'>times</span>
<span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_dealer'>dealer</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deal_card'>deal_card</span>).<span class='id identifier rubyid_at_least'><a href="#at_least-instance_method" title="RSpec::Mocks::MessageExpectation#at_least (method)">at_least</a></span>(<span class='int'>10</span>).<span class='id identifier rubyid_times'>times</span>
<span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_dealer'>dealer</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_deal_card'>deal_card</span>).<span class='id identifier rubyid_at_most'><a href="#at_most-instance_method" title="RSpec::Mocks::MessageExpectation#at_most (method)">at_most</a></span>(<span class='int'>10</span>).<span class='id identifier rubyid_times'>times</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L282-L285'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='282' data-end='285'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 282</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_times'>times</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    #<strong>to_s</strong>  &#x21d2; <code>String</code> 
    <span class='aliases'>Also known as: <span class='names'>#inspect</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>a nice representation of the message expectation</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L396-L400'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='396' data-end='400'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 396</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_args_description'>args_description</span> <span class='op'>=</span> <span class='id identifier rubyid_error_generator'><a href="../Mocks.html#error_generator-class_method" title="RSpec::Mocks.error_generator (method)">error_generator</a></span>.<span class='id identifier rubyid_method_call_args_description'>method_call_args_description</span>(<span class='ivar'>@argument_list_matcher</span>.<span class='id identifier rubyid_expected_args'>expected_args</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>) { <span class='kw'>true</span> }
  <span class='id identifier rubyid_args_description'>args_description</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args_description'>args_description</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_args_description'>args_description</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='tstring_end'>&quot;</span></span>)
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error_generator'><a href="../Mocks.html#error_generator-class_method" title="RSpec::Mocks.error_generator (method)">error_generator</a></span>.<span class='id identifier rubyid_intro'>intro</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args_description'>args_description</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="twice-instance_method">
  <h3 class='signature '>
    #<strong>twice</strong>(&amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expect a message to be received exactly two times.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_car'>car</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_go'>go</span>).<span class='id identifier rubyid_twice'>twice</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L315-L319'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='315' data-end='319'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 315</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_twice'>twice</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_set_expected_received_count'>set_expected_received_count</span> <span class='symbeg'>:</span><span class='id identifier rubyid_exactly'><a href="#exactly-instance_method" title="RSpec::Mocks::MessageExpectation#exactly (method)">exactly</a></span><span class='comma'>,</span> <span class='int'>2</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with-instance_method">
  <h3 class='signature '>
    #<strong>with</strong>(*args, &amp;block)  &#x21d2; <code>MessageExpectation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Constrains a stub or message expectation to invocations with specific arguments.</p>

<p>With a stub, if the message might be received with other args as well, you should stub a default value first, and then stub or mock the same message using <code>with</code> to constrain to specific arguments.</p>

<p>A message expectation will fail if the message is received with different arguments.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_cart'>cart</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_add'>add</span>) { <span class='symbeg'>:</span><span class='id identifier rubyid_failure'>failure</span> }
<span class='id identifier rubyid_allow'><a href="ExampleMethods.html#allow-instance_method" title="RSpec::Mocks::ExampleMethods#allow (method)">allow</a></span>(<span class='id identifier rubyid_cart'>cart</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_add'>add</span>).<span class='id identifier rubyid_with'>with</span>(<span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span> <span class='op'>=&gt;</span> <span class='int'>1934356379</span>)) { <span class='symbeg'>:</span><span class='id identifier rubyid_success'>success</span> }
<span class='id identifier rubyid_cart'>cart</span>.<span class='id identifier rubyid_add'>add</span>(<span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span> <span class='op'>=&gt;</span> <span class='int'>1234567890</span>))
<span class='comment'># =&gt; :failure
</span><span class='id identifier rubyid_cart'>cart</span>.<span class='id identifier rubyid_add'>add</span>(<span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span> <span class='op'>=&gt;</span> <span class='int'>1934356379</span>))
<span class='comment'># =&gt; :success
</span>
<span class='id identifier rubyid_expect'><a href="ExampleMethods.html#expect-instance_method" title="RSpec::Mocks::ExampleMethods#expect (method)">expect</a></span>(<span class='id identifier rubyid_cart'>cart</span>).<span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_receive'><a href="ExampleMethods.html#receive-instance_method" title="RSpec::Mocks::ExampleMethods#receive (method)">receive</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_add'>add</span>).<span class='id identifier rubyid_with'>with</span>(<span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span> <span class='op'>=&gt;</span> <span class='int'>1934356379</span>)) { <span class='symbeg'>:</span><span class='id identifier rubyid_success'>success</span> }
<span class='id identifier rubyid_cart'>cart</span>.<span class='id identifier rubyid_add'>add</span>(<span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span> <span class='op'>=&gt;</span> <span class='int'>1234567890</span>))
<span class='comment'># =&gt; failed expectation
</span><span class='id identifier rubyid_cart'>cart</span>.<span class='id identifier rubyid_add'>add</span>(<span class='const'>Book</span>.<span class='id identifier rubyid_new'>new</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span> <span class='op'>=&gt;</span> <span class='int'>1934356379</span>))
<span class='comment'># =&gt; passes</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>MessageExpectation</code>)</span>
&mdash;    <div class='inline'>
<p>self, to support further chaining.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rspec/rspec-mocks/blob/main/lib/rspec/mocks/message_expectation.rb#L359-L369'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='359' data-end='369'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rspec-mocks/lib/rspec/mocks/message_expectation.rb', line 359</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with'>with</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_raise_already_invoked_error_if_necessary'>raise_already_invoked_error_if_necessary</span>(<span class='id identifier rubyid___method__'>__method__</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`with` must have at least one argument. Use `no_args` matcher to set the expectation of receiving no arguments.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_inner_implementation_action'>inner_implementation_action</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='ivar'>@argument_list_matcher</span> <span class='op'>=</span> <span class='const'><a href="ArgumentListMatcher.html" title="RSpec::Mocks::ArgumentListMatcher (class)">ArgumentListMatcher</a></span>.<span class='id identifier rubyid_new'><a href="ArgumentListMatcher.html#new-class_method" title="RSpec::Mocks::ArgumentListMatcher.new (method)">new</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>