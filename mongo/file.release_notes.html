<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Release Notes &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "release_notes",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Mongo master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Release Notes&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Release Notes</h1>

<p>This page documents significant changes in driver releases.</p>

<p>It is not an exhaustive list of changes and generally does not enumerate
bug fixes; please consult the <a href="https://github.com/mongodb/mongo-ruby-driver/releases">releases page on GitHub</a> for a more
comprehensive list of changes in each version of the driver and the
<a href="https://jira.mongodb.org/projects/RUBY?selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page&status=released">releases page in Jira</a>
for the complete list of changes, including those internal to the driver and
its test suite.</p>

<h2>2.20 [release-notes-2.20]</h2>

<p>This release includes the following new features:</p>

<ul>
<li>  Support for Ruby 2.5 and 2.6 has been discontinued. Support for Ruby 2.7 and
JRuby 9.2 has been deprecated, and will be discontinued in the next minor
driver version. Support for JRuby 9.4 has been added.</li>
<li>  Support for the newly-released Ruby-BSON version 5.0.</li>
<li>  Connection strings no longer require a slash between the hosts and the
options. E.g., &quot;<a href="mongodb://example.com?w=1">mongodb://example.com?w=1</a>&quot; and &quot;<a href="mongodb://example.com/?w=1">mongodb://example.com/?w=1</a>&quot;
are both valid connection strings now.</li>
<li>  Container runtime and orchestration metadata for the client environment are
now sent to the server for analytics purposes.</li>
<li>  A warning message is now written to the log when the host is detected to be
a CosmosDB (Azure) or DocumentDB (Amazon) instance.</li>
<li>  When attempting a retry of a read or write operation in a sharded topology,
the retry will be attempted on a different mongos instance, if possible.</li>
</ul>

<h2>2.19 [release-notes-2.19]</h2>

<p>This release of the Ruby driver supports MongoDB version 7.0. The Ruby driver
now supports Ruby 3.2. Ruby 2.5 and 2.6 are now deprecated.</p>

<p>This release includes the following new features:</p>

<ul>
<li>  The driver now limits the number of connections established by a connection
pool simultaneously. By default the limit is 2. The limit can be configured
with the <code>:max_connecting</code> option of the <a href="Mongo/Client.html" title="Mongo::Client (class)"><code>::Mongo::Client</code></a> constructor.
The default should be sufficient for most applications. However, if your
application is using a large number of threads, you may need to increase
the limit.</li>
<li>  Added support for automatic AWS credentials retrieval and authentication
with temporary credentials when AWS KMS is used for client side encryption.</li>
<li>  Added support for automatic GCP credentials retrieval when Google Cloud Key
Management is used for client side encryption.</li>
<li>  Added support the Azure VM-assigned Managed Identity for Automatic KMS Credentials
when Azure Key Vault is used for client side encryption.</li>
<li>  <a href="https://www.mongodb.com/docs/upcoming/core/queryable-encryption/queryable-encryption/">Queryable Encryption</a> support is extended.</li>
<li>  Added support for Queryable Encryption Range Indexes.</li>
<li>  A <a href="https://www.mongodb.com/docs/manual/core/queryable-encryption/reference/shared-library/#download-the-automatic-encryption-shared-library">crypt_shared</a>
library can be now used instead of <code>mongocryptd</code>.</li>
<li>  Added support for AWS IAM Roles for service accounts, EKS in particular.</li>
<li>  AWS Credentials are now cached when possible.</li>
<li>  Added support for creating and managing <a href="https://www.mongodb.com/docs/atlas/atlas-search/">Atlas search indexes</a> via the
Ruby driver.</li>
</ul>

<h2>2.18 [release-notes-2.18]</h2>

<p>This release of the Ruby driver supports MongoDB version 5.2 and 6.0.</p>

<p>This release includes the following new features:</p>

<ul>
<li>  Added support for <a href="https://www.mongodb.com/docs/upcoming/core/queryable-encryption/queryable-encryption/">queryable encryption</a>.</li>
<li>  Added support for Azure Key Vault, Google Cloud Key Management, and any
KMIP compliant Key Management System to be used as master key storage for
client side encryption.</li>
<li>  It is now possible to provide the <code>path to a schema map file &lt;schema-map-path&gt;</code>
instead of the entire schema map as an object.</li>
<li>  The driver now implements the <code>feature flag &lt;feature-flags&gt;</code> mechanism
for incompatible changes and bug fixes. Changes gated behind feature flags
for 2.18 are passing view filter and options to <code>aggregate</code> and validation
of correct usage of <code>update</code> vs <code>replace</code> methods, as described below.</li>
<li>  Added the <code>validate_update_replace</code> feature flag which validates the
parameters to update and replace operations. If this flag is turned on, an
error will be raised on an invalid update or replacement document.</li>
<li>  Added the <code>broken_view_options</code> feature flag which allows the view options
to be correctly propagated to the <code>aggregate</code>, <code>count</code>, <code>count_documents</code>,
<code>distinct</code>, and <code>estimated_document_count</code> mehods. When this flag is
switched on, the view options will be ignored in those methods.</li>
<li>  The driver now permits <code>inserting documents with dollar-prefixed and
dotted keys &lt;dots-dollars-in-field-names&gt;</code>.</li>
<li>  CRUD methods, methods for listing databases, collection, and indexes management
methods now support a new option <code>:comment</code>. This option enables users to
specify an arbitrary comment to help trace the operation through the
database profiler, currentOp and logs.</li>
<li>  The <code>estimated_document_count</code> method is now using the <code>count</code> server
command instead of <code>$collStats</code> aggregation pipeline stage, to support
operation on views. Applications using the Stable API should upgrade to
server versions 5.0.8 (if using MongoDB 5.0) or 5.3.2 (if using MongoDB
5.1/5.2/5.3) or newer to use the <code>count</code> command when API strict is enabled,
or avoid setting <code>api_strict: true</code> when constructing <a href="Mongo/Client.html" title="Mongo::Client (class)"><code>::Mongo::Client</code></a>
instances with server versions 5.0.0-5.0.7 and 5.1.0-5.3.1.</li>
<li>  The DBRef class has been moved to <code>bson-ruby</code>. For backwards compatibility,
<code>BSON::DBRef</code> is aliased as <a href="Mongo.html#DBRef-constant" title="Mongo::DBRef (constant)">Mongo::DBRef</a>. The <code>BSON::DBRef</code> class
derives from <code>BSON::Document</code>, unlike the legacy <a href="Mongo.html#DBRef-constant" title="Mongo::DBRef (constant)">Mongo::DBRef</a> which
derived from <code>Object</code>. <code>BSON::DBRef</code> retains all attributes passed into
its constructor, unlike <a href="Mongo.html#DBRef-constant" title="Mongo::DBRef (constant)">Mongo::DBRef</a> which only allowed <code>$ref</code>,
<code>$id</code>, and <code>$db</code>. <code>BSON::DBRef</code> also reorders the fields if
necessary to place <code>$ref</code>, <code>$id</code>, and <code>$db</code> first, in that order, as
required by the MongoDB server.</li>
<li>  <code>BulkWrite::Result</code> class now has the <code>acknowledged?</code> attribute.</li>
<li>  Providing an empty array of operations to the bulk write is now an error.</li>
<li>  BSON serialization performance has been improved.</li>
<li>  <code>ActiveJob middleware &lt;query-cache-active-job-middleware&gt;</code> was added to
the query cache.</li>
<li>  <code>:authorized_collections</code> options is recognized when listing collections.</li>
<li>  <code>:wildcard_projection</code> option was added to the allowed index specification.</li>
<li>  Added <code>:srv_max_hosts</code>/<code>srvMaxHosts</code> Ruby and URI options to limit how
many mongos routers the driver will establish connections to.</li>
<li>  Custom SRV service names are now supported with the <code>:srv_service_name</code>
Ruby option and the <code>srvServiceName</code> URI option.</li>
<li>  When 0 is given as the max connection pool size, it is now interpreted to
mean no limit.</li>
<li>  The default maximum connection pool size has been increased to 20 from 5.</li>
</ul>

<p>This release adds supports for JRuby 9.3.</p>

<h2>2.17 [release-notes-2.17]</h2>

<p>This release of the Ruby driver supports MongoDB version 5.1. It also increases
the minimum required Ruby version to 2.5, and drops support for MongoDB
versions older than 3.6.</p>

<p>This release includes the following new features:</p>

<ul>
<li>  Added new readConcern level &quot;snapshot&quot; (non-speculative) for read commands outside of transactions, including on secondaries.</li>
<li>  Support \$merge and \$out executing on secondaries.</li>
<li>  Support &#39;let&#39; option for aggregate and CRUD commands.</li>
</ul>

<p>The following bugs were fixed:</p>

<ul>
<li>  Push monitor thread can exit when address resolution fails.</li>
</ul>

<p>The following non-breaking changes were made:</p>

<ul>
<li>  mapReduce command is now deprecated.</li>
<li>  Avoid tight looping in push monitor</li>
</ul>

<h2>2.16 [release-notes-2.16]</h2>

<p>This release adds the following new feature:</p>

<ul>
<li>  Load balancer support.</li>
</ul>

<p>The following minor improvement has been made:</p>

<ul>
<li>  GridFS file retrieval no longer requires index creation privileges when
the indexes already exist, and is thus usable with users that have only
read permissions.</li>
</ul>

<p>This release of the Ruby driver increases the minimum required Ruby version
to 2.4 and deprecates support for MongoDB server versions below 3.6.</p>

<h2>2.15 [release-notes-2.15]</h2>

<p>This release adds the following new features:</p>

<ul>
<li>  Ruby 3.0 support.</li>
<li>  Ability to specify the <code>server API parameters &lt;server-api-parameters&gt;</code>.</li>
<li>  Support for Zstandard and Snappy <code>wire protocol compression &lt;compression&gt;</code>.</li>
<li>  <code>Query cache middleware &lt;query-cache-middleware&gt;</code> was moved to the
driver from Mongoid and is now usable in applications that do not use Mongoid.</li>
<li>  It is now possible to create collections with time-series options.</li>
<li>  Experimental support for <a href="https://www.mongodb.com/cloud/atlas/serverless">MongoDB Atlas Serverless</a> when not using a
load balancer.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  The <code>OperationFailure</code> exception message now contains the server error code
name, if provided by the server. The layout of the message was changed to
accommodate the error code name.</li>
<li>  The generic SSL messaging has been removed from <code>SocketError</code> messages
when TLS is used. TLS connections to MongoDB are now the norm, with Atlas
requiring TLS, and it is more likely that a connection fails due to failed
certificate verification than due to the server not having TLS enabled.</li>
<li>  A hook was added to permit applications to <code>modify the TLS context
&lt;modifying-tls-context&gt;</code> used for TLS connections, for example to exclude
ciphers.</li>
<li>  Heartbeat succeeded and heartbeat failed <code>server monitoring events
&lt;server-heartbeats&gt;</code> are now linked to the respective heartbeat started
event, to improve usability.</li>
<li>  <code>skip</code> and <code>limit</code> options are now prohibited when calling
<code>estimated_document_count</code>, because the server command does not accept them.</li>
<li>  The driver will now omit command monitoring reply payloads when they are
in response to sensitive commands.</li>
<li>  When the driver closes network sockets it now enforces the socket timeout.</li>
<li>  <code>estimated_document_count</code> collection method now uses the <code>$collStats</code>
aggregation pipeline stage instead of the count command on 5.0 and newer
servers.</li>
<li>  The platform metadata sent by the driver to the server in the handshake
now includes the purpose of the connection being established, permitting
administrators to distinguish monitoring connections from application
connections.</li>
<li>  The driver now uses monotonic clock for timeouts.</li>
<li>  The driver will no longer mark servers unknown based on errors in
<code>writeErrors</code> field in the server response.</li>
<li>  Server selection timeout for <code>mongocryptd</code> has been increased to 10 seconds.</li>
</ul>

<h2>2.14 [release-notes-2.14]</h2>

<p>This release adds the following new features:</p>

<ul>
<li>  Queries against Atlas Data Lake are now supported.</li>
<li>  The <code>query cache &lt;query-cache&gt;</code> has been moved from Mongoid into the
driver. Mongoid will use the driver&#39;s query cache as of driver 2.14.
As part of the move, several issues with the query cache have been fixed
and its functionality was extended to cover aggregation pipeline queries
and to support result sets of any size.</li>
<li>  Explain verbosity can now <code>be specified &lt;query-options&gt;</code> when explaining.</li>
<li>  Mixed case read preference tag names are now supported.</li>
<li>  The driver will perform <code>OCSP endpoint verification &lt;ocsp-verification&gt;</code>
by default when TLS is enabled. Due to lack of support in Ruby&#39;s <code>openssl</code>
extension, OCSP stapling is not yet implemented.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  Default logger level for <code>Client</code> objects is now info (up from debug).
This reduces the amount of log output produced by the driver by default.</li>
<li>  Database and collection write methods support specifying write concern for
the individual operations.</li>
<li>  <code>Client#summary</code> method now shows the monitoring state of each server.</li>
<li>  When objects other than hashes are attempted to be inserted (which is not
allowed), the driver now provides better diagnostics.</li>
<li>  DNS queries for SRV URIs are now subject to configured socket timeouts.</li>
<li>  When the <code>Client</code> object is reconnected, session pools are now cleared.</li>
</ul>

<p>Support for Ruby versions 2.3 and 2.4 has been deprecated as of this release.</p>

<h2>2.13 [release-notes-2.13]</h2>

<p>This release implements the necessary client-side functionality to use the
features added in MongoDB 4.4. Specifically, the following new driver
functionality has been added:</p>

<ul>
<li>  Support for the <code>directConnection</code> URI option to provide a consistent
cross-driver mechanims to discover deployment topology or force direct
connection.</li>
<li>  Support for <code>MONGODB-AWS authentication mechanism &lt;aws-auth&gt;</code>.</li>
<li>  When SCRAM authentication is used with 4.4 and newer servers, the driver will
complete authentication with fewer network roundtrips.</li>
<li>  The driver creates an additional monitoring connection for 4.4 and newer
servers, permitting the server to notify the driver when its state changes.
This reduces the time for the driver to discover the new primary during
failover events.</li>
<li>  <code>Client</code> constructor can be given a block, in which case the client object
will be yielded to the block and automatically closed when the block ends.</li>
<li>  <code>start_session</code> can be given a block, in which case the session object will
be yielded to the block and automatically ended when the block ends.</li>
<li>  Write options can now be specified for individual CRUD operations.</li>
<li>  The <code>:allow_disk_use</code> option was added to find operations.</li>
<li>  The <code>:authorized_databases</code> option was added to <code>list_databases</code>
method.</li>
<li>  The <code>list_collections</code> method now passes through all options.</li>
<li>  Ability to set an index <code>as hidden &lt;index-options&gt;</code> when creating it.</li>
<li>  Ability to specify commit quorum when creating indexes.</li>
<li>  <code>:wrapping_libraries</code> <code>client option &lt;client-options&gt;</code>, to be used
by libraries like Mongoid which wrap the driver to report their version to
the server for troubleshooting/statistics aggregation purposes.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  <code>count_documents</code> can now be invoked with no arguments.</li>
<li>  The default TCP keep-alive time has been reduced to make the driver
correctly detect dropped connections on Microsoft Azure.</li>
<li>  <code>CursorNotFound</code> is now a resumable change stream error.</li>
<li>  The number of backtrace lines in exceptions handled by background threads
can now be configured.</li>
</ul>

<h2>2.12 [release-notes-2.12]</h2>

<p>This release adds the following new features:</p>

<ul>
<li>  <code>Client-side encryption &lt;client-side-encryption&gt;</code>.</li>
<li>  <code>list_collections</code> method now accepts the <code>:filter</code> option.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  Authentication exceptions now include server information to aid in
troubleshooting.</li>
</ul>

<h2>2.11 [release-notes-2.11]</h2>

<p>This release adds the following new features:</p>

<ul>
<li>  If a minimum connection pool size is specified, the pool for each server
will create a background thread to eagerly establish connections up to
the specified minimum pool size.</li>
<li>  If the driver connects to the deployment using a SRV URI and the deployment
is a sharded cluster, the driver will poll the SRV DNS records to
automatically discover new and removed mongos servers and adjust the
set of known servers accordingly.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  The driver now permits unencoded subdelimiters in usernames and passwords in
MongoDB URIs.</li>
<li>  User management helpers now accept the write concern option.</li>
<li>  The <code>command monitoring &lt;command-monitoring&gt;</code> logger provided with the
driver will now log connection ids used for each command.</li>
<li>  When legacy read retries are used, retry on the same set of server errors
that the modern retries would have retried on.</li>
<li>  The <code>distinct(nil)</code> call is prohibited because it is rejected by MongoDB
4.4 and newer servers.</li>
</ul>

<p>This release of the Ruby driver increases the minimum required Ruby version
to 2.3, as well as minimum supported JRuby version to 9.2.</p>

<h2>2.10 [release-notes-2.10]</h2>

<p>This release implements the necessary client-side functionality to use the
features added in MongoDB 4.2. Specifically, the following new driver
functionality has been added:</p>

<ul>
<li>  Support for sharded transactions.</li>
<li>  Applications can set the <code>:max_time_ms</code> option in <code>commit_transaction</code>
method.</li>
<li>  Support for database-level aggregation.</li>
<li>  Support for <code>$merge</code> aggregation pipeline stage.</li>
<li>  The update operations now accept an aggregation pipeline as an array.</li>
<li>  TLS regenotiation is now disabled when possible.</li>
<li>  Change streams now handle post-batch resume tokens provided by the server.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  All methods now accept <code>:write_concern</code> option for the write concern,
including those that previously accepted the <code>:write</code> option.</li>
<li>  The query string in a MongoDB URI can now start with <code>&</code>.</li>
</ul>

<p>Support for Ruby versions less than 2.3 is deprecated in this release.</p>

<h2>2.9 [release-notes-2.9]</h2>

<p>This release adds the following new features:</p>

<ul>
<li>  A rewrite of the connection pool code with improved monitoring,
compliant with the CMAP specification</li>
<li>  A modern retryable reads implementation compliant with the cross-driver
retryable reads specification, enabled by default.</li>
<li>  Modern retryable writes are now enabled by default.</li>
<li>  Legacy retryable writes can be disabled in most cases.</li>
<li>  The driver now supports certificate chains being provided as client
certificates for TLS connections.</li>
<li>  Ability to specify multiple CA certificates when creating a <code>Client</code>.</li>
<li>  Ability to pass the private key and certificate via URI options.</li>
</ul>

<p>The following smaller improvements have been made:</p>

<ul>
<li>  Support for the <code>startAfter</code> option in the <code>$changeStream</code>
aggregation pipeline stage.</li>
<li>  Field order of BSON documents sent to the server changed for better logging.</li>
<li>  Certificate paths with unescaped slashes can now be specified in
MongoDB URIs.</li>
</ul>

<p>This release deprecates support for Ruby versions less than 2.3.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>