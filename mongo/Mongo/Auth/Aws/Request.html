<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Auth::Aws::Request &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Auth::Aws::Request",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Mongo master</a> &raquo; 
      <a href='../../../_index.html#alpha_R'>Index (R)</a> &raquo; 
        <a href="../../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../../Auth.html" title="Mongo::Auth (module)">Auth</a> &raquo; 
        <a href="../Aws.html" title="Mongo::Auth::Aws (class)">Aws</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Request&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Auth::Aws::Request  <span class='private note title'>Private</span>
</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L32'>lib/mongo/auth/aws/request.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Helper class for working with AWS requests.</p>

<p>The primary purpose of this class is to produce the canonical AWS STS request and calculate the signed headers and signature for it.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='STS_REQUEST_BODY-constant' class='summary_signature nodoc'>STS_REQUEST_BODY =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The body of the STS GetCallerIdentity request.</p>

<p>This is currently the only request that this class supports making.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L37-L37'># File 'lib/mongo/auth/aws/request.rb', line 37</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Action=GetCallerIdentity&amp;Version=2011-06-15</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='VALIDATE_TIMEOUT-constant' class='summary_signature nodoc'>VALIDATE_TIMEOUT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The timeout, in seconds, to use for validating credentials via STS.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L40-L40'># File 'lib/mongo/auth/aws/request.rb', line 40</a>    <pre class='code ruby'><span class='int'>10</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(access_key_id:, secret_access_key:, session_token: nil, host:, server_nonce:, time: Time.now)  &#x21d2; Request </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Constructs the request.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#access_key_id-instance_method" title="#access_key_id (instance method)">#<strong>access_key_id</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#host-instance_method" title="#host (instance method)">#<strong>host</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#secret_access_key-instance_method" title="#secret_access_key (instance method)">#<strong>secret_access_key</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#server_nonce-instance_method" title="#server_nonce (instance method)">#<strong>server_nonce</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#session_token-instance_method" title="#session_token (instance method)">#<strong>session_token</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#time-instance_method" title="#time (instance method)">#<strong>time</strong>  &#x21d2; Time </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#authorization-instance_method" title="#authorization (instance method)">#<strong>authorization</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the value of the Authorization header, per the AWS signature V4 specification.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#canonical_request-instance_method" title="#canonical_request (instance method)">#<strong>canonical_request</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the canonical request used during calculation of AWS V4 signature.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#formatted_date-instance_method" title="#formatted_date (instance method)">#<strong>formatted_date</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#formatted_time-instance_method" title="#formatted_time (instance method)">#<strong>formatted_time</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#headers-instance_method" title="#headers (instance method)">#<strong>headers</strong>  &#x21d2; &lt;Hash&gt; </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the hash containing the headers of the calculated canonical request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#headers_to_sign-instance_method" title="#headers_to_sign (instance method)">#<strong>headers_to_sign</strong>  &#x21d2; &lt;Hash&gt; </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the hash containing the headers of the calculated canonical request that should be signed, in a ready to sign form.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#region-instance_method" title="#region (instance method)">#<strong>region</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#scope-instance_method" title="#scope (instance method)">#<strong>scope</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the scope of the request, per the AWS signature V4 specification.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#signature-instance_method" title="#signature (instance method)">#<strong>signature</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the calculated signature of the canonical request, per the AWS signature V4 specification.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#signed_headers_string-instance_method" title="#signed_headers_string (instance method)">#<strong>signed_headers_string</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns semicolon-separated list of names of signed headers, per the AWS signature V4 specification.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#validate!-instance_method" title="#validate! (instance method)">#<strong>validate!</strong>  &#x21d2; Hash </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validates the credentials and the constructed request components by sending a real STS GetCallerIdentity request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#hmac-instance_method" title="#hmac (instance method)">#<strong>hmac</strong>(key, data)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#hmac_hex-instance_method" title="#hmac_hex (instance method)">#<strong>hmac_hex</strong>(key, data)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="access_key_id-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>access_key_id</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>access_key_id The access key id.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L77-L77'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='77' data-end='77'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 77</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_access_key_id'>access_key_id</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="host-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>host</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>host The value of Host HTTP header to use.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L87-L87'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='87' data-end='87'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 87</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="secret_access_key-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>secret_access_key</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>secret_access_key The secret access key.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L80-L80'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='80' data-end='80'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 80</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_secret_access_key'>secret_access_key</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="server_nonce-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>server_nonce</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>server_nonce The server nonce binary string.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L90-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='90' data-end='90'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 90</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_server_nonce'>server_nonce</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="session_token-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>session_token</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>session_token The session token for temporary credentials.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L84-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='84' data-end='84'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 84</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_session_token'>session_token</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="time-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>time</strong>  &#x21d2; <code>Time</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Time</code>)</span>
&mdash;    <div class='inline'>
<p>time The time of the request.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L93-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='93' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 93</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_time'>time</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="authorization-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>authorization</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the value of the Authorization header, per the AWS signature V4 specification.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>Authorization header value.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L235-L237'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='235' data-end='237'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 235</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_authorization'>authorization</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AWS4-HMAC-SHA256 Credential=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_access_key_id'><a href="#access_key_id-instance_method" title="Mongo::Auth::Aws::Request#access_key_id (method)">access_key_id</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="Mongo::Auth::Aws::Request#scope (method)">scope</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>, SignedHeaders=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_signed_headers_string'><a href="#signed_headers_string-instance_method" title="Mongo::Auth::Aws::Request#signed_headers_string (method)">signed_headers_string</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>, Signature=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_signature'><a href="#signature-instance_method" title="Mongo::Auth::Aws::Request#signature (method)">signature</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="canonical_request-instance_method">
  <h3 class='signature nodoc'>
    #<strong>canonical_request</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the canonical request used during calculation of AWS V4 signature.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The canonical request.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L196-L210'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='196' data-end='210'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 196</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_canonical_request'>canonical_request</span>
  <span class='id identifier rubyid_headers'><a href="#headers-instance_method" title="Mongo::Auth::Aws::Request#headers (method)">headers</a></span> <span class='op'>=</span> <span class='id identifier rubyid_headers_to_sign'><a href="#headers_to_sign-instance_method" title="Mongo::Auth::Aws::Request#headers_to_sign (method)">headers_to_sign</a></span>
  <span class='id identifier rubyid_serialized_headers'>serialized_headers</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'><a href="#headers-instance_method" title="Mongo::Auth::Aws::Request#headers (method)">headers</a></span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_hashed_payload'>hashed_payload</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Auth::Aws::Request.new (method)">new</a></span>.<span class='id identifier rubyid_update'>update</span>(<span class='const'><a href="#STS_REQUEST_BODY-constant" title="Mongo::Auth::Aws::Request::STS_REQUEST_BODY (constant)">STS_REQUEST_BODY</a></span>).<span class='id identifier rubyid_hexdigest'>hexdigest</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>POST\n/\n\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
    <span class='comment'># There are two newlines after serialized headers because the
</span>    <span class='comment'># signature V4 specification treats each header as containing the
</span>    <span class='comment'># terminating newline, and there is an additional newline
</span>    <span class='comment'># separating headers from the signed header names.
</span>    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_serialized_headers'>serialized_headers</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_signed_headers_string'><a href="#signed_headers_string-instance_method" title="Mongo::Auth::Aws::Request#signed_headers_string (method)">signed_headers_string</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
    <span class='id identifier rubyid_hashed_payload'>hashed_payload</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="formatted_date-instance_method">
  <h3 class='signature nodoc'>
    #<strong>formatted_date</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>formatted_date YYYYMMDD formatted date of the request.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L102-L104'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='102' data-end='104'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 102</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_formatted_date'>formatted_date</span>
  <span class='id identifier rubyid_formatted_time'><a href="#formatted_time-instance_method" title="Mongo::Auth::Aws::Request#formatted_time (method)">formatted_time</a></span>[<span class='int'>0</span><span class='comma'>,</span> <span class='int'>8</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="formatted_time-instance_method">
  <h3 class='signature nodoc'>
    #<strong>formatted_time</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>formatted_time ISO8601-formatted time of the request, as would be used in X-Amz-Date header.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L97-L99'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='97' data-end='99'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 97</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_formatted_time'>formatted_time</span>
  <span class='ivar'>@formatted_time</span> <span class='op'>||=</span> <span class='ivar'>@time</span>.<span class='id identifier rubyid_getutc'>getutc</span>.<span class='id identifier rubyid_strftime'>strftime</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Y%m%dT%H%M%SZ</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="headers-instance_method">
  <h3 class='signature nodoc'>
    #<strong>headers</strong>  &#x21d2; &lt;<code>Hash</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Not all of these headers are part of the signed headers list, the keys of the hash are not necessarily ordered lexicographically, and the keys may be in any case.</p>
</div>
  </div>


<p>Returns the hash containing the headers of the calculated canonical request.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(&lt;<code>Hash</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>headers The headers.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L147-L160'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='147' data-end='160'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 147</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_headers'>headers</span>
  <span class='id identifier rubyid_headers'>headers</span> <span class='op'>=</span> {
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-length</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="#STS_REQUEST_BODY-constant" title="Mongo::Auth::Aws::Request::STS_REQUEST_BODY (constant)">STS_REQUEST_BODY</a></span>.<span class='id identifier rubyid_length'>length</span>.<span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-type</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/x-www-form-urlencoded</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>host</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>x-amz-date</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_formatted_time'><a href="#formatted_time-instance_method" title="Mongo::Auth::Aws::Request#formatted_time (method)">formatted_time</a></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>x-mongodb-gs2-cb-flag</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>n</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>x-mongodb-server-nonce</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'>Base64</span>.<span class='id identifier rubyid_encode64'>encode64</span>(<span class='id identifier rubyid_server_nonce'><a href="#server_nonce-instance_method" title="Mongo::Auth::Aws::Request#server_nonce (method)">server_nonce</a></span>).<span class='id identifier rubyid_gsub'>gsub</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)<span class='comma'>,</span>
  }
  <span class='kw'>if</span> <span class='id identifier rubyid_session_token'><a href="#session_token-instance_method" title="Mongo::Auth::Aws::Request#session_token (method)">session_token</a></span>
    <span class='id identifier rubyid_headers'>headers</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>x-amz-security-token</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_session_token'><a href="#session_token-instance_method" title="Mongo::Auth::Aws::Request#session_token (method)">session_token</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_headers'>headers</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="headers_to_sign-instance_method">
  <h3 class='signature nodoc'>
    #<strong>headers_to_sign</strong>  &#x21d2; &lt;<code>Hash</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the hash containing the headers of the calculated canonical request that should be signed, in a ready to sign form.</p>

<p>The differences between #headers and this method is this method:</p>
<ul><li>
<p>Removes any headers that are not to be signed. Per AWS specifications it should be possible to sign all headers, but MongoDB server expects only some headers to be signed and will not form the correct request if other headers are signed.</p>
</li><li>
<p>Lowercases all header names.</p>
</li><li>
<p>Orders the headers lexicographically in the hash.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(&lt;<code>Hash</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>headers The headers.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L175-L182'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='175' data-end='182'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 175</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_headers_to_sign'>headers_to_sign</span>
  <span class='id identifier rubyid_headers_to_sign'>headers_to_sign</span> <span class='op'>=</span> {}
  <span class='id identifier rubyid_headers'><a href="#headers-instance_method" title="Mongo::Auth::Aws::Request#headers (method)">headers</a></span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_sort_by'>sort_by</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_downcase'>downcase</span> }.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_key'>write_key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_downcase'>downcase</span>
    <span class='id identifier rubyid_headers_to_sign'>headers_to_sign</span>[<span class='id identifier rubyid_write_key'>write_key</span>] <span class='op'>=</span> <span class='id identifier rubyid_headers'><a href="#headers-instance_method" title="Mongo::Auth::Aws::Request#headers (method)">headers</a></span>[<span class='id identifier rubyid_key'>key</span>]
  <span class='kw'>end</span>
  <span class='id identifier rubyid_headers_to_sign'>headers_to_sign</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="hmac-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>hmac</strong>(key, data)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L273-L275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='273' data-end='275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 273</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_hmac'>hmac</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>)
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span>.<span class='id identifier rubyid_digest'>digest</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="hmac_hex-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>hmac_hex</strong>(key, data)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L277-L279'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='277' data-end='279'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 277</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_hmac_hex'>hmac_hex</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>)
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span>.<span class='id identifier rubyid_hexdigest'>hexdigest</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="region-instance_method">
  <h3 class='signature nodoc'>
    #<strong>region</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>region The region of the host, derived from the host.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L107-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='107' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 107</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_region'>region</span>
  <span class='comment'># Common case
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sts.amazonaws.com</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>us-east-1</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../../Error/InvalidServerAuthHost.html" title="Mongo::Error::InvalidServerAuthHost (class)">InvalidServerAuthHost</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host begins with a period: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span>.<span class='id identifier rubyid_end_with?'>end_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../../Error/InvalidServerAuthHost.html" title="Mongo::Error::InvalidServerAuthHost (class)">InvalidServerAuthHost</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host ends with a period: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> <span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_parts'>parts</span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_part'>part</span><span class='op'>|</span> <span class='id identifier rubyid_part'>part</span>.<span class='id identifier rubyid_empty?'>empty?</span> }
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../../Error/InvalidServerAuthHost.html" title="Mongo::Error::InvalidServerAuthHost (class)">InvalidServerAuthHost</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host has an empty component: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_parts'>parts</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>us-east-1</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_parts'>parts</span>[<span class='int'>1</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scope-instance_method">
  <h3 class='signature nodoc'>
    #<strong>scope</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the scope of the request, per the AWS signature V4 specification.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The scope.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L135-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='135' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_scope'>scope</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_formatted_date'><a href="#formatted_date-instance_method" title="Mongo::Auth::Aws::Request#formatted_date (method)">formatted_date</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_region'><a href="#region-instance_method" title="Mongo::Auth::Aws::Request#region (method)">region</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>/sts/aws4_request</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="signature-instance_method">
  <h3 class='signature nodoc'>
    #<strong>signature</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the calculated signature of the canonical request, per the AWS signature V4 specification.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The signature.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L216-L229'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='216' data-end='229'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 216</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_signature'>signature</span>
  <span class='id identifier rubyid_hashed_canonical_request'>hashed_canonical_request</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span>.<span class='id identifier rubyid_hexdigest'>hexdigest</span>(<span class='id identifier rubyid_canonical_request'><a href="#canonical_request-instance_method" title="Mongo::Auth::Aws::Request#canonical_request (method)">canonical_request</a></span>)
  <span class='id identifier rubyid_string_to_sign'>string_to_sign</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AWS4-HMAC-SHA256\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_formatted_time'><a href="#formatted_time-instance_method" title="Mongo::Auth::Aws::Request#formatted_time (method)">formatted_time</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="Mongo::Auth::Aws::Request#scope (method)">scope</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
    <span class='id identifier rubyid_hashed_canonical_request'>hashed_canonical_request</span>
  <span class='comment'># All of the intermediate HMAC operations are not hex-encoded.
</span>  <span class='id identifier rubyid_mac'>mac</span> <span class='op'>=</span> <span class='id identifier rubyid_hmac'><a href="#hmac-instance_method" title="Mongo::Auth::Aws::Request#hmac (method)">hmac</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AWS4</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_secret_access_key'><a href="#secret_access_key-instance_method" title="Mongo::Auth::Aws::Request#secret_access_key (method)">secret_access_key</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_formatted_date'><a href="#formatted_date-instance_method" title="Mongo::Auth::Aws::Request#formatted_date (method)">formatted_date</a></span>)
  <span class='id identifier rubyid_mac'>mac</span> <span class='op'>=</span> <span class='id identifier rubyid_hmac'><a href="#hmac-instance_method" title="Mongo::Auth::Aws::Request#hmac (method)">hmac</a></span>(<span class='id identifier rubyid_mac'>mac</span><span class='comma'>,</span> <span class='id identifier rubyid_region'><a href="#region-instance_method" title="Mongo::Auth::Aws::Request#region (method)">region</a></span>)
  <span class='id identifier rubyid_mac'>mac</span> <span class='op'>=</span> <span class='id identifier rubyid_hmac'><a href="#hmac-instance_method" title="Mongo::Auth::Aws::Request#hmac (method)">hmac</a></span>(<span class='id identifier rubyid_mac'>mac</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sts</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_signing_key'>signing_key</span> <span class='op'>=</span> <span class='id identifier rubyid_hmac'><a href="#hmac-instance_method" title="Mongo::Auth::Aws::Request#hmac (method)">hmac</a></span>(<span class='id identifier rubyid_mac'>mac</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aws4_request</span><span class='tstring_end'>&#39;</span></span>)
  <span class='comment'># Only the final HMAC operation is hex-encoded.
</span>  <span class='id identifier rubyid_hmac_hex'><a href="#hmac_hex-instance_method" title="Mongo::Auth::Aws::Request#hmac_hex (method)">hmac_hex</a></span>(<span class='id identifier rubyid_signing_key'>signing_key</span><span class='comma'>,</span> <span class='id identifier rubyid_string_to_sign'>string_to_sign</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="signed_headers_string-instance_method">
  <h3 class='signature nodoc'>
    #<strong>signed_headers_string</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns semicolon-separated list of names of signed headers, per the AWS signature V4 specification.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The signed header list.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L188-L190'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='188' data-end='190'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 188</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_signed_headers_string'>signed_headers_string</span>
  <span class='id identifier rubyid_headers_to_sign'><a href="#headers_to_sign-instance_method" title="Mongo::Auth::Aws::Request#headers_to_sign (method)">headers_to_sign</a></span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>;</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>validate!</strong>  &#x21d2; <code>Hash</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validates the credentials and the constructed request components by sending a real STS GetCallerIdentity request.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>GetCallerIdentity result.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/auth/aws/request.rb#L243-L269'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='243' data-end='269'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/auth/aws/request.rb', line 243</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate!'>validate!</span>
  <span class='id identifier rubyid_sts_request'>sts_request</span> <span class='op'>=</span> <span class='const'><a href="../../../Net.html" title="Net (module)">Net</a></span><span class='op'>::</span><span class='const'>HTTP</span><span class='op'>::</span><span class='const'>Post</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Auth::Aws::Request.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_req'>req</span><span class='op'>|</span>
    <span class='id identifier rubyid_headers'><a href="#headers-instance_method" title="Mongo::Auth::Aws::Request#headers (method)">headers</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='id identifier rubyid_req'>req</span>[<span class='id identifier rubyid_k'>k</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_req'>req</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>authorization</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_authorization'><a href="#authorization-instance_method" title="Mongo::Auth::Aws::Request#authorization (method)">authorization</a></span>
    <span class='id identifier rubyid_req'>req</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>accept</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/json</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_req'>req</span>.<span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='const'><a href="#STS_REQUEST_BODY-constant" title="Mongo::Auth::Aws::Request::STS_REQUEST_BODY (constant)">STS_REQUEST_BODY</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_http'>http</span> <span class='op'>=</span> <span class='const'><a href="../../../Net.html" title="Net (module)">Net</a></span><span class='op'>::</span><span class='const'>HTTP</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Auth::Aws::Request.new (method)">new</a></span>(<span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Auth::Aws::Request#host (method)">host</a></span><span class='comma'>,</span> <span class='int'>443</span>)
  <span class='id identifier rubyid_http'>http</span>.<span class='id identifier rubyid_use_ssl'>use_ssl</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_http'>http</span>.<span class='id identifier rubyid_start'>start</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_resp'>resp</span> <span class='op'>=</span> <span class='const'><a href="../../Timeout.html" title="Mongo::Timeout (module)">Timeout</a></span>.<span class='id identifier rubyid_timeout'><a href="../../Timeout.html#timeout-class_method" title="Mongo::Timeout.timeout (method)">timeout</a></span>(<span class='const'><a href="#VALIDATE_TIMEOUT-constant" title="Mongo::Auth::Aws::Request::VALIDATE_TIMEOUT (constant)">VALIDATE_TIMEOUT</a></span><span class='comma'>,</span> <span class='const'><a href="../../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../../Error/CredentialCheckError.html" title="Mongo::Error::CredentialCheckError (class)">CredentialCheckError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GetCallerIdentity request timed out</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_http'>http</span>.<span class='id identifier rubyid_request'>request</span>(<span class='id identifier rubyid_sts_request'>sts_request</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='const'>JSON</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_resp'>resp</span>.<span class='id identifier rubyid_body'>body</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_resp'>resp</span>.<span class='id identifier rubyid_code'>code</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>200</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_aws_code'>aws_code</span> <span class='op'>=</span> <span class='id identifier rubyid_payload'>payload</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Error</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Code</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_aws_message'>aws_message</span> <span class='op'>=</span> <span class='id identifier rubyid_payload'>payload</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Error</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Message</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Credential check for user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_access_key_id'><a href="#access_key_id-instance_method" title="Mongo::Auth::Aws::Request#access_key_id (method)">access_key_id</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> failed with HTTP status code </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_resp'>resp</span>.<span class='id identifier rubyid_code'>code</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_aws_code'>aws_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_aws_message'>aws_message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_msg'>msg</span>.<span class='id identifier rubyid_end_with?'>end_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> Please check that the credentials are valid, and if they are temporary (i.e. use the session token) that the session token is provided and not expired</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../../Error/CredentialCheckError.html" title="Mongo::Error::CredentialCheckError (class)">CredentialCheckError</a></span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_payload'>payload</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GetCallerIdentityResponse</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GetCallerIdentityResult</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>