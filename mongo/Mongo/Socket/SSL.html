<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Socket::SSL &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Socket::SSL",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongo master</a> &raquo; 
      <a href='../../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a class='nodoc' href="../Socket.html" title="Mongo::Socket (class)">Socket</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>SSL&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Socket::SSL  <span class='private note title'>Private</span>
</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../Socket.html" title="Mongo::Socket (class)"><code>::Mongo::Socket</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a>,
          OpenSSL,
          <a href="../Socket.html" title="Mongo::Socket (class)"><code>::Mongo::Socket</code></a>,
          Socket::Constants
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Socket.html" title="Mongo::Socket (class)">Mongo::Socket</a></span>
        <ul class='fullTree'>
          <li>Object</li>
          <li class='next'><a href="../Socket.html" title="Mongo::Socket (class)">Mongo::Socket</a></li>
          <li class='next'>Mongo::Socket::SSL</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L24'>lib/mongo/socket/ssl.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wrapper for TLS sockets.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='BEGIN_CERT-constant' class='summary_signature'>BEGIN_CERT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L490-L490'># File 'lib/mongo/socket/ssl.rb', line 490</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-----BEGIN CERTIFICATE-----</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='END_CERT-constant' class='summary_signature'>END_CERT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L491-L491'># File 'lib/mongo/socket/ssl.rb', line 491</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-----END CERTIFICATE-----</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="../Socket.html" title="Mongo::Socket (class)"><code>::Mongo::Socket</code></a> - Inherited</h3>
  <p  class='inherited'>
    <a class='nodoc' href="../Socket.html#DEFAULT_TCP_KEEPCNT-constant" title="Mongo::Socket::DEFAULT_TCP_KEEPCNT (constant)">DEFAULT_TCP_KEEPCNT</a>, 
    <a class='nodoc' href="../Socket.html#DEFAULT_TCP_KEEPIDLE-constant" title="Mongo::Socket::DEFAULT_TCP_KEEPIDLE (constant)">DEFAULT_TCP_KEEPIDLE</a>, 
    <a class='nodoc' href="../Socket.html#DEFAULT_TCP_KEEPINTVL-constant" title="Mongo::Socket::DEFAULT_TCP_KEEPINTVL (constant)">DEFAULT_TCP_KEEPINTVL</a>, 
    <a class='nodoc' href="../Socket.html#DEFAULT_TCP_USER_TIMEOUT-constant" title="Mongo::Socket::DEFAULT_TCP_USER_TIMEOUT (constant)">DEFAULT_TCP_USER_TIMEOUT</a>, 
    <a class='nodoc' href="../Socket.html#SSL_ERROR-constant" title="Mongo::Socket::SSL_ERROR (constant)">SSL_ERROR</a>, 
    <a class='nodoc' href="../Socket.html#TIMEOUT_ERROR-constant" title="Mongo::Socket::TIMEOUT_ERROR (constant)">TIMEOUT_ERROR</a>, 
    <a class='nodoc' href="../Socket.html#TIMEOUT_PACK-constant" title="Mongo::Socket::TIMEOUT_PACK (constant)">TIMEOUT_PACK</a>, 
    <a class='nodoc' href="../Socket.html#WRITE_CHUNK_SIZE-constant" title="Mongo::Socket::WRITE_CHUNK_SIZE (constant)">WRITE_CHUNK_SIZE</a>
  </p>
  <h3 class='inherited'><a href="../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">PREFIX</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(host, port, host_name, timeout, family, options = {})  &#x21d2; SSL </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Initializes a new TLS socket.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="../Socket.html" title="Mongo::Socket (class)"><code>::Mongo::Socket</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#new-class_method" title="Mongo::Socket.new (method)">.new</a></td>
      <td><div class='inline'><p>Initializes common socket attributes.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#context-instance_method" title="#context (instance method)">#<strong>context</strong>  &#x21d2; SSLContext </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#host-instance_method" title="#host (instance method)">#<strong>host</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#host_name-instance_method" title="#host_name (instance method)">#<strong>host_name</strong>  &#x21d2; String </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#port-instance_method" title="#port (instance method)">#<strong>port</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#verify_certificate%3F-instance_method" title="#verify_certificate? (instance method)">#<strong>verify_certificate?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#verify_hostname%3F-instance_method" title="#verify_hostname? (instance method)">#<strong>verify_hostname?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#verify_ocsp_endpoint%3F-instance_method" title="#verify_ocsp_endpoint? (instance method)">#<strong>verify_ocsp_endpoint?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="../Socket.html" title="Mongo::Socket (class)"><code>::Mongo::Socket</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc deprecated' href="../Socket.html#alive%3F-instance_method" title="Mongo::Socket#alive? (method)">#alive?</a></td>
      <td><div class='inline'><p>Is the socket connection alive?</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc deprecated' href="../Socket.html#connectable%3F-instance_method" title="Mongo::Socket#connectable? (method)">#connectable?</a></td>
      <td><div class='inline'><p>For backwards compatibility only, do not use.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc' href="../Socket.html#eof%3F-instance_method" title="Mongo::Socket#eof? (method)">#eof?</a></td>
      <td><div class='inline'><p>Tests if this socket has reached EOF.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro nodoc' href="../Socket.html#family-instance_method" title="Mongo::Socket#family (method)">#family</a>,
        <a class='i_m ro nodoc' href="../Socket.html#monitor%3F-instance_method" title="Mongo::Socket#monitor? (method)">#monitor?</a>,
        <a class='i_m ro nodoc' href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">#options</a>,
        <a class='i_m ro nodoc' href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">#socket</a>,
        <a class='i_m ro nodoc' href="../Socket.html#timeout-instance_method" title="Mongo::Socket#timeout (method)">#timeout</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#readbyte-instance_method" title="#readbyte (instance method)">#<strong>readbyte</strong>  &#x21d2; Object </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Read a single byte from the socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#connect!-instance_method" title="#connect! (instance method)">#<strong>connect!</strong>  &#x21d2; SSL </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Establishes a socket connection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#connect_tcp_socket_with_timeout-instance_method" title="#connect_tcp_socket_with_timeout (instance method)">#<strong>connect_tcp_socket_with_timeout</strong>(sockaddr, deadline, connect_timeout)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#connect_with_timeout-instance_method" title="#connect_with_timeout (instance method)">#<strong>connect_with_timeout</strong>(sockaddr, connect_timeout)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Connects the socket with the connect timeout.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#connect_without_timeout-instance_method" title="#connect_without_timeout (instance method)">#<strong>connect_without_timeout</strong>(sockaddr)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Connects the socket without a timeout provided.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#connnect_ssl_socket_with_timeout-instance_method" title="#connnect_ssl_socket_with_timeout (instance method)">#<strong>connnect_ssl_socket_with_timeout</strong>(deadline, connect_timeout)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#create_context-instance_method" title="#create_context (instance method)">#<strong>create_context</strong>(options)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#extract_certs-instance_method" title="#extract_certs (instance method)">#<strong>extract_certs</strong>(text)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>This was originally a scan + regex, but the regex was particularly inefficient and was flagged as a concern by static analysis.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#find_issuer-instance_method" title="#find_issuer (instance method)">#<strong>find_issuer</strong>(cert, cert_chain)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Find the issuer certificate in the chain.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#human_address-instance_method" title="#human_address (instance method)">#<strong>human_address</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#load_private_key-instance_method" title="#load_private_key (instance method)">#<strong>load_private_key</strong>(text, passphrase)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#read_buffer_size-instance_method" title="#read_buffer_size (instance method)">#<strong>read_buffer_size</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#run_tls_context_hooks-instance_method" title="#run_tls_context_hooks (instance method)">#<strong>run_tls_context_hooks</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#set_cert-instance_method" title="#set_cert (instance method)">#<strong>set_cert</strong>(context, options)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#set_cert_verification-instance_method" title="#set_cert_verification (instance method)">#<strong>set_cert_verification</strong>(context, options)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#set_key-instance_method" title="#set_key (instance method)">#<strong>set_key</strong>(context, options)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_certificate!-instance_method" title="#verify_certificate! (instance method)">#<strong>verify_certificate!</strong>(socket)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_ocsp_endpoint!-instance_method" title="#verify_ocsp_endpoint! (instance method)">#<strong>verify_ocsp_endpoint!</strong>(socket, timeout = nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#with_select_timeout-instance_method" title="#with_select_timeout (instance method)">#<strong>with_select_timeout</strong>(deadline, connect_timeout, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises <a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)"><code>::Mongo::Error::SocketTimeoutError</code></a> exception if deadline reached or the block returns nil.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></td>
      <td><div class='inline'><p>Convenience method to log debug messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></td>
      <td><div class='inline'><p>Convenience method to log error messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></td>
      <td><div class='inline'><p>Convenience method to log fatal messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></td>
      <td><div class='inline'><p>Convenience method to log info messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></td>
      <td><div class='inline'><p>Convenience method to log warn messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></td>
      <td><div class='inline'><p>Get the logger instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../Loggable.html#_mongo_log_prefix-instance_method" title="Mongo::Loggable#_mongo_log_prefix (method)">#_mongo_log_prefix</a>,
        <a class='i_m priv' href="../Loggable.html#format_message-instance_method" title="Mongo::Loggable#format_message (method)">#format_message</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited nodoc'><a href="../Socket.html" title="Mongo::Socket (class)"><code>::Mongo::Socket</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#close-instance_method" title="Mongo::Socket#close (method)">#close</a></td>
      <td><div class='inline'><p>Close the socket.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../Socket.html#connection_address-instance_method" title="Mongo::Socket#connection_address (method)">#connection_address</a>,
        <a class='i_m nodoc' href="../Socket.html#connection_generation-instance_method" title="Mongo::Socket#connection_generation (method)">#connection_generation</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#gets-instance_method" title="Mongo::Socket#gets (method)">#gets</a></td>
      <td><div class='inline'><p>Delegates gets to the underlying socket.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#pipe-instance_method" title="Mongo::Socket#pipe (method)">#pipe</a></td>
      <td><div class='inline'><p>listen on during the select system call when reading from the socket.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#read-instance_method" title="Mongo::Socket#read (method)">#read</a></td>
      <td><div class='inline'><p>Will read all data from the socket for the provided number of bytes.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#readbyte-instance_method" title="Mongo::Socket#readbyte (method)">#readbyte</a></td>
      <td><div class='inline'><p>Read a single byte from the socket.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../Socket.html#summary-instance_method" title="Mongo::Socket#summary (method)">#summary</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Socket.html#write-instance_method" title="Mongo::Socket#write (method)">#write</a></td>
      <td><div class='inline'><p>Writes data to the socket instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="../Socket.html#allocate_string-instance_method" title="Mongo::Socket#allocate_string (method)">#allocate_string</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../Socket.html#do_write-instance_method" title="Mongo::Socket#do_write (method)">#do_write</a></td>
      <td><div class='inline'><p>Writes data to the socket instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="../Socket.html#human_address-instance_method" title="Mongo::Socket#human_address (method)">#human_address</a>,
        <a class='i_m priv nodoc' href="../Socket.html#map_exceptions-instance_method" title="Mongo::Socket#map_exceptions (method)">#map_exceptions</a>,
        <a class='i_m priv nodoc' href="../Socket.html#raise_timeout_error!-instance_method" title="Mongo::Socket#raise_timeout_error! (method)">#raise_timeout_error!</a>,
        <a class='i_m priv nodoc' href="../Socket.html#read_buffer_size-instance_method" title="Mongo::Socket#read_buffer_size (method)">#read_buffer_size</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../Socket.html#read_from_socket-instance_method" title="Mongo::Socket#read_from_socket (method)">#read_from_socket</a></td>
      <td><div class='inline'><p>Reads the <code>length</code> bytes from the socket.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../Socket.html#read_with_timeout-instance_method" title="Mongo::Socket#read_with_timeout (method)">#read_with_timeout</a></td>
      <td><div class='inline'><p>Reads the <code>length</code> bytes from the socket, the read operation duration is limited to <a href="../Socket.html#timeout-instance_method" title="Mongo::Socket#timeout (method)">#timeout</a> second.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../Socket.html#read_without_timeout-instance_method" title="Mongo::Socket#read_without_timeout (method)">#read_without_timeout</a></td>
      <td><div class='inline'><p>Reads the <code>length</code> bytes from the socket.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="../Socket.html#set_keepalive_opts-instance_method" title="Mongo::Socket#set_keepalive_opts (method)">#set_keepalive_opts</a>,
        <a class='i_m priv nodoc' href="../Socket.html#set_option-instance_method" title="Mongo::Socket#set_option (method)">#set_option</a>,
        <a class='i_m priv nodoc' href="../Socket.html#set_socket_options-instance_method" title="Mongo::Socket#set_socket_options (method)">#set_socket_options</a>,
        <a class='i_m priv nodoc' href="../Socket.html#unix_socket%3F-instance_method" title="Mongo::Socket#unix_socket? (method)">#unix_socket?</a>,
        <a class='i_m priv nodoc' href="../Socket.html#wait_for_socket_to_be_writable-instance_method" title="Mongo::Socket#wait_for_socket_to_be_writable (method)">#wait_for_socket_to_be_writable</a>,
        <a class='i_m priv nodoc' href="../Socket.html#write_chunk-instance_method" title="Mongo::Socket#write_chunk (method)">#write_chunk</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../Socket.html#write_with_timeout-instance_method" title="Mongo::Socket#write_with_timeout (method)">#write_with_timeout</a></td>
      <td><div class='inline'><p>Writes data to to the socket, the write duration is limited to <a href="../Socket.html#timeout-instance_method" title="Mongo::Socket#timeout (method)">#timeout</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="../Socket.html#write_without_timeout-instance_method" title="Mongo::Socket#write_without_timeout (method)">#write_without_timeout</a></td>
      <td><div class='inline'><p>Writes data to to the socket.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="context-instance_method">
  <h3 class='signature ro first'>
    #<strong>context</strong>  &#x21d2; <code>SSLContext</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>SSLContext</code>)</span>
&mdash;    <div class='inline'>
<p>context The TLS context.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L123-L123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='123' data-end='123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 123</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_context'>context</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="host-instance_method">
  <h3 class='signature ro'>
    #<strong>host</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>host The host to connect to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L126-L126'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='126' data-end='126'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 126</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="host_name-instance_method">
  <h3 class='signature ro'>
    #<strong>host_name</strong>  &#x21d2; <code>String</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>host_name The original host name.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L129-L129'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='129' data-end='129'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 129</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_host_name'>host_name</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="port-instance_method">
  <h3 class='signature ro'>
    #<strong>port</strong>  &#x21d2; <code>Integer</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>port The port to connect to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L132-L132'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='132' data-end='132'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_certificate?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>verify_certificate?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L278-L287'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='278' data-end='287'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 278</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_certificate?'>verify_certificate?</span>
  <span class='comment'># If ssl_verify_certificate is not present, disable only if
</span>  <span class='comment'># ssl_verify is explicitly set to false.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_certificate'>ssl_verify_certificate</span>].<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify'>ssl_verify</span>] <span class='op'>!=</span> <span class='kw'>false</span>
  <span class='comment'># If ssl_verify_certificate is present, enable or disable based on its value.
</span>  <span class='kw'>else</span>
    <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_certificate'>ssl_verify_certificate</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_hostname?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>verify_hostname?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L289-L298'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='289' data-end='298'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 289</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_hostname?'>verify_hostname?</span>
  <span class='comment'># If ssl_verify_hostname is not present, disable only if ssl_verify is
</span>  <span class='comment'># explicitly set to false.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_hostname'>ssl_verify_hostname</span>].<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify'>ssl_verify</span>] <span class='op'>!=</span> <span class='kw'>false</span>
  <span class='comment'># If ssl_verify_hostname is present, enable or disable based on its value.
</span>  <span class='kw'>else</span>
    <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_hostname'>ssl_verify_hostname</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_ocsp_endpoint?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>verify_ocsp_endpoint?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L300-L308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='300' data-end='308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 300</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_ocsp_endpoint?'>verify_ocsp_endpoint?</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_ocsp_endpoint'>ssl_verify_ocsp_endpoint</span>].<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_ocsp_endpoint'>ssl_verify_ocsp_endpoint</span>] <span class='op'>!=</span> <span class='kw'>false</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_certificate'>ssl_verify_certificate</span>].<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_certificate'>ssl_verify_certificate</span>] <span class='op'>!=</span> <span class='kw'>false</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify'>ssl_verify</span>] <span class='op'>!=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="connect!-instance_method">
  <h3 class='signature priv first'>
    #<strong>connect!</strong>  &#x21d2; <code>SSL</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method mutates the object by setting the socket internally.</p>
</div>
  </div>


<p>Establishes a socket connection.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Connect the socket.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_sock'>sock</span>.<span class='id identifier rubyid_connect!'>connect!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>SSL</code>)</span>
&mdash;    <div class='inline'>
<p>The connected socket instance.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L145-L177'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='145' data-end='177'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 145</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect!'>connect!</span>
  <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><a href="../Socket.html" title="Mongo::Socket (class)">Socket</a></span>.<span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span>(<span class='id identifier rubyid_port'><a href="#port-instance_method" title="Mongo::Socket::SSL#port (method)">port</a></span><span class='comma'>,</span> <span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Socket::SSL#host (method)">host</a></span>)
  <span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span>]
  <span class='id identifier rubyid_map_exceptions'><a href="../Socket.html#map_exceptions-instance_method" title="Mongo::Socket#map_exceptions (method)">map_exceptions</a></span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>=</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_monotonic_time'>monotonic_time</span> <span class='op'>+</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>
      <span class='kw'>if</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>Environment</span>.<span class='id identifier rubyid_jruby?'>jruby?</span>
        <span class='comment'># We encounter some strange problems with connect_nonblock for
</span>        <span class='comment'># ssl sockets on JRuby. Therefore, we use the old +Timeout.timeout+
</span>        <span class='comment'># solution, even though it is known to be not very reliable.
</span>        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>connect_timeout expired</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>&lt;</span> <span class='int'>0</span>

        <span class='const'><a href="../Timeout.html" title="Mongo::Timeout (module)">Timeout</a></span>.<span class='id identifier rubyid_timeout'><a href="../Timeout.html#timeout-class_method" title="Mongo::Timeout.timeout (method)">timeout</a></span>(<span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='comma'>,</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The socket took over </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span>]<span class='embexpr_end'>}</span><span class='tstring_content'> seconds to connect</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
          <span class='id identifier rubyid_connect_without_timeout'><a href="#connect_without_timeout-instance_method" title="Mongo::Socket::SSL#connect_without_timeout (method)">connect_without_timeout</a></span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span>)
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_connect_with_timeout'><a href="#connect_with_timeout-instance_method" title="Mongo::Socket::SSL#connect_with_timeout (method)">connect_with_timeout</a></span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>)
      <span class='kw'>end</span>
      <span class='id identifier rubyid_remaining_timeout'>remaining_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>-</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_monotonic_time'>monotonic_time</span>
      <span class='id identifier rubyid_verify_certificate!'><a href="#verify_certificate!-instance_method" title="Mongo::Socket::SSL#verify_certificate! (method)">verify_certificate!</a></span>(<span class='ivar'>@socket</span>)
      <span class='id identifier rubyid_verify_ocsp_endpoint!'><a href="#verify_ocsp_endpoint!-instance_method" title="Mongo::Socket::SSL#verify_ocsp_endpoint! (method)">verify_ocsp_endpoint!</a></span>(<span class='ivar'>@socket</span><span class='comma'>,</span> <span class='id identifier rubyid_remaining_timeout'>remaining_timeout</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_connect_without_timeout'><a href="#connect_without_timeout-instance_method" title="Mongo::Socket::SSL#connect_without_timeout (method)">connect_without_timeout</a></span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span>)
      <span class='id identifier rubyid_verify_certificate!'><a href="#verify_certificate!-instance_method" title="Mongo::Socket::SSL#verify_certificate! (method)">verify_certificate!</a></span>(<span class='ivar'>@socket</span>)
      <span class='id identifier rubyid_verify_ocsp_endpoint!'><a href="#verify_ocsp_endpoint!-instance_method" title="Mongo::Socket::SSL#verify_ocsp_endpoint! (method)">verify_ocsp_endpoint!</a></span>(<span class='ivar'>@socket</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>rescue</span>
  <span class='ivar'>@socket</span><span class='op'>&amp;.</span><span class='id identifier rubyid_close'><a href="../Socket.html#close-instance_method" title="Mongo::Socket#close (method)">close</a></span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connect_tcp_socket_with_timeout-instance_method">
  <h3 class='signature priv'>
    #<strong>connect_tcp_socket_with_timeout</strong>(sockaddr, deadline, connect_timeout)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L222-L236'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='222' data-end='236'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 222</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_tcp_socket_with_timeout'>connect_tcp_socket_with_timeout</span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>&lt;=</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_monotonic_time'>monotonic_time</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The socket took over </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds to connect</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@tcp_socket</span>.<span class='id identifier rubyid_connect_nonblock'>connect_nonblock</span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span>)
  <span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitWritable</span>
    <span class='id identifier rubyid_with_select_timeout'><a href="#with_select_timeout-instance_method" title="Mongo::Socket::SSL#with_select_timeout (method)">with_select_timeout</a></span>(<span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_select_timeout'>select_timeout</span><span class='op'>|</span>
      <span class='const'>IO</span>.<span class='id identifier rubyid_select'>select</span>(<span class='kw'>nil</span><span class='comma'>,</span> [<span class='ivar'>@tcp_socket</span>]<span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_select_timeout'>select_timeout</span>)
    <span class='kw'>end</span>
    <span class='kw'>retry</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EISCONN</span>
    <span class='comment'># Socket is connected, nothing to do.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connect_with_timeout-instance_method">
  <h3 class='signature priv'>
    #<strong>connect_with_timeout</strong>(sockaddr, connect_timeout)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Connects the socket with the connect timeout. The timeout applies to connecting both ssl socket and the underlying tcp socket.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>sockaddr</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p><a href="../Address.html" title="Mongo::Address (class)"><code>::Mongo::Address</code></a> to connect to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L212-L220'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='212' data-end='220'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 212</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_with_timeout'>connect_with_timeout</span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The socket took over </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds to connect</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>=</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_monotonic_time'>monotonic_time</span> <span class='op'>+</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>
  <span class='id identifier rubyid_connect_tcp_socket_with_timeout'><a href="#connect_tcp_socket_with_timeout-instance_method" title="Mongo::Socket::SSL#connect_tcp_socket_with_timeout (method)">connect_tcp_socket_with_timeout</a></span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='comma'>,</span> <span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>)
  <span class='id identifier rubyid_connnect_ssl_socket_with_timeout'><a href="#connnect_ssl_socket_with_timeout-instance_method" title="Mongo::Socket::SSL#connnect_ssl_socket_with_timeout (method)">connnect_ssl_socket_with_timeout</a></span>(<span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connect_without_timeout-instance_method">
  <h3 class='signature priv'>
    #<strong>connect_without_timeout</strong>(sockaddr)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Connects the socket without a timeout provided.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>sockaddr</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p><a href="../Address.html" title="Mongo::Address (class)"><code>::Mongo::Address</code></a> to connect to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L200-L206'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='200' data-end='206'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 200</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_without_timeout'>connect_without_timeout</span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span>)
  <span class='ivar'>@tcp_socket</span>.<span class='id identifier rubyid_connect'>connect</span>(<span class='id identifier rubyid_sockaddr'>sockaddr</span>)
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLSocket</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>(<span class='ivar'>@tcp_socket</span><span class='comma'>,</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>)
  <span class='ivar'>@socket</span>.<span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='ivar'>@host_name</span>
  <span class='ivar'>@socket</span>.<span class='id identifier rubyid_sync_close'>sync_close</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@socket</span>.<span class='id identifier rubyid_connect'>connect</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connnect_ssl_socket_with_timeout-instance_method">
  <h3 class='signature priv'>
    #<strong>connnect_ssl_socket_with_timeout</strong>(deadline, connect_timeout)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L238-L262'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='238' data-end='262'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 238</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connnect_ssl_socket_with_timeout'>connnect_ssl_socket_with_timeout</span>(<span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>&lt;=</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_monotonic_time'>monotonic_time</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The socket took over </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds to connect</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLSocket</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>(<span class='ivar'>@tcp_socket</span><span class='comma'>,</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>)
  <span class='ivar'>@socket</span>.<span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='ivar'>@host_name</span>
  <span class='ivar'>@socket</span>.<span class='id identifier rubyid_sync_close'>sync_close</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># We still have time, connecting ssl socket.
</span>  <span class='kw'>begin</span>
    <span class='ivar'>@socket</span>.<span class='id identifier rubyid_connect_nonblock'>connect_nonblock</span>
  <span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitReadable</span><span class='comma'>,</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLErrorWaitReadable</span>
    <span class='id identifier rubyid_with_select_timeout'><a href="#with_select_timeout-instance_method" title="Mongo::Socket::SSL#with_select_timeout (method)">with_select_timeout</a></span>(<span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_select_timeout'>select_timeout</span><span class='op'>|</span>
      <span class='const'>IO</span>.<span class='id identifier rubyid_select'>select</span>([<span class='ivar'>@socket</span>]<span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_select_timeout'>select_timeout</span>)
    <span class='kw'>end</span>
    <span class='kw'>retry</span>
  <span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitWritable</span><span class='comma'>,</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLErrorWaitWritable</span>
    <span class='id identifier rubyid_with_select_timeout'><a href="#with_select_timeout-instance_method" title="Mongo::Socket::SSL#with_select_timeout (method)">with_select_timeout</a></span>(<span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_select_timeout'>select_timeout</span><span class='op'>|</span>
      <span class='const'>IO</span>.<span class='id identifier rubyid_select'>select</span>(<span class='kw'>nil</span><span class='comma'>,</span> [<span class='ivar'>@socket</span>]<span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_select_timeout'>select_timeout</span>)
    <span class='kw'>end</span>
    <span class='kw'>retry</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EISCONN</span>
    <span class='comment'># Socket is connected, nothing to do
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_context-instance_method">
  <h3 class='signature priv'>
    #<strong>create_context</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L310-L352'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='310' data-end='352'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 310</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_context'>create_context</span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLContext</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span>.<span class='id identifier rubyid_const_defined?'>const_defined?</span>(<span class='symbeg'>:</span><span class='const'>OP_NO_RENEGOTIATION</span>)
      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span> <span class='op'>=</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span> <span class='op'>|</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>OP_NO_RENEGOTIATION</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_renegotiation_cb='>renegotiation_cb=</span>)
      <span class='comment'># Disable renegotiation for older Ruby versions per the sample code at
</span>      <span class='comment'># https://rubydocs.org/d/ruby-2-6-0/classes/OpenSSL/SSL/SSLContext.html
</span>      <span class='comment'># In JRuby we must allow one call as this callback is invoked for
</span>      <span class='comment'># the initial connection also, not just for renegotiations -
</span>      <span class='comment'># https://github.com/jruby/jruby-openssl/issues/180
</span>      <span class='kw'>if</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>Environment</span>.<span class='id identifier rubyid_jruby?'>jruby?</span>
        <span class='id identifier rubyid_allowed_calls'>allowed_calls</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_allowed_calls'>allowed_calls</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_renegotiation_cb'>renegotiation_cb</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ssl'>ssl</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_allowed_calls'>allowed_calls</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Client renegotiation disabled</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_allowed_calls'>allowed_calls</span> <span class='op'>-=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_set_cert'><a href="#set_cert-instance_method" title="Mongo::Socket::SSL#set_cert (method)">set_cert</a></span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)
    <span class='id identifier rubyid_set_key'><a href="#set_key-instance_method" title="Mongo::Socket::SSL#set_key (method)">set_key</a></span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_verify_certificate?'><a href="#verify_certificate%3F-instance_method" title="Mongo::Socket::SSL#verify_certificate? (method)">verify_certificate?</a></span>
      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_PEER</span>
      <span class='id identifier rubyid_set_cert_verification'><a href="#set_cert_verification-instance_method" title="Mongo::Socket::SSL#set_cert_verification (method)">set_cert_verification</a></span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_NONE</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_verify_hostname='>verify_hostname=</span>)
      <span class='comment'># We manually check the hostname after the connection is established if necessary, so
</span>      <span class='comment'># we disable it here in order to give consistent errors across Ruby versions which
</span>      <span class='comment'># don&#39;t support hostname verification at the time of the handshake.
</span>      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_verify_hostname'>verify_hostname</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_NONE</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="extract_certs-instance_method">
  <h3 class='signature priv'>
    #<strong>extract_certs</strong>(text)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This was originally a scan + regex, but the regex was particularly inefficient and was flagged as a concern by static analysis.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L495-L509'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='495' data-end='509'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 495</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_certs'>extract_certs</span>(<span class='id identifier rubyid_text'>text</span>)
  [].<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_list'>list</span><span class='op'>|</span>
    <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='kw'>while</span> (<span class='id identifier rubyid_begin_idx'>begin_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_text'>text</span>.<span class='id identifier rubyid_index'>index</span>(<span class='const'><a href="#BEGIN_CERT-constant" title="Mongo::Socket::SSL::BEGIN_CERT (constant)">BEGIN_CERT</a></span><span class='comma'>,</span> <span class='id identifier rubyid_pos'>pos</span>))
      <span class='id identifier rubyid_end_idx'>end_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_text'>text</span>.<span class='id identifier rubyid_index'>index</span>(<span class='const'><a href="#END_CERT-constant" title="Mongo::Socket::SSL::END_CERT (constant)">END_CERT</a></span><span class='comma'>,</span> <span class='id identifier rubyid_begin_idx'>begin_idx</span>)
      <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_end_idx'>end_idx</span>

      <span class='id identifier rubyid_end_idx'>end_idx</span> <span class='op'>+=</span> <span class='const'><a href="#END_CERT-constant" title="Mongo::Socket::SSL::END_CERT (constant)">END_CERT</a></span>.<span class='id identifier rubyid_length'>length</span>
      <span class='id identifier rubyid_list'>list</span>.<span class='id identifier rubyid_push'>push</span>(<span class='id identifier rubyid_text'>text</span>[<span class='id identifier rubyid_begin_idx'>begin_idx</span><span class='op'>...</span><span class='id identifier rubyid_end_idx'>end_idx</span>])

      <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_end_idx'>end_idx</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_issuer-instance_method">
  <h3 class='signature priv'>
    #<strong>find_issuer</strong>(cert, cert_chain)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Find the issuer certificate in the chain.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L512-L514'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='512' data-end='514'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 512</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_issuer'>find_issuer</span>(<span class='id identifier rubyid_cert'>cert</span><span class='comma'>,</span> <span class='id identifier rubyid_cert_chain'>cert_chain</span>)
  <span class='id identifier rubyid_cert_chain'>cert_chain</span>.<span class='id identifier rubyid_find'>find</span> { <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_subject'>subject</span> <span class='op'>==</span> <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_issuer'>issuer</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="human_address-instance_method">
  <h3 class='signature priv'>
    #<strong>human_address</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L480-L482'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='480' data-end='482'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 480</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_human_address'>human_address</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'><a href="#host-instance_method" title="Mongo::Socket::SSL#host (method)">host</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'><a href="#port-instance_method" title="Mongo::Socket::SSL#port (method)">port</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host_name'><a href="#host_name-instance_method" title="Mongo::Socket::SSL#host_name (method)">host_name</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'><a href="#port-instance_method" title="Mongo::Socket::SSL#port (method)">port</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>, TLS)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_private_key-instance_method">
  <h3 class='signature priv'>
    #<strong>load_private_key</strong>(text, passphrase)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L413-L432'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='413' data-end='432'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 413</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_private_key'>load_private_key</span>(<span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>)
  <span class='id identifier rubyid_args'>args</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_passphrase'>passphrase</span>
    [<span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>]
  <span class='kw'>else</span>
    [<span class='id identifier rubyid_text'>text</span>]
  <span class='kw'>end</span>
  <span class='comment'># On JRuby, PKey.read does not grok cert+key bundles.
</span>  <span class='comment'># https://github.com/jruby/jruby-openssl/issues/176
</span>  <span class='kw'>if</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>Environment</span>.<span class='id identifier rubyid_jruby?'>jruby?</span>
    [<span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span><span class='comma'>,</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>DSA</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cls'>cls</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_cls'>cls</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
      <span class='kw'>rescue</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>PKeyError</span>
        <span class='comment'># ignore
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'># Neither RSA nor DSA worked, fall through to trying PKey
</span>  <span class='kw'>end</span>
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_read'><a href="../Socket.html#read-instance_method" title="Mongo::Socket#read (method)">read</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_buffer_size-instance_method">
  <h3 class='signature priv'>
    #<strong>read_buffer_size</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L474-L478'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='474' data-end='478'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 474</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_buffer_size'>read_buffer_size</span>
  <span class='comment'># Buffer size for TLS reads.
</span>  <span class='comment'># Capped at 16k due to https://linux.die.net/man/3/ssl_read
</span>  <span class='int'>16384</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="readbyte-instance_method">
  <h3 class='signature '>
    #<strong>readbyte</strong>  &#x21d2; <code>Object</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Read a single byte from the socket.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Read a single byte.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span>.<span class='id identifier rubyid_readbyte'>readbyte</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The read byte.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L188-L193'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='188' data-end='193'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 188</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_readbyte'>readbyte</span>
  <span class='id identifier rubyid_map_exceptions'><a href="../Socket.html#map_exceptions-instance_method" title="Mongo::Socket#map_exceptions (method)">map_exceptions</a></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_byte'>byte</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span>.<span class='id identifier rubyid_read'><a href="../Socket.html#read-instance_method" title="Mongo::Socket#read (method)">read</a></span>(<span class='int'>1</span>).<span class='id identifier rubyid_bytes'>bytes</span>.<span class='id identifier rubyid_to_a'>to_a</span>[<span class='int'>0</span>]
    <span class='id identifier rubyid_byte'>byte</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='id identifier rubyid_raise'>raise</span>(<span class='const'>EOFError</span>) <span class='op'>:</span> <span class='id identifier rubyid_byte'>byte</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run_tls_context_hooks-instance_method">
  <h3 class='signature priv'>
    #<strong>run_tls_context_hooks</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L484-L488'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='484' data-end='488'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 484</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run_tls_context_hooks'>run_tls_context_hooks</span>
  <span class='const'><a href="../../Mongo.html" title="Mongo (module)">Mongo</a></span>.<span class='id identifier rubyid_tls_context_hooks'>tls_context_hooks</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hook'>hook</span><span class='op'>|</span>
    <span class='id identifier rubyid_hook'>hook</span>.<span class='id identifier rubyid_call'>call</span>(<span class='ivar'>@context</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_cert-instance_method">
  <h3 class='signature priv'>
    #<strong>set_cert</strong>(context, options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L354-L400'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='354' data-end='400'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 354</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_cert'>set_cert</span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)
  <span class='comment'># Since we clear cert_text during processing, we need to examine
</span>  <span class='comment'># ssl_cert_object here to avoid considering it if we have also
</span>  <span class='comment'># processed the text.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert'>ssl_cert</span>]
    <span class='id identifier rubyid_cert_text'>cert_text</span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_read'><a href="../Socket.html#read-instance_method" title="Mongo::Socket#read (method)">read</a></span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert'>ssl_cert</span>])
    <span class='id identifier rubyid_cert_object'>cert_object</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_cert_text'>cert_text</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert_string'>ssl_cert_string</span>]
    <span class='id identifier rubyid_cert_object'>cert_object</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cert_object'>cert_object</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert_object'>ssl_cert_object</span>]
  <span class='kw'>end</span>

  <span class='comment'># The client certificate may be a single certificate or a bundle
</span>  <span class='comment'># (client certificate followed by intermediate certificates).
</span>  <span class='comment'># The text may also include private keys for the certificates.
</span>  <span class='comment'># OpenSSL supports passing the entire bundle as a certificate chain
</span>  <span class='comment'># to the context via SSL_CTX_use_certificate_chain_file, but the
</span>  <span class='comment'># Ruby openssl extension does not currently expose this functionality
</span>  <span class='comment'># per https://github.com/ruby/openssl/issues/254.
</span>  <span class='comment'># Therefore, extract the individual certificates from the certificate
</span>  <span class='comment'># text, and if there is more than one certificate provided, use
</span>  <span class='comment'># extra_chain_cert option to add the intermediate ones. This
</span>  <span class='comment'># implementation is modeled after
</span>  <span class='comment'># https://github.com/venuenext/ruby-kafka/commit/9495f5daf254b43bc88062acad9359c5f32cb8b5.
</span>  <span class='comment'># Note that the parsing here is not identical to what OpenSSL employs -
</span>  <span class='comment'># for instance, if there is no newline between two certificates
</span>  <span class='comment'># this code will extract them both but OpenSSL fails in this situation.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cert_text'>cert_text</span>
    <span class='id identifier rubyid_certs'>certs</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_certs'><a href="#extract_certs-instance_method" title="Mongo::Socket::SSL#extract_certs (method)">extract_certs</a></span>(<span class='id identifier rubyid_cert_text'>cert_text</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_certs'>certs</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_cert'>cert</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>(<span class='id identifier rubyid_certs'>certs</span>.<span class='id identifier rubyid_shift'>shift</span>)
      <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_extra_chain_cert'>extra_chain_cert</span> <span class='op'>=</span> <span class='id identifier rubyid_certs'>certs</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cert'>cert</span><span class='op'>|</span>
        <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>(<span class='id identifier rubyid_cert'>cert</span>)
      <span class='kw'>end</span>
      <span class='comment'># All certificates are already added to the context, skip adding
</span>      <span class='comment'># them again below.
</span>      <span class='id identifier rubyid_cert_text'>cert_text</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_cert_text'>cert_text</span>
    <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_cert'>cert</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>(<span class='id identifier rubyid_cert_text'>cert_text</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_cert_object'>cert_object</span>
    <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_cert'>cert</span> <span class='op'>=</span> <span class='id identifier rubyid_cert_object'>cert_object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_cert_verification-instance_method">
  <h3 class='signature priv'>
    #<strong>set_cert_verification</strong>(context, options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L434-L448'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='434' data-end='448'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 434</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_cert_verification'>set_cert_verification</span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)
  <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_PEER</span>
  <span class='id identifier rubyid_cert_store'>cert_store</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Store</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert'>ssl_ca_cert</span>]
    <span class='id identifier rubyid_cert_store'>cert_store</span>.<span class='id identifier rubyid_add_file'>add_file</span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert'>ssl_ca_cert</span>])
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_string'>ssl_ca_cert_string</span>]
    <span class='id identifier rubyid_cert_store'>cert_store</span>.<span class='id identifier rubyid_add_cert'>add_cert</span>(<span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Socket::SSL.new (method)">new</a></span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_string'>ssl_ca_cert_string</span>]))
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_object'>ssl_ca_cert_object</span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Option :ssl_ca_cert_object should be an array of OpenSSL::X509:Certificate objects</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_object'>ssl_ca_cert_object</span>].<span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_object'>ssl_ca_cert_object</span>].<span class='id identifier rubyid_each'>each</span> {<span class='op'>|</span><span class='id identifier rubyid_cert'>cert</span><span class='op'>|</span> <span class='id identifier rubyid_cert_store'>cert_store</span>.<span class='id identifier rubyid_add_cert'>add_cert</span>(<span class='id identifier rubyid_cert'>cert</span>)}
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cert_store'>cert_store</span>.<span class='id identifier rubyid_set_default_paths'>set_default_paths</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_cert_store'>cert_store</span> <span class='op'>=</span> <span class='id identifier rubyid_cert_store'>cert_store</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_key-instance_method">
  <h3 class='signature priv'>
    #<strong>set_key</strong>(context, options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L402-L411'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='402' data-end='411'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 402</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_key'>set_key</span>(<span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>)
  <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_pass_phrase'>ssl_key_pass_phrase</span>]
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key'>ssl_key</span>]
    <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_load_private_key'><a href="#load_private_key-instance_method" title="Mongo::Socket::SSL#load_private_key (method)">load_private_key</a></span>(<span class='const'>File</span>.<span class='id identifier rubyid_read'><a href="../Socket.html#read-instance_method" title="Mongo::Socket#read (method)">read</a></span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key'>ssl_key</span>])<span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_string'>ssl_key_string</span>]
    <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_load_private_key'><a href="#load_private_key-instance_method" title="Mongo::Socket::SSL#load_private_key (method)">load_private_key</a></span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_string'>ssl_key_string</span>]<span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_object'>ssl_key_object</span>]
    <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_object'>ssl_key_object</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_certificate!-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_certificate!</strong>(socket)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L450-L456'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='450' data-end='456'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 450</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_certificate!'>verify_certificate!</span>(<span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_verify_hostname?'><a href="#verify_hostname%3F-instance_method" title="Mongo::Socket::SSL#verify_hostname? (method)">verify_hostname?</a></span>
    <span class='kw'>unless</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span>.<span class='id identifier rubyid_verify_certificate_identity'>verify_certificate_identity</span>(<span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span>.<span class='id identifier rubyid_peer_cert'>peer_cert</span><span class='comma'>,</span> <span class='id identifier rubyid_host_name'><a href="#host_name-instance_method" title="Mongo::Socket::SSL#host_name (method)">host_name</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>TLS handshake failed due to a hostname mismatch.</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_ocsp_endpoint!-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_ocsp_endpoint!</strong>(socket, timeout = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L458-L472'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='458' data-end='472'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 458</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_ocsp_endpoint!'>verify_ocsp_endpoint!</span>(<span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span><span class='comma'>,</span> <span class='id identifier rubyid_timeout'><a href="../Socket.html#timeout-instance_method" title="Mongo::Socket#timeout (method)">timeout</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_verify_ocsp_endpoint?'><a href="#verify_ocsp_endpoint%3F-instance_method" title="Mongo::Socket::SSL#verify_ocsp_endpoint? (method)">verify_ocsp_endpoint?</a></span>

  <span class='id identifier rubyid_cert'>cert</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span>.<span class='id identifier rubyid_peer_cert'>peer_cert</span>
  <span class='id identifier rubyid_ca_cert'>ca_cert</span> <span class='op'>=</span> <span class='id identifier rubyid_find_issuer'><a href="#find_issuer-instance_method" title="Mongo::Socket::SSL#find_issuer (method)">find_issuer</a></span>(<span class='id identifier rubyid_cert'>cert</span><span class='comma'>,</span> <span class='id identifier rubyid_socket'><a href="../Socket.html#socket-instance_method" title="Mongo::Socket#socket (method)">socket</a></span>.<span class='id identifier rubyid_peer_cert_chain'>peer_cert_chain</span>)

  <span class='kw'>unless</span> <span class='id identifier rubyid_ca_cert'>ca_cert</span>
    <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TLS certificate of &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host_name'><a href="#host_name-instance_method" title="Mongo::Socket::SSL#host_name (method)">host_name</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; could not be definitively verified via OCSP: issuer certificate not found in the chain.</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="OcspVerifier.html" title="Mongo::Socket::OcspVerifier (class)">OcspVerifier</a></span>.<span class='id identifier rubyid_new'><a href="OcspVerifier.html#new-class_method" title="Mongo::Socket::OcspVerifier.new (method)">new</a></span>(<span class='ivar'>@host_name</span><span class='comma'>,</span> <span class='id identifier rubyid_cert'>cert</span><span class='comma'>,</span> <span class='id identifier rubyid_ca_cert'>ca_cert</span><span class='comma'>,</span> <span class='id identifier rubyid_context'><a href="#context-instance_method" title="Mongo::Socket::SSL#context (method)">context</a></span>.<span class='id identifier rubyid_cert_store'>cert_store</span><span class='comma'>,</span>
    <span class='op'>**</span><span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_shallow_symbolize_keys'>shallow_symbolize_keys</span>(<span class='id identifier rubyid_options'><a href="../Socket.html#options-instance_method" title="Mongo::Socket#options (method)">options</a></span>).<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'><a href="../Socket.html#timeout-instance_method" title="Mongo::Socket#timeout (method)">timeout</a></span>))
  <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify_with_cache'>verify_with_cache</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_select_timeout-instance_method">
  <h3 class='signature priv'>
    #<strong>with_select_timeout</strong>(deadline, connect_timeout, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises <a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)"><code>::Mongo::Error::SocketTimeoutError</code></a> exception if deadline reached or the block returns nil. The block should call <code>IO.select</code> with the <code>connect_timeout</code> value. It returns nil if the <code>connect_timeout</code> expires.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/socket/ssl.rb#L267-L276'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='267' data-end='276'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/socket/ssl.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_select_timeout'>with_select_timeout</span>(<span class='id identifier rubyid_deadline'>deadline</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_select_timeout'>select_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>-</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_monotonic_time'>monotonic_time</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_select_timeout'>select_timeout</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The socket took over </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds to connect</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_rv'>rv</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_select_timeout'>select_timeout</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_rv'>rv</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The socket took over </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds to connect</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>