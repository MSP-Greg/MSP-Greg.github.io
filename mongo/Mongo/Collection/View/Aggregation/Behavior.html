<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Mongo::Collection::View::Aggregation::Behavior &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Collection::View::Aggregation::Behavior",
    relpath = '../../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../../'>Mongo master</a> &raquo; 
      <a href='../../../../_index.html#alpha_B'>Index (B)</a> &raquo; 
        <a href="../../../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../../../Collection.html" title="Mongo::Collection (class)">Collection</a> &raquo; 
        <a href="../../View.html" title="Mongo::Collection::View (class)">View</a> &raquo; 
        <a href="../Aggregation.html" title="Mongo::Collection::View::Aggregation (class)">Aggregation</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Behavior&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Mongo::Collection::View::Aggregation::Behavior</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="../Aggregation.html" title="Mongo::Collection::View::Aggregation (class)"><code>::Mongo::Collection::View::Aggregation</code></a>,
          <a href="../ChangeStream.html" title="Mongo::Collection::View::ChangeStream (class)"><code>::Mongo::Collection::View::ChangeStream</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../../../Retryable.html" title="Mongo::Retryable (module)"><code>::Mongo::Retryable</code></a>,
          <a href="../../../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a>,
          <a href="../Explainable.html" title="Mongo::Collection::View::Explainable (module)"><code>::Mongo::Collection::View::Explainable</code></a>,
          <a href="../Iterable.html" title="Mongo::Collection::View::Iterable (module)"><code>::Mongo::Collection::View::Iterable</code></a>,
          <a href="../../../CursorHost.html" title="Mongo::CursorHost (module)"><code>::Mongo::CursorHost</code></a>,
          <a href="../Immutable.html" title="Mongo::Collection::View::Immutable (module)"><code>::Mongo::Collection::View::Immutable</code></a>,
          Enumerable
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L9'>lib/mongo/collection/view/aggregation/behavior.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Distills the behavior common to aggregator classes, like View::Aggregator and <a href="../ChangeStream.html" title="Mongo::Collection::View::ChangeStream (class)"><code>::Mongo::Collection::View::ChangeStream</code></a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
  <h3 class='inherited'><a href="../Explainable.html" title="Mongo::Collection::View::Explainable (module)"><code>::Mongo::Collection::View::Explainable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../Explainable.html#ALL_PLANS_EXECUTION-constant" title="Mongo::Collection::View::Explainable::ALL_PLANS_EXECUTION (constant)">ALL_PLANS_EXECUTION</a>, 
    <a href="../Explainable.html#EXECUTION_STATS-constant" title="Mongo::Collection::View::Explainable::EXECUTION_STATS (constant)">EXECUTION_STATS</a>, 
    <a href="../Explainable.html#QUERY_PLANNER-constant" title="Mongo::Collection::View::Explainable::QUERY_PLANNER (constant)">QUERY_PLANNER</a>
  </p>
  <h3 class='inherited'><a href="../../../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../../../Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">PREFIX</a>
  </p>
</div>

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#view-instance_method" title="#view (instance method)">#<strong>view</strong>  &#x21d2; View </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#write%3F-instance_method" title="#write? (instance method)">#<strong>write?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether this aggregation will write its result to a database collection.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../Explainable.html" title="Mongo::Collection::View::Explainable (module)"><code>::Mongo::Collection::View::Explainable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro priv' href="../Explainable.html#explained%3F-instance_method" title="Mongo::Collection::View::Explainable#explained? (method)">#explained?</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Iterable.html" title="Mongo::Collection::View::Iterable (module)"><code>::Mongo::Collection::View::Iterable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro priv' href="../Iterable.html#prefer_cached_cursor%3F-instance_method" title="Mongo::Collection::View::Iterable#prefer_cached_cursor? (method)">#prefer_cached_cursor?</a></td>
      <td><div class='inline'><p>If the caching cursor is closed and was not fully iterated, the documents we have in it are not the complete result set and we have no way of completing that iteration.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro priv' href="../Iterable.html#use_query_cache%3F-instance_method" title="Mongo::Collection::View::Iterable#use_query_cache? (method)">#use_query_cache?</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../../../CursorHost.html" title="Mongo::CursorHost (module)"><code>::Mongo::CursorHost</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc' href="../../../CursorHost.html#cursor-instance_method" title="Mongo::CursorHost#cursor (method)">#cursor</a></td>
      <td><div class='inline'><p>Returns the cursor associated with this view, if any.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="../../../CursorHost.html#timeout_mode-instance_method" title="Mongo::CursorHost#timeout_mode (method)">#timeout_mode</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Immutable.html" title="Mongo::Collection::View::Immutable (module)"><code>::Mongo::Collection::View::Immutable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="../Immutable.html#options-instance_method" title="Mongo::Collection::View::Immutable#options (method)">#options</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#allow_disk_use-instance_method" title="#allow_disk_use (instance method)">#<strong>allow_disk_use</strong>(value = nil)  &#x21d2; true, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Set to true if disk usage is allowed during the aggregation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#explain-instance_method" title="#explain (instance method)">#<strong>explain</strong>  &#x21d2; Hash </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the explain plan for the aggregation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#timeout_ms-instance_method" title="#timeout_ms (instance method)">#<strong>timeout_ms</strong>  &#x21d2; Integer | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#aggregate_spec-instance_method" title="#aggregate_spec (instance method)">#<strong>aggregate_spec</strong>(session, read_preference = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#cache_options-instance_method" title="#cache_options (instance method)">#<strong>cache_options</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Skip, sort, limit, projection are specified as pipeline stages rather than as options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#operation_timeouts-instance_method" title="#operation_timeouts (instance method)">#<strong>operation_timeouts</strong>(opts = {})  &#x21d2; Hash </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#perform_setup-instance_method" title="#perform_setup (instance method)">#<strong>perform_setup</strong>(view, options, forbid: [])  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Common setup for all classes that include this behavior; the constructor should invoke this method.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#server_selector-instance_method" title="#server_selector (instance method)">#<strong>server_selector</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="../../../Retryable.html" title="Mongo::Retryable (module)"><code>::Mongo::Retryable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../../../Retryable.html#read_worker-instance_method" title="Mongo::Retryable#read_worker (method)">#read_worker</a></td>
      <td><div class='inline'><p>Returns the read worker for handling retryable reads.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../../../Retryable.html#select_server-instance_method" title="Mongo::Retryable#select_server (method)">#select_server</a></td>
      <td><div class='inline'><p>This is a separate method to make it possible for the test suite to assert that server selection is performed during retry attempts.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../../../Retryable.html#write_worker-instance_method" title="Mongo::Retryable#write_worker (method)">#write_worker</a></td>
      <td><div class='inline'><p>Returns the write worker for handling retryable writes.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../../../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../../Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></td>
      <td><div class='inline'><p>Convenience method to log debug messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../../Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></td>
      <td><div class='inline'><p>Convenience method to log error messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../../Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></td>
      <td><div class='inline'><p>Convenience method to log fatal messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../../Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></td>
      <td><div class='inline'><p>Convenience method to log info messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../../Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></td>
      <td><div class='inline'><p>Convenience method to log warn messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../../Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></td>
      <td><div class='inline'><p>Get the logger instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../../../Loggable.html#_mongo_log_prefix-instance_method" title="Mongo::Loggable#_mongo_log_prefix (method)">#_mongo_log_prefix</a>,
        <a class='i_m priv' href="../../../Loggable.html#format_message-instance_method" title="Mongo::Loggable#format_message (method)">#format_message</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Explainable.html" title="Mongo::Collection::View::Explainable (module)"><code>::Mongo::Collection::View::Explainable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Explainable.html#explain-instance_method" title="Mongo::Collection::View::Explainable#explain (method)">#explain</a></td>
      <td><div class='inline'><p>Get the query plan for the query.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../Explainable.html#explain_options-instance_method" title="Mongo::Collection::View::Explainable#explain_options (method)">#explain_options</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Iterable.html" title="Mongo::Collection::View::Iterable (module)"><code>::Mongo::Collection::View::Iterable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Iterable.html#close_query-instance_method" title="Mongo::Collection::View::Iterable#close_query (method)">#close_query</a></td>
      <td><div class='inline'><p>Cleans up resources associated with this query.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Iterable.html#each-instance_method" title="Mongo::Collection::View::Iterable#each (method)">#each</a></td>
      <td><div class='inline'><p>Iterate through documents returned by a query with this <a href="../../View.html" title="Mongo::Collection::View (class)"><code>::Mongo::Collection::View</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Iterable.html#kill_cursors-instance_method" title="Mongo::Collection::View::Iterable#kill_cursors (method)">#kill_cursors</a></td>
      <td><div class='inline'><p>Alias for <a href="../Iterable.html#close_query-instance_method" title="Mongo::Collection::View::Iterable#close_query (method)">Iterable#close_query</a>.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../Iterable.html#cache_options-instance_method" title="Mongo::Collection::View::Iterable#cache_options (method)">#cache_options</a>,
        <a class='i_m priv' href="../Iterable.html#cached_cursor-instance_method" title="Mongo::Collection::View::Iterable#cached_cursor (method)">#cached_cursor</a>,
        <a class='i_m priv' href="../Iterable.html#compute_limit_for_cached_query-instance_method" title="Mongo::Collection::View::Iterable#compute_limit_for_cached_query (method)">#compute_limit_for_cached_query</a>,
        <a class='i_m priv' href="../Iterable.html#initial_query_op-instance_method" title="Mongo::Collection::View::Iterable#initial_query_op (method)">#initial_query_op</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../Iterable.html#maybe_set_tailable_options-instance_method" title="Mongo::Collection::View::Iterable#maybe_set_tailable_options (method)">#maybe_set_tailable_options</a></td>
      <td><div class='inline'><p>Add tailable cusror options to the command specifiction if needed.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../Iterable.html#new_cursor_for_iteration-instance_method" title="Mongo::Collection::View::Iterable#new_cursor_for_iteration (method)">#new_cursor_for_iteration</a></td>
      <td><div class='inline'><p>Start a new cursor for use when iterating (via #each).</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../Iterable.html#oplog_replay-instance_method" title="Mongo::Collection::View::Iterable#oplog_replay (method)">#oplog_replay</a>,
        <a class='i_m priv' href="../Iterable.html#select_cursor-instance_method" title="Mongo::Collection::View::Iterable#select_cursor (method)">#select_cursor</a>,
        <a class='i_m priv' href="../Iterable.html#send_initial_query-instance_method" title="Mongo::Collection::View::Iterable#send_initial_query (method)">#send_initial_query</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../../../CursorHost.html" title="Mongo::CursorHost (module)"><code>::Mongo::CursorHost</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../../../CursorHost.html#validate_timeout_mode!-instance_method" title="Mongo::CursorHost#validate_timeout_mode! (method)">#validate_timeout_mode!</a></td>
      <td><div class='inline'><p>Ensure the timeout mode is appropriate for other options that have been given.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Immutable.html" title="Mongo::Collection::View::Immutable (module)"><code>::Mongo::Collection::View::Immutable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../Immutable.html#configure-instance_method" title="Mongo::Collection::View::Immutable#configure (method)">#configure</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="view-instance_method">
  <h3 class='signature ro first'>
    #<strong>view</strong>  &#x21d2; <a href="../../View.html" title="Mongo::Collection::View (class)">View</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../View.html" title="Mongo::Collection::View (class)">View</a>)</span>
&mdash;    <div class='inline'>
<p>view The collection view.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L19-L19'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='19' data-end='19'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 19</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_view'>view</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>write?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether this aggregation will write its result to a database collection.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>Whether the aggregation will write its result to a collection.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L60-L62'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='60' data-end='62'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 60</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write?'>write?</span>
  <span class='id identifier rubyid_pipeline'><a href="../Aggregation.html#pipeline-instance_method" title="Mongo::Collection::View::Aggregation#pipeline (method)">pipeline</a></span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_op'>op</span><span class='op'>|</span> <span class='id identifier rubyid_op'>op</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$out</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>||</span> <span class='id identifier rubyid_op'>op</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='gvar'>$out</span>) <span class='op'>||</span> <span class='id identifier rubyid_op'>op</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$merge</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>||</span> <span class='id identifier rubyid_op'>op</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='gvar'>$merge</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="aggregate_spec-instance_method">
  <h3 class='signature priv first'>
    #<strong>aggregate_spec</strong>(session, read_preference = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L91-L97'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='91' data-end='97'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 91</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_aggregate_spec'>aggregate_spec</span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_read_preference'>read_preference</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='const'><a href="../Builder.html" title="Mongo::Collection::View::Builder (module)">Builder</a></span><span class='op'>::</span><span class='const'><a href="../Builder/Aggregation.html" title="Mongo::Collection::View::Builder::Aggregation (class)">Aggregation</a></span>.<span class='id identifier rubyid_new'><a href="../Builder/Aggregation.html#new-class_method" title="Mongo::Collection::View::Builder::Aggregation.new (method)">new</a></span>(
    <span class='id identifier rubyid_pipeline'><a href="../Aggregation.html#pipeline-instance_method" title="Mongo::Collection::View::Aggregation#pipeline (method)">pipeline</a></span><span class='comma'>,</span>
    <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span><span class='comma'>,</span>
    <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>session:</span> <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='label'>read_preference:</span> <span class='id identifier rubyid_read_preference'>read_preference</span>)
  ).<span class='id identifier rubyid_specification'><a href="../Builder/Aggregation.html#specification-instance_method" title="Mongo::Collection::View::Builder::Aggregation#specification (method)">specification</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="allow_disk_use-instance_method">
  <h3 class='signature '>
    #<strong>allow_disk_use</strong>(value = nil)  &#x21d2; <code>true</code>, ... 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Set to true if disk usage is allowed during the aggregation.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Set disk usage flag.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_aggregation'>aggregation</span>.<span class='id identifier rubyid_allow_disk_use'>allow_disk_use</span>(<span class='kw'>true</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The flag value.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>, <a href="../Aggregation.html" title="Mongo::Collection::View::Aggregation (class)">Aggregation</a>)</span>
&mdash;    <div class='inline'>
<p>The aggregation if a value was set or the value if used as a getter.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L38-L40'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='38' data-end='40'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 38</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_allow_disk_use'>allow_disk_use</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_configure'>configure</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_allow_disk_use'>allow_disk_use</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_options-instance_method">
  <h3 class='signature priv'>
    #<strong>cache_options</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Skip, sort, limit, projection are specified as pipeline stages rather than as options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L101-L112'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='101' data-end='112'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 101</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_options'>cache_options</span>
  {
    <span class='label'>namespace:</span> <span class='id identifier rubyid_collection'><a href="../../View.html#collection-instance_method" title="Mongo::Collection::View#collection (method)">collection</a></span>.<span class='id identifier rubyid_namespace'>namespace</span><span class='comma'>,</span>
    <span class='label'>selector:</span> <span class='id identifier rubyid_pipeline'><a href="../Aggregation.html#pipeline-instance_method" title="Mongo::Collection::View::Aggregation#pipeline (method)">pipeline</a></span><span class='comma'>,</span>
    <span class='label'>read_concern:</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span>.<span class='id identifier rubyid_read_concern'>read_concern</span><span class='comma'>,</span>
    <span class='label'>read_preference:</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span>.<span class='id identifier rubyid_read_preference'>read_preference</span><span class='comma'>,</span>
    <span class='label'>collation:</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_collation'>collation</span>]<span class='comma'>,</span>
    <span class='comment'># Aggregations can read documents from more than one collection,
</span>    <span class='comment'># so they will be cleared on every write operation.
</span>    <span class='label'>multi_collection:</span> <span class='kw'>true</span><span class='comma'>,</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="explain-instance_method">
  <h3 class='signature '>
    #<strong>explain</strong>  &#x21d2; <code>Hash</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the explain plan for the aggregation.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the explain plan for the aggregation.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_aggregation'>aggregation</span>.<span class='id identifier rubyid_explain'>explain</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>The explain plan.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L50-L52'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='52'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_explain'>explain</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_new'><a href="../Aggregation.html#new-class_method" title="Mongo::Collection::View::Aggregation.new (method)">new</a></span>(<span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span><span class='comma'>,</span> <span class='id identifier rubyid_pipeline'><a href="../Aggregation.html#pipeline-instance_method" title="Mongo::Collection::View::Aggregation#pipeline (method)">pipeline</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>explain:</span> <span class='kw'>true</span>)).<span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="operation_timeouts-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>operation_timeouts</strong>(opts = {})  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>timeout_ms value set on the operation level (if any), and/or timeout_ms that is set on collection/database/client level (if any).</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L118-L126'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='118' data-end='126'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_operation_timeouts'>operation_timeouts</span>(<span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  {}.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#timeout_ms (method)">timeout_ms</a></span>] <span class='op'>||</span> <span class='ivar'>@timeout_ms</span>
      <span class='id identifier rubyid_result'>result</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_operation_timeout_ms'><a href="../../View.html#operation_timeout_ms-instance_method" title="Mongo::Collection::View#operation_timeout_ms (method)">operation_timeout_ms</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#timeout_ms (method)">timeout_ms</a></span>) <span class='op'>||</span> <span class='ivar'>@timeout_ms</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_inherited_timeout_ms'>inherited_timeout_ms</span>] <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span>.<span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#timeout_ms (method)">timeout_ms</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="perform_setup-instance_method">
  <h3 class='signature priv'>
    #<strong>perform_setup</strong>(view, options, forbid: [])   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Common setup for all classes that include this behavior; the constructor should invoke this method.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L76-L85'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='76' data-end='85'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 76</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_setup'>perform_setup</span>(<span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='label'>forbid:</span> [])
  <span class='ivar'>@view</span> <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span>

  <span class='ivar'>@timeout_ms</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#timeout_ms (method)">timeout_ms</a></span>)
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>Document</span>.<span class='id identifier rubyid_new'><a href="../Aggregation.html#new-class_method" title="Mongo::Collection::View::Aggregation.new (method)">new</a></span>(<span class='id identifier rubyid_options'>options</span>).<span class='id identifier rubyid_freeze'>freeze</span>

  <span class='kw'>yield</span>

  <span class='id identifier rubyid_validate_timeout_mode!'>validate_timeout_mode!</span>(<span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='label'>forbid:</span> <span class='id identifier rubyid_forbid'>forbid</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="server_selector-instance_method">
  <h3 class='signature priv'>
    #<strong>server_selector</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L87-L89'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='87' data-end='89'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 87</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_server_selector'>server_selector</span>
  <span class='ivar'>@view</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_server_selector'>server_selector</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="timeout_ms-instance_method">
  <h3 class='signature nodoc'>
    #<strong>timeout_ms</strong>  &#x21d2; <code>Integer</code> | <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the timeout_ms value that was passed as an option to this object, or which was inherited from the view.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/collection/view/aggregation/behavior.rb#L68-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='68' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/collection/view/aggregation/behavior.rb', line 68</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_timeout_ms'>timeout_ms</span>
  <span class='ivar'>@timeout_ms</span> <span class='op'>||</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Collection::View::Aggregation::Behavior#view (method)">view</a></span>.<span class='id identifier rubyid_timeout_ms'>timeout_ms</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>