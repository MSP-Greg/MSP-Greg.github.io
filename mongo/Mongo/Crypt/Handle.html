<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Crypt::Handle &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Crypt::Handle",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongo master</a> &raquo; 
      <a href='../../_index.html#alpha_H'>Index (H)</a> &raquo; 
        <a href="../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../Crypt.html" title="Mongo::Crypt (module)">Crypt</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Handle&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Crypt::Handle  <span class='private note title'>Private</span>
</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L29'>lib/mongo/crypt/handle.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>A handle to the libmongocrypt library that wraps a mongocrypt_t object, allowing clients to set options on that object or perform operations such as encryption and decryption</p>

  </div>
</div>
<div class='tags'>
  
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(kms_providers, kms_tls_options, options = {})  &#x21d2; Handle </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new <code>Handle</code> object and initializes it with options.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#crypt_shared_lib_available%3F-instance_method" title="#crypt_shared_lib_available? (instance method)">#<strong>crypt_shared_lib_available?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#kms_providers-instance_method" title="#kms_providers (instance method)">#<strong>kms_providers</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#crypt_shared_lib_version-instance_method" title="#crypt_shared_lib_version (instance method)">#<strong>crypt_shared_lib_version</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#kms_tls_options-instance_method" title="#kms_tls_options (instance method)">#<strong>kms_tls_options</strong>(provider)  &#x21d2; Hash </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Return TLS options for <a href="KMS.html" title="Mongo::Crypt::KMS (module)"><code>KMS</code></a> provider.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#ref-instance_method" title="#ref (instance method)">#<strong>ref</strong>  &#x21d2; FFI::Pointer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the reference to the underlying @mongocrypt object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#do_aes-instance_method" title="#do_aes (instance method)">#<strong>do_aes</strong>(key_binary_p, iv_binary_p, input_binary_p, output_binary_p, response_length_p, status_p, decrypt: false, mode: :CBC)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Perform AES encryption or decryption and write the output to the provided mongocrypt_binary_t object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#do_hmac_sha-instance_method" title="#do_hmac_sha (instance method)">#<strong>do_hmac_sha</strong>(digest_name, key_binary_p, input_binary_p, output_binary_p, status_p)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Perform HMAC SHA encryption and write the output to the provided mongocrypt_binary_t object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#do_rsaes_pkcs_signature-instance_method" title="#do_rsaes_pkcs_signature (instance method)">#<strong>do_rsaes_pkcs_signature</strong>(key_binary_p, input_binary_p, output_binary_p, status_p)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Perform signing using RSASSA-PKCS1-v1_5 with SHA256 hash and write the output to the provided mongocrypt_binary_t object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#handle_error-instance_method" title="#handle_error (instance method)">#<strong>handle_error</strong>(status_p)  &#x21d2; true | false </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Yields to the provided block and rescues exceptions raised by the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#initialize_mongocrypt-instance_method" title="#initialize_mongocrypt (instance method)">#<strong>initialize_mongocrypt</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Initialize the underlying mongocrypt_t object and raise an error if the operation fails.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#maybe_set_schema_map-instance_method" title="#maybe_set_schema_map (instance method)">#<strong>maybe_set_schema_map</strong>(options)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Set the schema map option on the underlying mongocrypt_t object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#set_bypass_query_analysis-instance_method" title="#set_bypass_query_analysis (instance method)">#<strong>set_bypass_query_analysis</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#set_crypto_hooks-instance_method" title="#set_crypto_hooks (instance method)">#<strong>set_crypto_hooks</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>We are building libmongocrypt without crypto functions to remove the external dependency on OpenSSL.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#set_encrypted_fields_map-instance_method" title="#set_encrypted_fields_map (instance method)">#<strong>set_encrypted_fields_map</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#set_logger_callback-instance_method" title="#set_logger_callback (instance method)">#<strong>set_logger_callback</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Send the logs from libmongocrypt to the <a href="../Logger.html" title="Mongo::Logger (class)"><code>::Mongo::Logger</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#write_binary_string_and_set_status-instance_method" title="#write_binary_string_and_set_status (instance method)">#<strong>write_binary_string_and_set_status</strong>(output_binary_p, status_p)  &#x21d2; true | false </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Yields to the provided block and writes the return value of block to the specified mongocrypt_binary_t object.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="crypt_shared_lib_available?-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>crypt_shared_lib_available?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L136-L138'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='136' data-end='138'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 136</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_crypt_shared_lib_available?'>crypt_shared_lib_available?</span>
  <span class='id identifier rubyid_crypt_shared_lib_version'><a href="#crypt_shared_lib_version-instance_method" title="Mongo::Crypt::Handle#crypt_shared_lib_version (method)">crypt_shared_lib_version</a></span> <span class='op'>!=</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kms_providers-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>kms_providers</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L32-L32'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='32' data-end='32'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 32</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_kms_providers'>kms_providers</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="crypt_shared_lib_version-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>crypt_shared_lib_version</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L132-L134'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='132' data-end='134'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_crypt_shared_lib_version'>crypt_shared_lib_version</span>
  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_crypt_shared_lib_version'><a href="Binding.html#crypt_shared_lib_version-class_method" title="Mongo::Crypt::Binding.crypt_shared_lib_version (method)">crypt_shared_lib_version</a></span>(<span class='kw'>self</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_aes-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>do_aes</strong>(key_binary_p, iv_binary_p, input_binary_p, output_binary_p, response_length_p, status_p, decrypt: false, mode: :CBC)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Perform AES encryption or decryption and write the output to the provided mongocrypt_binary_t object.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L244-L256'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='244' data-end='256'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_do_aes'>do_aes</span>(<span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span>
  <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='comma'>,</span> <span class='label'>decrypt:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>mode:</span> <span class='symbeg'>:</span><span class='const'>CBC</span>)
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_key_binary_p'>key_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>
  <span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>
  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_input_binary_p'>input_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>

  <span class='id identifier rubyid_write_binary_string_and_set_status'><a href="#write_binary_string_and_set_status-instance_method" title="Mongo::Crypt::Handle#write_binary_string_and_set_status (method)">write_binary_string_and_set_status</a></span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='const'><a href="Hooks.html" title="Mongo::Crypt::Hooks (module)">Hooks</a></span>.<span class='id identifier rubyid_aes'><a href="Hooks.html#aes-class_method" title="Mongo::Crypt::Hooks.aes (method)">aes</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span><span class='comma'>,</span> <span class='label'>decrypt:</span> <span class='id identifier rubyid_decrypt'>decrypt</span><span class='comma'>,</span> <span class='label'>mode:</span> <span class='id identifier rubyid_mode'>mode</span>)
    <span class='id identifier rubyid_response_length_p'>response_length_p</span>.<span class='id identifier rubyid_write_int'>write_int</span>(<span class='id identifier rubyid_output'>output</span>.<span class='id identifier rubyid_bytesize'>bytesize</span>)

    <span class='id identifier rubyid_output'>output</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_hmac_sha-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>do_hmac_sha</strong>(digest_name, key_binary_p, input_binary_p, output_binary_p, status_p)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Perform HMAC SHA encryption and write the output to the provided mongocrypt_binary_t object.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L260-L268'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='260' data-end='268'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_do_hmac_sha'>do_hmac_sha</span>(<span class='id identifier rubyid_digest_name'>digest_name</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
  <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_key_binary_p'>key_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>
  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_input_binary_p'>input_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>

  <span class='id identifier rubyid_write_binary_string_and_set_status'><a href="#write_binary_string_and_set_status-instance_method" title="Mongo::Crypt::Handle#write_binary_string_and_set_status (method)">write_binary_string_and_set_status</a></span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>) <span class='kw'>do</span>
    <span class='const'><a href="Hooks.html" title="Mongo::Crypt::Hooks (module)">Hooks</a></span>.<span class='id identifier rubyid_hmac_sha'><a href="Hooks.html#hmac_sha-class_method" title="Mongo::Crypt::Hooks.hmac_sha (method)">hmac_sha</a></span>(<span class='id identifier rubyid_digest_name'>digest_name</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_rsaes_pkcs_signature-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>do_rsaes_pkcs_signature</strong>(key_binary_p, input_binary_p, output_binary_p, status_p)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Perform signing using RSASSA-PKCS1-v1_5 with SHA256 hash and write the output to the provided mongocrypt_binary_t object.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L272-L280'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='272' data-end='280'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 272</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_do_rsaes_pkcs_signature'>do_rsaes_pkcs_signature</span>(<span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
  <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_key_binary_p'>key_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>
  <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_input_binary_p'>input_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>

  <span class='id identifier rubyid_write_binary_string_and_set_status'><a href="#write_binary_string_and_set_status-instance_method" title="Mongo::Crypt::Handle#write_binary_string_and_set_status (method)">write_binary_string_and_set_status</a></span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>) <span class='kw'>do</span>
    <span class='const'><a href="Hooks.html" title="Mongo::Crypt::Hooks (module)">Hooks</a></span>.<span class='id identifier rubyid_rsaes_pkcs_signature'><a href="Hooks.html#rsaes_pkcs_signature-class_method" title="Mongo::Crypt::Hooks.rsaes_pkcs_signature (method)">rsaes_pkcs_signature</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_error-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>handle_error</strong>(status_p)  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Yields to the provided block and rescues exceptions raised by the block. If an exception was raised, sets the specified status to the exception message and returns false. If no exceptions were raised, does not modify the status and returns true.</p>

<p>This method is meant to be used with libmongocrypt callbacks and follows the API defined by libmongocrypt.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>status_p</span>
    <span class='type'>(<code>FFI::Pointer</code>)</span>
&mdash;    <div class='inline'>
<p>A pointer to libmongocrypt status object</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether block executed without raising exceptions.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L209-L219'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='209' data-end='219'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 209</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_error'>handle_error</span>(<span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='kw'>begin</span>
    <span class='kw'>yield</span>

    <span class='kw'>true</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'><a href="Status.html" title="Mongo::Crypt::Status (class)">Status</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Status.html#from_pointer-class_method" title="Mongo::Crypt::Status.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_status_p'>status_p</span>)
    <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_update'>update</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_error_client'>error_client</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="initialize_mongocrypt-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>initialize_mongocrypt</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initialize the underlying mongocrypt_t object and raise an error if the operation fails</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L394-L397'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='394' data-end='397'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 394</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_mongocrypt'>initialize_mongocrypt</span>
  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_init'><a href="Binding.html#init-class_method" title="Mongo::Crypt::Binding.init (method)">init</a></span>(<span class='kw'>self</span>)
  <span class='comment'># There is currently no test for the error(?) code path
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kms_tls_options-instance_method">
  <h3 class='signature nodoc'>
    #<strong>kms_tls_options</strong>(provider)  &#x21d2; <code>Hash</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return TLS options for <a href="KMS.html" title="Mongo::Crypt::KMS (module)"><code>KMS</code></a> provider. If there are no TLS options set, empty hash is returned.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>provider</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>KSM provider name.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>TLS options to connect to <a href="KMS.html" title="Mongo::Crypt::KMS (module)"><code>KMS</code></a> provider.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L128-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='128' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 128</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_kms_tls_options'>kms_tls_options</span>(<span class='id identifier rubyid_provider'>provider</span>)
  <span class='ivar'>@kms_tls_options</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span> {})
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="maybe_set_schema_map-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>maybe_set_schema_map</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Set the schema map option on the underlying mongocrypt_t object</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L143-L166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='143' data-end='166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 143</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_maybe_set_schema_map'>maybe_set_schema_map</span>(<span class='id identifier rubyid_options'>options</span>)
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map'>schema_map</span>] <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map_path'>schema_map_path</span>]
    <span class='ivar'>@schema_map</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map'>schema_map</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map_path'>schema_map_path</span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span>(
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot set both schema_map and schema_map_path options.</span><span class='tstring_end'>&quot;</span></span>
    )
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map'>schema_map</span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map'>schema_map</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span>(
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@schema_map</span><span class='embexpr_end'>}</span><span class='tstring_content'> is an invalid schema_map; schema_map must be a Hash or nil.</span><span class='tstring_end'>&quot;</span></span>
      )
    <span class='kw'>end</span>
    <span class='ivar'>@schema_map</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map'>schema_map</span>]
    <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_schema_map'><a href="Binding.html#setopt_schema_map-class_method" title="Mongo::Crypt::Binding.setopt_schema_map (method)">setopt_schema_map</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@schema_map</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map_path'>schema_map_path</span>]
    <span class='ivar'>@schema_map</span> <span class='op'>=</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>ExtJSON</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_schema_map_path'>schema_map_path</span>]))
    <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_schema_map'><a href="Binding.html#setopt_schema_map-class_method" title="Mongo::Crypt::Binding.setopt_schema_map (method)">setopt_schema_map</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@schema_map</span>)
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span>(
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@schema_map_path</span><span class='embexpr_end'>}</span><span class='tstring_content'> is an invalid path to a file contains schema_map.</span><span class='tstring_end'>&quot;</span></span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ref-instance_method">
  <h3 class='signature nodoc'>
    #<strong>ref</strong>  &#x21d2; <code>FFI::Pointer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the reference to the underlying @mongocrypt object</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L118-L120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='118' data-end='120'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ref'>ref</span>
  <span class='ivar'>@mongocrypt</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_bypass_query_analysis-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>set_bypass_query_analysis</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L178-L186'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='178' data-end='186'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 178</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_bypass_query_analysis'>set_bypass_query_analysis</span>
  <span class='kw'>unless</span> [<span class='kw'>true</span><span class='comma'>,</span> <span class='kw'>false</span>].<span class='id identifier rubyid_include?'>include?</span>(<span class='ivar'>@bypass_query_analysis</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span>(
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@bypass_query_analysis</span><span class='embexpr_end'>}</span><span class='tstring_content'> is an invalid bypass_query_analysis value; must be a Boolean or nil</span><span class='tstring_end'>&quot;</span></span>
    )
  <span class='kw'>end</span>

  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_bypass_query_analysis'><a href="Binding.html#setopt_bypass_query_analysis-class_method" title="Mongo::Crypt::Binding.setopt_bypass_query_analysis (method)">setopt_bypass_query_analysis</a></span>(<span class='kw'>self</span>) <span class='kw'>if</span> <span class='ivar'>@bypass_query_analysis</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_crypto_hooks-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>set_crypto_hooks</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>We are building libmongocrypt without crypto functions to remove the external dependency on OpenSSL. This method binds native Ruby crypto methods to the underlying mongocrypt_t object so that libmongocrypt can still perform cryptography.</p>

<p>Every crypto binding ignores its first argument, which is an option mongocrypt_ctx_t object and is not required to use crypto hooks.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L289-L391'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='289' data-end='391'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 289</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_crypto_hooks'>set_crypto_hooks</span>
  <span class='ivar'>@aes_encrypt</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_aes'><a href="#do_aes-instance_method" title="Mongo::Crypt::Handle#do_aes (method)">do_aes</a></span>(
      <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_status_p'>status_p</span>
    )
  <span class='kw'>end</span>

  <span class='ivar'>@aes_decrypt</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_aes'><a href="#do_aes-instance_method" title="Mongo::Crypt::Handle#do_aes (method)">do_aes</a></span>(
      <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_status_p'>status_p</span><span class='comma'>,</span>
      <span class='label'>decrypt:</span> <span class='kw'>true</span>
    )
  <span class='kw'>end</span>

  <span class='ivar'>@random</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_num_bytes'>num_bytes</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_write_binary_string_and_set_status'><a href="#write_binary_string_and_set_status-instance_method" title="Mongo::Crypt::Handle#write_binary_string_and_set_status (method)">write_binary_string_and_set_status</a></span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>) <span class='kw'>do</span>
      <span class='const'><a href="Hooks.html" title="Mongo::Crypt::Hooks (module)">Hooks</a></span>.<span class='id identifier rubyid_random'><a href="Hooks.html#random-class_method" title="Mongo::Crypt::Hooks.random (method)">random</a></span>(<span class='id identifier rubyid_num_bytes'>num_bytes</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@hmac_sha_512</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_hmac_sha'><a href="#do_hmac_sha-instance_method" title="Mongo::Crypt::Handle#do_hmac_sha (method)">do_hmac_sha</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SHA512</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='kw'>end</span>

  <span class='ivar'>@hmac_sha_256</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_hmac_sha'><a href="#do_hmac_sha-instance_method" title="Mongo::Crypt::Handle#do_hmac_sha (method)">do_hmac_sha</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='kw'>end</span>

  <span class='ivar'>@hmac_hash</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_input'>input</span> <span class='op'>=</span> <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_input_binary_p'>input_binary_p</span>).<span class='id identifier rubyid_to_s'><a href="Binary.html#to_s-instance_method" title="Mongo::Crypt::Binary#to_s (method)">to_s</a></span>

    <span class='id identifier rubyid_write_binary_string_and_set_status'><a href="#write_binary_string_and_set_status-instance_method" title="Mongo::Crypt::Handle#write_binary_string_and_set_status (method)">write_binary_string_and_set_status</a></span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>) <span class='kw'>do</span>
      <span class='const'><a href="Hooks.html" title="Mongo::Crypt::Hooks (module)">Hooks</a></span>.<span class='id identifier rubyid_hash_sha256'><a href="Hooks.html#hash_sha256-class_method" title="Mongo::Crypt::Hooks.hash_sha256 (method)">hash_sha256</a></span>(<span class='id identifier rubyid_input'>input</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_crypto_hooks'><a href="Binding.html#setopt_crypto_hooks-class_method" title="Mongo::Crypt::Binding.setopt_crypto_hooks (method)">setopt_crypto_hooks</a></span>(
    <span class='kw'>self</span><span class='comma'>,</span>
    <span class='ivar'>@aes_encrypt</span><span class='comma'>,</span>
    <span class='ivar'>@aes_decrypt</span><span class='comma'>,</span>
    <span class='ivar'>@random</span><span class='comma'>,</span>
    <span class='ivar'>@hmac_sha_512</span><span class='comma'>,</span>
    <span class='ivar'>@hmac_sha_256</span><span class='comma'>,</span>
    <span class='ivar'>@hmac_hash</span><span class='comma'>,</span>
  )

  <span class='ivar'>@aes_ctr_encrypt</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_aes'><a href="#do_aes-instance_method" title="Mongo::Crypt::Handle#do_aes (method)">do_aes</a></span>(
      <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_status_p'>status_p</span><span class='comma'>,</span>
      <span class='label'>mode:</span> <span class='symbeg'>:</span><span class='const'>CTR</span><span class='comma'>,</span>
    )
  <span class='kw'>end</span>

  <span class='ivar'>@aes_ctr_decrypt</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_aes'><a href="#do_aes-instance_method" title="Mongo::Crypt::Handle#do_aes (method)">do_aes</a></span>(
      <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_iv_binary_p'>iv_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_response_length_p'>response_length_p</span><span class='comma'>,</span>
      <span class='id identifier rubyid_status_p'>status_p</span><span class='comma'>,</span>
      <span class='label'>decrypt:</span> <span class='kw'>true</span><span class='comma'>,</span>
      <span class='label'>mode:</span> <span class='symbeg'>:</span><span class='const'>CTR</span><span class='comma'>,</span>
    )
  <span class='kw'>end</span>

  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_aes_256_ctr'><a href="Binding.html#setopt_aes_256_ctr-class_method" title="Mongo::Crypt::Binding.setopt_aes_256_ctr (method)">setopt_aes_256_ctr</a></span>(
    <span class='kw'>self</span><span class='comma'>,</span>
    <span class='ivar'>@aes_ctr_encrypt</span><span class='comma'>,</span>
    <span class='ivar'>@aes_ctr_decrypt</span><span class='comma'>,</span>
  )

  <span class='ivar'>@rsaes_pkcs_signature_cb</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span>
    <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span><span class='op'>|</span>
    <span class='id identifier rubyid_do_rsaes_pkcs_signature'><a href="#do_rsaes_pkcs_signature-instance_method" title="Mongo::Crypt::Handle#do_rsaes_pkcs_signature (method)">do_rsaes_pkcs_signature</a></span>(<span class='id identifier rubyid_key_binary_p'>key_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_input_binary_p'>input_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_crypto_hook_sign_rsaes_pkcs1_v1_5'><a href="Binding.html#setopt_crypto_hook_sign_rsaes_pkcs1_v1_5-class_method" title="Mongo::Crypt::Binding.setopt_crypto_hook_sign_rsaes_pkcs1_v1_5 (method)">setopt_crypto_hook_sign_rsaes_pkcs1_v1_5</a></span>(
    <span class='kw'>self</span><span class='comma'>,</span>
    <span class='ivar'>@rsaes_pkcs_signature_cb</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_encrypted_fields_map-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>set_encrypted_fields_map</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L168-L176'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='168' data-end='176'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 168</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_encrypted_fields_map'>set_encrypted_fields_map</span>
  <span class='kw'>unless</span> <span class='ivar'>@encrypted_fields_map</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span>(
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@encrypted_fields_map</span><span class='embexpr_end'>}</span><span class='tstring_content'> is an invalid encrypted_fields_map: must be a Hash or nil</span><span class='tstring_end'>&quot;</span></span>
    )
  <span class='kw'>end</span>

  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_encrypted_field_config_map'><a href="Binding.html#setopt_encrypted_field_config_map-class_method" title="Mongo::Crypt::Binding.setopt_encrypted_field_config_map (method)">setopt_encrypted_field_config_map</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@encrypted_fields_map</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_logger_callback-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>set_logger_callback</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Send the logs from libmongocrypt to the <a href="../Logger.html" title="Mongo::Logger (class)"><code>::Mongo::Logger</code></a></p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L189-L195'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='189' data-end='195'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 189</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_logger_callback'>set_logger_callback</span>
  <span class='ivar'>@log_callback</span> <span class='op'>=</span> <span class='const'>Proc</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Crypt::Handle.new (method)">new</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
    <span class='ivar'>@logger</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="Binding.html" title="Mongo::Crypt::Binding (class)">Binding</a></span>.<span class='id identifier rubyid_setopt_log_handler'><a href="Binding.html#setopt_log_handler-class_method" title="Mongo::Crypt::Binding.setopt_log_handler (method)">setopt_log_handler</a></span>(<span class='ivar'>@mongocrypt</span><span class='comma'>,</span> <span class='ivar'>@log_callback</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_binary_string_and_set_status-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>write_binary_string_and_set_status</strong>(output_binary_p, status_p)  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Yields to the provided block and writes the return value of block to the specified mongocrypt_binary_t object. If an exception is raised during execution of the block, writes the exception message to the specified status object and returns false. If no exception is raised, does not modify status and returns true. message to the mongocrypt_status_t object.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>output_binary_p</span>
    <span class='type'>(<code>FFI::Pointer</code>)</span>
&mdash;    <div class='inline'>
<p>A pointer to libmongocrypt <a href="Binary.html" title="Mongo::Crypt::Binary (class)"><code>Binary</code></a> object to receive the result of block’s execution</p>
</div>
  </li>
  <li>
    <span class='name'>status_p</span>
    <span class='type'>(<code>FFI::Pointer</code>)</span>
&mdash;    <div class='inline'>
<p>A pointer to libmongocrypt status object</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether block executed without raising exceptions.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/crypt/handle.rb#L234-L240'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='234' data-end='240'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/crypt/handle.rb', line 234</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_binary_string_and_set_status'>write_binary_string_and_set_status</span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span><span class='comma'>,</span> <span class='id identifier rubyid_status_p'>status_p</span>)
  <span class='id identifier rubyid_handle_error'><a href="#handle_error-instance_method" title="Mongo::Crypt::Handle#handle_error (method)">handle_error</a></span>(<span class='id identifier rubyid_status_p'>status_p</span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='kw'>yield</span>

    <span class='const'><a href="Binary.html" title="Mongo::Crypt::Binary (class)">Binary</a></span>.<span class='id identifier rubyid_from_pointer'><a href="Binary.html#from_pointer-class_method" title="Mongo::Crypt::Binary.from_pointer (method)">from_pointer</a></span>(<span class='id identifier rubyid_output_binary_p'>output_binary_p</span>).<span class='id identifier rubyid_write'><a href="Binary.html#write-instance_method" title="Mongo::Crypt::Binary#write (method)">write</a></span>(<span class='id identifier rubyid_output'>output</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>