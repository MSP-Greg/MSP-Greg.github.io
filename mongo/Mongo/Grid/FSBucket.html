<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Grid::FSBucket &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Grid::FSBucket",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongo master</a> &raquo; 
      <a href='../../_index.html#alpha_F'>Index (F)</a> &raquo; 
        <a href="../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../Grid.html" title="Mongo::Grid (module)">Grid</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>FSBucket&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Grid::FSBucket</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="FSBucket/Stream.html" title="Mongo::Grid::FSBucket::Stream (module)"><code>Stream</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L24'>lib/mongo/grid/fs_bucket.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/stream.rb#L23'>lib/mongo/grid/stream.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/stream/read.rb#L20'>lib/mongo/grid/stream/read.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/stream/write.rb#L20'>lib/mongo/grid/stream/write.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Represents a view of the GridFS in the database.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='CHUNKS_INDEX-constant' class='summary_signature'>CHUNKS_INDEX =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The specification for the chunks collection index.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L35-L35'># File 'lib/mongo/grid/fs_bucket.rb', line 35</a>    <pre class='code ruby'>{ <span class='symbeg'>:</span><span class='id identifier rubyid_files_id'>files_id</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_n'>n</span> <span class='op'>=&gt;</span> <span class='int'>1</span> }.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='DEFAULT_ROOT-constant' class='summary_signature'>DEFAULT_ROOT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default root prefix.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L30-L30'># File 'lib/mongo/grid/fs_bucket.rb', line 30</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fs</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='FILES_INDEX-constant' class='summary_signature'>FILES_INDEX =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The specification for the files collection index.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L40-L40'># File 'lib/mongo/grid/fs_bucket.rb', line 40</a>    <pre class='code ruby'>{ <span class='label'>filename:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>uploadDate:</span> <span class='int'>1</span> }.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(database, options = {})  &#x21d2; FSBucket </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create the GridFS.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#chunks_collection-instance_method" title="#chunks_collection (instance method)">#<strong>chunks_collection</strong>  &#x21d2; Collection </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#database-instance_method" title="#database (instance method)">#<strong>database</strong>  &#x21d2; Database </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#files_collection-instance_method" title="#files_collection (instance method)">#<strong>files_collection</strong>  &#x21d2; Collection </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(id)  &#x21d2; Result </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove a single file, identified by its id from the GridFS.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete_one-instance_method" title="#delete_one (instance method)">#<strong>delete_one</strong>(file)  &#x21d2; Result </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove a single file from the GridFS.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#download_to_stream-instance_method" title="#download_to_stream (instance method)">#<strong>download_to_stream</strong>(id, io)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Downloads the contents of the file specified by id and writes them to the destination io object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#download_to_stream_by_name-instance_method" title="#download_to_stream_by_name (instance method)">#<strong>download_to_stream_by_name</strong>(filename, io, opts = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Downloads the contents of the stored file specified by filename and by the revision in options and writes the contents to the destination io object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#drop-instance_method" title="#drop (instance method)">#<strong>drop</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Drop the collections that implement this bucket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find-instance_method" title="#find (instance method)">#<strong>find</strong>(selector = nil, options = {})  &#x21d2; CollectionView </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Find files collection documents matching a given selector.</p></div>
    </div>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#find_one-instance_method" title="#find_one (instance method)">#<strong>find_one</strong>(selector = nil)  &#x21d2; Grid::File </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'>
<p>Please use #find instead with a limit of -1. Will be removed in version 3.0.</p>
</div>    </span>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#insert_one-instance_method" title="#insert_one (instance method)">#<strong>insert_one</strong>(file)  &#x21d2; BSON::ObjectId </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'>
<p>Please use #upload_from_stream or #open_upload_stream instead. Will be removed in version 3.0.</p>
</div>    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#open_download_stream-instance_method" title="#open_download_stream (instance method)">#<strong>open_download_stream</strong>(id, options = nil) {|The| ... } &#x21d2; Stream::Read </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Opens a stream from which a file can be downloaded, specified by id.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#open_download_stream_by_name-instance_method" title="#open_download_stream_by_name (instance method)">#<strong>open_download_stream_by_name</strong>(filename, opts = {}) {|The| ... } &#x21d2; Stream::Read </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Opens a stream from which the application can read the contents of the stored file specified by filename and the revision in options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#open_upload_stream-instance_method" title="#open_upload_stream (instance method)">#<strong>open_upload_stream</strong>(filename, opts = {}) {|The| ... } &#x21d2; Stream::Write </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Opens an upload stream to GridFS to which the contents of a file or blob can be written.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#prefix-instance_method" title="#prefix (instance method)">#<strong>prefix</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the prefix for the GridFS.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#read_preference-instance_method" title="#read_preference (instance method)">#<strong>read_preference</strong>  &#x21d2; BSON::Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the read preference.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#upload_from_stream-instance_method" title="#upload_from_stream (instance method)">#<strong>upload_from_stream</strong>(filename, io, opts = {})  &#x21d2; BSON::ObjectId </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Uploads a user file to a GridFS bucket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#write_concern-instance_method" title="#write_concern (instance method)">#<strong>write_concern</strong>  &#x21d2; Mongo::WriteConcern </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the write concern.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#chunks_name-instance_method" title="#chunks_name (instance method)">#<strong>chunks_name</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#create_index_if_missing!-instance_method" title="#create_index_if_missing! (instance method)">#<strong>create_index_if_missing!</strong>(collection, index_spec, options = {})  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ensure_indexes!-instance_method" title="#ensure_indexes! (instance method)">#<strong>ensure_indexes!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#files_name-instance_method" title="#files_name (instance method)">#<strong>files_name</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#read_stream-instance_method" title="#read_stream (instance method)">#<strong>read_stream</strong>(id, **opts)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#write_stream-instance_method" title="#write_stream (instance method)">#<strong>write_stream</strong>(filename, **opts)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(database, options = {})  &#x21d2; <code>FSBucket</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create the GridFS.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create the GridFS.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'><a href="../Grid.html" title="Mongo::Grid (module)">Grid</a></span><span class='op'>::</span><span class='const'>FSBucket</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>database</span>
    <span class='type'>(<a href="../Database.html" title="Mongo::Database (class)">Database</a>)</span>
&mdash;    <div class='inline'>
<p>The database the files reside in.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The GridFS options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:bucket_name</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The prefix for the files and chunks collections.</p>
</div>        </li>
        <li>
          <span class='name'>:chunk_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>Override the default chunk size.</p>
</div>        </li>
        <li>
          <span class='name'>:fs_name</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The prefix for the files and chunks collections.</p>
</div>        </li>
        <li>
          <span class='name'>:read</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The read preference options. The hash may have the following items:</p>
<ul><li>
<p><strong>:mode</strong> – read preference specified as a symbol; valid values are <strong>:primary</strong>, <strong>:primary_preferred</strong>, <strong>:secondary</strong>, <strong>:secondary_preferred</strong> and <strong>:nearest</strong>.</p>
</li><li>
<p><strong>:tag_sets</strong> – an array of hashes.</p>
</li><li>
<p><strong>:local_threshold</strong>.</p>
</li></ul>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="../Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>        </li>
        <li>
          <span class='name'>:write</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>Deprecated. Equivalent to <code>:write_concern</code> option.</p>
</div>        </li>
        <li>
          <span class='name'>:write_concern</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The write concern options. Can be <code>:w</code> =&gt; Integer|String, <code>:fsync</code> =&gt; Boolean, <code>:j</code> =&gt; Boolean.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L70-L83'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='83'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='ivar'>@database</span> <span class='op'>=</span> <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span>
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>.<span class='id identifier rubyid_dup'>dup</span>
<span class='embdoc_beg'>=begin WriteConcern object support
</span><span class='embdoc'>  if @options[:write_concern].is_a?(WriteConcern::Base)
</span><span class='embdoc'>    # Cache the instance so that we do not needlessly reconstruct it.
</span><span class='embdoc'>    @write_concern = @options[:write_concern]
</span><span class='embdoc'>    @options[:write_concern] = @write_concern.options
</span><span class='embdoc'>  end
</span><span class='embdoc_end'>=end
</span>  <span class='ivar'>@options</span>.<span class='id identifier rubyid_freeze'>freeze</span>
  <span class='ivar'>@chunks_collection</span> <span class='op'>=</span> <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span>[<span class='id identifier rubyid_chunks_name'><a href="#chunks_name-instance_method" title="Mongo::Grid::FSBucket#chunks_name (method)">chunks_name</a></span>]
  <span class='ivar'>@files_collection</span> <span class='op'>=</span> <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span>[<span class='id identifier rubyid_files_name'><a href="#files_name-instance_method" title="Mongo::Grid::FSBucket#files_name (method)">files_name</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="chunks_collection-instance_method">
  <h3 class='signature ro first'>
    #<strong>chunks_collection</strong>  &#x21d2; <a href="../Collection.html" title="Mongo::Collection (class)">Collection</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Collection.html" title="Mongo::Collection (class)">Collection</a>)</span>
&mdash;    <div class='inline'>
<p>chunks_collection The chunks collection.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L88-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='88' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 88</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_chunks_collection'>chunks_collection</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="database-instance_method">
  <h3 class='signature ro'>
    #<strong>database</strong>  &#x21d2; <a href="../Database.html" title="Mongo::Database (class)">Database</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Database.html" title="Mongo::Database (class)">Database</a>)</span>
&mdash;    <div class='inline'>
<p>database The database.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L93-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='93' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 93</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_database'>database</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="files_collection-instance_method">
  <h3 class='signature ro'>
    #<strong>files_collection</strong>  &#x21d2; <a href="../Collection.html" title="Mongo::Collection (class)">Collection</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Collection.html" title="Mongo::Collection (class)">Collection</a>)</span>
&mdash;    <div class='inline'>
<p>files_collection The files collection.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L98-L98'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='98' data-end='98'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 98</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_files_collection'>files_collection</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="options-instance_method">
  <h3 class='signature ro'>
    #<strong>options</strong>  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>options The FSBucket options.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L103-L103'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='103' data-end='103'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 103</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_options'>options</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="chunks_name-instance_method">
  <h3 class='signature priv first'>
    #<strong>chunks_name</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L507-L509'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='507' data-end='509'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 507</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_chunks_name'>chunks_name</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prefix'><a href="#prefix-instance_method" title="Mongo::Grid::FSBucket#prefix (method)">prefix</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='const'><a href="../Grid.html" title="Mongo::Grid (module)">Grid</a></span><span class='op'>::</span><span class='const'><a href="File.html" title="Mongo::Grid::File (class)">File</a></span><span class='op'>::</span><span class='const'><a href="File/Chunk.html" title="Mongo::Grid::File::Chunk (class)">Chunk</a></span><span class='op'>::</span><span class='const'><a href="File/Chunk.html#COLLECTION-constant" title="Mongo::Grid::File::Chunk::COLLECTION (constant)">COLLECTION</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_index_if_missing!-instance_method">
  <h3 class='signature priv'>
    #<strong>create_index_if_missing!</strong>(collection, index_spec, options = {})   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L525-L539'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='525' data-end='539'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 525</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_index_if_missing!'>create_index_if_missing!</span>(<span class='id identifier rubyid_collection'>collection</span><span class='comma'>,</span> <span class='id identifier rubyid_index_spec'>index_spec</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_indexes_view'>indexes_view</span> <span class='op'>=</span> <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_indexes'>indexes</span>
  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_indexes_view'>indexes_view</span>.<span class='id identifier rubyid_get'>get</span>(<span class='id identifier rubyid_index_spec'>index_spec</span>).<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_indexes_view'>indexes_view</span>.<span class='id identifier rubyid_create_one'>create_one</span>(<span class='id identifier rubyid_index_spec'>index_spec</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>)
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/OperationFailure.html" title="Mongo::Error::OperationFailure (class)">OperationFailure</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='comment'># proceed with index creation if a NamespaceNotFound error is thrown
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>26</span>
      <span class='id identifier rubyid_indexes_view'>indexes_view</span>.<span class='id identifier rubyid_create_one'>create_one</span>(<span class='id identifier rubyid_index_spec'>index_spec</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>(id)  &#x21d2; <code>Result</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove a single file, identified by its id from the GridFS.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Remove a file from the GridFS.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_id'>id</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>id</span>
    <span class='type'>(<code>BSON::ObjectId</code>, <code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The id of the file to remove.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Result</code>)</span>
&mdash;    <div class='inline'>
<p>The result of the remove.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Error/FileNotFound.html" title="Mongo::Error::FileNotFound (class)">Error::FileNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>If the file is not found.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L220-L225'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='220' data-end='225'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 220</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_id'>id</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>({ <span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span> }<span class='comma'>,</span> <span class='ivar'>@options</span>).<span class='id identifier rubyid_delete_one'><a href="#delete_one-instance_method" title="Mongo::Grid::FSBucket#delete_one (method)">delete_one</a></span>
  <span class='id identifier rubyid_chunks_collection'><a href="#chunks_collection-instance_method" title="Mongo::Grid::FSBucket#chunks_collection (method)">chunks_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>({ <span class='symbeg'>:</span><span class='id identifier rubyid_files_id'>files_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span> }<span class='comma'>,</span> <span class='ivar'>@options</span>).<span class='id identifier rubyid_delete_many'>delete_many</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/FileNotFound.html" title="Mongo::Error::FileNotFound (class)">FileNotFound</a></span>.<span class='id identifier rubyid_new'><a href="../Error/FileNotFound.html#new-class_method" title="Mongo::Error::FileNotFound.new (method)">new</a></span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>) <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_one-instance_method">
  <h3 class='signature '>
    #<strong>delete_one</strong>(file)  &#x21d2; <code>Result</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove a single file from the GridFS.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Remove a file from the GridFS.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_delete_one'>delete_one</span>(<span class='id identifier rubyid_file'>file</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>file</span>
    <span class='type'>(<a href="File.html" title="Mongo::Grid::File (class)">Grid::File</a>)</span>
&mdash;    <div class='inline'>
<p>The file to remove.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Result</code>)</span>
&mdash;    <div class='inline'>
<p>The result of the remove.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L204-L206'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='204' data-end='206'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 204</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_one'>delete_one</span>(<span class='id identifier rubyid_file'>file</span>)
  <span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="Mongo::Grid::FSBucket#delete (method)">delete</a></span>(<span class='id identifier rubyid_file'>file</span>.<span class='id identifier rubyid_id'>id</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="download_to_stream-instance_method">
  <h3 class='signature '>
    #<strong>download_to_stream</strong>(id, io)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Downloads the contents of the file specified by id and writes them to the destination io object.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Download the file and write it to the io object.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_download_to_stream'>download_to_stream</span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>id</span>
    <span class='type'>(<code>BSON::ObjectId</code>, <code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The id of the file to read.</p>
</div>
  </li>
  <li>
    <span class='name'>io</span>
    <span class='type'>(<code>IO</code>)</span>
&mdash;    <div class='inline'>
<p>The io object to write to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L266-L272'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='266' data-end='272'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 266</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_download_to_stream'>download_to_stream</span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span>)
  <span class='id identifier rubyid_open_download_stream'><a href="#open_download_stream-instance_method" title="Mongo::Grid::FSBucket#open_download_stream (method)">open_download_stream</a></span>(<span class='id identifier rubyid_id'>id</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stream'>stream</span><span class='op'>|</span>
    <span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_chunk'>chunk</span><span class='op'>|</span>
      <span class='id identifier rubyid_io'>io</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_chunk'>chunk</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="download_to_stream_by_name-instance_method">
  <h3 class='signature '>
    #<strong>download_to_stream_by_name</strong>(filename, io, opts = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Downloads the contents of the stored file specified by filename and by the revision in options and writes the contents to the destination io object.</p>

<p>Revision numbers are defined as follows: 0 = the original stored file 1 = the first revision 2 = the second revision etc…-2 = the second most recent revision -1 = the most recent revision</p>

<h4 id="label-40example+Download+the+original+file.">@example Download the original file.</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_download_to_stream_by_name'>download_to_stream_by_name</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-file.txt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='label'>revision:</span> <span class='int'>0</span>)</code></pre>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Download the most recent revision.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_download_to_stream_by_name'>download_to_stream_by_name</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-file.txt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span>)</code></pre>
        <p class='example_title'><div class='inline'>
<p>Download the second revision of the stored file.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_download_to_stream_by_name'>download_to_stream_by_name</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-file.txt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='label'>revision:</span> <span class='int'>2</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filename</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The file’s name.</p>
</div>
  </li>
  <li>
    <span class='name'>io</span>
    <span class='type'>(<code>IO</code>)</span>
&mdash;    <div class='inline'>
<p>The io object to write to.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p><a href="../Options.html" title="Mongo::Options (module)"><code>::Mongo::Options</code></a> for the download.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:revision</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The revision number of the file to download. Defaults to -1, the most recent version.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Error/FileNotFound.html" title="Mongo::Error::FileNotFound (class)">Error::FileNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>If the file is not found.</p>
</div>
  </li>
  <li>
    <span class='type'>(<a href="../Error/InvalidFileRevision.html" title="Mongo::Error::InvalidFileRevision (class)">Error::InvalidFileRevision</a>)</span>
&mdash;    <div class='inline'>
<p>If the requested revision is not found for the file.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L359-L361'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='359' data-end='361'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 359</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_download_to_stream_by_name'>download_to_stream_by_name</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_download_to_stream'><a href="#download_to_stream-instance_method" title="Mongo::Grid::FSBucket#download_to_stream (method)">download_to_stream</a></span>(<span class='id identifier rubyid_open_download_stream_by_name'><a href="#open_download_stream_by_name-instance_method" title="Mongo::Grid::FSBucket#open_download_stream_by_name (method)">open_download_stream_by_name</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>).<span class='id identifier rubyid_file_id'>file_id</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="drop-instance_method">
  <h3 class='signature '>
    #<strong>drop</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Drop the collections that implement this bucket.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L488-L491'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='488' data-end='491'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 488</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_drop'>drop</span>
  <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_drop'>drop</span>
  <span class='id identifier rubyid_chunks_collection'><a href="#chunks_collection-instance_method" title="Mongo::Grid::FSBucket#chunks_collection (method)">chunks_collection</a></span>.<span class='id identifier rubyid_drop'>drop</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ensure_indexes!-instance_method">
  <h3 class='signature priv'>
    #<strong>ensure_indexes!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L515-L523'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='515' data-end='523'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 515</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ensure_indexes!'>ensure_indexes!</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>({}<span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>projection:</span> { <span class='label'>_id:</span> <span class='int'>1</span> }).<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_create_index_if_missing!'><a href="#create_index_if_missing!-instance_method" title="Mongo::Grid::FSBucket#create_index_if_missing! (method)">create_index_if_missing!</a></span>(<span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span><span class='comma'>,</span> <span class='const'>FSBucket</span><span class='op'>::</span><span class='const'><a href="#FILES_INDEX-constant" title="Mongo::Grid::FSBucket::FILES_INDEX (constant)">FILES_INDEX</a></span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_chunks_collection'><a href="#chunks_collection-instance_method" title="Mongo::Grid::FSBucket#chunks_collection (method)">chunks_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>({}<span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>projection:</span> { <span class='label'>_id:</span> <span class='int'>1</span> }).<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_create_index_if_missing!'><a href="#create_index_if_missing!-instance_method" title="Mongo::Grid::FSBucket#create_index_if_missing! (method)">create_index_if_missing!</a></span>(<span class='id identifier rubyid_chunks_collection'><a href="#chunks_collection-instance_method" title="Mongo::Grid::FSBucket#chunks_collection (method)">chunks_collection</a></span><span class='comma'>,</span> <span class='const'>FSBucket</span><span class='op'>::</span><span class='const'><a href="#CHUNKS_INDEX-constant" title="Mongo::Grid::FSBucket::CHUNKS_INDEX (constant)">CHUNKS_INDEX</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unique'>unique</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="files_name-instance_method">
  <h3 class='signature priv'>
    #<strong>files_name</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L511-L513'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='511' data-end='513'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 511</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_files_name'>files_name</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prefix'><a href="#prefix-instance_method" title="Mongo::Grid::FSBucket#prefix (method)">prefix</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='const'><a href="../Grid.html" title="Mongo::Grid (module)">Grid</a></span><span class='op'>::</span><span class='const'><a href="File.html" title="Mongo::Grid::File (class)">File</a></span><span class='op'>::</span><span class='const'><a href="File/Info.html" title="Mongo::Grid::File::Info (class)">Info</a></span><span class='op'>::</span><span class='const'><a href="File/Info.html#COLLECTION-constant" title="Mongo::Grid::File::Info::COLLECTION (constant)">COLLECTION</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find-instance_method">
  <h3 class='signature '>
    #<strong>find</strong>(selector = nil, options = {})  &#x21d2; <code>CollectionView</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Find files collection documents matching a given selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Find files collection documents by a filename.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_find'>find</span>(<span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>file.txt</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>selector</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The selector to use in the find.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options for the find.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:allow_disk_use</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether the server can write temporary data to disk while executing the find operation.</p>
</div>        </li>
        <li>
          <span class='name'>:batch_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The number of documents returned in each batch of results from MongoDB.</p>
</div>        </li>
        <li>
          <span class='name'>:limit</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The max number of docs to return from the query.</p>
</div>        </li>
        <li>
          <span class='name'>:no_cursor_timeout</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>The server normally times out idle cursors after an inactivity period (10 minutes) to prevent excess memory use. Set this option to prevent that.</p>
</div>        </li>
        <li>
          <span class='name'>:skip</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The number of docs to skip before returning results.</p>
</div>        </li>
        <li>
          <span class='name'>:sort</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The key and direction pairs by which the result set will be sorted.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>CollectionView</code>)</span>
&mdash;    <div class='inline'>
<p>The collection view.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L134-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='134' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 134</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'>selector</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>read:</span> <span class='id identifier rubyid_read_preference'><a href="#read_preference-instance_method" title="Mongo::Grid::FSBucket#read_preference (method)">read_preference</a></span>) <span class='kw'>if</span> <span class='id identifier rubyid_read_preference'><a href="#read_preference-instance_method" title="Mongo::Grid::FSBucket#read_preference (method)">read_preference</a></span>
  <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_selector'>selector</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>||</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_one-instance_method">
  <h3 class='signature deprecated'>
    #<strong>find_one</strong>(selector = nil)  &#x21d2; <a href="File.html" title="Mongo::Grid::File (class)">Grid::File</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>Please use #find instead with a limit of -1. Will be removed in version 3.0.</p>
</div></div>

<p>Find a file in the GridFS.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Find a file by its id.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_find_one'>find_one</span>(<span class='label'>_id:</span> <span class='id identifier rubyid_id'>id</span>)</code></pre>
        <p class='example_title'><div class='inline'>
<p>Find a file by its filename.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_find_one'>find_one</span>(<span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test.txt</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>selector</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The selector.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="File.html" title="Mongo::Grid::File (class)">Grid::File</a>)</span>
&mdash;    <div class='inline'>
<p>The file.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L155-L160'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='155' data-end='160'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 155</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_one'>find_one</span>(<span class='id identifier rubyid_selector'>selector</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_file_info'>file_info</span> <span class='op'>=</span> <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>(<span class='id identifier rubyid_selector'>selector</span>).<span class='id identifier rubyid_first'>first</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_file_info'>file_info</span>
  <span class='id identifier rubyid_chunks'>chunks</span> <span class='op'>=</span> <span class='id identifier rubyid_chunks_collection'><a href="#chunks_collection-instance_method" title="Mongo::Grid::FSBucket#chunks_collection (method)">chunks_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_files_id'>files_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_file_info'>file_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>]).<span class='id identifier rubyid_sort'>sort</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_n'>n</span> <span class='op'>=&gt;</span> <span class='int'>1</span>)
  <span class='const'><a href="../Grid.html" title="Mongo::Grid (module)">Grid</a></span><span class='op'>::</span><span class='const'><a href="File.html" title="Mongo::Grid::File (class)">File</a></span>.<span class='id identifier rubyid_new'><a href="File.html#new-class_method" title="Mongo::Grid::File.new (method)">new</a></span>(<span class='id identifier rubyid_chunks'>chunks</span>.<span class='id identifier rubyid_to_a'>to_a</span><span class='comma'>,</span> <span class='const'><a href="../Options.html" title="Mongo::Options (module)">Options</a></span><span class='op'>::</span><span class='const'><a href="../Options/Mapper.html" title="Mongo::Options::Mapper (module)">Mapper</a></span>.<span class='id identifier rubyid_transform'><a href="../Options/Mapper.html#transform-instance_method" title="Mongo::Options::Mapper#transform (method)">transform</a></span>(<span class='id identifier rubyid_file_info'>file_info</span><span class='comma'>,</span> <span class='const'><a href="../Grid.html" title="Mongo::Grid (module)">Grid</a></span><span class='op'>::</span><span class='const'><a href="File.html" title="Mongo::Grid::File (class)">File</a></span><span class='op'>::</span><span class='const'><a href="File/Info.html" title="Mongo::Grid::File::Info (class)">Info</a></span><span class='op'>::</span><span class='const'><a href="File/Info.html#MAPPINGS-constant" title="Mongo::Grid::File::Info::MAPPINGS (constant)">MAPPINGS</a></span>.<span class='id identifier rubyid_invert'>invert</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_one-instance_method">
  <h3 class='signature deprecated'>
    #<strong>insert_one</strong>(file)  &#x21d2; <code>BSON::ObjectId</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>Please use #upload_from_stream or #open_upload_stream instead. Will be removed in version 3.0.</p>
</div></div>

<p>Insert a single file into the GridFS.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Insert a single file.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_insert_one'>insert_one</span>(<span class='id identifier rubyid_file'>file</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>file</span>
    <span class='type'>(<a href="File.html" title="Mongo::Grid::File (class)">Grid::File</a>)</span>
&mdash;    <div class='inline'>
<p>The file to insert.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::ObjectId</code>)</span>
&mdash;    <div class='inline'>
<p>The file id.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L175-L180'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='175' data-end='180'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 175</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert_one'>insert_one</span>(<span class='id identifier rubyid_file'>file</span>)
  <span class='ivar'>@indexes</span> <span class='op'>||=</span> <span class='id identifier rubyid_ensure_indexes!'><a href="#ensure_indexes!-instance_method" title="Mongo::Grid::FSBucket#ensure_indexes! (method)">ensure_indexes!</a></span>
  <span class='id identifier rubyid_chunks_collection'><a href="#chunks_collection-instance_method" title="Mongo::Grid::FSBucket#chunks_collection (method)">chunks_collection</a></span>.<span class='id identifier rubyid_insert_many'>insert_many</span>(<span class='id identifier rubyid_file'>file</span>.<span class='id identifier rubyid_chunks'>chunks</span>)
  <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_insert_one'>insert_one</span>(<span class='id identifier rubyid_file'>file</span>.<span class='id identifier rubyid_info'>info</span>)
  <span class='id identifier rubyid_file'>file</span>.<span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_download_stream-instance_method">
  <h3 class='signature '>
    #<strong>open_download_stream</strong>(id, options = nil) {|The| ... } &#x21d2; <a href="FSBucket/Stream/Read.html" title="Mongo::Grid::FSBucket::Stream::Read (class)">Stream::Read</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Opens a stream from which a file can be downloaded, specified by id.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Open a stream from which a file can be downloaded.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_open_download_stream'>open_download_stream</span>(<span class='id identifier rubyid_id'>id</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>id</span>
    <span class='type'>(<code>BSON::ObjectId</code>, <code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The id of the file to read.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:file_info_doc</span>
          <span class='type'>(<code>BSON::Document</code>)</span>
            &mdash; <div class='inline'>
<p>For internal driver use only. A BSON document to use as file information.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>The</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>read stream.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="FSBucket/Stream/Read.html" title="Mongo::Grid::FSBucket::Stream::Read (class)">Stream::Read</a>)</span>
&mdash;    <div class='inline'>
<p>The stream to read from.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L243-L254'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='243' data-end='254'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 243</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_open_download_stream'>open_download_stream</span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span> <span class='op'>=</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_shallow_symbolize_keys'>shallow_symbolize_keys</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span> <span class='op'>||</span> {})
  <span class='id identifier rubyid_read_stream'><a href="#read_stream-instance_method" title="Mongo::Grid::FSBucket#read_stream (method)">read_stream</a></span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stream'>stream</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='kw'>begin</span>
        <span class='kw'>yield</span> <span class='id identifier rubyid_stream'>stream</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_close'>close</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_download_stream_by_name-instance_method">
  <h3 class='signature '>
    #<strong>open_download_stream_by_name</strong>(filename, opts = {}) {|The| ... } &#x21d2; <a href="FSBucket/Stream/Read.html" title="Mongo::Grid::FSBucket::Stream::Read (class)">Stream::Read</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Opens a stream from which the application can read the contents of the stored file specified by filename and the revision in options.</p>

<p>Revision numbers are defined as follows: 0 = the original stored file 1 = the first revision 2 = the second revision etc…-2 = the second most recent revision -1 = the most recent revision</p>

<h4 id="label-40example+Open+a+stream+to+download+the+original+file.">@example Open a stream to download the original file.</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_open_download_stream_by_name'>open_download_stream_by_name</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-file.txt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>revision:</span> <span class='int'>0</span>)</code></pre>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Open a stream to download the most recent revision.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_open_download_stream_by_name'>open_download_stream_by_name</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-file.txt</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
        <p class='example_title'><div class='inline'>
<p>Open a stream to download the second revision of the stored file.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_open_download_stream_by_name'>open_download_stream_by_name</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>some-file.txt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>revision:</span> <span class='int'>2</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filename</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The file’s name.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p><a href="../Options.html" title="Mongo::Options (module)"><code>::Mongo::Options</code></a> for the download.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:revision</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The revision number of the file to download. Defaults to -1, the most recent version.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>The</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>read stream.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="FSBucket/Stream/Read.html" title="Mongo::Grid::FSBucket::Stream::Read (class)">Stream::Read</a>)</span>
&mdash;    <div class='inline'>
<p>The stream to read from.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Error/FileNotFound.html" title="Mongo::Error::FileNotFound (class)">Error::FileNotFound</a>)</span>
&mdash;    <div class='inline'>
<p>If the file is not found.</p>
</div>
  </li>
  <li>
    <span class='type'>(<a href="../Error/InvalidFileRevision.html" title="Mongo::Error::InvalidFileRevision (class)">Error::InvalidFileRevision</a>)</span>
&mdash;    <div class='inline'>
<p>If the requested revision is not found for the file.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L308-L326'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='308' data-end='326'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 308</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_open_download_stream_by_name'>open_download_stream_by_name</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_revision'>revision</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_revision'>revision</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_revision'>revision</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_skip'>skip</span> <span class='op'>=</span> <span class='id identifier rubyid_revision'>revision</span>.<span class='id identifier rubyid_abs'>abs</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='id identifier rubyid_sort'>sort</span> <span class='op'>=</span> { <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uploadDate</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="../../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="../Index.html" title="Mongo::Index (module)">Index</a></span><span class='op'>::</span><span class='const'><a href="../Index.html#DESCENDING-constant" title="Mongo::Index::DESCENDING (constant)">DESCENDING</a></span> }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_skip'>skip</span> <span class='op'>=</span> <span class='id identifier rubyid_revision'>revision</span>
    <span class='id identifier rubyid_sort'>sort</span> <span class='op'>=</span> { <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uploadDate</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="../../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="../Index.html" title="Mongo::Index (module)">Index</a></span><span class='op'>::</span><span class='const'><a href="../Index.html#ASCENDING-constant" title="Mongo::Index::ASCENDING (constant)">ASCENDING</a></span> }
  <span class='kw'>end</span>
  <span class='id identifier rubyid_file_info_doc'>file_info_doc</span> <span class='op'>=</span> <span class='id identifier rubyid_files_collection'><a href="#files_collection-instance_method" title="Mongo::Grid::FSBucket#files_collection (method)">files_collection</a></span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="Mongo::Grid::FSBucket#find (method)">find</a></span>({ <span class='label'>filename:</span> <span class='id identifier rubyid_filename'>filename</span>} <span class='comma'>,</span>
                                     <span class='label'>sort:</span> <span class='id identifier rubyid_sort'>sort</span><span class='comma'>,</span>
                                     <span class='label'>skip:</span> <span class='id identifier rubyid_skip'>skip</span><span class='comma'>,</span>
                                     <span class='label'>limit:</span> <span class='op'>-</span><span class='int'>1</span>).<span class='id identifier rubyid_first'>first</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_file_info_doc'>file_info_doc</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/FileNotFound.html" title="Mongo::Error::FileNotFound (class)">FileNotFound</a></span>.<span class='id identifier rubyid_new'><a href="../Error/FileNotFound.html#new-class_method" title="Mongo::Error::FileNotFound.new (method)">new</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_filename'>filename</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_revision'>revision</span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/InvalidFileRevision.html" title="Mongo::Error::InvalidFileRevision (class)">InvalidFileRevision</a></span>.<span class='id identifier rubyid_new'><a href="../Error/InvalidFileRevision.html#new-class_method" title="Mongo::Error::InvalidFileRevision.new (method)">new</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_revision'>revision</span>])
  <span class='kw'>end</span>
  <span class='id identifier rubyid_open_download_stream'><a href="#open_download_stream-instance_method" title="Mongo::Grid::FSBucket#open_download_stream (method)">open_download_stream</a></span>(<span class='id identifier rubyid_file_info_doc'>file_info_doc</span>[<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>]<span class='comma'>,</span> <span class='label'>file_info_doc:</span> <span class='id identifier rubyid_file_info_doc'>file_info_doc</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="open_upload_stream-instance_method">
  <h3 class='signature '>
    #<strong>open_upload_stream</strong>(filename, opts = {}) {|The| ... } &#x21d2; <a href="FSBucket/Stream/Write.html" title="Mongo::Grid::FSBucket::Stream::Write (class)">Stream::Write</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Opens an upload stream to GridFS to which the contents of a file or blob can be written.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filename</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The name of the file in GridFS.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options for the write stream.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:file_id</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>An optional unique file id. A BSON::ObjectId is automatically generated if a file id is not provided.</p>
</div>        </li>
        <li>
          <span class='name'>:chunk_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>Override the default chunk size.</p>
</div>        </li>
        <li>
          <span class='name'>:metadata</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>User data for the ‘metadata’ field of the files collection document.</p>
</div>        </li>
        <li>
          <span class='name'>:content_type</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The content type of the file. Deprecated, please use the metadata document instead.</p>
</div>        </li>
        <li>
          <span class='name'>:aliases</span>
          <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
            &mdash; <div class='inline'>
<p>A list of aliases. Deprecated, please use the metadata document instead.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>The</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>write stream.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="FSBucket/Stream/Write.html" title="Mongo::Grid::FSBucket::Stream::Write (class)">Stream::Write</a>)</span>
&mdash;    <div class='inline'>
<p>The write stream.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L389-L400'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='389' data-end='400'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_open_upload_stream'>open_upload_stream</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='const'><a href="../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_shallow_symbolize_keys'>shallow_symbolize_keys</span>(<span class='id identifier rubyid_opts'>opts</span>)
  <span class='id identifier rubyid_write_stream'><a href="#write_stream-instance_method" title="Mongo::Grid::FSBucket#write_stream (method)">write_stream</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stream'>stream</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='kw'>begin</span>
        <span class='kw'>yield</span> <span class='id identifier rubyid_stream'>stream</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_close'>close</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="prefix-instance_method">
  <h3 class='signature '>
    #<strong>prefix</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the prefix for the GridFS</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the prefix.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_prefix'>prefix</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The GridFS prefix.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L190-L192'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='190' data-end='192'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 190</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_prefix'>prefix</span>
  <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_fs_name'>fs_name</span>] <span class='op'>||</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_bucket_name'>bucket_name</span>] <span class='op'>||</span> <span class='const'><a href="#DEFAULT_ROOT-constant" title="Mongo::Grid::FSBucket::DEFAULT_ROOT (constant)">DEFAULT_ROOT</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_preference-instance_method">
  <h3 class='signature '>
    #<strong>read_preference</strong>  &#x21d2; <code>BSON::Document</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method always returns a BSON::Document instance, even though the <code>FSBucket</code> constructor specifies the type of <code>:read</code> as a Hash, not as a BSON::Document.</p>
</div>
  </div>


<p>Get the read preference.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code>)</span>
&mdash;    <div class='inline'>
<p>The read preference. The document may have the following fields:</p>
<ul><li>
<p><strong>:mode</strong> – read preference specified as a symbol; valid values are <strong>:primary</strong>, <strong>:primary_preferred</strong>, <strong>:secondary</strong>, <strong>:secondary_preferred</strong> and <strong>:nearest</strong>.</p>
</li><li>
<p><strong>:tag_sets</strong> – an array of hashes.</p>
</li><li>
<p><strong>:local_threshold</strong>.</p>
</li></ul>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L460-L469'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='460' data-end='469'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 460</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_preference'>read_preference</span>
  <span class='ivar'>@read_preference</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_pref'>pref</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>] <span class='op'>||</span> <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span>.<span class='id identifier rubyid_read_preference'>read_preference</span>
    <span class='kw'>if</span> <span class='const'>BSON</span><span class='op'>::</span><span class='const'>Document</span> <span class='op'>===</span> <span class='id identifier rubyid_pref'>pref</span>
      <span class='id identifier rubyid_pref'>pref</span>
    <span class='kw'>else</span>
      <span class='const'>BSON</span><span class='op'>::</span><span class='const'>Document</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Grid::FSBucket.new (method)">new</a></span>(<span class='id identifier rubyid_pref'>pref</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_stream-instance_method">
  <h3 class='signature priv'>
    #<strong>read_stream</strong>(id, **opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>The options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>**opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:file_info_doc</span>
          <span class='type'>(<code>BSON::Document</code>)</span>
            &mdash; <div class='inline'>
<p>For internal driver use only. A BSON document to use as file information.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L499-L501'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='499' data-end='501'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 499</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_stream'>read_stream</span>(<span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span>)
  <span class='const'><a href="FSBucket/Stream.html" title="Mongo::Grid::FSBucket::Stream (module)">Stream</a></span>.<span class='id identifier rubyid_get'><a href="FSBucket/Stream.html#get-instance_method" title="Mongo::Grid::FSBucket::Stream#get (method)">get</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='const'><a href="FSBucket/Stream.html" title="Mongo::Grid::FSBucket::Stream (module)">Stream</a></span><span class='op'>::</span><span class='const'><a href="FSBucket/Stream.html#READ_MODE-constant" title="Mongo::Grid::FSBucket::Stream::READ_MODE (constant)">READ_MODE</a></span><span class='comma'>,</span> { <span class='label'>file_id:</span> <span class='id identifier rubyid_id'>id</span> }.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>).<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_opts'>opts</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="upload_from_stream-instance_method">
  <h3 class='signature '>
    #<strong>upload_from_stream</strong>(filename, io, opts = {})  &#x21d2; <code>BSON::ObjectId</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Uploads a user file to a GridFS bucket. Reads the contents of the user file from the source stream and uploads it as chunks in the chunks collection. After all the chunks have been uploaded, it creates a files collection document for the filename in the files collection.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Upload a file to the GridFS bucket.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_fs'>fs</span>.<span class='id identifier rubyid_upload_from_stream'>upload_from_stream</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a-file.txt</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filename</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The filename of the file to upload.</p>
</div>
  </li>
  <li>
    <span class='name'>io</span>
    <span class='type'>(<code>IO</code>)</span>
&mdash;    <div class='inline'>
<p>The source io stream to upload from.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options for the write stream.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:file_id</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>An optional unique file id. An ObjectId is generated otherwise.</p>
</div>        </li>
        <li>
          <span class='name'>:chunk_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>Override the default chunk size.</p>
</div>        </li>
        <li>
          <span class='name'>:metadata</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>User data for the ‘metadata’ field of the files collection document.</p>
</div>        </li>
        <li>
          <span class='name'>:content_type</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The content type of the file. Deprecated, please use the metadata document instead.</p>
</div>        </li>
        <li>
          <span class='name'>:aliases</span>
          <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
            &mdash; <div class='inline'>
<p>A list of aliases. Deprecated, please use the metadata document instead.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::ObjectId</code>)</span>
&mdash;    <div class='inline'>
<p>The ObjectId file id.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L430-L445'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='430' data-end='445'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 430</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_upload_from_stream'>upload_from_stream</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_io'>io</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_open_upload_stream'><a href="#open_upload_stream-instance_method" title="Mongo::Grid::FSBucket#open_upload_stream (method)">open_upload_stream</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stream'>stream</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_io'>io</span>)
    <span class='comment'># IOError and SystemCallError are for errors reading the io.
</span>    <span class='comment'># Error::SocketError and Error::SocketTimeoutError are for
</span>    <span class='comment'># writing to MongoDB.
</span>    <span class='kw'>rescue</span> <span class='const'>IOError</span><span class='comma'>,</span> <span class='const'>SystemCallError</span><span class='comma'>,</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_abort'>abort</span>
      <span class='kw'>rescue</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/OperationFailure.html" title="Mongo::Error::OperationFailure (class)">OperationFailure</a></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_raise'>raise</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_file_id'>file_id</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_concern-instance_method">
  <h3 class='signature '>
    #<strong>write_concern</strong>  &#x21d2; <a href="../WriteConcern.html" title="Mongo::WriteConcern (module)">Mongo::WriteConcern</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the write concern.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the write concern.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_stream'>stream</span>.<span class='id identifier rubyid_write_concern'>write_concern</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../WriteConcern.html" title="Mongo::WriteConcern (module)">Mongo::WriteConcern</a>)</span>
&mdash;    <div class='inline'>
<p>The write concern.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L479-L485'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='479' data-end='485'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 479</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_concern'>write_concern</span>
  <span class='ivar'>@write_concern</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='id identifier rubyid_wco'>wco</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'>write_concern</span>] <span class='op'>||</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>]
    <span class='const'><a href="../WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span>.<span class='id identifier rubyid_get'><a href="../WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span>(<span class='id identifier rubyid_wco'>wco</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Grid::FSBucket#database (method)">database</a></span>.<span class='id identifier rubyid_write_concern'>write_concern</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_stream-instance_method">
  <h3 class='signature priv'>
    #<strong>write_stream</strong>(filename, **opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/grid/fs_bucket.rb#L503-L505'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='503' data-end='505'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/grid/fs_bucket.rb', line 503</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_stream'>write_stream</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span>)
  <span class='const'><a href="FSBucket/Stream.html" title="Mongo::Grid::FSBucket::Stream (module)">Stream</a></span>.<span class='id identifier rubyid_get'><a href="FSBucket/Stream.html#get-instance_method" title="Mongo::Grid::FSBucket::Stream#get (method)">get</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='const'><a href="FSBucket/Stream.html" title="Mongo::Grid::FSBucket::Stream (module)">Stream</a></span><span class='op'>::</span><span class='const'><a href="FSBucket/Stream.html#WRITE_MODE-constant" title="Mongo::Grid::FSBucket::Stream::WRITE_MODE (constant)">WRITE_MODE</a></span><span class='comma'>,</span> { <span class='label'>filename:</span> <span class='id identifier rubyid_filename'>filename</span> }.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Grid::FSBucket#options (method)">options</a></span>).<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_opts'>opts</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>