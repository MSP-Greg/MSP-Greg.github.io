<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Cursor &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Cursor",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Mongo master</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Cursor&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Cursor  <span class='private note title'>Private</span>
</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Cursor/KillSpec.html" title="Mongo::Cursor::KillSpec (class)"><code>KillSpec</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a href="CachingCursor.html" title="Mongo::CachingCursor (class)">CachingCursor</a>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Retryable.html" title="Mongo::Retryable (module)"><code>Retryable</code></a>,
          Enumerable
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L34'>lib/mongo/cursor.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor/kill_spec.rb#L19'>lib/mongo/cursor/kill_spec.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Client-side representation of an iterator over a query result set on the server.</p>

<p><code>Cursor</code> objects are not directly exposed to application code. Rather, <code>Collection::View</code> exposes the <code>Enumerable</code> interface to the applications, and the enumerator is backed by a <code>Cursor</code> instance.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get an array of 5 users named Emily.</p>
</div></p>
      <pre class='example code "#{object.source_type}"'><code><span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_find'>find</span>({<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Emily</span><span class='tstring_end'>&#39;</span></span>}).<span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongo::Cursor#limit (method)">limit</a></span>(<span class='int'>5</span>).<span class='id identifier rubyid_to_a'>to_a</span></code></pre>
        <p class='example_title'><div class='inline'>
<p>Call a block on each user doc.</p>
</div></p>
      <pre class='example code "#{object.source_type}"'><code><span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_find'>find</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Mongo::Cursor#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_doc'>doc</span> }</code></pre>
  </div>

</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#finalize-class_method" title=".finalize (class method)">.<strong>finalize</strong>(kill_spec, cluster)  &#x21d2; Proc </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Finalize the cursor for garbage collection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(view, result, server, options = {})  &#x21d2; Cursor </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a <code>Cursor</code> object.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; true, false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Is the cursor closed?</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#fully_iterated%3F-instance_method" title="#fully_iterated? (instance method)">#<strong>fully_iterated?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#initial_result-instance_method" title="#initial_result (instance method)">#<strong>initial_result</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#resume_token-instance_method" title="#resume_token (instance method)">#<strong>resume_token</strong>  &#x21d2; BSON::Document | nil </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>The resume token tracked by the cursor for change stream resuming.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#server-instance_method" title="#server (instance method)">#<strong>server</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#view-instance_method" title="#view (instance method)">#<strong>view</strong>  &#x21d2; Collection::View </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#exhausted%3F-instance_method" title="#exhausted? (instance method)">#<strong>exhausted?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#explicitly_closed%3F-instance_method" title="#explicitly_closed? (instance method)">#<strong>explicitly_closed?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#limited%3F-instance_method" title="#limited? (instance method)">#<strong>limited?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#use_limit%3F-instance_method" title="#use_limit? (instance method)">#<strong>use_limit?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#batch_size-instance_method" title="#batch_size (instance method)">#<strong>batch_size</strong>  &#x21d2; Integer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the batch size.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Closes this cursor, freeing any associated resources on the client and the server.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#collection_name-instance_method" title="#collection_name (instance method)">#<strong>collection_name</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the parsed collection name.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>  &#x21d2; Enumerator </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Iterate through documents returned from the query.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#get_more-instance_method" title="#get_more (instance method)">#<strong>get_more</strong>  &#x21d2; Array&lt;BSON::Document&gt; </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute a getMore command and return the batch of documents obtained from the server.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#id-instance_method" title="#id (instance method)">#<strong>id</strong>  &#x21d2; Integer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the cursor id.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get a human-readable string representation of <code>Cursor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#kill_spec-instance_method" title="#kill_spec (instance method)">#<strong>kill_spec</strong>(connection_global_id)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_return-instance_method" title="#to_return (instance method)">#<strong>to_return</strong>  &#x21d2; Integer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the number of documents to return.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#try_next-instance_method" title="#try_next (instance method)">#<strong>try_next</strong>  &#x21d2; BSON::Document | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Return one document from the query, if one is available.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#batch_size_for_get_more-instance_method" title="#batch_size_for_get_more (instance method)">#<strong>batch_size_for_get_more</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#cache_batch_resume_token-instance_method" title="#cache_batch_resume_token (instance method)">#<strong>cache_batch_resume_token</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#cache_resume_token-instance_method" title="#cache_resume_token (instance method)">#<strong>cache_resume_token</strong>(doc)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#end_session-instance_method" title="#end_session (instance method)">#<strong>end_session</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#execute_operation-instance_method" title="#execute_operation (instance method)">#<strong>execute_operation</strong>(op)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#get_more_operation-instance_method" title="#get_more_operation (instance method)">#<strong>get_more_operation</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#limit-instance_method" title="#limit (instance method)">#<strong>limit</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#process-instance_method" title="#process (instance method)">#<strong>process</strong>(result)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#register-instance_method" title="#register (instance method)">#<strong>register</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#set_cursor_id-instance_method" title="#set_cursor_id (instance method)">#<strong>set_cursor_id</strong>(result)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets @cursor_id from the operation result.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#unregister-instance_method" title="#unregister (instance method)">#<strong>unregister</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited'><a href="Retryable.html" title="Mongo::Retryable (module)"><code>Retryable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Retryable.html#read_worker-instance_method" title="Mongo::Retryable#read_worker (method)">#read_worker</a></td>
      <td><div class='inline'><p>Returns the read worker for handling retryable reads.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Retryable.html#select_server-instance_method" title="Mongo::Retryable#select_server (method)">#select_server</a></td>
      <td><div class='inline'><p>This is a separate method to make it possible for the test suite to assert that server selection is performed during retry attempts.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Retryable.html#write_worker-instance_method" title="Mongo::Retryable#write_worker (method)">#write_worker</a></td>
      <td><div class='inline'><p>Returns the write worker for handling retryable writes.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="finalize-class_method">
  <h3 class='signature nodoc first'>
    .<strong>finalize</strong>(kill_spec, cluster)  &#x21d2; <code>Proc</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Finalize the cursor for garbage collection. Schedules this cursor to be included in a killCursors operation executed by the Cluster’s CursorReaper.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>kill_spec</span>
    <span class='type'>(<a href="Cursor/KillSpec.html" title="Mongo::Cursor::KillSpec (class)">Cursor::KillSpec</a>)</span>
&mdash;    <div class='inline'>
<p>The KillCursor operation specification.</p>
</div>
  </li>
  <li>
    <span class='name'>cluster</span>
    <span class='type'>(<a href="Cluster.html" title="Mongo::Cluster (class)">Mongo::Cluster</a>)</span>
&mdash;    <div class='inline'>
<p>The cluster associated with this cursor and its server.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>The Finalizer.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L110-L117'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='110' data-end='117'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 110</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_finalize'>finalize</span>(<span class='id identifier rubyid_kill_spec'><a href="#kill_spec-instance_method" title="Mongo::Cursor#kill_spec (method)">kill_spec</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cluster'>cluster</span>)
  <span class='kw'>unless</span> <span class='const'><a href="Cursor/KillSpec.html" title="Mongo::Cursor::KillSpec (class)">KillSpec</a></span> <span class='op'>===</span> <span class='id identifier rubyid_kill_spec'><a href="#kill_spec-instance_method" title="Mongo::Cursor#kill_spec (method)">kill_spec</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>First argument must be a KillSpec: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_kill_spec'><a href="#kill_spec-instance_method" title="Mongo::Cursor#kill_spec (method)">kill_spec</a></span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Mongo::Cursor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_schedule_kill_cursor'>schedule_kill_cursor</span>(<span class='id identifier rubyid_kill_spec'><a href="#kill_spec-instance_method" title="Mongo::Cursor#kill_spec (method)">kill_spec</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="closed?-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>closed?</strong>  &#x21d2; <code>true</code>, <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Is the cursor closed?</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Is the cursor closed?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_closed?'>closed?</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the cursor is closed.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.2.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L278-L281'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='278' data-end='281'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 278</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='comment'># @cursor_id should in principle never be nil
</span>  <span class='ivar'>@cursor_id</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='ivar'>@cursor_id</span> <span class='op'>==</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exhausted?-instance_method">
  <h3 class='signature ro priv  nodoc'>
    #<strong>exhausted?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L414-L416'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='414' data-end='416'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 414</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exhausted?'>exhausted?</span>
  <span class='id identifier rubyid_limited?'><a href="#limited%3F-instance_method" title="Mongo::Cursor#limited? (method)">limited?</a></span> <span class='op'>?</span> <span class='ivar'>@remaining</span> <span class='op'>&lt;=</span> <span class='int'>0</span> <span class='op'>:</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="explicitly_closed?-instance_method">
  <h3 class='signature ro priv  nodoc'>
    #<strong>explicitly_closed?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L400-L404'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='400' data-end='404'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 400</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_explicitly_closed?'>explicitly_closed?</span>
  <span class='ivar'>@lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@explicitly_closed</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fully_iterated?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>fully_iterated?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L394-L396'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='394' data-end='396'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 394</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fully_iterated?'>fully_iterated?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@fully_iterated</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="initial_result-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>initial_result</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L99-L99'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='99' data-end='99'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 99</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_initial_result'>initial_result</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="limited?-instance_method">
  <h3 class='signature ro priv  nodoc'>
    #<strong>limited?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L457-L459'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='457' data-end='459'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 457</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_limited?'>limited?</span>
  <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongo::Cursor#limit (method)">limit</a></span> <span class='op'>?</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongo::Cursor#limit (method)">limit</a></span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>:</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="resume_token-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>resume_token</strong>  &#x21d2; <code>BSON::Document</code> | <code>nil</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The resume token tracked by the cursor for change stream resuming</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The cursor resume token.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L50-L50'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='50'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_resume_token'>resume_token</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="server-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>server</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L96-L96'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='96' data-end='96'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 96</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_server'>server</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="use_limit?-instance_method">
  <h3 class='signature ro priv  nodoc'>
    #<strong>use_limit?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L482-L484'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='482' data-end='484'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 482</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_use_limit?'>use_limit?</span>
  <span class='id identifier rubyid_limited?'><a href="#limited%3F-instance_method" title="Mongo::Cursor#limited? (method)">limited?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_batch_size'><a href="#batch_size-instance_method" title="Mongo::Cursor#batch_size (method)">batch_size</a></span> <span class='op'>&gt;=</span> <span class='ivar'>@remaining</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="view-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>view</strong>  &#x21d2; <a href="Collection/View.html" title="Mongo::Collection::View (class)">Collection::View</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Collection/View.html" title="Mongo::Collection::View (class)">Collection::View</a>)</span>
&mdash;    <div class='inline'>
<p>view The collection view.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L44-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='44' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 44</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_view'>view</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="batch_size-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>batch_size</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the batch size.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the batch size.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_batch_size'>batch_size</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The batch size.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.2.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L261-L268'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='261' data-end='268'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 261</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_size'>batch_size</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='ivar'>@view</span>.<span class='id identifier rubyid_batch_size'>batch_size</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@view</span>.<span class='id identifier rubyid_batch_size'>batch_size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='ivar'>@view</span>.<span class='id identifier rubyid_batch_size'>batch_size</span> <span class='op'>:</span> <span class='id identifier rubyid_limit'><a href="#limit-instance_method" title="Mongo::Cursor#limit (method)">limit</a></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="batch_size_for_get_more-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>batch_size_for_get_more</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L406-L412'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='406' data-end='412'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 406</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_batch_size_for_get_more'>batch_size_for_get_more</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_batch_size'><a href="#batch_size-instance_method" title="Mongo::Cursor#batch_size (method)">batch_size</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_use_limit?'><a href="#use_limit%3F-instance_method" title="Mongo::Cursor#use_limit? (method)">use_limit?</a></span>
    [<span class='id identifier rubyid_batch_size'><a href="#batch_size-instance_method" title="Mongo::Cursor#batch_size (method)">batch_size</a></span><span class='comma'>,</span> <span class='ivar'>@remaining</span>].<span class='id identifier rubyid_min'>min</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_batch_size'><a href="#batch_size-instance_method" title="Mongo::Cursor#batch_size (method)">batch_size</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_batch_resume_token-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>cache_batch_resume_token</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L424-L426'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='424' data-end='426'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 424</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_batch_resume_token'>cache_batch_resume_token</span>
  <span class='ivar'>@resume_token</span> <span class='op'>=</span> <span class='ivar'>@post_batch_resume_token</span> <span class='kw'>if</span> <span class='ivar'>@post_batch_resume_token</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_resume_token-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>cache_resume_token</strong>(doc)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L418-L422'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='418' data-end='422'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 418</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_resume_token'>cache_resume_token</span>(<span class='id identifier rubyid_doc'>doc</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_doc'>doc</span>[<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_doc'>doc</span>[<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
    <span class='ivar'>@resume_token</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span>[<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_doc'>doc</span>[<span class='symbeg'>:</span><span class='id identifier rubyid__id'>_id</span>].<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_freeze'>freeze</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature nodoc'>
    #<strong>close</strong>  &#x21d2; <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Closes this cursor, freeing any associated resources on the client and the server.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Always nil.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L287-L310'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='287' data-end='310'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 287</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Cursor#closed? (method)">closed?</a></span>

  <span class='id identifier rubyid_unregister'><a href="#unregister-instance_method" title="Mongo::Cursor#unregister (method)">unregister</a></span>
  <span class='id identifier rubyid_read_with_one_retry'>read_with_one_retry</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> {
      <span class='label'>coll_name:</span> <span class='id identifier rubyid_collection_name'><a href="#collection_name-instance_method" title="Mongo::Cursor#collection_name (method)">collection_name</a></span><span class='comma'>,</span>
      <span class='label'>db_name:</span> <span class='id identifier rubyid_database'>database</span>.<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
      <span class='label'>cursor_ids:</span> [<span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Cursor#id (method)">id</a></span>]<span class='comma'>,</span>
    }
    <span class='id identifier rubyid_op'>op</span> <span class='op'>=</span> <span class='const'><a href="Operation.html" title="Mongo::Operation (module)">Operation</a></span><span class='op'>::</span><span class='const'><a href="Operation/KillCursors.html" title="Mongo::Operation::KillCursors (class)">KillCursors</a></span>.<span class='id identifier rubyid_new'><a href="Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span>(<span class='id identifier rubyid_spec'>spec</span>)
    <span class='id identifier rubyid_execute_operation'><a href="#execute_operation-instance_method" title="Mongo::Cursor#execute_operation (method)">execute_operation</a></span>(<span class='id identifier rubyid_op'>op</span>)
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>rescue</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/OperationFailure.html" title="Mongo::Error::OperationFailure (class)">OperationFailure</a></span><span class='comma'>,</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span><span class='comma'>,</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/ServerNotUsable.html" title="Mongo::Error::ServerNotUsable (class)">ServerNotUsable</a></span>
  <span class='comment'># Errors are swallowed since there is noting can be done by handling them.
</span><span class='kw'>ensure</span>
  <span class='id identifier rubyid_end_session'><a href="#end_session-instance_method" title="Mongo::Cursor#end_session (method)">end_session</a></span>
  <span class='ivar'>@cursor_id</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@explicitly_closed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="collection_name-instance_method">
  <h3 class='signature nodoc'>
    #<strong>collection_name</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the parsed collection name.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the parsed collection name.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_coll_name'>coll_name</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The collection name.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.2.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L320-L335'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='320' data-end='335'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 320</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_collection_name'>collection_name</span>
  <span class='comment'># In most cases, this will be equivalent to the name of the collection
</span>  <span class='comment'># object in the driver. However, in some cases (e.g. when connected
</span>  <span class='comment'># to an Atlas Data Lake), the namespace returned by the find command
</span>  <span class='comment'># may be different, which is why we want to use the collection name based
</span>  <span class='comment'># on the namespace in the command result.
</span>  <span class='kw'>if</span> <span class='ivar'>@namespace</span>
    <span class='comment'># Often, the namespace will be in the format &quot;database.collection&quot;.
</span>    <span class='comment'># However, sometimes the collection name will contain periods, which
</span>    <span class='comment'># is why this method joins all the namespace components after the first.
</span>    <span class='id identifier rubyid_ns_components'>ns_components</span> <span class='op'>=</span> <span class='ivar'>@namespace</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_ns_components'>ns_components</span>[<span class='int'>1</span><span class='op'>...</span><span class='id identifier rubyid_ns_components'>ns_components</span>.<span class='id identifier rubyid_length'>length</span>].<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each-instance_method">
  <h3 class='signature nodoc'>
    #<strong>each</strong>  &#x21d2; <code>Enumerator</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Iterate through documents returned from the query.</p>

<p>A cursor may be iterated at most once. Incomplete iteration is also allowed. Attempting to iterate the cursor more than once raises InvalidCursorOperation.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Iterate over the documents in the cursor.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Enumerator</code>)</span>
&mdash;    <div class='inline'>
<p>The enumerator.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L145-L187'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='145' data-end='187'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 145</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>

  <span class='comment'># If we already iterated past the first batch (i.e., called get_more
</span>  <span class='comment'># at least once), the cursor on the server side has advanced past
</span>  <span class='comment'># the first batch and restarting iteration from the beginning by
</span>  <span class='comment'># returning initial result would miss documents in the second batch
</span>  <span class='comment'># and subsequent batches up to wherever the cursor is. Detect this
</span>  <span class='comment'># condition and abort the iteration.
</span>  <span class='comment'>#
</span>  <span class='comment'># In a future driver version, each would either continue from the
</span>  <span class='comment'># end of previous iteration or would always restart from the
</span>  <span class='comment'># beginning.
</span>  <span class='kw'>if</span> <span class='ivar'>@get_more_called</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidCursorOperation.html" title="Mongo::Error::InvalidCursorOperation (class)">InvalidCursorOperation</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Cannot restart iteration of a cursor which issued a getMore</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># To maintain compatibility with pre-2.10 driver versions, reset
</span>  <span class='comment'># the documents array each time a new iteration is started.
</span>  <span class='ivar'>@documents</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='comment'># StopIteration raised by try_next ends this loop.
</span>    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_document'>document</span> <span class='op'>=</span> <span class='id identifier rubyid_try_next'><a href="#try_next-instance_method" title="Mongo::Cursor#try_next (method)">try_next</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_explicitly_closed?'><a href="#explicitly_closed%3F-instance_method" title="Mongo::Cursor#explicitly_closed? (method)">explicitly_closed?</a></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidCursorOperation.html" title="Mongo::Error::InvalidCursorOperation (class)">InvalidCursorOperation</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Cursor was explicitly closed</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_document'>document</span> <span class='kw'>if</span> <span class='id identifier rubyid_document'>document</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_documents'>documents</span> <span class='op'>=</span> []
    <span class='comment'># StopIteration raised by try_next ends this loop.
</span>    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_document'>document</span> <span class='op'>=</span> <span class='id identifier rubyid_try_next'><a href="#try_next-instance_method" title="Mongo::Cursor#try_next (method)">try_next</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_explicitly_closed?'><a href="#explicitly_closed%3F-instance_method" title="Mongo::Cursor#explicitly_closed? (method)">explicitly_closed?</a></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidCursorOperation.html" title="Mongo::Error::InvalidCursorOperation (class)">InvalidCursorOperation</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Cursor was explicitly closed</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_documents'>documents</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_document'>document</span> <span class='kw'>if</span> <span class='id identifier rubyid_document'>document</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_documents'>documents</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="end_session-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>end_session</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L453-L455'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='453' data-end='455'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 453</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_end_session'>end_session</span>
  <span class='ivar'>@session</span>.<span class='id identifier rubyid_end_session'>end_session</span> <span class='kw'>if</span> <span class='ivar'>@session</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@session</span>.<span class='id identifier rubyid_implicit?'>implicit?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute_operation-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>execute_operation</strong>(op)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L498-L505'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='498' data-end='505'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 498</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_operation'>execute_operation</span>(<span class='id identifier rubyid_op'>op</span>)
  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='const'><a href="Operation.html" title="Mongo::Operation (module)">Operation</a></span><span class='op'>::</span><span class='const'><a href="Operation/Context.html" title="Mongo::Operation::Context (class)">Context</a></span>.<span class='id identifier rubyid_new'><a href="Operation/Context.html#new-class_method" title="Mongo::Operation::Context.new (method)">new</a></span>(
    <span class='label'>client:</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span>
    <span class='label'>session:</span> <span class='ivar'>@session</span><span class='comma'>,</span>
    <span class='label'>connection_global_id:</span> <span class='ivar'>@connection_global_id</span><span class='comma'>,</span>
  )
  <span class='id identifier rubyid_op'>op</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='ivar'>@server</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='id identifier rubyid_context'>context</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_more-instance_method">
  <h3 class='signature nodoc'>
    #<strong>get_more</strong>  &#x21d2; <code>Array</code>&lt;<code>BSON::Document</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute a getMore command and return the batch of documents obtained from the server.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<code>BSON::Document</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The batch of documents</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L370-L379'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='370' data-end='379'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 370</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_more'>get_more</span>
  <span class='ivar'>@get_more_called</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># Modern retryable reads specification prohibits retrying getMores.
</span>  <span class='comment'># Legacy retryable read logic used to retry getMores, but since
</span>  <span class='comment'># doing so may result in silent data loss, the driver no longer retries
</span>  <span class='comment'># getMore operations in any circumstance.
</span>  <span class='comment'># https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.rst#qa
</span>  <span class='id identifier rubyid_process'><a href="#process-instance_method" title="Mongo::Cursor#process (method)">process</a></span>(<span class='id identifier rubyid_execute_operation'><a href="#execute_operation-instance_method" title="Mongo::Cursor#execute_operation (method)">execute_operation</a></span>(<span class='id identifier rubyid_get_more_operation'><a href="#get_more_operation-instance_method" title="Mongo::Cursor#get_more_operation (method)">get_more_operation</a></span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_more_operation-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>get_more_operation</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L428-L451'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='428' data-end='451'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 428</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_more_operation'>get_more_operation</span>
  <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> {
    <span class='label'>session:</span> <span class='ivar'>@session</span><span class='comma'>,</span>
    <span class='label'>db_name:</span> <span class='id identifier rubyid_database'>database</span>.<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='label'>coll_name:</span> <span class='id identifier rubyid_collection_name'><a href="#collection_name-instance_method" title="Mongo::Cursor#collection_name (method)">collection_name</a></span><span class='comma'>,</span>
    <span class='label'>cursor_id:</span> <span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Cursor#id (method)">id</a></span><span class='comma'>,</span>
    <span class='comment'># 3.2+ servers use batch_size, 3.0- servers use to_return.
</span>    <span class='comment'># TODO should to_return be calculated in the operation layer?
</span>    <span class='label'>batch_size:</span> <span class='id identifier rubyid_batch_size_for_get_more'><a href="#batch_size_for_get_more-instance_method" title="Mongo::Cursor#batch_size_for_get_more (method)">batch_size_for_get_more</a></span><span class='comma'>,</span>
    <span class='label'>to_return:</span> <span class='id identifier rubyid_to_return'><a href="#to_return-instance_method" title="Mongo::Cursor#to_return (method)">to_return</a></span><span class='comma'>,</span>
    <span class='label'>max_time_ms:</span> <span class='kw'>if</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_max_await_time_ms'>max_await_time_ms</span>) <span class='op'>&amp;&amp;</span>
      <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_max_await_time_ms'>max_await_time_ms</span> <span class='op'>&amp;&amp;</span>
      <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_await_data'>await_data</span>]
    <span class='kw'>then</span>
      <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_max_await_time_ms'>max_await_time_ms</span>
    <span class='kw'>else</span>
      <span class='kw'>nil</span>
    <span class='kw'>end</span><span class='comma'>,</span>
  }
  <span class='kw'>if</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_options'>options</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
    <span class='id identifier rubyid_spec'>spec</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span>] <span class='op'>=</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span>] <span class='kw'>unless</span> <span class='id identifier rubyid_view'><a href="#view-instance_method" title="Mongo::Cursor#view (method)">view</a></span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_comment'>comment</span>].<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>
  <span class='const'><a href="Operation.html" title="Mongo::Operation (module)">Operation</a></span><span class='op'>::</span><span class='const'><a href="Operation/GetMore.html" title="Mongo::Operation::GetMore (class)">GetMore</a></span>.<span class='id identifier rubyid_new'><a href="Operation/Specifiable.html#initialize-instance_method" title="Mongo::Operation::Specifiable#initialize (method)">new</a></span>(<span class='id identifier rubyid_spec'>spec</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="id-instance_method">
  <h3 class='signature nodoc'>
    #<strong>id</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>A cursor id of 0 means the cursor was closed on the server.</p>
</div>
  </div>


<p>Get the cursor id.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the cursor id.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_id'>id</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The cursor id.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.2.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L347-L349'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='347' data-end='349'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 347</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_id'>id</span>
  <span class='ivar'>@cursor_id</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature nodoc'>
    #<strong>inspect</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get a human-readable string representation of <code>Cursor</code>.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Inspect the cursor.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_inspect'>inspect</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>A string representation of a <code>Cursor</code> instance.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L127-L129'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='127' data-end='129'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 127</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Cursor:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> @view=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@view</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill_spec-instance_method">
  <h3 class='signature nodoc'>
    #<strong>kill_spec</strong>(connection_global_id)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L382-L391'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='382' data-end='391'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 382</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_kill_spec'>kill_spec</span>(<span class='id identifier rubyid_connection_global_id'>connection_global_id</span>)
  <span class='const'><a href="Cursor/KillSpec.html" title="Mongo::Cursor::KillSpec (class)">KillSpec</a></span>.<span class='id identifier rubyid_new'><a href="Cursor/KillSpec.html#new-class_method" title="Mongo::Cursor::KillSpec.new (method)">new</a></span>(
    <span class='label'>cursor_id:</span> <span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Cursor#id (method)">id</a></span><span class='comma'>,</span>
    <span class='label'>coll_name:</span> <span class='id identifier rubyid_collection_name'><a href="#collection_name-instance_method" title="Mongo::Cursor#collection_name (method)">collection_name</a></span><span class='comma'>,</span>
    <span class='label'>db_name:</span> <span class='id identifier rubyid_database'>database</span>.<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='label'>connection_global_id:</span> <span class='id identifier rubyid_connection_global_id'>connection_global_id</span><span class='comma'>,</span>
    <span class='label'>server_address:</span> <span class='id identifier rubyid_server'><a href="#server-instance_method" title="Mongo::Cursor#server (method)">server</a></span>.<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span>
    <span class='label'>session:</span> <span class='ivar'>@session</span><span class='comma'>,</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="limit-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>limit</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L486-L488'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='486' data-end='488'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 486</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@view</span>.<span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_limit'>limit</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>process</strong>(result)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L461-L480'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='461' data-end='480'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 461</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process'>process</span>(<span class='id identifier rubyid_result'>result</span>)
  <span class='ivar'>@remaining</span> <span class='op'>-=</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_returned_count'>returned_count</span> <span class='kw'>if</span> <span class='id identifier rubyid_limited?'><a href="#limited%3F-instance_method" title="Mongo::Cursor#limited? (method)">limited?</a></span>
  <span class='comment'># #process is called for the first batch of results. In this case
</span>  <span class='comment'># the @cursor_id may be zero (all results fit in the first batch).
</span>  <span class='comment'># Thus we need to check both @cursor_id and the cursor_id of the result
</span>  <span class='comment'># prior to calling unregister here.
</span>  <span class='id identifier rubyid_unregister'><a href="#unregister-instance_method" title="Mongo::Cursor#unregister (method)">unregister</a></span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Cursor#closed? (method)">closed?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_cursor_id'>cursor_id</span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='ivar'>@cursor_id</span> <span class='op'>=</span> <span class='id identifier rubyid_set_cursor_id'><a href="#set_cursor_id-instance_method" title="Mongo::Cursor#set_cursor_id (method)">set_cursor_id</a></span>(<span class='id identifier rubyid_result'>result</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_post_batch_resume_token'>post_batch_resume_token</span>)
    <span class='ivar'>@post_batch_resume_token</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_post_batch_resume_token'>post_batch_resume_token</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_end_session'><a href="#end_session-instance_method" title="Mongo::Cursor#end_session (method)">end_session</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Cursor#closed? (method)">closed?</a></span>

  <span class='comment'># Since our iteration code mutates the documents array by calling #shift
</span>  <span class='comment'># on it, duplicate the documents here to permit restarting iteration
</span>  <span class='comment'># from the beginning of the cursor as long as get_more was not called
</span>  <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_dup'>dup</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="register-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>register</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L490-L492'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='490' data-end='492'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 490</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_register'>register</span>
  <span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_register_cursor'>register_cursor</span>(<span class='ivar'>@cursor_id</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_cursor_id-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>set_cursor_id</strong>(result)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets @cursor_id from the operation result.</p>

<p>In the operation result cursor id can be represented either as Integer value or as BSON::Int64. This method ensures that the instance variable is always of type Integer.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>result</span>
    <span class='type'>(<a href="Operation/Result.html" title="Mongo::Operation::Result (class)">Operation::Result</a>)</span>
&mdash;    <div class='inline'>
<p>The result of the operation.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L516-L522'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='516' data-end='522'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 516</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_cursor_id'>set_cursor_id</span>(<span class='id identifier rubyid_result'>result</span>)
  <span class='ivar'>@cursor_id</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_cursor_id'>cursor_id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>BSON</span><span class='op'>::</span><span class='const'>Int64</span>)
                 <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_cursor_id'>cursor_id</span>.<span class='id identifier rubyid_value'>value</span>
               <span class='kw'>else</span>
                 <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_cursor_id'>cursor_id</span>
               <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_return-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_return</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the number of documents to return. Used on 3.0 and lower server versions.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the number to return.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cursor'>cursor</span>.<span class='id identifier rubyid_to_return'>to_return</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The number of documents to return.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.2.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L360-L362'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='360' data-end='362'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 360</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_return'>to_return</span>
  <span class='id identifier rubyid_use_limit?'><a href="#use_limit%3F-instance_method" title="Mongo::Cursor#use_limit? (method)">use_limit?</a></span> <span class='op'>?</span> <span class='ivar'>@remaining</span> <span class='op'>:</span> (<span class='id identifier rubyid_batch_size'><a href="#batch_size-instance_method" title="Mongo::Cursor#batch_size (method)">batch_size</a></span> <span class='op'>||</span> <span class='int'>0</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_next-instance_method">
  <h3 class='signature nodoc'>
    #<strong>try_next</strong>  &#x21d2; <code>BSON::Document</code> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method is experimental and subject to change.</p>
</div>
  </div>


<p>Return one document from the query, if one is available.</p>

<p>This method will wait up to max_await_time_ms milliseconds for changes from the server, and if no changes are received it will return nil. If there are no more documents to return from the server, or if we have exhausted the cursor, it will raise a StopIteration exception.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>A document.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>StopIteration</code>)</span>
&mdash;    <div class='inline'>
<p>Raised on the calls after the cursor had been completely iterated.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L205-L251'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='205' data-end='251'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 205</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_next'>try_next</span>
  <span class='kw'>if</span> <span class='ivar'>@documents</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='comment'># Since published versions of Mongoid have a copy of old driver cursor
</span>    <span class='comment'># code, our dup call in #process isn&#39;t invoked when Mongoid query
</span>    <span class='comment'># cache is active. Work around that by also calling dup here on
</span>    <span class='comment'># the result of #process which might come out of Mongoid&#39;s code.
</span>    <span class='ivar'>@documents</span> <span class='op'>=</span> <span class='id identifier rubyid_process'><a href="#process-instance_method" title="Mongo::Cursor#process (method)">process</a></span>(<span class='ivar'>@initial_result</span>).<span class='id identifier rubyid_dup'>dup</span>
    <span class='comment'># the documents here can be an empty array, hence
</span>    <span class='comment'># we may end up issuing a getMore in the first try_next call
</span>  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@documents</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='comment'># On empty batches, we cache the batch resume token
</span>    <span class='id identifier rubyid_cache_batch_resume_token'><a href="#cache_batch_resume_token-instance_method" title="Mongo::Cursor#cache_batch_resume_token (method)">cache_batch_resume_token</a></span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Cursor#closed? (method)">closed?</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_exhausted?'><a href="#exhausted%3F-instance_method" title="Mongo::Cursor#exhausted? (method)">exhausted?</a></span>
        <span class='id identifier rubyid_close'><a href="#close-instance_method" title="Mongo::Cursor#close (method)">close</a></span>
        <span class='ivar'>@fully_iterated</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StopIteration</span>
      <span class='kw'>end</span>
      <span class='ivar'>@documents</span> <span class='op'>=</span> <span class='id identifier rubyid_get_more'><a href="#get_more-instance_method" title="Mongo::Cursor#get_more (method)">get_more</a></span>
    <span class='kw'>else</span>
      <span class='ivar'>@fully_iterated</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StopIteration</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># cursor is closed here
</span>    <span class='comment'># keep documents as an empty array
</span>  <span class='kw'>end</span>

  <span class='comment'># If there is at least one document, cache its _id
</span>  <span class='kw'>if</span> <span class='ivar'>@documents</span>[<span class='int'>0</span>]
    <span class='id identifier rubyid_cache_resume_token'><a href="#cache_resume_token-instance_method" title="Mongo::Cursor#cache_resume_token (method)">cache_resume_token</a></span>(<span class='ivar'>@documents</span>[<span class='int'>0</span>])
  <span class='kw'>end</span>

  <span class='comment'># Cache the batch resume token if we are iterating
</span>  <span class='comment'># over the last document, or if the batch is empty
</span>  <span class='kw'>if</span> <span class='ivar'>@documents</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>&lt;=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_cache_batch_resume_token'><a href="#cache_batch_resume_token-instance_method" title="Mongo::Cursor#cache_batch_resume_token (method)">cache_batch_resume_token</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Cursor#closed? (method)">closed?</a></span>
      <span class='ivar'>@fully_iterated</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='ivar'>@documents</span>.<span class='id identifier rubyid_shift'>shift</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unregister-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>unregister</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cursor.rb#L494-L496'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='494' data-end='496'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cursor.rb', line 494</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unregister'>unregister</span>
  <span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_unregister_cursor'>unregister_cursor</span>(<span class='ivar'>@cursor_id</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>