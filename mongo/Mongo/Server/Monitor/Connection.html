<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Server::Monitor::Connection &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Server::Monitor::Connection",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Mongo master</a> &raquo; 
      <a href='../../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../../Server.html" title="Mongo::Server (class)">Server</a> &raquo; 
        <a class='nodoc' href="../Monitor.html" title="Mongo::Server::Monitor (class)">Monitor</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Connection&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Server::Monitor::Connection  <span class='private note title'>Private</span>
</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <span class='nodoc_h'>Mongo::Server::PushMonitor::Connection</span>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>::Mongo::Server::ConnectionCommon</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a>,
          <a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>::Mongo::Server::ConnectionCommon</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)">Mongo::Server::ConnectionCommon</a></span>
        <ul class='fullTree'>
          <li>Object</li>
          <li class='next'><a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)">Mongo::Server::ConnectionCommon</a></li>
          <li class='next'>Mongo::Server::Monitor::Connection</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L26'>lib/mongo/server/monitor/connection.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This class models the monitor connections and their behavior.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
  <h3 class='inherited'><a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>::Mongo::Server::ConnectionCommon</code></a> - Inherited</h3>
  <p  class='inherited'>
    <a href="../ConnectionCommon.html#HELLO_DOC-constant" title="Mongo::Server::ConnectionCommon::HELLO_DOC (constant)">HELLO_DOC</a>, 
    <a href="../ConnectionCommon.html#LEGACY_HELLO_DOC-constant" title="Mongo::Server::ConnectionCommon::LEGACY_HELLO_DOC (constant)">LEGACY_HELLO_DOC</a>
  </p>
  <h3 class='inherited'><a href="../../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../../Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">PREFIX</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(address, options = {})  &#x21d2; Connection </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new connection object to the specified target address with the specified options.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#address-instance_method" title="#address (instance method)">#<strong>address</strong>  &#x21d2; Mongo::Address </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#server_connection_id-instance_method" title="#server_connection_id (instance method)">#<strong>server_connection_id</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro priv nodoc'>
      <a href="#hello_ok%3F-instance_method" title="#hello_ok? (instance method)">#<strong>hello_ok?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited'><a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>::Mongo::Server::ConnectionCommon</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="../ConnectionCommon.html#compressor-instance_method" title="Mongo::Server::ConnectionCommon#compressor (method)">#compressor</a></td>
      <td><div class='inline'><p>The compressor negotiated during the handshake for this connection, if any.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro deprecated' href="../ConnectionCommon.html#connected%3F-instance_method" title="Mongo::Server::ConnectionCommon#connected? (method)">#connected?</a></td>
      <td><div class='inline'><p>Determine if the connection is currently connected.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro nodoc' href="../ConnectionCommon.html#pid-instance_method" title="Mongo::Server::ConnectionCommon#pid (method)">#pid</a>,
        <a class='i_m ro priv' href="../ConnectionCommon.html#socket-instance_method" title="Mongo::Server::ConnectionCommon#socket (method)">#socket</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_document-instance_method" title="#check_document (instance method)">#<strong>check_document</strong>  &#x21d2; BSON::Document </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Build a document that should be used for connection check.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#connect!-instance_method" title="#connect! (instance method)">#<strong>connect!</strong>  &#x21d2; true </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Establishes a network connection to the target address.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#disconnect!-instance_method" title="#disconnect! (instance method)">#<strong>disconnect!</strong>(options = nil)  &#x21d2; true </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Disconnect the connection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#dispatch-instance_method" title="#dispatch (instance method)">#<strong>dispatch</strong>(message)  &#x21d2; Protocol::Message </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a message and returns the result.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#dispatch_bytes-instance_method" title="#dispatch_bytes (instance method)">#<strong>dispatch_bytes</strong>(bytes, **opts)  &#x21d2; Protocol::Message </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sends a preserialized message and returns the result.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#handshake!-instance_method" title="#handshake! (instance method)">#<strong>handshake!</strong>  &#x21d2; BSON::Document </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Send handshake command to connected host and validate the response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#read_response-instance_method" title="#read_response (instance method)">#<strong>read_response</strong>(**opts)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#socket_timeout-instance_method" title="#socket_timeout (instance method)">#<strong>socket_timeout</strong>  &#x21d2; Float </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the monitoring socket timeout.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#write_bytes-instance_method" title="#write_bytes (instance method)">#<strong>write_bytes</strong>(bytes)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#add_server_connection_id-instance_method" title="#add_server_connection_id (instance method)">#<strong>add_server_connection_id</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#set_hello_ok!-instance_method" title="#set_hello_ok! (instance method)">#<strong>set_hello_ok!</strong>(reply)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Update @hello_ok flag according to server reply to legacy hello command.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></td>
      <td><div class='inline'><p>Convenience method to log debug messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></td>
      <td><div class='inline'><p>Convenience method to log error messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></td>
      <td><div class='inline'><p>Convenience method to log fatal messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></td>
      <td><div class='inline'><p>Convenience method to log info messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></td>
      <td><div class='inline'><p>Convenience method to log warn messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../../Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></td>
      <td><div class='inline'><p>Get the logger instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../../Loggable.html#_mongo_log_prefix-instance_method" title="Mongo::Loggable#_mongo_log_prefix (method)">#_mongo_log_prefix</a>,
        <a class='i_m priv' href="../../Loggable.html#format_message-instance_method" title="Mongo::Loggable#format_message (method)">#format_message</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>::Mongo::Server::ConnectionCommon</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../ConnectionCommon.html#handshake_command-instance_method" title="Mongo::Server::ConnectionCommon#handshake_command (method)">#handshake_command</a></td>
      <td><div class='inline'><p>Build a command that should be used for connection handshake.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../ConnectionCommon.html#handshake_document-instance_method" title="Mongo::Server::ConnectionCommon#handshake_document (method)">#handshake_document</a></td>
      <td><div class='inline'><p>Build a document that should be used for connection handshake.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../ConnectionCommon.html#add_server_diagnostics-instance_method" title="Mongo::Server::ConnectionCommon#add_server_diagnostics (method)">#add_server_diagnostics</a></td>
      <td><div class='inline'><p>Yields to the block and, if the block raises an exception, adds a note to the exception with the address of the specified server.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../ConnectionCommon.html#ensure_connected-instance_method" title="Mongo::Server::ConnectionCommon#ensure_connected (method)">#ensure_connected</a>,
        <a class='i_m priv' href="../ConnectionCommon.html#set_compressor!-instance_method" title="Mongo::Server::ConnectionCommon#set_compressor! (method)">#set_compressor!</a>,
        <a class='i_m priv' href="../ConnectionCommon.html#ssl_options-instance_method" title="Mongo::Server::ConnectionCommon#ssl_options (method)">#ssl_options</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="address-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>address</strong>  &#x21d2; <a href="../../Address.html" title="Mongo::Address (class)">Mongo::Address</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Address.html" title="Mongo::Address (class)">Mongo::Address</a>)</span>
&mdash;    <div class='inline'>
<p>address The address to connect to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L74-L74'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='74' data-end='74'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 74</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="hello_ok?-instance_method">
  <h3 class='signature ro priv  nodoc'>
    #<strong>hello_ok?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L269-L271'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='269' data-end='271'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 269</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_hello_ok?'>hello_ok?</span>
  <span class='ivar'>@hello_ok</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="options-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>options</strong>  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>options The passed in options.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L71-L71'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='71'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_options'>options</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="server_connection_id-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>server_connection_id</strong>  &#x21d2; <code>Integer</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>server_connection_id The server connection id.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L90-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='90' data-end='90'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 90</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_server_connection_id'>server_connection_id</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="add_server_connection_id-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>add_server_connection_id</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L250-L258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='250' data-end='258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 250</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_server_connection_id'>add_server_connection_id</span>
  <span class='kw'>yield</span>
<span class='kw'>rescue</span> <span class='const'><a href="../../../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="../../Error.html" title="Mongo::Error (class)">Error</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_server_connection_id'><a href="#server_connection_id-instance_method" title="Mongo::Server::Monitor::Connection#server_connection_id (method)">server_connection_id</a></span>
    <span class='id identifier rubyid_note'>note</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sconn:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_connection_id'><a href="#server_connection_id-instance_method" title="Mongo::Server::Monitor::Connection#server_connection_id (method)">server_connection_id</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_add_note'>add_note</span>(<span class='id identifier rubyid_note'>note</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_e'>e</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_document-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_document</strong>  &#x21d2; <code>BSON::Document</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Build a document that should be used for connection check.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code>)</span>
&mdash;    <div class='inline'>
<p>Document that should be sent to a server for connection check.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L229-L246'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='229' data-end='246'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 229</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_document'>check_document</span>
  <span class='id identifier rubyid_server_api'>server_api</span> <span class='op'>=</span> <span class='ivar'>@app_metadata</span>.<span class='id identifier rubyid_server_api'>server_api</span> <span class='op'>||</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span>]
  <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_hello_ok?'><a href="#hello_ok%3F-instance_method" title="Mongo::Server::Monitor::Connection#hello_ok? (method)">hello_ok?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_server_api'>server_api</span>
    <span class='id identifier rubyid__doc'>_doc</span> <span class='op'>=</span> <span class='const'><a href="../ConnectionCommon.html#HELLO_DOC-constant" title="Mongo::Server::ConnectionCommon::HELLO_DOC (constant)">HELLO_DOC</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_server_api'>server_api</span>
      <span class='id identifier rubyid__doc'>_doc</span> <span class='op'>=</span> <span class='id identifier rubyid__doc'>_doc</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='const'><a href="../../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_transform_server_api'>transform_server_api</span>(<span class='id identifier rubyid_server_api'>server_api</span>))
    <span class='kw'>end</span>
    <span class='id identifier rubyid__doc'>_doc</span>
  <span class='kw'>else</span>
    <span class='const'><a href="../ConnectionCommon.html#LEGACY_HELLO_DOC-constant" title="Mongo::Server::ConnectionCommon::LEGACY_HELLO_DOC (constant)">LEGACY_HELLO_DOC</a></span>
  <span class='kw'>end</span>
  <span class='comment'># compressors must be set to maintain correct compression status
</span>  <span class='comment'># in the server description. See RUBY-2427
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_compressors'>compressors</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_compressors'>compressors</span>]
    <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>compression:</span> <span class='id identifier rubyid_compressors'>compressors</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_doc'>doc</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connect!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>connect!</strong>  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method mutates the connection class by setting a socket if one previously did not exist.</p>
</div>
  </div>


<p>Establishes a network connection to the target address.</p>

<p>If the connection is already established, this method does nothing.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Connect to the host.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_connection'><a href="../Monitor.html#connection-instance_method" title="Mongo::Server::Monitor#connection (method)">connection</a></span>.<span class='id identifier rubyid_connect!'>connect!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>If the connection succeeded.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L158-L168'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='158' data-end='168'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 158</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect!'>connect!</span>
  <span class='kw'>if</span> <span class='ivar'>@socket</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Monitoring connection already connected</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='id identifier rubyid_add_server_diagnostics'>add_server_diagnostics</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_address'><a href="#address-instance_method" title="Mongo::Server::Monitor::Connection#address (method)">address</a></span>.<span class='id identifier rubyid_socket'>socket</span>(<span class='id identifier rubyid_socket_timeout'><a href="#socket_timeout-instance_method" title="Mongo::Server::Monitor::Connection#socket_timeout (method)">socket_timeout</a></span><span class='comma'>,</span> <span class='id identifier rubyid_ssl_options'>ssl_options</span>.<span class='id identifier rubyid_merge'>merge</span>(
      <span class='label'>connection_address:</span> <span class='id identifier rubyid_address'><a href="#address-instance_method" title="Mongo::Server::Monitor::Connection#address (method)">address</a></span><span class='comma'>,</span> <span class='label'>monitor:</span> <span class='kw'>true</span>))
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disconnect!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>disconnect!</strong>(options = nil)  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method mutates the connection by setting the socket to nil if the closing succeeded.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method accepts an options argument for compatibility with Server::Connections. However, all options are ignored.</p>
</div>
  </div>


<p>Disconnect the connection.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Disconnect from the host.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_connection'><a href="../Monitor.html#connection-instance_method" title="Mongo::Server::Monitor#connection (method)">connection</a></span>.<span class='id identifier rubyid_disconnect!'>disconnect!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>If the disconnect succeeded.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L184-L190'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='184' data-end='190'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 184</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect!'>disconnect!</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span>
    <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_close'><a href="../../Server.html#close-instance_method" title="Mongo::Server#close (method)">close</a></span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
    <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dispatch-instance_method">
  <h3 class='signature nodoc'>
    #<strong>dispatch</strong>(message)  &#x21d2; <a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Protocol::Message</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a message and returns the result.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>message</span>
    <span class='type'>(<a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Protocol::Message</a>)</span>
&mdash;    <div class='inline'>
<p>The message to send.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Protocol::Message</a>)</span>
&mdash;    <div class='inline'>
<p>The result.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L97-L99'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='97' data-end='99'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 97</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dispatch'>dispatch</span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='id identifier rubyid_dispatch_bytes'><a href="#dispatch_bytes-instance_method" title="Mongo::Server::Monitor::Connection#dispatch_bytes (method)">dispatch_bytes</a></span>(<span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_serialize'>serialize</span>.<span class='id identifier rubyid_to_s'><a href="../Monitor.html#to_s-instance_method" title="Mongo::Server::Monitor#to_s (method)">to_s</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dispatch_bytes-instance_method">
  <h3 class='signature nodoc'>
    #<strong>dispatch_bytes</strong>(bytes, **opts)  &#x21d2; <a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Protocol::Message</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sends a preserialized message and returns the result.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>bytes</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The serialized message to send.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>**opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:read_socket_timeout</span>
          <span class='type'>(<code>Numeric</code>)</span>
            &mdash; <div class='inline'>
<p>The timeout to use for each read operation.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Protocol::Message</a>)</span>
&mdash;    <div class='inline'>
<p>The result.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L109-L114'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='109' data-end='114'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 109</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dispatch_bytes'>dispatch_bytes</span>(<span class='id identifier rubyid_bytes'>bytes</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span>)
  <span class='id identifier rubyid_write_bytes'><a href="#write_bytes-instance_method" title="Mongo::Server::Monitor::Connection#write_bytes (method)">write_bytes</a></span>(<span class='id identifier rubyid_bytes'>bytes</span>)
  <span class='id identifier rubyid_read_response'><a href="#read_response-instance_method" title="Mongo::Server::Monitor::Connection#read_response (method)">read_response</a></span>(
    <span class='label'>socket_timeout:</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_socket_timeout'>read_socket_timeout</span>]<span class='comma'>,</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handshake!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>handshake!</strong>  &#x21d2; <code>BSON::Document</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Send handshake command to connected host and validate the response.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code>)</span>
&mdash;    <div class='inline'>
<p>Handshake response from server</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../../Error.html" title="Mongo::Error (class)">Mongo::Error</a>)</span>
&mdash;    <div class='inline'>
<p>If handshake failed.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L197-L221'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='197' data-end='221'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 197</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handshake!'>handshake!</span>
  <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='id identifier rubyid_handshake_command'>handshake_command</span>(
    <span class='id identifier rubyid_handshake_document'>handshake_document</span>(
      <span class='ivar'>@app_metadata</span><span class='comma'>,</span>
      <span class='label'>server_api:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span>]
    )
  )
  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='id identifier rubyid_command'>command</span>.<span class='id identifier rubyid_serialize'>serialize</span>.<span class='id identifier rubyid_to_s'><a href="../Monitor.html#to_s-instance_method" title="Mongo::Server::Monitor#to_s (method)">to_s</a></span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_dispatch_bytes'><a href="#dispatch_bytes-instance_method" title="Mongo::Server::Monitor::Connection#dispatch_bytes (method)">dispatch_bytes</a></span>(<span class='id identifier rubyid_payload'>payload</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><a href="../../Operation.html" title="Mongo::Operation (module)">Operation</a></span><span class='op'>::</span><span class='const'><a href="../../Operation/Result.html" title="Mongo::Operation::Result (class)">Result</a></span>.<span class='id identifier rubyid_new'><a href="../../Operation/Result.html#new-class_method" title="Mongo::Operation::Result.new (method)">new</a></span>(<span class='id identifier rubyid_message'>message</span>)
  <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_validate!'>validate!</span>
  <span class='id identifier rubyid_reply'>reply</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_set_compressor!'>set_compressor!</span>(<span class='id identifier rubyid_reply'>reply</span>)
  <span class='id identifier rubyid_set_hello_ok!'><a href="#set_hello_ok!-instance_method" title="Mongo::Server::Monitor::Connection#set_hello_ok! (method)">set_hello_ok!</a></span>(<span class='id identifier rubyid_reply'>reply</span>)
  <span class='ivar'>@server_connection_id</span> <span class='op'>=</span> <span class='id identifier rubyid_reply'>reply</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>connectionId</span><span class='tstring_end'>&#39;</span></span>]
  <span class='id identifier rubyid_reply'>reply</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exc'>exc</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to handshake with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_address'><a href="#address-instance_method" title="Mongo::Server::Monitor::Connection#address (method)">address</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><a href="../../Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_warn_bg_exception'>warn_bg_exception</span>(<span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_exc'>exc</span><span class='comma'>,</span>
    <span class='label'>logger:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_logger'>logger</span>]<span class='comma'>,</span>
    <span class='label'>log_prefix:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_log_prefix'>log_prefix</span>]<span class='comma'>,</span>
    <span class='label'>bg_error_backtrace:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_bg_error_backtrace'>bg_error_backtrace</span>]<span class='comma'>,</span>
  )
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_response-instance_method">
  <h3 class='signature nodoc'>
    #<strong>read_response</strong>(**opts)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>**opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:socket_timeout</span>
          <span class='type'>(<code>Numeric</code>)</span>
            &mdash; <div class='inline'>
<p>The timeout to use for each read operation.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L130-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='130' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 130</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_response'>read_response</span>(<span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_connected?'><a href="../../Server.html#connected%3F-instance_method" title="Mongo::Server#connected? (method)">connected?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to read on an unconnected connection </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_add_server_connection_id'><a href="#add_server_connection_id-instance_method" title="Mongo::Server::Monitor::Connection#add_server_connection_id (method)">add_server_connection_id</a></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_add_server_diagnostics'>add_server_diagnostics</span> <span class='kw'>do</span>
      <span class='const'><a href="../../Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Message</a></span>.<span class='id identifier rubyid_deserialize'><a href="../../Protocol/Message.html#deserialize-class_method" title="Mongo::Protocol::Message.deserialize (method)">deserialize</a></span>(<span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span>
        <span class='const'><a href="../../Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="../../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Message</a></span><span class='op'>::</span><span class='const'><a href="../../Protocol/Message.html#MAX_MESSAGE_SIZE-constant" title="Mongo::Protocol::Message::MAX_MESSAGE_SIZE (constant)">MAX_MESSAGE_SIZE</a></span><span class='comma'>,</span>
        <span class='kw'>nil</span><span class='comma'>,</span>
        <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_hello_ok!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>set_hello_ok!</strong>(reply)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Update @hello_ok flag according to server reply to legacy hello command. The flag will be set to true if connected server supports hello command, otherwise the flag will be set to false.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>reply</span>
    <span class='type'>(<code>BSON::Document</code>)</span>
&mdash;    <div class='inline'>
<p><a href="../../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> reply to legacy hello command.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L265-L267'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='265' data-end='267'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 265</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_hello_ok!'>set_hello_ok!</span>(<span class='id identifier rubyid_reply'>reply</span>)
  <span class='ivar'>@hello_ok</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_reply'>reply</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_helloOk'>helloOk</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="socket_timeout-instance_method">
  <h3 class='signature nodoc'>
    #<strong>socket_timeout</strong>  &#x21d2; <code>Float</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the monitoring socket timeout.</p>

<p>Note that monitoring connections use the connect timeout value as the socket timeout value. See the <a href="../../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Discovery and <a href="../../Monitoring.html" title="Mongo::Monitoring (class)"><code>::Mongo::Monitoring</code></a> specification for details.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>The socket timeout in seconds.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.4.3</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L85-L87'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='85' data-end='87'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 85</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_socket_timeout'>socket_timeout</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Server::Monitor::Connection#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span>] <span class='op'>||</span> <span class='const'><a href="../../Server.html" title="Mongo::Server (class)">Server</a></span><span class='op'>::</span><span class='const'><a href="../../Server.html#CONNECT_TIMEOUT-constant" title="Mongo::Server::CONNECT_TIMEOUT (constant)">CONNECT_TIMEOUT</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_bytes-instance_method">
  <h3 class='signature nodoc'>
    #<strong>write_bytes</strong>(bytes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/monitor/connection.rb#L116-L126'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='116' data-end='126'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/monitor/connection.rb', line 116</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_bytes'>write_bytes</span>(<span class='id identifier rubyid_bytes'>bytes</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_connected?'><a href="../../Server.html#connected%3F-instance_method" title="Mongo::Server#connected? (method)">connected?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to dispatch on an unconnected connection </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_add_server_connection_id'><a href="#add_server_connection_id-instance_method" title="Mongo::Server::Monitor::Connection#add_server_connection_id (method)">add_server_connection_id</a></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_add_server_diagnostics'>add_server_diagnostics</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_bytes'>bytes</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>