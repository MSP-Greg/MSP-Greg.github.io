<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Server::AppMetadata::Truncator &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Server::AppMetadata::Truncator",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Mongo master</a> &raquo; 
      <a href='../../../_index.html#alpha_T'>Index (T)</a> &raquo; 
        <a href="../../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../../Server.html" title="Mongo::Server (class)">Server</a> &raquo; 
        <a class='nodoc' href="../AppMetadata.html" title="Mongo::Server::AppMetadata (class)">AppMetadata</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Truncator&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Server::AppMetadata::Truncator  <span class='private note title'>Private</span>
</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L24'>lib/mongo/server/app_metadata/truncator.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Implements the metadata truncation logic described in the handshake spec.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='MAX_DOCUMENT_SIZE-constant' class='summary_signature nodoc'>MAX_DOCUMENT_SIZE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The max application metadata document byte size.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L29-L29'># File 'lib/mongo/server/app_metadata/truncator.rb', line 29</a>    <pre class='code ruby'><span class='int'>512</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(document)  &#x21d2; Truncator </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new <code>Truncator</code> instance and tries enforcing the maximum document size on the given document.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#document-instance_method" title="#document (instance method)">#<strong>document</strong>  &#x21d2; BSON::Document </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#ok%3F-instance_method" title="#ok? (instance method)">#<strong>ok?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the document fits within the required maximum document size.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  &#x21d2; Integer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>The current size of the document, in bytes, as a serialized BSON document.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#excess-instance_method" title="#excess (instance method)">#<strong>excess</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>How many extra bytes must be trimmed before the document may be considered #ok?.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate!-instance_method" title="#try_truncate! (instance method)">#<strong>try_truncate!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempt to truncate the document using the documented metadata priorities (see the handshake specification).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate_env!-instance_method" title="#try_truncate_env! (instance method)">#<strong>try_truncate_env!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove the <code>{:env</code>} key from the document.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate_env_fields!-instance_method" title="#try_truncate_env_fields! (instance method)">#<strong>try_truncate_env_fields!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempt to truncate the keys in the <code>{:env</code>} subdocument.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate_hash-instance_method" title="#try_truncate_hash (instance method)">#<strong>try_truncate_hash</strong>(hash, reserved: [])  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>A helper method for removing the keys of a Hash (in-place) until the document is the necessary size.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate_os_fields!-instance_method" title="#try_truncate_os_fields! (instance method)">#<strong>try_truncate_os_fields!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempt to truncate the keys in the <code>{:os</code>} subdocument.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate_platform!-instance_method" title="#try_truncate_platform! (instance method)">#<strong>try_truncate_platform!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempt to truncate or remove the <code>{:platform</code>} key from the document.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#try_truncate_string-instance_method" title="#try_truncate_string (instance method)">#<strong>try_truncate_string</strong>(string)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>A helper method for truncating a string (in-place) by whatever <code>{#excess</code>} is required.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="document-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>document</strong>  &#x21d2; <code>BSON::Document</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code>)</span>
&mdash;    <div class='inline'>
<p>the document being truncated.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L26-L26'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='26' data-end='26'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 26</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_document'>document</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ok?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>ok?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the document fits within the required maximum document size.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>if the document is okay or not.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L56-L58'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='56' data-end='58'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 56</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ok?'>ok?</span>
  <span class='id identifier rubyid_size'><a href="#size-instance_method" title="Mongo::Server::AppMetadata::Truncator#size (method)">size</a></span> <span class='op'>&lt;=</span> <span class='const'><a href="#MAX_DOCUMENT_SIZE-constant" title="Mongo::Server::AppMetadata::Truncator::MAX_DOCUMENT_SIZE (constant)">MAX_DOCUMENT_SIZE</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="excess-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>excess</strong>  &#x21d2; <code>Integer</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>How many extra bytes must be trimmed before the document may be considered #ok?.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>how many bytes larger the document is than the maximum document size.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L67-L69'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='67' data-end='69'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 67</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_excess'>excess</span>
  <span class='id identifier rubyid_size'><a href="#size-instance_method" title="Mongo::Server::AppMetadata::Truncator#size (method)">size</a></span> <span class='op'>-</span> <span class='const'><a href="#MAX_DOCUMENT_SIZE-constant" title="Mongo::Server::AppMetadata::Truncator::MAX_DOCUMENT_SIZE (constant)">MAX_DOCUMENT_SIZE</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="size-instance_method">
  <h3 class='signature nodoc'>
    #<strong>size</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The current size of the document, in bytes, as a serialized BSON document.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>the size of the document</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L49-L51'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='49' data-end='51'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 49</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='ivar'>@document</span>.<span class='id identifier rubyid_to_bson'>to_bson</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_length'>length</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempt to truncate the document using the documented metadata priorities (see the handshake specification).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L73-L79'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='73' data-end='79'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 73</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate!'>try_truncate!</span>
  <span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='words_sep'> </span><span class='tstring_content'>env_fields</span><span class='words_sep'> </span><span class='tstring_content'>os_fields</span><span class='words_sep'> </span><span class='tstring_content'>env</span><span class='words_sep'> </span><span class='tstring_content'>platform</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_target'>target</span><span class='op'>|</span>
    <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_ok?'><a href="#ok%3F-instance_method" title="Mongo::Server::AppMetadata::Truncator#ok? (method)">ok?</a></span>

    <span class='id identifier rubyid_send'>send</span>(<span class='symbeg'>:&quot;</span><span class='tstring_content'>try_truncate_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_target'>target</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate_env!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate_env!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove the <code>{:env</code>} key from the document.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L98-L100'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='98' data-end='100'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 98</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate_env!'>try_truncate_env!</span>
  <span class='ivar'>@document</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_env'>env</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate_env_fields!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate_env_fields!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempt to truncate the keys in the <code>{:env</code>} subdocument.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L88-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='88' data-end='90'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 88</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate_env_fields!'>try_truncate_env_fields!</span>
  <span class='id identifier rubyid_try_truncate_hash'><a href="#try_truncate_hash-instance_method" title="Mongo::Server::AppMetadata::Truncator#try_truncate_hash (method)">try_truncate_hash</a></span>(<span class='ivar'>@document</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_env'>env</span>]<span class='comma'>,</span> <span class='label'>reserved:</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate_hash-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate_hash</strong>(hash, reserved: [])   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>the hash parameter is modified in-place.</p>
</div>
  </div>


<p>A helper method for removing the keys of a Hash (in-place) until the document is the necessary size. The keys are considered in order (using the Hash’s native key ordering), and each will be removed from the hash in turn, until the document is the necessary size.</p>

<p>Any keys in the <code>{reserved</code>} list will be ignored.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>hash</span>
    <span class='type'>(<code>Hash</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>the Hash instance to consider.</p>
</div>
  </li>
  <li>
    <span class='name'>reserved</span>
    <span class='type'>(<code>Array</code>)</span>
&mdash;    <div class='inline'>
<p>the list of keys to ignore in the hash.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L127-L138'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='127' data-end='138'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 127</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate_hash'>try_truncate_hash</span>(<span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='label'>reserved:</span> [])
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_hash'>hash</span>

  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_keys'>keys</span> <span class='op'>-</span> <span class='id identifier rubyid_reserved'>reserved</span>
  <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_key'>key</span>)

    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_ok?'><a href="#ok%3F-instance_method" title="Mongo::Server::AppMetadata::Truncator#ok? (method)">ok?</a></span>
  <span class='kw'>end</span>

  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate_os_fields!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate_os_fields!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempt to truncate the keys in the <code>{:os</code>} subdocument.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L93-L95'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='93' data-end='95'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 93</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate_os_fields!'>try_truncate_os_fields!</span>
  <span class='id identifier rubyid_try_truncate_hash'><a href="#try_truncate_hash-instance_method" title="Mongo::Server::AppMetadata::Truncator#try_truncate_hash (method)">try_truncate_hash</a></span>(<span class='ivar'>@document</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_os'>os</span>]<span class='comma'>,</span> <span class='label'>reserved:</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='words_sep'> </span><span class='tstring_content'>type</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate_platform!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate_platform!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempt to truncate or remove the <code>{:platform</code>} key from the document.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L83-L85'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='83' data-end='85'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 83</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate_platform!'>try_truncate_platform!</span>
  <span class='ivar'>@document</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_platform'><a href="../AppMetadata.html#platform-instance_method" title="Mongo::Server::AppMetadata#platform (method)">platform</a></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_try_truncate_string'><a href="#try_truncate_string-instance_method" title="Mongo::Server::AppMetadata::Truncator#try_truncate_string (method)">try_truncate_string</a></span>(<span class='ivar'>@document</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_platform'><a href="../AppMetadata.html#platform-instance_method" title="Mongo::Server::AppMetadata#platform (method)">platform</a></span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_truncate_string-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>try_truncate_string</strong>(string)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>the parameter is modified in-place.</p>
</div>
  </div>


<p>A helper method for truncating a string (in-place) by whatever <code>{#excess</code>} is required.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>string</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>the string value to truncate.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/app_metadata/truncator.rb#L108-L114'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='108' data-end='114'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/app_metadata/truncator.rb', line 108</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_truncate_string'>try_truncate_string</span>(<span class='id identifier rubyid_string'>string</span>)
  <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='id identifier rubyid_string'>string</span><span class='op'>&amp;.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>||</span> <span class='int'>0</span>

  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_excess'><a href="#excess-instance_method" title="Mongo::Server::AppMetadata::Truncator#excess (method)">excess</a></span> <span class='op'>&gt;</span> <span class='id identifier rubyid_length'>length</span>

  <span class='id identifier rubyid_string'>string</span>[(<span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='id identifier rubyid_excess'><a href="#excess-instance_method" title="Mongo::Server::AppMetadata::Truncator#excess (method)">excess</a></span>)<span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>