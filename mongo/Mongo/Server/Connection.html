<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Server::Connection &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Server::Connection",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Mongo master</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
        <a href="../Server.html" title="Mongo::Server (class)">Server</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Connection&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Server::Connection</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable,
          <a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)"><code>ConnectionBase</code></a>,
          Forwardable,
          <a href="ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>ConnectionCommon</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../Id.html" title="Mongo::Id (module)"><code>::Mongo::Id</code></a>,
          <a href="../Retryable.html" title="Mongo::Retryable (module)"><code>::Mongo::Retryable</code></a>,
          <a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)"><code>ConnectionBase</code></a>,
          <a href="../Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)"><code>::Mongo::Monitoring::Publishable</code></a>,
          <a href="../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a>,
          <a href="ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>ConnectionCommon</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)">Mongo::Server::ConnectionBase</a></span>
        <ul class='fullTree'>
          <li>Object</li>
          <li class='next'><a href="ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)">Mongo::Server::ConnectionCommon</a></li>
          <li class='next'><a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)">Mongo::Server::ConnectionBase</a></li>
          <li class='next'>Mongo::Server::Connection</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L24'>lib/mongo/server/connection.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This class models the socket connections for servers and their behavior.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='PING-constant' class='summary_signature deprecated'>PING =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

<p>The ping command.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L35-L35'># File 'lib/mongo/server/connection.rb', line 35</a>    <pre class='code ruby'>{ <span class='symbeg'>:</span><span class='id identifier rubyid_ping'><a href="#ping-instance_method" title="Mongo::Server::Connection#ping (method)">ping</a></span> <span class='op'>=&gt;</span> <span class='int'>1</span> }.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='PING_BYTES-constant' class='summary_signature deprecated'>PING_BYTES =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

<p>The ping message as raw bytes.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L63-L63'># File 'lib/mongo/server/connection.rb', line 63</a>    <pre class='code ruby'><span class='const'><a href="#PING_MESSAGE-constant" title="Mongo::Server::Connection::PING_MESSAGE (constant)">PING_MESSAGE</a></span>.<span class='id identifier rubyid_serialize'><a href="ConnectionBase.html#serialize-instance_method" title="Mongo::Server::ConnectionBase#serialize (method)">serialize</a></span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='PING_MESSAGE-constant' class='summary_signature deprecated'>PING_MESSAGE =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

<p>Ping message.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L49-L49'># File 'lib/mongo/server/connection.rb', line 49</a>    <pre class='code ruby'><span class='const'><a href="../Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="../Protocol/Query.html" title="Mongo::Protocol::Query (class)">Query</a></span>.<span class='id identifier rubyid_new'><a href="../Protocol/Query.html#new-class_method" title="Mongo::Protocol::Query.new (method)">new</a></span>(<span class='const'><a href="../Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="../Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span><span class='comma'>,</span> <span class='const'><a href="../Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="../Database.html#COMMAND-constant" title="Mongo::Database::COMMAND (constant)">COMMAND</a></span><span class='comma'>,</span> <span class='const'><a href="#PING-constant" title="Mongo::Server::Connection::PING (constant)">PING</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_limit'>limit</span> <span class='op'>=&gt;</span> <span class='op'>-</span><span class='int'>1</span>)</pre>
  </li>
  <li>
    <span id='PING_OP_MSG-constant' class='summary_signature deprecated'>PING_OP_MSG =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

<p>The ping command for an OP_MSG (server versions &gt;= 3.6).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L42-L42'># File 'lib/mongo/server/connection.rb', line 42</a>    <pre class='code ruby'>{ <span class='symbeg'>:</span><span class='id identifier rubyid_ping'><a href="#ping-instance_method" title="Mongo::Server::Connection#ping (method)">ping</a></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$db</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="../Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="../Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span> }.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='PING_OP_MSG_BYTES-constant' class='summary_signature deprecated'>PING_OP_MSG_BYTES =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

<p>The ping OP_MSG message as raw bytes (server versions &gt;= 3.6).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L70-L70'># File 'lib/mongo/server/connection.rb', line 70</a>    <pre class='code ruby'><span class='const'><a href="#PING_OP_MSG_MESSAGE-constant" title="Mongo::Server::Connection::PING_OP_MSG_MESSAGE (constant)">PING_OP_MSG_MESSAGE</a></span>.<span class='id identifier rubyid_serialize'><a href="ConnectionBase.html#serialize-instance_method" title="Mongo::Server::ConnectionBase#serialize (method)">serialize</a></span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='PING_OP_MSG_MESSAGE-constant' class='summary_signature deprecated'>PING_OP_MSG_MESSAGE =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

<p>Ping message as an OP_MSG (server versions &gt;= 3.6).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L56-L56'># File 'lib/mongo/server/connection.rb', line 56</a>    <pre class='code ruby'><span class='const'><a href="../Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="../Protocol/Msg.html" title="Mongo::Protocol::Msg (class)">Msg</a></span>.<span class='id identifier rubyid_new'><a href="../Protocol/Msg.html#new-class_method" title="Mongo::Protocol::Msg.new (method)">new</a></span>([]<span class='comma'>,</span> {}<span class='comma'>,</span> <span class='const'><a href="#PING_OP_MSG-constant" title="Mongo::Server::Connection::PING_OP_MSG (constant)">PING_OP_MSG</a></span>)</pre>
  </li>
</ul>
  <h3 class='inherited'><a href="ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>ConnectionCommon</code></a> - Inherited</h3>
  <p  class='inherited'>
    <a href="ConnectionCommon.html#HELLO_DOC-constant" title="Mongo::Server::ConnectionCommon::HELLO_DOC (constant)">HELLO_DOC</a>, 
    <a href="ConnectionCommon.html#LEGACY_HELLO_DOC-constant" title="Mongo::Server::ConnectionCommon::LEGACY_HELLO_DOC (constant)">LEGACY_HELLO_DOC</a>
  </p>
  <h3 class='inherited'><a href="../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">PREFIX</a>
  </p>
  <h3 class='inherited'><a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)"><code>ConnectionBase</code></a> - Inherited</h3>
  <p  class='inherited'>
    <a class='nodoc' href="ConnectionBase.html#DEFAULT_MAX_BSON_OBJECT_SIZE-constant" title="Mongo::Server::ConnectionBase::DEFAULT_MAX_BSON_OBJECT_SIZE (constant)">DEFAULT_MAX_BSON_OBJECT_SIZE</a>, 
    <a class='nodoc' href="ConnectionBase.html#MAX_BSON_COMMAND_OVERHEAD-constant" title="Mongo::Server::ConnectionBase::MAX_BSON_COMMAND_OVERHEAD (constant)">MAX_BSON_COMMAND_OVERHEAD</a>, 
    <a class='nodoc' href="ConnectionBase.html#REDUCED_MAX_BSON_SIZE-constant" title="Mongo::Server::ConnectionBase::REDUCED_MAX_BSON_SIZE (constant)">REDUCED_MAX_BSON_SIZE</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(server, options = {})  &#x21d2; Connection </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new connection object to the specified target address with the specified options.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the connection was closed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">#<strong>connected?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the connection was connected and was not interrupted, closed, or had an error raised.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#error%3F-instance_method" title="#error? (instance method)">#<strong>error?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#global_id-instance_method" title="#global_id (instance method)">#<strong>global_id</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>across all connections.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#id-instance_method" title="#id (instance method)">#<strong>id</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>across connections to the same server object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#interrupted%3F-instance_method" title="#interrupted? (instance method)">#<strong>interrupted?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the connection was interrupted.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#last_checkin-instance_method" title="#last_checkin (instance method)">#<strong>last_checkin</strong>  &#x21d2; Time </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#pinned%3F-instance_method" title="#pinned? (instance method)">#<strong>pinned?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the connection is used by a transaction or cursor operations.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)"><code>ConnectionBase</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc' href="ConnectionBase.html#description-instance_method" title="Mongo::Server::ConnectionBase#description (method)">#description</a></td>
      <td><div class='inline'><p>Returns the server description for this connection, derived from the hello response for the handshake performed on this connection.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="ConnectionBase.html#options-instance_method" title="Mongo::Server::ConnectionBase#options (method)">#options</a>,
        <a class='i_m ro nodoc' href="ConnectionBase.html#server-instance_method" title="Mongo::Server::ConnectionBase#server (method)">#server</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)"><code>::Mongo::Monitoring::Publishable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="../Monitoring/Publishable.html#monitoring-instance_method" title="Mongo::Monitoring::Publishable#monitoring (method)">#monitoring</a>,
        <a class='i_m ro priv' href="../Monitoring/Publishable.html#monitoring%3F-instance_method" title="Mongo::Monitoring::Publishable#monitoring? (method)">#monitoring?</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>ConnectionCommon</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="ConnectionCommon.html#compressor-instance_method" title="Mongo::Server::ConnectionCommon#compressor (method)">#compressor</a></td>
      <td><div class='inline'><p>The compressor negotiated during the handshake for this connection, if any.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro deprecated' href="ConnectionCommon.html#connected%3F-instance_method" title="Mongo::Server::ConnectionCommon#connected? (method)">#connected?</a></td>
      <td><div class='inline'><p>Determine if the connection is currently connected.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro nodoc' href="ConnectionCommon.html#pid-instance_method" title="Mongo::Server::ConnectionCommon#pid (method)">#pid</a>,
        <a class='i_m ro priv' href="ConnectionCommon.html#socket-instance_method" title="Mongo::Server::ConnectionCommon#socket (method)">#socket</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#connect!-instance_method" title="#connect! (instance method)">#<strong>connect!</strong>(context = nil)  &#x21d2; true </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Establishes a network connection to the target address.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#connection_pool-instance_method" title="#connection_pool (instance method)">#<strong>connection_pool</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>The connection pool from which this connection was created.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#disconnect!-instance_method" title="#disconnect! (instance method)">#<strong>disconnect!</strong>(options = nil)  &#x21d2; true </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disconnect the connection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#interrupted!-instance_method" title="#interrupted! (instance method)">#<strong>interrupted!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Mark the connection as interrupted.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#pin-instance_method" title="#pin (instance method)">#<strong>pin</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Mark the connection as pinned.</p></div>
    </div>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#ping-instance_method" title="#ping (instance method)">#<strong>ping</strong>  &#x21d2; true, false </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div>    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#record_checkin!-instance_method" title="#record_checkin! (instance method)">#<strong>record_checkin!</strong>  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Record the last checkin time.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#socket_timeout-instance_method" title="#socket_timeout (instance method)">#<strong>socket_timeout</strong>  &#x21d2; Float </a>
      (also: #timeout)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the timeout to execute an operation on a socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#timeout-instance_method" title="#timeout (instance method)">#<strong>timeout</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#socket_timeout-instance_method" title="Mongo::Server::Connection#socket_timeout (method)">#socket_timeout</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#unpin-instance_method" title="#unpin (instance method)">#<strong>unpin</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Mark the connection as not pinned.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#create_socket-instance_method" title="#create_socket (instance method)">#<strong>create_socket</strong>(context = nil)  &#x21d2; Socket </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates the socket.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#deliver-instance_method" title="#deliver (instance method)">#<strong>deliver</strong>(message, client, options = {})  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#do_connect-instance_method" title="#do_connect (instance method)">#<strong>do_connect</strong>  &#x21d2; Array&lt;Server::Description, String | Symbol&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Separate method to permit easier mocking in the test suite.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#handle_errors-instance_method" title="#handle_errors (instance method)">#<strong>handle_errors</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#raise_if_closed!-instance_method" title="#raise_if_closed! (instance method)">#<strong>raise_if_closed!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="../Retryable.html" title="Mongo::Retryable (module)"><code>::Mongo::Retryable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Retryable.html#read_worker-instance_method" title="Mongo::Retryable#read_worker (method)">#read_worker</a></td>
      <td><div class='inline'><p>Returns the read worker for handling retryable reads.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Retryable.html#select_server-instance_method" title="Mongo::Retryable#select_server (method)">#select_server</a></td>
      <td><div class='inline'><p>This is a separate method to make it possible for the test suite to assert that server selection is performed during retry attempts.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="../Retryable.html#write_worker-instance_method" title="Mongo::Retryable#write_worker (method)">#write_worker</a></td>
      <td><div class='inline'><p>Returns the write worker for handling retryable writes.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="ConnectionBase.html" title="Mongo::Server::ConnectionBase (class)"><code>ConnectionBase</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="ConnectionBase.html#app_metadata-instance_method" title="Mongo::Server::ConnectionBase#app_metadata (method)">#app_metadata</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="ConnectionBase.html#dispatch-instance_method" title="Mongo::Server::ConnectionBase#dispatch (method)">#dispatch</a></td>
      <td><div class='inline'><p>Dispatch a single message to the connection.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="ConnectionBase.html#generation-instance_method" title="Mongo::Server::ConnectionBase#generation (method)">#generation</a></td>
      <td><div class='inline'><p><code>Connection</code> pool generation from which this connection was created.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="ConnectionBase.html#service_id-instance_method" title="Mongo::Server::ConnectionBase#service_id (method)">#service_id</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="ConnectionBase.html#check_timeout!-instance_method" title="Mongo::Server::ConnectionBase#check_timeout! (method)">#check_timeout!</a></td>
      <td><div class='inline'><p>If timeoutMS is set for the operation context, checks whether there is enough time left to send the corresponding message to the server (remaining timeout is bigger than minimum round trip time for the server).</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="ConnectionBase.html#deliver-instance_method" title="Mongo::Server::ConnectionBase#deliver (method)">#deliver</a>,
        <a class='i_m priv' href="ConnectionBase.html#serialize-instance_method" title="Mongo::Server::ConnectionBase#serialize (method)">#serialize</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)"><code>::Mongo::Monitoring::Publishable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../Monitoring/Publishable.html#publish_cmap_event-instance_method" title="Mongo::Monitoring::Publishable#publish_cmap_event (method)">#publish_cmap_event</a>,
        <a class='i_m deprecated' href="../Monitoring/Publishable.html#publish_event-instance_method" title="Mongo::Monitoring::Publishable#publish_event (method)">#publish_event</a>,
        <a class='i_m ' href="../Monitoring/Publishable.html#publish_sdam_event-instance_method" title="Mongo::Monitoring::Publishable#publish_sdam_event (method)">#publish_sdam_event</a>,
        <a class='i_m priv' href="../Monitoring/Publishable.html#command_completed-instance_method" title="Mongo::Monitoring::Publishable#command_completed (method)">#command_completed</a>,
        <a class='i_m priv' href="../Monitoring/Publishable.html#command_failed-instance_method" title="Mongo::Monitoring::Publishable#command_failed (method)">#command_failed</a>,
        <a class='i_m priv' href="../Monitoring/Publishable.html#command_started-instance_method" title="Mongo::Monitoring::Publishable#command_started (method)">#command_started</a>,
        <a class='i_m priv' href="../Monitoring/Publishable.html#command_succeeded-instance_method" title="Mongo::Monitoring::Publishable#command_succeeded (method)">#command_succeeded</a>,
        <a class='i_m priv' href="../Monitoring/Publishable.html#duration-instance_method" title="Mongo::Monitoring::Publishable#duration (method)">#duration</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Loggable.html" title="Mongo::Loggable (module)"><code>::Mongo::Loggable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></td>
      <td><div class='inline'><p>Convenience method to log debug messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></td>
      <td><div class='inline'><p>Convenience method to log error messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></td>
      <td><div class='inline'><p>Convenience method to log fatal messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></td>
      <td><div class='inline'><p>Convenience method to log info messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></td>
      <td><div class='inline'><p>Convenience method to log warn messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></td>
      <td><div class='inline'><p>Get the logger instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="../Loggable.html#_mongo_log_prefix-instance_method" title="Mongo::Loggable#_mongo_log_prefix (method)">#_mongo_log_prefix</a>,
        <a class='i_m priv' href="../Loggable.html#format_message-instance_method" title="Mongo::Loggable#format_message (method)">#format_message</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="ConnectionCommon.html" title="Mongo::Server::ConnectionCommon (class)"><code>ConnectionCommon</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="ConnectionCommon.html#handshake_command-instance_method" title="Mongo::Server::ConnectionCommon#handshake_command (method)">#handshake_command</a></td>
      <td><div class='inline'><p>Build a command that should be used for connection handshake.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="ConnectionCommon.html#handshake_document-instance_method" title="Mongo::Server::ConnectionCommon#handshake_document (method)">#handshake_document</a></td>
      <td><div class='inline'><p>Build a document that should be used for connection handshake.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="ConnectionCommon.html#add_server_diagnostics-instance_method" title="Mongo::Server::ConnectionCommon#add_server_diagnostics (method)">#add_server_diagnostics</a></td>
      <td><div class='inline'><p>Yields to the block and, if the block raises an exception, adds a note to the exception with the address of the specified server.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="ConnectionCommon.html#ensure_connected-instance_method" title="Mongo::Server::ConnectionCommon#ensure_connected (method)">#ensure_connected</a>,
        <a class='i_m priv' href="ConnectionCommon.html#set_compressor!-instance_method" title="Mongo::Server::ConnectionCommon#set_compressor! (method)">#set_compressor!</a>,
        <a class='i_m priv' href="ConnectionCommon.html#ssl_options-instance_method" title="Mongo::Server::ConnectionCommon#ssl_options (method)">#ssl_options</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="closed?-instance_method">
  <h3 class='signature ro first'>
    #<strong>closed?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the connection was closed.</p>

<p>Closed connections should no longer be used. Instead obtain a new connection from the connection pool.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether connection was closed.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.9.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L166-L168'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='166' data-end='168'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 166</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@closed</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connected?-instance_method">
  <h3 class='signature ro'>
    #<strong>connected?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the connection was connected and was not interrupted, closed, or had an error raised.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>if the connection was connected.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L154-L156'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='154' data-end='156'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 154</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connected?'>connected?</span>
  <span class='op'>!</span><span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Server::Connection#closed? (method)">closed?</a></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_error?'><a href="#error%3F-instance_method" title="Mongo::Server::Connection#error? (method)">error?</a></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_interrupted?'><a href="#interrupted%3F-instance_method" title="Mongo::Server::Connection#interrupted? (method)">interrupted?</a></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@socket</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="error?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>error?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L186-L188'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='186' data-end='188'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 186</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_error?'>error?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@error</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="global_id-instance_method">
  <h3 class='signature ro'>
    #<strong>global_id</strong>  &#x21d2; <code>Integer</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>across all connections.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The global ID for the connection. This will be unique</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L140-L140'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='140' data-end='140'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 140</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_global_id'>global_id</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="id-instance_method">
  <h3 class='signature ro'>
    #<strong>id</strong>  &#x21d2; <code>Integer</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>across connections to the same server object.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The ID for the connection. This will be unique</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.9.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L136-L136'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='136' data-end='136'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 136</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="interrupted?-instance_method">
  <h3 class='signature ro'>
    #<strong>interrupted?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the connection was interrupted.</p>

<p>Interrupted connections were already removed from the pool and should not be checked back into the pool.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether connection was interrupted.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L176-L178'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='176' data-end='178'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 176</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_interrupted?'>interrupted?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@interrupted</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="last_checkin-instance_method">
  <h3 class='signature ro'>
    #<strong>last_checkin</strong>  &#x21d2; <code>Time</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Time</code>)</span>
&mdash;    <div class='inline'>
<p>The last time the connection was checked back into a pool.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L130-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='130' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 130</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_last_checkin'>last_checkin</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pinned?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>pinned?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the connection is used by a transaction or cursor operations.</p>

<p>Pinned connections should not be disconnected and removed from a connection pool if they are idle or stale.</p>

<h4 id="label-40return+-5B+true+-7C+false+-5D+Whether+connection+is+pinned.">@return [ true | false ] Whether connection is pinned.</h4>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L198-L200'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='198' data-end='200'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 198</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pinned?'>pinned?</span>
  <span class='ivar'>@pinned</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="connect!-instance_method">
  <h3 class='signature  first'>
    #<strong>connect!</strong>(context = nil)  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method mutates the connection object by setting a socket if one previously did not exist.</p>
</div>
  </div>


<p>Establishes a network connection to the target address.</p>

<p>If the connection is already established, this method does nothing.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Connect to the host.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_connect!'>connect!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>If the connection succeeded.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L229-L252'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='229' data-end='252'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 229</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connect!'>connect!</span>(<span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_raise_if_closed!'><a href="#raise_if_closed!-instance_method" title="Mongo::Server::Connection#raise_if_closed! (method)">raise_if_closed!</a></span>

  <span class='kw'>unless</span> <span class='ivar'>@socket</span>
    <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='id identifier rubyid_create_socket'><a href="#create_socket-instance_method" title="Mongo::Server::Connection#create_socket (method)">create_socket</a></span>(<span class='id identifier rubyid_context'>context</span>)
    <span class='ivar'>@description</span><span class='comma'>,</span> <span class='ivar'>@compressor</span> <span class='op'>=</span> <span class='id identifier rubyid_do_connect'><a href="#do_connect-instance_method" title="Mongo::Server::Connection#do_connect (method)">do_connect</a></span>

    <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_load_balancer?'>load_balancer?</span>
      <span class='kw'>if</span> <span class='const'><a href="../Lint.html" title="Mongo::Lint (module)">Lint</a></span>.<span class='id identifier rubyid_enabled?'><a href="../Lint.html#enabled%3F-class_method" title="Mongo::Lint.enabled? (method)">enabled?</a></span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_service_id'>service_id</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/InternalDriverError.html" title="Mongo::Error::InternalDriverError (class)">InternalDriverError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The connection is to a load balancer and it must have service_id set here, but does not</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='ivar'>@generation</span> <span class='op'>=</span> <span class='id identifier rubyid_connection_pool'><a href="#connection_pool-instance_method" title="Mongo::Server::Connection#connection_pool (method)">connection_pool</a></span>.<span class='id identifier rubyid_generation_manager'>generation_manager</span>.<span class='id identifier rubyid_generation'>generation</span>(<span class='label'>service_id:</span> <span class='id identifier rubyid_service_id'>service_id</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span>(
      <span class='const'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span><span class='op'>::</span><span class='const'><a href="../Monitoring/Event/Cmap/ConnectionReady.html" title="Mongo::Monitoring::Event::Cmap::ConnectionReady (class)">ConnectionReady</a></span>.<span class='id identifier rubyid_new'><a href="../Monitoring/Event/Cmap/ConnectionReady.html#new-class_method" title="Mongo::Monitoring::Event::Cmap::ConnectionReady.new (method)">new</a></span>(<span class='id identifier rubyid_address'><a href="../Server.html#address-instance_method" title="Mongo::Server#address (method)">address</a></span><span class='comma'>,</span> <span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Server::Connection#id (method)">id</a></span>)
    )

    <span class='ivar'>@close_event_published</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connection_pool-instance_method">
  <h3 class='signature nodoc'>
    #<strong>connection_pool</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>The connection pool from which this connection was created. May be nil.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L146-L148'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='146' data-end='148'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 146</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connection_pool'>connection_pool</span>
  <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connection_pool'>connection_pool</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_socket-instance_method">
  <h3 class='signature priv'>
    #<strong>create_socket</strong>(context = nil)  &#x21d2; <a href="../Socket.html" title="Mongo::Socket (class)">Socket</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates the socket. The method is separate from do_connect, so that pending connections can be closed if they are interrupted during hello.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Socket.html" title="Mongo::Socket (class)">Socket</a>)</span>
&mdash;    <div class='inline'>
<p>The created socket.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L259-L270'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='259' data-end='270'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 259</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_create_socket'>create_socket</span>(<span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_add_server_diagnostics'>add_server_diagnostics</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_ssl_options'>ssl_options</span>.<span class='id identifier rubyid_merge'>merge</span>(
      <span class='label'>connection_address:</span> <span class='id identifier rubyid_address'><a href="../Server.html#address-instance_method" title="Mongo::Server#address (method)">address</a></span><span class='comma'>,</span>
      <span class='label'>connection_generation:</span> <span class='id identifier rubyid_generation'>generation</span><span class='comma'>,</span>
      <span class='label'>pipe:</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_pipe'>pipe</span>]<span class='comma'>,</span>
      <span class='label'>connect_timeout:</span> <span class='id identifier rubyid_context'>context</span><span class='op'>&amp;.</span><span class='id identifier rubyid_remaining_timeout_sec'>remaining_timeout_sec</span><span class='comma'>,</span>
      <span class='label'>csot:</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_context'>context</span><span class='op'>&amp;.</span><span class='id identifier rubyid_csot?'>csot?</span>
    )
    <span class='id identifier rubyid_address'><a href="../Server.html#address-instance_method" title="Mongo::Server#address (method)">address</a></span>.<span class='id identifier rubyid_socket'>socket</span>(<span class='id identifier rubyid_socket_timeout'><a href="#socket_timeout-instance_method" title="Mongo::Server::Connection#socket_timeout (method)">socket_timeout</a></span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="deliver-instance_method">
  <h3 class='signature priv'>
    #<strong>deliver</strong>(message, client, options = {})   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L393-L397'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='393' data-end='397'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 393</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_deliver'>deliver</span>(<span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_handle_errors'><a href="#handle_errors-instance_method" title="Mongo::Server::Connection#handle_errors (method)">handle_errors</a></span> <span class='kw'>do</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disconnect!-instance_method">
  <h3 class='signature '>
    #<strong>disconnect!</strong>(options = nil)  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Once a connection is disconnected, it should no longer be used. A new connection should be obtained from the connection pool which will either return a ready connection or create a new connection. If linting is enabled, reusing a disconnected connection will raise <a href="../Error/LintError.html" title="Mongo::Error::LintError (class)"><code>::Mongo::Error::LintError</code></a>. If linting is not enabled, a warning will be logged.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method mutates the connection object by setting the socket to nil if the closing succeeded.</p>
</div>
  </div>


<p>Disconnect the connection.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:reason</span>
          <span class='type'>(<a href="../../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
            &mdash; <div class='inline'>
<p>The reason why the connection is being closed.</p>
</div>        </li>
        <li>
          <span class='name'>:interrupted</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether or not the connection was interrupted.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>If the disconnect succeeded.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L311-L341'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='311' data-end='341'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 311</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect!'>disconnect!</span>(<span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='comment'># Note: @closed may be true here but we also may have a socket.
</span>  <span class='comment'># Check the socket and not @closed flag.
</span>  <span class='ivar'>@auth_mechanism</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@last_checkin</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span>
    <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_close'><a href="../Server.html#close-instance_method" title="Mongo::Server#close (method)">close</a></span> <span class='kw'>rescue</span> <span class='kw'>nil</span>
    <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_interrupted!'><a href="#interrupted!-instance_method" title="Mongo::Server::Connection#interrupted! (method)">interrupted!</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_interrupted'>interrupted</span>]

  <span class='comment'># To satisfy CMAP spec tests, publish close events even if the
</span>  <span class='comment'># socket was never connected (and thus the ready event was never
</span>  <span class='comment'># published). But track whether we published close event and do not
</span>  <span class='comment'># publish it multiple times, unless the socket was reconnected -
</span>  <span class='comment'># in that case publish the close event once per socket close.
</span>  <span class='kw'>unless</span> <span class='ivar'>@close_event_published</span>
    <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_reason'>reason</span>]
    <span class='id identifier rubyid_publish_cmap_event'>publish_cmap_event</span>(
      <span class='const'><a href="../Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="../Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="../Monitoring/Event/Cmap.html" title="Mongo::Monitoring::Event::Cmap (module)">Cmap</a></span><span class='op'>::</span><span class='const'><a href="../Monitoring/Event/Cmap/ConnectionClosed.html" title="Mongo::Monitoring::Event::Cmap::ConnectionClosed (class)">ConnectionClosed</a></span>.<span class='id identifier rubyid_new'><a href="../Monitoring/Event/Cmap/ConnectionClosed.html#new-class_method" title="Mongo::Monitoring::Event::Cmap::ConnectionClosed.new (method)">new</a></span>(
        <span class='id identifier rubyid_address'><a href="../Server.html#address-instance_method" title="Mongo::Server#address (method)">address</a></span><span class='comma'>,</span>
        <span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Server::Connection#id (method)">id</a></span><span class='comma'>,</span>
        <span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span>
      )<span class='comma'>,</span>
    )
    <span class='ivar'>@close_event_published</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_connect-instance_method">
  <h3 class='signature priv'>
    #<strong>do_connect</strong>  &#x21d2; <code>Array</code>&lt;<a href="Description.html" title="Mongo::Server::Description (class)">Server::Description</a>, <code>String</code> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Separate method to permit easier mocking in the test suite.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<a href="Description.html" title="Mongo::Server::Description (class)">Server::Description</a>, <code>String</code> | <a href="../../Symbol.html" title="Symbol (class)">Symbol</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>A server description instance from the hello response of the returned socket and the compressor to use.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L277-L290'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='277' data-end='290'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 277</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_do_connect'>do_connect</span>
  <span class='id identifier rubyid_raise_if_closed!'><a href="#raise_if_closed!-instance_method" title="Mongo::Server::Connection#raise_if_closed! (method)">raise_if_closed!</a></span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_pending_connection'>pending_connection</span> <span class='op'>=</span> <span class='const'><a href="PendingConnection.html" title="Mongo::Server::PendingConnection (class)">PendingConnection</a></span>.<span class='id identifier rubyid_new'><a href="PendingConnection.html#new-class_method" title="Mongo::Server::PendingConnection.new (method)">new</a></span>(
      <span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='ivar'>@server</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'><a href="../Server.html#monitoring-instance_method" title="Mongo::Server#monitoring (method)">monitoring</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>id:</span> <span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Server::Connection#id (method)">id</a></span>))
    <span class='id identifier rubyid_pending_connection'>pending_connection</span>.<span class='id identifier rubyid_handshake_and_authenticate!'>handshake_and_authenticate!</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='op'>&amp;.</span><span class='id identifier rubyid_close'><a href="../Server.html#close-instance_method" title="Mongo::Server#close (method)">close</a></span>
    <span class='ivar'>@socket</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>

  [<span class='id identifier rubyid_pending_connection'>pending_connection</span>.<span class='id identifier rubyid_description'><a href="../Server.html#description-instance_method" title="Mongo::Server#description (method)">description</a></span><span class='comma'>,</span> <span class='id identifier rubyid_pending_connection'>pending_connection</span>.<span class='id identifier rubyid_compressor'><a href="../Server.html#compressor-instance_method" title="Mongo::Server#compressor (method)">compressor</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_errors-instance_method">
  <h3 class='signature priv'>
    #<strong>handle_errors</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L399-L415'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='399' data-end='415'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 399</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_errors'>handle_errors</span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>
    <span class='ivar'>@server</span>.<span class='id identifier rubyid_unknown!'><a href="../Server.html#unknown!-instance_method" title="Mongo::Server#unknown! (method)">unknown!</a></span>(
      <span class='label'>generation:</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_generation'>generation</span><span class='comma'>,</span>
      <span class='comment'># or description.service_id?
</span>      <span class='label'>service_id:</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_service_id'>service_id</span><span class='comma'>,</span>
      <span class='label'>stop_push_monitor:</span> <span class='kw'>true</span><span class='comma'>,</span>
    )
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="interrupted!-instance_method">
  <h3 class='signature '>
    #<strong>interrupted!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Mark the connection as interrupted.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L181-L183'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='181' data-end='183'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 181</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_interrupted!'>interrupted!</span>
  <span class='ivar'>@interrupted</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pin-instance_method">
  <h3 class='signature nodoc'>
    #<strong>pin</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Mark the connection as pinned.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L205-L207'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='205' data-end='207'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 205</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pin'>pin</span>
  <span class='ivar'>@pinned</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ping-instance_method">
  <h3 class='signature deprecated'>
    #<strong>ping</strong>  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>No longer necessary with <a href="../Server.html" title="Mongo::Server (class)"><code>::Mongo::Server</code></a> Selection specification.</p>
</div></div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This uses a pre-serialized ping message for optimization.</p>
</div>
  </div>


<p>Ping the connection to see if the server is responding to commands. This is non-blocking on the server side.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Ping the connection.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_ping'>ping</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the server is accepting connections.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L356-L365'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='356' data-end='365'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 356</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ping'>ping</span>
  <span class='id identifier rubyid_bytes'>bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_features'>features</span>.<span class='id identifier rubyid_op_msg_enabled?'>op_msg_enabled?</span> <span class='op'>?</span> <span class='const'><a href="#PING_OP_MSG_BYTES-constant" title="Mongo::Server::Connection::PING_OP_MSG_BYTES (constant)">PING_OP_MSG_BYTES</a></span> <span class='op'>:</span> <span class='const'><a href="#PING_BYTES-constant" title="Mongo::Server::Connection::PING_BYTES (constant)">PING_BYTES</a></span>
  <span class='id identifier rubyid_ensure_connected'>ensure_connected</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
    <span class='id identifier rubyid_reply'>reply</span> <span class='op'>=</span> <span class='id identifier rubyid_add_server_diagnostics'>add_server_diagnostics</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_socket'>socket</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_bytes'>bytes</span>)
      <span class='const'><a href="../Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="../Protocol/Message.html" title="Mongo::Protocol::Message (class)">Message</a></span>.<span class='id identifier rubyid_deserialize'><a href="../Protocol/Message.html#deserialize-class_method" title="Mongo::Protocol::Message.deserialize (method)">deserialize</a></span>(<span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='id identifier rubyid_max_message_size'>max_message_size</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_reply'>reply</span>.<span class='id identifier rubyid_documents'>documents</span>[<span class='int'>0</span>][<span class='const'><a href="../Operation.html" title="Mongo::Operation (module)">Operation</a></span><span class='op'>::</span><span class='const'><a href="../Operation/Result.html" title="Mongo::Operation::Result (class)">Result</a></span><span class='op'>::</span><span class='const'><a href="../Operation/Result.html#OK-constant" title="Mongo::Operation::Result::OK (constant)">OK</a></span>] <span class='op'>==</span> <span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_if_closed!-instance_method">
  <h3 class='signature priv'>
    #<strong>raise_if_closed!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L417-L425'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='417' data-end='425'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 417</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_raise_if_closed!'>raise_if_closed!</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_error?'><a href="#error%3F-instance_method" title="Mongo::Server::Connection#error? (method)">error?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/ConnectionPerished.html" title="Mongo::Error::ConnectionPerished (class)">ConnectionPerished</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connection </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_generation'>generation</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Server::Connection#id (method)">id</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_address'><a href="../Server.html#address-instance_method" title="Mongo::Server#address (method)">address</a></span>.<span class='id identifier rubyid_seed'>seed</span><span class='embexpr_end'>}</span><span class='tstring_content'> is perished. Reconnecting closed or errored connections is no longer supported</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Server::Connection#closed? (method)">closed?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="../Error/ConnectionPerished.html" title="Mongo::Error::ConnectionPerished (class)">ConnectionPerished</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connection </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_generation'>generation</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'><a href="#id-instance_method" title="Mongo::Server::Connection#id (method)">id</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_address'><a href="../Server.html#address-instance_method" title="Mongo::Server#address (method)">address</a></span>.<span class='id identifier rubyid_seed'>seed</span><span class='embexpr_end'>}</span><span class='tstring_content'> is closed. Reconnecting closed or errored connections is no longer supported</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="record_checkin!-instance_method">
  <h3 class='signature '>
    #<strong>record_checkin!</strong>  &#x21d2; <code>self</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Record the last checkin time.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Record the checkin time on this connection.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_record_checkin!'>record_checkin!</span></code></pre>
  </div>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L386-L389'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='386' data-end='389'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 386</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_record_checkin!'>record_checkin!</span>
  <span class='ivar'>@last_checkin</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="socket_timeout-instance_method">
  <h3 class='signature '>
    #<strong>socket_timeout</strong>  &#x21d2; <code>Float</code> 
    <span class='aliases'>Also known as: <span class='names'>#timeout</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the timeout to execute an operation on a socket.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>The operation timeout in seconds.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L372-L374'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='372' data-end='374'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 372</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_socket_timeout'>socket_timeout</span>
  <span class='ivar'>@timeout</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'><a href="../Server.html#options-instance_method" title="Mongo::Server#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_socket_timeout'>socket_timeout</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="timeout-instance_method">
  <h3 class='signature '>
    #<strong>timeout</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#socket_timeout-instance_method" title="Mongo::Server::Connection#socket_timeout (method)">#socket_timeout</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L376-L376'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='376' data-end='376'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 376</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='symbeg'>:</span><span class='id identifier rubyid_socket_timeout'><a href="#socket_timeout-instance_method" title="Mongo::Server::Connection#socket_timeout (method)">socket_timeout</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unpin-instance_method">
  <h3 class='signature nodoc'>
    #<strong>unpin</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Mark the connection as not pinned.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/server/connection.rb#L212-L214'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='212' data-end='214'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/server/connection.rb', line 212</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unpin'>unpin</span>
  <span class='ivar'>@pinned</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>