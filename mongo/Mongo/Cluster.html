<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Cluster &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Cluster",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Mongo master</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Cluster&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Cluster</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)"><code>Topology</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Cluster/CursorReaper.html" title="Mongo::Cluster::CursorReaper (class)"><code>CursorReaper</code></a>,
        <a href="Cluster/PeriodicExecutor.html" title="Mongo::Cluster::PeriodicExecutor (class)"><code>PeriodicExecutor</code></a>,
        <a href="Cluster/SdamFlow.html" title="Mongo::Cluster::SdamFlow (class)"><code>SdamFlow</code></a>,
        <a href="Cluster/SocketReaper.html" title="Mongo::Cluster::SocketReaper (class)"><code>SocketReaper</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="ClusterTime/Consumer.html" title="Mongo::ClusterTime::Consumer (module)"><code>ClusterTime::Consumer</code></a>,
          <a href="Event/Subscriber.html" title="Mongo::Event::Subscriber (module)"><code>Event::Subscriber</code></a>,
          <a href="Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)"><code>Monitoring::Publishable</code></a>,
          <a href="Loggable.html" title="Mongo::Loggable (module)"><code>Loggable</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L29'>lib/mongo/cluster.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/periodic_executor.rb#L20'>lib/mongo/cluster/periodic_executor.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/sdam_flow.rb#L18'>lib/mongo/cluster/sdam_flow.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology.rb#L49'>lib/mongo/cluster/topology.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology.rb#L19'>lib/mongo/cluster/topology.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/reapers/cursor_reaper.rb#L20'>lib/mongo/cluster/reapers/cursor_reaper.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/reapers/socket_reaper.rb#L20'>lib/mongo/cluster/reapers/socket_reaper.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/base.rb#L19'>lib/mongo/cluster/topology/base.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/load_balanced.rb#L19'>lib/mongo/cluster/topology/load_balanced.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/no_replica_set_options.rb#L19'>lib/mongo/cluster/topology/no_replica_set_options.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/replica_set_no_primary.rb#L19'>lib/mongo/cluster/topology/replica_set_no_primary.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/replica_set_with_primary.rb#L19'>lib/mongo/cluster/topology/replica_set_with_primary.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/sharded.rb#L19'>lib/mongo/cluster/topology/sharded.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/single.rb#L19'>lib/mongo/cluster/topology/single.rb</a>,<br/> <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster/topology/unknown.rb#L19'>lib/mongo/cluster/topology/unknown.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Copyright © 2018-2020 MongoDB Inc.</p>

<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_http'>http</span><span class='symbeg'>:</span><span class='op'>/</span><span class='op'>/</span><span class='id identifier rubyid_www'>www</span>.<span class='id identifier rubyid_apache'>apache</span>.<span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_licenses'>licenses</span><span class='op'>/</span><span class='const'>LICENSE</span><span class='op'>-</span><span class='float'>2.0</span></code></pre>

<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='CLUSTER_TIME-constant' class='summary_signature deprecated'>CLUSTER_TIME =</span>
    <div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

<p>The cluster time key in responses from mongos servers.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L61-L61'># File 'lib/mongo/cluster.rb', line 61</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>clusterTime</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='COSMOSDB_HOST_PATTERNS-constant' class='summary_signature'>COSMOSDB_HOST_PATTERNS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1101-L1101'># File 'lib/mongo/cluster.rb', line 1101</a>    <pre class='code ruby'><span class='qwords'><span class='qwords_beg'>%w[</span><span class='words_sep'> </span><span class='tstring_content'>.cosmos.azure.com</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span></pre>
  </li>
  <li>
    <span id='COSMOSDB_LOG_MESSAGE-constant' class='summary_signature'>COSMOSDB_LOG_MESSAGE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1102-L1104'># File 'lib/mongo/cluster.rb', line 1102</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You appear to be connected to a CosmosDB cluster. </span><span class='tstring_end'>&#39;</span></span> \
<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>For more information regarding feature compatibility and support please visit </span><span class='tstring_end'>&#39;</span></span> \
<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.mongodb.com/supportability/cosmosdb</span><span class='tstring_end'>&#39;</span></span></pre>
  </li>
  <li>
    <span id='DOCUMENTDB_HOST_PATTERNS-constant' class='summary_signature'>DOCUMENTDB_HOST_PATTERNS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1106-L1106'># File 'lib/mongo/cluster.rb', line 1106</a>    <pre class='code ruby'><span class='qwords'><span class='qwords_beg'>%w[</span><span class='words_sep'> </span><span class='tstring_content'>.docdb.amazonaws.com</span><span class='words_sep'> </span><span class='tstring_content'>.docdb-elastic.amazonaws.com</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span></pre>
  </li>
  <li>
    <span id='DOCUMENTDB_LOG_MESSAGE-constant' class='summary_signature'>DOCUMENTDB_LOG_MESSAGE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1107-L1109'># File 'lib/mongo/cluster.rb', line 1107</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You appear to be connected to a DocumentDB cluster. </span><span class='tstring_end'>&#39;</span></span> \
<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>For more information regarding feature compatibility and support please visit </span><span class='tstring_end'>&#39;</span></span> \
<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://www.mongodb.com/supportability/documentdb</span><span class='tstring_end'>&#39;</span></span></pre>
  </li>
  <li>
    <span id='IDLE_WRITE_PERIOD_SECONDS-constant' class='summary_signature'>IDLE_WRITE_PERIOD_SECONDS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>How often an idle primary writes a no-op to the oplog.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.4.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L55-L55'># File 'lib/mongo/cluster.rb', line 55</a>    <pre class='code ruby'><span class='int'>10</span></pre>
  </li>
  <li>
    <span id='MAX_READ_RETRIES-constant' class='summary_signature'>MAX_READ_RETRIES =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default number of legacy read retries.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.1</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L39-L39'># File 'lib/mongo/cluster.rb', line 39</a>    <pre class='code ruby'><span class='int'>1</span></pre>
  </li>
  <li>
    <span id='MAX_WRITE_RETRIES-constant' class='summary_signature'>MAX_WRITE_RETRIES =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default number of legacy write retries.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.4.2</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L44-L44'># File 'lib/mongo/cluster.rb', line 44</a>    <pre class='code ruby'><span class='int'>1</span></pre>
  </li>
  <li>
    <span id='READ_RETRY_INTERVAL-constant' class='summary_signature'>READ_RETRY_INTERVAL =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default read retry interval, in seconds, when using legacy read retries.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.1</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L50-L50'># File 'lib/mongo/cluster.rb', line 50</a>    <pre class='code ruby'><span class='int'>5</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="Loggable.html" title="Mongo::Loggable (module)"><code>Loggable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">PREFIX</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#create-class_method" title=".create (class method)">.<strong>create</strong>(client, monitoring: nil)  &#x21d2; Cluster </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a cluster for the provided client, for use when we don’t want the client’s original cluster instance to be the same.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(seeds, monitoring, options = Options::Redacted.new)  &#x21d2; Cluster </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Instantiate the new cluster.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#app_metadata-instance_method" title="#app_metadata (instance method)">#<strong>app_metadata</strong>  &#x21d2; Mongo::Server::AppMetadata </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">#<strong>connected?</strong>  &#x21d2; true|false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the cluster object is connected to its cluster.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#connecting%3F-instance_method" title="#connecting? (instance method)">#<strong>connecting?</strong>  &#x21d2; true|false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Whether the cluster object is in the process of connecting to its cluster.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#has_writable_server%3F-instance_method" title="#has_writable_server? (instance method)">#<strong>has_writable_server?</strong>  &#x21d2; true, false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if the cluster would select a writable server.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#load_balanced%3F-instance_method" title="#load_balanced? (instance method)">#<strong>load_balanced?</strong>  &#x21d2; true | false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether the cluster is configured to be in the load-balanced topology.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#monitor_app_metadata-instance_method" title="#monitor_app_metadata (instance method)">#<strong>monitor_app_metadata</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#monitoring-instance_method" title="#monitoring (instance method)">#<strong>monitoring</strong>  &#x21d2; Monitoring </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#push_monitor_app_metadata-instance_method" title="#push_monitor_app_metadata (instance method)">#<strong>push_monitor_app_metadata</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#seeds-instance_method" title="#seeds (instance method)">#<strong>seeds</strong>  &#x21d2; Array&lt;String&gt; </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#server_selection_semaphore-instance_method" title="#server_selection_semaphore (instance method)">#<strong>server_selection_semaphore</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#session_pool-instance_method" title="#session_pool (instance method)">#<strong>session_pool</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#srv_monitor-instance_method" title="#srv_monitor (instance method)">#<strong>srv_monitor</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#topology-instance_method" title="#topology (instance method)">#<strong>topology</strong>  &#x21d2; Integer<sup>?</sup> </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The logical session timeout value in minutes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#tracer-instance_method" title="#tracer (instance method)">#<strong>tracer</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>

<h3 class='inherited'><a href="ClusterTime/Consumer.html" title="Mongo::ClusterTime::Consumer (module)"><code>ClusterTime::Consumer</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="ClusterTime/Consumer.html#cluster_time-instance_method" title="Mongo::ClusterTime::Consumer#cluster_time (method)">#cluster_time</a></td>
      <td><div class='inline'><p>The cluster time tracked by the object including this module.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Event/Subscriber.html" title="Mongo::Event::Subscriber (module)"><code>Event::Subscriber</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Event/Subscriber.html#event_listeners-instance_method" title="Mongo::Event::Subscriber#event_listeners (method)">#event_listeners</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)"><code>Monitoring::Publishable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Monitoring/Publishable.html#monitoring-instance_method" title="Mongo::Monitoring::Publishable#monitoring (method)">#monitoring</a>,
        <a class='i_m ro priv' href="Monitoring/Publishable.html#monitoring%3F-instance_method" title="Mongo::Monitoring::Publishable#monitoring? (method)">#monitoring?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; true, false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if this cluster of servers is equal to another object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#add-instance_method" title="#add (instance method)">#<strong>add</strong>(host, add_options = nil)  &#x21d2; Server </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add a server to the cluster with the provided address.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#addresses-instance_method" title="#addresses (instance method)">#<strong>addresses</strong>  &#x21d2; Array&lt;Mongo::Address&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The addresses in the cluster.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Closes the cluster.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#disconnect_server_if_connected-instance_method" title="#disconnect_server_if_connected (instance method)">#<strong>disconnect_server_if_connected</strong>(server)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#has_readable_server%3F-instance_method" title="#has_readable_server? (instance method)">#<strong>has_readable_server?</strong>(server_selector = nil)  &#x21d2; true, false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if the cluster would select a readable server for the provided read preference.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#heartbeat_interval-instance_method" title="#heartbeat_interval (instance method)">#<strong>heartbeat_interval</strong>  &#x21d2; Float </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the refresh interval for the server.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the nicer formatted string for use in inspection.</p></div>
    </div>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#max_read_retries-instance_method" title="#max_read_retries (instance method)">#<strong>max_read_retries</strong>  &#x21d2; Integer </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'></div>    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#next_primary-instance_method" title="#next_primary (instance method)">#<strong>next_primary</strong>(ping = nil, session = nil, timeout: nil)  &#x21d2; Mongo::Server </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the next primary server we can send an operation to.</p></div>
    </div>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#pool-instance_method" title="#pool (instance method)">#<strong>pool</strong>(server)  &#x21d2; Server::ConnectionPool </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'></div>    </span>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#read_retry_interval-instance_method" title="#read_retry_interval (instance method)">#<strong>read_retry_interval</strong>  &#x21d2; Float </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'></div>    </span>
  </li>
  <li class='deprecated'>
    <span class='summary_signature deprecated'>
      <a href="#reconnect!-instance_method" title="#reconnect! (instance method)">#<strong>reconnect!</strong>  &#x21d2; true </a>
    </span>
    <span class='deprecated note title'>deprecated</span>
    <span class='summary_desc'><strong>Deprecated.</strong>
      <div class='inline'>
<p>Use Client#reconnect to reconnect to the cluster instead of calling this method. This method does not send SDAM events.</p>
</div>    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#remove-instance_method" title="#remove (instance method)">#<strong>remove</strong>(host, disconnect: true)  &#x21d2; Array&lt;Server&gt; | true | false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove the server from the cluster for the provided address, if it exists.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#run_sdam_flow-instance_method" title="#run_sdam_flow (instance method)">#<strong>run_sdam_flow</strong>(previous_desc, updated_desc, options = {})  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Runs SDAM flow on the cluster.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#scan!-instance_method" title="#scan! (instance method)">#<strong>scan!</strong>(sync = true)  &#x21d2; true </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Force a scan of all known servers in the cluster.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#servers-instance_method" title="#servers (instance method)">#<strong>servers</strong>  &#x21d2; Array&lt;Server&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get a list of server candidates from the cluster that can have operations executed on them.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#servers_list-instance_method" title="#servers_list (instance method)">#<strong>servers_list</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#set_server_list-instance_method" title="#set_server_list (instance method)">#<strong>set_server_list</strong>(server_address_strs)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the list of servers to the addresses in the provided list of address strings.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#summary-instance_method" title="#summary (instance method)">#<strong>summary</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_cluster_time-instance_method" title="#update_cluster_time (instance method)">#<strong>update_cluster_time</strong>(result)  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Update the max cluster time seen in a response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#update_topology-instance_method" title="#update_topology (instance method)">#<strong>update_topology</strong>(new_topology)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#validate_session_support!-instance_method" title="#validate_session_support! (instance method)">#<strong>validate_session_support!</strong>(timeout: nil)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises Error::SessionsNotAvailable if the deployment that the driver is connected to does not support sessions.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#fabricate_lb_sdam_events_and_set_server_type-instance_method" title="#fabricate_lb_sdam_events_and_set_server_type (instance method)">#<strong>fabricate_lb_sdam_events_and_set_server_type</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#possibly_warn_about_compatibility!-instance_method" title="#possibly_warn_about_compatibility! (instance method)">#<strong>possibly_warn_about_compatibility!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Compares the server hosts with address suffixes of known services that provide limited MongoDB API compatibility, and warns about them.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#raise_sessions_not_supported-instance_method" title="#raise_sessions_not_supported (instance method)">#<strong>raise_sessions_not_supported</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#recreate_topology-instance_method" title="#recreate_topology (instance method)">#<strong>recreate_topology</strong>(new_topology_template, previous_topology)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#start_stop_srv_monitor-instance_method" title="#start_stop_srv_monitor (instance method)">#<strong>start_stop_srv_monitor</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>

<h3 class='inherited'><a href="ClusterTime/Consumer.html" title="Mongo::ClusterTime::Consumer (module)"><code>ClusterTime::Consumer</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="ClusterTime/Consumer.html#advance_cluster_time-instance_method" title="Mongo::ClusterTime::Consumer#advance_cluster_time (method)">#advance_cluster_time</a></td>
      <td><div class='inline'><p>Advance the tracked cluster time document for the object including this module.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Event/Subscriber.html" title="Mongo::Event::Subscriber (module)"><code>Event::Subscriber</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Event/Subscriber.html#subscribe_to-instance_method" title="Mongo::Event::Subscriber#subscribe_to (method)">#subscribe_to</a></td>
      <td><div class='inline'><p>Subscribe to the provided event.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Monitoring/Publishable.html" title="Mongo::Monitoring::Publishable (module)"><code>Monitoring::Publishable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Monitoring/Publishable.html#publish_cmap_event-instance_method" title="Mongo::Monitoring::Publishable#publish_cmap_event (method)">#publish_cmap_event</a>,
        <a class='i_m deprecated' href="Monitoring/Publishable.html#publish_event-instance_method" title="Mongo::Monitoring::Publishable#publish_event (method)">#publish_event</a>,
        <a class='i_m ' href="Monitoring/Publishable.html#publish_sdam_event-instance_method" title="Mongo::Monitoring::Publishable#publish_sdam_event (method)">#publish_sdam_event</a>,
        <a class='i_m priv' href="Monitoring/Publishable.html#command_completed-instance_method" title="Mongo::Monitoring::Publishable#command_completed (method)">#command_completed</a>,
        <a class='i_m priv' href="Monitoring/Publishable.html#command_failed-instance_method" title="Mongo::Monitoring::Publishable#command_failed (method)">#command_failed</a>,
        <a class='i_m priv' href="Monitoring/Publishable.html#command_started-instance_method" title="Mongo::Monitoring::Publishable#command_started (method)">#command_started</a>,
        <a class='i_m priv' href="Monitoring/Publishable.html#command_succeeded-instance_method" title="Mongo::Monitoring::Publishable#command_succeeded (method)">#command_succeeded</a>,
        <a class='i_m priv' href="Monitoring/Publishable.html#duration-instance_method" title="Mongo::Monitoring::Publishable#duration (method)">#duration</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Loggable.html" title="Mongo::Loggable (module)"><code>Loggable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></td>
      <td><div class='inline'><p>Convenience method to log debug messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></td>
      <td><div class='inline'><p>Convenience method to log error messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></td>
      <td><div class='inline'><p>Convenience method to log fatal messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></td>
      <td><div class='inline'><p>Convenience method to log info messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></td>
      <td><div class='inline'><p>Convenience method to log warn messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></td>
      <td><div class='inline'><p>Get the logger instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Loggable.html#_mongo_log_prefix-instance_method" title="Mongo::Loggable#_mongo_log_prefix (method)">#_mongo_log_prefix</a>,
        <a class='i_m priv' href="Loggable.html#format_message-instance_method" title="Mongo::Loggable#format_message (method)">#format_message</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="create-class_method">
  <h3 class='signature nodoc first'>
    .<strong>create</strong>(client, monitoring: nil)  &#x21d2; <code>Cluster</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a cluster for the provided client, for use when we don’t want the client’s original cluster instance to be the same.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create a cluster for the client.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'>Cluster</span>.<span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_client'>client</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>client</span>
    <span class='type'>(<a href="Client.html" title="Mongo::Client (class)">Client</a>)</span>
&mdash;    <div class='inline'>
<p>The client to create on.</p>
</div>
  </li>
  <li>
    <span class='name'>monitoring.</span>
    <span class='type'>(<a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The monitoring instance to use with the new cluster. If nil, a new instance of <a href="Monitoring.html" title="Mongo::Monitoring (class)"><code>Monitoring</code></a> will be created.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Cluster</code>)</span>
&mdash;    <div class='inline'>
<p>The cluster.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L298-L305'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='298' data-end='305'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 298</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>monitoring:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>=</span> <span class='const'>Cluster</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Cluster.new (method)">new</a></span>(
    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_addresses'><a href="#addresses-instance_method" title="Mongo::Cluster#addresses (method)">addresses</a></span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)<span class='comma'>,</span>
    <span class='id identifier rubyid_monitoring'><a href="#monitoring-instance_method" title="Mongo::Cluster#monitoring (method)">monitoring</a></span> <span class='op'>||</span> <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring.html#new-class_method" title="Mongo::Monitoring.new (method)">new</a></span><span class='comma'>,</span>
    <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_cluster_options'>cluster_options</span>
  )
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='symbeg'>:</span><span class='ivar'>@cluster</span><span class='comma'>,</span> <span class='id identifier rubyid_cluster'>cluster</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="app_metadata-instance_method">
  <h3 class='signature ro first'>
    #<strong>app_metadata</strong>  &#x21d2; <a href="Server/AppMetadata.html" title="Mongo::Server::AppMetadata (class)">Mongo::Server::AppMetadata</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Server/AppMetadata.html" title="Mongo::Server::AppMetadata (class)">Mongo::Server::AppMetadata</a>)</span>
&mdash;    <div class='inline'>
<p>The application metadata, used for connection handshakes.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.4.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L322-L322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='322' data-end='322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 322</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_app_metadata'>app_metadata</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connected?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>connected?</strong>  &#x21d2; <code>true</code>|<code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the cluster object is connected to its cluster.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>|<code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether the cluster is connected.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.7.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L429-L433'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='429' data-end='433'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 429</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connected?'>connected?</span>
  <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@connected</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="connecting?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>connecting?</strong>  &#x21d2; <code>true</code>|<code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Whether the cluster object is in the process of connecting to its cluster.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>|<code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether the cluster is connecting.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L417-L421'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='417' data-end='421'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 417</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_connecting?'>connecting?</span>
  <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@connecting</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="has_writable_server?-instance_method">
  <h3 class='signature ro'>
    #<strong>has_writable_server?</strong>  &#x21d2; <code>true</code>, <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if the cluster would select a writable server.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Is a writable server present?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_has_writable_server?'>has_writable_server?</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If a writable server is present.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.4.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L772-L774'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='772' data-end='774'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 772</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_writable_server?'>has_writable_server?</span>
  <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_has_writable_server?'>has_writable_server?</span>(<span class='kw'>self</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_balanced?-instance_method">
  <h3 class='signature ro'>
    #<strong>load_balanced?</strong>  &#x21d2; <code>true</code> | <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether the cluster is configured to be in the load-balanced topology.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether the topology is load-balanced.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L350-L352'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='350' data-end='352'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 350</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_balanced?'>load_balanced?</span>
  <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span><span class='op'>::</span><span class='const'><a href="Cluster/Topology/LoadBalanced.html" title="Mongo::Cluster::Topology::LoadBalanced (class)">LoadBalanced</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="monitor_app_metadata-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>monitor_app_metadata</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L325-L325'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='325' data-end='325'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 325</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_monitor_app_metadata'>monitor_app_metadata</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="monitoring-instance_method">
  <h3 class='signature ro'>
    #<strong>monitoring</strong>  &#x21d2; <a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a>)</span>
&mdash;    <div class='inline'>
<p>monitoring The monitoring.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L311-L311'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='311' data-end='311'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 311</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_monitoring'>monitoring</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="options-instance_method">
  <h3 class='signature ro'>
    #<strong>options</strong>  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>The options hash.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L308-L308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='308' data-end='308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 308</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_options'>options</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="push_monitor_app_metadata-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>push_monitor_app_metadata</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L328-L328'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='328' data-end='328'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 328</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_push_monitor_app_metadata'>push_monitor_app_metadata</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="seeds-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>seeds</strong>  &#x21d2; <code>Array</code>&lt;<code>String</code>&gt;  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The addresses of seed servers. Contains addresses that were given to <code>Cluster</code> when it was instantiated, not current addresses that the cluster is using as a result of SDAM.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.7.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L336-L336'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='336' data-end='336'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 336</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_seeds'>seeds</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="server_selection_semaphore-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>server_selection_semaphore</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L493-L493'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='493' data-end='493'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 493</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_server_selection_semaphore'>server_selection_semaphore</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="session_pool-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>session_pool</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.1</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L341-L341'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='341' data-end='341'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 341</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_session_pool'>session_pool</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="srv_monitor-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>srv_monitor</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L363-L363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='363' data-end='363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 363</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_srv_monitor'>srv_monitor</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="topology-instance_method">
  <h3 class='signature ro'>
    #<strong>topology</strong>  &#x21d2; <code>Integer</code><sup>?</sup>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The logical session timeout value in minutes.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the logical session timeout in minutes.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>, <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The logical session timeout.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L316-L316'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='316' data-end='316'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 316</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_topology'>topology</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tracer-instance_method">
  <h3 class='signature ro'>
    #<strong>tracer</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L313-L313'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='313' data-end='313'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 313</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tracer'>tracer</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="==-instance_method">
  <h3 class='signature  first'>
    #<strong>==</strong>(other)  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if this cluster of servers is equal to another object. Checks the servers currently in the cluster, not what was configured.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Is the cluster equal to the object?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>other</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The object to compare to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the objects are equal.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L743-L746'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='743' data-end='746'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 743</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>==</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Cluster</span>)
  <span class='id identifier rubyid_addresses'><a href="#addresses-instance_method" title="Mongo::Cluster#addresses (method)">addresses</a></span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_addresses'><a href="#addresses-instance_method" title="Mongo::Cluster#addresses (method)">addresses</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="add-instance_method">
  <h3 class='signature '>
    #<strong>add</strong>(host, add_options = nil)  &#x21d2; <a href="Server.html" title="Mongo::Server (class)">Server</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add a server to the cluster with the provided address. Useful in auto-discovery of new servers when an existing server executes a hello and potentially non-configured servers were included.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Add the server for the address to the cluster.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_add'>add</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27018</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The address of the server to add.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Server.html" title="Mongo::Server (class)">Server</a>)</span>
&mdash;    <div class='inline'>
<p>The newly added server, if not present already.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L848-L876'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='848' data-end='876'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 848</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add'>add</span>(<span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_add_options'>add_options</span><span class='op'>=</span><span class='kw'>nil</span>)
  <span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Address.html" title="Mongo::Address (class)">Address</a></span>.<span class='id identifier rubyid_new'><a href="Address.html#new-class_method" title="Mongo::Address.new (method)">new</a></span>(<span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>)
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_addresses'><a href="#addresses-instance_method" title="Mongo::Cluster#addresses (method)">addresses</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_address'>address</span>)
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>monitor:</span> <span class='kw'>false</span>)
    <span class='comment'># If we aren&#39;t starting the montoring threads, we also don&#39;t want to
</span>    <span class='comment'># start the pool&#39;s populator thread.
</span>    <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='label'>populator_io:</span> <span class='kw'>false</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_monitoring_io'>monitoring_io</span><span class='comma'>,</span> <span class='kw'>true</span>)
    <span class='comment'># Note that in a load-balanced topology, every server must be a
</span>    <span class='comment'># load balancer (load_balancer: true is specified in the options)
</span>    <span class='comment'># but this option isn&#39;t set here because we are required by the
</span>    <span class='comment'># specifications to pretent the server started out as an unknown one
</span>    <span class='comment'># and publish server description change event into the load balancer
</span>    <span class='comment'># one. The actual correct description for this server will be set
</span>    <span class='comment'># by the fabricate_lb_sdam_events_and_set_server_type method.
</span>    <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'><a href="Server.html" title="Mongo::Server (class)">Server</a></span>.<span class='id identifier rubyid_new'><a href="Server.html#new-class_method" title="Mongo::Server.new (method)">new</a></span>(<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@monitoring</span><span class='comma'>,</span> <span class='id identifier rubyid_event_listeners'>event_listeners</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
    <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='comment'># Need to recheck whether server is present in @servers, because
</span>      <span class='comment'># the previous check was not under a lock.
</span>      <span class='comment'># Since we are under the update lock here, we cannot call servers_list.
</span>      <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@servers</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_address'>address</span>)

      <span class='ivar'>@servers</span>.<span class='id identifier rubyid_push'>push</span>(<span class='id identifier rubyid_server'>server</span>)
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_add_options'>add_options</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_add_options'>add_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_monitor'>monitor</span>] <span class='op'>!=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_start_monitoring'>start_monitoring</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_server'>server</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="addresses-instance_method">
  <h3 class='signature '>
    #<strong>addresses</strong>  &#x21d2; <code>Array</code>&lt;<a href="Address.html" title="Mongo::Address (class)">Mongo::Address</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The addresses in the cluster.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the addresses in the cluster.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_addresses'>addresses</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<a href="Address.html" title="Mongo::Address (class)">Mongo::Address</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The addresses.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.6</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L456-L458'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='456' data-end='458'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 456</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_addresses'>addresses</span>
  <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature nodoc'>
    #<strong>close</strong>  &#x21d2; <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Applications should call Client#close to disconnect from</p>
</div>
  </div>


<p>Closes the cluster.</p>

<p>the cluster rather than calling this method. This method is for internal driver use only.</p>

<p>Disconnects all servers in the cluster, publishing appropriate SDAM events in the process. Stops SRV monitoring if it is active. Marks the cluster disconnected.</p>

<p>A closed cluster is no longer usable. If the client is reconnected, it will create a new cluster instance.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Always nil.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L511-L543'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='511' data-end='543'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 511</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='ivar'>@state_change_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_connecting?'><a href="#connecting%3F-instance_method" title="Mongo::Cluster#connecting? (method)">connecting?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_connected?'><a href="#connected%3F-instance_method" title="Mongo::Cluster#connected? (method)">connected?</a></span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cleanup'>cleanup</span>] <span class='op'>!=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_session_pool'><a href="#session_pool-instance_method" title="Mongo::Cluster#session_pool (method)">session_pool</a></span>.<span class='id identifier rubyid_end_sessions'>end_sessions</span>
      <span class='ivar'>@periodic_executor</span>.<span class='id identifier rubyid_stop!'>stop!</span>
    <span class='kw'>end</span>
    <span class='ivar'>@srv_monitor_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@srv_monitor</span>
        <span class='ivar'>@srv_monitor</span>.<span class='id identifier rubyid_stop!'>stop!</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@servers</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_connected?'><a href="#connected%3F-instance_method" title="Mongo::Cluster#connected? (method)">connected?</a></span>
        <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_close'>close</span>
        <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span>(
          <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring.html#SERVER_CLOSED-constant" title="Mongo::Monitoring::SERVER_CLOSED (constant)">SERVER_CLOSED</a></span><span class='comma'>,</span>
          <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event/ServerClosed.html" title="Mongo::Monitoring::Event::ServerClosed (class)">ServerClosed</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring/Event/ServerClosed.html#new-class_method" title="Mongo::Monitoring::Event::ServerClosed.new (method)">new</a></span>(<span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>)
        )
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span>(
      <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring.html#TOPOLOGY_CLOSED-constant" title="Mongo::Monitoring::TOPOLOGY_CLOSED (constant)">TOPOLOGY_CLOSED</a></span><span class='comma'>,</span>
      <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event/TopologyClosed.html" title="Mongo::Monitoring::Event::TopologyClosed (class)">TopologyClosed</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring/Event/TopologyClosed.html#new-class_method" title="Mongo::Monitoring::Event::TopologyClosed.new (method)">new</a></span>(<span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>)
    )
    <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disconnect_server_if_connected-instance_method">
  <h3 class='signature nodoc'>
    #<strong>disconnect_server_if_connected</strong>(server)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L956-L965'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='956' data-end='965'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 956</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_disconnect_server_if_connected'>disconnect_server_if_connected</span>(<span class='id identifier rubyid_server'>server</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_connected?'><a href="#connected%3F-instance_method" title="Mongo::Cluster#connected? (method)">connected?</a></span>
    <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_clear_description'>clear_description</span>
    <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_disconnect!'>disconnect!</span>
    <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span>(
      <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring.html#SERVER_CLOSED-constant" title="Mongo::Monitoring::SERVER_CLOSED (constant)">SERVER_CLOSED</a></span><span class='comma'>,</span>
      <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event/ServerClosed.html" title="Mongo::Monitoring::Event::ServerClosed (class)">ServerClosed</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring/Event/ServerClosed.html#new-class_method" title="Mongo::Monitoring::Event::ServerClosed.new (method)">new</a></span>(<span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>)
    )
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fabricate_lb_sdam_events_and_set_server_type-instance_method">
  <h3 class='signature priv'>
    #<strong>fabricate_lb_sdam_events_and_set_server_type</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1066-L1091'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1066' data-end='1091'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 1066</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fabricate_lb_sdam_events_and_set_server_type'>fabricate_lb_sdam_events_and_set_server_type</span>
  <span class='comment'># Although there is no monitoring connection in load balanced mode,
</span>  <span class='comment'># we must emit the following series of SDAM events.
</span>  <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='ivar'>@servers</span>.<span class='id identifier rubyid_first'>first</span>
  <span class='comment'># We are guaranteed to have the server here.
</span>  <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_publish_opening_event'>publish_opening_event</span>
  <span class='id identifier rubyid_server_desc'>server_desc</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_description'>description</span>
  <span class='comment'># This is where a load balancer actually gets its correct server
</span>  <span class='comment'># description.
</span>  <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_update_description'>update_description</span>(
    <span class='const'><a href="Server.html" title="Mongo::Server (class)">Server</a></span><span class='op'>::</span><span class='const'><a href="Server/Description.html" title="Mongo::Server::Description (class)">Description</a></span>.<span class='id identifier rubyid_new'><a href="Server/Description.html#new-class_method" title="Mongo::Server::Description.new (method)">new</a></span>(<span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> {}<span class='comma'>,</span>
      <span class='label'>load_balancer:</span> <span class='kw'>true</span><span class='comma'>,</span>
      <span class='label'>force_load_balancer:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connect'>connect</span>] <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_load_balanced'>load_balanced</span><span class='comma'>,</span>
    )
  )
  <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span>(
    <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring.html#SERVER_DESCRIPTION_CHANGED-constant" title="Mongo::Monitoring::SERVER_DESCRIPTION_CHANGED (constant)">SERVER_DESCRIPTION_CHANGED</a></span><span class='comma'>,</span>
    <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event/ServerDescriptionChanged.html" title="Mongo::Monitoring::Event::ServerDescriptionChanged (class)">ServerDescriptionChanged</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring/Event/ServerDescriptionChanged.html#new-class_method" title="Mongo::Monitoring::Event::ServerDescriptionChanged.new (method)">new</a></span>(
      <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span><span class='comma'>,</span>
      <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span><span class='comma'>,</span>
      <span class='id identifier rubyid_server_desc'>server_desc</span><span class='comma'>,</span>
      <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_description'>description</span>
    )
  )
  <span class='id identifier rubyid_recreate_topology'><a href="#recreate_topology-instance_method" title="Mongo::Cluster#recreate_topology (method)">recreate_topology</a></span>(<span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span><span class='comma'>,</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="has_readable_server?-instance_method">
  <h3 class='signature '>
    #<strong>has_readable_server?</strong>(server_selector = nil)  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if the cluster would select a readable server for the provided read preference.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Is a readable server present?</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_has_readable_server?'>has_readable_server?</span>(<span class='id identifier rubyid_server_selector'>server_selector</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>server_selector</span>
    <span class='type'>(<a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The server selector.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If a readable server is present.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.4.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L760-L762'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='760' data-end='762'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 760</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_readable_server?'>has_readable_server?</span>(<span class='id identifier rubyid_server_selector'>server_selector</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_has_readable_server?'>has_readable_server?</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_server_selector'>server_selector</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="heartbeat_interval-instance_method">
  <h3 class='signature nodoc'>
    #<strong>heartbeat_interval</strong>  &#x21d2; <code>Float</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the refresh interval for the server. This will be defined via an option or will default to 10.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>The heartbeat interval, in seconds.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.10.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L408-L410'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='408' data-end='410'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 408</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_heartbeat_interval'>heartbeat_interval</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_heartbeat_frequency'>heartbeat_frequency</span>] <span class='op'>||</span> <span class='const'><a href="Server.html" title="Mongo::Server (class)">Server</a></span><span class='op'>::</span><span class='const'><a href="Server/Monitor.html" title="Mongo::Server::Monitor (class)">Monitor</a></span><span class='op'>::</span><span class='const'><a href="Server/Monitor.html#DEFAULT_HEARTBEAT_INTERVAL-constant" title="Mongo::Server::Monitor::DEFAULT_HEARTBEAT_INTERVAL (constant)">DEFAULT_HEARTBEAT_INTERVAL</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the nicer formatted string for use in inspection.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Inspect the cluster.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_inspect'>inspect</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The cluster inspection.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L478-L480'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='478' data-end='480'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 478</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Cluster:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> servers=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_servers'><a href="#servers-instance_method" title="Mongo::Cluster#servers (method)">servers</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> topology=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_summary'><a href="#summary-instance_method" title="Mongo::Cluster#summary (method)">summary</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_read_retries-instance_method">
  <h3 class='signature deprecated'>
    #<strong>max_read_retries</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>max_read_retries should be retrieved from the <a href="Client.html" title="Mongo::Client (class)"><code>Client</code></a> instance, not from a <code>Cluster</code> instance, because clusters may be shared between clients with different values for max read retries.</p>
</div>
  </div>


<p>Get the maximum number of times the client can retry a read operation when using legacy read retries.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the max read retries.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_max_read_retries'>max_read_retries</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The maximum number of retries.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.1</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L379-L381'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='379' data-end='381'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 379</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_max_read_retries'>max_read_retries</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_read_retries'>max_read_retries</span>] <span class='op'>||</span> <span class='const'><a href="#MAX_READ_RETRIES-constant" title="Mongo::Cluster::MAX_READ_RETRIES (constant)">MAX_READ_RETRIES</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="next_primary-instance_method">
  <h3 class='signature '>
    #<strong>next_primary</strong>(ping = nil, session = nil, timeout: nil)  &#x21d2; <a href="Server.html" title="Mongo::Server (class)">Mongo::Server</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the next primary server we can send an operation to.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the next primary server.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_next_primary'>next_primary</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>ping</span>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>Whether to ping the server before selection. Deprecated and ignored.</p>
</div>
  </li>
  <li>
    <span class='name'>session</span>
    <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a> | <code>nil</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>Optional session to take into account for mongos pinning.</p>
</div>
  </li>
  <li>
    <span class='name'>:timeout</span>
    <span class='type'>(<code>Float</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p><a href="Timeout.html" title="Mongo::Timeout (module)"><code>Timeout</code></a> in seconds for the operation, if any.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Server.html" title="Mongo::Server (class)">Mongo::Server</a>)</span>
&mdash;    <div class='inline'>
<p>A primary server.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L791-L798'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='791' data-end='798'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 791</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_next_primary'>next_primary</span>(<span class='id identifier rubyid_ping'>ping</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span>.<span class='id identifier rubyid_primary'><a href="ServerSelector.html#primary-instance_method" title="Mongo::ServerSelector#primary (method)">primary</a></span>.<span class='id identifier rubyid_select_server'>select_server</span>(
    <span class='kw'>self</span><span class='comma'>,</span>
    <span class='kw'>nil</span><span class='comma'>,</span>
    <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
    <span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pool-instance_method">
  <h3 class='signature deprecated'>
    #<strong>pool</strong>(server)  &#x21d2; <a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">Server::ConnectionPool</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

<p>Get the connection pool for the server.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the connection pool.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_pool'>pool</span>(<span class='id identifier rubyid_server'>server</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>server</span>
    <span class='type'>(<a href="Server.html" title="Mongo::Server (class)">Server</a>)</span>
&mdash;    <div class='inline'>
<p>The server.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">Server::ConnectionPool</a>)</span>
&mdash;    <div class='inline'>
<p>The connection pool.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.2.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L811-L813'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='811' data-end='813'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 811</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pool'>pool</span>(<span class='id identifier rubyid_server'>server</span>)
  <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_pool'>pool</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="possibly_warn_about_compatibility!-instance_method">
  <h3 class='signature priv'>
    #<strong>possibly_warn_about_compatibility!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Compares the server hosts with address suffixes of known services that provide limited MongoDB API compatibility, and warns about them.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1113-L1123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1113' data-end='1123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 1113</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_possibly_warn_about_compatibility!'>possibly_warn_about_compatibility!</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_server_hosts_match_any?'>server_hosts_match_any?</span>(<span class='const'><a href="#COSMOSDB_HOST_PATTERNS-constant" title="Mongo::Cluster::COSMOSDB_HOST_PATTERNS (constant)">COSMOSDB_HOST_PATTERNS</a></span>)
    <span class='id identifier rubyid_log_info'>log_info</span> <span class='const'><a href="#COSMOSDB_LOG_MESSAGE-constant" title="Mongo::Cluster::COSMOSDB_LOG_MESSAGE (constant)">COSMOSDB_LOG_MESSAGE</a></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_server_hosts_match_any?'>server_hosts_match_any?</span>(<span class='const'><a href="#DOCUMENTDB_HOST_PATTERNS-constant" title="Mongo::Cluster::DOCUMENTDB_HOST_PATTERNS (constant)">DOCUMENTDB_HOST_PATTERNS</a></span>)
    <span class='id identifier rubyid_log_info'>log_info</span> <span class='const'><a href="#DOCUMENTDB_LOG_MESSAGE-constant" title="Mongo::Cluster::DOCUMENTDB_LOG_MESSAGE (constant)">DOCUMENTDB_LOG_MESSAGE</a></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_sessions_not_supported-instance_method">
  <h3 class='signature priv'>
    #<strong>raise_sessions_not_supported</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Error/SessionsNotSupported.html" title="Mongo::Error::SessionsNotSupported (class)">Error::SessionsNotSupported</a>)</span>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1050-L1064'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1050' data-end='1064'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 1050</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_raise_sessions_not_supported'>raise_sessions_not_supported</span>
  <span class='comment'># Intentionally using @servers instead of +servers+ here because we
</span>  <span class='comment'># are supposed to be already holding the @update_lock and we cannot
</span>  <span class='comment'># recursively acquire it again.
</span>  <span class='id identifier rubyid_offending_servers'>offending_servers</span> <span class='op'>=</span> <span class='ivar'>@servers</span>.<span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
    <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_description'>description</span>.<span class='id identifier rubyid_data_bearing?'>data_bearing?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>.<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_reason'>reason</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_offending_servers'>offending_servers</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There are no known data bearing servers (current seeds: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@servers</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_seed'>seed</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The following servers have null logical session timeout: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_offending_servers'>offending_servers</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_seed'>seed</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The deployment that the driver is connected to does not support sessions: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reason'>reason</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SessionsNotSupported.html" title="Mongo::Error::SessionsNotSupported (class)">SessionsNotSupported</a></span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_retry_interval-instance_method">
  <h3 class='signature deprecated'>
    #<strong>read_retry_interval</strong>  &#x21d2; <code>Float</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'></div></div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>read_retry_interval should be retrieved from the <a href="Client.html" title="Mongo::Client (class)"><code>Client</code></a> instance, not from a <code>Cluster</code> instance, because clusters may be shared between clients with different values for the read retry interval.</p>
</div>
  </div>


<p>Get the interval, in seconds, in which read retries when using legacy read retries.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the read retry interval.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>The interval.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.1</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L397-L399'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='397' data-end='399'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 397</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span>] <span class='op'>||</span> <span class='const'><a href="#READ_RETRY_INTERVAL-constant" title="Mongo::Cluster::READ_RETRY_INTERVAL (constant)">READ_RETRY_INTERVAL</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reconnect!-instance_method">
  <h3 class='signature deprecated'>
    #<strong>reconnect!</strong>  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>Use Client#reconnect to reconnect to the cluster instead of calling this method. This method does not send SDAM events.</p>
</div></div>

<p>Reconnect all servers.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Reconnect the cluster’s servers.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_reconnect!'>reconnect!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>Always true.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L555-L575'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='555' data-end='575'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 555</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reconnect!'>reconnect!</span>
  <span class='ivar'>@state_change_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_scan!'><a href="#scan!-instance_method" title="Mongo::Cluster#scan! (method)">scan!</a></span>
    <span class='id identifier rubyid_servers'><a href="#servers-instance_method" title="Mongo::Cluster#servers (method)">servers</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_reconnect!'>reconnect!</span>
    <span class='kw'>end</span>
    <span class='ivar'>@periodic_executor</span>.<span class='id identifier rubyid_restart!'>restart!</span>
    <span class='ivar'>@srv_monitor_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@srv_monitor</span>
        <span class='ivar'>@srv_monitor</span>.<span class='id identifier rubyid_run!'>run!</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@connecting</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='ivar'>@connected</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recreate_topology-instance_method">
  <h3 class='signature priv'>
    #<strong>recreate_topology</strong>(new_topology_template, previous_topology)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1093-L1099'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1093' data-end='1099'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 1093</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_recreate_topology'>recreate_topology</span>(<span class='id identifier rubyid_new_topology_template'>new_topology_template</span><span class='comma'>,</span> <span class='id identifier rubyid_previous_topology'>previous_topology</span>)
  <span class='ivar'>@topology</span> <span class='op'>=</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Cluster.new (method)">new</a></span>(<span class='id identifier rubyid_new_topology_template'>new_topology_template</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span><span class='comma'>,</span> <span class='id identifier rubyid_new_topology_template'>new_topology_template</span>.<span class='id identifier rubyid_monitoring'><a href="#monitoring-instance_method" title="Mongo::Cluster#monitoring (method)">monitoring</a></span><span class='comma'>,</span> <span class='kw'>self</span>)
  <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span>(
    <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring.html#TOPOLOGY_CHANGED-constant" title="Mongo::Monitoring::TOPOLOGY_CHANGED (constant)">TOPOLOGY_CHANGED</a></span><span class='comma'>,</span>
    <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event/TopologyChanged.html" title="Mongo::Monitoring::Event::TopologyChanged (class)">TopologyChanged</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring/Event/TopologyChanged.html#new-class_method" title="Mongo::Monitoring::Event::TopologyChanged.new (method)">new</a></span>(<span class='id identifier rubyid_previous_topology'>previous_topology</span><span class='comma'>,</span> <span class='ivar'>@topology</span>)
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remove-instance_method">
  <h3 class='signature '>
    #<strong>remove</strong>(host, disconnect: true)  &#x21d2; <code>Array</code>&lt;<a href="Server.html" title="Mongo::Server (class)">Server</a>&gt; | <code>true</code> | <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The return value of this method is not part of the driver’s public API.</p>
</div>
  </div>


<p>Remove the server from the cluster for the provided address, if it exists.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Remove the server from the cluster.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_remove'>remove</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>host</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The host/port or socket address.</p>
</div>
  </li>
  <li>
    <span class='name'>disconnect</span>
    <span class='type'>(<code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>Whether to disconnect the servers being removed. For internal driver use only.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<a href="Server.html" title="Mongo::Server (class)">Server</a>&gt; | <code>true</code> | <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If disconnect is any value other than false, including nil, returns whether any servers were removed. If disconnect is false, returns an array of servers that were removed (and should be disconnected by the caller).</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L897-L919'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='897' data-end='919'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 897</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_remove'>remove</span>(<span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='label'>disconnect:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Address.html" title="Mongo::Address (class)">Address</a></span>.<span class='id identifier rubyid_new'><a href="Address.html#new-class_method" title="Mongo::Address.new (method)">new</a></span>(<span class='id identifier rubyid_host'>host</span>)
  <span class='id identifier rubyid_removed_servers'>removed_servers</span> <span class='op'>=</span> []
  <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@servers</span>.<span class='id identifier rubyid_delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      (<span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>==</span> <span class='id identifier rubyid_address'>address</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_delete'>delete</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_delete'>delete</span>
          <span class='id identifier rubyid_removed_servers'>removed_servers</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_server'>server</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_disconnect'>disconnect</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_removed_servers'>removed_servers</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_disconnect_server_if_connected'><a href="#disconnect_server_if_connected-instance_method" title="Mongo::Cluster#disconnect_server_if_connected (method)">disconnect_server_if_connected</a></span>(<span class='id identifier rubyid_server'>server</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_disconnect'>disconnect</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_removed_servers'>removed_servers</span>.<span class='id identifier rubyid_any?'>any?</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_removed_servers'>removed_servers</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run_sdam_flow-instance_method">
  <h3 class='signature nodoc'>
    #<strong>run_sdam_flow</strong>(previous_desc, updated_desc, options = {})  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Runs SDAM flow on the cluster.</p>

<p>This method can be invoked to process a new server description returned by the server on a monitoring or non-monitoring connection, and also by the driver when it marks a server unknown as a result of a (network) error.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>previous_desc</span>
    <span class='type'>(<a href="Server/Description.html" title="Mongo::Server::Description (class)">Server::Description</a>)</span>
&mdash;    <div class='inline'>
<p>Previous server description.</p>
</div>
  </li>
  <li>
    <span class='name'>updated_desc</span>
    <span class='type'>(<a href="Server/Description.html" title="Mongo::Server::Description (class)">Server::Description</a>)</span>
&mdash;    <div class='inline'>
<p>The changed description.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p><a href="Options.html" title="Mongo::Options (module)"><code>Options</code></a>.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:keep_connection_pool</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Usually when the new server description is unknown, the connection pool on the respective server is cleared. Set this option to true to keep the existing connection pool (required when handling not master errors on 4.2+ servers).</p>
</div>        </li>
        <li>
          <span class='name'>:awaited</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether the updated description was a result of processing an awaited hello.</p>
</div>        </li>
        <li>
          <span class='name'>:service_id</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>Change state for the specified service id only.</p>
</div>        </li>
        <li>
          <span class='name'>:scan_error</span>
          <span class='type'>(<a href="Error.html" title="Mongo::Error (class)">Mongo::Error</a> | <code>nil</code>)</span>
            &mdash; <div class='inline'>
<p>The error encountered while scanning, or nil if no error was raised.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L641-L696'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='641' data-end='696'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 641</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_run_sdam_flow'>run_sdam_flow</span>(<span class='id identifier rubyid_previous_desc'>previous_desc</span><span class='comma'>,</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='kw'>if</span> <span class='id identifier rubyid_load_balanced?'><a href="#load_balanced%3F-instance_method" title="Mongo::Cluster#load_balanced? (method)">load_balanced?</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_keep_connection_pool'>keep_connection_pool</span>]
        <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
          <span class='comment'># TODO should service id be taken out of updated_desc?
</span>          <span class='comment'># We could also assert that
</span>          <span class='comment'># options[:service_id] == updated_desc.service_id
</span>          <span class='id identifier rubyid_err'>err</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_scan_error'>scan_error</span>]
          <span class='id identifier rubyid_interrupt'>interrupt</span> <span class='op'>=</span> <span class='id identifier rubyid_err'>err</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span>))
          <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_clear_connection_pool'>clear_connection_pool</span>(<span class='label'>service_id:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_service_id'>service_id</span>]<span class='comma'>,</span> <span class='label'>interrupt_in_use_connections:</span> <span class='id identifier rubyid_interrupt'>interrupt</span>)
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='ivar'>@sdam_flow_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_flow'>flow</span> <span class='op'>=</span> <span class='const'><a href="Cluster/SdamFlow.html" title="Mongo::Cluster::SdamFlow (class)">SdamFlow</a></span>.<span class='id identifier rubyid_new'><a href="Cluster/SdamFlow.html#new-class_method" title="Mongo::Cluster::SdamFlow.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_previous_desc'>previous_desc</span><span class='comma'>,</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span><span class='comma'>,</span>
      <span class='label'>awaited:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_awaited'>awaited</span>])
    <span class='id identifier rubyid_flow'>flow</span>.<span class='id identifier rubyid_server_description_changed'>server_description_changed</span>

    <span class='comment'># SDAM flow may alter the updated description - grab the final
</span>    <span class='comment'># version for the purposes of broadcasting if a server is available
</span>    <span class='id identifier rubyid_updated_desc'>updated_desc</span> <span class='op'>=</span> <span class='id identifier rubyid_flow'>flow</span>.<span class='id identifier rubyid_updated_desc'>updated_desc</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_keep_connection_pool'>keep_connection_pool</span>]
      <span class='kw'>if</span> <span class='id identifier rubyid_flow'>flow</span>.<span class='id identifier rubyid_became_unknown?'>became_unknown?</span>
        <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>==</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span>.<span class='id identifier rubyid_address'>address</span>
            <span class='id identifier rubyid_err'>err</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_scan_error'>scan_error</span>]
            <span class='id identifier rubyid_interrupt'>interrupt</span> <span class='op'>=</span> <span class='id identifier rubyid_err'>err</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SocketError.html" title="Mongo::Error::SocketError (class)">SocketError</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span>))
            <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_clear_connection_pool'>clear_connection_pool</span>(<span class='label'>interrupt_in_use_connections:</span> <span class='id identifier rubyid_interrupt'>interrupt</span>)
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_start_stop_srv_monitor'><a href="#start_stop_srv_monitor-instance_method" title="Mongo::Cluster#start_stop_srv_monitor (method)">start_stop_srv_monitor</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Some updated descriptions, e.g. a mismatched me one, result in the
</span>  <span class='comment'># server whose description we are processing being removed from
</span>  <span class='comment'># the topology. When this happens, the server&#39;s monitoring thread gets
</span>  <span class='comment'># killed. As a result, any code after the flow invocation may not run
</span>  <span class='comment'># a particular monitor instance, hence there should generally not be
</span>  <span class='comment'># any code in this method past the flow invocation.
</span>  <span class='comment'>#
</span>  <span class='comment'># However, this broadcast call can be here because if the monitoring
</span>  <span class='comment'># thread got killed the server should have been closed and no client
</span>  <span class='comment'># should be currently waiting for it, thus not signaling the semaphore
</span>  <span class='comment'># shouldn&#39;t cause any problems.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_updated_desc'>updated_desc</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>
    <span class='id identifier rubyid_server_selection_semaphore'><a href="#server_selection_semaphore-instance_method" title="Mongo::Cluster#server_selection_semaphore (method)">server_selection_semaphore</a></span>.<span class='id identifier rubyid_broadcast'>broadcast</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scan!-instance_method">
  <h3 class='signature '>
    #<strong>scan!</strong>(sync = true)  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>In both synchronous and asynchronous scans, each monitor thread maintains a minimum interval between scans, meaning calling this method may not initiate a scan on a particular server the very next instant.</p>
</div>
  </div>


<p>Force a scan of all known servers in the cluster.</p>

<p>If the sync parameter is true which is the default, the scan is performed synchronously in the thread which called this method. Each server in the cluster is checked sequentially. If there are many servers in the cluster or they are slow to respond, this can be a long running operation.</p>

<p>If the sync parameter is false, this method instructs all server monitor threads to perform an immediate scan and returns without waiting for scan results.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Force a full cluster scan.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_scan!'>scan!</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>Always true.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L600-L615'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='600' data-end='615'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 600</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_scan!'>scan!</span>(<span class='id identifier rubyid_sync'>sync</span><span class='op'>=</span><span class='kw'>true</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_sync'>sync</span>
    <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_monitor'>monitor</span>
        <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_monitor'>monitor</span>.<span class='id identifier rubyid_scan!'>scan!</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Synchronous scan requested on cluster </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_summary'><a href="#summary-instance_method" title="Mongo::Cluster#summary (method)">summary</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> but server </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server'>server</span><span class='embexpr_end'>}</span><span class='tstring_content'> has no monitor</span><span class='tstring_end'>&quot;</span></span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_scan_semaphore'>scan_semaphore</span>.<span class='id identifier rubyid_signal'>signal</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="servers-instance_method">
  <h3 class='signature '>
    #<strong>servers</strong>  &#x21d2; <code>Array</code>&lt;<a href="Server.html" title="Mongo::Server (class)">Server</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get a list of server candidates from the cluster that can have operations executed on them.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the server candidates for an operation.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_servers'>servers</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<a href="Server.html" title="Mongo::Server (class)">Server</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The candidate servers.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L444-L446'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='444' data-end='446'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 444</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_servers'>servers</span>
  <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_servers'>servers</span>(<span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="servers_list-instance_method">
  <h3 class='signature nodoc'>
    #<strong>servers_list</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L949-L953'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='949' data-end='953'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 949</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_servers_list'>servers_list</span>
  <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@servers</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_server_list-instance_method">
  <h3 class='signature nodoc'>
    #<strong>set_server_list</strong>(server_address_strs)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the list of servers to the addresses in the provided list of address strings.</p>

<p>This method is called by the SRV monitor after receiving new DNS records for the monitored hostname.</p>

<p>Removes servers in the cluster whose addresses are not in the passed list of server addresses, and adds servers for any addresses in the argument which are not already in the cluster.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>server_address_strs</span>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>List of server addresses to sync the cluster servers to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L712-L730'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='712' data-end='730'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 712</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_server_list'>set_server_list</span>(<span class='id identifier rubyid_server_address_strs'>server_address_strs</span>)
  <span class='ivar'>@sdam_flow_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='comment'># If one of the new addresses is not in the current servers list,
</span>    <span class='comment'># add it to the servers list.
</span>    <span class='id identifier rubyid_server_address_strs'>server_address_strs</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_address_str'>address_str</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_seed'>seed</span> <span class='op'>==</span> <span class='id identifier rubyid_address_str'>address_str</span> }
        <span class='id identifier rubyid_add'><a href="#add-instance_method" title="Mongo::Cluster#add (method)">add</a></span>(<span class='id identifier rubyid_address_str'>address_str</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># If one of the servers&#39; addresses are not in the new address list,
</span>    <span class='comment'># remove that server from the servers list.
</span>    <span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_server_address_strs'>server_address_strs</span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_address_str'>address_str</span><span class='op'>|</span> <span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_seed'>seed</span> <span class='op'>==</span> <span class='id identifier rubyid_address_str'>address_str</span> }
        <span class='id identifier rubyid_remove'><a href="#remove-instance_method" title="Mongo::Cluster#remove (method)">remove</a></span>(<span class='id identifier rubyid_server'>server</span>.<span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_seed'>seed</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start_stop_srv_monitor-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>start_stop_srv_monitor</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L1022-L1048'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1022' data-end='1048'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 1022</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_start_stop_srv_monitor'>start_stop_srv_monitor</span>
  <span class='comment'># SRV URI is either always given or not for a given cluster, if one
</span>  <span class='comment'># wasn&#39;t given we shouldn&#39;t ever have an SRV monitor to manage.
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_srv_uri'>srv_uri</span>]

  <span class='kw'>if</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span><span class='op'>::</span><span class='const'><a href="Cluster/Topology/Sharded.html" title="Mongo::Cluster::Topology::Sharded (class)">Sharded</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span><span class='op'>::</span><span class='const'><a href="Cluster/Topology/Unknown.html" title="Mongo::Cluster::Topology::Unknown (class)">Unknown</a></span>)
    <span class='comment'># Start SRV monitor
</span>    <span class='ivar'>@srv_monitor_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>unless</span> <span class='ivar'>@srv_monitor</span>
        <span class='id identifier rubyid_monitor_options'>monitor_options</span> <span class='op'>=</span> <span class='const'><a href="Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_shallow_symbolize_keys'>shallow_symbolize_keys</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(
          <span class='label'>timeout:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Cluster#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span>] <span class='op'>||</span> <span class='const'><a href="Server.html" title="Mongo::Server (class)">Server</a></span><span class='op'>::</span><span class='const'><a href="Server.html#CONNECT_TIMEOUT-constant" title="Mongo::Server::CONNECT_TIMEOUT (constant)">CONNECT_TIMEOUT</a></span>))
        <span class='ivar'>@srv_monitor</span> <span class='op'>=</span> <span class='id identifier rubyid__srv_monitor'>_srv_monitor</span> <span class='op'>=</span> <span class='const'><a href="Srv.html" title="Mongo::Srv (module)">Srv</a></span><span class='op'>::</span><span class='const'><a href="Srv/Monitor.html" title="Mongo::Srv::Monitor (class)">Monitor</a></span>.<span class='id identifier rubyid_new'><a href="Srv/Monitor.html#new-class_method" title="Mongo::Srv::Monitor.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_monitor_options'>monitor_options</span>)
      <span class='kw'>end</span>
      <span class='ivar'>@srv_monitor</span>.<span class='id identifier rubyid_run!'>run!</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Stop SRV monitor if running. This path is taken when the client
</span>    <span class='comment'># is given an SRV URI to a standalone/replica set; when the topology
</span>    <span class='comment'># is discovered, since it&#39;s not a sharded cluster, the SRV monitor
</span>    <span class='comment'># needs to be stopped.
</span>    <span class='ivar'>@srv_monitor_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@srv_monitor</span>
        <span class='ivar'>@srv_monitor</span>.<span class='id identifier rubyid_stop!'>stop!</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="summary-instance_method">
  <h3 class='signature '>
    #<strong>summary</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This method is experimental and subject to change.</p>
</div>
  </div>


  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.7.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L486-L490'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='486' data-end='490'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 486</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Cluster </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>topology=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='op'>+</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>servers=[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_servers_list'><a href="#servers_list-instance_method" title="Mongo::Cluster#servers_list (method)">servers_list</a></span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_summary'>summary</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>]&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_cluster_time-instance_method">
  <h3 class='signature '>
    #<strong>update_cluster_time</strong>(result)  &#x21d2; <code>Object</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Update the max cluster time seen in a response.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Update the cluster time.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cluster'>cluster</span>.<span class='id identifier rubyid_update_cluster_time'>update_cluster_time</span>(<span class='id identifier rubyid_result'>result</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>result</span>
    <span class='type'>(<a href="Operation/Result.html" title="Mongo::Operation::Result (class)">Operation::Result</a>)</span>
&mdash;    <div class='inline'>
<p>The operation result containing the cluster time.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The cluster time.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L825-L831'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='825' data-end='831'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 825</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_cluster_time'>update_cluster_time</span>(<span class='id identifier rubyid_result'>result</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_cluster_time_doc'>cluster_time_doc</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_cluster_time'>cluster_time</span>
    <span class='ivar'>@cluster_time_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_advance_cluster_time'>advance_cluster_time</span>(<span class='id identifier rubyid_cluster_time_doc'>cluster_time_doc</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_topology-instance_method">
  <h3 class='signature nodoc'>
    #<strong>update_topology</strong>(new_topology)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L922-L946'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='922' data-end='946'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 922</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_topology'>update_topology</span>(<span class='id identifier rubyid_new_topology'>new_topology</span>)
  <span class='id identifier rubyid_old_topology'>old_topology</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_old_topology'>old_topology</span> <span class='op'>=</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>
    <span class='ivar'>@topology</span> <span class='op'>=</span> <span class='id identifier rubyid_new_topology'>new_topology</span>
  <span class='kw'>end</span>

  <span class='comment'># If new topology has data bearing servers, we know for sure whether
</span>  <span class='comment'># sessions are supported - update our cached value.
</span>  <span class='comment'># If new topology has no data bearing servers, leave the old value
</span>  <span class='comment'># as it is and sessions_supported? method will perform server selection
</span>  <span class='comment'># to try to determine session support accurately, falling back to the
</span>  <span class='comment'># last known value.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_data_bearing_servers?'>data_bearing_servers?</span>
    <span class='id identifier rubyid_sessions_supported'>sessions_supported</span> <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>
    <span class='ivar'>@update_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='ivar'>@sessions_supported</span> <span class='op'>=</span> <span class='id identifier rubyid_sessions_supported'>sessions_supported</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_publish_sdam_event'>publish_sdam_event</span>(
    <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring.html#TOPOLOGY_CHANGED-constant" title="Mongo::Monitoring::TOPOLOGY_CHANGED (constant)">TOPOLOGY_CHANGED</a></span><span class='comma'>,</span>
    <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event.html" title="Mongo::Monitoring::Event (module)">Event</a></span><span class='op'>::</span><span class='const'><a href="Monitoring/Event/TopologyChanged.html" title="Mongo::Monitoring::Event::TopologyChanged (class)">TopologyChanged</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring/Event/TopologyChanged.html#new-class_method" title="Mongo::Monitoring::Event::TopologyChanged.new (method)">new</a></span>(<span class='id identifier rubyid_old_topology'>old_topology</span><span class='comma'>,</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>)
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_session_support!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>validate_session_support!</strong>(timeout: nil)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises Error::SessionsNotAvailable if the deployment that the driver is connected to does not support sessions.</p>

<p><a href="Session.html" title="Mongo::Session (class)"><code>Session</code></a> support may change over time, for example due to servers in the deployment being upgraded or downgraded.  If the client isn’t connected to any servers and doesn’t find any servers for the duration of server selection timeout, this method will raise NoServerAvailable. This method is called from the operation execution flow, and if it raises NoServerAvailable the entire operation will fail with that exception, since the operation execution has waited for the server selection timeout for any server to become available (which would be a superset of the servers suitable for the operation being attempted) and none materialized.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>:timeout</span>
    <span class='type'>(<code>Float</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p><a href="Timeout.html" title="Mongo::Timeout (module)"><code>Timeout</code></a> for the validation. Since the validation process involves server selection,</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>Error::SessionsNotAvailable</code>)</span>
&mdash;    <div class='inline'>
<p>If the deployment that the driver is connected to does not support sessions.</p>
</div>
  </li>
  <li>
    <span class='type'>(<a href="Error/NoServerAvailable.html" title="Mongo::Error::NoServerAvailable (class)">Error::NoServerAvailable</a>)</span>
&mdash;    <div class='inline'>
<p>If the client isn’t connected to any servers and doesn’t find any servers for the duration of server selection timeout.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/cluster.rb#L991-L1017'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='991' data-end='1017'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/cluster.rb', line 991</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_session_support!'>validate_session_support!</span>(<span class='label'>timeout:</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span><span class='op'>::</span><span class='const'><a href="Cluster/Topology/LoadBalanced.html" title="Mongo::Cluster::Topology::LoadBalanced (class)">LoadBalanced</a></span>)
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='ivar'>@state_change_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@sdam_flow_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_data_bearing_servers?'>data_bearing_servers?</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>
          <span class='id identifier rubyid_raise_sessions_not_supported'><a href="#raise_sessions_not_supported-instance_method" title="Mongo::Cluster#raise_sessions_not_supported (method)">raise_sessions_not_supported</a></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># No data bearing servers known - perform server selection to try to
</span>  <span class='comment'># get a response from at least one of them, to return an accurate
</span>  <span class='comment'># assessment of whether sessions are currently supported.
</span>  <span class='const'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span>.<span class='id identifier rubyid_get'><a href="ServerSelector.html#get-instance_method" title="Mongo::ServerSelector#get (method)">get</a></span>(<span class='label'>mode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_primary_preferred'>primary_preferred</span>).<span class='id identifier rubyid_select_server'>select_server</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span>)
  <span class='ivar'>@state_change_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@sdam_flow_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_topology'><a href="#topology-instance_method" title="Mongo::Cluster#topology (method)">topology</a></span>.<span class='id identifier rubyid_logical_session_timeout'>logical_session_timeout</span>
        <span class='id identifier rubyid_raise_sessions_not_supported'><a href="#raise_sessions_not_supported-instance_method" title="Mongo::Cluster#raise_sessions_not_supported (method)">raise_sessions_not_supported</a></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>