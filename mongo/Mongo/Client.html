<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Mongo::Client &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Mongo::Client",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Mongo master</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../Mongo.html" title="Mongo (module)">Mongo</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Client&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Mongo::Client</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Forwardable
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Loggable.html" title="Mongo::Loggable (module)"><code>Loggable</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L24'>lib/mongo/client.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The client is the entry point to the driver and is the main object that will be interacted with.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='CRUD_OPTIONS-constant' class='summary_signature'>CRUD_OPTIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The options that do not affect the behavior of a cluster and its subcomponents.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L32-L50'># File 'lib/mongo/client.rb', line 32</a>    <pre class='code ruby'>[
  <span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'><a href="#read_concern-instance_method" title="Mongo::Client#read_concern (method)">read_concern</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_retry_reads'>retry_reads</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_read_retries'><a href="#max_read_retries-instance_method" title="Mongo::Client#max_read_retries (method)">max_read_retries</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_read_retry_interval'><a href="#read_retry_interval-instance_method" title="Mongo::Client#read_retry_interval (method)">read_retry_interval</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_retry_writes'>retry_writes</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_write_retries'><a href="#max_write_retries-instance_method" title="Mongo::Client#max_write_retries (method)">max_write_retries</a></span><span class='comma'>,</span>

  <span class='comment'># Options which cannot currently be here:
</span>  <span class='comment'>#
</span>  <span class='comment'># :server_selection_timeout
</span>  <span class='comment'># Server selection timeout is used by cluster constructor to figure out
</span>  <span class='comment'># how long to wait for initial scan in compatibility mode, but once
</span>  <span class='comment'># the cluster is initialized it no longer uses this timeout.
</span>  <span class='comment'># Unfortunately server selector reads server selection timeout out of
</span>  <span class='comment'># the cluster, and this behavior is required by Cluster#next_primary
</span>  <span class='comment'># which takes no arguments. When next_primary is removed we can revsit
</span>  <span class='comment'># using the same cluster object with different server selection timeouts.
</span>].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='VALID_COMPRESSORS-constant' class='summary_signature'>VALID_COMPRESSORS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The compression algorithms supported by the driver.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L128-L132'># File 'lib/mongo/client.rb', line 128</a>    <pre class='code ruby'>[
  <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="Protocol/Compressed.html" title="Mongo::Protocol::Compressed (class)">Compressed</a></span><span class='op'>::</span><span class='const'><a href="Protocol/Compressed.html#ZSTD-constant" title="Mongo::Protocol::Compressed::ZSTD (constant)">ZSTD</a></span><span class='comma'>,</span>
  <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="Protocol/Compressed.html" title="Mongo::Protocol::Compressed (class)">Compressed</a></span><span class='op'>::</span><span class='const'><a href="Protocol/Compressed.html#SNAPPY-constant" title="Mongo::Protocol::Compressed::SNAPPY (constant)">SNAPPY</a></span><span class='comma'>,</span>
  <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Protocol.html" title="Mongo::Protocol (module)">Protocol</a></span><span class='op'>::</span><span class='const'><a href="Protocol/Compressed.html" title="Mongo::Protocol::Compressed (class)">Compressed</a></span><span class='op'>::</span><span class='const'><a href="Protocol/Compressed.html#ZLIB-constant" title="Mongo::Protocol::Compressed::ZLIB (constant)">ZLIB</a></span>
].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='VALID_OPTIONS-constant' class='summary_signature'>VALID_OPTIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Valid client options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.2</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L55-L123'># File 'lib/mongo/client.rb', line 55</a>    <pre class='code ruby'>[
  <span class='symbeg'>:</span><span class='id identifier rubyid_app_name'>app_name</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech'>auth_mech</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech_properties'>auth_mech_properties</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_auth_source'>auth_source</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_bg_error_backtrace'>bg_error_backtrace</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_cleanup'>cleanup</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_compressors'>compressors</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_direct_connection'>direct_connection</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_connect'>connect</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_heartbeat_frequency'>heartbeat_frequency</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_id_generator'>id_generator</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_load_balanced'>load_balanced</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_local_threshold'>local_threshold</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_logger'>logger</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_log_prefix'>log_prefix</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_connecting'>max_connecting</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_idle_time'>max_idle_time</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_pool_size'>max_pool_size</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_read_retries'><a href="#max_read_retries-instance_method" title="Mongo::Client#max_read_retries (method)">max_read_retries</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_max_write_retries'><a href="#max_write_retries-instance_method" title="Mongo::Client#max_write_retries (method)">max_write_retries</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_min_pool_size'>min_pool_size</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_monitoring'><a href="#monitoring-instance_method" title="Mongo::Client#monitoring (method)">monitoring</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_monitoring_io'>monitoring_io</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_password'>password</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_platform'>platform</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_populator_io'>populator_io</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'><a href="#read_concern-instance_method" title="Mongo::Client#read_concern (method)">read_concern</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read_retry_interval'><a href="#read_retry_interval-instance_method" title="Mongo::Client#read_retry_interval (method)">read_retry_interval</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_replica_set'>replica_set</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_resolv_options'>resolv_options</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_retry_reads'>retry_reads</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_retry_writes'>retry_writes</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_scan'>scan</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_sdam_proc'>sdam_proc</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_server_selection_timeout'>server_selection_timeout</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_socket_timeout'>socket_timeout</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_srv_max_hosts'>srv_max_hosts</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_srv_service_name'>srv_service_name</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl'>ssl</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert'>ssl_ca_cert</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_object'>ssl_ca_cert_object</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_ca_cert_string'>ssl_ca_cert_string</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert'>ssl_cert</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert_object'>ssl_cert_object</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_cert_string'>ssl_cert_string</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key'>ssl_key</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_object'>ssl_key_object</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_pass_phrase'>ssl_key_pass_phrase</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_key_string'>ssl_key_string</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify'>ssl_verify</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_certificate'>ssl_verify_certificate</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_hostname'>ssl_verify_hostname</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_verify_ocsp_endpoint'>ssl_verify_ocsp_endpoint</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Client#timeout_ms (method)">timeout_ms</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_tracing'>tracing</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_truncate_logs'>truncate_logs</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_wait_queue_timeout'>wait_queue_timeout</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_wrapping_libraries'>wrapping_libraries</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_zlib_compression_level'>zlib_compression_level</span><span class='comma'>,</span>
].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='VALID_SERVER_API_VERSIONS-constant' class='summary_signature'>VALID_SERVER_API_VERSIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The known server API versions.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
    <a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L135-L137'># File 'lib/mongo/client.rb', line 135</a>    <pre class='code ruby'><span class='qwords'><span class='qwords_beg'>%w(</span><span class='words_sep'>
</span><span class='words_sep'>  </span><span class='tstring_content'>1</span><span class='words_sep'>
</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="Loggable.html" title="Mongo::Loggable (module)"><code>Loggable</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="Loggable.html#PREFIX-constant" title="Mongo::Loggable::PREFIX (constant)">PREFIX</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#canonicalize_ruby_options-class_method" title=".canonicalize_ruby_options (class method)">.<strong>canonicalize_ruby_options</strong>(options)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Lowercases auth mechanism properties, if given, in the specified options, then converts the options to an instance of <a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)"><code>Options::Redacted</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(addresses_or_uri, options = nil)  &#x21d2; Client </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Instantiate a new driver client.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#cluster-instance_method" title="#cluster (instance method)">#<strong>cluster</strong>  &#x21d2; Mongo::Cluster </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#database-instance_method" title="#database (instance method)">#<strong>database</strong>  &#x21d2; Mongo::Database </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#encrypter-instance_method" title="#encrypter (instance method)">#<strong>encrypter</strong>  &#x21d2; Mongo::Crypt::AutoEncrypter </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#options-instance_method" title="#options (instance method)">#<strong>options</strong>  &#x21d2; Hash </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; true, false </a>
      (also: #eql?)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Determine if this client is equivalent to another object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(collection_name, options = {})  &#x21d2; Mongo::Collection </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get a collection object for the provided collection name.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; true </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Close all connections.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close_encrypter-instance_method" title="#close_encrypter (instance method)">#<strong>close_encrypter</strong>  &#x21d2; true </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Close encrypter and clean up auto-encryption resources.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#cluster_options-instance_method" title="#cluster_options (instance method)">#<strong>cluster_options</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#database_names-instance_method" title="#database_names (instance method)">#<strong>database_names</strong>(filter = {}, opts = {})  &#x21d2; Array&lt;String&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the names of all databases.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#encrypted_fields_map-instance_method" title="#encrypted_fields_map (instance method)">#<strong>encrypted_fields_map</strong>  &#x21d2; Hash | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns encrypted field map hash if provided when creating the client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#eql%3F-instance_method" title="#eql? (instance method)">#<strong>eql?</strong>(other)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#==-instance_method" title="Mongo::Client#== (method)">#==</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#get_session-instance_method" title="#get_session (instance method)">#<strong>get_session</strong>(options = {})  &#x21d2; Session | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a session to use for operations if possible.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#hash-instance_method" title="#hash (instance method)">#<strong>hash</strong>  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the hash value of the client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get an inspection of the client as a string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#list_databases-instance_method" title="#list_databases (instance method)">#<strong>list_databases</strong>(filter = {}, name_only = false, opts = {})  &#x21d2; Array&lt;Hash&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get info for each database.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#list_mongo_databases-instance_method" title="#list_mongo_databases (instance method)">#<strong>list_mongo_databases</strong>(filter = {}, opts = {})  &#x21d2; Array&lt;Mongo::Database&gt; </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a list of <a href="Database.html" title="Mongo::Database (class)"><code>Database</code></a> objects.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#max_read_retries-instance_method" title="#max_read_retries (instance method)">#<strong>max_read_retries</strong>  &#x21d2; Integer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the maximum number of times the client can retry a read operation when using legacy read retries.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#max_write_retries-instance_method" title="#max_write_retries (instance method)">#<strong>max_write_retries</strong>  &#x21d2; Integer </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the maximum number of times the client can retry a write operation when using legacy write retries.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#read_concern-instance_method" title="#read_concern (instance method)">#<strong>read_concern</strong>  &#x21d2; Hash </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the read concern for this client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#read_preference-instance_method" title="#read_preference (instance method)">#<strong>read_preference</strong>  &#x21d2; BSON::Document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the read preference from the options passed to the client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#read_retry_interval-instance_method" title="#read_retry_interval (instance method)">#<strong>read_retry_interval</strong>  &#x21d2; Float </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the interval, in seconds, in which read retries when using legacy read retries.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reconnect-instance_method" title="#reconnect (instance method)">#<strong>reconnect</strong>  &#x21d2; true </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reconnect the client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#server_selector-instance_method" title="#server_selector (instance method)">#<strong>server_selector</strong>  &#x21d2; Mongo::ServerSelector </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the server selector.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#start_session-instance_method" title="#start_session (instance method)">#<strong>start_session</strong>(options = {})  &#x21d2; Session </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Start a session.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#summary-instance_method" title="#summary (instance method)">#<strong>summary</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get a summary of the client state.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#timeout_ms-instance_method" title="#timeout_ms (instance method)">#<strong>timeout_ms</strong>  &#x21d2; Integer | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#timeout_sec-instance_method" title="#timeout_sec (instance method)">#<strong>timeout_sec</strong>  &#x21d2; Float | nil </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#tracer-instance_method" title="#tracer (instance method)">#<strong>tracer</strong>  &#x21d2; Tracing::Tracer | nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the tracer configured for this client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#update_options-instance_method" title="#update_options (instance method)">#<strong>update_options</strong>(new_options)  &#x21d2; Hash </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates this client’s options from new_options, validating all options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#use-instance_method" title="#use (instance method)">#<strong>use</strong>(name)  &#x21d2; Mongo::Client </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new client configured to use the database with the provided name, and using the other options configured in this client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#watch-instance_method" title="#watch (instance method)">#<strong>watch</strong>(pipeline = [], options = {})  &#x21d2; ChangeStream </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>As of version 3.6 of the MongoDB server, a “$changeStream“ pipeline stage is supported in the aggregation framework.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(new_options = nil)  &#x21d2; Mongo::Client </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new client with the passed options merged over the existing options of this client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#with_session-instance_method" title="#with_session (instance method)">#<strong>with_session</strong>(options = {}, &amp;block)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a session to use for operations if possible and yields it to the provided block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#write_concern-instance_method" title="#write_concern (instance method)">#<strong>write_concern</strong>  &#x21d2; Mongo::WriteConcern </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the write concern for this client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#assert_not_closed-instance_method" title="#assert_not_closed (instance method)">#<strong>assert_not_closed</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_encrypter-instance_method" title="#build_encrypter (instance method)">#<strong>build_encrypter</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new encrypter object using the client’s auto encryption options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#cluster_modifying%3F-instance_method" title="#cluster_modifying? (instance method)">#<strong>cluster_modifying?</strong>(new_options)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#default_options-instance_method" title="#default_options (instance method)">#<strong>default_options</strong>(options)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate default client options based on the <a href="URI.html" title="Mongo::URI (class)"><code>URI</code></a> and options passed into the <code>Client</code> constructor.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#do_close-instance_method" title="#do_close (instance method)">#<strong>do_close</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Implementation for #close, assumes the connect lock is already acquired.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#get_session!-instance_method" title="#get_session! (instance method)">#<strong>get_session!</strong>(options = {})  &#x21d2; Session </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a session to use for operations.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#initialize_copy-instance_method" title="#initialize_copy (instance method)">#<strong>initialize_copy</strong>(original)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Auxiliary method that is called by interpreter when copying the client via dup or clone.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#monitoring-instance_method" title="#monitoring (instance method)">#<strong>monitoring</strong>  &#x21d2; Monitoring </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#process_addresses-instance_method" title="#process_addresses (instance method)">#<strong>process_addresses</strong>(addresses, options)  &#x21d2; Hash&lt;:uri, :addresses, :options&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempts to parse the given list of addresses, using the provided options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#process_addresses_array-instance_method" title="#process_addresses_array (instance method)">#<strong>process_addresses_array</strong>(addresses, options)  &#x21d2; Hash&lt;:uri, :addresses, :options&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempts to parse the given list of addresses, using the provided options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#process_addresses_string-instance_method" title="#process_addresses_string (instance method)">#<strong>process_addresses_string</strong>(addresses, options)  &#x21d2; Hash&lt;:uri, :addresses, :options&gt; </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempts to parse the given list of addresses, using the provided options.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid_compressors-instance_method" title="#valid_compressors (instance method)">#<strong>valid_compressors</strong>(compressors)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_authentication_options!-instance_method" title="#validate_authentication_options! (instance method)">#<strong>validate_authentication_options!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validates all authentication-related options after they are set on the client This method is intended to catch combinations of options which are not allowed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_max_connecting!-instance_method" title="#validate_max_connecting! (instance method)">#<strong>validate_max_connecting!</strong>(option, opts)  &#x21d2; true </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validates whether the max_connecting option is valid.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_max_min_pool_size!-instance_method" title="#validate_max_min_pool_size! (instance method)">#<strong>validate_max_min_pool_size!</strong>(option, opts)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_new_options!-instance_method" title="#validate_new_options! (instance method)">#<strong>validate_new_options!</strong>(opts)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validates options in the provided argument for validity.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_options!-instance_method" title="#validate_options! (instance method)">#<strong>validate_options!</strong>(addresses = nil, is_srv: nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validates all options after they are set on the client.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_read!-instance_method" title="#validate_read! (instance method)">#<strong>validate_read!</strong>(option, opts)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_snappy_compression!-instance_method" title="#validate_snappy_compression! (instance method)">#<strong>validate_snappy_compression!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_zstd_compression!-instance_method" title="#validate_zstd_compression! (instance method)">#<strong>validate_zstd_compression!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="Loggable.html" title="Mongo::Loggable (module)"><code>Loggable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_debug-instance_method" title="Mongo::Loggable#log_debug (method)">#log_debug</a></td>
      <td><div class='inline'><p>Convenience method to log debug messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_error-instance_method" title="Mongo::Loggable#log_error (method)">#log_error</a></td>
      <td><div class='inline'><p>Convenience method to log error messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_fatal-instance_method" title="Mongo::Loggable#log_fatal (method)">#log_fatal</a></td>
      <td><div class='inline'><p>Convenience method to log fatal messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_info-instance_method" title="Mongo::Loggable#log_info (method)">#log_info</a></td>
      <td><div class='inline'><p>Convenience method to log info messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#log_warn-instance_method" title="Mongo::Loggable#log_warn (method)">#log_warn</a></td>
      <td><div class='inline'><p>Convenience method to log warn messages with the standard prefix.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Loggable.html#logger-instance_method" title="Mongo::Loggable#logger (method)">#logger</a></td>
      <td><div class='inline'><p>Get the logger instance.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Loggable.html#_mongo_log_prefix-instance_method" title="Mongo::Loggable#_mongo_log_prefix (method)">#_mongo_log_prefix</a>,
        <a class='i_m priv' href="Loggable.html#format_message-instance_method" title="Mongo::Loggable#format_message (method)">#format_message</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(addresses_or_uri, options = nil)  &#x21d2; <code>Client</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Instantiate a new driver client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Instantiate a single server or mongos client.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'>Client</span>.<span class='id identifier rubyid_new'>new</span>([<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span>])</code></pre>
        <p class='example_title'><div class='inline'>
<p>Instantiate a client for a replica set.</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'>Client</span>.<span class='id identifier rubyid_new'>new</span>([<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27021</span><span class='tstring_end'>&#39;</span></span>])</code></pre>
        <p class='example_title'><div class='inline'>
<p>Directly connect to a mongod in a replica set</p>
</div></p>
      <pre class='example code ruby'><code><span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'>Client</span>.<span class='id identifier rubyid_new'>new</span>([<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1:27017</span><span class='tstring_end'>&#39;</span></span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_connect'>connect</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_direct'>direct</span>)
<span class='comment'># without `:connect =&gt; :direct`, Mongo::Client will discover and
</span><span class='comment'># connect to the replica set if given the address of a server in
</span><span class='comment'># a replica set</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>addresses_or_uri</span>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt; | <code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The array of server addresses in the form of host:port or a MongoDB URI connection string.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The options to be used by the client. If a MongoDB URI connection string is also provided, these options take precedence over any analogous options present in the <a href="URI.html" title="Mongo::URI (class)"><code>URI</code></a> string.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:app_name</span>
          <span class='type'>(<code>String</code>, <a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
            &mdash; <div class='inline'>
<p>Application name that is printed to the mongod logs upon establishing a connection in server versions &gt;= 3.4.</p>
</div>        </li>
        <li>
          <span class='name'>:auth_mech</span>
          <span class='type'>(<a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
            &mdash; <div class='inline'>
<p>The authentication mechanism to use. One of <code>:mongodb_cr</code>, <code>:mongodb_x509</code>, <code>:plain</code>, <code>:scram</code>, <code>:scram256</code></p>
</div>        </li>
        <li>
          <span class='name'>:auth_mech_properties</span>
          <span class='type'>(<code>Hash</code>)</span>
        </li>
        <li>
          <span class='name'>:auth_source</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The source to authenticate from.</p>
</div>        </li>
        <li>
          <span class='name'>:bg_error_backtrace</span>
          <span class='type'>(<code>true</code> | <code>false</code> | <code>nil</code> | <code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>Experimental. Set to true to log complete backtraces for errors in background threads. Set to false or nil to not log backtraces. Provide a positive integer to log up to that many backtrace lines.</p>
</div>        </li>
        <li>
          <span class='name'>:compressors</span>
          <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
            &mdash; <div class='inline'>
<p>A list of potential compressors to use, in order of preference. The driver chooses the first compressor that is also supported by the server. Currently the driver only supports ‘zstd, ’snappy’ and ‘zlib’.</p>
</div>        </li>
        <li>
          <span class='name'>:direct_connection</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to connect directly to the specified seed, bypassing topology discovery. Exactly one seed must be provided.</p>
</div>        </li>
        <li>
          <span class='name'>:connect</span>
          <span class='type'>(<a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
            &mdash; <div class='inline'>
<p>Deprecated - use <code>:direct_connection</code> option instead of this option. The connection method to use. This forces the cluster to behave in the specified way instead of auto-discovering. One of <code>:direct</code>, <code>:replica_set</code>, <code>:sharded</code>, <code>:load_balanced</code>. If <code>:connect</code> is set to <code>:load_balanced</code>, the driver will behave as if the server is a load balancer even if it isn’t connected to a load balancer.</p>
</div>        </li>
        <li>
          <span class='name'>:connect_timeout</span>
          <span class='type'>(<code>Float</code>)</span>
            &mdash; <div class='inline'>
<p>The timeout, in seconds, to attempt a connection.</p>
</div>        </li>
        <li>
          <span class='name'>:database</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The database to connect to.</p>
</div>        </li>
        <li>
          <span class='name'>:heartbeat_frequency</span>
          <span class='type'>(<code>Float</code>)</span>
            &mdash; <div class='inline'>
<p>The interval, in seconds, for the server monitor to refresh its description via hello.</p>
</div>        </li>
        <li>
          <span class='name'>:id_generator</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>A custom object to generate ids for documents. Must respond to #generate.</p>
</div>        </li>
        <li>
          <span class='name'>:load_balanced</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to expect to connect to a load balancer.</p>
</div>        </li>
        <li>
          <span class='name'>:local_threshold</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The local threshold boundary in seconds for selecting a near server for an operation.</p>
</div>        </li>
        <li>
          <span class='name'>:logger</span>
          <span class='type'>(<a href="Logger.html" title="Mongo::Logger (class)">Logger</a>)</span>
            &mdash; <div class='inline'>
<p>A custom logger to use.</p>
</div>        </li>
        <li>
          <span class='name'>:log_prefix</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>A custom log prefix to use when logging. This option is experimental and subject to change in a future version of the driver.</p>
</div>        </li>
        <li>
          <span class='name'>:max_connecting</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum number of connections that can be connecting simultaneously. The default is 2. This option should be increased if there are many threads that share the same client and the application is experiencing timeouts while waiting for connections to be established. selecting a server for an operation. The default is 2.</p>
</div>        </li>
        <li>
          <span class='name'>:max_idle_time</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum seconds a socket can remain idle since it has been checked in to the pool.</p>
</div>        </li>
        <li>
          <span class='name'>:max_pool_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum size of the connection pool. Setting this option to zero creates an unlimited connection pool.</p>
</div>        </li>
        <li>
          <span class='name'>:max_read_retries</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum number of read retries when legacy read retries are in use.</p>
</div>        </li>
        <li>
          <span class='name'>:max_write_retries</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum number of write retries when legacy write retries are in use.</p>
</div>        </li>
        <li>
          <span class='name'>:min_pool_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The minimum size of the connection pool.</p>
</div>        </li>
        <li>
          <span class='name'>:monitoring</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>If false is given, the client is initialized without global SDAM event subscribers and will not publish SDAM events. Command monitoring and legacy events will still be published, and the driver will still perform SDAM and monitor its cluster in order to perform server selection. Built-in driver logging of SDAM events will be disabled because it is implemented through SDAM event subscription. Client#subscribe will succeed for all event types, but subscribers to SDAM events will not be invoked. Values other than false result in default behavior which is to perform normal SDAM event publication.</p>
</div>        </li>
        <li>
          <span class='name'>:monitoring_io</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>For internal driver use only. Set to false to prevent SDAM-related I/O from being done by this client or servers under it. Note: setting this option to false will make the client non-functional. It is intended for use in tests which manually invoke SDAM state transitions.</p>
</div>        </li>
        <li>
          <span class='name'>:cleanup</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>For internal driver use only. Set to false to prevent endSessions command being sent to the server to clean up server sessions when the cluster is disconnected, and to to not start the periodic executor. If <code>:monitoring_io</code> is false, <code>:cleanup</code> automatically defaults to false as well.</p>
</div>        </li>
        <li>
          <span class='name'>:password</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The user’s password.</p>
</div>        </li>
        <li>
          <span class='name'>:platform</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>Platform information to include in the metadata printed to the mongod logs upon establishing a connection in server versions &gt;= 3.4.</p>
</div>        </li>
        <li>
          <span class='name'>:read</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The read preference options. The hash may have the following items:</p>
<ul><li>
<p><strong>:mode</strong> – read preference specified as a symbol; valid values are <strong>:primary</strong>, <strong>:primary_preferred</strong>, <strong>:secondary</strong>, <strong>:secondary_preferred</strong> and <strong>:nearest</strong>.</p>
</li><li>
<p><strong>:tag_sets</strong> – an array of hashes.</p>
</li><li>
<p><strong>:local_threshold</strong>.</p>
</li></ul>
</div>        </li>
        <li>
          <span class='name'>:read_concern</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The read concern option.</p>
</div>        </li>
        <li>
          <span class='name'>:read_retry_interval</span>
          <span class='type'>(<code>Float</code>)</span>
            &mdash; <div class='inline'>
<p>The interval, in seconds, in which reads on a mongos are retried.</p>
</div>        </li>
        <li>
          <span class='name'>:replica_set</span>
          <span class='type'>(<a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
            &mdash; <div class='inline'>
<p>The name of the replica set to connect to. Servers not in this replica set will be ignored.</p>
</div>        </li>
        <li>
          <span class='name'>:retry_reads</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>If true, modern retryable reads are enabled (which is the default). If false, modern retryable reads are disabled and legacy retryable reads are enabled.</p>
</div>        </li>
        <li>
          <span class='name'>:retry_writes</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Retry writes once when connected to a replica set or sharded cluster versions 3.6 and up. (Default is true.)</p>
</div>        </li>
        <li>
          <span class='name'>:scan</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to scan all seeds in constructor. The default in driver version 2.x is to do so; driver version 3.x will not scan seeds in constructor. Opt in to the new behavior by setting this option to false. <strong>Note:</strong> setting this option to nil enables scanning seeds in constructor in driver version 2.x. Driver version 3.x will recognize this option but will ignore it and will never scan seeds in the constructor.</p>
</div>        </li>
        <li>
          <span class='name'>:sdam_proc</span>
          <span class='type'>(<code>Proc</code>)</span>
            &mdash; <div class='inline'>
<p>A Proc to invoke with the client as the argument prior to performing server discovery and monitoring. Use this to set up SDAM event listeners to receive events published during client construction.</p>

<p>Note: the client is not fully constructed when sdam_proc is invoked, in particular the cluster is nil at this time. sdam_proc should limit itself to calling #subscribe and #unsubscribe methods on the client only.</p>
</div>        </li>
        <li>
          <span class='name'>:server_api</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The requested server API version. This hash can have the following items:</p>
<ul><li>
<p><strong>:version</strong> – string</p>
</li><li>
<p><strong>:strict</strong> – boolean</p>
</li><li>
<p><strong>:deprecation_errors</strong> – boolean</p>
</li></ul>
</div>        </li>
        <li>
          <span class='name'>:server_selection_timeout</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The timeout in seconds for selecting a server for an operation.</p>
</div>        </li>
        <li>
          <span class='name'>:socket_timeout</span>
          <span class='type'>(<code>Float</code>)</span>
            &mdash; <div class='inline'>
<p>The timeout, in seconds, to execute operations on a socket. This option is deprecated, use <code>:timeout_ms</code> instead.</p>
</div>        </li>
        <li>
          <span class='name'>:srv_max_hosts</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum number of mongoses that the driver will communicate with for sharded topologies. If this option is 0, then there will be no maximum number of mongoses. If the given <a href="URI.html" title="Mongo::URI (class)"><code>URI</code></a> resolves to more hosts than “:srv_max_hosts“, the client will randomly choose an “:srv_max_hosts“ sized subset of hosts. If srvMaxHosts is provided in the <a href="URI.html" title="Mongo::URI (class)"><code>URI</code></a> options, it takes precedence over this option.</p>
</div>        </li>
        <li>
          <span class='name'>:srv_service_name</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The service name to use in the SRV DNS query.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to use TLS.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_ca_cert</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The file containing concatenated certificate authority certificates used to validate certs passed from the other end of the connection. Intermediate certificates should NOT be specified in files referenced by this option. One of <code>:ssl_ca_cert</code>, <code>:ssl_ca_cert_string</code> or <code>:ssl_ca_cert_object</code> (in order of priority) is required when using <code>:ssl_verify</code>.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_ca_cert_object</span>
          <span class='type'>(<code>Array</code>&lt;<code>OpenSSL::X509::Certificate</code>&gt;)</span>
            &mdash; <div class='inline'>
<p>An array of OpenSSL::X509::Certificate objects representing the certificate authority certificates used to validate certs passed from the other end of the connection. Intermediate certificates should NOT be specified in files referenced by this option. One of <code>:ssl_ca_cert</code>, <code>:ssl_ca_cert_string</code> or <code>:ssl_ca_cert_object</code> (in order of priority) is required when using <code>:ssl_verify</code>.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_ca_cert_string</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>A string containing certificate authority certificate used to validate certs passed from the other end of the connection. This option allows passing only one CA certificate to the driver. Intermediate certificates should NOT be specified in files referenced by this option. One of <code>:ssl_ca_cert</code>, <code>:ssl_ca_cert_string</code> or <code>:ssl_ca_cert_object</code> (in order of priority) is required when using <code>:ssl_verify</code>.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_cert</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The certificate file used to identify the connection against MongoDB. A certificate chain may be passed by specifying the client certificate first followed by any intermediate certificates up to the CA certificate. The file may also contain the certificate’s private key, which will be ignored. This option, if present, takes precedence over the values of <code>:ssl_cert_string</code> and <code>:ssl_cert_object</code></p>
</div>        </li>
        <li>
          <span class='name'>:ssl_cert_object</span>
          <span class='type'>(<code>OpenSSL::X509::Certificate</code>)</span>
            &mdash; <div class='inline'>
<p>The OpenSSL::X509::Certificate used to identify the connection against MongoDB. Only one certificate may be passed through this option.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_cert_string</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>A string containing the PEM-encoded certificate used to identify the connection against MongoDB. A certificate chain may be passed by specifying the client certificate first followed by any intermediate certificates up to the CA certificate. The string may also contain the certificate’s private key, which will be ignored, This option, if present, takes precedence over the value of <code>:ssl_cert_object</code></p>
</div>        </li>
        <li>
          <span class='name'>:ssl_key</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The private keyfile used to identify the connection against MongoDB. Note that even if the key is stored in the same file as the certificate, both need to be explicitly specified. This option, if present, takes precedence over the values of <code>:ssl_key_string</code> and <code>:ssl_key_object</code></p>
</div>        </li>
        <li>
          <span class='name'>:ssl_key_object</span>
          <span class='type'>(<code>OpenSSL::PKey</code>)</span>
            &mdash; <div class='inline'>
<p>The private key used to identify the connection against MongoDB</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_key_pass_phrase</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>A passphrase for the private key.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_key_string</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>A string containing the PEM-encoded private key used to identify the connection against MongoDB. This parameter, if present, takes precedence over the value of option <code>:ssl_key_object</code></p>
</div>        </li>
        <li>
          <span class='name'>:ssl_verify</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to perform peer certificate validation and hostname verification. Note that the decision of whether to validate certificates will be overridden if <code>:ssl_verify_certificate</code> is set, and the decision of whether to validate hostnames will be overridden if <code>:ssl_verify_hostname</code> is set.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_verify_certificate</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to perform peer certificate validation. This setting overrides <code>:ssl_verify</code> with respect to whether certificate validation is performed.</p>
</div>        </li>
        <li>
          <span class='name'>:ssl_verify_hostname</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to perform peer hostname validation. This setting overrides <code>:ssl_verify</code> with respect to whether hostname validation is performed.</p>
</div>        </li>
        <li>
          <span class='name'>:timeout_ms</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The operation timeout in milliseconds. Must be a non-negative integer. An explicit value of 0 means infinite. The default value is unset which means the feature is not enabled.</p>
</div>        </li>
        <li>
          <span class='name'>:truncate_logs</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>Whether to truncate the logs at the default 250 characters.</p>
</div>        </li>
        <li>
          <span class='name'>:user</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>The user name.</p>
</div>        </li>
        <li>
          <span class='name'>:wait_queue_timeout</span>
          <span class='type'>(<code>Float</code>)</span>
            &mdash; <div class='inline'>
<p>The time to wait, in seconds, in the connection pool for a connection to be checked in. This option is deprecated, use <code>:timeout_ms</code> instead.</p>
</div>        </li>
        <li>
          <span class='name'>:wrapping_libraries</span>
          <span class='type'>(<code>Array</code>&lt;<code>Hash</code>&gt;)</span>
            &mdash; <div class='inline'>
<p>Information about libraries such as ODMs that are wrapping the driver, to be added to</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_metadata'>metadata</span> <span class='id identifier rubyid_sent'>sent</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_server'>server</span>. <span class='const'>Specify</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_lower'>lower</span> <span class='id identifier rubyid_level'>level</span> <span class='id identifier rubyid_libraries'>libraries</span> <span class='id identifier rubyid_first'>first</span>.
<span class='const'>Allowed</span> <span class='id identifier rubyid_hash'><a href="#hash-instance_method" title="Mongo::Client#hash (method)">hash</a></span> <span class='label'>keys:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_platform'>platform</span>.</code></pre>
</div>        </li>
        <li>
          <span class='name'>:write</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>Deprecated. Equivalent to <code>:write_concern</code> option.</p>
</div>        </li>
        <li>
          <span class='name'>:write_concern</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The write concern options. Can be <code>:w</code> =&gt; Integer|String, <code>:wtimeout</code> =&gt; Integer (in milliseconds, deprecated), <code>:j</code> =&gt; Boolean, <code>:fsync</code> =&gt; Boolean.</p>
</div>        </li>
        <li>
          <span class='name'>:zlib_compression_level</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The Zlib compression level to use, if using compression. See Ruby’s Zlib module for valid levels.</p>
</div>        </li>
        <li>
          <span class='name'>:resolv_options</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>For internal driver use only. <a href="Options.html" title="Mongo::Options (module)"><code>Options</code></a> to pass through to Resolv::DNS constructor for SRV lookups.</p>
</div>        </li>
        <li>
          <span class='name'>:tracing</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>OpenTelemetry tracing options.</p>
<ul><li>
<p><code>:enabled</code> =&gt; Boolean, whether to enable OpenTelemetry tracing. The default value is nil that means that the configuration will be taken from the OTEL_RUBY_INSTRUMENTATION_MONGODB_ENABLED environment variable.</p>
</li><li>
<p><code>:tracer</code> =&gt; OpenTelemetry::Trace::Tracer, the tracer to use for tracing. Must be an implementation of OpenTelemetry::Trace::Tracer interface.</p>
</li><li>
<p><code>:query_text_max_length</code> =&gt; Integer, the maximum length of the query text to be included in the span attributes. If the query text exceeds this length, it will be truncated. Value 0 means no query text will be included in the span attributes. The default value is nil that means that the configuration will be taken from the OTEL_RUBY_INSTRUMENTATION_MONGODB_QUERY_TEXT_MAX_LENGTH environment variable.</p>
</li></ul>
</div>        </li>
        <li>
          <span class='name'>:auto_encryption_options</span>
          <span class='type'>(<code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>Auto-encryption related options.</p>
<ul><li>
<p><code>:key_vault_client</code> =&gt; <code>Client</code> | nil, a client connected to the MongoDB instance containing the encryption key vault</p>
</li><li>
<p><code>:key_vault_namespace</code> =&gt; String, the namespace of the key vault in the format database.collection</p>
</li><li>
<p><code>:kms_providers</code> =&gt; Hash, A hash of key management service (KMS) configuration information. Valid hash keys are :aws, :azure, :gcp, :kmip, :local. There may be more than one kms provider specified.</p>
</li><li>
<p><code>:kms_tls_options</code> =&gt; Hash, A hash of TLS options to authenticate to KMS providers, usually used for KMIP servers. Valid hash keys are :aws, :azure, :gcp, :kmip, :local. There may be more than one kms provider specified.</p>
</li><li>
<p><code>:schema_map</code> =&gt; Hash | nil, JSONSchema for one or more collections specifying which fields should be encrypted. This option is mutually exclusive with :schema_map_path.</p>
<ul><li>
<p>Note: Schemas supplied in the schema_map only apply to configuring automatic encryption for client side encryption. Other validation rules in the JSON schema will not be enforced by the driver and will result in an error.</p>
</li><li>
<p>Note: Supplying a schema_map provides more security than relying on JSON Schemas obtained from the server. It protects against a malicious server advertising a false JSON Schema, which could trick the client into sending unencrypted data that should be encrypted.</p>
</li><li>
<p>Note: If a collection is present on both the :encrypted_fields_map and :schema_map, an error will be raised.</p>
</li></ul>
</li><li>
<p><code>:schema_map_path</code> =&gt; String | nil A path to a file contains the JSON schema</p>
</li></ul>

<p>of the collection that stores auto encrypted documents. This option is mutually exclusive with <code>:schema_map</code>.</p>
<ul><li>
<p><code>:bypass_auto_encryption</code> =&gt; Boolean, when true, disables auto encryption; defaults to false.</p>
</li><li>
<p><code>:extra_options</code> =&gt; Hash | nil, options related to spawning mongocryptd (this part of the API is subject to change).</p>
</li><li>
<p><code>:encrypted_fields_map</code> =&gt; Hash | nil, maps a collection namespace to a hash describing encrypted fields for queryable encryption.</p>
<ul><li>
<p>Note: If a collection is present on both the encryptedFieldsMap and schemaMap, an error will be raised.</p>
</li></ul>
</li><li>
<p><code>:bypass_query_analysis</code> =&gt; Boolean | nil, when true disables automatic analysis of outgoing commands.</p>
</li><li>
<p><code>:crypt_shared_lib_path</code> =&gt; [ String | nil ]  Path that should be  the used to load the crypt shared library. Providing this option overrides default crypt shared library load paths for libmongocrypt.</p>
</li><li>
<p><code>:crypt_shared_lib_required</code> =&gt; [ Boolean | nil ]  Whether crypt shared library is required. If ‘true’, an error will be raised if a crypt_shared library cannot be loaded by libmongocrypt.</p>
</li></ul>

<p>Notes on automatic encryption:</p>
<ul><li>
<p>Automatic encryption is an enterprise only feature that only applies to operations on a collection.</p>
</li><li>
<p>Automatic encryption is not supported for operations on a database or view.</p>
</li><li>
<p>Automatic encryption requires the authenticated user to have the listCollections privilege.</p>
</li><li>
<p>At worst, automatic encryption may triple the number of connections used by the Client at any one time.</p>
</li><li>
<p>If automatic encryption fails on an operation, use a MongoClient configured with bypass_auto_encryption: true and use ClientEncryption.encrypt to manually encrypt values.</p>
</li><li>
<p>Enabling Client Side Encryption reduces the maximum write batch size and may have a negative performance impact.</p>
</li></ul>
</div>        </li>
    </ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L519-L628'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='519' data-end='628'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 519</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_addresses_or_uri'>addresses_or_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>?</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_dup'>dup</span> <span class='op'>:</span> {}

  <span class='id identifier rubyid_processed'>processed</span> <span class='op'>=</span> <span class='id identifier rubyid_process_addresses'><a href="#process_addresses-instance_method" title="Mongo::Client#process_addresses (method)">process_addresses</a></span>(<span class='id identifier rubyid_addresses_or_uri'>addresses_or_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)

  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_uri'>uri</span>]
  <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>=</span> <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_addresses'>addresses</span>]
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>]

  <span class='comment'># If the URI is an SRV URI, note this so that we can start
</span>  <span class='comment'># SRV polling if the topology is a sharded cluster.
</span>  <span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span> <span class='kw'>if</span> <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="URI.html" title="Mongo::URI (class)">URI</a></span><span class='op'>::</span><span class='const'><a href="URI/SRVProtocol.html" title="Mongo::URI::SRVProtocol (class)">SRVProtocol</a></span>)

  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_canonicalize_ruby_options'><a href="#canonicalize_ruby_options-class_method" title="Mongo::Client.canonicalize_ruby_options (method)">canonicalize_ruby_options</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)

  <span class='comment'># The server API version is specified to be a string.
</span>  <span class='comment'># However, it is very annoying to always provide the number 1 as a string,
</span>  <span class='comment'># therefore cast to the string type here.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_server_api'>server_api</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_server_api'>server_api</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
      <span class='id identifier rubyid_server_api'>server_api</span> <span class='op'>=</span> <span class='const'><a href="Options.html" title="Mongo::Options (module)">Options</a></span><span class='op'>::</span><span class='const'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_server_api'>server_api</span>)
      <span class='kw'>if</span> (<span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_server_api'>server_api</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_version'>version</span>]).<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Integer</span>)
        <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span>] <span class='op'>=</span> <span class='id identifier rubyid_server_api'>server_api</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>version:</span> <span class='id identifier rubyid_version'>version</span>.<span class='id identifier rubyid_to_s'>to_s</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Special handling for sdam_proc as it is only used during client
</span>  <span class='comment'># construction
</span>  <span class='id identifier rubyid_sdam_proc'>sdam_proc</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sdam_proc'>sdam_proc</span>)

  <span class='comment'># For gssapi service_name, the default option is given in a hash
</span>  <span class='comment'># (one level down from the top level).
</span>  <span class='id identifier rubyid_merged_options'>merged_options</span> <span class='op'>=</span> <span class='id identifier rubyid_default_options'><a href="#default_options-instance_method" title="Mongo::Client#default_options (method)">default_options</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_default_v'>default_v</span> <span class='op'>=</span> <span class='id identifier rubyid_merged_options'>merged_options</span>[<span class='id identifier rubyid_k'>k</span>]
    <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_default_v'>default_v</span>
      <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_default_v'>default_v</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_v'>v</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_merged_options'>merged_options</span>[<span class='id identifier rubyid_k'>k</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> <span class='id identifier rubyid_merged_options'>merged_options</span>

  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='id identifier rubyid_k'>k</span>].<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_k'>k</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_new_options!'><a href="#validate_new_options!-instance_method" title="Mongo::Client#validate_new_options! (method)">validate_new_options!</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
<span class='embdoc_beg'>=begin WriteConcern object support
</span><span class='embdoc'>  if @options[:write_concern].is_a?(WriteConcern::Base)
</span><span class='embdoc'>    # Cache the instance so that we do not needlessly reconstruct it.
</span><span class='embdoc'>    @write_concern = @options[:write_concern]
</span><span class='embdoc'>    @options[:write_concern] = @write_concern.options
</span><span class='embdoc'>  end
</span><span class='embdoc_end'>=end
</span>  <span class='ivar'>@options</span>.<span class='id identifier rubyid_freeze'>freeze</span>
  <span class='id identifier rubyid_validate_options!'><a href="#validate_options!-instance_method" title="Mongo::Client#validate_options! (method)">validate_options!</a></span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='label'>is_srv:</span> <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="URI.html" title="Mongo::URI (class)">URI</a></span><span class='op'>::</span><span class='const'><a href="URI/SRVProtocol.html" title="Mongo::URI::SRVProtocol (class)">SRVProtocol</a></span>))
  <span class='id identifier rubyid_validate_authentication_options!'><a href="#validate_authentication_options!-instance_method" title="Mongo::Client#validate_authentication_options! (method)">validate_authentication_options!</a></span>

  <span class='id identifier rubyid_database_options'>database_options</span> <span class='op'>=</span> <span class='ivar'>@options</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_database_options'>database_options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span>)
  <span class='ivar'>@database</span> <span class='op'>=</span> <span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span>.<span class='id identifier rubyid_new'><a href="Database.html#new-class_method" title="Mongo::Database.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span>]<span class='comma'>,</span> <span class='id identifier rubyid_database_options'>database_options</span>)

  <span class='comment'># Temporarily set monitoring so that event subscriptions can be
</span>  <span class='comment'># set up without there being a cluster
</span>  <span class='ivar'>@monitoring</span> <span class='op'>=</span> <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring.html#new-class_method" title="Mongo::Monitoring.new (method)">new</a></span>(<span class='ivar'>@options</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_sdam_proc'>sdam_proc</span>
    <span class='id identifier rubyid_sdam_proc'>sdam_proc</span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span>)
  <span class='kw'>end</span>

  <span class='ivar'>@connect_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span>.<span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@connect_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@cluster</span> <span class='op'>=</span> <span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span>.<span class='id identifier rubyid_new'><a href="Cluster.html#new-class_method" title="Mongo::Cluster.new (method)">new</a></span>(
      <span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span>
      <span class='ivar'>@monitoring</span><span class='comma'>,</span>
      <span class='id identifier rubyid_cluster_options'><a href="#cluster_options-instance_method" title="Mongo::Client#cluster_options (method)">cluster_options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>srv_uri:</span> <span class='id identifier rubyid_srv_uri'>srv_uri</span>)
    )
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='comment'># Unset monitoring, it will be taken out of cluster from now on
</span>    <span class='id identifier rubyid_remove_instance_variable'>remove_instance_variable</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@monitoring</span><span class='tstring_end'>&#39;</span></span>)

    <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>]
      <span class='ivar'>@connect_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_build_encrypter'><a href="#build_encrypter-instance_method" title="Mongo::Client#build_encrypter (method)">build_encrypter</a></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>rescue</span>
    <span class='kw'>begin</span>
      <span class='ivar'>@cluster</span>.<span class='id identifier rubyid_close'><a href="#close-instance_method" title="Mongo::Client#close (method)">close</a></span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eror closing cluster in client constructor&#39;s exception handler: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
      <span class='comment'># Drop this exception so that the original exception is raised
</span>    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span>(<span class='kw'>self</span>)
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_close'><a href="#close-instance_method" title="Mongo::Client#close (method)">close</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="canonicalize_ruby_options-class_method">
  <h3 class='signature nodoc first'>
    .<strong>canonicalize_ruby_options</strong>(options)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Lowercases auth mechanism properties, if given, in the specified options, then converts the options to an instance of <a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)"><code>Options::Redacted</code></a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1186-L1195'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1186' data-end='1195'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1186</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_canonicalize_ruby_options'>canonicalize_ruby_options</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='const'><a href="Options.html" title="Mongo::Options (module)">Options</a></span><span class='op'>::</span><span class='const'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Client.new (method)">new</a></span>(<span class='const'>Hash</span>[<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_k'>k</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech_properties'>auth_mech_properties</span> <span class='op'>||</span> <span class='id identifier rubyid_k'>k</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auth_mech_properties</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span>
        <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='const'>Hash</span>[<span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_pk'>pk</span><span class='comma'>,</span> <span class='id identifier rubyid_pv'>pv</span><span class='op'>|</span> [<span class='id identifier rubyid_pk'>pk</span>.<span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='id identifier rubyid_pv'>pv</span>] }]
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    [<span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span>]
  <span class='kw'>end</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="closed?-instance_method">
  <h3 class='signature ro first'>
    #<strong>closed?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L877-L879'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='877' data-end='879'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 877</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_closed?'>closed?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@closed</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cluster-instance_method">
  <h3 class='signature ro'>
    #<strong>cluster</strong>  &#x21d2; <a href="Cluster.html" title="Mongo::Cluster (class)">Mongo::Cluster</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Cluster.html" title="Mongo::Cluster (class)">Mongo::Cluster</a>)</span>
&mdash;    <div class='inline'>
<p>cluster The cluster of servers for the client.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L140-L140'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='140' data-end='140'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 140</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cluster'>cluster</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="database-instance_method">
  <h3 class='signature ro'>
    #<strong>database</strong>  &#x21d2; <a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a>)</span>
&mdash;    <div class='inline'>
<p>database The database the client is operating on.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L143-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='143' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 143</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_database'>database</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encrypter-instance_method">
  <h3 class='signature ro'>
    #<strong>encrypter</strong>  &#x21d2; <a href="Crypt/AutoEncrypter.html" title="Mongo::Crypt::AutoEncrypter (class)">Mongo::Crypt::AutoEncrypter</a>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Crypt/AutoEncrypter.html" title="Mongo::Crypt::AutoEncrypter (class)">Mongo::Crypt::AutoEncrypter</a>)</span>
&mdash;    <div class='inline'>
<p>The object that encapsulates auto-encryption behavior</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L150-L150'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='150' data-end='150'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 150</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_encrypter'>encrypter</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="options-instance_method">
  <h3 class='signature ro'>
    #<strong>options</strong>  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>options The configuration options.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L146-L146'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='146' data-end='146'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 146</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_options'>options</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="==-instance_method">
  <h3 class='signature  first'>
    #<strong>==</strong>(other)  &#x21d2; <code>true</code>, <code>false</code> 
    <span class='aliases'>Also known as: <span class='names'>#eql?</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Determine if this client is equivalent to another object.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Check client equality.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>other</span>
    <span class='type'>(<code>Object</code>)</span>
&mdash;    <div class='inline'>
<p>The object to compare to.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>If the objects are equal.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L179-L182'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='179' data-end='182'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 179</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>==</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Client</span>)
  <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]-instance_method">
  <h3 class='signature '>
    #<strong>[]</strong>(collection_name, options = {})  &#x21d2; <a href="Collection.html" title="Mongo::Collection (class)">Mongo::Collection</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get a collection object for the provided collection name.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the collection.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span>]</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>collection_name</span>
    <span class='type'>(<code>String</code>, <a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the collection.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options to the collection.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Collection.html" title="Mongo::Collection (class)">Mongo::Collection</a>)</span>
&mdash;    <div class='inline'>
<p>The collection.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L196-L198'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='196' data-end='198'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 196</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]</span>(<span class='id identifier rubyid_collection_name'>collection_name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span>[<span class='id identifier rubyid_collection_name'>collection_name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="assert_not_closed-instance_method">
  <h3 class='signature priv'>
    #<strong>assert_not_closed</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1743-L1747'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1743' data-end='1747'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1743</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assert_not_closed'>assert_not_closed</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="Mongo::Client#closed? (method)">closed?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/ClientClosed.html" title="Mongo::Error::ClientClosed (class)">ClientClosed</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The client was closed and is not usable for operations. Call #reconnect to reset this client instance or create a new client instance</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_encrypter-instance_method">
  <h3 class='signature priv'>
    #<strong>build_encrypter</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new encrypter object using the client’s auto encryption options</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1304-L1308'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1304' data-end='1308'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1304</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_encrypter'>build_encrypter</span>
  <span class='ivar'>@encrypter</span> <span class='op'>=</span> <span class='const'><a href="Crypt.html" title="Mongo::Crypt (module)">Crypt</a></span><span class='op'>::</span><span class='const'><a href="Crypt/AutoEncrypter.html" title="Mongo::Crypt::AutoEncrypter (class)">AutoEncrypter</a></span>.<span class='id identifier rubyid_new'><a href="Crypt/AutoEncrypter.html#new-class_method" title="Mongo::Crypt::AutoEncrypter.new (method)">new</a></span>(
    <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>].<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>client:</span> <span class='kw'>self</span>)
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature '>
    #<strong>close</strong>  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Close all connections.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>Always true.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L886-L892'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='886' data-end='892'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 886</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='ivar'>@connect_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_do_close'><a href="#do_close-instance_method" title="Mongo::Client#do_close (method)">do_close</a></span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close_encrypter-instance_method">
  <h3 class='signature '>
    #<strong>close_encrypter</strong>  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Close encrypter and clean up auto-encryption resources.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>Always true.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L897-L901'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='897' data-end='901'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 897</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close_encrypter'>close_encrypter</span>
  <span class='ivar'>@encrypter</span>.<span class='id identifier rubyid_close'><a href="#close-instance_method" title="Mongo::Client#close (method)">close</a></span> <span class='kw'>if</span> <span class='ivar'>@encrypter</span>

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cluster_modifying?-instance_method">
  <h3 class='signature priv'>
    #<strong>cluster_modifying?</strong>(new_options)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1388-L1395'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1388' data-end='1395'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1388</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cluster_modifying?'>cluster_modifying?</span>(<span class='id identifier rubyid_new_options'>new_options</span>)
  <span class='id identifier rubyid_cluster_options'><a href="#cluster_options-instance_method" title="Mongo::Client#cluster_options (method)">cluster_options</a></span> <span class='op'>=</span> <span class='id identifier rubyid_new_options'>new_options</span>.<span class='id identifier rubyid_reject'>reject</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='const'><a href="#CRUD_OPTIONS-constant" title="Mongo::Client::CRUD_OPTIONS (constant)">CRUD_OPTIONS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_cluster_options'><a href="#cluster_options-instance_method" title="Mongo::Client#cluster_options (method)">cluster_options</a></span>.<span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='id identifier rubyid_name'>name</span>] <span class='op'>!=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cluster_options-instance_method">
  <h3 class='signature nodoc'>
    #<strong>cluster_options</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L631-L655'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='631' data-end='655'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 631</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cluster_options'>cluster_options</span>
  <span class='comment'># We share clusters when a new client with different CRUD_OPTIONS
</span>  <span class='comment'># is requested; therefore, cluster should not be getting any of these
</span>  <span class='comment'># options upon instantiation
</span>  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_reject'>reject</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='const'><a href="#CRUD_OPTIONS-constant" title="Mongo::Client::CRUD_OPTIONS (constant)">CRUD_OPTIONS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>)
  <span class='kw'>end</span>.<span class='id identifier rubyid_merge'>merge</span>(
    <span class='comment'># but need to put the database back in for auth...
</span>    <span class='label'>database:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span>]<span class='comma'>,</span>

    <span class='comment'># Put these options in for legacy compatibility, but note that
</span>    <span class='comment'># their values on the client and the cluster do not have to match -
</span>    <span class='comment'># applications should read these values from client, not from cluster
</span>    <span class='label'>max_read_retries:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_read_retries'><a href="#max_read_retries-instance_method" title="Mongo::Client#max_read_retries (method)">max_read_retries</a></span>]<span class='comma'>,</span>
    <span class='label'>read_retry_interval:</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_retry_interval'><a href="#read_retry_interval-instance_method" title="Mongo::Client#read_retry_interval (method)">read_retry_interval</a></span>]<span class='comma'>,</span>
    <span class='label'>tracer:</span> <span class='id identifier rubyid_tracer'><a href="#tracer-instance_method" title="Mongo::Client#tracer (method)">tracer</a></span><span class='comma'>,</span>
  ).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span><span class='op'>|</span>
    <span class='comment'># If the client has a cluster already, forward srv_uri to the new
</span>    <span class='comment'># cluster to maintain SRV monitoring. If the client is brand new,
</span>    <span class='comment'># its constructor sets srv_uri manually.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>
      <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_update'>update</span>(<span class='label'>srv_uri:</span> <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_srv_uri'>srv_uri</span>])
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="database_names-instance_method">
  <h3 class='signature '>
    #<strong>database_names</strong>(filter = {}, opts = {})  &#x21d2; <code>Array</code>&lt;<code>String</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the names of all databases.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the database names.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_database_names'>database_names</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filter</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The filter criteria for getting a list of databases.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The command options.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:authorized_databases</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>A flag that determines which databases are returned based on user privileges when access control is enabled</p>

<p>See <a href="https://mongodb.com/docs/manual/reference/command/listDatabases">mongodb.com/docs/manual/reference/command/listDatabases</a>/ for more information and usage.</p>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>        </li>
        <li>
          <span class='name'>:comment</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>A user-provided comment to attach to this command.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The names of the databases.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.5</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L953-L955'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='953' data-end='955'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 953</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_database_names'>database_names</span>(<span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_list_databases'><a href="#list_databases-instance_method" title="Mongo::Client#list_databases (method)">list_databases</a></span>(<span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>).<span class='id identifier rubyid_collect'>collect</span>{ <span class='op'>|</span><span class='id identifier rubyid_info'>info</span><span class='op'>|</span> <span class='id identifier rubyid_info'>info</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>] }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="default_options-instance_method">
  <h3 class='signature priv'>
    #<strong>default_options</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate default client options based on the <a href="URI.html" title="Mongo::URI (class)"><code>URI</code></a> and options passed into the <code>Client</code> constructor.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1312-L1325'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1312' data-end='1325'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1312</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_default_options'>default_options</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="Database.html#DEFAULT_OPTIONS-constant" title="Mongo::Database::DEFAULT_OPTIONS (constant)">DEFAULT_OPTIONS</a></span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_default_options'>default_options</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech'>auth_mech</span>] <span class='op'>||</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>]
      <span class='id identifier rubyid_default_options'>default_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_source'>auth_source</span>] <span class='op'>=</span> <span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/User.html" title="Mongo::Auth::User (class)">User</a></span>.<span class='id identifier rubyid_default_auth_source'><a href="Auth/User.html#default_auth_source-class_method" title="Mongo::Auth::User.default_auth_source (method)">default_auth_source</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech'>auth_mech</span>] <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_gssapi'>gssapi</span>
      <span class='id identifier rubyid_default_options'>default_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech_properties'>auth_mech_properties</span>] <span class='op'>=</span> { <span class='label'>service_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mongodb</span><span class='tstring_end'>&#39;</span></span> }
    <span class='kw'>end</span>

    <span class='id identifier rubyid_default_options'>default_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_retry_reads'>retry_reads</span>] <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_default_options'>default_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_retry_writes'>retry_writes</span>] <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="do_close-instance_method">
  <h3 class='signature priv'>
    #<strong>do_close</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Implementation for #close, assumes the connect lock is already acquired.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1328-L1331'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1328' data-end='1331'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1328</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_do_close'>do_close</span>
  <span class='ivar'>@cluster</span>.<span class='id identifier rubyid_close'><a href="#close-instance_method" title="Mongo::Client#close (method)">close</a></span>
  <span class='id identifier rubyid_close_encrypter'><a href="#close_encrypter-instance_method" title="Mongo::Client#close_encrypter (method)">close_encrypter</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encrypted_fields_map-instance_method">
  <h3 class='signature nodoc'>
    #<strong>encrypted_fields_map</strong>  &#x21d2; <code>Hash</code> | <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns encrypted field map hash if provided when creating the client.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Encrypted field map hash, or nil if not set.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1202-L1204'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1202' data-end='1204'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1202</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encrypted_fields_map'>encrypted_fields_map</span>
  <span class='ivar'>@encrypted_fields_map</span> <span class='op'>||=</span> <span class='ivar'>@options</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span><span class='comma'>,</span> {})[<span class='symbeg'>:</span><span class='id identifier rubyid_encrypted_fields_map'>encrypted_fields_map</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="eql?-instance_method">
  <h3 class='signature '>
    #<strong>eql?</strong>(other)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#==-instance_method" title="Mongo::Client#== (method)">#==</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L183-L183'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='183' data-end='183'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 183</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_eql?'>eql?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>==</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_session-instance_method">
  <h3 class='signature nodoc'>
    #<strong>get_session</strong>(options = {})  &#x21d2; <a href="Session.html" title="Mongo::Session (class)">Session</a> | <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a session to use for operations if possible.</p>

<p>If <code>:session</code> option is set, validates that session and returns it. Otherwise, if deployment supports sessions, creates a new session and returns it. When a new session is created, the session will be implicit (lifecycle is managed by the driver) if the <code>:implicit</code> option is given, otherwise the session will be explicit (lifecycle managed by the application). If deployment does not support session, returns nil.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:implicit</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>When no session is passed in, whether to create an implicit session.</p>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to validate and return.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p><a href="Session.html" title="Mongo::Session (class)"><code>Session</code></a> object or nil if sessions are not supported by the deployment.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1142-L1146'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1142' data-end='1146'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1142</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_session'>get_session</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_get_session!'><a href="#get_session!-instance_method" title="Mongo::Client#get_session! (method)">get_session!</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
<span class='kw'>rescue</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/SessionsNotSupported.html" title="Mongo::Error::SessionsNotSupported (class)">SessionsNotSupported</a></span>
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_session!-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>get_session!</strong>(options = {})  &#x21d2; <a href="Session.html" title="Mongo::Session (class)">Session</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a session to use for operations.</p>

<p>If <code>:session</code> option is set, validates that session and returns it. Otherwise, if deployment supports sessions, creates a new session and returns it. When a new session is created, the session will be implicit (lifecycle is managed by the driver) if the <code>:implicit</code> option is given, otherwise the session will be explicit (lifecycle managed by the application). If deployment does not support session, raises <a href="Error/InvalidSession.html" title="Mongo::Error::InvalidSession (class)"><code>Error::InvalidSession</code></a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:implicit</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>When no session is passed in, whether to create an implicit session.</p>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to validate and return.</p>
</div>        </li>
        <li>
          <span class='name'>:context</span>
          <span class='type'>(<a href="Operation/Context.html" title="Mongo::Operation::Context (class)">Operation::Context</a> | <code>nil</code>)</span>
            &mdash; <div class='inline'>
<p>Context of the operation the session is used for.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
&mdash;    <div class='inline'>
<p>A session object.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'></span>
    <div class='inline'>
<p><a href="Error/SessionsNotSupported.html" title="Mongo::Error::SessionsNotSupported (class)"><code>Error::SessionsNotSupported</code></a> if sessions are not supported by the deployment.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1355-L1371'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1355' data-end='1371'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1355</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_session!'>get_session!</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_session'>session</span>]
    <span class='kw'>return</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_session'>session</span>].<span class='id identifier rubyid_validate!'>validate!</span>(<span class='kw'>self</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_validate_session_support!'>validate_session_support!</span>(<span class='label'>timeout:</span> <span class='id identifier rubyid_timeout_sec'><a href="#timeout_sec-instance_method" title="Mongo::Client#timeout_sec (method)">timeout_sec</a></span>)

  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {<span class='label'>implicit:</span> <span class='kw'>true</span>}.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)

  <span class='id identifier rubyid_server_session'>server_session</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_implicit'>implicit</span>]
    <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_session_pool'>session_pool</span>.<span class='id identifier rubyid_checkout'>checkout</span>
  <span class='kw'>end</span>

  <span class='const'><a href="Session.html" title="Mongo::Session (class)">Session</a></span>.<span class='id identifier rubyid_new'><a href="Session.html#new-class_method" title="Mongo::Session.new (method)">new</a></span>(<span class='id identifier rubyid_server_session'>server_session</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="hash-instance_method">
  <h3 class='signature '>
    #<strong>hash</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the hash value of the client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the client hash value.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_hash'>hash</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The client hash value.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L208-L210'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='208' data-end='210'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 208</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_hash'>hash</span>
  [<span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>].<span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="initialize_copy-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>initialize_copy</strong>(original)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Auxiliary method that is called by interpreter when copying the client via dup or clone.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>original</span>
    <span class='type'>(<code>Client</code>)</span>
&mdash;    <div class='inline'>
<p><code>Client</code> that is being cloned.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1379-L1386'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1379' data-end='1386'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1379</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_copy'>initialize_copy</span>(<span class='id identifier rubyid_original'>original</span>)
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_original'>original</span>.<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='ivar'>@connect_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Client.new (method)">new</a></span>
  <span class='ivar'>@monitoring</span> <span class='op'>=</span> <span class='ivar'>@cluster</span> <span class='op'>?</span> <span class='id identifier rubyid_monitoring'><a href="#monitoring-instance_method" title="Mongo::Client#monitoring (method)">monitoring</a></span> <span class='op'>:</span> <span class='const'><a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a></span>.<span class='id identifier rubyid_new'><a href="Monitoring.html#new-class_method" title="Mongo::Monitoring.new (method)">new</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='ivar'>@database</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@read_preference</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@write_concern</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get an inspection of the client as a string.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Inspect the client.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_inspect'>inspect</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The inspection string.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L695-L697'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='695' data-end='697'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 695</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Mongo::Client:0x</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> cluster=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_summary'><a href="#summary-instance_method" title="Mongo::Client#summary (method)">summary</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="list_databases-instance_method">
  <h3 class='signature '>
    #<strong>list_databases</strong>(filter = {}, name_only = false, opts = {})  &#x21d2; <code>Array</code>&lt;<code>Hash</code>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get info for each database.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>See</span> <span class='label'>https:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/mongodb</span></span>.<span class='id identifier rubyid_com'>com</span><span class='op'>/</span><span class='id identifier rubyid_docs'>docs</span><span class='op'>/</span><span class='id identifier rubyid_manual'>manual</span><span class='op'>/</span><span class='id identifier rubyid_reference'>reference</span><span class='op'>/</span><span class='id identifier rubyid_command'>command</span><span class='op'>/</span><span class='id identifier rubyid_listDatabases'>listDatabases</span><span class='op'>/</span>
<span class='kw'>for</span> <span class='id identifier rubyid_more'>more</span> <span class='id identifier rubyid_information'>information</span> <span class='kw'>and</span> <span class='id identifier rubyid_usage'>usage</span>.</code></pre>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the info for each database.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_list_databases'>list_databases</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filter</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The filter criteria for getting a list of databases.</p>
</div>
  </li>
  <li>
    <span class='name'>name_only</span>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
    <em class='default'>(defaults to: <tt>false</tt>)</em>
&mdash;    <div class='inline'>
<p>Whether to only return each database name without full metadata.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The command options.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:authorized_databases</span>
          <span class='type'>(<code>true</code>, <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>A flag that determines which databases are returned based on user privileges when access control is enabled.</p>
</div>        </li>
        <li>
          <span class='name'>:comment</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>A user-provided comment to attach to this command.</p>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<code>Hash</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>The info for each database.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.5</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L984-L993'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='984' data-end='993'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 984</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_list_databases'>list_databases</span>(<span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_name_only'>name_only</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> { <span class='label'>listDatabases:</span> <span class='int'>1</span> }
  <span class='id identifier rubyid_cmd'>cmd</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_nameOnly'>nameOnly</span>] <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_name_only'>name_only</span>
  <span class='id identifier rubyid_cmd'>cmd</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_filter'>filter</span>] <span class='op'>=</span> <span class='id identifier rubyid_filter'>filter</span> <span class='kw'>unless</span> <span class='id identifier rubyid_filter'>filter</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_cmd'>cmd</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_authorizedDatabases'>authorizedDatabases</span>] <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_authorized_databases'>authorized_databases</span>]
  <span class='id identifier rubyid_use'><a href="#use-instance_method" title="Mongo::Client#use (method)">use</a></span>(<span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span>)
    .<span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span>
    .<span class='id identifier rubyid_read_command'>read_command</span>(<span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>op_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>listDatabases</span><span class='tstring_end'>&#39;</span></span>))
    .<span class='id identifier rubyid_first'>first</span>[<span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="Database.html#DATABASES-constant" title="Mongo::Database::DATABASES (constant)">DATABASES</a></span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="list_mongo_databases-instance_method">
  <h3 class='signature '>
    #<strong>list_mongo_databases</strong>(filter = {}, opts = {})  &#x21d2; <code>Array</code>&lt;<a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a>&gt; 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a list of <a href="Database.html" title="Mongo::Database (class)"><code>Database</code></a> objects.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get a list of <a href="Database.html" title="Mongo::Database (class)"><code>Database</code></a> objects.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_list_mongo_databases'>list_mongo_databases</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>filter</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The filter criteria for getting a list of databases.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The command options.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Array</code>&lt;<a href="Database.html" title="Mongo::Database (class)">Mongo::Database</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>The list of database objects.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1010-L1014'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1010' data-end='1014'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1010</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_list_mongo_databases'>list_mongo_databases</span>(<span class='id identifier rubyid_filter'>filter</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_database_names'><a href="#database_names-instance_method" title="Mongo::Client#database_names (method)">database_names</a></span>(<span class='id identifier rubyid_filter'>filter</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>).<span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span>.<span class='id identifier rubyid_new'><a href="Database.html#new-class_method" title="Mongo::Database.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_read_retries-instance_method">
  <h3 class='signature nodoc'>
    #<strong>max_read_retries</strong>  &#x21d2; <code>Integer</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the maximum number of times the client can retry a read operation when using legacy read retries.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The maximum number of retries.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L663-L665'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='663' data-end='665'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 663</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_max_read_retries'>max_read_retries</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_read_retries'>max_read_retries</span>] <span class='op'>||</span> <span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span><span class='op'>::</span><span class='const'><a href="Cluster.html#MAX_READ_RETRIES-constant" title="Mongo::Cluster::MAX_READ_RETRIES (constant)">MAX_READ_RETRIES</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_write_retries-instance_method">
  <h3 class='signature nodoc'>
    #<strong>max_write_retries</strong>  &#x21d2; <code>Integer</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the maximum number of times the client can retry a write operation when using legacy write retries.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The maximum number of retries.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L683-L685'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='683' data-end='685'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 683</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_max_write_retries'>max_write_retries</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_write_retries'>max_write_retries</span>] <span class='op'>||</span> <span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span><span class='op'>::</span><span class='const'><a href="Cluster.html#MAX_WRITE_RETRIES-constant" title="Mongo::Cluster::MAX_WRITE_RETRIES (constant)">MAX_WRITE_RETRIES</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="monitoring-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>monitoring</strong>  &#x21d2; <a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Monitoring.html" title="Mongo::Monitoring (class)">Monitoring</a>)</span>
&mdash;    <div class='inline'>
<p>monitoring The monitoring.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L160-L166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='160' data-end='166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 160</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_monitoring'>monitoring</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>
    <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_monitoring'>monitoring</span>
  <span class='kw'>else</span>
    <span class='ivar'>@monitoring</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_addresses-instance_method">
  <h3 class='signature priv'>
    #<strong>process_addresses</strong>(addresses, options)  &#x21d2; <code>Hash</code>&lt;<code>:uri</code>, <code>:addresses</code>, <code>:options</code>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempts to parse the given list of addresses, using the provided options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>addresses</span>
    <span class='type'>(<code>String</code> | <code>Array</code>&lt;<code>String</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the list of addresses</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>the options that may drive how the list is processed.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>&lt;<code>:uri</code>, <code>:addresses</code>, <code>:options</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the results of processing the list of addresses.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1244-L1250'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1244' data-end='1250'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_addresses'>process_addresses</span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_addresses'>addresses</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>String</span>)
    <span class='id identifier rubyid_process_addresses_string'><a href="#process_addresses_string-instance_method" title="Mongo::Client#process_addresses_string (method)">process_addresses_string</a></span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_process_addresses_array'><a href="#process_addresses_array-instance_method" title="Mongo::Client#process_addresses_array (method)">process_addresses_array</a></span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_addresses_array-instance_method">
  <h3 class='signature priv'>
    #<strong>process_addresses_array</strong>(addresses, options)  &#x21d2; <code>Hash</code>&lt;<code>:uri</code>, <code>:addresses</code>, <code>:options</code>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempts to parse the given list of addresses, using the provided options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>addresses</span>
    <span class='type'>(<code>Array</code>&lt;<code>String</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the list of addresses</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>the options that may drive how the list is processed.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>&lt;<code>:uri</code>, <code>:addresses</code>, <code>:options</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the results of processing the list of addresses.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1288-L1301'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1288' data-end='1301'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1288</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_addresses_array'>process_addresses_array</span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  {}.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_processed'>processed</span><span class='op'>|</span>
    <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_addresses'>addresses</span>] <span class='op'>=</span> <span class='id identifier rubyid_addresses'>addresses</span>
    <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>

    <span class='id identifier rubyid_addresses'>addresses</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_addr'>addr</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Amongodb(\+srv)?:\/\/</span><span class='regexp_end'>/i</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_addr'>addr</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; should not contain protocol. Did you mean to not use an array?</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='ivar'>@srv_records</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="process_addresses_string-instance_method">
  <h3 class='signature priv'>
    #<strong>process_addresses_string</strong>(addresses, options)  &#x21d2; <code>Hash</code>&lt;<code>:uri</code>, <code>:addresses</code>, <code>:options</code>&gt;  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempts to parse the given list of addresses, using the provided options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>addresses</span>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>the list of addresses</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>the options that may drive how the list is processed.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>&lt;<code>:uri</code>, <code>:addresses</code>, <code>:options</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the results of processing the list of addresses.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1260-L1278'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1260' data-end='1278'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_process_addresses_string'>process_addresses_string</span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
  {}.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_processed'>processed</span><span class='op'>|</span>
    <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_uri'>uri</span>] <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><a href="URI.html" title="Mongo::URI (class)">URI</a></span>.<span class='id identifier rubyid_get'><a href="URI.html#get-class_method" title="Mongo::URI.get (method)">get</a></span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
    <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_addresses'>addresses</span>] <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_servers'>servers</span>

    <span class='id identifier rubyid_uri_options'>uri_options</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_client_options'>client_options</span>.<span class='id identifier rubyid_dup'>dup</span>
    <span class='comment'># Special handing for :write and :write_concern: allow client Ruby
</span>    <span class='comment'># options to override URI options, even when the Ruby option uses the
</span>    <span class='comment'># deprecated :write key and the URI option uses the current
</span>    <span class='comment'># :write_concern key
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>]
      <span class='id identifier rubyid_uri_options'>uri_options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_processed'>processed</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_uri_options'>uri_options</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)

    <span class='ivar'>@srv_records</span> <span class='op'>=</span> <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_srv_records'>srv_records</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_concern-instance_method">
  <h3 class='signature '>
    #<strong>read_concern</strong>  &#x21d2; <code>Hash</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the read concern for this client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the client read concern.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_read_concern'>read_concern</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>The read concern.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.6.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L860-L862'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='860' data-end='862'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 860</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_concern'>read_concern</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'>read_concern</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_preference-instance_method">
  <h3 class='signature '>
    #<strong>read_preference</strong>  &#x21d2; <code>BSON::Document</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the read preference from the options passed to the client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the read preference.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_read_preference'>read_preference</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>BSON::Document</code>)</span>
&mdash;    <div class='inline'>
<p>The user-defined read preference. The document may have the following fields:</p>
<ul><li>
<p><strong>:mode</strong> – read preference specified as a symbol; valid values are <strong>:primary</strong>, <strong>:primary_preferred</strong>, <strong>:secondary</strong>, <strong>:secondary_preferred</strong> and <strong>:nearest</strong>.</p>
</li><li>
<p><strong>:tag_sets</strong> – an array of hashes.</p>
</li><li>
<p><strong>:local_threshold</strong>.</p>
</li></ul>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L743-L745'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='743' data-end='745'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 743</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_preference'>read_preference</span>
  <span class='ivar'>@read_preference</span> <span class='op'>||=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_retry_interval-instance_method">
  <h3 class='signature nodoc'>
    #<strong>read_retry_interval</strong>  &#x21d2; <code>Float</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the interval, in seconds, in which read retries when using legacy read retries.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>The interval.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L673-L675'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='673' data-end='675'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 673</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span>
  <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_retry_interval'>read_retry_interval</span>] <span class='op'>||</span> <span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span><span class='op'>::</span><span class='const'><a href="Cluster.html#READ_RETRY_INTERVAL-constant" title="Mongo::Cluster::READ_RETRY_INTERVAL (constant)">READ_RETRY_INTERVAL</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reconnect-instance_method">
  <h3 class='signature '>
    #<strong>reconnect</strong>  &#x21d2; <code>true</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reconnect the client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Reconnect the client.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_reconnect'>reconnect</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>Always true.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.1.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L911-L927'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='911' data-end='927'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 911</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reconnect'>reconnect</span>
  <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>=</span> <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_addresses'>addresses</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)

  <span class='ivar'>@connect_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_do_close'><a href="#do_close-instance_method" title="Mongo::Client#do_close (method)">do_close</a></span> <span class='kw'>rescue</span> <span class='kw'>nil</span>

    <span class='ivar'>@cluster</span> <span class='op'>=</span> <span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span>.<span class='id identifier rubyid_new'><a href="Cluster.html#new-class_method" title="Mongo::Cluster.new (method)">new</a></span>(<span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='id identifier rubyid_monitoring'><a href="#monitoring-instance_method" title="Mongo::Client#monitoring (method)">monitoring</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cluster_options'><a href="#cluster_options-instance_method" title="Mongo::Client#cluster_options (method)">cluster_options</a></span>)

    <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>]
      <span class='id identifier rubyid_build_encrypter'><a href="#build_encrypter-instance_method" title="Mongo::Client#build_encrypter (method)">build_encrypter</a></span>
    <span class='kw'>end</span>

    <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="server_selector-instance_method">
  <h3 class='signature '>
    #<strong>server_selector</strong>  &#x21d2; <a href="ServerSelector.html" title="Mongo::ServerSelector (module)">Mongo::ServerSelector</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the server selector. It either uses the read preference defined in the client options or defaults to a Primary server selector.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the server selector.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_server_selector'>server_selector</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="ServerSelector.html" title="Mongo::ServerSelector (module)">Mongo::ServerSelector</a>)</span>
&mdash;    <div class='inline'>
<p>The server selector using the user-defined read preference or a Primary server selector default.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L721-L727'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='721' data-end='727'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 721</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_server_selector'>server_selector</span>
  <span class='ivar'>@server_selector</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='id identifier rubyid_read_preference'><a href="#read_preference-instance_method" title="Mongo::Client#read_preference (method)">read_preference</a></span>
    <span class='const'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span>.<span class='id identifier rubyid_get'><a href="ServerSelector.html#get-instance_method" title="Mongo::ServerSelector#get (method)">get</a></span>(<span class='id identifier rubyid_read_preference'><a href="#read_preference-instance_method" title="Mongo::Client#read_preference (method)">read_preference</a></span>)
  <span class='kw'>else</span>
    <span class='const'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span>.<span class='id identifier rubyid_primary'><a href="ServerSelector.html#primary-instance_method" title="Mongo::ServerSelector#primary (method)">primary</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start_session-instance_method">
  <h3 class='signature '>
    #<strong>start_session</strong>(options = {})  &#x21d2; <a href="Session.html" title="Mongo::Session (class)">Session</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>A Session cannot be used by multiple threads at once; session objects are not thread-safe.</p>
</div>
  </div>


<p>Start a session.</p>

<p>If the deployment does not support sessions, raises Mongo::Error::InvalidSession. This exception can also be raised when the driver is not connected to a data-bearing server, for example during failover.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Start a session.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_start_session'>start_session</span>(<span class='label'>causal_consistency:</span> <span class='kw'>true</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The session options. Accepts the options that Session#initialize accepts.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
&mdash;    <div class='inline'>
<p>The session.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.5.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1035-L1046'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1035' data-end='1046'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1035</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_start_session'>start_session</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_get_session!'><a href="#get_session!-instance_method" title="Mongo::Client#get_session! (method)">get_session!</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>implicit:</span> <span class='kw'>false</span>))
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_session'>session</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_end_session'>end_session</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_session'>session</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="summary-instance_method">
  <h3 class='signature '>
    #<strong>summary</strong>  &#x21d2; <code>String</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The exact format and layout of the returned summary string is not part of the driver’s public API and may be changed at any time.</p>
</div>
  </div>


<p>Get a summary of the client state.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>The summary string.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.7.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L707-L709'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='707' data-end='709'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 707</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_summary'>summary</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Client cluster=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_summary'>summary</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="timeout_ms-instance_method">
  <h3 class='signature nodoc'>
    #<strong>timeout_ms</strong>  &#x21d2; <code>Integer</code> | <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Value of timeout_ms option if set.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1208-L1210'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1208' data-end='1210'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1208</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_timeout_ms'>timeout_ms</span>
  <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_timeout_ms'>timeout_ms</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="timeout_sec-instance_method">
  <h3 class='signature nodoc'>
    #<strong>timeout_sec</strong>  &#x21d2; <code>Float</code> | <code>nil</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Float</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>Value of timeout_ms option converted to seconds.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1214-L1220'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1214' data-end='1220'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1214</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_timeout_sec'>timeout_sec</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Client#timeout_ms (method)">timeout_ms</a></span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_timeout_ms'><a href="#timeout_ms-instance_method" title="Mongo::Client#timeout_ms (method)">timeout_ms</a></span> <span class='op'>/</span> <span class='float'>1_000.0</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tracer-instance_method">
  <h3 class='signature '>
    #<strong>tracer</strong>  &#x21d2; <code>Tracing::Tracer</code> | <code>nil</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the tracer configured for this client.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Tracing::Tracer</code> | <code>nil</code>)</span>
&mdash;    <div class='inline'>
<p>The tracer configured for this client.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1225-L1232'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1225' data-end='1232'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1225</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_tracer'>tracer</span>
  <span class='id identifier rubyid_tracing_opts'>tracing_opts</span> <span class='op'>=</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_tracing'>tracing</span>] <span class='op'>||</span> {}
  <span class='ivar'>@tracer</span> <span class='op'>||=</span> <span class='const'><a href="Tracing.html" title="Mongo::Tracing (module)">Tracing</a></span>.<span class='id identifier rubyid_create_tracer'><a href="Tracing.html#create_tracer-class_method" title="Mongo::Tracing.create_tracer (method)">create_tracer</a></span>(
    <span class='label'>enabled:</span> <span class='id identifier rubyid_tracing_opts'>tracing_opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_enabled'>enabled</span>]<span class='comma'>,</span>
    <span class='label'>query_text_max_length:</span> <span class='id identifier rubyid_tracing_opts'>tracing_opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_query_text_max_length'>query_text_max_length</span>]<span class='comma'>,</span>
    <span class='label'>otel_tracer:</span> <span class='id identifier rubyid_tracing_opts'>tracing_opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_tracer'>tracer</span>]<span class='comma'>,</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_options-instance_method">
  <h3 class='signature nodoc'>
    #<strong>update_options</strong>(new_options)  &#x21d2; <code>Hash</code> 
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates this client’s options from new_options, validating all options.</p>

<p>The new options may be transformed according to various rules. The final hash of options actually applied to the client is returned.</p>

<p>If options fail validation, this method may warn or raise an exception. If this method raises an exception, the client should be discarded (similarly to if a constructor raised an exception).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>new_options</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>The new options to use.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>Modified new options written into the client.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L810-L850'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='810' data-end='850'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 810</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_options'>update_options</span>(<span class='id identifier rubyid_new_options'>new_options</span>)
  <span class='id identifier rubyid_old_options'>old_options</span> <span class='op'>=</span> <span class='ivar'>@options</span>

  <span class='id identifier rubyid_new_options'>new_options</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_canonicalize_ruby_options'><a href="#canonicalize_ruby_options-class_method" title="Mongo::Client.canonicalize_ruby_options (method)">canonicalize_ruby_options</a></span>(<span class='id identifier rubyid_new_options'>new_options</span> <span class='op'>||</span> {})

  <span class='id identifier rubyid_validate_new_options!'><a href="#validate_new_options!-instance_method" title="Mongo::Client#validate_new_options! (method)">validate_new_options!</a></span>(<span class='id identifier rubyid_new_options'>new_options</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_opts'>opts</span><span class='op'>|</span>
    <span class='comment'># Our options are frozen
</span>    <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> <span class='ivar'>@options</span>.<span class='id identifier rubyid_dup'>dup</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span>]
      <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>)
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>]
      <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_opts'>opts</span>)
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_freeze'>freeze</span>

    <span class='id identifier rubyid_auto_encryption_options_changed'>auto_encryption_options_changed</span> <span class='op'>=</span>
      <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>] <span class='op'>!=</span> <span class='id identifier rubyid_old_options'>old_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>]

    <span class='comment'># If there are new auto_encryption_options, create a new encrypter.
</span>    <span class='comment'># Otherwise, allow the new client to share an encrypter with the
</span>    <span class='comment'># original client.
</span>    <span class='comment'>#
</span>    <span class='comment'># If auto_encryption_options are nil, set @encrypter to nil, but do not
</span>    <span class='comment'># close the encrypter because it may still be used by the original client.
</span>    <span class='kw'>if</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_auto_encryption_options_changed'>auto_encryption_options_changed</span>
      <span class='ivar'>@connect_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_build_encrypter'><a href="#build_encrypter-instance_method" title="Mongo::Client#build_encrypter (method)">build_encrypter</a></span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='ivar'>@options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auto_encryption_options'>auto_encryption_options</span>].<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='ivar'>@connect_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
        <span class='ivar'>@encrypter</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_validate_options!'><a href="#validate_options!-instance_method" title="Mongo::Client#validate_options! (method)">validate_options!</a></span>
    <span class='id identifier rubyid_validate_authentication_options!'><a href="#validate_authentication_options!-instance_method" title="Mongo::Client#validate_authentication_options! (method)">validate_authentication_options!</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="use-instance_method">
  <h3 class='signature '>
    #<strong>use</strong>(name)  &#x21d2; <code>Client</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The new client shares the cluster with the original client, and as a result also shares the monitoring instance and monitoring event subscribers.</p>
</div>
  </div>


<p>Creates a new client configured to use the database with the provided name, and using the other options configured in this client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Create a client for the ‘users’ database.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_use'>use</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span>)</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>name</span>
    <span class='type'>(<code>String</code>, <a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The name of the database to use.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Client</code>)</span>
&mdash;    <div class='inline'>
<p>A new client instance.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L762-L764'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='762' data-end='764'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 762</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_use'>use</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_with'><a href="#with-instance_method" title="Mongo::Client#with (method)">with</a></span>(<span class='label'>database:</span> <span class='id identifier rubyid_name'>name</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_compressors-instance_method">
  <h3 class='signature priv'>
    #<strong>valid_compressors</strong>(compressors)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1665-L1676'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1665' data-end='1676'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1665</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_compressors'>valid_compressors</span>(<span class='id identifier rubyid_compressors'>compressors</span>)
  <span class='id identifier rubyid_compressors'>compressors</span>.<span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_compressor'>compressor</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='const'><a href="#VALID_COMPRESSORS-constant" title="Mongo::Client::VALID_COMPRESSORS (constant)">VALID_COMPRESSORS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_compressor'>compressor</span>)
      <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported compressor &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_compressor'>compressor</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; in list &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_compressors'>compressors</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;. </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This compressor will not be used.</span><span class='tstring_end'>&quot;</span></span>)
      <span class='kw'>false</span>
    <span class='kw'>else</span>

      <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_authentication_options!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_authentication_options!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validates all authentication-related options after they are set on the client This method is intended to catch combinations of options which are not allowed</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1610-L1663'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1610' data-end='1663'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1610</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_authentication_options!'>validate_authentication_options!</span>
  <span class='id identifier rubyid_auth_mech'>auth_mech</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech'>auth_mech</span>]
  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>]
  <span class='id identifier rubyid_password'>password</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_password'>password</span>]
  <span class='id identifier rubyid_auth_source'>auth_source</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_source'>auth_source</span>]
  <span class='id identifier rubyid_mech_properties'>mech_properties</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_auth_mech_properties'>auth_mech_properties</span>]

  <span class='kw'>if</span> <span class='id identifier rubyid_auth_mech'>auth_mech</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Empty username is not supported for default auth mechanism</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_auth_source'>auth_source</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Auth source cannot be empty for default auth mechanism</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth.html#SOURCES-constant" title="Mongo::Auth::SOURCES (constant)">SOURCES</a></span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_auth_mech'>auth_mech</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidMechanism.html" title="Mongo::Auth::InvalidMechanism (class)">InvalidMechanism</a></span>.<span class='id identifier rubyid_new'><a href="Auth/InvalidMechanism.html#new-class_method" title="Mongo::Auth::InvalidMechanism.new (method)">new</a></span>(<span class='id identifier rubyid_auth_mech'>auth_mech</span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>aws</span><span class='words_sep'> </span><span class='tstring_content'>mongodb_x509</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_auth_mech'>auth_mech</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Username is required for auth mechanism </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_mech'>auth_mech</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_password'>password</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>aws</span><span class='words_sep'> </span><span class='tstring_content'>gssapi</span><span class='words_sep'> </span><span class='tstring_content'>mongodb_x509</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_auth_mech'>auth_mech</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Password is required for auth mechanism </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_mech'>auth_mech</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_auth_mech'>auth_mech</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_mongodb_x509'>mongodb_x509</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Password is not supported for :mongodb_x509 auth mechanism</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_auth_mech'>auth_mech</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_aws'>aws</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_password'>password</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Username is provided but password is not provided for :aws auth mechanism</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>aws</span><span class='words_sep'> </span><span class='tstring_content'>gssapi</span><span class='words_sep'> </span><span class='tstring_content'>mongodb_x509</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_auth_mech'>auth_mech</span>)
    <span class='kw'>if</span> <span class='op'>!</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$external</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>nil</span>].<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_auth_source'>auth_source</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_source'>auth_source</span><span class='embexpr_end'>}</span><span class='tstring_content'> is an invalid auth source for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_mech'>auth_mech</span><span class='embexpr_end'>}</span><span class='tstring_content'>; valid options are $external and nil</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Auth source is the database name, and thus cannot be the empty string.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_auth_source'>auth_source</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Auth source cannot be empty for auth mechanism </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_mech'>auth_mech</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_mech_properties'>mech_properties</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>aws</span><span class='words_sep'> </span><span class='tstring_content'>gssapi</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_auth_mech'>auth_mech</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Auth/InvalidConfiguration.html" title="Mongo::Auth::InvalidConfiguration (class)">InvalidConfiguration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:mechanism_properties are not supported for auth mechanism </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_auth_mech'>auth_mech</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_max_connecting!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_max_connecting!</strong>(option, opts)  &#x21d2; <code>true</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validates whether the max_connecting option is valid.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>option</span>
    <span class='type'>(<a href="../Symbol.html" title="Symbol (class)">Symbol</a>)</span>
&mdash;    <div class='inline'>
<p>The option to validate.</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<code>Hash</code>)</span>
&mdash;    <div class='inline'>
<p>The client options.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>)</span>
&mdash;    <div class='inline'>
<p>If the option is valid.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Error/InvalidMaxConnecting.html" title="Mongo::Error::InvalidMaxConnecting (class)">Error::InvalidMaxConnecting</a>)</span>
&mdash;    <div class='inline'>
<p>If the option is invalid.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1713-L1721'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1713' data-end='1721'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1713</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_max_connecting!'>validate_max_connecting!</span>(<span class='id identifier rubyid_option'>option</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_option'>option</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_connecting'>max_connecting</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_max_connecting'>max_connecting</span>)
    <span class='id identifier rubyid_max_connecting'>max_connecting</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_connecting'>max_connecting</span>] <span class='op'>||</span> <span class='const'><a href="Server.html" title="Mongo::Server (class)">Server</a></span><span class='op'>::</span><span class='const'><a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">ConnectionPool</a></span><span class='op'>::</span><span class='const'><a href="Server/ConnectionPool.html#DEFAULT_MAX_CONNECTING-constant" title="Mongo::Server::ConnectionPool::DEFAULT_MAX_CONNECTING (constant)">DEFAULT_MAX_CONNECTING</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_max_connecting'>max_connecting</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidMaxConnecting.html" title="Mongo::Error::InvalidMaxConnecting (class)">InvalidMaxConnecting</a></span>.<span class='id identifier rubyid_new'><a href="Error/InvalidMaxConnecting.html#new-class_method" title="Mongo::Error::InvalidMaxConnecting.new (method)">new</a></span>(<span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_connecting'>max_connecting</span>])
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_max_min_pool_size!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_max_min_pool_size!</strong>(option, opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1696-L1704'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1696' data-end='1704'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1696</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_max_min_pool_size!'>validate_max_min_pool_size!</span>(<span class='id identifier rubyid_option'>option</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_option'>option</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_min_pool_size'>min_pool_size</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_min_pool_size'>min_pool_size</span>]
    <span class='id identifier rubyid_max'>max</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_pool_size'>max_pool_size</span>] <span class='op'>||</span> <span class='const'><a href="Server.html" title="Mongo::Server (class)">Server</a></span><span class='op'>::</span><span class='const'><a href="Server/ConnectionPool.html" title="Mongo::Server::ConnectionPool (class)">ConnectionPool</a></span><span class='op'>::</span><span class='const'><a href="Server/ConnectionPool.html#DEFAULT_MAX_SIZE-constant" title="Mongo::Server::ConnectionPool::DEFAULT_MAX_SIZE (constant)">DEFAULT_MAX_SIZE</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_min_pool_size'>min_pool_size</span>] <span class='op'>&gt;</span> <span class='id identifier rubyid_max'>max</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidMinPoolSize.html" title="Mongo::Error::InvalidMinPoolSize (class)">InvalidMinPoolSize</a></span>.<span class='id identifier rubyid_new'><a href="Error/InvalidMinPoolSize.html#new-class_method" title="Mongo::Error::InvalidMinPoolSize.new (method)">new</a></span>(<span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_min_pool_size'>min_pool_size</span>]<span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_new_options!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_new_options!</strong>(opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validates options in the provided argument for validity. The argument may contain a subset of options that the client will eventually have; this method validates each of the provided options but does not check for interactions between combinations of options.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1401-L1471'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1401' data-end='1471'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1401</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_new_options!'>validate_new_options!</span>(<span class='id identifier rubyid_opts'>opts</span>)
  <span class='kw'>return</span> <span class='const'><a href="Options.html" title="Mongo::Options (module)">Options</a></span><span class='op'>::</span><span class='const'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Client.new (method)">new</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_opts'>opts</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'><a href="#read_concern-instance_method" title="Mongo::Client#read_concern (method)">read_concern</a></span>]
    <span class='comment'># Raise an error for non user-settable options
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'><a href="#read_concern-instance_method" title="Mongo::Client#read_concern (method)">read_concern</a></span>][<span class='symbeg'>:</span><span class='id identifier rubyid_after_cluster_time'>after_cluster_time</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidReadConcern.html" title="Mongo::Error::InvalidReadConcern (class)">InvalidReadConcern</a></span>.<span class='id identifier rubyid_new'><a href="Error/InvalidReadConcern.html#new-class_method" title="Mongo::Error::InvalidReadConcern.new (method)">new</a></span>(
        <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The after_cluster_time read_concern option cannot be specified by the user</span><span class='tstring_end'>&#39;</span></span>
      )
    <span class='kw'>end</span>

    <span class='id identifier rubyid_given_keys'>given_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'><a href="#read_concern-instance_method" title="Mongo::Client#read_concern (method)">read_concern</a></span>].<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)
    <span class='id identifier rubyid_allowed_keys'>allowed_keys</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>level</span><span class='tstring_end'>&#39;</span></span>]
    <span class='id identifier rubyid_invalid_keys'>invalid_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_given_keys'>given_keys</span> <span class='op'>-</span> <span class='id identifier rubyid_allowed_keys'>allowed_keys</span>
    <span class='comment'># Warn that options are invalid but keep it and forward to the server
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_invalid_keys'>invalid_keys</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Read concern has invalid keys: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_invalid_keys'>invalid_keys</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_server_api'>server_api</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_server_api'>server_api</span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_server_api'>server_api</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:server_api value must be a hash: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_server_api'>server_api</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_extra_keys'>extra_keys</span> <span class='op'>=</span> <span class='id identifier rubyid_server_api'>server_api</span>.<span class='id identifier rubyid_keys'>keys</span> <span class='op'>-</span> <span class='qwords'><span class='qwords_beg'>%w(</span><span class='tstring_content'>version</span><span class='words_sep'> </span><span class='tstring_content'>strict</span><span class='words_sep'> </span><span class='tstring_content'>deprecation_errors</span><span class='tstring_end'>)</span></span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_extra_keys'>extra_keys</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown keys under :server_api: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_extra_keys'>extra_keys</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Mongo::Client#inspect (method)">inspect</a></span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_server_api'>server_api</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_version'>version</span>]
      <span class='kw'>unless</span> <span class='const'><a href="#VALID_SERVER_API_VERSIONS-constant" title="Mongo::Client::VALID_SERVER_API_VERSIONS (constant)">VALID_SERVER_API_VERSIONS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_version'>version</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown server API version: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='const'><a href="Lint.html" title="Mongo::Lint (module)">Lint</a></span>.<span class='id identifier rubyid_validate_underscore_read_preference'><a href="Lint.html#validate_underscore_read_preference-class_method" title="Mongo::Lint.validate_underscore_read_preference (method)">validate_underscore_read_preference</a></span>(<span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>])
  <span class='const'><a href="Lint.html" title="Mongo::Lint (module)">Lint</a></span>.<span class='id identifier rubyid_validate_read_concern_option'><a href="Lint.html#validate_read_concern_option-class_method" title="Mongo::Lint.validate_read_concern_option (method)">validate_read_concern_option</a></span>(<span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read_concern'><a href="#read_concern-instance_method" title="Mongo::Client#read_concern (method)">read_concern</a></span>])
  <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_each'>each</span>.<span class='id identifier rubyid_inject'>inject</span>(<span class='const'><a href="Options.html" title="Mongo::Options (module)">Options</a></span><span class='op'>::</span><span class='const'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Client.new (method)">new</a></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid__options'>_options</span><span class='comma'>,</span> (<span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span>)<span class='op'>|</span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>
    <span class='kw'>if</span> <span class='const'><a href="#VALID_OPTIONS-constant" title="Mongo::Client::VALID_OPTIONS (constant)">VALID_OPTIONS</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_key'>key</span>)
      <span class='id identifier rubyid_validate_max_min_pool_size!'><a href="#validate_max_min_pool_size!-instance_method" title="Mongo::Client#validate_max_min_pool_size! (method)">validate_max_min_pool_size!</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
      <span class='id identifier rubyid_validate_max_connecting!'><a href="#validate_max_connecting!-instance_method" title="Mongo::Client#validate_max_connecting! (method)">validate_max_connecting!</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
      <span class='id identifier rubyid_validate_read!'><a href="#validate_read!-instance_method" title="Mongo::Client#validate_read! (method)">validate_read!</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
      <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_compressors'>compressors</span>
        <span class='id identifier rubyid_compressors'>compressors</span> <span class='op'>=</span> <span class='id identifier rubyid_valid_compressors'><a href="#valid_compressors-instance_method" title="Mongo::Client#valid_compressors (method)">valid_compressors</a></span>(<span class='id identifier rubyid_v'>v</span>)

        <span class='kw'>if</span> <span class='id identifier rubyid_compressors'>compressors</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>snappy</span><span class='tstring_end'>&#39;</span></span>)
          <span class='id identifier rubyid_validate_snappy_compression!'><a href="#validate_snappy_compression!-instance_method" title="Mongo::Client#validate_snappy_compression! (method)">validate_snappy_compression!</a></span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_compressors'>compressors</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>zstd</span><span class='tstring_end'>&#39;</span></span>)
          <span class='id identifier rubyid_validate_zstd_compression!'><a href="#validate_zstd_compression!-instance_method" title="Mongo::Client#validate_zstd_compression! (method)">validate_zstd_compression!</a></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid__options'>_options</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_compressors'>compressors</span> <span class='kw'>unless</span> <span class='id identifier rubyid_compressors'>compressors</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_srv_max_hosts'>srv_max_hosts</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&amp;&amp;</span> (<span class='op'>!</span><span class='id identifier rubyid_v'>v</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Integer</span>) <span class='op'>||</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&lt;</span> <span class='int'>0</span>)
          <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not a valid integer for srv_max_hosts</span><span class='tstring_end'>&quot;</span></span>)
        <span class='kw'>else</span>
          <span class='id identifier rubyid__options'>_options</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid__options'>_options</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_log_warn'>log_warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unsupported client option &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;. It will be ignored.</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid__options'>_options</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_options!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_options!</strong>(addresses = nil, is_srv: nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validates all options after they are set on the client. This method is intended to catch combinations of options which are not allowed.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1476-L1606'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1476' data-end='1606'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1476</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_options!'>validate_options!</span>(<span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>is_srv:</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>] <span class='op'>!=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'><a href="#write_concern-instance_method" title="Mongo::Client#write_concern (method)">write_concern</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>If :write and :write_concern are both given, they must be identical: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Mongo::Client#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_connect'>connect</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_connect'>connect</span>]<span class='op'>&amp;.</span><span class='id identifier rubyid_to_sym'>to_sym</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>direct</span><span class='words_sep'> </span><span class='tstring_content'>replica_set</span><span class='words_sep'> </span><span class='tstring_content'>sharded</span><span class='words_sep'> </span><span class='tstring_content'>load_balanced</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_connect'>connect</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid :connect option value: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect'>connect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_direct_connection'>direct_connection</span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_direct'>direct</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Conflicting client options: direct_connection=true and connect=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect'>connect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='comment'># When a new client is created, we get the list of seed addresses
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_addresses'>addresses</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>direct_connection=true cannot be used with multiple seeds</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='comment'># When a client is copied using #with, we have a cluster
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_topology'>topology</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span><span class='op'>::</span><span class='const'><a href="Cluster/Topology.html" title="Mongo::Cluster::Topology (module)">Topology</a></span><span class='op'>::</span><span class='const'><a href="Cluster/Topology/Single.html" title="Mongo::Cluster::Topology::Single (class)">Single</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>direct_connection=true cannot be used with topologies other than Single (this client is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cluster'><a href="#cluster-instance_method" title="Mongo::Client#cluster (method)">cluster</a></span>.<span class='id identifier rubyid_topology'>topology</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.*::</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_load_balanced'>load_balanced</span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_addresses'>addresses</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>load_balanced=true cannot be used with multiple seeds</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_direct_connection'>direct_connection</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>direct_connection=true cannot be used with load_balanced=true</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>!=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_load_balanced'>load_balanced</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connect=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect'>connect</span><span class='embexpr_end'>}</span><span class='tstring_content'> cannot be used with load_balanced=true</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_replica_set'>replica_set</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>load_balanced=true cannot be used with replica_set option</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_load_balanced'>load_balanced</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_addresses'>addresses</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_addresses'>addresses</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connect=load_balanced cannot be used with multiple seeds</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_replica_set'>replica_set</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connect=load_balanced cannot be used with replica_set option</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_direct_connection'>direct_connection</span>] <span class='op'>==</span> <span class='kw'>false</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connect'>connect</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_direct'>direct</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Conflicting client options: direct_connection=false and connect=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connect'>connect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>connect_timeout</span><span class='words_sep'> </span><span class='tstring_content'>socket_timeout</span><span class='tstring_end'>)</span></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='id identifier rubyid_key'>key</span>]
      <span class='kw'>unless</span> <span class='const'>Numeric</span> <span class='op'>===</span> <span class='id identifier rubyid_value'>value</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> must be a non-negative number: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> must be a non-negative number: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_bg_error_backtrace'>bg_error_backtrace</span>]
    <span class='kw'>case</span> <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>when</span> <span class='const'>Integer</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:bg_error_backtrace option value must be true, false, nil or a positive integer: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='kw'>true</span>
      <span class='comment'># OK
</span>    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:bg_error_backtrace option value must be true, false, nil or a positive integer: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_libraries'>libraries</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_wrapping_libraries'>wrapping_libraries</span>]
    <span class='kw'>unless</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_libraries'>libraries</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:wrapping_libraries must be an array of hashes: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_libraries'>libraries</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_libraries'>libraries</span> <span class='op'>=</span> <span class='id identifier rubyid_libraries'>libraries</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_library'>library</span><span class='op'>|</span>
      <span class='const'><a href="Utils.html" title="Mongo::Utils (module)">Utils</a></span>.<span class='id identifier rubyid_shallow_symbolize_keys'>shallow_symbolize_keys</span>(<span class='id identifier rubyid_library'>library</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_libraries'>libraries</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_library'>library</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_library'>library</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:wrapping_libraries element is not a hash: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_library'>library</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_library'>library</span>.<span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:wrapping_libraries element is empty</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>unless</span> (<span class='id identifier rubyid_library'>library</span>.<span class='id identifier rubyid_keys'>keys</span> <span class='op'>-</span> <span class='qsymbols'><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_content'>platform</span><span class='words_sep'> </span><span class='tstring_content'>version</span><span class='tstring_end'>)</span></span>).<span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:wrapping_libraries element has invalid keys (allowed keys: :name, :platform, :version): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_library'>library</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_library'>library</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span>)
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:wrapping_libraries element value cannot include &#39;|&#39;: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_srv_max_hosts'>srv_max_hosts</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_srv_max_hosts'>srv_max_hosts</span>] <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_replica_set'>replica_set</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:srv_max_hosts &gt; 0 cannot be used with :replica_set option</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_load_balanced'>load_balanced</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:srv_max_hosts &gt; 0 cannot be used with :load_balanced=true</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_is_srv'>is_srv</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_is_srv'>is_srv</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_srv_max_hosts'>srv_max_hosts</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:srv_max_hosts cannot be used on non-SRV URI</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_srv_service_name'>srv_service_name</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:srv_service_name cannot be used on non-SRV URI</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_read!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_read!</strong>(option, opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1723-L1741'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1723' data-end='1741'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1723</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_read!'>validate_read!</span>(<span class='id identifier rubyid_option'>option</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_option'>option</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_has_key?'>has_key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>)
    <span class='id identifier rubyid_read'>read</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>]
    <span class='comment'># We could check if read is a Hash, but this would fail
</span>    <span class='comment'># for custom classes implementing key access ([]).
</span>    <span class='comment'># Instead reject common cases of strings and symbols.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_read'>read</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>String</span>) <span class='op'>||</span> <span class='id identifier rubyid_read'>read</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidReadOption.html" title="Mongo::Error::InvalidReadOption (class)">InvalidReadOption</a></span>.<span class='id identifier rubyid_new'><a href="Error/InvalidReadOption.html#new-class_method" title="Mongo::Error::InvalidReadOption.new (method)">new</a></span>(<span class='id identifier rubyid_read'>read</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>the read preference must be specified as a hash: { mode: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_read'>read</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Mongo::Client#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> }</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='id identifier rubyid_read'>read</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_mode'>mode</span>]
      <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='id identifier rubyid_mode'>mode</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>
      <span class='kw'>unless</span> <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="ServerSelector.html" title="Mongo::ServerSelector (module)">ServerSelector</a></span><span class='op'>::</span><span class='const'><a href="ServerSelector.html#PREFERENCES-constant" title="Mongo::ServerSelector::PREFERENCES (constant)">PREFERENCES</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_mode'>mode</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/InvalidReadOption.html" title="Mongo::Error::InvalidReadOption (class)">InvalidReadOption</a></span>.<span class='id identifier rubyid_new'><a href="Error/InvalidReadOption.html#new-class_method" title="Mongo::Error::InvalidReadOption.new (method)">new</a></span>(<span class='id identifier rubyid_read'>read</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not one of recognized modes</span><span class='tstring_end'>&quot;</span></span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_snappy_compression!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_snappy_compression!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1678-L1685'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1678' data-end='1685'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1678</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_snappy_compression!'>validate_snappy_compression!</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='const'>Snappy</span>)
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>snappy</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>rescue</span> <span class='const'>LoadError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/UnmetDependency.html" title="Mongo::Error::UnmetDependency (class)">UnmetDependency</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot enable snappy compression because the snappy gem </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has not been installed. Add \&quot;gem &#39;snappy&#39;\&quot; to your Gemfile and run </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;bundle install\&quot; to install the gem. (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_zstd_compression!-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_zstd_compression!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1687-L1694'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1687' data-end='1694'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1687</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_zstd_compression!'>validate_zstd_compression!</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='const'>Zstd</span>)
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>zstd-ruby</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>rescue</span> <span class='const'>LoadError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Error/UnmetDependency.html" title="Mongo::Error::UnmetDependency (class)">UnmetDependency</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot enable zstd compression because the zstd-ruby gem </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>has not been installed. Add \&quot;gem &#39;zstd-ruby&#39;\&quot; to your Gemfile and run </span><span class='tstring_end'>&quot;</span></span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;bundle install\&quot; to install the gem. (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="watch-instance_method">
  <h3 class='signature '>
    #<strong>watch</strong>(pipeline = [], options = {})  &#x21d2; <code>ChangeStream</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>A change stream only allows ‘majority’ read concern.</p>
</div>
  </div>

  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>This helper method is preferable to running a raw aggregation with a $changeStream stage, for the purpose of supporting resumability.</p>
</div>
  </div>


<p>As of version 3.6 of the MongoDB server, a “$changeStream“ pipeline stage is supported in the aggregation framework. As of version 4.0, this stage allows users to request that notifications are sent for all changes that occur in the client’s cluster.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get change notifications for the client’s cluster.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_watch'>watch</span>([{ <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$match</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> { <span class='label'>operationType:</span> { <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$in</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>insert</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>replace</span><span class='tstring_end'>&#39;</span></span>] } } }])</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>pipeline</span>
    <span class='type'>(<code>Array</code>&lt;<code>Hash</code>&gt;)</span>
    <em class='default'>(defaults to: <tt>[]</tt>)</em>
&mdash;    <div class='inline'>
<p>Optional additional filter operators.</p>
</div>
  </li>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The change stream options.</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:full_document</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>Allowed values: nil, ‘default’, ‘updateLookup’, ‘whenAvailable’, ‘required’.</p>

<p>The default is to not send a value (i.e. nil), which is equivalent to ‘default’. By default, the change notification for partial updates will include a delta describing the changes to the document.</p>

<p>When set to ‘updateLookup’, the change notification for partial updates will include both a delta describing the changes to the document as well as a copy of the entire document that was changed from some time after the change occurred.</p>

<p>When set to ‘whenAvailable’, configures the change stream to return the post-image of the modified document for replace and update change events if the post-image for this event is available.</p>

<p>When set to ‘required’, the same behavior as ‘whenAvailable’ except that an error is raised if the post-image is not available.</p>
</div>        </li>
        <li>
          <span class='name'>:full_document_before_change</span>
          <span class='type'>(<code>String</code>)</span>
            &mdash; <div class='inline'>
<p>Allowed values: nil, ‘whenAvailable’, ‘required’, ‘off’.</p>

<p>The default is to not send a value (i.e. nil), which is equivalent to ‘off’.</p>

<p>When set to ‘whenAvailable’, configures the change stream to return the pre-image of the modified document for replace, update, and delete change events if it is available.</p>

<p>When set to ‘required’, the same behavior as ‘whenAvailable’ except that an error is raised if the pre-image is not available.</p>
</div>        </li>
        <li>
          <span class='name'>:resume_after</span>
          <span class='type'>(<code>BSON::Document</code>, <code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>Specifies the logical starting point for the new change stream.</p>
</div>        </li>
        <li>
          <span class='name'>:max_await_time_ms</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The maximum amount of time for the server to wait on new documents to satisfy a change stream query.</p>
</div>        </li>
        <li>
          <span class='name'>:batch_size</span>
          <span class='type'>(<code>Integer</code>)</span>
            &mdash; <div class='inline'>
<p>The number of documents to return per batch.</p>
</div>        </li>
        <li>
          <span class='name'>:collation</span>
          <span class='type'>(<code>BSON::Document</code>, <code>Hash</code>)</span>
            &mdash; <div class='inline'>
<p>The collation to use.</p>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to use.</p>
</div>        </li>
        <li>
          <span class='name'>:start_at_operation_time</span>
          <span class='type'>(<code>BSON::Timestamp</code>)</span>
            &mdash; <div class='inline'>
<p>Only return changes that occurred at or after the specified timestamp. Any command run against the server will return a cluster time that can be used here. Only recognized by server versions 4.0+.</p>
</div>        </li>
        <li>
          <span class='name'>:comment</span>
          <span class='type'>(<code>Object</code>)</span>
            &mdash; <div class='inline'>
<p>A user-provided comment to attach to this command.</p>
</div>        </li>
        <li>
          <span class='name'>:show_expanded_events</span>
          <span class='type'>(<code>Boolean</code>)</span>
            &mdash; <div class='inline'>
<p>Enables the server to send the ‘expanded’ list of change stream events. The list of additional events included with this flag set are: createIndexes, dropIndexes, modify, create, shardCollection, reshardCollection, refineCollectionShardKey.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>ChangeStream</code>)</span>
&mdash;    <div class='inline'>
<p>The change stream object.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.6.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1112-L1123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1112' data-end='1123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1112</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_watch'>watch</span>(<span class='id identifier rubyid_pipeline'>pipeline</span> <span class='op'>=</span> []<span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {})
  <span class='kw'>return</span> <span class='id identifier rubyid_use'><a href="#use-instance_method" title="Mongo::Client#use (method)">use</a></span>(<span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span>).<span class='id identifier rubyid_watch'>watch</span>(<span class='id identifier rubyid_pipeline'>pipeline</span><span class='comma'>,</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_database'><a href="#database-instance_method" title="Mongo::Client#database (method)">database</a></span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="Database.html#ADMIN-constant" title="Mongo::Database::ADMIN (constant)">ADMIN</a></span>

  <span class='id identifier rubyid_view_options'>view_options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_view_options'>view_options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cursor_type'>cursor_type</span>] <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tailable_await'>tailable_await</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_max_await_time_ms'>max_await_time_ms</span>]

  <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Collection.html" title="Mongo::Collection (class)">Collection</a></span><span class='op'>::</span><span class='const'><a href="Collection/View.html" title="Mongo::Collection::View (class)">View</a></span><span class='op'>::</span><span class='const'><a href="Collection/View/ChangeStream.html" title="Mongo::Collection::View::ChangeStream (class)">ChangeStream</a></span>.<span class='id identifier rubyid_new'><a href="Collection/View/ChangeStream.html#new-class_method" title="Mongo::Collection::View::ChangeStream.new (method)">new</a></span>(
    <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Collection.html" title="Mongo::Collection (class)">Collection</a></span><span class='op'>::</span><span class='const'><a href="Collection/View.html" title="Mongo::Collection::View (class)">View</a></span>.<span class='id identifier rubyid_new'><a href="Collection/View.html#new-class_method" title="Mongo::Collection::View.new (method)">new</a></span>(<span class='kw'>self</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span><span class='op'>::</span><span class='const'><a href="Database.html#COMMAND-constant" title="Mongo::Database::COMMAND (constant)">COMMAND</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>.aggregate</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_view_options'>view_options</span>)<span class='comma'>,</span>
    <span class='id identifier rubyid_pipeline'>pipeline</span><span class='comma'>,</span>
    <span class='const'><a href="../Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Collection.html" title="Mongo::Collection (class)">Collection</a></span><span class='op'>::</span><span class='const'><a href="Collection/View.html" title="Mongo::Collection::View (class)">View</a></span><span class='op'>::</span><span class='const'><a href="Collection/View/ChangeStream.html" title="Mongo::Collection::View::ChangeStream (class)">ChangeStream</a></span><span class='op'>::</span><span class='const'><a href="Collection/View/ChangeStream.html#CLUSTER-constant" title="Mongo::Collection::View::ChangeStream::CLUSTER (constant)">CLUSTER</a></span><span class='comma'>,</span>
    <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with-instance_method">
  <h3 class='signature '>
    #<strong>with</strong>(new_options = nil)  &#x21d2; <code>Client</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Depending on options given, the returned client may share the cluster with the original client or be created with a new cluster. If a new cluster is created, the monitoring event subscribers on the new client are set to the default event subscriber set and none of the subscribers on the original client are copied over.</p>
</div>
  </div>


<p>Creates a new client with the passed options merged over the existing options of this client. Useful for one-offs to change specific options without altering the original client.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get a client with changed options.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_with'>with</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span> <span class='op'>=&gt;</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_mode'>mode</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_primary_preferred'>primary_preferred</span> })</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>new_options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>The new options to use.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Client</code>)</span>
&mdash;    <div class='inline'>
<p>A new client instance.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L784-L794'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='784' data-end='794'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 784</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with'>with</span>(<span class='id identifier rubyid_new_options'>new_options</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_clone'>clone</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_client'>client</span><span class='op'>|</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_update_options'><a href="#update_options-instance_method" title="Mongo::Client#update_options (method)">update_options</a></span>(<span class='id identifier rubyid_new_options'>new_options</span> <span class='op'>||</span> <span class='const'><a href="Options.html" title="Mongo::Options (module)">Options</a></span><span class='op'>::</span><span class='const'><a href="Options/Redacted.html" title="Mongo::Options::Redacted (class)">Redacted</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Mongo::Client.new (method)">new</a></span>)
    <span class='const'><a href="Database.html" title="Mongo::Database (class)">Database</a></span>.<span class='id identifier rubyid_create'><a href="Database.html#create-class_method" title="Mongo::Database.create (method)">create</a></span>(<span class='id identifier rubyid_client'>client</span>)
    <span class='comment'># We can&#39;t use the same cluster if some options that would affect it
</span>    <span class='comment'># have changed.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_cluster_modifying?'><a href="#cluster_modifying%3F-instance_method" title="Mongo::Client#cluster_modifying? (method)">cluster_modifying?</a></span>(<span class='id identifier rubyid_opts'>opts</span>)
      <span class='const'><a href="Cluster.html" title="Mongo::Cluster (class)">Cluster</a></span>.<span class='id identifier rubyid_create'><a href="Cluster.html#create-class_method" title="Mongo::Cluster.create (method)">create</a></span>(<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='label'>monitoring:</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_monitoring'><a href="#monitoring-instance_method" title="Mongo::Client#monitoring (method)">monitoring</a></span>])
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_session-instance_method">
  <h3 class='signature nodoc'>
    #<strong>with_session</strong>(options = {}, &amp;block)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a session to use for operations if possible and yields it to the provided block.</p>

<p>If <code>:session</code> option is set, validates that session and uses it. Otherwise, if deployment supports sessions, creates a new session and uses it. When a new session is created, the session will be implicit (lifecycle is managed by the driver) if the <code>:implicit</code> option is given, otherwise the session will be explicit (lifecycle managed by the application). If deployment does not support session, yields nil to the block.</p>

<p>When the block finishes, if the session was created and was implicit, or if an implicit session was passed in, the session is ended which returns it to the pool of available sessions.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>options</span>
    <span class='type'>(<code>Hash</code>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>a customizable set of options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>options</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:implicit</span>
          <span class='type'>(<code>true</code> | <code>false</code>)</span>
            &mdash; <div class='inline'>
<p>When no session is passed in, whether to create an implicit session.</p>
</div>        </li>
        <li>
          <span class='name'>:session</span>
          <span class='type'>(<a href="Session.html" title="Mongo::Session (class)">Session</a>)</span>
            &mdash; <div class='inline'>
<p>The session to validate and return.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L1168-L1179'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1168' data-end='1179'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 1168</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_session'>with_session</span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='comment'># TODO: Add this back in RUBY-3174.
</span>  <span class='comment'># assert_not_closed
</span>
  <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_get_session'><a href="#get_session-instance_method" title="Mongo::Client#get_session (method)">get_session</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>)

  <span class='kw'>yield</span> <span class='id identifier rubyid_session'>session</span>
<span class='kw'>ensure</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_implicit?'>implicit?</span>
    <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_end_session'>end_session</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_concern-instance_method">
  <h3 class='signature '>
    #<strong>write_concern</strong>  &#x21d2; <a href="WriteConcern.html" title="Mongo::WriteConcern (module)">Mongo::WriteConcern</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the write concern for this client. If no option was provided, then a default single server acknowledgement will be used.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>Get the client write concern.</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_write_concern'>write_concern</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="WriteConcern.html" title="Mongo::WriteConcern (module)">Mongo::WriteConcern</a>)</span>
&mdash;    <div class='inline'>
<p>The write concern.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Since:</p>
<ul class='since'>
  <li>
    <div class='inline'>
<p>2.0.0</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/mongodb/mongo-ruby-driver/blob/master/lib/mongo/client.rb#L873-L875'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='873' data-end='875'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/mongo/client.rb', line 873</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_concern'>write_concern</span>
  <span class='ivar'>@write_concern</span> <span class='op'>||=</span> <span class='const'><a href="WriteConcern.html" title="Mongo::WriteConcern (module)">WriteConcern</a></span>.<span class='id identifier rubyid_get'><a href="WriteConcern.html#get-instance_method" title="Mongo::WriteConcern#get (method)">get</a></span>(<span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write_concern'>write_concern</span>] <span class='op'>||</span> <span class='id identifier rubyid_options'><a href="#options-instance_method" title="Mongo::Client#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>