<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Common Errors &mdash; Mongo master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "common_errors",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Mongo master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Common Errors&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Common Errors</h1>

<div class="contents singlecol" markdown="1" local="" backlinks="none" depth="2"></div>

<h2>No Server is Available Matching Preference</h2>

<p>If you receive the following error:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>&gt;</span> <span class='id identifier rubyid_client'>client</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_contacts'>contacts</span>].<span class='id identifier rubyid_insert_one'>insert_one</span>({ <span class='label'>vpa:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cool@cool</span><span class='tstring_end'>&#39;</span></span>})
<span class='const'><a href="Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Error/NoServerAvailable.html" title="Mongo::Error::NoServerAvailable (class)">NoServerAvailable</a></span><span class='op'>:</span> <span class='const'>No</span> <span class='id identifier rubyid_server'>server</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_available'>available</span> <span class='id identifier rubyid_matching'>matching</span> <span class='label'>preference:</span> <span class='comment'>#&lt;Mongo::ServerSelector::Primary:0x14987080 tag_sets=[] max_staleness=nil&gt; using server_selection_timeout=30 and local_threshold=0.015
</span><span class='id identifier rubyid_from'>from</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>rvm</span><span class='regexp_end'>/gems</span></span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>ruby-2.4.2</span><span class='regexp_end'>/gems</span></span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_server_selector'>server_selector</span><span class='op'>/</span><span class='id identifier rubyid_selectable'>selectable</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>115</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>select_server&#39;
from /rvm/gems/ruby-2.4.2/gems/mongo-2.5.0/lib/mongo/cluster.rb:246:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_next_primary'>next_primary</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
from /rvm/gems/ruby-2.4.2/gems/mongo-2.5.0/lib/mongo/retryable.rb:150:in `legacy_write_with_retry</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_from'>from</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>rvm</span><span class='regexp_end'>/gems</span></span><span class='op'>/</span><span class='id identifier rubyid_ruby'>ruby</span><span class='op'>-</span><span class='float'>2.4</span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_retryable'>retryable</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>103</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>write_with_retry&#39;
from /rvm/gems/ruby-2.4.2/gems/mongo-2.5.0/lib/mongo/collection.rb:422:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_block'>block</span> <span class='kw'>in</span> <span class='id identifier rubyid_insert_one'>insert_one</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
from /rvm/gems/ruby-2.4.2/gems/mongo-2.5.0/lib/mongo/client.rb:485:in `with_session</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_from'>from</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>rvm</span><span class='regexp_end'>/gems</span></span><span class='op'>/</span><span class='id identifier rubyid_ruby'>ruby</span><span class='op'>-</span><span class='float'>2.4</span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_collection'>collection</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>421</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>insert_one&#39;
from (irb):6
from /rvm/rubies/ruby-2.4.2/bin/irb:11:in </span><span class='tstring_end'>`</span></span><span class='op'>&lt;</span><span class='id identifier rubyid_main'>main</span><span class='op'>&gt;</span><span class='tstring'><span class='tstring_beg'>&#39;</span></code></pre>

<p>This error was produced on Ruby Driver version 2.6.x and earlier. This error is
raised when the driver is unable to connect to the server. In order to solve
this, you can try the following:</p>

<ul>
<li>  Update the driver to the most recent 2.x release.</li>
<li>  Ensure that the port number is correct in the URI/connection string, or the
host list.</li>
<li>  If you are connecting to Atlas, ensure that the firewall rules are configured
correctly. See the documentation on <a href="https://www.mongodb.com/docs/atlas/setup-cluster-security/">Cluster Security</a>.</li>
<li>  If your application uses a forking web server, see the documentation on <code>Forking &lt;forking&gt;</code>.</li>
</ul>

<p>See more on this issue here:
<a href="https://jira.mongodb.org/browse/RUBY-1281">RUBY-1281</a>.</p>

<h2><code>OperationFailure</code> When Reading <code>local</code> Database With Auth On</h2>

<p>If you are getting the following error when trying to read the <code>local</code> database:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Error/OperationFailure.html" title="Mongo::Error::OperationFailure (class)">OperationFailure</a></span><span class='op'>:</span> <span class='kw'>not</span> <span class='id identifier rubyid_authorized'>authorized</span> <span class='id identifier rubyid_on'>on</span> <span class='id identifier rubyid_local'>local</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_execute'>execute</span> <span class='id identifier rubyid_command'>command</span> { <span class='id identifier rubyid_find'>find</span><span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oplog.rs</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_filter'>filter</span><span class='op'>:</span> { <span class='label'>ts:</span>
  { <span class='gvar'>$gte</span><span class='op'>:</span> <span class='const'>Timestamp</span> <span class='int'>1497449043000</span><span class='op'>|</span><span class='int'>0</span> } }<span class='comma'>,</span> <span class='id identifier rubyid_sort'>sort</span><span class='op'>:</span> { <span class='gvar'>$natural</span><span class='op'>:</span> <span class='int'>1</span> } } (<span class='int'>13</span>)</code></pre>

<p>You can fix this by adjusting the roles your user has and ensuring that it has
privileges to the local database. If you specifically want to access the oplog,
you can also create a custom role with read access to the local database&#39;s
<code>oplog.rs</code> collection. You can find more information about role management
<a href="https://www.mongodb.com/docs/manual/reference/method/js-role-management/">here</a>.</p>

<p>You can find more information about this issue here:
<a href="https://jira.mongodb.org/browse/MONGOID-4446">MONGOID-4446</a>.</p>

<h2><code>SocketTimeoutError</code> and name resolution errors on EC2</h2>

<p>Some users reported getting the following error:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Exception</span>
<span class='const'><a href="Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Error.html" title="Mongo::Error (class)">Error</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Error/SocketTimeoutError.html" title="Mongo::Error::SocketTimeoutError (class)">SocketTimeoutError</a></span>
<span class='const'>Error</span>
<span class='id identifier rubyid_execution'>execution</span> <span class='id identifier rubyid_expired'>expired</span>
<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>var</span><span class='regexp_end'>/lib</span></span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='float'>2.3</span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>/</span><span class='id identifier rubyid_ssl'>ssl</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>57</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>pack_sockaddr_in&#39;
/var/lib/gems/2.3.0/gems/mongo-2.5.0/lib/mongo/socket/ssl.rb:57:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_block'>block</span> (<span class='int'>2</span> <span class='id identifier rubyid_levels'>levels</span>) <span class='kw'>in</span> <span class='id identifier rubyid_connect!'>connect!</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
/var/lib/gems/2.3.0/gems/mongo-2.5.0/lib/mongo/socket.rb:199:in `handle_errors</span><span class='tstring_end'>&#39;</span></span>
<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>var</span><span class='regexp_end'>/lib</span></span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='float'>2.3</span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>/</span><span class='id identifier rubyid_ssl'>ssl</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>57</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>block in connect!&#39;
/usr/lib/ruby/2.3.0/timeout.rb:101:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_timeout'>timeout</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
/var/lib/gems/2.3.0/gems/mongo-2.5.0/lib/mongo/socket/ssl.rb:56:in `connect!</span><span class='tstring_end'>&#39;</span></span>
<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>var</span><span class='regexp_end'>/lib</span></span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='float'>2.3</span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_address'>address</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>172</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>connect_socket!&#39;
/var/lib/gems/2.3.0/gems/mongo-2.5.0/lib/mongo/server/connection.rb:86:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_connect!'>connect!</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
/var/lib/gems/2.3.0/gems/mongo-2.5.0/lib/mongo/server/connectable.rb:84:in `ensure_connected</span><span class='tstring_end'>&#39;</span></span>
<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>var</span><span class='regexp_end'>/lib</span></span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='float'>2.3</span><span class='op'>/</span><span class='id identifier rubyid_gems'>gems</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>-</span><span class='float'>2.5</span><span class='op'>/</span><span class='id identifier rubyid_lib'>lib</span><span class='op'>/</span><span class='id identifier rubyid_mongo'>mongo</span><span class='op'>/</span><span class='id identifier rubyid_server'>server</span><span class='op'>/</span><span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>256</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>write&#39;</span></code></pre>

<p>This error was last reported on Ruby Driver version 2.5.1, so updating the driver
can potentially solve this issue. A user has reported that they solved this issue
as follows:</p>

<div class="blockquote" markdown="1">

DNS servers on EC2 are generated in /etc/resolv.conf by default. Following
the [answer](https://askubuntu.com/questions/157154/how-do-i-include-lines-in-resolv-conf-that-wont-get-lost-on-reboot?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa)
and setting the nameservers to Google NS I was able to fix this issue.

</div>

<p>You can find more information about this issue here:
<a href="https://jira.mongodb.org/browse/MONGOID-4527">MONGOID-4527</a>.</p>

<h2><a href="Mongo/Auth/Unauthorized.html" title="Mongo::Auth::Unauthorized (class)"><code>::Mongo::Auth::Unauthorized</code></a> User is Not Authorized to Access</h2>

<p>Some users reported getting the following error:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Mongo.html" title="Mongo (module)">Mongo</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Auth.html" title="Mongo::Auth (module)">Auth</a></span><span class='op'>::</span><span class='const'><a href="Mongo/Auth/Unauthorized.html" title="Mongo::Auth::Unauthorized (class)">Unauthorized</a></span><span class='op'>:</span> <span class='const'>User</span> <span class='op'>...</span> <span class='id identifier rubyid_is'>is</span> <span class='kw'>not</span> <span class='id identifier rubyid_authorized'>authorized</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_access'>access</span> <span class='op'>...</span></code></pre>

<p>After upgrading to Ruby Driver version 2.5+, the driver was changed to use
the scram authorization mechanism by default. This error might happen if the
authorization mechanism your user was created with does not match the
authorization mechanism used by the driver. You can specify the preferred
authorization mechanism using the <code>auth_mech</code> option in your <code>mongoid.yml</code>
file.</p>

<p>See more on this issue here:
<a href="https://jira.mongodb.org/browse/RUBY-1684">RUBY-1684</a>.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>