<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::FixtureSet &mdash; Rails-5.0.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::FixtureSet",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.0.0</a> &raquo; 
          <a href='../_index.html'>Index (F)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>FixtureSet</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: ActiveRecord::FixtureSet</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      <ul class='fullTree'>
        <li><a href="../Object.html" title="Object (class)">Object</a></li>
        <li class='next'>ActiveRecord::FixtureSet</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="FixtureSet/ClassCache.html" title="ActiveRecord::FixtureSet::ClassCache (class)">ClassCache</a>,
    <a href="FixtureSet/File.html" title="ActiveRecord::FixtureSet::File (class)">File</a>,
    <a href="FixtureSet/HasManyThroughProxy.html" title="ActiveRecord::FixtureSet::HasManyThroughProxy (class)">HasManyThroughProxy</a>,
    <a href="FixtureSet/ReflectionProxy.html" title="ActiveRecord::FixtureSet::ReflectionProxy (class)">ReflectionProxy</a>,
    <a href="FixtureSet/RenderContext.html" title="ActiveRecord::FixtureSet::RenderContext (class)">RenderContext</a>
    </td>
  </tr>




  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
activerecord/lib/active_record/fixtures.rb<span class='defines'>,<br />activerecord/lib/active_record/fixture_set/file.rb</span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Fixtures are a way of organizing data that you want to test against; in
short, sample data.</p>

<p>They are stored in YAML files, one file per model, which are placed in the
directory appointed by
<code>ActiveSupport::TestCase.fixture_path=(path)</code> (this is
automatically configured for Rails, so you can just put your files in
<code>&lt;your-rails-app&gt;/test/fixtures/</code>). The fixture file ends
with the <code>.yml</code> file extension, for example:
<code>&lt;your-rails-app&gt;/test/fixtures/web_sites.yml</code>).</p>

<p>The format of a fixture file looks like this:</p>

<pre class="code ruby"><code class="ruby">rubyonrails:
  id: 1
  name: Ruby on Rails
  url: http://www.rubyonrails.org

google:
  id: 2
  name: Google
  url: http://www.google.com</code></pre>

<p>This fixture file includes two fixtures. Each YAML fixture (ie. record) is
given a name and is followed by an indented list of key/value pairs in the
“key: value” format. Records are separated by a blank line for your viewing
pleasure.</p>

<p>Note: Fixtures are unordered. If you want ordered fixtures, use the omap
YAML type. See <a
href="http://yaml.org/type/omap.html">yaml.org/type/omap.html</a> for the
specification. You will need ordered fixtures when you have foreign key
constraints on keys in the same table. This is commonly needed for tree
structures. Example:</p>

<pre class="code ruby"><code class="ruby">--- !omap
- parent:
    id:         1
    parent_id:  NULL
    title:      Parent
- child:
    id:         2
    parent_id:  1
    title:      Child</code></pre>

<h2 id="label-Using+Fixtures+in+Test+Cases">Using Fixtures in Test Cases</h2>

<p>Since fixtures are a testing construct, we use them in our unit and
functional tests. There are two ways to use the fixtures, but first
let&#39;s take a look at a sample unit test:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test_helper</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>WebSiteTest</span> <span class='op'>&lt;</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>TestCase</span>
  <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>web_site_count</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>2</span><span class='comma'>,</span> <span class='const'>WebSite</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>By default, <code>test_helper.rb</code> will load all of your fixtures into
your test database, so this test will succeed.</p>

<p>The testing environment will automatically load the all fixtures into the
database before each test. To ensure consistent data, the environment
deletes the fixtures before running the load.</p>

<p>In addition to being available in the database, the fixture&#39;s data may
also be accessed by using a special dynamic method, which has the same name
as the model, and accepts the name of the fixture to instantiate:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>find</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby on Rails</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_web_sites'>web_sites</span><span class='lparen'>(</span><span class='symbol'>:rubyonrails</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</code></pre>

<p>Alternatively, you may enable auto-instantiation of the fixture data. For
instance, take the following tests:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>find_alt_method_1</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby on Rails</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@web_sites</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rubyonrails</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>find_alt_method_2</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ruby on Rails</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@rubyonrails</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span>
</code></pre>

<p>In order to use these methods to access fixtured data within your
testcases, you must specify one of the following in your
ActiveSupport::TestCase-derived class:</p>
<ul><li>
<p>to fully enable instantiated fixtures (enable alternate methods <code>#1</code> and
<code>#2</code> above)</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use_instantiated_fixtures'>use_instantiated_fixtures</span> <span class='op'>=</span> <span class='kw'>true</span>
</code></pre>
</li><li>
<p>create only the hash for the fixtures, do not &#39;find&#39; each instance
(enable alternate method <code>#1</code> only)</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use_instantiated_fixtures'>use_instantiated_fixtures</span> <span class='op'>=</span> <span class='symbol'>:no_instances</span>
</code></pre>
</li></ul>

<p>Using either of these alternate methods incurs a performance hit, as the
fixtured data must be fully traversed in the database to create the fixture
hash and/or instance variables. This is expensive for large sets of
fixtured data.</p>

<h2 id="label-Dynamic+fixtures+with+ERB">Dynamic fixtures with ERB</h2>

<p>Some times you don&#39;t care about the content of the fixtures as much as
you care about the volume. In these cases, you can mix ERB in with your
YAML fixtures to create a bunch of fixtures for load testing, like:</p>

<pre class="code ruby"><code class="ruby">&lt;% 1.upto(1000) do |i| %&gt;
fix_&lt;%= i %&gt;:
  id: &lt;%= i %&gt;
  name: guy_&lt;%= i %&gt;
&lt;% end %&gt;</code></pre>

<p>This will create 1000 very simple fixtures.</p>

<p>Using ERB, you can also inject dynamic values into your fixtures with
inserts like <code>&lt;%= {Date.today}.strftime(&quot;%Y-%m-%d&quot;)
%&gt;</code>. This is however a feature to be used with some caution. The
point of fixtures are that they&#39;re stable units of predictable sample
data. If you feel that you need to inject dynamic values, then perhaps you
should reexamine whether your application is properly testable. Hence,
dynamic values in fixtures are to be considered a code smell.</p>

<p>Helper methods defined in a fixture will not be available in other
fixtures, to prevent against unwanted inter-test dependencies. Methods used
by multiple fixtures should be defined in a module that is included in
<a href="" title="ActiveRecord::FixtureSet (class)">FixtureSet</a>.context_class.</p>
<ul><li>
<p>define a helper method in <code>test_helper.rb</code></p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>FixtureFileHelpers</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_file_sha'>file_sha</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA2</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test/fixtures</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>FixtureSet</span><span class='period'>.</span><span class='id identifier rubyid_context_class'>context_class</span><span class='period'>.</span><span class='id identifier rubyid_include'>include</span> <span class='const'>FixtureFileHelpers</span>
</code></pre>
</li><li>
<p>use the helper method in a fixture</p>

<pre class="code ruby"><code class="ruby">photo:
  name: kitten.png
  sha: &lt;%= file_sha &#39;files/kitten.png&#39; %&gt;</code></pre>
</li></ul>

<h2 id="label-Transactional+Tests">Transactional Tests</h2>

<p>Test cases can use begin+rollback to isolate their changes to the database
instead of having to delete+insert for every test case.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>FooTest</span> <span class='op'>&lt;</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>TestCase</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use_transactional_tests'>use_transactional_tests</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>godzilla</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assert'>assert</span> <span class='op'>!</span><span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_destroy_all'>destroy_all</span>
    <span class='id identifier rubyid_assert'>assert</span> <span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_test'>test</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>godzilla aftermath</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_assert'>assert</span> <span class='op'>!</span><span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>If you preload your test database with all fixture data (probably in the
rake task) and use transactional tests, then you may omit all fixtures
declarations in your test cases since all the data&#39;s already there and
every case rolls back its changes.</p>

<p>In order to use instantiated fixtures with preloaded data, set
<code>self.pre_loaded_fixtures</code> to true. This will provide access to
fixture data for every table that has been loaded through fixtures
(depending on the value of <code>use_instantiated_fixtures</code>).</p>

<p>When <strong>not</strong> to use transactional tests:</p>
<ol><li>
<p>You&#39;re testing whether a transaction works correctly. Nested
transactions don&#39;t commit until all parent transactions commit,
particularly, the fixtures transaction which is begun in setup and rolled
back in teardown. Thus, you won&#39;t be able to verify the results of your
transaction until Active Record supports nested transactions or savepoints
(in progress).</p>
</li><li>
<p>Your database does not support transactions. Every Active Record database
supports transactions except MySQL MyISAM. Use InnoDB, MaxDB, or NDB
instead.</p>
</li></ol>

<h2 id="label-Advanced+Fixtures">Advanced Fixtures</h2>

<p>Fixtures that don&#39;t specify an ID get some extra features:</p>
<ul><li>
<p>Stable, autogenerated IDs</p>
</li><li>
<p>Label references for associations (belongs_to, has_one, has_many)</p>
</li><li>
<p>HABTM associations as inline lists</p>
</li></ul>

<p>There are some more advanced features available even if the id is
specified:</p>
<ul><li>
<p>Autofilled timestamp columns</p>
</li><li>
<p>Fixture label interpolation</p>
</li><li>
<p>Support for YAML defaults</p>
</li></ul>

<h3 id="label-Stable-2C+Autogenerated+IDs">Stable, Autogenerated IDs</h3>

<p>Here, have a monkey fixture:</p>

<pre class="code ruby"><code class="ruby">george:
  id: 1
  name: George the Monkey

reginald:
  id: 2
  name: Reginald the Pirate</code></pre>

<p>Each of these fixtures has two unique identifiers: one for the database and
one for the humans. Why don&#39;t we generate the primary key instead?
Hashing each fixture&#39;s label yields a consistent ID:</p>

<pre class="code ruby"><code class="ruby">george: # generated id: 503576764
  name: George the Monkey

reginald: # generated id: 324201669
  name: Reginald the Pirate</code></pre>

<p>Active Record looks at the fixture&#39;s model class, discovers the correct
primary key, and generates it right before inserting the fixture into the
database.</p>

<p>The generated ID for a given label is constant, so we can discover any
fixture&#39;s ID without loading anything, as long as we know the label.</p>

<h3 id="label-Label+references+for+associations+-28belongs_to-2C+has_one-2C+has_many-29">Label references for associations (belongs_to, has_one, has_many)</h3>

<p>Specifying foreign keys in fixtures can be very fragile, not to mention
difficult to read. Since Active Record can figure out the ID of any fixture
from its label, you can specify FK&#39;s by label instead of ID.</p>

<h4 id="label-belongs_to">belongs_to</h4>

<p>Let&#39;s break out some more monkeys and pirates.</p>

<pre class="code ruby"><code class="ruby">### in pirates.yml

reginald:
  id: 1
  name: Reginald the Pirate
  monkey_id: 1

### in monkeys.yml

george:
  id: 1
  name: George the Monkey
  pirate_id: 1</code></pre>

<p>Add a few more monkeys and pirates and break this into multiple files, and
it gets pretty hard to keep track of what&#39;s going on. Let&#39;s use
labels instead of IDs:</p>

<pre class="code ruby"><code class="ruby">### in pirates.yml

reginald:
  name: Reginald the Pirate
  monkey: george

### in monkeys.yml

george:
  name: George the Monkey
  pirate: reginald</code></pre>

<p>Pow! All is made clear. Active Record reflects on the fixture&#39;s model
class, finds all the <code>belongs_to</code> associations, and allows you
to specify a target <strong>label</strong> for the
<strong>association</strong> (monkey: george) rather than a target
<strong>id</strong> for the <strong>FK</strong> (<code>monkey_id:
1</code>).</p>

<h5 id="label-Polymorphic+belongs_to">Polymorphic belongs_to</h5>

<p>Supporting polymorphic relationships is a little bit more complicated,
since Active Record needs to know what type your association is pointing
at. Something like this should look familiar:</p>

<pre class="code ruby"><code class="ruby">### in fruit.rb

belongs_to :eater, polymorphic: true

### in fruits.yml

apple:
  id: 1
  name: apple
  eater_id: 1
  eater_type: Monkey</code></pre>

<p>Can we do better? You bet!</p>

<pre class="code ruby"><code class="ruby">apple:
  eater: george (Monkey)</code></pre>

<p>Just provide the polymorphic target type and Active Record will take care
of the rest.</p>

<h4 id="label-has_and_belongs_to_many">has_and_belongs_to_many</h4>

<p>Time to give our monkey some fruit.</p>

<pre class="code ruby"><code class="ruby">### in monkeys.yml

george:
  id: 1
  name: George the Monkey

### in fruits.yml

apple:
  id: 1
  name: apple

orange:
  id: 2
  name: orange

grape:
  id: 3
  name: grape

### in fruits_monkeys.yml

apple_george:
  fruit_id: 1
  monkey_id: 1

orange_george:
  fruit_id: 2
  monkey_id: 1

grape_george:
  fruit_id: 3
  monkey_id: 1</code></pre>

<p>Let&#39;s make the HABTM fixture go away.</p>

<pre class="code ruby"><code class="ruby">### in monkeys.yml

george:
  id: 1
  name: George the Monkey
  fruits: apple, orange, grape

### in fruits.yml

apple:
  name: apple

orange:
  name: orange

grape:
  name: grape</code></pre>

<p>Zap! No more fruits_monkeys.yml file. We&#39;ve specified the list of
fruits on George&#39;s fixture, but we could&#39;ve just as easily
specified a list of monkeys on each fruit. As with <code>belongs_to</code>,
Active Record reflects on the fixture&#39;s model class and discovers the
<code>has_and_belongs_to_many</code> associations.</p>

<h3 id="label-Autofilled+Timestamp+Columns">Autofilled Timestamp Columns</h3>

<p>If your table/model specifies any of Active Record&#39;s standard timestamp
columns (<code>created_at</code>, <code>created_on</code>,
<code>updated_at</code>, <code>updated_on</code>), they will automatically
be set to <code>Time.now</code>.</p>

<p>If you&#39;ve set specific values, they&#39;ll be left alone.</p>

<h3 id="label-Fixture+label+interpolation">Fixture label interpolation</h3>

<p>The label of the current fixture is always available as a column value:</p>

<pre class="code ruby"><code class="ruby">geeksomnia:
  name: Geeksomnia&#39;s Account
  subdomain: $LABEL
  email: $LABEL@email.com</code></pre>

<p>Also, sometimes (like when porting older join table fixtures) you&#39;ll
need to be able to get a hold of the identifier for a given label. ERB to
the rescue:</p>

<pre class="code ruby"><code class="ruby">george_reginald:
  monkey_id: &lt;%= ActiveRecord::FixtureSet.identify(:reginald) %&gt;
  pirate_id: &lt;%= ActiveRecord::FixtureSet.identify(:george) %&gt;</code></pre>

<h3 id="label-Support+for+YAML+defaults">Support for YAML defaults</h3>

<p>You can set and reuse defaults in your fixtures YAML file. This is the same
technique used in the <code>database.yml</code> file to specify defaults:</p>

<pre class="code ruby"><code class="ruby">DEFAULTS: &amp;DEFAULTS
  created_on: &lt;%= 3.weeks.ago.to_s(:db) %&gt;

first:
  name: Smurf
  &lt;&lt;: *DEFAULTS

second:
  name: Fraggle
  &lt;&lt;: *DEFAULTS</code></pre>

<p>Any fixture labeled “DEFAULTS” is safely ignored.</p>

<h3 id="label-Configure+the+fixture+model+class">Configure the fixture model class</h3>

<p>It&#39;s possible to set the fixture&#39;s model class directly in the YAML
file. This is helpful when fixtures are loaded outside tests and
<code>set_fixture_class</code> is not available (e.g. when running
<code>rails db:fixtures:load</code>).</p>

<pre class="code ruby"><code class="ruby">_fixture:
  model_class: User
david:
  name: David</code></pre>

<p>Any fixtures labeled “_fixture” are safely ignored.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='all_cached_fixtures-classvariable'>
      @@all_cached_fixtures =
    </dt>
    <dd>
            <pre class='code'><span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbrace'>}</span></pre>
    </dd>
    <dt id='MAX_ID-constant'>
      MAX_ID =
    </dt>
    <dd>
            <pre class='code'><span class='int'>2</span> <span class='op'>**</span> <span class='int'>30</span> <span class='op'>-</span> <span class='int'>1</span></pre>
    </dd>
  </dl>



<h2>Instance Attribute Summary <small><a href='#' class='summary_toggle'>collapse</a></small></h2>

  <ul class="summary">
    <li>
      <span class="summary_signature">
        <a href="#config-instance_method" title="#config (instance method)">#<strong>config</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fixtures-instance_method" title="#fixtures (instance method)">#<strong>fixtures</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#model_class-instance_method" title="#model_class (instance method)">#<strong>model_class</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#table_name-instance_method" title="#table_name (instance method)">#<strong>table_name</strong>  </a>
      </span>
      <span class='note title readonly'>readonly</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>


<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#cache_fixtures-class_method" title=".cache_fixtures (class method)">.<strong>cache_fixtures</strong>(connection, fixtures_map)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#cache_for_connection-class_method" title=".cache_for_connection (class method)">.<strong>cache_for_connection</strong>(connection)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#cached_fixtures-class_method" title=".cached_fixtures (class method)">.<strong>cached_fixtures</strong>(connection, keys_to_fetch = nil)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#context_class-class_method" title=".context_class (class method)">.<strong>context_class</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Superclass for the evaluation contexts used by ERB fixtures.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#create_fixtures-class_method" title=".create_fixtures (class method)">.<strong>create_fixtures</strong>(fixtures_directory, fixture_set_names, class_names = {}, config = ActiveRecord::Base)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#fixture_is_cached%3F-class_method" title=".fixture_is_cached? (class method)">.<strong>fixture_is_cached?</strong>(connection, table_name)  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#identify-class_method" title=".identify (class method)">.<strong>identify</strong>(label, column_type = :integer)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a consistent, platform-independent identifier for
<code>label</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#instantiate_all_loaded_fixtures-class_method" title=".instantiate_all_loaded_fixtures (class method)">.<strong>instantiate_all_loaded_fixtures</strong>(object, load_instances = true)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#instantiate_fixtures-class_method" title=".instantiate_fixtures (class method)">.<strong>instantiate_fixtures</strong>(object, fixture_set, load_instances = true)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(connection, name, class_name, path, config = ActiveRecord::Base)  &#x21d2; FixtureSet </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>a new instance of FixtureSet</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reset_cache-class_method" title=".reset_cache (class method)">.<strong>reset_cache</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D-instance_method" title="#[] (instance method)">#<strong>[]</strong>(x)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D%3D-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(k, v)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>(&amp;block)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#table_rows-instance_method" title="#table_rows (instance method)">#<strong>table_rows</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns a hash of rows to be inserted.</p>
</div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(connection, name, class_name, path, config = ActiveRecord::Base)  &#x21d2; <tt><a href="" title="ActiveRecord::FixtureSet (class)">FixtureSet</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>a new instance of FixtureSet</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


591
592
593
594
595
596
597
598
599
600
601
602
603
604
605</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 591</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_class_name'>class_name</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_config'>config</span> <span class='op'>=</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='rparen'>)</span>
  <span class='ivar'>@name</span>     <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@path</span>     <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span>
  <span class='ivar'>@config</span>   <span class='op'>=</span> <span class='id identifier rubyid_config'>config</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_model_class'>model_class</span> <span class='op'>=</span> <span class='id identifier rubyid_class_name'>class_name</span>

  <span class='ivar'>@fixtures</span> <span class='op'>=</span> <span class='id identifier rubyid_read_fixture_files'>read_fixture_files</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>

  <span class='ivar'>@connection</span>  <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span>

  <span class='ivar'>@table_name</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_model_class'>model_class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:table_name</span><span class='rparen'>)</span> <span class='op'>?</span>
                  <span class='id identifier rubyid_model_class'>model_class</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>:</span>
                  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_default_fixture_table_name'>default_fixture_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_config'>config</span><span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Attribute Details</h2>
  <section class='method_details first' id="config-instance_method">
  <h3 class='signature first'>
  #<strong>config</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


589</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 589</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:table_name</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:fixtures</span><span class='comma'>,</span> <span class='symbol'>:model_class</span><span class='comma'>,</span> <span class='symbol'>:config</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fixtures-instance_method">
  <h3 class='signature'>
  #<strong>fixtures</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


589</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 589</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:table_name</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:fixtures</span><span class='comma'>,</span> <span class='symbol'>:model_class</span><span class='comma'>,</span> <span class='symbol'>:config</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="model_class-instance_method">
  <h3 class='signature'>
  #<strong>model_class</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


589</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 589</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:table_name</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:fixtures</span><span class='comma'>,</span> <span class='symbol'>:model_class</span><span class='comma'>,</span> <span class='symbol'>:config</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="name-instance_method">
  <h3 class='signature'>
  #<strong>name</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


589</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 589</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:table_name</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:fixtures</span><span class='comma'>,</span> <span class='symbol'>:model_class</span><span class='comma'>,</span> <span class='symbol'>:config</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="table_name-instance_method">
  <h3 class='signature'>
  #<strong>table_name</strong>   <span class="extras">(<span class='only'>readonly</span>)</span>
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


589</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 589</span>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:table_name</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:fixtures</span><span class='comma'>,</span> <span class='symbol'>:model_class</span><span class='comma'>,</span> <span class='symbol'>:config</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="cache_fixtures-class_method">
  <h3 class='signature first'>
  .<strong>cache_fixtures</strong>(connection, fixtures_map)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


454
455
456</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 454</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cache_fixtures'>cache_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_fixtures_map'>fixtures_map</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cache_for_connection'>cache_for_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_fixtures_map'>fixtures_map</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="cache_for_connection-class_method">
  <h3 class='signature'>
  .<strong>cache_for_connection</strong>(connection)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


438
439
440</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 438</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cache_for_connection'>cache_for_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
  <span class='cvar'>@@all_cached_fixtures</span><span class='lbracket'>[</span><span class='id identifier rubyid_connection'>connection</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="cached_fixtures-class_method">
  <h3 class='signature'>
  .<strong>cached_fixtures</strong>(connection, keys_to_fetch = nil)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


446
447
448
449
450
451
452</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 446</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_cached_fixtures'>cached_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_keys_to_fetch'>keys_to_fetch</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_keys_to_fetch'>keys_to_fetch</span>
    <span class='id identifier rubyid_cache_for_connection'>cache_for_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_keys_to_fetch'>keys_to_fetch</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cache_for_connection'>cache_for_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="context_class-class_method">
  <h3 class='signature'>
  .<strong>context_class</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Superclass for the evaluation contexts used by ERB fixtures.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


581
582
583</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 581</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_context_class'>context_class</span>
  <span class='ivar'>@context_class</span> <span class='op'>||=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="create_fixtures-class_method">
  <h3 class='signature'>
  .<strong>create_fixtures</strong>(fixtures_directory, fixture_set_names, class_names = {}, config = ActiveRecord::Base)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 511</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_fixtures'>create_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_fixtures_directory'>fixtures_directory</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture_set_names'>fixture_set_names</span><span class='comma'>,</span> <span class='id identifier rubyid_class_names'>class_names</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id identifier rubyid_config'>config</span> <span class='op'>=</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fixture_set_names'>fixture_set_names</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_fixture_set_names'>fixture_set_names</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_class_names'>class_names</span> <span class='op'>=</span> <span class='const'>ClassCache</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_class_names'>class_names</span><span class='comma'>,</span> <span class='id identifier rubyid_config'>config</span>

  <span class='comment'># FIXME: Apparently JK uses this.
</span>  <span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='id identifier rubyid_block_given?'>block_given?</span> <span class='op'>?</span> <span class='kw'>yield</span> <span class='op'>:</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span>

  <span class='id identifier rubyid_files_to_read'>files_to_read</span> <span class='op'>=</span> <span class='id identifier rubyid_fixture_set_names'>fixture_set_names</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_fs_name'>fs_name</span><span class='op'>|</span>
    <span class='id identifier rubyid_fixture_is_cached?'>fixture_is_cached?</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_fs_name'>fs_name</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_files_to_read'>files_to_read</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_disable_referential_integrity'>disable_referential_integrity</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_fixtures_map'>fixtures_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

      <span class='id identifier rubyid_fixture_sets'>fixture_sets</span> <span class='op'>=</span> <span class='id identifier rubyid_files_to_read'>files_to_read</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fs_name'>fs_name</span><span class='op'>|</span>
        <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='id identifier rubyid_class_names'>class_names</span><span class='lbracket'>[</span><span class='id identifier rubyid_fs_name'>fs_name</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_conn'>conn</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span> <span class='op'>?</span> <span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span> <span class='op'>:</span> <span class='id identifier rubyid_connection'>connection</span>
        <span class='id identifier rubyid_fixtures_map'>fixtures_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_fs_name'>fs_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='comment'># ActiveRecord::FixtureSet.new
</span>          <span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span>
          <span class='id identifier rubyid_fs_name'>fs_name</span><span class='comma'>,</span>
          <span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span>
          <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_fixtures_directory'>fixtures_directory</span><span class='comma'>,</span> <span class='id identifier rubyid_fs_name'>fs_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_update_all_loaded_fixtures'>update_all_loaded_fixtures</span> <span class='id identifier rubyid_fixtures_map'>fixtures_map</span>

      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='symbol'>:requires_new</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_deleted_tables'>deleted_tables</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_fixture_sets'>fixture_sets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fs'>fs</span><span class='op'>|</span>
          <span class='id identifier rubyid_conn'>conn</span> <span class='op'>=</span> <span class='id identifier rubyid_fs'>fs</span><span class='period'>.</span><span class='id identifier rubyid_model_class'>model_class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:connection</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_fs'>fs</span><span class='period'>.</span><span class='id identifier rubyid_model_class'>model_class</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span> <span class='op'>:</span> <span class='id identifier rubyid_connection'>connection</span>
          <span class='id identifier rubyid_table_rows'>table_rows</span> <span class='op'>=</span> <span class='id identifier rubyid_fs'>fs</span><span class='period'>.</span><span class='id identifier rubyid_table_rows'>table_rows</span>

          <span class='id identifier rubyid_table_rows'>table_rows</span><span class='period'>.</span><span class='id identifier rubyid_each_key'>each_key</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_table'>table</span><span class='op'>|</span>
            <span class='kw'>unless</span> <span class='id identifier rubyid_deleted_tables'>deleted_tables</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_table'>table</span>
              <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DELETE FROM </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_quote_table_name'>quote_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_table'>table</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Fixture Delete</span><span class='tstring_end'>&#39;</span></span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_deleted_tables'>deleted_tables</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_table'>table</span>
          <span class='kw'>end</span>

          <span class='id identifier rubyid_table_rows'>table_rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fixture_set_name'>fixture_set_name</span><span class='comma'>,</span> <span class='id identifier rubyid_rows'>rows</span><span class='op'>|</span>
            <span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
              <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_insert_fixture'>insert_fixture</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture_set_name'>fixture_set_name</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>

          <span class='comment'># Cap primary key sequences to max(pk).
</span>          <span class='kw'>if</span> <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:reset_pk_sequence!</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_reset_pk_sequence!'>reset_pk_sequence!</span><span class='lparen'>(</span><span class='id identifier rubyid_fs'>fs</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_cache_fixtures'>cache_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_fixtures_map'>fixtures_map</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_cached_fixtures'>cached_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture_set_names'>fixture_set_names</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="fixture_is_cached?-class_method">
  <h3 class='signature'>
  .<strong>fixture_is_cached?</strong>(connection, table_name)  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


442
443
444</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 442</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fixture_is_cached?'>fixture_is_cached?</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name'>table_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cache_for_connection'>cache_for_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="identify-class_method">
  <h3 class='signature'>
  .<strong>identify</strong>(label, column_type = :integer)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a consistent, platform-independent identifier for
<code>label</code>. Integer identifiers are values less than 2^30. UUIDs
are RFC 4122 version 5 SHA-1 hashes.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


572
573
574
575
576
577
578</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 572</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_identify'>identify</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span> <span class='id identifier rubyid_column_type'>column_type</span> <span class='op'>=</span> <span class='symbol'>:integer</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_column_type'>column_type</span> <span class='op'>==</span> <span class='symbol'>:uuid</span>
    <span class='const'>Digest</span><span class='op'>::</span><span class='const'>UUID</span><span class='period'>.</span><span class='id identifier rubyid_uuid_v5'>uuid_v5</span><span class='lparen'>(</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>UUID</span><span class='op'>::</span><span class='const'>OID_NAMESPACE</span><span class='comma'>,</span> <span class='id identifier rubyid_label'>label</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='const'>Zlib</span><span class='period'>.</span><span class='id identifier rubyid_crc32'>crc32</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='const'>MAX_ID</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="instantiate_all_loaded_fixtures-class_method">
  <h3 class='signature'>
  .<strong>instantiate_all_loaded_fixtures</strong>(object, load_instances = true)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


470
471
472
473
474</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 470</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_instantiate_all_loaded_fixtures'>instantiate_all_loaded_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_load_instances'>load_instances</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_all_loaded_fixtures'>all_loaded_fixtures</span><span class='period'>.</span><span class='id identifier rubyid_each_value'>each_value</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fixture_set'>fixture_set</span><span class='op'>|</span>
    <span class='id identifier rubyid_instantiate_fixtures'>instantiate_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture_set'>fixture_set</span><span class='comma'>,</span> <span class='id identifier rubyid_load_instances'>load_instances</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="instantiate_fixtures-class_method">
  <h3 class='signature'>
  .<strong>instantiate_fixtures</strong>(object, fixture_set, load_instances = true)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


458
459
460
461
462
463
464
465
466
467
468</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 458</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_instantiate_fixtures'>instantiate_fixtures</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture_set'>fixture_set</span><span class='comma'>,</span> <span class='id identifier rubyid_load_instances'>load_instances</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_load_instances'>load_instances</span>
    <span class='id identifier rubyid_fixture_set'>fixture_set</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fixture_name'>fixture_name</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture'>fixture</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fixture_name'>fixture_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_fixture'>fixture</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span>
      <span class='kw'>rescue</span> <span class='const'>FixtureClassNotFound</span>
        <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="reset_cache-class_method">
  <h3 class='signature'>
  .<strong>reset_cache</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


434
435
436</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 434</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_reset_cache'>reset_cache</span>
  <span class='cvar'>@@all_cached_fixtures</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="[]-instance_method">
  <h3 class='signature first'>
  #<strong>[]</strong>(x)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


607
608
609</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 607</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fixtures'>fixtures</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="[]=-instance_method">
  <h3 class='signature'>
  #<strong>[]=</strong>(k, v)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


611
612
613</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 611</span>

<span class='kw'>def</span> <span class='op'>[]=</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fixtures'>fixtures</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="each-instance_method">
  <h3 class='signature'>
  #<strong>each</strong>(&amp;block)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


615
616
617</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 615</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fixtures'>fixtures</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="size-instance_method">
  <h3 class='signature'>
  #<strong>size</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


619
620
621</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 619</span>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_fixtures'>fixtures</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="table_rows-instance_method">
  <h3 class='signature'>
  #<strong>table_rows</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns a hash of rows to be inserted. The key is the table, the value is a
list of rows to insert to that table.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/fixtures.rb', line 625</span>

<span class='kw'>def</span> <span class='id identifier rubyid_table_rows'>table_rows</span>
  <span class='id identifier rubyid_now'>now</span> <span class='op'>=</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_default_timezone'>default_timezone</span> <span class='op'>==</span> <span class='symbol'>:utc</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_utc'>utc</span> <span class='op'>:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>

  <span class='comment'># allow a standard key to be used for doing defaults in YAML
</span>  <span class='id identifier rubyid_fixtures'>fixtures</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEFAULTS</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># track any join tables we need to insert later
</span>  <span class='id identifier rubyid_rows'>rows</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span><span class='id identifier rubyid_table'>table</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_table'>table</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_rows'>rows</span><span class='lbracket'>[</span><span class='id identifier rubyid_table_name'>table_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_fixtures'>fixtures</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span> <span class='id identifier rubyid_fixture'>fixture</span><span class='op'>|</span>
    <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='id identifier rubyid_fixture'>fixture</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_model_class'>model_class</span>
      <span class='comment'># fill in timestamp columns if they aren&#39;t specified and the model is set to record_timestamps
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_model_class'>model_class</span><span class='period'>.</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span>
        <span class='id identifier rubyid_timestamp_column_names'>timestamp_column_names</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c_name'>c_name</span><span class='op'>|</span>
          <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_c_name'>c_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_now'>now</span> <span class='kw'>unless</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_c_name'>c_name</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='comment'># interpolate the fixture label
</span>      <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
        <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$LABEL</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_label'>label</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># generate a primary key if necessary
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_has_primary_key_column?'>has_primary_key_column?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_primary_key_name'>primary_key_name</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_primary_key_name'>primary_key_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>FixtureSet</span><span class='period'>.</span><span class='id identifier rubyid_identify'>identify</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span> <span class='id identifier rubyid_primary_key_type'>primary_key_type</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># Resolve enums
</span>      <span class='id identifier rubyid_model_class'>model_class</span><span class='period'>.</span><span class='id identifier rubyid_defined_enums'>defined_enums</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='comment'># If STI is used, find the correct subclass for association reflection
</span>      <span class='id identifier rubyid_reflection_class'>reflection_class</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_inheritance_column_name'>inheritance_column_name</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_inheritance_column_name'>inheritance_column_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_constantize'>constantize</span> <span class='kw'>rescue</span> <span class='id identifier rubyid_model_class'>model_class</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_model_class'>model_class</span>
        <span class='kw'>end</span>

      <span class='id identifier rubyid_reflection_class'>reflection_class</span><span class='period'>.</span><span class='id identifier rubyid__reflections'>_reflections</span><span class='period'>.</span><span class='id identifier rubyid_each_value'>each_value</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_association'>association</span><span class='op'>|</span>
        <span class='kw'>case</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_macro'>macro</span>
        <span class='kw'>when</span> <span class='symbol'>:belongs_to</span>
          <span class='comment'># Do not replace association name with association foreign key if they are named the same
</span>          <span class='id identifier rubyid_fk_name'>fk_name</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:foreign_key</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

          <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>!=</span> <span class='id identifier rubyid_fk_name'>fk_name</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_polymorphic?'>polymorphic?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s*\(([^\)]*)\)\s*$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='comment'># support polymorphic belongs_to as &quot;label (Type)&quot;
</span>              <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_foreign_type'>foreign_type</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='backref'>$1</span>
            <span class='kw'>end</span>

            <span class='id identifier rubyid_fk_type'>fk_type</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection_class'>reflection_class</span><span class='period'>.</span><span class='id identifier rubyid_type_for_attribute'>type_for_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_fk_name'>fk_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
            <span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='id identifier rubyid_fk_name'>fk_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>FixtureSet</span><span class='period'>.</span><span class='id identifier rubyid_identify'>identify</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_fk_type'>fk_type</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>when</span> <span class='symbol'>:has_many</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:through</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_add_join_records'>add_join_records</span><span class='lparen'>(</span><span class='id identifier rubyid_rows'>rows</span><span class='comma'>,</span> <span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='const'>HasManyThroughProxy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_association'>association</span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_row'>row</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_rows'>rows</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.0 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>