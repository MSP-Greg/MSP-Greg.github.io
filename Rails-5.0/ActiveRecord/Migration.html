<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Migration &mdash; Rails-5.0.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Migration",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.0.0</a> &raquo; 
          <a href='../_index.html'>Index (M)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>Migration</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: ActiveRecord::Migration</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      <ul class='fullTree'>
        <li><a href="../Object.html" title="Object (class)">Object</a></li>
        <li class='next'>ActiveRecord::Migration</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <a href="Migration/Compatibility.html" title="ActiveRecord::Migration::Compatibility (module)">Compatibility</a>,
    <a href="Migration/JoinTable.html" title="ActiveRecord::Migration::JoinTable (module)">JoinTable</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Migration/CheckPending.html" title="ActiveRecord::Migration::CheckPending (class)">CheckPending</a>,
    <a href="Migration/CommandRecorder.html" title="ActiveRecord::Migration::CommandRecorder (class)">CommandRecorder</a>,
    <a href="Migration/Current.html" title="ActiveRecord::Migration::Current (class)">Current</a>,
    <a href="Migration/ReversibleBlockHelper.html" title="ActiveRecord::Migration::ReversibleBlockHelper (class)">ReversibleBlockHelper</a>
    </td>
  </tr>


  <tr>
    <td class='box_1'>Direct Subclasses:</td>
    <td>
      <a href="Migration/Current.html" title="ActiveRecord::Migration::Current (class)">Current</a>
    </td>
  </tr>


  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L512'>activerecord/lib/active_record/migration.rb</a><span class='defines'>,<br /><a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/command_recorder.rb#L2'>activerecord/lib/active_record/migration/command_recorder.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/compatibility.rb#L2'>activerecord/lib/active_record/migration/compatibility.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration/join_table.rb#L2'>activerecord/lib/active_record/migration/join_table.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h2 id="label-Active+Record+Migrations">Active Record Migrations</h2>

<p>Migrations can manage the evolution of a schema used by several physical
databases. It&#39;s a solution to the common problem of adding a field to
make a new feature work in your local database, but being unsure of how to
push that change to other developers and to the production server. With
migrations, you can describe the transformations in self-contained classes
that can be checked into version control systems and executed against
another database that might be one, two, or five versions behind.</p>

<p>Example of a simple migration:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddSsl</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:accounts</span><span class='comma'>,</span> <span class='symbol'>:ssl_enabled</span><span class='comma'>,</span> <span class='symbol'>:boolean</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_remove_column'>remove_column</span> <span class='symbol'>:accounts</span><span class='comma'>,</span> <span class='symbol'>:ssl_enabled</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This migration will add a boolean flag to the accounts table and remove it
if you&#39;re backing out of the migration. It shows how all migrations
have two methods <code>up</code> and <code>down</code> that describes the
transformations required to implement or remove the migration. These
methods can consist of both the migration specific methods like
<code>add_column</code> and <code>remove_column</code>, but may also
contain regular Ruby code for generating data needed for the
transformations.</p>

<p>Example of a more complex migration that also needs to initialize data:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddSystemSettings</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:system_settings</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>  <span class='symbol'>:name</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>  <span class='symbol'>:label</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>    <span class='symbol'>:value</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>  <span class='symbol'>:type</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_integer'>integer</span> <span class='symbol'>:position</span>
    <span class='kw'>end</span>

    <span class='const'>SystemSetting</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>  <span class='label'>name:</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>notice</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                          <span class='label'>label:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Use notice?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                          <span class='label'>value:</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_drop_table'>drop_table</span> <span class='symbol'>:system_settings</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This migration first adds the <code>system_settings</code> table, then
creates the very first row in it using the Active Record model that relies
on the table. It also uses the more advanced <code>create_table</code>
syntax where you can specify a complete table schema in one block call.</p>

<h3 id="label-Available+transformations">Available transformations</h3>

<h4 id="label-Creation">Creation</h4>
<ul><li>
<p><code>create_join_table(table_1, table_2, options)</code>: Creates a join
table having its name as the lexical order of the first two arguments. See
ActiveRecord::ConnectionAdapters::SchemaStatements#create_join_table for
details.</p>
</li><li>
<p><code>create_table(name, options)</code>: Creates a table called
<code>name</code> and makes the table object available to a block that can
then add columns to it, following the same format as
<code>add_column</code>. See example above. The options hash is for
fragments like “DEFAULT CHARSET=UTF-8” that are appended to the create
table definition.</p>
</li><li>
<p><code>add_column(table_name, column_name, type, options)</code>: Adds a new
column to the table called <code>table_name</code> named
<code>column_name</code> specified to be one of the following types:
<code>:string</code>, <code>:text</code>, <code>:integer</code>,
<code>:float</code>, <code>:decimal</code>, <code>:datetime</code>,
<code>:timestamp</code>, <code>:time</code>, <code>:date</code>,
<code>:binary</code>, <code>:boolean</code>. A default value can be
specified by passing an <code>options</code> hash like <code>{ default: 11
}</code>. Other options include <code>:limit</code> and <code>:null</code>
(e.g. <code>{ limit: 50, null: false }</code>) – see
ActiveRecord::ConnectionAdapters::TableDefinition#column for details.</p>
</li><li>
<p><code>add_foreign_key(from_table, to_table, options)</code>: Adds a new
foreign key. <code>from_table</code> is the table with the key column,
<code>to_table</code> contains the referenced primary key.</p>
</li><li>
<p><code>add_index(table_name, column_names, options)</code>: Adds a new index
with the name of the column. Other options include <code>:name</code>,
<code>:unique</code> (e.g. <code>{ name: &#39;users_name_index&#39;,
unique: true }</code>) and <code>:order</code> (e.g. <code>{ order: { name:
:desc } }</code>).</p>
</li><li>
<p><code>add_reference(:table_name, :reference_name)</code>: Adds a new column
<code>reference_name_id</code> by default an integer. See
ActiveRecord::ConnectionAdapters::SchemaStatements#add_reference for
details.</p>
</li><li>
<p><code>add_timestamps(table_name, options)</code>: Adds timestamps
(<code>created_at</code> and <code>updated_at</code>) columns to
<code>table_name</code>.</p>
</li></ul>

<h4 id="label-Modification">Modification</h4>
<ul><li>
<p><code>change_column(table_name, column_name, type, options)</code>: 
Changes the column to a different type using the same parameters as
add_column.</p>
</li><li>
<p><code>change_column_default(table_name, column_name, default)</code>: Sets
a default value for <code>column_name</code> defined by
<code>default</code> on <code>table_name</code>.</p>
</li><li>
<p><code>change_column_null(table_name, column_name, null, default =
nil)</code>: Sets or removes a <tt>NOT NULL</tt> constraint on
<code>column_name</code>. The <code>null</code> flag indicates whether the
value can be <code>NULL</code>. See
ActiveRecord::ConnectionAdapters::SchemaStatements#change_column_null for
details.</p>
</li><li>
<p><code>change_table(name, options)</code>: Allows to make column alterations
to the table called <code>name</code>. It makes the table object available
to a block that can then add/remove columns, indexes or foreign keys to it.</p>
</li><li>
<p><code>rename_column(table_name, column_name, new_column_name)</code>:
Renames a column but keeps the type and content.</p>
</li><li>
<p><code>rename_index(table_name, old_name, new_name)</code>: Renames an
index.</p>
</li><li>
<p><code>rename_table(old_name, new_name)</code>: Renames the table called
<code>old_name</code> to <code>new_name</code>.</p>
</li></ul>

<h4 id="label-Deletion">Deletion</h4>
<ul><li>
<p><code>drop_table(name)</code>: Drops the table called <code>name</code>.</p>
</li><li>
<p><code>drop_join_table(table_1, table_2, options)</code>: Drops the join
table specified by the given arguments.</p>
</li><li>
<p><code>remove_column(table_name, column_name, type, options)</code>: Removes
the column named <code>column_name</code> from the table called
<code>table_name</code>.</p>
</li><li>
<p><code>remove_columns(table_name, *column_names)</code>: Removes the given
columns from the table definition.</p>
</li><li>
<p><code>remove_foreign_key(from_table, options_or_to_table)</code>: Removes
the given foreign key from the table called <code>table_name</code>.</p>
</li><li>
<p><code>remove_index(table_name, column: column_names)</code>: Removes the
index specified by <code>column_names</code>.</p>
</li><li>
<p><code>remove_index(table_name, name: index_name)</code>: Removes the index
specified by <code>index_name</code>.</p>
</li><li>
<p><code>remove_reference(table_name, ref_name, options)</code>: Removes the
reference(s) on <code>table_name</code> specified by <code>ref_name</code>.</p>
</li><li>
<p><code>remove_timestamps(table_name, options)</code>: Removes the timestamp
columns (<code>created_at</code> and <code>updated_at</code>) from the
table definition.</p>
</li></ul>

<h3 id="label-Irreversible+transformations">Irreversible transformations</h3>

<p>Some transformations are destructive in a manner that cannot be reversed.
Migrations of that kind should raise an
<code>ActiveRecord::IrreversibleMigration</code> exception in their
<code>down</code> method.</p>

<h3 id="label-Running+migrations+from+within+Rails">Running migrations from within Rails</h3>

<p>The Rails package has several tools to help create and apply migrations.</p>

<p>To generate a new migration, you can use</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='id identifier rubyid_migration'>migration</span> <span class='const'>MyNewMigration</span>
</code></pre>

<p>where MyNewMigration is the name of your migration. The generator will
create an empty migration file <code>timestamp_my_new_migration.rb</code>
in the <code>db/migrate/</code> directory where <code>timestamp</code> is
the UTC formatted date and time that the migration was generated.</p>

<p>There is a special syntactic shortcut to generate migrations that add
fields to a table.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rails'>rails</span> <span class='id identifier rubyid_generate'>generate</span> <span class='id identifier rubyid_migration'>migration</span> <span class='id identifier rubyid_add_fieldname_to_tablename'>add_fieldname_to_tablename</span> <span class='label'>fieldname:</span><span class='id identifier rubyid_string'>string</span>
</code></pre>

<p>This will generate the file
<code>timestamp_add_fieldname_to_tablename.rb</code>, which will look like
this:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddFieldnameToTablename</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:tablenames</span><span class='comma'>,</span> <span class='symbol'>:fieldname</span><span class='comma'>,</span> <span class='symbol'>:string</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>To run migrations against the currently configured database, use
<code>rails db:migrate</code>. This will update the database by running all
of the pending migrations, creating the <code>schema_migrations</code>
table (see “About the schema_migrations table” section below) if missing.
It will also invoke the db:schema:dump task, which will update your
db/schema.rb file to match the structure of your database.</p>

<p>To roll the database back to a previous migration version, use <code>rails
db:migrate VERSION=X</code> where <code>X</code> is the version to which
you wish to downgrade. Alternatively, you can also use the STEP option if
you wish to rollback last few migrations. <code>rails db:migrate
STEP=2</code> will rollback the latest two migrations.</p>

<p>If any of the migrations throw an
<code>ActiveRecord::IrreversibleMigration</code> exception, that step will
fail and you&#39;ll have some manual work to do.</p>

<h3 id="label-Database+support">Database support</h3>

<p>Migrations are currently supported in MySQL, PostgreSQL, SQLite, SQL
Server, and Oracle (all supported databases except DB2).</p>

<h3 id="label-More+examples">More examples</h3>

<p>Not all migrations change the schema. Some just fix the data:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>RemoveEmptyTags</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='const'>Tag</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_tag'>tag</span><span class='op'>|</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span> <span class='kw'>if</span> <span class='id identifier rubyid_tag'>tag</span><span class='period'>.</span><span class='id identifier rubyid_pages'>pages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='comment'># not much we can do to restore deleted data
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="IrreversibleMigration.html" title="ActiveRecord::IrreversibleMigration (class)">IrreversibleMigration</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t recover the deleted tags</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Others remove columns when they migrate up instead of down:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>RemoveUnnecessaryItemAttributes</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_remove_column'>remove_column</span> <span class='symbol'>:items</span><span class='comma'>,</span> <span class='symbol'>:incomplete_items_count</span>
    <span class='id identifier rubyid_remove_column'>remove_column</span> <span class='symbol'>:items</span><span class='comma'>,</span> <span class='symbol'>:completed_items_count</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:items</span><span class='comma'>,</span> <span class='symbol'>:incomplete_items_count</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:items</span><span class='comma'>,</span> <span class='symbol'>:completed_items_count</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>And sometimes you need to do something in SQL not abstracted directly by
migrations:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MakeJoinUnique</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ALTER TABLE `pages_linked_pages` ADD UNIQUE `page_id_linked_page_id` (`page_id`,`linked_page_id`)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ALTER TABLE `pages_linked_pages` DROP INDEX `page_id_linked_page_id`</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="label-Using+a+model+after+changing+its+table">Using a model after changing its table</h3>

<p>Sometimes you&#39;ll want to add a column in a migration and populate it
immediately after. In that case, you&#39;ll need to make a call to
<code>Base#reset_column_information</code> in order to ensure that the
model has the latest column data from after the new column was added.
Example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AddPeopleSalary</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:people</span><span class='comma'>,</span> <span class='symbol'>:salary</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
    <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_reset_column_information'>reset_column_information</span>
    <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
      <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span> <span class='symbol'>:salary</span><span class='comma'>,</span> <span class='const'>SalaryCalculator</span><span class='period'>.</span><span class='id identifier rubyid_compute'>compute</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="label-Controlling+verbosity">Controlling verbosity</h3>

<p>By default, migrations will describe the actions they are taking, writing
them to the console as they happen, along with benchmarks describing how
long each step took.</p>

<p>You can quiet them down by setting <a href="" title="ActiveRecord::Migration (class)">Migration</a>.verbose =
false.</p>

<p>You can also insert your own messages and benchmarks by using the
<code>say_with_time</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
  <span class='comment'>#...
</span>  <span class='id identifier rubyid_say_with_time'>say_with_time</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Updating salaries...</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
      <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_update_attribute'>update_attribute</span> <span class='symbol'>:salary</span><span class='comma'>,</span> <span class='const'>SalaryCalculator</span><span class='period'>.</span><span class='id identifier rubyid_compute'>compute</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'>#...
</span><span class='kw'>end</span></code></pre>

<p>The phrase “Updating salaries…” would then be printed, along with the
benchmark for the block when the block completes.</p>

<h3 id="label-Timestamped+Migrations">Timestamped Migrations</h3>

<p>By default, Rails generates migrations that look like:</p>

<pre class="code ruby"><code class="ruby">20080717013526_your_migration_name.rb</code></pre>

<p>The prefix is a generation timestamp (in UTC).</p>

<p>If you&#39;d prefer to use numeric prefixes, you can turn timestamped
migrations off by setting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_timestamped_migrations'>timestamped_migrations</span> <span class='op'>=</span> <span class='kw'>false</span>
</code></pre>

<p>In application.rb.</p>

<h3 id="label-Reversible+Migrations">Reversible Migrations</h3>

<p>Reversible migrations are migrations that know how to go <code>down</code>
for you. You simply supply the <code>up</code> logic, and the Migration
system figures out how to execute the down commands for you.</p>

<p>To define a reversible migration, define the <code>change</code> method in
your migration like this:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>TenderloveMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbol'>:horses</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:content</span><span class='comma'>,</span> <span class='symbol'>:text</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:remind_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This migration will create the horses table for you on the way up, and
automatically figure out how to drop the table on the way down.</p>

<p>Some commands like <code>remove_column</code> cannot be reversed.  If you
care to define how to move up and down in these cases, you should define
the <code>up</code> and <code>down</code> methods as before.</p>

<p>If a command cannot be reversed, an
<code>ActiveRecord::IrreversibleMigration</code> exception will be raised
when the migration is moving down.</p>

<p>For a list of commands that are reversible, please see
<code>ActiveRecord::Migration::CommandRecorder</code>.</p>

<h3 id="label-Transactional+Migrations">Transactional Migrations</h3>

<p>If the database adapter supports DDL transactions, all migrations will
automatically be wrapped in a transaction. There are queries that you
can&#39;t execute inside a transaction though, and for these situations you
can turn the automatic transactions off.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ChangeEnum</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'>Migration</span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_disable_ddl_transaction!'>disable_ddl_transaction!</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ALTER TYPE model_size ADD VALUE &#39;new_value&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Remember that you can still open your own transactions, even if you are in
a Migration with <code>self.disable_ddl_transaction!</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='MigrationFilenameRegexp-constant'>
      MigrationFilenameRegexp =
    </dt>
    <dd>
            <pre class='code'><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A([0-9]+)_([_a-z0-9]*)\.?([_a-z0-9]*)?\.rb\z</span><span class='regexp_end'>/</span></span></pre>
    </dd>
  </dl>



<h2>Instance Attribute Summary <small><a href='#' class='summary_toggle'>collapse</a></small></h2>

  <ul class="summary">
    <li>
      <span class="summary_signature">
        <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#version-instance_method" title="#version (instance method)">#<strong>version</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>


<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#%5B%5D-class_method" title=".[] (class method)">.<strong>[]</strong>(version)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#check_pending%21-class_method" title=".check_pending! (class method)">.<strong>check_pending!</strong>(connection = Base.connection)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Raises <code>ActiveRecord::PendingMigrationError</code> error if any
migrations are pending.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#current_version-class_method" title=".current_version (class method)">.<strong>current_version</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#disable_ddl_transaction%21-class_method" title=".disable_ddl_transaction! (class method)">.<strong>disable_ddl_transaction!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Disable the transaction wrapping this migration.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#load_schema_if_pending%21-class_method" title=".load_schema_if_pending! (class method)">.<strong>load_schema_if_pending!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#migrate-class_method" title=".migrate (class method)">.<strong>migrate</strong>(direction)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(name = self.class.name, version = nil)  &#x21d2; Migration </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>a new instance of Migration</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#announce-instance_method" title="#announce (instance method)">#<strong>announce</strong>(message)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#connection-instance_method" title="#connection (instance method)">#<strong>connection</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#copy-instance_method" title="#copy (instance method)">#<strong>copy</strong>(destination, sources, options = {})  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#down-instance_method" title="#down (instance method)">#<strong>down</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#exec_migration-instance_method" title="#exec_migration (instance method)">#<strong>exec_migration</strong>(conn, direction)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#method_missing-instance_method" title="#method_missing (instance method)">#<strong>method_missing</strong>(method, *arguments, &amp;block)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#migrate-instance_method" title="#migrate (instance method)">#<strong>migrate</strong>(direction)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Execute this migration in the named direction</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#next_migration_number-instance_method" title="#next_migration_number (instance method)">#<strong>next_migration_number</strong>(number)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Determines the version number of the next migration.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#proper_table_name-instance_method" title="#proper_table_name (instance method)">#<strong>proper_table_name</strong>(name, options = {})  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Finds the correct table name given an Active Record object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reversible-instance_method" title="#reversible (instance method)">#<strong>reversible</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Used to specify an operation that can be run in one direction or another.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#revert-instance_method" title="#revert (instance method)">#<strong>revert</strong>(*migration_classes)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Reverses the migration commands for the given block and the given
migrations.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reverting%3F-instance_method" title="#reverting? (instance method)">#<strong>reverting?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>(*migration_classes)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Runs the given migration classes.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#say-instance_method" title="#say (instance method)">#<strong>say</strong>(message, subitem = false)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#say_with_time-instance_method" title="#say_with_time (instance method)">#<strong>say_with_time</strong>(message)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#suppress_messages-instance_method" title="#suppress_messages (instance method)">#<strong>suppress_messages</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#table_name_options-instance_method" title="#table_name_options (instance method)">#<strong>table_name_options</strong>(config = ActiveRecord::Base)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Builds a hash for use in <a href="#proper_table_name-instance_method" title="ActiveRecord::Migration#proper_table_name (method)">#proper_table_name</a> using
the Active Record object&#39;s table_name prefix and suffix</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#up-instance_method" title="#up (instance method)">#<strong>up</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#write-instance_method" title="#write (instance method)">#<strong>write</strong>(text = &quot;&quot;)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(name = self.class.name, version = nil)  &#x21d2; <tt><a href="" title="ActiveRecord::Migration (class)">Migration</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>a new instance of Migration</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L620'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


620
621
622
623
624</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 620</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@name</span>       <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@version</span>    <span class='op'>=</span> <span class='id identifier rubyid_version'>version</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 id='method_missing_details' class='y_details'>Dynamic Method Handling</h2>
  <p class='notice this'>
    This class handles dynamic methods through the <tt>method_missing</tt> method
  </p>
<section class='method_details first' id="method_missing-instance_method">
  <h3 class='signature first'>
  #<strong>method_missing</strong>(method, *arguments, &amp;block)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L832'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 832</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_arguments'>arguments</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_arg_list'>arg_list</span> <span class='op'>=</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:inspect</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_say_with_time'>say_with_time</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg_list'>arg_list</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:revert</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='symbol'>:execute</span><span class='comma'>,</span> <span class='symbol'>:enable_extension</span><span class='comma'>,</span> <span class='symbol'>:disable_extension</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_arguments'>arguments</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_proper_table_name'>proper_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name_options'>table_name_options</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='lbracket'>[</span><span class='symbol'>:rename_table</span><span class='comma'>,</span> <span class='symbol'>:add_foreign_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span> <span class='op'>||</span>
          <span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span> <span class='op'>==</span> <span class='symbol'>:remove_foreign_key</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_second'>second</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_arguments'>arguments</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_proper_table_name'>proper_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_second'>second</span><span class='comma'>,</span> <span class='id identifier rubyid_table_name_options'>table_name_options</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_arguments'>arguments</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
  <section class='method_details first' id="name-instance_method">
  <h3 class='signature first'>
  #<strong>name</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L618'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


618</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 618</span>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:version</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="version-instance_method">
  <h3 class='signature'>
  #<strong>version</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L618'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


618</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 618</span>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:version</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="[]-class_method">
  <h3 class='signature first'>
  .<strong>[]</strong>(version)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L527'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


527
528
529</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 527</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span>
  <span class='const'><a href="Migration/Compatibility.html" title="ActiveRecord::Migration::Compatibility (module)">Compatibility</a></span><span class='period'>.</span><span class='id identifier rubyid_find'><a href="Migration/Compatibility.html#find-class_method" title="ActiveRecord::Migration::Compatibility.find (method)">find</a></span><span class='lparen'>(</span><span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="check_pending!-class_method">
  <h3 class='signature'>
  .<strong>check_pending!</strong>(connection = Base.connection)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Raises <code>ActiveRecord::PendingMigrationError</code> error if any
migrations are pending.</p>


  </div>
</div>
<div class="tags">
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<tt><a href="PendingMigrationError.html" title="ActiveRecord::PendingMigrationError (class)">ActiveRecord::PendingMigrationError</a></tt>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L572'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


572
573
574</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 572</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_pending!'>check_pending!</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection'><a href="ConnectionHandling.html#connection-instance_method" title="ActiveRecord::ConnectionHandling#connection (method)">connection</a></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="PendingMigrationError.html" title="ActiveRecord::PendingMigrationError (class)">PendingMigrationError</a></span> <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_needs_migration?'><a href="Migrator.html#needs_migration%3F-class_method" title="ActiveRecord::Migrator.needs_migration? (method)">needs_migration?</a></span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="current_version-class_method">
  <h3 class='signature'>
  .<strong>current_version</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L531'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


531
532
533</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 531</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_current_version'>current_version</span>
  <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="VERSION.html" title="ActiveRecord::VERSION (module)">VERSION</a></span><span class='op'>::</span><span class='const'><a href="VERSION.html#STRING-constant" title="ActiveRecord::VERSION::STRING (constant)">STRING</a></span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="disable_ddl_transaction!-class_method">
  <h3 class='signature'>
  .<strong>disable_ddl_transaction!</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Disable the transaction wrapping this migration. You can still create your
own transactions even after calling <code>#disable_ddl_transaction!</code></p>

<p>For more details read the <a href="rdoc-ref:Migration">“Transactional
Migrations” section above</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L608'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


608
609
610</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 608</span>

<span class='kw'>def</span> <span class='id identifier rubyid_disable_ddl_transaction!'>disable_ddl_transaction!</span>
  <span class='ivar'>@disable_ddl_transaction</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="load_schema_if_pending!-class_method">
  <h3 class='signature'>
  .<strong>load_schema_if_pending!</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L576'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


576
577
578
579
580
581
582
583
584
585
586
587
588</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 576</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_schema_if_pending!'>load_schema_if_pending!</span>
  <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_needs_migration?'><a href="Migrator.html#needs_migration%3F-class_method" title="ActiveRecord::Migrator.needs_migration? (method)">needs_migration?</a></span> <span class='op'>||</span> <span class='op'>!</span><span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_any_migrations?'><a href="Migrator.html#any_migrations%3F-class_method" title="ActiveRecord::Migrator.any_migrations? (method)">any_migrations?</a></span>
    <span class='comment'># Roundtrip to Rake to allow plugins to hook into database initialization.
</span>    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_cd'>cd</span> <span class='const'><a href="../Rails.html" title="Rails (module)">Rails</a></span><span class='period'>.</span><span class='id identifier rubyid_root'><a href="../Rails.html#root-class_method" title="Rails.root (method)">root</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_current_config'>current_config</span> <span class='op'>=</span> <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection_config'><a href="ConnectionHandling.html#connection_config-instance_method" title="ActiveRecord::ConnectionHandling#connection_config (method)">connection_config</a></span>
      <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_clear_all_connections!'>clear_all_connections!</span>
      <span class='id identifier rubyid_system'>system</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bin/rails db:test:prepare</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='comment'># Establish a new connection, the old database may be gone (db:test:prepare uses purge)
</span>      <span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_establish_connection'><a href="ConnectionHandling.html#establish_connection-instance_method" title="ActiveRecord::ConnectionHandling#establish_connection (method)">establish_connection</a></span><span class='lparen'>(</span><span class='id identifier rubyid_current_config'>current_config</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_check_pending!'>check_pending!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="migrate-class_method">
  <h3 class='signature'>
  .<strong>migrate</strong>(direction)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L600'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


600
601
602</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 600</span>

<span class='kw'>def</span> <span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span> <span class='id identifier rubyid_direction'>direction</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="announce-instance_method">
  <h3 class='signature first'>
  #<strong>announce</strong>(message)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L802'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


802
803
804
805
806</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 802</span>

<span class='kw'>def</span> <span class='id identifier rubyid_announce'>announce</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>75</span> <span class='op'>-</span> <span class='id identifier rubyid_text'>text</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
  <span class='id identifier rubyid_write'>write</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>== %s %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="connection-instance_method">
  <h3 class='signature'>
  #<strong>connection</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L828'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


828
829
830</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 828</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connection'>connection</span>
  <span class='ivar'>@connection</span> <span class='op'>||</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection'><a href="ConnectionHandling.html#connection-instance_method" title="ActiveRecord::ConnectionHandling#connection (method)">connection</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="copy-instance_method">
  <h3 class='signature'>
  #<strong>copy</strong>(destination, sources, options = {})  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L850'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 850</span>

<span class='kw'>def</span> <span class='id identifier rubyid_copy'>copy</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='id identifier rubyid_sources'>sources</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_copied'>copied</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir_p'>mkdir_p</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_destination_migrations'>destination_migrations</span> <span class='op'>=</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_migrations'><a href="Migrator.html#migrations-class_method" title="ActiveRecord::Migrator.migrations (method)">migrations</a></span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='id identifier rubyid_destination_migrations'>destination_migrations</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
  <span class='id identifier rubyid_sources'>sources</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='id identifier rubyid_source_migrations'>source_migrations</span> <span class='op'>=</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Migrator.html" title="ActiveRecord::Migrator (class)">Migrator</a></span><span class='period'>.</span><span class='id identifier rubyid_migrations'><a href="Migrator.html#migrations-class_method" title="ActiveRecord::Migrator.migrations (method)">migrations</a></span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_source_migrations'>source_migrations</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_migration'>migration</span><span class='op'>|</span>
      <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_binread'>binread</span><span class='lparen'>(</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_inserted_comment'>inserted_comment</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'># This migration comes from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'>scope</span><span class='embexpr_end'>}</span><span class='tstring_content'> (originally </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A#.*\b(?:en)?coding:\s*\S+</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_source'>source</span>
        <span class='comment'># If we have a magic comment in the original migration,
</span>        <span class='comment'># insert our comment after the first newline(end of the magic comment line)
</span>        <span class='comment'># so the magic keep working.
</span>        <span class='comment'># Note that magic comments must be at the first line(except sh-bang).
</span>        <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\n</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_inserted_comment'>inserted_comment</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_inserted_comment'>inserted_comment</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_source'>source</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_duplicate'>duplicate</span> <span class='op'>=</span> <span class='id identifier rubyid_destination_migrations'>destination_migrations</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:on_skip</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_duplicate'>duplicate</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span> <span class='op'>!=</span> <span class='id identifier rubyid_scope'>scope</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
          <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:on_skip</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_migration'>migration</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_next_migration_number'>next_migration_number</span><span class='lparen'>(</span><span class='id identifier rubyid_last'>last</span> <span class='op'>?</span> <span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_new_path'>new_path</span> <span class='op'>=</span> <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_destination'>destination</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span><span class='embexpr_end'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_underscore'>underscore</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_scope'>scope</span><span class='embexpr_end'>}</span><span class='tstring_content'>.rb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_old_path'>old_path</span><span class='comma'>,</span> <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_new_path'>new_path</span>
      <span class='id identifier rubyid_last'>last</span> <span class='op'>=</span> <span class='id identifier rubyid_migration'>migration</span>

      <span class='const'><a href="../File.html" title="File (class)">File</a></span><span class='period'>.</span><span class='id identifier rubyid_binwrite'>binwrite</span><span class='lparen'>(</span><span class='id identifier rubyid_migration'>migration</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_copied'>copied</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_migration'>migration</span>
      <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:on_copy</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_migration'>migration</span><span class='comma'>,</span> <span class='id identifier rubyid_old_path'>old_path</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:on_copy</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_destination_migrations'>destination_migrations</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_migration'>migration</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_copied'>copied</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="down-instance_method">
  <h3 class='signature'>
  #<strong>down</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L755'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


755
756
757
758
759</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 755</span>

<span class='kw'>def</span> <span class='id identifier rubyid_down'>down</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_delegate'>delegate</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:down</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_down'>down</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="exec_migration-instance_method">
  <h3 class='signature'>
  #<strong>exec_migration</strong>(conn, direction)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L783'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


783
784
785
786
787
788
789
790
791
792
793
794
795
796</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 783</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exec_migration'>exec_migration</span><span class='lparen'>(</span><span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_conn'>conn</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:change</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>==</span> <span class='symbol'>:down</span>
      <span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_change'>change</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_change'>change</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="migrate-instance_method">
  <h3 class='signature'>
  #<strong>migrate</strong>(direction)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Execute this migration in the named direction</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L762'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 762</span>

<span class='kw'>def</span> <span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_direction'>direction</span>
  <span class='kw'>when</span> <span class='symbol'>:up</span>   <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrating</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='symbol'>:down</span> <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reverting</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_time'>time</span>   <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_connection_pool'><a href="ConnectionHandling.html#connection_pool-instance_method" title="ActiveRecord::ConnectionHandling#connection_pool (method)">connection_pool</a></span><span class='period'>.</span><span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='op'>|</span>
    <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="../Benchmark.html" title="Benchmark (class)">Benchmark</a></span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_exec_migration'>exec_migration</span><span class='lparen'>(</span><span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_direction'>direction</span>
  <span class='kw'>when</span> <span class='symbol'>:up</span>   <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>migrated (%.4fs)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='semicolon'>;</span> <span class='id identifier rubyid_write'>write</span>
  <span class='kw'>when</span> <span class='symbol'>:down</span> <span class='kw'>then</span> <span class='id identifier rubyid_announce'>announce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reverted (%.4fs)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='semicolon'>;</span> <span class='id identifier rubyid_write'>write</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="next_migration_number-instance_method">
  <h3 class='signature'>
  #<strong>next_migration_number</strong>(number)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Determines the version number of the next migration.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L907'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


907
908
909
910
911
912
913</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 907</span>

<span class='kw'>def</span> <span class='id identifier rubyid_next_migration_number'>next_migration_number</span><span class='lparen'>(</span><span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_timestamped_migrations'>timestamped_migrations</span>
    <span class='lbracket'>[</span><span class='const'><a href="../Time.html" title="Time (class)">Time</a></span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_utc'>utc</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Y%m%d%H%M%S</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.14d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_number'>number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
  <span class='kw'>else</span>
    <span class='const'><a href="SchemaMigration.html" title="ActiveRecord::SchemaMigration (class)">SchemaMigration</a></span><span class='period'>.</span><span class='id identifier rubyid_normalize_migration_number'><a href="SchemaMigration.html#normalize_migration_number-class_method" title="ActiveRecord::SchemaMigration.normalize_migration_number (method)">normalize_migration_number</a></span><span class='lparen'>(</span><span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="proper_table_name-instance_method">
  <h3 class='signature'>
  #<strong>proper_table_name</strong>(name, options = {})  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Finds the correct table name given an Active Record object. Uses the Active
Record object&#39;s own table_name, or pre/suffix from the options passed
in.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L898'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


898
899
900
901
902
903
904</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 898</span>

<span class='kw'>def</span> <span class='id identifier rubyid_proper_table_name'>proper_table_name</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:table_name</span>
    <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_table_name'>table_name</span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:table_name_prefix</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:table_name_suffix</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="reversible-instance_method">
  <h3 class='signature'>
  #<strong>reversible</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Used to specify an operation that can be run in one direction or another.
Call the methods <code>up</code> and <code>down</code> of the yielded
object to run a block only in one given direction. The whole block will be
called in the right order within the migration.</p>

<p>In the following example, the looping on users will always be done when the
three columns &#39;first_name&#39;, &#39;last_name&#39; and
&#39;full_name&#39; exist, even when migrating down:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>SplitNameMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="" title="ActiveRecord::Migration (class)">Migration</a></span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:users</span><span class='comma'>,</span> <span class='symbol'>:first_name</span><span class='comma'>,</span> <span class='symbol'>:string</span>
    <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:users</span><span class='comma'>,</span> <span class='symbol'>:last_name</span><span class='comma'>,</span> <span class='symbol'>:string</span>

    <span class='id identifier rubyid_reversible'>reversible</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
      <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_reset_column_information'>reset_column_information</span>
      <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
        <span class='id identifier rubyid_dir'>dir</span><span class='period'>.</span><span class='id identifier rubyid_up'>up</span>   <span class='lbrace'>{</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='comma'>,</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span> <span class='op'>=</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_dir'>dir</span><span class='period'>.</span><span class='id identifier rubyid_down'>down</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_add_column'>add_column</span> <span class='symbol'>:users</span><span class='comma'>,</span> <span class='symbol'>:full_name</span><span class='comma'>,</span> <span class='symbol'>:string</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L726'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


726
727
728
729</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 726</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reversible'>reversible</span>
  <span class='id identifier rubyid_helper'>helper</span> <span class='op'>=</span> <span class='const'><a href="Migration/ReversibleBlockHelper.html" title="ActiveRecord::Migration::ReversibleBlockHelper (class)">ReversibleBlockHelper</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveRecord::Migration.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_reverting?'>reverting?</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_execute_block'>execute_block</span><span class='lbrace'>{</span> <span class='kw'>yield</span> <span class='id identifier rubyid_helper'>helper</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="revert-instance_method">
  <h3 class='signature'>
  #<strong>revert</strong>(*migration_classes)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Reverses the migration commands for the given block and the given
migrations.</p>

<p>The following migration will remove the table &#39;horses&#39; and create
the table &#39;apples&#39; on the way up, and the reverse on the way down.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>FixTLMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="" title="ActiveRecord::Migration (class)">Migration</a></span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_revert'>revert</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbol'>:horses</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='symbol'>:content</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_datetime'>datetime</span> <span class='symbol'>:remind_at</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbol'>:apples</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span> <span class='symbol'>:variety</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Or equivalently, if <code>TenderloveMigration</code> is defined as in the
documentation for Migration:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require_relative'>require_relative</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>20121212123456_tenderlove_migration</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>FixupTLMigration</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="" title="ActiveRecord::Migration (class)">Migration</a></span><span class='lbracket'>[</span><span class='float'>5.0</span><span class='rbracket'>]</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
    <span class='id identifier rubyid_revert'>revert</span> <span class='const'>TenderloveMigration</span>

    <span class='id identifier rubyid_create_table'>create_table</span><span class='lparen'>(</span><span class='symbol'>:apples</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span> <span class='symbol'>:variety</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This command can be nested.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L667'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 667</span>

<span class='kw'>def</span> <span class='id identifier rubyid_revert'>revert</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='comma'>,</span> <span class='label'>revert:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:revert</span>
      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='kw'>yield</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_recorder'>recorder</span> <span class='op'>=</span> <span class='const'><a href="Migration/CommandRecorder.html" title="ActiveRecord::Migration::CommandRecorder (class)">CommandRecorder</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Migration/CommandRecorder.html#new-class_method" title="ActiveRecord::Migration::CommandRecorder.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
      <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_recorder'>recorder</span>
      <span class='id identifier rubyid_suppress_messages'>suppress_messages</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='kw'>yield</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_recorder'>recorder</span><span class='period'>.</span><span class='id identifier rubyid_delegate'>delegate</span>
      <span class='id identifier rubyid_recorder'>recorder</span><span class='period'>.</span><span class='id identifier rubyid_commands'>commands</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
        <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="reverting?-instance_method">
  <h3 class='signature'>
  #<strong>reverting?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L686'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


686
687
688</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 686</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reverting?'>reverting?</span>
  <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:reverting</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_reverting'>reverting</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="run-instance_method">
  <h3 class='signature'>
  #<strong>run</strong>(*migration_classes)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Runs the given migration classes. Last argument can specify options:</p>
<ul><li>
<p>:direction (default is :up)</p>
</li><li>
<p>:revert (default is false)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L735'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


735
736
737
738
739
740
741
742
743
744
745
746
747</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 735</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_extract_options!'>extract_options!</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:direction</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='symbol'>:up</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span> <span class='op'>==</span> <span class='symbol'>:down</span> <span class='op'>?</span> <span class='symbol'>:up</span> <span class='op'>:</span> <span class='symbol'>:down</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:revert</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_reverting?'>reverting?</span>
    <span class='comment'># If in revert and going :up, say, we want to execute :down without reverting, so
</span>    <span class='id identifier rubyid_revert'>revert</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='comma'>,</span> <span class='label'>direction:</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='label'>revert:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_migration_classes'>migration_classes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_migration_class'>migration_class</span><span class='op'>|</span>
      <span class='id identifier rubyid_migration_class'>migration_class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_exec_migration'>exec_migration</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="say-instance_method">
  <h3 class='signature'>
  #<strong>say</strong>(message, subitem = false)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L808'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


808
809
810</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 808</span>

<span class='kw'>def</span> <span class='id identifier rubyid_say'>say</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_subitem'>subitem</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_write'>write</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_subitem'>subitem</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>   -&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="say_with_time-instance_method">
  <h3 class='signature'>
  #<strong>say_with_time</strong>(message)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L812'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


812
813
814
815
816
817
818
819</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 812</span>

<span class='kw'>def</span> <span class='id identifier rubyid_say_with_time'>say_with_time</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_say'>say</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="../Benchmark.html" title="Benchmark (class)">Benchmark</a></span><span class='period'>.</span><span class='id identifier rubyid_measure'>measure</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>yield</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_say'>say</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.4fs</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_real'>real</span><span class='comma'>,</span> <span class='symbol'>:subitem</span>
  <span class='id identifier rubyid_say'>say</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='embexpr_end'>}</span><span class='tstring_content'> rows</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:subitem</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../Integer.html" title="Integer (class)">Integer</a></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="suppress_messages-instance_method">
  <h3 class='signature'>
  #<strong>suppress_messages</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L821'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


821
822
823
824
825
826</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 821</span>

<span class='kw'>def</span> <span class='id identifier rubyid_suppress_messages'>suppress_messages</span>
  <span class='id identifier rubyid_save'>save</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_verbose'>verbose</span> <span class='op'>=</span> <span class='id identifier rubyid_verbose'>verbose</span><span class='comma'>,</span> <span class='kw'>false</span>
  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_verbose'>verbose</span> <span class='op'>=</span> <span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="table_name_options-instance_method">
  <h3 class='signature'>
  #<strong>table_name_options</strong>(config = ActiveRecord::Base)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Builds a hash for use in <a href="#proper_table_name-instance_method" title="ActiveRecord::Migration#proper_table_name (method)">#proper_table_name</a> using
the Active Record object&#39;s table_name prefix and suffix</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L917'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


917
918
919
920
921
922</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 917</span>

<span class='kw'>def</span> <span class='id identifier rubyid_table_name_options'>table_name_options</span><span class='lparen'>(</span><span class='id identifier rubyid_config'>config</span> <span class='op'>=</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='lbrace'>{</span>
    <span class='label'>table_name_prefix:</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_table_name_prefix'>table_name_prefix</span><span class='comma'>,</span>
    <span class='label'>table_name_suffix:</span> <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_table_name_suffix'>table_name_suffix</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="up-instance_method">
  <h3 class='signature'>
  #<strong>up</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L749'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


749
750
751
752
753</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 749</span>

<span class='kw'>def</span> <span class='id identifier rubyid_up'>up</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_delegate'>delegate</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:up</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_up'>up</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="write-instance_method">
  <h3 class='signature'>
  #<strong>write</strong>(text = &quot;&quot;)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/migration.rb#L798'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


798
799
800</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/migration.rb', line 798</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_text'>text</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_text'>text</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_verbose'>verbose</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>