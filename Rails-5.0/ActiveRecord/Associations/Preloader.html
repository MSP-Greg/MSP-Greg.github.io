<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Associations::Preloader &mdash; Rails-5.0.0</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Associations::Preloader",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Rails-5.0.0</a> &raquo; 
          <a href='../../_index.html'>Index (P)</a> &raquo; 
          <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <a href="../Associations.html" title="ActiveRecord::Associations (module)">Associations</a> &raquo; 
          <span class='title'>Preloader</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: ActiveRecord::Associations::Preloader</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="../../Object.html" title="Object (class)">Object</a></span>
      <ul class='fullTree'>
        <li><a href="../../Object.html" title="Object (class)">Object</a></li>
        <li class='next'>ActiveRecord::Associations::Preloader</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <a href="Preloader/ThroughAssociation.html" title="ActiveRecord::Associations::Preloader::ThroughAssociation (module)">ThroughAssociation</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Preloader/AlreadyLoaded.html" title="ActiveRecord::Associations::Preloader::AlreadyLoaded (class)">AlreadyLoaded</a>,
    <a href="Preloader/Association.html" title="ActiveRecord::Associations::Preloader::Association (class)">Association</a>,
    <a href="Preloader/BelongsTo.html" title="ActiveRecord::Associations::Preloader::BelongsTo (class)">BelongsTo</a>,
    <a href="Preloader/CollectionAssociation.html" title="ActiveRecord::Associations::Preloader::CollectionAssociation (class)">CollectionAssociation</a>,
    <a href="Preloader/HasMany.html" title="ActiveRecord::Associations::Preloader::HasMany (class)">HasMany</a>,
    <a href="Preloader/HasManyThrough.html" title="ActiveRecord::Associations::Preloader::HasManyThrough (class)">HasManyThrough</a>,
    <a href="Preloader/HasOne.html" title="ActiveRecord::Associations::Preloader::HasOne (class)">HasOne</a>,
    <a href="Preloader/HasOneThrough.html" title="ActiveRecord::Associations::Preloader::HasOneThrough (class)">HasOneThrough</a>,
    <a href="Preloader/NullPreloader.html" title="ActiveRecord::Associations::Preloader::NullPreloader (class)">NullPreloader</a>,
    <a href="Preloader/SingularAssociation.html" title="ActiveRecord::Associations::Preloader::SingularAssociation (class)">SingularAssociation</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Extended by:</td>
    <td><a href="../../ActiveSupport/Autoload.html" title="ActiveSupport::Autoload (module)">ActiveSupport::Autoload</a>
    </td>
  </tr>



  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader.rb#L41'>activerecord/lib/active_record/associations/preloader.rb</a><span class='defines'>,<br /><a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/association.rb#L3'>activerecord/lib/active_record/associations/preloader/association.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/belongs_to.rb#L3'>activerecord/lib/active_record/associations/preloader/belongs_to.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/collection_association.rb#L3'>activerecord/lib/active_record/associations/preloader/collection_association.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/has_many.rb#L3'>activerecord/lib/active_record/associations/preloader/has_many.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/has_many_through.rb#L3'>activerecord/lib/active_record/associations/preloader/has_many_through.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/has_one.rb#L3'>activerecord/lib/active_record/associations/preloader/has_one.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/has_one_through.rb#L3'>activerecord/lib/active_record/associations/preloader/has_one_through.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/singular_association.rb#L3'>activerecord/lib/active_record/associations/preloader/singular_association.rb</a>,<br/> <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader/through_association.rb#L3'>activerecord/lib/active_record/associations/preloader/through_association.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Implements the details of eager loading of Active Record associations.</p>

<p>Suppose that you have the following two Active Record models:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Author</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='comment'># columns: name, age
</span>  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:books</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Book</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='comment'># columns: title, sales, author_id
</span><span class='kw'>end</span>
</code></pre>

<p>When you load an author with all associated books Active Record will make
multiple queries like this:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Author</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:books</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bell hooks</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Homer</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

<span class='comment'>#=&gt; SELECT `authors`.* FROM `authors` WHERE `name` IN (&#39;bell hooks&#39;, &#39;Homer&#39;)
</span><span class='comment'>#=&gt; SELECT `books`.* FROM `books` WHERE `author_id` IN (2, 5)</span></code></pre>

<p>Active Record saves the ids of the records from the first query to use in
the second. Depending on the number of associations involved there can be
arbitrarily many SQL queries made.</p>

<p>However, if there is a WHERE clause that spans across tables Active Record
will fall back to a slightly more resource-intensive single query:</p>

<pre class="code ruby"><code class="ruby">Author.includes(:books).where(books: {title: &#39;Illiad&#39;}).to_a
#=&gt; SELECT `authors`.`id` AS t0_r0, `authors`.`name` AS t0_r1, `authors`.`age` AS t0_r2,
          `books`.`id`   AS t1_r0, `books`.`title`  AS t1_r1, `books`.`sales` AS t1_r2
   FROM `authors`
   LEFT OUTER JOIN `books` ON `authors`.`id` =  `books`.`author_id`
   WHERE `books`.`title` = &#39;Illiad&#39;</code></pre>

<p>This could result in many rows that contain redundant data and it performs
poorly at scale and is therefore only used when necessary.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='NULL_RELATION-constant'>
      NULL_RELATION =
    </dt>
    <dd>
            <pre class='code'><span class='const'><a href="../../Struct.html" title="Struct (class)">Struct</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:values</span><span class='comma'>,</span> <span class='symbol'>:where_clause</span><span class='comma'>,</span> <span class='symbol'>:joins_values</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='const'><a href="../Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span><span class='op'>::</span><span class='const'><a href="../Relation/WhereClause.html" title="ActiveRecord::Relation::WhereClause (class)">WhereClause</a></span><span class='period'>.</span><span class='id identifier rubyid_empty'><a href="../Relation/WhereClause.html#empty-class_method" title="ActiveRecord::Relation::WhereClause.empty (method)">empty</a></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span></pre>
    </dd>
  </dl>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#preload-instance_method" title="#preload (instance method)">#<strong>preload</strong>(records, associations, preload_scope = nil)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Eager loads the named associations for the given Active Record record(s).</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../../ActiveSupport/Autoload.html" title="ActiveSupport::Autoload (module)">ActiveSupport::Autoload</a></h3>
  <p class="inherited"><a href="../../ActiveSupport/Autoload.html#autoload-instance_method" title="ActiveSupport::Autoload#autoload (method)">autoload</a>, <a href="../../ActiveSupport/Autoload.html#autoload_at-instance_method" title="ActiveSupport::Autoload#autoload_at (method)">autoload_at</a>, <a href="../../ActiveSupport/Autoload.html#autoload_under-instance_method" title="ActiveSupport::Autoload#autoload_under (method)">autoload_under</a>, <a href="../../ActiveSupport/Autoload.html#autoloads-instance_method" title="ActiveSupport::Autoload#autoloads (method)">autoloads</a>, <a href="../../ActiveSupport/Autoload.html#eager_autoload-instance_method" title="ActiveSupport::Autoload#eager_autoload (method)">eager_autoload</a>, <a href="../../ActiveSupport/Autoload.html#eager_load%21-instance_method" title="ActiveSupport::Autoload#eager_load! (method)">eager_load!</a>, <a href="../../ActiveSupport/Autoload.html#extended-class_method" title="ActiveSupport::Autoload.extended (method)">.extended</a></p>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="preload-instance_method">
  <h3 class='signature first'>
  #<strong>preload</strong>(records, associations, preload_scope = nil)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Eager loads the named associations for the given Active Record record(s).</p>

<p>In this description, &#39;association name&#39; shall refer to the name
passed to an association creation method. For example, a model that
specifies <code>belongs_to :author</code>, <code>has_many :buyers</code>
has association names <code>:author</code> and <code>:buyers</code>.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>

<p><code>records</code> is an array of <a href="../Base.html" title="ActiveRecord::Base (class)">Base</a>. This array needs
not be flat, i.e. <code>records</code> itself may also contain arrays of
records. In any case, <code>preload_associations</code> will preload the
all associations records by flattening <code>records</code>.</p>

<p><code>associations</code> specifies one or more associations that you want
to preload. It may be:</p>
<ul><li>
<p>a Symbol or a String which specifies a single association name. For
example, specifying <code>:books</code> allows this method to preload all
books for an Author.</p>
</li><li>
<p>an Array which specifies multiple association names. This array is
processed recursively. For example, specifying <code>[:avatar,
:books]</code> allows this method to preload an author&#39;s avatar as well
as all of his books.</p>
</li><li>
<p>a Hash which specifies multiple association names, as well as association
names for the to-be-preloaded association objects. For example, specifying
<code>{ author: :avatar }</code> will preload a book&#39;s author, as well
as that author&#39;s avatar.</p>
</li></ul>

<p><code>:associations</code> has the same format as the <code>:include</code>
option for <code>ActiveRecord::Base.find</code>. So
<code>associations</code> could look like this:</p>

<pre class="code ruby"><code class="ruby"><span class='symbol'>:books</span>
<span class='lbracket'>[</span> <span class='symbol'>:books</span><span class='comma'>,</span> <span class='symbol'>:author</span> <span class='rbracket'>]</span>
<span class='lbrace'>{</span> <span class='label'>author:</span> <span class='symbol'>:avatar</span> <span class='rbrace'>}</span>
<span class='lbracket'>[</span> <span class='symbol'>:books</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>author:</span> <span class='symbol'>:avatar</span> <span class='rbrace'>}</span> <span class='rbracket'>]</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/associations/preloader.rb#L93'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/associations/preloader.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preload'>preload</span><span class='lparen'>(</span><span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_associations'>associations</span><span class='comma'>,</span> <span class='id identifier rubyid_preload_scope'>preload_scope</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_records'>records</span>       <span class='op'>=</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span><span class='period'>.</span><span class='id identifier rubyid_wrap'><a href="../../Array.html#wrap-class_method" title="Array.wrap (method)">wrap</a></span><span class='lparen'>(</span><span class='id identifier rubyid_records'>records</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='id identifier rubyid_associations'>associations</span>  <span class='op'>=</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span><span class='period'>.</span><span class='id identifier rubyid_wrap'><a href="../../Array.html#wrap-class_method" title="Array.wrap (method)">wrap</a></span><span class='lparen'>(</span><span class='id identifier rubyid_associations'>associations</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_preload_scope'>preload_scope</span> <span class='op'>=</span> <span class='id identifier rubyid_preload_scope'>preload_scope</span> <span class='op'>||</span> <span class='const'><a href="#NULL_RELATION-constant" title="ActiveRecord::Associations::Preloader::NULL_RELATION (constant)">NULL_RELATION</a></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_associations'>associations</span><span class='period'>.</span><span class='id identifier rubyid_flat_map'>flat_map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_association'>association</span><span class='op'>|</span>
      <span class='id identifier rubyid_preloaders_on'>preloaders_on</span> <span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_preload_scope'>preload_scope</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>