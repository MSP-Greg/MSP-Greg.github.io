<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::CounterCache::ClassMethods &mdash; Rails-5.0.0</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::CounterCache::ClassMethods",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Rails-5.0.0</a> &raquo; 
          <a href='../../_index.html'>Index (C)</a> &raquo; 
        #  <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        #  <a href="../CounterCache.html" title="ActiveRecord::CounterCache (module)">CounterCache</a> &raquo; 
          <span class='title'>ClassMethods</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActiveRecord::CounterCache::ClassMethods</h1>

<div class="box_info">



  <dl>
    <dt>Defined in:</dt>
    <dd>activerecord/lib/active_record/counter_cache.rb</dd>
  </dl>
</div>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#decrement_counter-instance_method" title="#decrement_counter (instance method)">#<strong>decrement_counter</strong>(counter_name, id)  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Decrement a numeric field by one, via a direct SQL update.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#increment_counter-instance_method" title="#increment_counter (instance method)">#<strong>increment_counter</strong>(counter_name, id)  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Increment a numeric field by one, via a direct SQL update.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reset_counters-instance_method" title="#reset_counters (instance method)">#<strong>reset_counters</strong>(id, *counters)  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Resets one or more counter caches to their correct value using an SQL count
query.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#update_counters-instance_method" title="#update_counters (instance method)">#<strong>update_counters</strong>(id, counters)  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>A generic “counter updater” implementation, intended primarily to be used
by <a href="#increment_counter-instance_method" title="ActiveRecord::CounterCache::ClassMethods#increment_counter (method)">#increment_counter</a> and <a href="#decrement_counter-instance_method" title="ActiveRecord::CounterCache::ClassMethods#decrement_counter (method)">#decrement_counter</a>, but which may also be
useful on its own.</p>
</div>
      </span>
    </li>
  </ul>

<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="decrement_counter-instance_method">
  <h3 class='signature first'>
  #<strong>decrement_counter</strong>(counter_name, id)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Decrement a numeric field by one, via a direct SQL update.</p>

<p>This works the same as <a href="#increment_counter-instance_method" title="ActiveRecord::CounterCache::ClassMethods#increment_counter (method)">#increment_counter</a> but reduces the column value by
1 instead of increasing it.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>counter_name</code> - The name of the field that should be
decremented.</p>
</li><li>
<p><code>id</code> - The id of the object that should be decremented or an
array of ids.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Decrement the posts_count column for the record with an id of 5
</span><span class='const'>DiscussionBoard</span><span class='period'>.</span><span class='id identifier rubyid_decrement_counter'>decrement_counter</span><span class='lparen'>(</span><span class='symbol'>:posts_count</span><span class='comma'>,</span> <span class='int'>5</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


120
121
122</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'activerecord/lib/active_record/counter_cache.rb', line 120</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrement_counter'>decrement_counter</span><span class='lparen'>(</span><span class='id identifier rubyid_counter_name'>counter_name</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_update_counters'>update_counters</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_name'>counter_name</span> <span class='op'>=&gt;</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="increment_counter-instance_method">
  <h3 class='signature'>
  #<strong>increment_counter</strong>(counter_name, id)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Increment a numeric field by one, via a direct SQL update.</p>

<p>This method is used primarily for maintaining counter_cache columns that
are used to store aggregate values. For example, a
<code>DiscussionBoard</code> may cache posts_count and comments_count to
avoid running an SQL query to calculate the number of posts and comments
there are, each time it is displayed.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>counter_name</code> - The name of the field that should be
incremented.</p>
</li><li>
<p><code>id</code> - The id of the object that should be incremented or an
array of ids.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Increment the posts_count column for the record with an id of 5
</span><span class='const'>DiscussionBoard</span><span class='period'>.</span><span class='id identifier rubyid_increment_counter'>increment_counter</span><span class='lparen'>(</span><span class='symbol'>:posts_count</span><span class='comma'>,</span> <span class='int'>5</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


102
103
104</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'activerecord/lib/active_record/counter_cache.rb', line 102</span>

<span class='kw'>def</span> <span class='id identifier rubyid_increment_counter'>increment_counter</span><span class='lparen'>(</span><span class='id identifier rubyid_counter_name'>counter_name</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_update_counters'>update_counters</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_name'>counter_name</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="reset_counters-instance_method">
  <h3 class='signature'>
  #<strong>reset_counters</strong>(id, *counters)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Resets one or more counter caches to their correct value using an SQL count
query. This is useful when adding new counter caches, or if the counter has
been corrupted or modified directly by SQL.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>id</code> - The id of the object you wish to reset a counter on.</p>
</li><li>
<p><code>counters</code> - One or more association counters to reset.
Association name or counter name can be given.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># For Post with id #1 records reset the comments_count
</span><span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_reset_counters'>reset_counters</span><span class='lparen'>(</span><span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:comments</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'activerecord/lib/active_record/counter_cache.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_counters'>reset_counters</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_counters'>counters</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_counters'>counters</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_counter_association'>counter_association</span><span class='op'>|</span>
    <span class='id identifier rubyid_has_many_association'>has_many_association</span> <span class='op'>=</span> <span class='id identifier rubyid__reflect_on_association'>_reflect_on_association</span><span class='lparen'>(</span><span class='id identifier rubyid_counter_association'>counter_association</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span>
      <span class='id identifier rubyid_has_many'>has_many</span> <span class='op'>=</span> <span class='id identifier rubyid_reflect_on_all_associations'>reflect_on_all_associations</span><span class='lparen'>(</span><span class='symbol'>:has_many</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_has_many_association'>has_many_association</span> <span class='op'>=</span> <span class='id identifier rubyid_has_many'>has_many</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_association'>association</span><span class='op'>|</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_counter_cache_column'>counter_cache_column</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_counter_cache_column'>counter_cache_column</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='op'>==</span> <span class='id identifier rubyid_counter_association'>counter_association</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_counter_association'>counter_association</span> <span class='op'>=</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span><span class='period'>.</span><span class='id identifier rubyid_plural_name'>plural_name</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; has no association called &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counter_association'>counter_association</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Reflection</span><span class='op'>::</span><span class='const'>ThroughReflection</span>
      <span class='id identifier rubyid_has_many_association'>has_many_association</span> <span class='op'>=</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span><span class='period'>.</span><span class='id identifier rubyid_through_reflection'>through_reflection</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_foreign_key'>foreign_key</span>  <span class='op'>=</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span><span class='period'>.</span><span class='id identifier rubyid_foreign_key'>foreign_key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_child_class'>child_class</span>  <span class='op'>=</span> <span class='id identifier rubyid_has_many_association'>has_many_association</span><span class='period'>.</span><span class='id identifier rubyid_klass'>klass</span>
    <span class='id identifier rubyid_reflection'>reflection</span>   <span class='op'>=</span> <span class='id identifier rubyid_child_class'>child_class</span><span class='period'>.</span><span class='id identifier rubyid__reflections'>_reflections</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_belongs_to?'>belongs_to?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_foreign_key'>foreign_key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_foreign_key'>foreign_key</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:counter_cache</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_counter_name'>counter_name</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span><span class='period'>.</span><span class='id identifier rubyid_counter_cache_column'>counter_cache_column</span>

    <span class='id identifier rubyid_unscoped'>unscoped</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update_all'>update_all</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_counter_name'>counter_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_object'>object</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_counter_association'>counter_association</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>
    <span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="update_counters-instance_method">
  <h3 class='signature'>
  #<strong>update_counters</strong>(id, counters)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>A generic “counter updater” implementation, intended primarily to be used
by <a href="#increment_counter-instance_method" title="ActiveRecord::CounterCache::ClassMethods#increment_counter (method)">#increment_counter</a> and <a href="#decrement_counter-instance_method" title="ActiveRecord::CounterCache::ClassMethods#decrement_counter (method)">#decrement_counter</a>, but which may also be
useful on its own. It simply does a direct SQL update for the record with
the given ID, altering the given hash of counters by the amount given by
the corresponding value:</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>id</code> - The id of the object you wish to update a counter on or
an array of ids.</p>
</li><li>
<p><code>counters</code> - A Hash containing the names of the fields to update
as keys and the amount to update the field by as values.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># For the Post with id of 5, decrement the comment_count by 1, and
</span><span class='comment'># increment the action_count by 1
</span><span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_update_counters'>update_counters</span> <span class='int'>5</span><span class='comma'>,</span> <span class='label'>comment_count:</span> <span class='op'>-</span><span class='int'>1</span><span class='comma'>,</span> <span class='label'>action_count:</span> <span class='int'>1</span>
<span class='comment'># Executes the following SQL:
</span><span class='comment'># UPDATE posts
</span><span class='comment'>#    SET comment_count = COALESCE(comment_count, 0) - 1,
</span><span class='comment'>#        action_count = COALESCE(action_count, 0) + 1
</span><span class='comment'>#  WHERE id = 5
</span>
<span class='comment'># For the Posts with id of 10 and 15, increment the comment_count by 1
</span><span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_update_counters'>update_counters</span> <span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>15</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>comment_count:</span> <span class='int'>1</span>
<span class='comment'># Executes the following SQL:
</span><span class='comment'># UPDATE posts
</span><span class='comment'>#    SET comment_count = COALESCE(comment_count, 0) + 1
</span><span class='comment'>#  WHERE id IN (10, 15)
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


76
77
78
79
80
81
82
83
84</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'activerecord/lib/active_record/counter_cache.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_counters'>update_counters</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_counters'>counters</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_updates'>updates</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_counter_name'>counter_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_operator'>operator</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>+</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_quoted_column'>quoted_column</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_quote_column_name'>quote_column_name</span><span class='lparen'>(</span><span class='id identifier rubyid_counter_name'>counter_name</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_quoted_column'>quoted_column</span><span class='embexpr_end'>}</span><span class='tstring_content'> = COALESCE(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_quoted_column'>quoted_column</span><span class='embexpr_end'>}</span><span class='tstring_content'>, 0) </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_operator'>operator</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_unscoped'>unscoped</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update_all'>update_all</span> <span class='id identifier rubyid_updates'>updates</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
  </div>
</div>
</section>
<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.8.7.6 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>