<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::Live &mdash; Rails-5.0.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActionController::Live",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.0.0</a> &raquo; 
          <a href='../_index.html'>Index (L)</a> &raquo; 
          <a href="../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
          <span class='title'>Live</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActionController::Live</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>

  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <a href="Live/ClassMethods.html" title="ActionController::Live::ClassMethods (module)">ClassMethods</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Live/Buffer.html" title="ActionController::Live::Buffer (class)">Buffer</a>,
    <a href="Live/Response.html" title="ActionController::Live::Response (class)">Response</a>,
    <a href="Live/SSE.html" title="ActionController::Live::SSE (class)">SSE</a>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <a href="Live/ClientDisconnected.html" title="ActionController::Live::ClientDisconnected (class)">ClientDisconnected</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Extended by:</td>
    <td><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a>
    </td>
  </tr>



  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/live.rb#L35'>actionpack/lib/action_controller/metal/live.rb</a><span class='defines'>,<br /><a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/test_case.rb#L15'>actionpack/lib/action_controller/test_case.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Mix this module into your controller, and all actions in that controller
will be able to stream data to the client as it&#39;s written.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyController</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'>Live</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_stream'>stream</span>
    <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/event-stream</span><span class='tstring_end'>&#39;</span></span>
    <span class='int'>100</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span>
      <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello world\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>
    <span class='rbrace'>}</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>There are a few caveats with this module. You <strong>cannot</strong> write
headers after the response has been committed (Response#committed? will
return truthy). Calling <code>write</code> or <code>close</code> on the
response stream will cause the response object to be committed. Make sure
all headers are set before calling write or close on your stream.</p>

<p>You <strong>must</strong> call close on your stream when you&#39;re
finished, otherwise the socket may be left open forever.</p>

<p>The final caveat is that your actions are executed in a separate thread
than the main thread. Make sure your actions are thread safe, and this
shouldn&#39;t be a problem (don&#39;t share state across threads, etc).</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#log_error-instance_method" title="#log_error (instance method)">#<strong>log_error</strong>(exception)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#process-instance_method" title="#process (instance method)">#<strong>process</strong>(name)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#response_body%3D-instance_method" title="#response_body= (instance method)">#<strong>response_body=</strong>(body)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>, <a href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>, <a href="../ActiveSupport/Concern.html#extended-class_method" title="ActiveSupport::Concern.extended (method)">.extended</a>, <a href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></p>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="log_error-instance_method">
  <h3 class='signature first'>
  #<strong>log_error</strong>(exception)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/live.rb#L289'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


289
290
291
292
293
294
295
296
297
298
299</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'actionpack/lib/action_controller/metal/live.rb', line 289</span>

<span class='kw'>def</span> <span class='id identifier rubyid_log_error'>log_error</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActionController::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_fatal'>fatal</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>):\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_annoted_source_code'>annoted_source_code</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='kw'>if</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:annoted_source_code</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_exception'>exception</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n  </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="process-instance_method">
  <h3 class='signature'>
  #<strong>process</strong>(name)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/live.rb#L232'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'actionpack/lib/action_controller/metal/live.rb', line 232</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process'>process</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t1'>t1</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span>
  <span class='id identifier rubyid_locals'>locals</span> <span class='op'>=</span> <span class='id identifier rubyid_t1'>t1</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_t1'>t1</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='comment'># This processes the action in a child thread. It lets us return the
</span>  <span class='comment'># response code and headers back up the rack stack, and still process
</span>  <span class='comment'># the body in parallel with sending data to the client
</span>  <span class='id identifier rubyid_new_controller_thread'>new_controller_thread</span> <span class='lbrace'>{</span>
    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Dependencies.html" title="ActiveSupport::Dependencies (module)">Dependencies</a></span><span class='period'>.</span><span class='id identifier rubyid_interlock'>interlock</span><span class='period'>.</span><span class='id identifier rubyid_running'>running</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_t2'>t2</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span>

      <span class='comment'># Since we&#39;re processing the view in a different thread, copy the
</span>      <span class='comment'># thread locals from the main thread to the child thread. :&#39;(
</span>      <span class='id identifier rubyid_locals'>locals</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_t2'>t2</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span> <span class='rbrace'>}</span>

      <span class='kw'>begin</span>
        <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
        <span class='kw'>if</span> <span class='ivar'>@_response</span><span class='period'>.</span><span class='id identifier rubyid_committed?'>committed?</span>
          <span class='kw'>begin</span>
            <span class='ivar'>@_response</span><span class='period'>.</span><span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='const'><a href="../ActionView.html" title="ActionView (module)">ActionView</a></span><span class='op'>::</span><span class='const'><a href="../ActionView/Base.html" title="ActionView::Base (class)">Base</a></span><span class='period'>.</span><span class='id identifier rubyid_streaming_completion_on_exception'>streaming_completion_on_exception</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span> <span class='op'>==</span> <span class='symbol'>:html</span>
            <span class='ivar'>@_response</span><span class='period'>.</span><span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_call_on_error'>call_on_error</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exception'>exception</span>
            <span class='id identifier rubyid_log_error'>log_error</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
          <span class='kw'>ensure</span>
            <span class='id identifier rubyid_log_error'>log_error</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>
            <span class='ivar'>@_response</span><span class='period'>.</span><span class='id identifier rubyid_stream'>stream</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>
        <span class='kw'>end</span>
      <span class='kw'>ensure</span>
        <span class='ivar'>@_response</span><span class='period'>.</span><span class='id identifier rubyid_commit!'>commit!</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Dependencies.html" title="ActiveSupport::Dependencies (module)">Dependencies</a></span><span class='period'>.</span><span class='id identifier rubyid_interlock'>interlock</span><span class='period'>.</span><span class='id identifier rubyid_permit_concurrent_loads'>permit_concurrent_loads</span> <span class='kw'>do</span>
    <span class='ivar'>@_response</span><span class='period'>.</span><span class='id identifier rubyid_await_commit'>await_commit</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>if</span> <span class='id identifier rubyid_error'>error</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="response_body=-instance_method">
  <h3 class='signature'>
  #<strong>response_body=</strong>(body)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/live.rb#L301'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


301
302
303
304</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'actionpack/lib/action_controller/metal/live.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_response_body='>response_body=</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='rparen'>)</span>
  <span class='kw'>super</span>
  <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>