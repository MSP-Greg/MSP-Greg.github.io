<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: README &mdash; Redis master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "README",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Redis master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: README&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>redis-rb <a href="https://github.com/redis/redis-rb/actions"><img src="https://github.com/redis/redis-rb/workflows/Test/badge.svg" alt="Build Status"></a> <a href="https://rubydoc.info/github/redis/redis-rb"><img src="https://img.shields.io/badge/docs-rdoc.info-blue.svg" alt="Inline docs"></a></h1>

<p>A Ruby client that tries to match <a href="https://redis.io">Redis</a>&#39; API one-to-one, while still providing an idiomatic interface.</p>

<p>See <a href="https://rubydoc.info/gems/redis">RubyDoc.info</a> for the API docs of the latest published gem.</p>

<h2>Getting started</h2>

<p>Install with:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_redis'>redis</span></code></pre>

<p>You can connect to Redis by instantiating the <a href="Redis.html" title="Redis (class)"><code>Redis</code></a> class:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redis</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span></code></pre>

<p>This assumes Redis was started with a default configuration, and is
listening on <code>localhost</code>, port 6379. If you need to connect to a remote
server or a different port, try:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.0.1.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>6380</span><span class='comma'>,</span> <span class='label'>db:</span> <span class='int'>15</span>)</code></pre>

<p>You can also specify connection options as a <a href="https://www.iana.org/assignments/uri-schemes/prov/redis"><code>redis://</code> URL</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>url:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redis://:p4ssw0rd@10.0.1.1:6380/15</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>The client expects passwords with special characters to be URL-encoded (i.e.
<code>CGI.escape(password)</code>).</p>

<p>To connect to Redis listening on a Unix socket, try:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>path:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/redis.sock</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>To connect to a password protected Redis instance, use:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mysecret</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>To connect a Redis instance using <a href="https://redis.io/topics/acl">ACL</a>, use:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>username:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>myname</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysecret</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>The Redis class exports methods that are named identical to the commands
they execute. The arguments these methods accept are often identical to
the arguments specified on the <a href="https://redis.io/commands">Redis website</a>. For
instance, the <code>SET</code> and <code>GET</code> commands can be called like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_set'>set</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mykey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; &quot;OK&quot;
</span>
<span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_get'>get</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mykey</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; &quot;hello world&quot;</span></code></pre>

<p>All commands, their arguments, and return values are documented and
available on <a href="https://rubydoc.info/gems/redis">RubyDoc.info</a>.</p>

<h2>Connection Pooling and Thread safety</h2>

<p>The client does not provide connection pooling. Each <a href="Redis.html" title="Redis (class)"><code>Redis</code></a> instance
has one and only one connection to the server, and use of this connection
is protected by a mutex.</p>

<p>As such it is heavily recommended to use the <a href="https://github.com/mperham/connection_pool"><code>connection_pool</code> gem</a>, e.g.:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>MyApp</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_redis'>redis</span>
    <span class='ivar'>@redis</span> <span class='op'>||=</span> <span class='const'>ConnectionPool</span><span class='op'>::</span><span class='const'>Wrapper</span>.<span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
      <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>url:</span> <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>REDIS_URL</span><span class='tstring_end'>&quot;</span></span>])
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>MyApp</span>.<span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_incr'>incr</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some-counter</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<h2>Sentinel support</h2>

<p>The client is able to perform automatic failover by using <a href="http://redis.io/topics/sentinel">Redis
Sentinel</a>. Make sure to run Redis 2.8+
if you want to use this feature.</p>

<p>To connect using Sentinel, use:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>SENTINELS</span> <span class='op'>=</span> [{ <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26380</span> }<span class='comma'>,</span>
             { <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26381</span> }]

<span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mymaster</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>sentinels:</span> <span class='const'>SENTINELS</span><span class='comma'>,</span> <span class='label'>role:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_master'>master</span>)</code></pre>

<ul>
<li><p>The master name identifies a group of Redis instances composed of a master
and one or more slaves (<code>mymaster</code> in the example).</p></li>
<li><p>It is possible to optionally provide a role. The allowed roles are <code>master</code>
and <code>slave</code>. When the role is <code>slave</code>, the client will try to connect to a
random slave of the specified master. If a role is not specified, the client
will connect to the master.</p></li>
<li><p>When using Sentinel support, you need to specify a list of sentinels to
connect to. The list does not need to enumerate all your Sentinel instances,
but a few so that if one is down the client will try the next one. The client
is able to remember the last Sentinel that was able to reply correctly and will
use it for the next request.</p></li>
</ul>

<p>To <a href="https://redis.io/docs/management/sentinel/#configuring-sentinel-instances-with-authentication">authenticate</a> with Sentinel itself, you can specify the <code>sentinel_username</code> and <code>sentinel_password</code>. Exclude the <code>sentinel_username</code> option if you&#39;re using password-only authentication.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>SENTINELS</span> <span class='op'>=</span> [{ <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26380</span>}<span class='comma'>,</span>
             { <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26381</span>}]

<span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mymaster</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>sentinels:</span> <span class='const'>SENTINELS</span><span class='comma'>,</span> <span class='label'>sentinel_username:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>appuser</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>sentinel_password:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysecret</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>role:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_master'>master</span>)</code></pre>

<p>If you specify a username and/or password at the top level for your main Redis instance, Sentinel <em>will not</em> use those credentials.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Use &#39;mysecret&#39; to authenticate against the mymaster instance, but skip authentication for the sentinels:
</span><span class='const'>SENTINELS</span> <span class='op'>=</span> [{ <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26380</span> }<span class='comma'>,</span>
             { <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26381</span> }]

<span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mymaster</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>sentinels:</span> <span class='const'>SENTINELS</span><span class='comma'>,</span> <span class='label'>role:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_master'>master</span><span class='comma'>,</span> <span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysecret</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>So you have to provide Sentinel credentials and Redis explicitly even if they are the same.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Use &#39;mysecret&#39; to authenticate against the mymaster instance and sentinel
</span><span class='const'>SENTINELS</span> <span class='op'>=</span> [{ <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26380</span> }<span class='comma'>,</span>
             { <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>port:</span> <span class='int'>26381</span> }]

<span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mymaster</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>sentinels:</span> <span class='const'>SENTINELS</span><span class='comma'>,</span> <span class='label'>role:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_master'>master</span><span class='comma'>,</span> <span class='label'>password:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysecret</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>sentinel_password:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mysecret</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>Also, the <code>name</code>, <code>password</code>, <code>username</code>, and <code>db</code> for the Redis instance can be passed as a URL:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>url:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redis://appuser:mysecret@mymaster/10</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>sentinels:</span> <span class='const'>SENTINELS</span><span class='comma'>,</span> <span class='label'>role:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_master'>master</span>)</code></pre>

<h2>Cluster support</h2>

<p><a href="https://redis.io/topics/cluster-spec">Clustering</a>. is supported via the <a href="cluster/"><code>redis-clustering</code> gem</a>.</p>

<h2>Pipelining</h2>

<p>When multiple commands are executed sequentially, but are not dependent,
the calls can be <em>pipelined</em>. This means that the client doesn&#39;t wait
for reply of the first command before sending the next command. The
advantage is that multiple commands are sent at once, resulting in
faster overall execution.</p>

<p>The client can be instructed to pipeline commands by using the
<code>#pipelined</code> method. After the block is executed, the client sends all
commands to Redis and gathers their replies. These replies are returned
by the <code>#pipelined</code> method.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_pipelined'>pipelined</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='op'>|</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_set'>set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_incr'>incr</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='comment'># =&gt; [&quot;OK&quot;, 1]</span></code></pre>

<p>Commands must be called on the yielded objects. If you call methods
on the original client objects from inside a pipeline, they will be sent immediately:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_pipelined'>pipelined</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='op'>|</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_set'>set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_incr'>incr</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># =&gt; 1
</span><span class='kw'>end</span>
<span class='comment'># =&gt; [&quot;OK&quot;]</span></code></pre>

<h3>Exception management</h3>

<p>The <code>exception</code> flag in the <code>#pipelined</code> is a feature that modifies the pipeline execution behavior. When set
to <code>false</code>, it doesn&#39;t raise an exception when a command error occurs. Instead, it allows the pipeline to execute all
commands, and any failed command will be available in the returned array. (Defaults to <code>true</code>)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_pipelined'>pipelined</span>(<span class='label'>exception:</span> <span class='kw'>false</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='op'>|</span>
  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_set'>set</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>key1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value1</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_lpush'>lpush</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>key1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>something</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># This will fail
</span>  <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_set'>set</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>key2</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value2</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
<span class='comment'># results =&gt; [&quot;OK&quot;, #&lt;RedisClient::WrongTypeError: WRONGTYPE Operation against a key holding the wrong kind of value&gt;, &quot;OK&quot;]
</span>
<span class='id identifier rubyid_results'>results</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span><span class='op'>::</span><span class='const'><a href="Redis/CommandError.html" title="Redis::CommandError (class)">CommandError</a></span>)
    <span class='comment'># Do something with the failed result
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h3>Executing commands atomically</h3>

<p>You can use <code>MULTI/EXEC</code> to run a number of commands in an atomic
fashion. This is similar to executing a pipeline, but the commands are
preceded by a call to <code>MULTI</code>, and followed by a call to <code>EXEC</code>. Like
the regular pipeline, the replies to the commands are returned by the
<code>#multi</code> method.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_multi'>multi</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_transaction'>transaction</span><span class='op'>|</span>
  <span class='id identifier rubyid_transaction'>transaction</span>.<span class='id identifier rubyid_set'>set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_transaction'>transaction</span>.<span class='id identifier rubyid_incr'>incr</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='comment'># =&gt; [&quot;OK&quot;, 1]</span></code></pre>

<h3>Futures</h3>

<p>Replies to commands in a pipeline can be accessed via the <em>futures</em> they
emit. All calls on the pipeline object return a
<code>Future</code> object, which responds to the <code>#value</code> method. When the
pipeline has successfully executed, all futures are assigned their
respective replies and can be used.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'>set</span> <span class='op'>=</span> <span class='id identifier rubyid_incr'>incr</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_pipelined'>pipelined</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pipeline'>pipeline</span><span class='op'>|</span>
  <span class='id identifier rubyid_set'>set</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_set'>set</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_incr'>incr</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline'>pipeline</span>.<span class='id identifier rubyid_incr'>incr</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_set'>set</span>.<span class='id identifier rubyid_value'>value</span>
<span class='comment'># =&gt; &quot;OK&quot;
</span>
<span class='id identifier rubyid_incr'>incr</span>.<span class='id identifier rubyid_value'>value</span>
<span class='comment'># =&gt; 1</span></code></pre>

<h2>Error Handling</h2>

<p>In general, if something goes wrong you&#39;ll get an exception. For example, if
it can&#39;t connect to the server a <a href="Redis/CannotConnectError.html" title="Redis::CannotConnectError (class)"><code>::Redis::CannotConnectError</code></a> error will be raised.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>begin</span>
  <span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_ping'>ping</span>
<span class='kw'>rescue</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span><span class='op'>::</span><span class='const'><a href="Redis/BaseError.html" title="Redis::BaseError (class)">BaseError</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_inspect'>inspect</span>
<span class='comment'># =&gt; #&lt;Redis::CannotConnectError: Timed out connecting to Redis on 10.0.1.1:6380&gt;
</span>
  <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_message'>message</span>
<span class='comment'># =&gt; Timed out connecting to Redis on 10.0.1.1:6380
</span><span class='kw'>end</span></code></pre>

<p>See lib/redis/errors.rb for information about what exceptions are possible.</p>

<h2>Timeouts</h2>

<p>The client allows you to configure connect, read, and write timeouts.
Starting in version 5.0, the default for each is 1. Before that, it was 5.
Passing a single <code>timeout</code> option will set all three values:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=&gt;</span> <span class='int'>1</span>)</code></pre>

<p>But you can use specific values for each of them:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>=&gt;</span> <span class='float'>0.2</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_read_timeout'>read_timeout</span>    <span class='op'>=&gt;</span> <span class='float'>1.0</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_write_timeout'>write_timeout</span>   <span class='op'>=&gt;</span> <span class='float'>0.5</span>
)</code></pre>

<p>All timeout values are specified in seconds.</p>

<p>When using pub/sub, you can subscribe to a channel using a timeout as well:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>reconnect_attempts:</span> <span class='int'>0</span>)
<span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_subscribe_with_timeout'>subscribe_with_timeout</span>(<span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>news</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_on'>on</span><span class='op'>|</span>
  <span class='id identifier rubyid_on'>on</span>.<span class='id identifier rubyid_message'>message</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='op'>|</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>If no message is received after 5 seconds, the client will unsubscribe.</p>

<h2>Reconnections</h2>

<p><strong>By default</strong>, this gem will only <strong>retry a connection once</strong> and then fail, but
the client allows you to configure how many <code>reconnect_attempts</code> it should
complete before declaring a connection as failed.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>reconnect_attempts:</span> <span class='int'>0</span>)
<span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>reconnect_attempts:</span> <span class='int'>3</span>)</code></pre>

<p>If you wish to wait between reconnection attempts, you can instead pass a list
of durations:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>reconnect_attempts:</span> [
  <span class='int'>0</span><span class='comma'>,</span> <span class='comment'># retry immediately
</span>  <span class='float'>0.25</span><span class='comma'>,</span> <span class='comment'># retry a second time after 250ms
</span>  <span class='int'>1</span><span class='comma'>,</span> <span class='comment'># retry a third and final time after another 1s
</span>])</code></pre>

<p>If you wish to disable reconnection only for some commands, you can use
<code>disable_reconnection</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_get'>get</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some-key</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># this may be retried
</span><span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_disable_reconnection'>disable_reconnection</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_redis'>redis</span>.<span class='id identifier rubyid_incr'>incr</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some-counter</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># this won&#39;t be retried.
</span><span class='kw'>end</span></code></pre>

<h2>SSL/TLS Support</h2>

<p>To enable SSL support, pass the <code>:ssl =&gt; true</code> option when configuring the
Redis client, or pass in <code>:url =&gt; &quot;rediss://...&quot;</code> (like HTTPS for Redis).
You will also need to pass in an <code>:ssl_params =&gt; { ... }</code> hash used to
configure the <code>OpenSSL::SSL::SSLContext</code> object used for the connection:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_url'>url</span>        <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rediss://:p4ssw0rd@10.0.1.1:6381/15</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_params'>ssl_params</span> <span class='op'>=&gt;</span> {
    <span class='symbeg'>:</span><span class='id identifier rubyid_ca_file'>ca_file</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/path/to/ca.crt</span><span class='tstring_end'>&quot;</span></span>
  }
)</code></pre>

<p>The options given to <code>:ssl_params</code> are passed directly to the
<code>OpenSSL::SSL::SSLContext#set_params</code> method and can be any valid attribute
of the SSL context. Please see the <a href="http://ruby-doc.org/stdlib-2.5.0/libdoc/openssl/rdoc/OpenSSL/SSL/SSLContext.html">OpenSSL::SSL::SSLContext documentation</a>
for all of the available attributes.</p>

<p>Here is an example of passing in params that can be used for SSL client
certificate authentication (a.k.a. mutual TLS):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_url'>url</span>        <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rediss://:p4ssw0rd@10.0.1.1:6381/15</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_ssl_params'>ssl_params</span> <span class='op'>=&gt;</span> {
    <span class='symbeg'>:</span><span class='id identifier rubyid_ca_file'>ca_file</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/path/to/ca.crt</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_cert'>cert</span>    <span class='op'>=&gt;</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>client.crt</span><span class='tstring_end'>&quot;</span></span>))<span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_key'>key</span>     <span class='op'>=&gt;</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>client.key</span><span class='tstring_end'>&quot;</span></span>))
  }
)</code></pre>

<h2>Expert-Mode Options</h2>

<ul>
<li><code>inherit_socket: true</code>: disable safety check that prevents a forked child
from sharing a socket with its parent; this is potentially useful in order to mitigate connection churn when:

<ul>
<li>many short-lived forked children of one process need to talk
to redis, AND</li>
<li>your own code prevents the parent process from using the redis
connection while a child is alive</li>
</ul></li>
</ul>

<p>Improper use of <code>inherit_socket</code> will result in corrupted and/or incorrect
   responses.</p>

<h2>hiredis binding</h2>

<p>By default, redis-rb uses Ruby&#39;s socket library to talk with Redis.</p>

<p>The hiredis driver uses the connection facility of hiredis-rb. In turn,
hiredis-rb is a binding to the official hiredis client library. It
optimizes for speed, at the cost of portability. Because it is a C
extension, JRuby is not supported (by default).</p>

<p>It is best to use hiredis when you have large replies (for example:
<code>LRANGE</code>, <code>SMEMBERS</code>, <code>ZRANGE</code>, etc.) and/or use big pipelines.</p>

<p>In your Gemfile, include <code>hiredis-client</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>redis</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hiredis-client</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>If your application doesn&#39;t call <code>Bundler.require</code>, you may have
to require it explicitly:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hiredis-client</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This makes the hiredis driver the default.</p>

<p>If you want to be certain hiredis is being used, when instantiating
the client object, specify hiredis:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redis'>redis</span> <span class='op'>=</span> <span class='const'><a href="Redis.html" title="Redis (class)">Redis</a></span>.<span class='id identifier rubyid_new'><a href="Redis.html#new-class_method" title="Redis.new (method)">new</a></span>(<span class='label'>driver:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_hiredis'>hiredis</span>)</code></pre>

<h2>Testing</h2>

<p>This library is tested against recent Ruby and Redis versions.
Check <a href="https://github.com/redis/redis-rb/actions">Github Actions</a> for the exact versions supported.</p>

<h2>See Also</h2>

<ul>
<li><a href="https://github.com/socketry/async-redis">async-redis</a> — An <a href="https://github.com/socketry/async">async</a> compatible Redis client.</li>
</ul>

<h2>Contributors</h2>

<p>Several people contributed to redis-rb, but we would like to especially
mention Ezra Zygmuntowicz. Ezra introduced the Ruby community to many
new cool technologies, like Redis. He wrote the first version of this
client and evangelized Redis in Rubyland. Thank you, Ezra.</p>

<h2>Contributing</h2>

<p><a href="https://github.com/redis/redis-rb">Fork the project</a> and send pull
requests.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>