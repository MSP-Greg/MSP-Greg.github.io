<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::ConnectionAdapters::QueryCache &mdash; Rails 6.1.7.7</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::ConnectionAdapters::QueryCache",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 6.1.7.7</a> &raquo; 
      <a href='../../_index.html#alpha_Q'>Index (Q)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a class='nodoc' href="../ConnectionAdapters.html" title="ActiveRecord::ConnectionAdapters (module)">ConnectionAdapters</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>QueryCache&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::ConnectionAdapters::QueryCache</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="QueryCache/ConnectionPoolConfiguration.html" title="ActiveRecord::ConnectionAdapters::QueryCache::ConnectionPoolConfiguration (module)"><code>ConnectionPoolConfiguration</code></a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L7'>activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#dirties_query_cache-class_method" title=".dirties_query_cache (class method)">.<strong>dirties_query_cache</strong>(base, *method_names)  </a>
    </span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#query_cache-instance_method" title="#query_cache (instance method)">#<strong>query_cache</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#query_cache_enabled-instance_method" title="#query_cache_enabled (instance method)">#<strong>query_cache_enabled</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#cache-instance_method" title="#cache (instance method)">#<strong>cache</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Enable the query cache within the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#clear_query_cache-instance_method" title="#clear_query_cache (instance method)">#<strong>clear_query_cache</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Clears the query cache.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#disable_query_cache!-instance_method" title="#disable_query_cache! (instance method)">#<strong>disable_query_cache!</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#enable_query_cache!-instance_method" title="#enable_query_cache! (instance method)">#<strong>enable_query_cache!</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#select_all-instance_method" title="#select_all (instance method)">#<strong>select_all</strong>(arel, name = nil, binds = [], preparable: nil)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uncached-instance_method" title="#uncached (instance method)">#<strong>uncached</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disable the query cache within the block.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="dirties_query_cache-class_method">
  <h3 class='signature  first'>
    .<strong>dirties_query_cache</strong>(base, *method_names)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L17-L26'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='26'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dirties_query_cache'>dirties_query_cache</span>(<span class='id identifier rubyid_base'>base</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_method_names'>method_names</span>)
  <span class='id identifier rubyid_method_names'>method_names</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method_name'>method_name</span><span class='op'>|</span>
    <span class='id identifier rubyid_base'>base</span>.<span class='id identifier rubyid_class_eval'>class_eval</span> <span class='heredoc_beg'>&lt;&lt;-end_code</span><span class='comma'>,</span> <span class='kw'>__FILE__</span><span class='comma'>,</span> <span class='kw'>__LINE__</span> <span class='op'>+</span> <span class='int'>1</span>
<span class='tstring_content'>      def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_name'>method_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>(*)
        ActiveRecord::Base.clear_query_caches_for_current_thread
        super
      end
</span><span class='heredoc_end'>    end_code
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="query_cache-instance_method">
  <h3 class='signature ro first'>
    #<strong>query_cache</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L50-L50'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='50'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_query_cache'>query_cache</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_query_cache_enabled'><a href="#query_cache_enabled-instance_method" title="ActiveRecord::ConnectionAdapters::QueryCache#query_cache_enabled (method)">query_cache_enabled</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="query_cache_enabled-instance_method">
  <h3 class='signature ro'>
    #<strong>query_cache_enabled</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L50-L50'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='50'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_query_cache'><a href="#query_cache-instance_method" title="ActiveRecord::ConnectionAdapters::QueryCache#query_cache (method)">query_cache</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_query_cache_enabled'>query_cache_enabled</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="cache-instance_method">
  <h3 class='signature  first'>
    #<strong>cache</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Enable the query cache within the block.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L59-L65'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='59' data-end='65'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 59</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache'>cache</span>
  <span class='id identifier rubyid_old'>old</span><span class='comma'>,</span> <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='ivar'>@query_cache_enabled</span><span class='comma'>,</span> <span class='kw'>true</span>
  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='id identifier rubyid_old'>old</span>
  <span class='id identifier rubyid_clear_query_cache'><a href="#clear_query_cache-instance_method" title="ActiveRecord::ConnectionAdapters::QueryCache#clear_query_cache (method)">clear_query_cache</a></span> <span class='kw'>unless</span> <span class='ivar'>@query_cache_enabled</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear_query_cache-instance_method">
  <h3 class='signature '>
    #<strong>clear_query_cache</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Clears the query cache.</p>

<p>One reason you may wish to call this method explicitly is between queries that ask the database to randomize results. Otherwise the cache would see the same SQL query and repeatedly return the same result each time, silently undermining the randomness you were expecting.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L90-L94'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='90' data-end='94'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 90</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_query_cache'>clear_query_cache</span>
  <span class='ivar'>@lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@query_cache</span>.<span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disable_query_cache!-instance_method">
  <h3 class='signature '>
    #<strong>disable_query_cache!</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L71-L74'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='74'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_disable_query_cache!'>disable_query_cache!</span>
  <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_clear_query_cache'><a href="#clear_query_cache-instance_method" title="ActiveRecord::ConnectionAdapters::QueryCache#clear_query_cache (method)">clear_query_cache</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="enable_query_cache!-instance_method">
  <h3 class='signature '>
    #<strong>enable_query_cache!</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L67-L69'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='67' data-end='69'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 67</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_enable_query_cache!'>enable_query_cache!</span>
  <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="initialize-instance_method">
  <h3 class='signature '>
    #<strong>initialize</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L52-L56'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='52' data-end='56'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 52</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='op'>*</span>)
  <span class='kw'>super</span>
  <span class='ivar'>@query_cache</span>         <span class='op'>=</span> <span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>.<span class='id identifier rubyid_new'>new</span> { <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_sql'>sql</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span>[<span class='id identifier rubyid_sql'>sql</span>] <span class='op'>=</span> {} }
  <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="select_all-instance_method">
  <h3 class='signature '>
    #<strong>select_all</strong>(arel, name = nil, binds = [], preparable: nil)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L96-L105'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='96' data-end='105'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 96</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_select_all'>select_all</span>(<span class='id identifier rubyid_arel'>arel</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span> <span class='op'>=</span> []<span class='comma'>,</span> <span class='label'>preparable:</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='ivar'>@query_cache_enabled</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_locked?'>locked?</span>(<span class='id identifier rubyid_arel'>arel</span>)
    <span class='id identifier rubyid_arel'>arel</span> <span class='op'>=</span> <span class='id identifier rubyid_arel_from_relation'>arel_from_relation</span>(<span class='id identifier rubyid_arel'>arel</span>)
    <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='comma'>,</span> <span class='id identifier rubyid_preparable'>preparable</span> <span class='op'>=</span> <span class='id identifier rubyid_to_sql_and_binds'>to_sql_and_binds</span>(<span class='id identifier rubyid_arel'>arel</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='comma'>,</span> <span class='id identifier rubyid_preparable'>preparable</span>)

    <span class='id identifier rubyid_cache_sql'>cache_sql</span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span>) { <span class='kw'>super</span>(<span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='comma'>,</span> <span class='label'>preparable:</span> <span class='id identifier rubyid_preparable'>preparable</span>) }
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uncached-instance_method">
  <h3 class='signature '>
    #<strong>uncached</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Disable the query cache within the block.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb#L77-L82'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='77' data-end='82'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/query_cache.rb', line 77</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uncached'>uncached</span>
  <span class='id identifier rubyid_old'>old</span><span class='comma'>,</span> <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='ivar'>@query_cache_enabled</span><span class='comma'>,</span> <span class='kw'>false</span>
  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@query_cache_enabled</span> <span class='op'>=</span> <span class='id identifier rubyid_old'>old</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>