<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Action Pack CHANGELOG &mdash; Rails 6.1.7.10</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "action_pack_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 6.1.7.10</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Action Pack CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h2>Rails 6.1.7.10 (October 23, 2024)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.7.9 (October 15, 2024)</h2>

<ul>
<li><p>Avoid regex backtracking in HTTP Token authentication</p>

<p>[CVE-2024-47887]</p></li>
<li><p>Avoid regex backtracking in query parameter filtering</p>

<p>[CVE-2024-41128]</p></li>
</ul>

<h2>Rails 6.1.7.8 (June 04, 2024)</h2>

<ul>
<li>  Include the HTTP Permissions-Policy on non-HTML Content-Types
[CVE-2024-28103]</li>
</ul>

<h2>Rails 6.1.7.7 (February 21, 2024)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.7.6 (August 22, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.7.5 (August 22, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.7.4 (June 26, 2023)</h2>

<ul>
<li><p>Raise an exception if illegal characters are provide to redirect_to
[CVE-2023-28362]</p>

<p><em>Zack Deveau</em></p></li>
</ul>

<h2>Rails 6.1.7.3 (March 13, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.7.2 (January 24, 2023)</h2>

<ul>
<li><p>Fix <code>domain: :all</code> for two letter TLD</p>

<p>This fixes a compatibility issue introduced in our previous security
release when using <code>domain: :all</code> with a two letter but single level top
level domain domain (like <code>.ca</code>, rather than <code>.co.uk</code>).</p></li>
</ul>

<h2>Rails 6.1.7.1 (January 17, 2023)</h2>

<ul>
<li><p>Avoid regex backtracking on If-None-Match header</p>

<p>[CVE-2023-22795]</p></li>
<li><p>Use string#split instead of regex for domain parts</p>

<p>[CVE-2023-22792]</p></li>
</ul>

<h2>Rails 6.1.7 (September 09, 2022)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.6.1 (July 12, 2022)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.6 (May 09, 2022)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.5.1 (April 26, 2022)</h2>

<ul>
<li><p>Allow Content Security Policy DSL to generate for API responses.</p>

<p><em>Tim Wade</em></p></li>
</ul>

<h2>Rails 6.1.5 (March 09, 2022)</h2>

<ul>
<li><p>Fix <code>content_security_policy</code> returning invalid directives.</p>

<p>Directives such as <code>self</code>, <code>unsafe-eval</code> and few others were not
single quoted when the directive was the result of calling a lambda
returning an array.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
  <span class='id identifier rubyid_policy'>policy</span>.<span class='id identifier rubyid_frame_ancestors'>frame_ancestors</span> <span class='id identifier rubyid_lambda'>lambda</span> { [<span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://example.com</span><span class='tstring_end'>&quot;</span></span>] }
<span class='kw'>end</span></code></pre>

<p>With this fix the policy generated from above will now be valid.</p>

<p><em>Edouard Chin</em></p></li>
<li><p>Update <code>HostAuthorization</code> middleware to render debug info only
when <code>config.consider_all_requests_local</code> is set to true.</p>

<p>Also, blocked host info is always logged with level <code>error</code>.</p>

<p>Fixes #42813.</p>

<p><em>Nikita Vyrko</em></p></li>
<li><p>Dup arrays that get &quot;converted&quot;.</p>

<p>Fixes #43681.</p>

<p><em>Aaron Patterson</em></p></li>
<li><p>Don&#39;t show deprecation warning for equal paths.</p>

<p><em>Anton Rieder</em></p></li>
<li><p>Fix crash in <a href="ActionController/Instrumentation.html" title="ActionController::Instrumentation (module)"><code>::ActionController::Instrumentation</code></a> with invalid HTTP formats.</p>

<p>Fixes #43094.</p>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Add fallback host for SystemTestCase driven by RackTest.</p>

<p>Fixes #42780.</p>

<p><em>Petrik de Heus</em></p></li>
<li><p>Add more detail about what hosts are allowed.</p>

<p><em>Alex Ghiculescu</em></p></li>
</ul>

<h2>Rails 6.1.4.7 (March 08, 2022)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.4.6 (February 11, 2022)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.4.5 (February 11, 2022)</h2>

<ul>
<li><p>Under certain circumstances, the middleware isn&#39;t informed that the
response body has been fully closed which result in request state not
being fully reset before the next request</p>

<p>[CVE-2022-23633]</p></li>
</ul>

<h2>Rails 6.1.4.4 (December 15, 2021)</h2>

<ul>
<li>  Fix issue with host protection not allowing host with port in development.</li>
</ul>

<h2>Rails 6.1.4.3 (December 14, 2021)</h2>

<ul>
<li>   Fix issue with host protection not allowing localhost in development.</li>
</ul>

<h2>Rails 6.1.4.2 (December 14, 2021)</h2>

<ul>
<li>  Fix X_FORWARDED_HOST protection.  [CVE-2021-44528]</li>
</ul>

<h2>Rails 6.1.4.1 (August 19, 2021)</h2>

<ul>
<li><p>[CVE-2021-22942] Fix possible open redirect in Host Authorization middleware.</p>

<p>Specially crafted &quot;X-Forwarded-Host&quot; headers in combination with certain
&quot;allowed host&quot; formats can cause the Host Authorization middleware in Action
Pack to redirect users to a malicious website.</p></li>
</ul>

<h2>Rails 6.1.4 (June 24, 2021)</h2>

<ul>
<li><p>Ignore file fixtures on <code>db:fixtures:load</code></p>

<p><em>Kevin Sjöberg</em></p></li>
<li><p>Fix ActionController::Live controller test deadlocks by removing the body buffer size limit for tests.</p>

<p><em>Dylan Thacker-Smith</em></p></li>
<li><p>Correctly place optional path parameter booleans.</p>

<p>Previously, if you specify a url parameter that is part of the path as false it would include that part
of the path as parameter for example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(/optional/:optional_id)/things</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo#foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>as:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_things'>things</span>
<span class='id identifier rubyid_things_path'>things_path</span>(<span class='label'>optional_id:</span> <span class='kw'>false</span>) <span class='comment'># =&gt; /things?optional_id=false</span></code></pre>

<p>After this change, true and false will be treated the same when used as optional path parameters. Meaning now:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>(this/:my_bool)/that</span><span class='tstring_end'>&#39;</span></span> <span class='id identifier rubyid_as'>as</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_that'>that</span>

<span class='id identifier rubyid_that_path'>that_path</span>(<span class='label'>my_bool:</span> <span class='kw'>true</span>) <span class='comment'># =&gt; `/this/true/that`
</span><span class='id identifier rubyid_that_path'>that_path</span>(<span class='label'>my_bool:</span> <span class='kw'>false</span>) <span class='comment'># =&gt; `/this/false/that`</span></code></pre>

<p><em>Adam Hess</em></p></li>
<li><p>Add support for &#39;private, no-store&#39; Cache-Control headers.</p>

<p>Previously, &#39;no-store&#39; was exclusive; no other directives could be specified.</p>

<p><em>Alex Smith</em></p></li>
</ul>

<h2>Rails 6.1.3.2 (May 05, 2021)</h2>

<ul>
<li><p>Prevent open redirects by correctly escaping the host allow list
CVE-2021-22903</p></li>
<li><p>Prevent catastrophic backtracking during mime parsing
CVE-2021-22902</p></li>
<li><p>Prevent regex DoS in HTTP token authentication
CVE-2021-22904</p></li>
<li><p>Prevent string polymorphic route arguments.</p>

<p><code>url_for</code> supports building polymorphic URLs via an array
of arguments (usually symbols and records). If a developer passes a
user input array, strings can result in unwanted route helper calls.</p>

<p>CVE-2021-22885</p>

<p><em>Gannon McGibbon</em></p></li>
</ul>

<h2>Rails 6.1.3.1 (March 26, 2021)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 6.1.3 (February 17, 2021)</h2>

<ul>
<li><p>Re-define routes when not set correctly via inheritance.</p>

<p><em>John Hawthorn</em></p></li>
</ul>

<h2>Rails 6.1.2.1 (February 10, 2021)</h2>

<ul>
<li><p>Prevent open redirect when allowed host starts with a dot</p>

<p>[CVE-2021-22881]</p>

<p>Thanks to @tktech (<a href="https://hackerone.com/tktech">https://hackerone.com/tktech</a>) for reporting this
issue and the patch!</p>

<p><em>Aaron Patterson</em></p></li>
</ul>

<h2>Rails 6.1.2 (February 09, 2021)</h2>

<ul>
<li><p>Fix error in <a href="ActionController/LogSubscriber.html" title="ActionController::LogSubscriber (class)"><code>::ActionController::LogSubscriber</code></a> that would happen when throwing inside a controller action.</p>

<p><em>Janko Marohnić</em></p></li>
<li><p>Fix <code>fixture_file_upload</code> deprecation when <code>file_fixture_path</code> is a relative path.</p>

<p><em>Eugene Kenny</em></p></li>
</ul>

<h2>Rails 6.1.1 (January 07, 2021)</h2>

<ul>
<li><p>Fix nil translation key lookup in controllers/</p>

<p><em>Jan Klimo</em></p></li>
<li><p>Quietly handle unknown HTTP methods in Action Dispatch SSL middleware.</p>

<p><em>Alex Robbin</em></p></li>
<li><p>Change the request method to a <code>GET</code> when passing failed requests down to <code>config.exceptions_app</code>.</p>

<p><em>Alex Robbin</em></p></li>
</ul>

<h2>Rails 6.1.0 (December 09, 2020)</h2>

<ul>
<li><p>Support for the HTTP header <code>Feature-Policy</code> has been revised to reflect
its <a href="https://github.com/w3c/webappsec-permissions-policy/pull/379">rename</a> to <a href="https://w3c.github.io/webappsec-permissions-policy/#permissions-policy-http-header-field"><code>Permissions-Policy</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_permissions_policy'>permissions_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_camera'>camera</span>     <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_gyroscope'>gyroscope</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_microphone'>microphone</span> <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_usb'>usb</span>        <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_fullscreen'>fullscreen</span> <span class='symbeg'>:</span><span class='kw'>self</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_payment'>payment</span>    <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://secure-example.com</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p><em>Julien Grillot</em></p></li>
<li><p>Allow <a href="ActionDispatch/HostAuthorization.html" title="ActionDispatch::HostAuthorization (class)"><code>::ActionDispatch::HostAuthorization</code></a> to exclude specific requests.</p>

<p>Host Authorization checks can be skipped for specific requests. This allows for health check requests to be permitted for requests with missing or non-matching host headers.</p>

<p><em>Chris Bisnett</em></p></li>
<li><p>Add <code>config.action_dispatch.request_id_header</code> to allow changing the name of
the unique X-Request-Id header</p>

<p><em>Arlston Fernandes</em></p></li>
<li><p>Deprecate <code>config.action_dispatch.return_only_media_type_on_content_type</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Change <a href="ActionDispatch/Response.html#content_type-instance_method" title="ActionDispatch::Response#content_type (method)">ActionDispatch::Response#content_type</a> to return the full Content-Type header.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActionDispatch::Http::ParameterFilter</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Added support for exclusive no-store Cache-Control header.</p>

<p>If <code>no-store</code> is set on Cache-Control header it is exclusive (all other cache directives are dropped).</p>

<p><em>Chris Kruger</em></p></li>
<li><p>Catch invalid UTF-8 parameters for POST requests and respond with BadRequest.</p>

<p>Additionally, perform <code>#set_binary_encoding</code> in <code>ActionDispatch::Http::Request#GET</code> and
<code>ActionDispatch::Http::Request#POST</code> prior to validating encoding.</p>

<p><em>Adrianna Chang</em></p></li>
<li><p>Allow <code>assert_recognizes</code> routing assertions to work on mounted root routes.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Change default redirection status code for non-GET/HEAD requests to 308 Permanent Redirect for <a href="ActionDispatch/SSL.html" title="ActionDispatch::SSL (class)"><code>::ActionDispatch::SSL</code></a>.</p>

<p><em>Alan Tan</em>, <em>Oz Ben-David</em></p></li>
<li><p>Fix <code>follow_redirect!</code> to follow redirection with same HTTP verb when following
a 308 redirection.</p>

<p><em>Alan Tan</em></p></li>
<li><p>When multiple domains are specified for a cookie, a domain will now be
chosen only if it is equal to or is a superdomain of the request host.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p><a href="ActionDispatch/Static.html" title="ActionDispatch::Static (class)"><code>::ActionDispatch::Static</code></a> handles precompiled Brotli (.br) files.</p>

<p>Adds to existing support for precompiled gzip (.gz) files.
Brotli files are preferred due to much better compression.</p>

<p>When the browser requests /some.js with <code>Accept-Encoding: br</code>,
we check for public/some.js.br and serve that file, if present, with
<code>Content-Encoding: br</code> and <code>Vary: Accept-Encoding</code> headers.</p>

<p><em>Ryan Edward Hall</em>, <em>Jeremy Daer</em></p></li>
<li><p>Add raise_on_missing_translations support for controllers.</p>

<p>This configuration determines whether an error should be raised for missing translations.
It can be enabled through <code>config.i18n.raise_on_missing_translations</code>. Note that described
configuration also affects raising error for missing translations in views.</p>

<p><em>fatkodima</em></p></li>
<li><p>Added <code>compact</code> and <code>compact!</code> to <a href="ActionController/Parameters.html" title="ActionController::Parameters (class)"><code>::ActionController::Parameters</code></a>.</p>

<p><em>Eugene Kenny</em></p></li>
<li><p>Calling <code>each_pair</code> or <code>each_value</code> on an <a href="ActionController/Parameters.html" title="ActionController::Parameters (class)"><code>::ActionController::Parameters</code></a>
without passing a block now returns an enumerator.</p>

<p><em>Eugene Kenny</em></p></li>
<li><p><code>fixture_file_upload</code> now uses path relative to <code>file_fixture_path</code></p>

<p>Previously the path had to be relative to <code>fixture_path</code>.
You can change your existing code as follow:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='id identifier rubyid_fixture_file_upload'>fixture_file_upload</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>files/dog.png</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># After
</span><span class='id identifier rubyid_fixture_file_upload'>fixture_file_upload</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>dog.png</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p><em>Edouard Chin</em></p></li>
<li><p>Remove deprecated <code>force_ssl</code> at the controller level.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>The <code>helper</code> class method for controllers loads helper modules specified as
strings/symbols with <a href="String.html#constantize-instance_method" title="String#constantize (method)">String#constantize</a> instead of <code>require_dependency</code>.</p>

<p>Remember that support for strings/symbols is only a convenient API. You can
always pass a module object:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_helper'>helper</span> <span class='const'>UtilsHelper</span></code></pre>

<p>which is recommended because it is simple and direct. When a string/symbol
is received, <code>helper</code> just manipulates and inflects the argument to obtain
that same module object.</p>

<p><em>Xavier Noria</em>, <em>Jean Boussier</em></p></li>
<li><p>Correctly identify the entire localhost IPv4 range as trusted proxy.</p>

<p><em>Nick Soracco</em></p></li>
<li><p><code>url_for</code> will now use &quot;https://&quot; as the default protocol when
<code>Rails.application.config.force_ssl</code> is set to true.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Accept and default to base64_urlsafe CSRF tokens.</p>

<p>Base64 strict-encoded CSRF tokens are not inherently websafe, which makes
them difficult to deal with. For example, the common practice of sending
the CSRF token to a browser in a client-readable cookie does not work properly
out of the box: the value has to be url-encoded and decoded to survive transport.</p>

<p>Now, we generate Base64 urlsafe-encoded CSRF tokens, which are inherently safe
to transport. Validation accepts both urlsafe tokens, and strict-encoded tokens
for backwards compatibility.</p>

<p><em>Scott Blum</em></p></li>
<li><p>Support rolling deploys for cookie serialization/encryption changes.</p>

<p>In a distributed configuration like rolling update, users may observe
both old and new instances during deployment. Users may be served by a
new instance and then by an old instance.</p>

<p>That means when the server changes <code>cookies_serializer</code> from <code>:marshal</code>
to <code>:hybrid</code> or the server changes <code>use_authenticated_cookie_encryption</code>
from <code>false</code> to <code>true</code>, users may lose their sessions if they access the
server during deployment.</p>

<p>We added fallbacks to downgrade the cookie format when necessary during
deployment, ensuring compatibility on both old and new instances.</p>

<p><em>Masaki Hara</em></p></li>
<li><p><a href="ActionDispatch/Request.html#remote_ip-instance_method" title="ActionDispatch::Request#remote_ip (method)">ActionDispatch::Request#remote_ip</a> has ip address even when all sites are trusted.</p>

<p>Before, if all <code>X-Forwarded-For</code> sites were trusted, the <code>remote_ip</code> would default to <code>127.0.0.1</code>.
Now, the furthest proxy site is used. e.g.: It now gives an ip address when using curl from the load balancer.</p>

<p><em>Keenan Brock</em></p></li>
<li><p>Fix possible information leak / session hijacking vulnerability.</p>

<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the
gem dalli to be updated as well.</p>

<p>CVE-2019-16782.</p></li>
<li><p>Include child session assertion count in <a href="ActionDispatch/IntegrationTest.html" title="ActionDispatch::IntegrationTest (class)"><code>::ActionDispatch::IntegrationTest</code></a>.</p>

<p><code>IntegrationTest#open_session</code> uses <code>dup</code> to create the new session, which
meant it had its own copy of <code>@assertions</code>. This prevented the assertions
from being correctly counted and reported.</p>

<p>Child sessions now have their <code>attr_accessor</code> overridden to delegate to the
root session.</p>

<p>Fixes #32142.</p>

<p><em>Sam Bostock</em></p></li>
<li><p>Add SameSite protection to every written cookie.</p>

<p>Enabling <code>SameSite</code> cookie protection is an addition to CSRF protection,
where cookies won&#39;t be sent by browsers in cross-site POST requests when set to <code>:lax</code>.</p>

<p><code>:strict</code> disables cookies being sent in cross-site GET or POST requests.</p>

<p>Passing <code>:none</code> disables this protection and is the same as previous versions albeit a <code>; SameSite=None</code> is appended to the cookie.</p>

<p>See upgrade instructions in config/initializers/new_framework_defaults_6_1.rb.</p>

<p>More info <a href="https://tools.ietf.org/html/draft-west-first-party-cookies-07">here</a></p>

<p><em>NB: Technically already possible as Rack supports SameSite protection, this is to ensure it&#39;s applied to all cookies</em></p>

<p><em>Cédric Fabianski</em></p></li>
<li><p>Bring back the feature that allows loading external route files from the router.</p>

<p>This feature existed back in 2012 but got reverted with the incentive that
<a href="https://github.com/rails/routing_concerns">https://github.com/rails/routing_concerns</a> was a better approach. Turned out
that this wasn&#39;t fully the case and loading external route files from the router
can be helpful for applications with a really large set of routes.
Without this feature, application needs to implement routes reloading
themselves and it&#39;s not straightforward.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config/routes.rb
</span>
<span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_draw'>draw</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_admin'>admin</span>)
<span class='kw'>end</span>

<span class='comment'># config/routes/admin.rb
</span>
<span class='id identifier rubyid_get'>get</span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo#bar</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p><em>Yehuda Katz</em>, <em>Edouard Chin</em></p></li>
<li><p>Fix system test driver option initialization for non-headless browsers.</p>

<p><em>glaszig</em></p></li>
<li><p><code>redirect_to.action_controller</code> notifications now include the <a href="ActionDispatch/Request.html" title="ActionDispatch::Request (class)"><code>::ActionDispatch::Request</code></a> in
their payloads as <code>:request</code>.</p>

<p><em>Austin Story</em></p></li>
<li><p><code>respond_to#any</code> no longer returns a response&#39;s Content-Type based on the
request format but based on the block given.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_my_action'>my_action</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span>.<span class='id identifier rubyid_any'>any</span> { <span class='id identifier rubyid_render'>render</span>(<span class='label'>json:</span> { <span class='label'>foo:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span> }) }
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my_action.csv</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>The previous behaviour was to respond with a <code>text/csv</code> Content-Type which
is inaccurate since a JSON response is being rendered.</p>

<p>Now it correctly returns a <code>application/json</code> Content-Type.</p>

<p><em>Edouard Chin</em></p></li>
<li><p>Replaces (back)slashes in failure screenshot image paths with dashes.</p>

<p>If a failed test case contained a slash or a backslash, a screenshot would be created in a
nested directory, causing issues with <code>tmp:clear</code>.</p>

<p><em>Damir Zekic</em></p></li>
<li><p>Add <code>params.member?</code> to mimic <a href="Hash.html" title="Hash (class)"><code>Hash</code></a> behavior.</p>

<p><em>Younes Serraj</em></p></li>
<li><p><code>process_action.action_controller</code> notifications now include the following in their payloads:</p>

<ul>
<li><code>:request</code> - the <a href="ActionDispatch/Request.html" title="ActionDispatch::Request (class)"><code>::ActionDispatch::Request</code></a></li>
<li><code>:response</code> - the <a href="ActionDispatch/Response.html" title="ActionDispatch::Response (class)"><code>::ActionDispatch::Response</code></a></li>
</ul>

<p><em>George Claghorn</em></p></li>
<li><p>Updated <a href="ActionDispatch/Request.html#remote_ip-instance_method" title="ActionDispatch::Request#remote_ip (method)">ActionDispatch::Request#remote_ip</a> setter to clear set the instance
<code>remote_ip</code> to <code>nil</code> before setting the header that the value is derived
from.</p>

<p>Fixes #37383.</p>

<p><em>Norm Provost</em></p></li>
<li><p><code>ActionController::Base.log_at</code> allows setting a different log level per request.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Use the debug level if a particular cookie is set.
</span><span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_log_at'>log_at</span> <span class='symbeg'>:</span><span class='id identifier rubyid_debug'>debug</span><span class='comma'>,</span> <span class='label'>if:</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_cookies'>cookies</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_debug'>debug</span>] }
<span class='kw'>end</span></code></pre>

<p><em>George Claghorn</em></p></li>
<li><p>Allow system test screen shots to be taken more than once in
a test by prefixing the file name with an incrementing counter.</p>

<p>Add an environment variable <code>RAILS_SYSTEM_TESTING_SCREENSHOT_HTML</code> to
enable saving of HTML during a screenshot in addition to the image.
This uses the same image name, with the extension replaced with <code>.html</code></p>

<p><em>Tom Fakes</em></p></li>
<li><p>Add <code>Vary: Accept</code> header when using <code>Accept</code> header for response.</p>

<p>For some requests like <code>/users/1</code>, Rails uses requests&#39; <code>Accept</code>
header to determine what to return. And if we don&#39;t add <code>Vary</code>
in the response header, browsers might accidentally cache different
types of content, which would cause issues: e.g. javascript got displayed
instead of html content. This PR fixes these issues by adding <code>Vary: Accept</code>
in these types of requests. For more detailed problem description, please read:</p>

<p><a href="https://github.com/rails/rails/pull/36213">https://github.com/rails/rails/pull/36213</a></p>

<p>Fixes #25842.</p>

<p><em>Stan Lo</em></p></li>
<li><p>Fix IntegrationTest <code>follow_redirect!</code> to follow redirection using the same HTTP verb when following
a 307 redirection.</p>

<p><em>Edouard Chin</em></p></li>
<li><p>System tests require Capybara 3.26 or newer.</p>

<p><em>George Claghorn</em></p></li>
<li><p>Reduced log noise handling ActionController::RoutingErrors.</p>

<p><em>Alberto Fernández-Capel</em></p></li>
<li><p>Add DSL for configuring HTTP Feature Policy.</p>

<p>This new DSL provides a way to configure an HTTP Feature Policy at a
global or per-controller level. Full details of HTTP Feature Policy
specification and guidelines can be found at MDN:</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy</a></p>

<p>Example global policy:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_feature_policy'>feature_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_camera'>camera</span>      <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_gyroscope'>gyroscope</span>   <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_microphone'>microphone</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_usb'>usb</span>         <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_fullscreen'>fullscreen</span>  <span class='symbeg'>:</span><span class='kw'>self</span>
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_payment'>payment</span>     <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://secure.example.com</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Example controller level policy:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>PagesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_feature_policy'>feature_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
    <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_geolocation'>geolocation</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://example.com</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Jacob Bednarz</em></p></li>
<li><p>Add the ability to set the CSP nonce only to the specified directives.</p>

<p>Fixes #35137.</p>

<p><em>Yuji Yaginuma</em></p></li>
<li><p>Keep part when scope option has value.</p>

<p>When a route was defined within an optional scope, if that route didn&#39;t
take parameters the scope was lost when using path helpers. This commit
ensures scope is kept both when the route takes parameters or when it
doesn&#39;t.</p>

<p>Fixes #33219.</p>

<p><em>Alberto Almagro</em></p></li>
<li><p>Added <code>deep_transform_keys</code> and <code>deep_transform_keys!</code> methods to <a href="ActionController/Parameters.html" title="ActionController::Parameters (class)"><code>::ActionController::Parameters</code></a>.</p>

<p><em>Gustavo Gutierrez</em></p></li>
<li><p>Calling <a href="ActionController/Parameters.html#transform_keys-instance_method" title="ActionController::Parameters#transform_keys (method)">ActionController::Parameters#transform_keys</a>/<code>!</code> without a block now returns
an enumerator for the parameters instead of the underlying hash.</p>

<p><em>Eugene Kenny</em></p></li>
<li><p>Fix strong parameters blocks all attributes even when only some keys are invalid (non-numerical).
It should only block invalid key&#39;s values instead.</p>

<p><em>Stan Lo</em></p></li>
</ul>

<p>Please check [6-0-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>