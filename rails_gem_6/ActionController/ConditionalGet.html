<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::ConditionalGet &mdash; Rails 6.1.7.7</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionController::ConditionalGet",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails 6.1.7.7</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ConditionalGet&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionController::ConditionalGet</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="ConditionalGet/ClassMethods.html" title="ActionController::ConditionalGet::ClassMethods (module)"><code>ClassMethods</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="API.html" title="ActionController::API (class)"><code>API</code></a>,
          <a href="Base.html" title="ActionController::Base (class)"><code>Base</code></a>,
          <a href="EtagWithFlash.html" title="ActionController::EtagWithFlash (module)"><code>EtagWithFlash</code></a>,
          <a href="EtagWithTemplateDigest.html" title="ActionController::EtagWithTemplateDigest (module)"><code>EtagWithTemplateDigest</code></a>,
          <a href="../ActionView/TestCase/TestController.html" title="ActionView::TestCase::TestController (class)"><code>::ActionView::TestCase::TestController</code></a>,
          <span class='nodoc_h'>Rails::ApplicationController</span>,
          <span class='nodoc_h'>Rails::InfoController</span>,
          <span class='nodoc_h'>Rails::MailersController</span>,
          <span class='nodoc_h'>Rails::WelcomeController</span>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Head.html" title="ActionController::Head (module)"><code>Head</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L7'>actionpack/lib/action_controller/metal/conditional_get.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#expires_in-instance_method" title="#expires_in (instance method)">#<strong>expires_in</strong>(seconds, options = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets an HTTP 1.1 Cache-Control header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#expires_now-instance_method" title="#expires_now (instance method)">#<strong>expires_now</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets an HTTP 1.1 Cache-Control header of <code>no-cache</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fresh_when-instance_method" title="#fresh_when (instance method)">#<strong>fresh_when</strong>(object = nil, etag: nil, weak_etag: nil, strong_etag: nil, last_modified: nil, public: false, template: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the <code>etag</code>, <code>last_modified</code>, or both on the response and renders a <code>304 Not Modified</code> response if the request is already fresh.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#http_cache_forever-instance_method" title="#http_cache_forever (instance method)">#<strong>http_cache_forever</strong>(public: false)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cache or yield the block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stale%3F-instance_method" title="#stale? (instance method)">#<strong>stale?</strong>(object = nil, **freshness_kwargs)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the <code>etag</code> and/or <code>last_modified</code> on the response and checks it against the client request.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Head.html" title="ActionController::Head (module)"><code>Head</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Head.html#head-instance_method" title="ActionController::Head#head (method)">#head</a></td>
      <td><div class='inline'><p>Returns a response that has no content (merely headers).</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L12-L14'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


12
13
14</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 12</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_etaggers'>etaggers</span><span class='comma'>,</span> <span class='label'>default:</span> []
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="expires_in-instance_method">
  <h3 class='signature  first'>
    #<strong>expires_in</strong>(seconds, options = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets an HTTP 1.1 Cache-Control header. Defaults to issuing a <code>private</code> instruction, so that intermediate caches must not cache the response.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>20</span>.<span class='id identifier rubyid_minutes'>minutes</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>must_revalidate:</span> <span class='kw'>true</span></code></pre>

<p>This method will overwrite an existing Cache-Control header. See <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</a> for more possibilities.</p>

<p>HTTP Cache-Control Extensions for Stale Content. See <a href="https://tools.ietf.org/html/rfc5861">tools.ietf.org/html/rfc5861</a> It helps to cache an asset and serve it while is being revalidated and/or returning with an error.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>stale_while_revalidate:</span> <span class='int'>60</span>.<span class='id identifier rubyid_seconds'>seconds</span>
<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>stale_while_revalidate:</span> <span class='int'>60</span>.<span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='label'>stale_if_error:</span> <span class='int'>5</span>.<span class='id identifier rubyid_minutes'>minutes</span></code></pre>

<p>HTTP Cache-Control Extensions other values: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control</a> Any additional key-value pairs are concatenated onto the <code>Cache-Control</code> header in the response:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_expires_in'>expires_in</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s-maxage</span><span class='label_end'>&quot;:</span> <span class='int'>3</span>.<span class='id identifier rubyid_hours'>hours</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no-transform</span><span class='label_end'>&quot;:</span> <span class='kw'>true</span></code></pre>

<p>The method will also ensure an HTTP Date header for client compatibility.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L246-L258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='246' data-end='258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 246</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expires_in'>expires_in</span>(<span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_merge!'>merge!</span>(
    <span class='label'>max_age:</span> <span class='id identifier rubyid_seconds'>seconds</span><span class='comma'>,</span>
    <span class='label'>public:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span>)<span class='comma'>,</span>
    <span class='label'>must_revalidate:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_must_revalidate'>must_revalidate</span>)<span class='comma'>,</span>
    <span class='label'>stale_while_revalidate:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stale_while_revalidate'>stale_while_revalidate</span>)<span class='comma'>,</span>
    <span class='label'>stale_if_error:</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stale_if_error'>stale_if_error</span>)<span class='comma'>,</span>
  )
  <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_private'>private</span>)

  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_extras'>extras</span>] <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_date'>date</span> <span class='op'>=</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span> <span class='kw'>unless</span> <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_date?'>date?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="expires_now-instance_method">
  <h3 class='signature '>
    #<strong>expires_now</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets an HTTP 1.1 Cache-Control header of <code>no-cache</code>. This means the resource will be marked as stale, so clients must always revalidate. Intermediate/browser caches may still store the asset.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L263-L265'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='263' data-end='265'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 263</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expires_now'>expires_now</span>
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>.<span class='id identifier rubyid_replace'>replace</span>(<span class='label'>no_cache:</span> <span class='kw'>true</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fresh_when-instance_method">
  <h3 class='signature '>
    #<strong>fresh_when</strong>(object = nil, etag: nil, weak_etag: nil, strong_etag: nil, last_modified: nil, public: false, template: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the <code>etag</code>, <code>last_modified</code>, or both on the response and renders a <code>304 Not Modified</code> response if the request is already fresh.</p>

<h4 id="label-Parameters-3A">Parameters:</h4>
<ul><li>
<p><code>:etag</code> Sets a “weak” ETag validator on the response. See the <code>:weak_etag</code> option.</p>
</li><li>
<p><code>:weak_etag</code> Sets a “weak” ETag validator on the response. Requests that set If-None-Match header may return a 304 Not Modified response if it matches the ETag exactly. A weak ETag indicates semantic equivalence, not byte-for-byte equality, so they’re good for caching HTML pages in browser caches. They can’t be used for responses that must be byte-identical, like serving Range requests within a PDF file.</p>
</li><li>
<p><code>:strong_etag</code> Sets a “strong” ETag validator on the response. Requests that set If-None-Match header may return a 304 Not Modified response if it matches the ETag exactly. A strong ETag implies exact equality: the response must match byte for byte. This is necessary for doing Range requests within a large video or PDF file, for example, or for compatibility with some CDNs that don’t support weak ETags.</p>
</li><li>
<p><code>:last_modified</code> Sets a “weak” last-update validator on the response. Subsequent requests that set If-Modified-Since may return a 304 Not Modified response if last_modified &lt;= If-Modified-Since.</p>
</li><li>
<p><code>:public</code> By default the Cache-Control header is private, set this to <code>true</code> if you want your application to be cacheable by other devices (proxy caches).</p>
</li><li>
<p><code>:template</code> By default, the template digest for the current controller/action is included in ETags. If the action renders a different template, you can include its digest instead. If the action doesn’t render a template at all, you can pass <code>template: false</code> to skip any attempt to check for a template digest.</p>
</li></ul>

<h4 id="label-Example-3A">Example:</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='label'>etag:</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>last_modified:</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_updated_at'>updated_at</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span>)
<span class='kw'>end</span></code></pre>

<p>This will render the show template if the request isn’t sending a matching ETag or If-Modified-Since header and just a <code>304 Not Modified</code> response if there’s a match.</p>

<p>You can also just pass a record. In this case <code>last_modified</code> will be set by calling <code>updated_at</code> and <code>etag</code> by passing the object itself.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='ivar'>@article</span>)
<span class='kw'>end</span></code></pre>

<p>You can also pass an object that responds to <code>maximum</code>, such as a collection of active records. In this case <code>last_modified</code> will be set by calling <code>maximum(:updated_at)</code> on the collection (the timestamp of the most recently updated record) and the <code>etag</code> by passing the object itself.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='ivar'>@articles</span>)
<span class='kw'>end</span></code></pre>

<p>When passing a record or a collection, you can still set the public header:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])
  <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span>)
<span class='kw'>end</span></code></pre>

<p>When rendering a different template than the default controller/action style, you can indicate which digest to include in the ETag:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before_action'>before_action</span> { <span class='id identifier rubyid_fresh_when'>fresh_when</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>widgets/show</span><span class='tstring_end'>&#39;</span></span> }</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L106-L122'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='106' data-end='122'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 106</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fresh_when'>fresh_when</span>(<span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>etag:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>weak_etag:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>strong_etag:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>last_modified:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_weak_etag'>weak_etag</span> <span class='op'>||=</span> <span class='id identifier rubyid_etag'>etag</span> <span class='op'>||</span> <span class='id identifier rubyid_object'>object</span> <span class='kw'>unless</span> <span class='id identifier rubyid_strong_etag'>strong_etag</span>
  <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>||=</span> <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_updated_at'>updated_at</span>) <span class='op'>||</span> <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_try'>try</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_maximum'>maximum</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_updated_at'>updated_at</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_strong_etag'>strong_etag</span>
    <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_strong_etag'>strong_etag</span> <span class='op'>=</span> <span class='id identifier rubyid_combine_etags'>combine_etags</span> <span class='id identifier rubyid_strong_etag'>strong_etag</span><span class='comma'>,</span>
      <span class='label'>last_modified:</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='id identifier rubyid_template'>template</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_weak_etag'>weak_etag</span> <span class='op'>||</span> <span class='id identifier rubyid_template'>template</span>
    <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_weak_etag'>weak_etag</span> <span class='op'>=</span> <span class='id identifier rubyid_combine_etags'>combine_etags</span> <span class='id identifier rubyid_weak_etag'>weak_etag</span><span class='comma'>,</span>
      <span class='label'>last_modified:</span> <span class='id identifier rubyid_last_modified'>last_modified</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='id identifier rubyid_template'>template</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_last_modified'>last_modified</span> <span class='op'>=</span> <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='kw'>if</span> <span class='id identifier rubyid_last_modified'>last_modified</span>
  <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_cache_control'>cache_control</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span>] <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_public'>public</span>

  <span class='id identifier rubyid_head'>head</span> <span class='symbeg'>:</span><span class='id identifier rubyid_not_modified'>not_modified</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fresh?'>fresh?</span>(<span class='id identifier rubyid_response'>response</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="http_cache_forever-instance_method">
  <h3 class='signature '>
    #<strong>http_cache_forever</strong>(public: false)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cache or yield the block. The cache is supposed to never expire.</p>

<p>You can use this method when you have an HTTP response that never changes, and the browser and proxies should cache it indefinitely.</p>
<ul><li>
<p><code>public</code>: By default, HTTP responses are private, cached only on the user’s web browser. To allow proxies to cache the response, set <code>true</code> to indicate that they can serve the cached response to all users.</p>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L275-L281'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='275' data-end='281'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 275</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_http_cache_forever'>http_cache_forever</span>(<span class='label'>public:</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_expires_in'><a href="#expires_in-instance_method" title="ActionController::ConditionalGet#expires_in (method)">expires_in</a></span> <span class='int'>100</span>.<span class='id identifier rubyid_years'>years</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span>

  <span class='kw'>yield</span> <span class='kw'>if</span> <span class='id identifier rubyid_stale?'><a href="#stale%3F-instance_method" title="ActionController::ConditionalGet#stale? (method)">stale?</a></span>(<span class='label'>etag:</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fullpath'>fullpath</span><span class='comma'>,</span>
                  <span class='label'>last_modified:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2011</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_utc'>utc</span><span class='comma'>,</span>
                  <span class='label'>public:</span> <span class='id identifier rubyid_public'>public</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stale?-instance_method">
  <h3 class='signature '>
    #<strong>stale?</strong>(object = nil, **freshness_kwargs)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the <code>etag</code> and/or <code>last_modified</code> on the response and checks it against the client request. If the request doesn’t match the options provided, the request is considered stale and should be generated from scratch. Otherwise, it’s fresh and we don’t need to generate anything and a reply of <code>304 Not Modified</code> is sent.</p>

<h4 id="label-Parameters-3A">Parameters:</h4>
<ul><li>
<p><code>:etag</code> Sets a “weak” ETag validator on the response. See the <code>:weak_etag</code> option.</p>
</li><li>
<p><code>:weak_etag</code> Sets a “weak” ETag validator on the response. Requests that set If-None-Match header may return a 304 Not Modified response if it matches the ETag exactly. A weak ETag indicates semantic equivalence, not byte-for-byte equality, so they’re good for caching HTML pages in browser caches. They can’t be used for responses that must be byte-identical, like serving Range requests within a PDF file.</p>
</li><li>
<p><code>:strong_etag</code> Sets a “strong” ETag validator on the response. Requests that set If-None-Match header may return a 304 Not Modified response if it matches the ETag exactly. A strong ETag implies exact equality: the response must match byte for byte. This is necessary for doing Range requests within a large video or PDF file, for example, or for compatibility with some CDNs that don’t support weak ETags.</p>
</li><li>
<p><code>:last_modified</code> Sets a “weak” last-update validator on the response. Subsequent requests that set If-Modified-Since may return a 304 Not Modified response if last_modified &lt;= If-Modified-Since.</p>
</li><li>
<p><code>:public</code> By default the Cache-Control header is private, set this to <code>true</code> if you want your application to be cacheable by other devices (proxy caches).</p>
</li><li>
<p><code>:template</code> By default, the template digest for the current controller/action is included in ETags. If the action renders a different template, you can include its digest instead. If the action doesn’t render a template at all, you can pass <code>template: false</code> to skip any attempt to check for a template digest.</p>
</li></ul>

<h4 id="label-Example-3A">Example:</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='label'>etag:</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>last_modified:</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_updated_at'>updated_at</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You can also just pass a record. In this case <code>last_modified</code> will be set by calling <code>updated_at</code> and <code>etag</code> by passing the object itself.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@article</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You can also pass an object that responds to <code>maximum</code>, such as a collection of active records. In this case <code>last_modified</code> will be set by calling <code>maximum(:updated_at)</code> on the collection (the timestamp of the most recently updated record) and the <code>etag</code> by passing the object itself.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@articles</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@articles</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@articles</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>When passing a record or a collection, you can still set the public header:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>public:</span> <span class='kw'>true</span>)
    <span class='ivar'>@statistics</span> <span class='op'>=</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_really_expensive_call'>really_expensive_call</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># all the supported formats
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>When rendering a different template than the default controller/action style, you can indicate which digest to include in the ETag:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='kw'>super</span> <span class='kw'>if</span> <span class='id identifier rubyid_stale?'>stale?</span> <span class='ivar'>@article</span><span class='comma'>,</span> <span class='label'>template:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>widgets/show</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v6.1.7.7/actionpack/lib/action_controller/metal/conditional_get.rb#L219-L222'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='219' data-end='222'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/conditional_get.rb', line 219</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stale?'>stale?</span>(<span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_freshness_kwargs'>freshness_kwargs</span>)
  <span class='id identifier rubyid_fresh_when'><a href="#fresh_when-instance_method" title="ActionController::ConditionalGet#fresh_when (method)">fresh_when</a></span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_freshness_kwargs'>freshness_kwargs</span>)
  <span class='op'>!</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fresh?'>fresh?</span>(<span class='id identifier rubyid_response'>response</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>