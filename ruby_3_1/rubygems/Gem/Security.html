<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Gem::Security &mdash; rubygems  Ruby-3.1.7 p261</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Gem::Security",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.1.7</a> &raquo; 
      <a href='../'>rubygems</a> &raquo; 
      <a href='../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../Gem.html" title="Gem (module)">Gem</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Security&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Gem::Security</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Security/Policy.html" title="Gem::Security::Policy (class)"><code>Policy</code></a>,
        <a href="Security/Signer.html" title="Gem::Security::Signer (class)"><code>Signer</code></a>,
        <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)"><code>TrustDir</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="Security/Exception.html" title="Gem::Security::Exception (class)"><code>Exception</code></a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L327'>lib/rubygems/security.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security_option.rb#L12'>lib/rubygems/security_option.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/commands/unpack_command.rb#L10'>lib/rubygems/commands/unpack_command.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L2'>lib/rubygems/security/policies.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Signing+gems">Signing gems</h3>

<p>The <code>Security</code> implements cryptographic signatures for gems.  The section below is a step-by-step guide to using signed gems and generating your own.</p>

<h4 id="label-Walkthrough">Walkthrough</h4>

<h5 id="label-Building+your+certificate">Building your certificate</h5>

<p>In order to start signing your gems, you’ll need to build a private key and a self-signed certificate.  Here’s how:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># build a private key and certificate for yourself:
</span><span class='gvar'>$ </span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_cert'>cert</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_you'>you</span><span class='ivar'>@example</span>.<span class='id identifier rubyid_com'>com</span></code></pre>

<p>This could take anywhere from a few seconds to a minute or two, depending on the speed of your computer (public key algorithms aren’t exactly the speediest crypto algorithms in the world).  When it’s finished, you’ll see the files “gem-private_key.pem” and “gem-public_cert.pem” in the current directory.</p>

<p>First things first: Move both files to ~/.gem if you don’t already have a key and certificate in that directory.  Ensure the file permissions make the key unreadable by others (by default the file is saved securely).</p>

<p>Keep your private key hidden; if it’s compromised, someone can sign packages as you (note: PKI has ways of mitigating the risk of stolen keys; more on that later).</p>

<h5 id="label-Signing+Gems">Signing Gems</h5>

<p>In RubyGems 2 and newer there is no extra work to sign a gem.  RubyGems will automatically find your key and certificate in your home directory and use them to sign newly packaged gems.</p>

<p>If your certificate is not self-signed (signed by a third party) RubyGems will attempt to load the certificate chain from the trusted certificates. Use <code>gem cert --add signing_cert.pem</code> to add your signers as trusted certificates.  See below for further information on certificate chains.</p>

<p>If you build your gem it will automatically be signed.  If you peek inside your gem file, you’ll see a couple of new files have been added:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_tar'>tar</span> <span class='id identifier rubyid_tf'>tf</span> <span class='id identifier rubyid_your'>your</span><span class='op'>-</span><span class='id identifier rubyid_gem'>gem</span><span class='op'>-</span><span class='float'>1.0</span>.<span class='id identifier rubyid_gem'>gem</span>
<span class='id identifier rubyid_metadata'>metadata</span>.<span class='id identifier rubyid_gz'>gz</span>
<span class='id identifier rubyid_metadata'>metadata</span>.<span class='id identifier rubyid_gz'>gz</span>.<span class='id identifier rubyid_sig'>sig</span> <span class='comment'># metadata signature
</span><span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_tar'>tar</span>.<span class='id identifier rubyid_gz'>gz</span>
<span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_tar'>tar</span>.<span class='id identifier rubyid_gz'>gz</span>.<span class='id identifier rubyid_sig'>sig</span> <span class='comment'># data signature
</span><span class='id identifier rubyid_checksums'>checksums</span>.<span class='id identifier rubyid_yaml'>yaml</span>.<span class='id identifier rubyid_gz'>gz</span>
<span class='id identifier rubyid_checksums'>checksums</span>.<span class='id identifier rubyid_yaml'>yaml</span>.<span class='id identifier rubyid_gz'>gz</span>.<span class='id identifier rubyid_sig'>sig</span> <span class='comment'># checksums signature</span></code></pre>

<h5 id="label-Manually+signing+gems">Manually signing gems</h5>

<p>If you wish to store your key in a separate secure location you’ll need to set your gems up for signing by hand.  To do this, set the <code>signing_key</code> and <code>cert_chain</code> in the gemspec before packaging your gem:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_signing_key'>signing_key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/secure/path/to/gem-private_key.pem</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_cert_chain'>cert_chain</span> <span class='op'>=</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>/secure/path/to/gem-public_cert.pem</span><span class='tstring_end'>]</span></span></code></pre>

<p>When you package your gem with these options set RubyGems will automatically load your key and certificate from the secure paths.</p>

<h5 id="label-Signed+gems+and+security+policies">Signed gems and security policies</h5>

<p>Now let’s verify the signature.  Go ahead and install the gem, but add the following options: <code>-P HighSecurity</code>, like this:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># install the gem with using the security policy &quot;HighSecurity&quot;
</span><span class='gvar'>$ </span><span class='id identifier rubyid_sudo'>sudo</span> <span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'><a href="../Gem.html#install-class_method" title="Gem.install (method)">install</a></span> <span class='id identifier rubyid_your'>your</span>.<span class='id identifier rubyid_gem'>gem</span> <span class='op'>-</span><span class='const'>P</span> <span class='const'><a href="#HighSecurity-constant" title="Gem::Security::HighSecurity (constant)">HighSecurity</a></span></code></pre>

<p>The <code>-P</code> option sets your security policy – we’ll talk about that in just a minute.  Eh, what’s this?</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'><a href="../Gem.html#install-class_method" title="Gem.install (method)">install</a></span> <span class='op'>-</span><span class='const'>P</span> <span class='const'><a href="#HighSecurity-constant" title="Gem::Security::HighSecurity (constant)">HighSecurity</a></span> <span class='id identifier rubyid_your'>your</span><span class='op'>-</span><span class='id identifier rubyid_gem'>gem</span><span class='op'>-</span><span class='float'>1.0</span>.<span class='id identifier rubyid_gem'>gem</span>
<span class='const'>ERROR</span><span class='op'>:</span>  <span class='const'>While</span> <span class='id identifier rubyid_executing'>executing</span> <span class='id identifier rubyid_gem'>gem</span> <span class='op'>...</span> (<span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a></span>)
    <span class='id identifier rubyid_root'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span> <span class='id identifier rubyid_cert'>cert</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>CN=you</span><span class='regexp_end'>/DC</span></span><span class='op'>=</span><span class='id identifier rubyid_example'>example</span> <span class='id identifier rubyid_is'>is</span> <span class='kw'>not</span> <span class='id identifier rubyid_trusted'>trusted</span></code></pre>

<p>The culprit here is the security policy.  RubyGems has several different security policies.  Let’s take a short break and go over the security policies.  Here’s a list of the available security policies, and a brief description of each one:</p>
<ul><li>
<p><a href="#NoSecurity-constant" title="Gem::Security::NoSecurity (constant)">NoSecurity</a> - Well, no security at all.  Signed packages are treated like unsigned packages.</p>
</li><li>
<p><a href="#LowSecurity-constant" title="Gem::Security::LowSecurity (constant)">LowSecurity</a> - Pretty much no security.  If a package is signed then RubyGems will make sure the signature matches the signing certificate, and that the signing certificate hasn’t expired, but that’s it.  A malicious user could easily circumvent this kind of security.</p>
</li><li>
<p><a href="#MediumSecurity-constant" title="Gem::Security::MediumSecurity (constant)">MediumSecurity</a> - Better than <a href="#LowSecurity-constant" title="Gem::Security::LowSecurity (constant)">LowSecurity</a> and <a href="#NoSecurity-constant" title="Gem::Security::NoSecurity (constant)">NoSecurity</a>, but still fallible.  Package contents are verified against the signing certificate, and the signing certificate is checked for validity, and checked against the rest of the certificate chain (if you don’t know what a certificate chain is, stay tuned, we’ll get to that). The biggest improvement over LowSecurity is that MediumSecurity won’t install packages that are signed by untrusted sources. Unfortunately, MediumSecurity still isn’t totally secure – a malicious user can still unpack the gem, strip the signatures, and distribute the gem unsigned.</p>
</li><li>
<p><a href="#HighSecurity-constant" title="Gem::Security::HighSecurity (constant)">HighSecurity</a> - Here’s the bugger that got us into this mess. The HighSecurity policy is identical to the MediumSecurity policy, except that it does not allow unsigned gems.  A malicious user doesn’t have a whole lot of options here; they can’t modify the package contents without invalidating the signature, and they can’t modify or remove signature or the signing certificate chain, or RubyGems will simply refuse to install the package.  Oh well, maybe they’ll have better luck causing problems for CPAN users instead :).</p>
</li></ul>

<p>The reason RubyGems refused to install your shiny new signed gem was because it was from an untrusted source.  Well, your code is infallible (naturally), so you need to add yourself as a trusted source:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># add trusted certificate
</span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_cert'>cert</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_add'>add</span> <span class='op'>~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.gem</span><span class='regexp_end'>/gem</span></span><span class='op'>-</span><span class='id identifier rubyid_public_cert'>public_cert</span>.<span class='id identifier rubyid_pem'>pem</span></code></pre>

<p>You’ve now added your public certificate as a trusted source.  Now you can install packages signed by your private key without any hassle.  Let’s try the install command above again:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># install the gem with using the HighSecurity policy (and this time
</span><span class='comment'># without any shenanigans)
</span><span class='gvar'>$ </span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'><a href="../Gem.html#install-class_method" title="Gem.install (method)">install</a></span> <span class='op'>-</span><span class='const'>P</span> <span class='const'><a href="#HighSecurity-constant" title="Gem::Security::HighSecurity (constant)">HighSecurity</a></span> <span class='id identifier rubyid_your'>your</span><span class='op'>-</span><span class='id identifier rubyid_gem'>gem</span><span class='op'>-</span><span class='float'>1.0</span>.<span class='id identifier rubyid_gem'>gem</span>
<span class='const'>Successfully</span> <span class='id identifier rubyid_installed'>installed</span> <span class='id identifier rubyid_your'>your</span><span class='op'>-</span><span class='id identifier rubyid_gem'>gem</span><span class='op'>-</span><span class='float'>1.0</span>
<span class='int'>1</span> <span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_installed'>installed</span></code></pre>

<p>This time RubyGems will accept your signed package and begin installing.</p>

<p>While you’re waiting for RubyGems to work it’s magic, have a look at some of the other security commands by running <code>gem help cert</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Options</span><span class='op'>:</span>
  <span class='op'>-</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_add'>add</span> <span class='const'>CERT</span>                   <span class='const'>Add</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_trusted'>trusted</span> <span class='id identifier rubyid_certificate'>certificate</span>.
  <span class='op'>-</span><span class='id identifier rubyid_l'>l</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_list'>list</span> [<span class='const'>FILTER</span>]              <span class='const'><a href="List.html" title="Gem::List (class)">List</a></span> <span class='id identifier rubyid_trusted'>trusted</span> <span class='id identifier rubyid_certificates'>certificates</span> <span class='id identifier rubyid_where'>where</span> <span class='id identifier rubyid_the'>the</span>
                                   <span class='id identifier rubyid_subject'>subject</span> <span class='id identifier rubyid_contains'>contains</span> <span class='const'>FILTER</span>
  <span class='op'>-</span><span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_remove'>remove</span> <span class='const'>FILTER</span>              <span class='const'>Remove</span> <span class='id identifier rubyid_trusted'>trusted</span> <span class='id identifier rubyid_certificates'>certificates</span> <span class='id identifier rubyid_where'>where</span> <span class='id identifier rubyid_the'>the</span>
                                   <span class='id identifier rubyid_subject'>subject</span> <span class='id identifier rubyid_contains'>contains</span> <span class='const'>FILTER</span>
  <span class='op'>-</span><span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_build'>build</span> <span class='const'>EMAIL_ADDR</span>           <span class='const'>Build</span> <span class='id identifier rubyid_private'>private</span> <span class='id identifier rubyid_key'>key</span> <span class='kw'>and</span> <span class='kw'>self</span><span class='op'>-</span><span class='id identifier rubyid_signed'>signed</span>
                                   <span class='id identifier rubyid_certificate'>certificate</span> <span class='kw'>for</span> <span class='const'>EMAIL_ADDR</span>
  <span class='op'>-</span><span class='const'>C</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_certificate'>certificate</span> <span class='const'>CERT</span>           <span class='const'>Signing</span> <span class='id identifier rubyid_certificate'>certificate</span> <span class='kw'>for</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_sign'><a href="#sign-class_method" title="Gem::Security.sign (method)">sign</a></span>
  <span class='op'>-</span><span class='const'>K</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_private'>private</span><span class='op'>-</span><span class='id identifier rubyid_key'>key</span> <span class='const'>KEY</span>            <span class='const'>Key</span> <span class='kw'>for</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_sign'><a href="#sign-class_method" title="Gem::Security.sign (method)">sign</a></span> <span class='kw'>or</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_build'>build</span>
  <span class='op'>-</span><span class='const'>A</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_key'>key</span><span class='op'>-</span><span class='id identifier rubyid_algorithm'>algorithm</span> <span class='const'>ALGORITHM</span>    <span class='const'>Select</span> <span class='id identifier rubyid_key'>key</span> <span class='id identifier rubyid_algorithm'>algorithm</span> <span class='kw'>for</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_from'>from</span> <span class='const'>RSA</span><span class='comma'>,</span> <span class='const'>DSA</span><span class='comma'>,</span> <span class='kw'>or</span> <span class='const'>EC</span>. <span class='const'>Defaults</span> <span class='id identifier rubyid_to'>to</span> <span class='const'>RSA</span>.
  <span class='op'>-</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_sign'><a href="#sign-class_method" title="Gem::Security.sign (method)">sign</a></span> <span class='const'>CERT</span>                  <span class='const'>Signs</span> <span class='const'>CERT</span> <span class='id identifier rubyid_with'>with</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_key'>key</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>-</span><span class='const'>K</span>
                                   <span class='kw'>and</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_certificate'>certificate</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>-</span><span class='const'>C</span>
  <span class='op'>-</span><span class='id identifier rubyid_d'>d</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_days'>days</span> <span class='const'>NUMBER_OF_DAYS</span>        <span class='const'>Days</span> <span class='id identifier rubyid_before'>before</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_certificate'>certificate</span> <span class='id identifier rubyid_expires'>expires</span>
  <span class='op'>-</span><span class='const'>R</span><span class='comma'>,</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_re'>re</span><span class='op'>-</span><span class='id identifier rubyid_sign'><a href="#sign-class_method" title="Gem::Security.sign (method)">sign</a></span>                    <span class='const'>Re</span><span class='op'>-</span><span class='id identifier rubyid_signs'>signs</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_certificate'>certificate</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>-</span><span class='const'>C</span> <span class='id identifier rubyid_with'>with</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_key'>key</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>-</span><span class='const'>K</span></code></pre>

<p>We’ve already covered the <code>--build</code> option, and the <code>--add</code>, <code>--list</code>, and <code>--remove</code> commands seem fairly straightforward; they allow you to add, list, and remove the certificates in your trusted certificate list.  But what’s with this <code>--sign</code> option?</p>

<h5 id="label-Certificate+chains">Certificate chains</h5>

<p>To answer that question, let’s take a look at “certificate chains”, a concept I mentioned earlier.  There are a couple of problems with self-signed certificates: first of all, self-signed certificates don’t offer a whole lot of security.  Sure, the certificate says Yukihiro Matsumoto, but how do I know it was actually generated and signed by matz himself unless he gave me the certificate in person?</p>

<p>The second problem is scalability.  Sure, if there are 50 gem authors, then I have 50 trusted certificates, no problem.  What if there are 500 gem authors?  1000?  Having to constantly add new trusted certificates is a pain, and it actually makes the trust system less secure by encouraging RubyGems users to blindly trust new certificates.</p>

<p>Here’s where certificate chains come in.  A certificate chain establishes an arbitrarily long chain of trust between an issuing certificate and a child certificate.  So instead of trusting certificates on a per-developer basis, we use the PKI concept of certificate chains to build a logical hierarchy of trust.  Here’s a hypothetical example of a trust hierarchy based (roughly) on geography:</p>

<pre class="code ruby"><code class="ruby">                    <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
                    <span class='op'>|</span> <span class='id identifier rubyid_rubygems'>rubygems</span><span class='ivar'>@rubygems</span>.<span class='id identifier rubyid_org'>org</span> <span class='op'>|</span>
                    <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
                                <span class='op'>|</span>
              <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
              <span class='op'>|</span>                                 <span class='op'>|</span>
  <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>    <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
  <span class='op'>|</span>  <span class='id identifier rubyid_seattlerb'>seattlerb</span><span class='ivar'>@seattlerb</span>.<span class='id identifier rubyid_org'>org</span> <span class='op'>|</span>    <span class='op'>|</span> <span class='id identifier rubyid_dcrubyists'>dcrubyists</span><span class='ivar'>@richkilmer</span>.<span class='id identifier rubyid_com'>com</span> <span class='op'>|</span>
  <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>    <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
       <span class='op'>|</span>                <span class='op'>|</span>                 <span class='op'>|</span>             <span class='op'>|</span>
<span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>   <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>   <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>   <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
<span class='op'>|</span>   <span class='id identifier rubyid_drbrain'>drbrain</span>   <span class='op'>|</span>   <span class='op'>|</span>   <span class='id identifier rubyid_zenspider'>zenspider</span>  <span class='op'>|</span>   <span class='op'>|</span> <span class='id identifier rubyid_pabs'>pabs</span><span class='ivar'>@dc</span> <span class='op'>|</span>   <span class='op'>|</span> <span class='id identifier rubyid_tomcope'>tomcope</span><span class='ivar'>@dc</span> <span class='op'>|</span>
<span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>   <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>   <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>   <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span></code></pre>

<p>Now, rather than having 4 trusted certificates (one for drbrain, zenspider, pabs@dc, and tomecope@dc), a user could actually get by with one certificate, the “rubygems@rubygems.org” certificate.</p>

<p>Here’s how it works:</p>

<p>I install “rdoc-3.12.gem”, a package signed by “drbrain”.  I’ve never heard of “drbrain”, but his certificate has a valid signature from the “seattle.rb@seattlerb.org” certificate, which in turn has a valid signature from the “rubygems@rubygems.org” certificate.  Voila!  At this point, it’s much more reasonable for me to trust a package signed by “drbrain”, because I can establish a chain to “rubygems@rubygems.org”, which I do trust.</p>

<h5 id="label-Signing+certificates">Signing certificates</h5>

<p>The <code>--sign</code> option allows all this to happen.  A developer creates their build certificate with the <code>--build</code> option, then has their certificate signed by taking it with them to their next regional Ruby meetup (in our hypothetical example), and it’s signed there by the person holding the regional RubyGems signing certificate, which is signed at the next RubyConf by the holder of the top-level RubyGems certificate.  At each point the issuer runs the same command:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># sign a certificate with the specified key and certificate
</span><span class='comment'># (note that this modifies client_cert.pem!)
</span><span class='gvar'>$ </span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_cert'>cert</span> <span class='op'>-</span><span class='const'>K</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>mnt</span><span class='regexp_end'>/floppy</span></span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>issuer-priv_key.pem -C issuer-pub_cert.pem
   --sign client_cert.pem</span></code></pre>

<p>Then the holder of issued certificate (in this case, your buddy “drbrain”), can start using this signed certificate to sign RubyGems.  By the way, in order to let everyone else know about his new fancy signed certificate, “drbrain” would save his newly signed certificate as <code>~/.gem/gem-public_cert.pem</code></p>

<p>Obviously this RubyGems trust infrastructure doesn’t exist yet.  Also, in the “real world”, issuers actually generate the child certificate from a certificate request, rather than sign an existing certificate.  And our hypothetical infrastructure is missing a certificate revocation system. These are that can be fixed in the future…</p>

<p>At this point you should know how to do all of these new and interesting things:</p>
<ul><li>
<p>build a gem signing key and certificate</p>
</li><li>
<p>adjust your security policy</p>
</li><li>
<p>modify your trusted certificate list</p>
</li><li>
<p>sign a certificate</p>
</li></ul>

<h4 id="label-Manually+verifying+signatures">Manually verifying signatures</h4>

<p>In case you don’t trust RubyGems you can verify gem signatures manually:</p>
<ol><li>
<p>Fetch and unpack the gem</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='id identifier rubyid_some_signed_gem'>some_signed_gem</span>
<span class='id identifier rubyid_tar'>tar</span> <span class='op'>-</span><span class='id identifier rubyid_xf'>xf</span> <span class='id identifier rubyid_some_signed_gem'>some_signed_gem</span><span class='op'>-</span><span class='float'>1.0</span>.<span class='id identifier rubyid_gem'>gem</span></code></pre>
</li><li>
<p>Grab the public key from the gemspec</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_spec'>spec</span> <span class='id identifier rubyid_some_signed_gem'>some_signed_gem</span><span class='op'>-</span><span class='float'>1.0</span>.<span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_cert_chain'>cert_chain</span> <span class='op'>|</span> \
  <span class='id identifier rubyid_ruby'><a href="../Gem.html#ruby-class_method" title="Gem.ruby (method)">ruby</a></span> <span class='op'>-</span><span class='id identifier rubyid_rpsych'>rpsych</span> <span class='op'>-</span><span class='id identifier rubyid_e'>e</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>puts Psych.load($stdin)</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&gt;</span> <span class='id identifier rubyid_public_key'>public_key</span>.<span class='id identifier rubyid_crt'>crt</span></code></pre>
</li><li>
<p>Generate a SHA1 hash of the data.tar.gz</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_dgst'>dgst</span> <span class='op'>-</span><span class='id identifier rubyid_sha1'>sha1</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_tar'>tar</span>.<span class='id identifier rubyid_gz'>gz</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_my'>my</span>.<span class='id identifier rubyid_hash'>hash</span></code></pre>
</li><li>
<p>Verify the signature</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_rsautl'>rsautl</span> <span class='op'>-</span><span class='id identifier rubyid_verify'>verify</span> <span class='op'>-</span><span class='id identifier rubyid_inkey'>inkey</span> <span class='id identifier rubyid_public_key'>public_key</span>.<span class='id identifier rubyid_crt'>crt</span> <span class='op'>-</span><span class='id identifier rubyid_certin'>certin</span> \
  <span class='op'>-</span><span class='kw'>in</span> <span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_tar'>tar</span>.<span class='id identifier rubyid_gz'>gz</span>.<span class='id identifier rubyid_sig'>sig</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_verified'>verified</span>.<span class='id identifier rubyid_hash'>hash</span></code></pre>
</li><li>
<p>Compare your hash to the verified hash</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_diff'>diff</span> <span class='op'>-</span><span class='id identifier rubyid_s'>s</span> <span class='id identifier rubyid_verified'>verified</span>.<span class='id identifier rubyid_hash'>hash</span> <span class='id identifier rubyid_my'>my</span>.<span class='id identifier rubyid_hash'>hash</span></code></pre>
</li><li>
<p>Repeat 5 and 6 with metadata.gz</p>
</li></ol>

<h4 id="label-OpenSSL+Reference">OpenSSL Reference</h4>

<p>The <code>.pem</code> files generated by –build and –sign are PEM files.  Here’s a couple of useful OpenSSL commands for manipulating them:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># convert a PEM format X509 certificate into DER format:
</span><span class='comment'># (note: Windows .cer files are X509 certificates in DER format)
</span><span class='gvar'>$ </span><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_x509'>x509</span> <span class='op'>-</span><span class='kw'>in</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_pem'>pem</span> <span class='op'>-</span><span class='id identifier rubyid_outform'>outform</span> <span class='id identifier rubyid_der'>der</span> <span class='op'>-</span><span class='id identifier rubyid_out'>out</span> <span class='id identifier rubyid_output'>output</span>.<span class='id identifier rubyid_der'>der</span>

<span class='comment'># print out the certificate in a human-readable format:
</span><span class='gvar'>$ </span><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_x509'>x509</span> <span class='op'>-</span><span class='kw'>in</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_pem'>pem</span> <span class='op'>-</span><span class='id identifier rubyid_noout'>noout</span> <span class='op'>-</span><span class='id identifier rubyid_text'>text</span></code></pre>

<p>And you can do the same thing with the private key file as well:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># convert a PEM format RSA key into DER format:
</span><span class='gvar'>$ </span><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_rsa'>rsa</span> <span class='op'>-</span><span class='kw'>in</span> <span class='id identifier rubyid_input_key'>input_key</span>.<span class='id identifier rubyid_pem'>pem</span> <span class='op'>-</span><span class='id identifier rubyid_outform'>outform</span> <span class='id identifier rubyid_der'>der</span> <span class='op'>-</span><span class='id identifier rubyid_out'>out</span> <span class='id identifier rubyid_output_key'>output_key</span>.<span class='id identifier rubyid_der'>der</span>

<span class='comment'># print out the key in a human readable format:
</span><span class='gvar'>$ </span><span class='id identifier rubyid_openssl'>openssl</span> <span class='id identifier rubyid_rsa'>rsa</span> <span class='op'>-</span><span class='kw'>in</span> <span class='id identifier rubyid_input_key'>input_key</span>.<span class='id identifier rubyid_pem'>pem</span> <span class='op'>-</span><span class='id identifier rubyid_noout'>noout</span> <span class='op'>-</span><span class='id identifier rubyid_text'>text</span></code></pre>

<h4 id="label-Bugs-2FTODO">Bugs/TODO</h4>
<ul><li>
<p>There’s no way to define a system-wide trust list.</p>
</li><li>
<p>custom security policies (from a YAML file, etc)</p>
</li><li>
<p>Simple method to generate a signed certificate request</p>
</li><li>
<p>Support for OCSP, SCVP, CRLs, or some other form of cert status check (list is in order of preference)</p>
</li><li>
<p>Support for encrypted private keys</p>
</li><li>
<p>Some sort of semi-formal trust hierarchy (see long-winded explanation above)</p>
</li><li>
<p>Path discovery (for gem certificate chains that don’t have a self-signed root) – by the way, since we don’t have this, THE ROOT OF THE CERTIFICATE CHAIN MUST BE SELF SIGNED if Policy#verify_root is true (and it is for the MediumSecurity and HighSecurity policies)</p>
</li><li>
<p>Better explanation of X509 naming (ie, we don’t have to use email addresses)</p>
</li><li>
<p>Honor AIA field (see note about OCSP above)</p>
</li><li>
<p>Honor extension restrictions</p>
</li><li>
<p>Might be better to store the certificate chain as a <code>PKCS#7</code> or <code>PKCS#12</code> file, instead of an array embedded in the metadata.</p>
</li></ul>

<h4 id="label-Original+author">Original author</h4>

<p>Paul Duncan &lt;pabs@pablotron.org&gt; <a href="http://pablotron.org">pablotron.org</a>/</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='AlmostNoSecurity-constant' class='summary_signature'>AlmostNoSecurity =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>AlmostNo security policy: only verify that the signing certificate is the one that actually signed the data.  Make no attempt to verify the signing certificate chain.</p>

<p>This policy is basically useless. better than nothing, but can still be easily spoofed, and is not recommended.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L25-L33'># File 'lib/rubygems/security/policies.rb', line 25</a>    <pre class='code ruby'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span>.<span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span>(
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Almost No Security</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_data'>verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_signer'>verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_chain'>verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_root'>verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_trusted'>only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_signed'>only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
)</pre>
  </li>
  <li>
    <span id='DEFAULT_KEY_ALGORITHM-constant' class='summary_signature'>DEFAULT_KEY_ALGORITHM =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Default algorithm to use when building a key pair</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L347-L347'># File 'lib/rubygems/security.rb', line 347</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RSA</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='DIGEST_NAME-constant' class='summary_signature nodoc'>DIGEST_NAME =</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Used internally to select the signing digest from all computed digests</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L337-L337'># File 'lib/rubygems/security.rb', line 337</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='EC_NAME-constant' class='summary_signature'>EC_NAME =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Named curve used for Elliptic Curve</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L352-L352'># File 'lib/rubygems/security.rb', line 352</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secp384r1</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='EXTENSIONS-constant' class='summary_signature'>EXTENSIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default set of extensions are:</p>
<ul><li>
<p>The certificate is not a certificate authority</p>
</li><li>
<p>The key for the certificate may be used for key and data encipherment and digital signatures</p>
</li><li>
<p>The certificate contains a subject key identifier</p>
</li></ul>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L378-L383'># File 'lib/rubygems/security.rb', line 378</a>    <pre class='code ruby'>{
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>basicConstraints</span><span class='tstring_end'>&quot;</span></span>     <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CA:FALSE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keyUsage</span><span class='tstring_end'>&quot;</span></span>             <span class='op'>=&gt;</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>keyEncipherment,dataEncipherment,digitalSignature</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subjectKeyIdentifier</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hash</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
}.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='HighSecurity-constant' class='summary_signature'>HighSecurity =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>High security policy: only allow signed gems to be installed, verify the signing certificate, verify the signing certificate chain all the way to the root certificate, and only trust root certificates that we have explicitly allowed trust for.</p>

<p>This security policy is significantly more difficult to bypass, and offers a reasonable guarantee that the contents of the gem have not been altered.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L80-L88'># File 'lib/rubygems/security/policies.rb', line 80</a>    <pre class='code ruby'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span>.<span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span>(
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>High Security</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_data'>verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_signer'>verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_chain'>verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_root'>verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_trusted'>only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_signed'>only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span>
)</pre>
  </li>
  <li>
    <span id='KEY_CIPHER-constant' class='summary_signature'>KEY_CIPHER =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Cipher used to encrypt the key pair used to sign gems. Must be in the list returned by <code>OpenSSL::Cipher.ciphers</code></p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L358-L358'># File 'lib/rubygems/security.rb', line 358</a>    <pre class='code ruby'><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AES-256-CBC</span><span class='tstring_end'>&quot;</span></span>)</pre>
  </li>
  <li>
    <span id='LowSecurity-constant' class='summary_signature'>LowSecurity =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Low security policy: only verify that the signing certificate is actually the gem signer, and that the signing certificate is valid.</p>

<p>This policy is better than nothing, but can still be easily spoofed, and is not recommended.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L42-L50'># File 'lib/rubygems/security/policies.rb', line 42</a>    <pre class='code ruby'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span>.<span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span>(
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Low Security</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_data'>verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_signer'>verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_chain'>verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_root'>verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_trusted'>only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_signed'>only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
)</pre>
  </li>
  <li>
    <span id='MediumSecurity-constant' class='summary_signature'>MediumSecurity =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Medium security policy: verify the signing certificate, verify the signing certificate chain all the way to the root certificate, and only trust root certificates that we have explicitly allowed trust for.</p>

<p>This security policy is reasonable, but it allows unsigned packages, so a malicious person could simply delete the package signature and pass the gem off as unsigned.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L61-L69'># File 'lib/rubygems/security/policies.rb', line 61</a>    <pre class='code ruby'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span>.<span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span>(
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Medium Security</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_data'>verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_signer'>verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_chain'>verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_root'>verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_trusted'>only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_signed'>only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
)</pre>
  </li>
  <li>
    <span id='NoSecurity-constant' class='summary_signature'>NoSecurity =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>No security policy: all package signature checks are disabled.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L7-L15'># File 'lib/rubygems/security/policies.rb', line 7</a>    <pre class='code ruby'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span>.<span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span>(
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No Security</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_data'>verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_signer'>verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_chain'>verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_root'>verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_trusted'>only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_signed'>only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
)</pre>
  </li>
  <li>
    <span id='ONE_DAY-constant' class='summary_signature'>ONE_DAY =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>One day in seconds</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L363-L363'># File 'lib/rubygems/security.rb', line 363</a>    <pre class='code ruby'><span class='int'>86400</span></pre>
  </li>
  <li>
    <span id='ONE_YEAR-constant' class='summary_signature'>ONE_YEAR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>One year in seconds</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L368-L368'># File 'lib/rubygems/security.rb', line 368</a>    <pre class='code ruby'><span class='const'><a href="#ONE_DAY-constant" title="Gem::Security::ONE_DAY (constant)">ONE_DAY</a></span> <span class='op'>*</span> <span class='int'>365</span></pre>
  </li>
  <li>
    <span id='Policies-constant' class='summary_signature'>Policies =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Hash of configured security policies</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L106-L113'># File 'lib/rubygems/security/policies.rb', line 106</a>    <pre class='code ruby'>{
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NoSecurity</span><span class='tstring_end'>&quot;</span></span>       <span class='op'>=&gt;</span> <span class='const'><a href="#NoSecurity-constant" title="Gem::Security::NoSecurity (constant)">NoSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AlmostNoSecurity</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'><a href="#AlmostNoSecurity-constant" title="Gem::Security::AlmostNoSecurity (constant)">AlmostNoSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LowSecurity</span><span class='tstring_end'>&quot;</span></span>      <span class='op'>=&gt;</span> <span class='const'><a href="#LowSecurity-constant" title="Gem::Security::LowSecurity (constant)">LowSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MediumSecurity</span><span class='tstring_end'>&quot;</span></span>   <span class='op'>=&gt;</span> <span class='const'><a href="#MediumSecurity-constant" title="Gem::Security::MediumSecurity (constant)">MediumSecurity</a></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HighSecurity</span><span class='tstring_end'>&quot;</span></span>     <span class='op'>=&gt;</span> <span class='const'><a href="#HighSecurity-constant" title="Gem::Security::HighSecurity (constant)">HighSecurity</a></span><span class='comma'>,</span>
  <span class='comment'># SigningPolicy is not intended for use by `gem -P` so do not list it
</span>}.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='RSA_DSA_KEY_LENGTH-constant' class='summary_signature'>RSA_DSA_KEY_LENGTH =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Length of keys created by RSA and DSA keys</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L342-L342'># File 'lib/rubygems/security.rb', line 342</a>    <pre class='code ruby'><span class='int'>3072</span></pre>
  </li>
  <li>
    <span id='SigningPolicy-constant' class='summary_signature'>SigningPolicy =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p><a href="Security/Policy.html" title="Gem::Security::Policy (class)"><code>Security::Policy</code></a> used to verify a certificate and key when signing a gem</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security/policies.rb#L93-L101'># File 'lib/rubygems/security/policies.rb', line 93</a>    <pre class='code ruby'><span class='const'><a href="Security/Policy.html" title="Gem::Security::Policy (class)">Policy</a></span>.<span class='id identifier rubyid_new'><a href="Security/Policy.html#new-class_method" title="Gem::Security::Policy.new (method)">new</a></span>(
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Signing Policy</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_data'>verify_data</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_signer'>verify_signer</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_chain'>verify_chain</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_verify_root'>verify_root</span>      <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_trusted'>only_trusted</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_only_signed'>only_signed</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span>
)</pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#alt_name_or_x509_entry-class_method" title=".alt_name_or_x509_entry (class method)">.<strong>alt_name_or_x509_entry</strong>(certificate, x509_entry)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_cert-class_method" title=".create_cert (class method)">.<strong>create_cert</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates an unsigned certificate for <code>subject</code> and <code>key</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_cert_email-class_method" title=".create_cert_email (class method)">.<strong>create_cert_email</strong>(email, key, age = ONE_YEAR, extensions = EXTENSIONS)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a self-signed certificate with an issuer and subject from <code>email</code>, a subject alternative name of <code>email</code> and the given <code>extensions</code> for the <code>key</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_cert_self_signed-class_method" title=".create_cert_self_signed (class method)">.<strong>create_cert_self_signed</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a self-signed certificate with an issuer and subject of <code>subject</code> and the given <code>extensions</code> for the <code>key</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_digest-class_method" title=".create_digest (class method)">.<strong>create_digest</strong>(algorithm = DIGEST_NAME)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>See additional method definition at line 472.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_key-class_method" title=".create_key (class method)">.<strong>create_key</strong>(algorithm)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new key pair of the specified <code>algorithm</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#email_to_name-class_method" title=".email_to_name (class method)">.<strong>email_to_name</strong>(email_address)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Turns <code>email_address</code> into an <code>OpenSSL::X509::Name</code></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#get_public_key-class_method" title=".get_public_key (class method)">.<strong>get_public_key</strong>(key)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Gets the right public key from a PKey instance.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#re_sign-class_method" title=".re_sign (class method)">.<strong>re_sign</strong>(expired_certificate, private_key, age = ONE_YEAR, extensions = EXTENSIONS)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Signs <code>expired_certificate</code> with <code>private_key</code> if the keys match and the expired certificate was self-signed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset-class_method" title=".reset (class method)">.<strong>reset</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Resets the trust directory for verifying gems.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sign-class_method" title=".sign (class method)">.<strong>sign</strong>(certificate, signing_key, signing_cert, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sign the public key from <code>certificate</code> with the <code>signing_key</code> and <code>signing_cert</code>, using the <a href="#DIGEST_NAME-constant" title="Gem::Security::DIGEST_NAME (constant)">DIGEST_NAME</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#trust_dir-class_method" title=".trust_dir (class method)">.<strong>trust_dir</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)"><code>TrustDir</code></a> which wraps the directory where trusted certificates live.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#trusted_certificates-class_method" title=".trusted_certificates (class method)">.<strong>trusted_certificates</strong>(&amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Enumerates the trusted certificates via <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)"><code>TrustDir</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#write-class_method" title=".write (class method)">.<strong>write</strong>(pemmable, path, permissions = 0600, passphrase = nil, cipher = KEY_CIPHER)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Writes <code>pemmable</code>, which must respond to <code>to_pem</code> to <a href="../Gem.html#path-class_method" title="Gem.path (method)">path</a> with the given <code>permissions</code>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="alt_name_or_x509_entry-class_method">
  <h3 class='signature  first'>
    .<strong>alt_name_or_x509_entry</strong>(certificate, x509_entry)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L385-L393'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='385' data-end='393'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 385</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_alt_name_or_x509_entry'>alt_name_or_x509_entry</span>(<span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_x509_entry'>x509_entry</span>)
  <span class='id identifier rubyid_alt_name'>alt_name</span> <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span>.<span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extension'>extension</span><span class='op'>|</span>
    <span class='id identifier rubyid_extension'>extension</span>.<span class='id identifier rubyid_oid'>oid</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x509_entry'>x509_entry</span><span class='embexpr_end'>}</span><span class='tstring_content'>AltName</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_alt_name'>alt_name</span>.<span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span> <span class='id identifier rubyid_alt_name'>alt_name</span>

  <span class='id identifier rubyid_certificate'>certificate</span>.<span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_x509_entry'>x509_entry</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_cert-class_method">
  <h3 class='signature '>
    .<strong>create_cert</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates an unsigned certificate for <code>subject</code> and <code>key</code>.  The lifetime of the key is from the current time to <code>age</code> which defaults to one year.</p>

<p>The <code>extensions</code> restrict the key to the indicated uses.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L401-L421'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='401' data-end='421'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 401</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_create_cert'>create_cert</span>(<span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span><span class='comma'>,</span>
                     <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_cert'>cert</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Certificate</span>.<span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_public_key'>public_key</span> <span class='op'>=</span> <span class='id identifier rubyid_get_public_key'><a href="#get_public_key-class_method" title="Gem::Security.get_public_key (method)">get_public_key</a></span>(<span class='id identifier rubyid_key'>key</span>)
  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_version'>version</span>    <span class='op'>=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_serial'>serial</span>     <span class='op'>=</span> <span class='id identifier rubyid_serial'>serial</span>

  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_not_before'>not_before</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_not_after'>not_after</span>  <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='id identifier rubyid_age'>age</span>

  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_subject'>subject</span>    <span class='op'>=</span> <span class='id identifier rubyid_subject'>subject</span>

  <span class='id identifier rubyid_ef'>ef</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>ExtensionFactory</span>.<span class='id identifier rubyid_new'>new</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_cert'>cert</span>

  <span class='id identifier rubyid_cert'>cert</span>.<span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ext_name'>ext_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_ef'>ef</span>.<span class='id identifier rubyid_create_extension'>create_extension</span> <span class='id identifier rubyid_ext_name'>ext_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cert'>cert</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_cert_email-class_method">
  <h3 class='signature '>
    .<strong>create_cert_email</strong>(email, key, age = ONE_YEAR, extensions = EXTENSIONS)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a self-signed certificate with an issuer and subject from <code>email</code>, a subject alternative name of <code>email</code> and the given <code>extensions</code> for the <code>key</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L448-L454'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='448' data-end='454'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 448</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_create_cert_email'>create_cert_email</span>(<span class='id identifier rubyid_email'>email</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span>)
  <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_email_to_name'><a href="#email_to_name-class_method" title="Gem::Security.email_to_name (method)">email_to_name</a></span> <span class='id identifier rubyid_email'>email</span>

  <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_merge'>merge</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_email'>email</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_create_cert_self_signed'><a href="#create_cert_self_signed-class_method" title="Gem::Security.create_cert_self_signed (method)">create_cert_self_signed</a></span> <span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_cert_self_signed-class_method">
  <h3 class='signature '>
    .<strong>create_cert_self_signed</strong>(subject, key, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a self-signed certificate with an issuer and subject of <code>subject</code> and the given <code>extensions</code> for the <code>key</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L460-L465'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='460' data-end='465'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 460</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_create_cert_self_signed'>create_cert_self_signed</span>(<span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span>
                                 <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_certificate'>certificate</span> <span class='op'>=</span> <span class='id identifier rubyid_create_cert'><a href="#create_cert-class_method" title="Gem::Security.create_cert (method)">create_cert</a></span> <span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span>

  <span class='id identifier rubyid_sign'><a href="#sign-class_method" title="Gem::Security.sign (method)">sign</a></span> <span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_digest-class_method">
  <h3 class='signature '>
    .<strong>create_digest</strong>(algorithm = DIGEST_NAME)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See additional method definition at line 472.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L478-L480'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='478' data-end='480'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 478</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_create_digest'>create_digest</span>(<span class='id identifier rubyid_algorithm'>algorithm</span> <span class='op'>=</span> <span class='const'><a href="#DIGEST_NAME-constant" title="Gem::Security::DIGEST_NAME (constant)">DIGEST_NAME</a></span>)
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_algorithm'>algorithm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_key-class_method">
  <h3 class='signature '>
    .<strong>create_key</strong>(algorithm)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new key pair of the specified <code>algorithm</code>. RSA, DSA, and EC are supported.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L487-L507'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='487' data-end='507'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 487</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_create_key'>create_key</span>(<span class='id identifier rubyid_algorithm'>algorithm</span>)
  <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span>)
    <span class='kw'>case</span> <span class='id identifier rubyid_algorithm'>algorithm</span>.<span class='id identifier rubyid_downcase'>downcase</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dsa</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>DSA</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'><a href="#RSA_DSA_KEY_LENGTH-constant" title="Gem::Security::RSA_DSA_KEY_LENGTH (constant)">RSA_DSA_KEY_LENGTH</a></span>)
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rsa</span><span class='tstring_end'>&quot;</span></span>
      <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>RSA</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'><a href="#RSA_DSA_KEY_LENGTH-constant" title="Gem::Security::RSA_DSA_KEY_LENGTH (constant)">RSA_DSA_KEY_LENGTH</a></span>)
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ec</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='const'>RUBY_VERSION</span> <span class='op'>&gt;=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2.4.0</span><span class='tstring_end'>&quot;</span></span>
        <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>EC</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='const'><a href="#EC_NAME-constant" title="Gem::Security::EC_NAME (constant)">EC_NAME</a></span>)
      <span class='kw'>else</span>
        <span class='id identifier rubyid_domain_key'>domain_key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>EC</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'><a href="#EC_NAME-constant" title="Gem::Security::EC_NAME (constant)">EC_NAME</a></span>)
        <span class='id identifier rubyid_domain_key'>domain_key</span>.<span class='id identifier rubyid_generate_key'>generate_key</span>
        <span class='id identifier rubyid_domain_key'>domain_key</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='embexpr_end'>}</span><span class='tstring_content'> algorithm not found. RSA, DSA, and EC algorithms are supported.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="email_to_name-class_method">
  <h3 class='signature '>
    .<strong>email_to_name</strong>(email_address)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Turns <code>email_address</code> into an <code>OpenSSL::X509::Name</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L512-L523'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='512' data-end='523'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 512</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_email_to_name'>email_to_name</span>(<span class='id identifier rubyid_email_address'>email_address</span>)
  <span class='id identifier rubyid_email_address'>email_address</span> <span class='op'>=</span> <span class='id identifier rubyid_email_address'>email_address</span>.<span class='id identifier rubyid_gsub'>gsub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^\w@.-]+</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span>)

  <span class='id identifier rubyid_cn'>cn</span><span class='comma'>,</span> <span class='id identifier rubyid_dcs'>dcs</span> <span class='op'>=</span> <span class='id identifier rubyid_email_address'>email_address</span>.<span class='id identifier rubyid_split'>split</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_dcs'>dcs</span> <span class='op'>=</span> <span class='id identifier rubyid_dcs'>dcs</span>.<span class='id identifier rubyid_split'>split</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>

  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Name</span>.<span class='id identifier rubyid_new'>new</span>([
    [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CN</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_cn'>cn</span>]<span class='comma'>,</span>
    <span class='op'>*</span><span class='id identifier rubyid_dcs'>dcs</span>.<span class='id identifier rubyid_map'>map</span> {<span class='op'>|</span><span class='id identifier rubyid_dc'>dc</span><span class='op'>|</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DC</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dc'>dc</span>] }<span class='comma'>,</span>
  ])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_public_key-class_method">
  <h3 class='signature '>
    .<strong>get_public_key</strong>(key)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Gets the right public key from a PKey instance</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L426-L434'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='426' data-end='434'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 426</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_get_public_key'>get_public_key</span>(<span class='id identifier rubyid_key'>key</span>)
  <span class='comment'># Ruby 3.0 (Ruby/OpenSSL 2.2) or later
</span>  <span class='kw'>return</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_public_to_der'>public_to_der</span>) <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_public_to_der'>public_to_der</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_public_key'>public_key</span> <span class='kw'>unless</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>EC</span>)

  <span class='id identifier rubyid_ec_key'>ec_key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKey</span><span class='op'>::</span><span class='const'>EC</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_group'>group</span>.<span class='id identifier rubyid_curve_name'>curve_name</span>)
  <span class='id identifier rubyid_ec_key'>ec_key</span>.<span class='id identifier rubyid_public_key'>public_key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_public_key'>public_key</span>
  <span class='id identifier rubyid_ec_key'>ec_key</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="re_sign-class_method">
  <h3 class='signature '>
    .<strong>re_sign</strong>(expired_certificate, private_key, age = ONE_YEAR, extensions = EXTENSIONS)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Signs <code>expired_certificate</code> with <code>private_key</code> if the keys match and the expired certificate was self-signed.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Security/Exception.html" title="Gem::Security::Exception (class)">Gem::Security::Exception</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L531-L552'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='531' data-end='552'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 531</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_re_sign'>re_sign</span>(<span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_private_key'>private_key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span>
                 <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a></span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>incorrect signing key for re-signing </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_expired_certificate'>expired_certificate</span>.<span class='id identifier rubyid_subject'>subject</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span>
    <span class='id identifier rubyid_expired_certificate'>expired_certificate</span>.<span class='id identifier rubyid_check_private_key'>check_private_key</span>(<span class='id identifier rubyid_private_key'>private_key</span>)

  <span class='kw'>unless</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span>.<span class='id identifier rubyid_subject'>subject</span>.<span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span>
         <span class='id identifier rubyid_expired_certificate'>expired_certificate</span>.<span class='id identifier rubyid_issuer'>issuer</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_alt_name_or_x509_entry'><a href="#alt_name_or_x509_entry-class_method" title="Gem::Security.alt_name_or_x509_entry (method)">alt_name_or_x509_entry</a></span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subject'>subject</span>
    <span class='id identifier rubyid_issuer'>issuer</span>  <span class='op'>=</span> <span class='id identifier rubyid_alt_name_or_x509_entry'><a href="#alt_name_or_x509_entry-class_method" title="Gem::Security.alt_name_or_x509_entry (method)">alt_name_or_x509_entry</a></span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_issuer'>issuer</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'><a href="Security/Exception.html" title="Gem::Security::Exception (class)">Exception</a></span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_subject'>subject</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not self-signed, contact </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_issuer'>issuer</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to obtain a valid certificate</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='id identifier rubyid_expired_certificate'>expired_certificate</span>.<span class='id identifier rubyid_serial'>serial</span> <span class='op'>+</span> <span class='int'>1</span>

  <span class='id identifier rubyid_create_cert_self_signed'><a href="#create_cert_self_signed-class_method" title="Gem::Security.create_cert_self_signed (method)">create_cert_self_signed</a></span>(<span class='id identifier rubyid_expired_certificate'>expired_certificate</span>.<span class='id identifier rubyid_subject'>subject</span><span class='comma'>,</span> <span class='id identifier rubyid_private_key'>private_key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span>
                          <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset-class_method">
  <h3 class='signature '>
    .<strong>reset</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Resets the trust directory for verifying gems.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L557-L559'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='557' data-end='559'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 557</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_reset'>reset</span>
  <span class='ivar'>@trust_dir</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sign-class_method">
  <h3 class='signature '>
    .<strong>sign</strong>(certificate, signing_key, signing_cert, age = ONE_YEAR, extensions = EXTENSIONS, serial = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sign the public key from <code>certificate</code> with the <code>signing_key</code> and <code>signing_cert</code>, using the <a href="#DIGEST_NAME-constant" title="Gem::Security::DIGEST_NAME (constant)">DIGEST_NAME</a>.  Uses the default certificate validity range and extensions.</p>

<p>Returns the newly signed certificate.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L568-L591'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='568' data-end='591'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 568</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_sign'>sign</span>(<span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span> <span class='id identifier rubyid_signing_key'>signing_key</span><span class='comma'>,</span> <span class='id identifier rubyid_signing_cert'>signing_cert</span><span class='comma'>,</span>
              <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='const'><a href="#ONE_YEAR-constant" title="Gem::Security::ONE_YEAR (constant)">ONE_YEAR</a></span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='const'><a href="#EXTENSIONS-constant" title="Gem::Security::EXTENSIONS (constant)">EXTENSIONS</a></span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_signee_subject'>signee_subject</span> <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span>.<span class='id identifier rubyid_subject'>subject</span>
  <span class='id identifier rubyid_signee_key'>signee_key</span>     <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span>.<span class='id identifier rubyid_public_key'>public_key</span>

  <span class='id identifier rubyid_alt_name'>alt_name</span> <span class='op'>=</span> <span class='id identifier rubyid_certificate'>certificate</span>.<span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extension'>extension</span><span class='op'>|</span>
    <span class='id identifier rubyid_extension'>extension</span>.<span class='id identifier rubyid_oid'>oid</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_merge'>merge</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_alt_name'>alt_name</span>.<span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span>
    <span class='id identifier rubyid_alt_name'>alt_name</span>

  <span class='id identifier rubyid_issuer_alt_name'>issuer_alt_name</span> <span class='op'>=</span> <span class='id identifier rubyid_signing_cert'>signing_cert</span>.<span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_find'>find</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extension'>extension</span><span class='op'>|</span>
    <span class='id identifier rubyid_extension'>extension</span>.<span class='id identifier rubyid_oid'>oid</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>subjectAltName</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_extensions'>extensions</span> <span class='op'>=</span> <span class='id identifier rubyid_extensions'>extensions</span>.<span class='id identifier rubyid_merge'>merge</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>issuerAltName</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_issuer_alt_name'>issuer_alt_name</span>.<span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span>
    <span class='id identifier rubyid_issuer_alt_name'>issuer_alt_name</span>

  <span class='id identifier rubyid_signed'>signed</span> <span class='op'>=</span> <span class='id identifier rubyid_create_cert'><a href="#create_cert-class_method" title="Gem::Security.create_cert (method)">create_cert</a></span> <span class='id identifier rubyid_signee_subject'>signee_subject</span><span class='comma'>,</span> <span class='id identifier rubyid_signee_key'>signee_key</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span><span class='comma'>,</span> <span class='id identifier rubyid_extensions'>extensions</span><span class='comma'>,</span> <span class='id identifier rubyid_serial'>serial</span>
  <span class='id identifier rubyid_signed'>signed</span>.<span class='id identifier rubyid_issuer'>issuer</span> <span class='op'>=</span> <span class='id identifier rubyid_signing_cert'>signing_cert</span>.<span class='id identifier rubyid_subject'>subject</span>

  <span class='id identifier rubyid_signed'>signed</span>.<span class='id identifier rubyid_sign'>sign</span> <span class='id identifier rubyid_signing_key'>signing_key</span><span class='comma'>,</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'><a href="#DIGEST_NAME-constant" title="Gem::Security::DIGEST_NAME (constant)">DIGEST_NAME</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="trust_dir-class_method">
  <h3 class='signature '>
    .<strong>trust_dir</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)"><code>Security::TrustDir</code></a> which wraps the directory where trusted certificates live.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L597-L603'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='597' data-end='603'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 597</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_trust_dir'>trust_dir</span>
  <span class='kw'>return</span> <span class='ivar'>@trust_dir</span> <span class='kw'>if</span> <span class='ivar'>@trust_dir</span>

  <span class='id identifier rubyid_dir'><a href="../Gem.html#dir-class_method" title="Gem.dir (method)">dir</a></span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span>.<span class='id identifier rubyid_user_home'><a href="../Gem.html#user_home-class_method" title="Gem.user_home (method)">user_home</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.gem</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>trust</span><span class='tstring_end'>&quot;</span></span>

  <span class='ivar'>@trust_dir</span> <span class='op'>||=</span> <span class='const'><a href="../Gem.html" title="Gem (module)">Gem</a></span><span class='op'>::</span><span class='const'>Security</span><span class='op'>::</span><span class='const'><a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)">TrustDir</a></span>.<span class='id identifier rubyid_new'><a href="Security/TrustDir.html#new-class_method" title="Gem::Security::TrustDir.new (method)">new</a></span> <span class='id identifier rubyid_dir'><a href="../Gem.html#dir-class_method" title="Gem.dir (method)">dir</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="trusted_certificates-class_method">
  <h3 class='signature '>
    .<strong>trusted_certificates</strong>(&amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Enumerates the trusted certificates via <a href="Security/TrustDir.html" title="Gem::Security::TrustDir (class)"><code>Security::TrustDir</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L608-L610'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='608' data-end='610'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 608</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_trusted_certificates'>trusted_certificates</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_trust_dir'><a href="#trust_dir-class_method" title="Gem::Security.trust_dir (method)">trust_dir</a></span>.<span class='id identifier rubyid_each_certificate'>each_certificate</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write-class_method">
  <h3 class='signature '>
    .<strong>write</strong>(pemmable, path, permissions = 0600, passphrase = nil, cipher = KEY_CIPHER)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Writes <code>pemmable</code>, which must respond to <code>to_pem</code> to <a href="../Gem.html#path-class_method" title="Gem.path (method)">Gem.path</a> with the given <code>permissions</code>. If passed <code>cipher</code> and <code>passphrase</code> those arguments will be passed to <code>to_pem</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_1_7/lib/rubygems/security.rb#L617-L629'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='617' data-end='629'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rubygems/security.rb', line 617</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_pemmable'>pemmable</span><span class='comma'>,</span> <span class='id identifier rubyid_path'><a href="../Gem.html#path-class_method" title="Gem.path (method)">path</a></span><span class='comma'>,</span> <span class='id identifier rubyid_permissions'>permissions</span> <span class='op'>=</span> <span class='int'>0600</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'><a href="#KEY_CIPHER-constant" title="Gem::Security::KEY_CIPHER (constant)">KEY_CIPHER</a></span>)
  <span class='id identifier rubyid_path'><a href="../Gem.html#path-class_method" title="Gem.path (method)">path</a></span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span> <span class='id identifier rubyid_path'><a href="../Gem.html#path-class_method" title="Gem.path (method)">path</a></span>

  <span class='const'>File</span>.<span class='id identifier rubyid_open'>open</span> <span class='id identifier rubyid_path'><a href="../Gem.html#path-class_method" title="Gem.path (method)">path</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_permissions'>permissions</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_cipher'>cipher</span>
      <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_pemmable'>pemmable</span>.<span class='id identifier rubyid_to_pem'>to_pem</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_pemmable'>pemmable</span>.<span class='id identifier rubyid_to_pem'>to_pem</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_path'><a href="../Gem.html#path-class_method" title="Gem.path (method)">path</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>