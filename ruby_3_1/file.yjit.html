<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Yjit &mdash; Ruby-3.1.7</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "yjit",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Ruby-3.1.7</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Yjit&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="file_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<p align="center">
  <a href="https://yjit.org/" target="_blank" rel="noopener noreferrer">
    <img src="https://user-images.githubusercontent.com/224488/131155756-aa8fb528-a813-4dfd-99ac-8785c3d5eed7.png" width="400">
  </a>
</p>

<h1>YJIT - Yet Another Ruby JIT</h1>

<p><strong>DISCLAIMER: Please note that this project is experimental. It is very much a work in progress, it may cause your software to crash, and current performance results will vary widely, especially on larger applications.</strong></p>

<p>YJIT is a lightweight, minimalistic Ruby JIT built inside CRuby.
It lazily compiles code using a Basic Block Versioning (BBV) architecture. The target use case is that of servers running
Ruby on Rails, an area where MJIT has not yet managed to deliver speedups.
To simplify development, we currently support only macOS and Linux on x86-64, but an ARM64 backend
is part of future plans.
This project is open source and falls under the same license as CRuby.</p>

<p>If you wish to learn more about the approach taken, here are some conference talks and publications:</p>

<ul>
<li>RubyKaigi 2021 talk: <a href="https://www.youtube.com/watch?v=PBVLf3yfMs8">YJIT: Building a New JIT Compiler Inside CRuby</a></li>
<li>Blog post: <a href="https://pointersgonewild.com/2021/06/02/yjit-building-a-new-jit-compiler-inside-cruby/">YJIT: Building a New JIT Compiler Inside CRuby</a></li>
<li>MoreVMs 2021 talk: <a href="https://www.youtube.com/watch?v=vucLAqv7qpc">YJIT: Building a New JIT Compiler Inside CRuby</a></li>
<li>ECOOP 2016 talk: <a href="https://www.youtube.com/watch?v=sRNBY7Ss97A">Interprocedural Type Specialization of JavaScript Programs Without Type Analysis</a></li>
<li>ECOOP 2016 paper: <a href="https://drops.dagstuhl.de/opus/volltexte/2016/6101/pdf/LIPIcs-ECOOP-2016-7.pdf">Interprocedural Type Specialization of JavaScript Programs Without Type Analysis</a></li>
<li>ECOOP 2015 talk: <a href="https://www.youtube.com/watch?v=S-aHBuoiYE0">Simple and Effective Type Check Removal through Lazy Basic Block Versioning</a></li>
<li>ECOOP 2015 paper: <a href="https://arxiv.org/pdf/1411.0352.pdf">Simple and Effective Type Check Removal through Lazy Basic Block Versioning</a></li>
</ul>

<p>To cite this repository in your publications, please use this bibtex snippet:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@misc</span>{<span class='id identifier rubyid_yjit_ruby_jit'>yjit_ruby_jit</span><span class='comma'>,</span>
  <span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> {<span class='const'>Chevalier</span><span class='op'>-</span><span class='const'>Boisvert</span><span class='comma'>,</span> <span class='const'>Maxime</span> <span class='kw'>and</span> <span class='const'>Wu</span><span class='comma'>,</span> <span class='const'>Alan</span> <span class='kw'>and</span> <span class='const'>Patterson</span><span class='comma'>,</span> <span class='const'>Aaron</span>}<span class='comma'>,</span>
  <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> {<span class='const'>YJIT</span> <span class='op'>-</span> <span class='const'>Yet</span> <span class='const'>Another</span> <span class='const'>Ruby</span> <span class='const'>JIT</span>}<span class='comma'>,</span>
  <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> {<span class='int'>2021</span>}<span class='comma'>,</span>
  <span class='id identifier rubyid_publisher'>publisher</span> <span class='op'>=</span> {<span class='const'>GitHub</span>}<span class='comma'>,</span>
  <span class='id identifier rubyid_journal'>journal</span> <span class='op'>=</span> {<span class='const'>GitHub</span> <span class='id identifier rubyid_repository'>repository</span>}<span class='comma'>,</span>
  <span class='id identifier rubyid_howpublished'>howpublished</span> <span class='op'>=</span> {<span class='CHAR'>\</span><span class='id identifier rubyid_url'>url</span>{<span class='id identifier rubyid_https'>https</span><span class='symbeg'>:</span><span class='op'>/</span><span class='op'>/</span><span class='id identifier rubyid_github'>github</span>.<span class='id identifier rubyid_com'>com</span><span class='op'>/</span><span class='const'>Shopify</span><span class='op'>/</span><span class='id identifier rubyid_yjit'>yjit</span>}}<span class='comma'>,</span>
}</code></pre>

<h2>Current Limitations</h2>

<p>YJIT is a work in progress and as such may not yet be mature enough for mission-critical software. Below is a list of known limitations, all of which we plan to eventually address:</p>

<ul>
<li>No garbage collection for generated code.</li>
<li>Currently supports only macOS and Linux.</li>
<li>Currently supports only x86-64 CPUs.</li>
</ul>

<p>Because there is no GC for generated code yet, your software could run out of executable memory if it is large enough. You can change how much executable memory is allocated using <a href="https://github.com/Shopify/yjit#command-line-options">YJIT&#39;s command-line options</a>.</p>

<h2>Installation</h2>

<p>Current YJIT versions are installed by default with CRuby. Make sure to specify the &quot;--yjit&quot; command line option to enable it at runtime.</p>

<p>Experimental YJIT patches that have not yet been merged with CRuby can be found in ruby-build:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span><span class='op'>-</span><span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_yjit'>yjit</span><span class='op'>-</span><span class='id identifier rubyid_dev'>dev</span> <span class='op'>~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.rubies</span><span class='regexp_end'>/ruby</span></span><span class='op'>-</span><span class='id identifier rubyid_yjit'>yjit</span><span class='op'>-</span><span class='id identifier rubyid_dev'>dev</span></code></pre>

<p>They can also be found in the Shopify/yjit repository, which is cloned and build like CRuby.</p>

<p>Start by cloning the <code>Shopify/yjit</code> repository:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_git'>git</span> <span class='id identifier rubyid_clone'>clone</span> <span class='label'>https:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/github</span></span>.<span class='id identifier rubyid_com'>com</span><span class='op'>/</span><span class='const'>Shopify</span><span class='op'>/</span><span class='id identifier rubyid_yjit'>yjit</span>
<span class='id identifier rubyid_cd'>cd</span> <span class='id identifier rubyid_yjit'>yjit</span></code></pre>

<p>The YJIT <code>ruby</code> binary can be built with either GCC or Clang. For development, we recommend enabling debug symbols so that assertions are enabled as this makes debugging easier. Enabling debug mode will also make it possible for you to disassemble code generated by YJIT. However, this causes a performance hit. For maximum performance, compile with GCC, without the <code>DRUBY_DEBUG</code> or <code>YJIT_STATS</code> build options. More detailed build instructions are provided in the <a href="https://github.com/ruby/ruby#how-to-compile-and-install">Ruby README</a>.
To support disassembly of the generated code, <code>libcapstone</code> is also required (<code>brew install capstone</code> on MacOS, <code>sudo apt-get install -y libcapstone-dev</code> on Ubuntu/Debian and <code>sudo dnf -y install capstone-devel</code> on Fedora).</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Configure with debugging/stats options for development, build and install
</span>.<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>autogen.sh
.</span><span class='regexp_end'>/configure</span></span> <span class='id identifier rubyid_cppflags'>cppflags</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-DRUBY_DEBUG -DYJIT_STATS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_prefix'>prefix</span><span class='op'>=</span><span class='gvar'>$HOME</span><span class='op'>/</span>.<span class='id identifier rubyid_rubies'>rubies</span><span class='op'>/</span><span class='id identifier rubyid_ruby'>ruby</span><span class='op'>-</span><span class='id identifier rubyid_yjit'>yjit</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_disable'>disable</span><span class='op'>-</span><span class='id identifier rubyid_install'>install</span><span class='op'>-</span><span class='id identifier rubyid_doc'>doc</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_disable'>disable</span><span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_install'>install</span><span class='op'>-</span><span class='id identifier rubyid_rdoc'>rdoc</span>
<span class='id identifier rubyid_make'>make</span> <span class='op'>-</span><span class='id identifier rubyid_j16'>j16</span> <span class='id identifier rubyid_install'>install</span></code></pre>

<p>On macOS, you may need to specify where to find openssl, libyaml and gdbm:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Configure with debugging/stats options for development, build and install
</span>.<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>configure cppflags=&quot;-DRUBY_DEBUG -DYJIT_STATS&quot; --prefix=$HOME</span><span class='regexp_end'>/</span></span>.<span class='id identifier rubyid_rubies'>rubies</span><span class='op'>/</span><span class='id identifier rubyid_ruby'>ruby</span><span class='op'>-</span><span class='id identifier rubyid_yjit'>yjit</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_disable'>disable</span><span class='op'>-</span><span class='id identifier rubyid_install'>install</span><span class='op'>-</span><span class='id identifier rubyid_doc'>doc</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_disable'>disable</span><span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_install'>install</span><span class='op'>-</span><span class='id identifier rubyid_rdoc'>rdoc</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_with'>with</span><span class='op'>-</span><span class='id identifier rubyid_opt'>opt</span><span class='op'>-</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>=</span><span class='gvar'>$</span>(<span class='id identifier rubyid_brew'>brew</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_prefix'>prefix</span> <span class='id identifier rubyid_openssl'>openssl</span>)<span class='symbeg'>:</span><span class='gvar'>$</span>(<span class='id identifier rubyid_brew'>brew</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_prefix'>prefix</span> <span class='id identifier rubyid_readline'>readline</span>)<span class='symbeg'>:</span><span class='gvar'>$</span>(<span class='id identifier rubyid_brew'>brew</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_prefix'>prefix</span> <span class='id identifier rubyid_libyaml'>libyaml</span>)<span class='symbeg'>:</span><span class='gvar'>$</span>(<span class='id identifier rubyid_brew'>brew</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_prefix'>prefix</span> <span class='id identifier rubyid_gdbm'>gdbm</span>)
<span class='id identifier rubyid_make'>make</span> <span class='op'>-</span><span class='id identifier rubyid_j16'>j16</span> <span class='id identifier rubyid_install'>install</span></code></pre>

<p>Typically configure will choose default C compiler. To specify the C compiler, use</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Choosing a specific c compiler
</span><span class='id identifier rubyid_export'>export</span> <span class='const'>CC</span><span class='op'>=</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>path</span><span class='regexp_end'>/to</span></span><span class='op'>/</span><span class='id identifier rubyid_my'>my</span><span class='op'>/</span><span class='id identifier rubyid_choosen'>choosen</span><span class='op'>/</span><span class='id identifier rubyid_c'>c</span><span class='op'>/</span><span class='id identifier rubyid_compiler'>compiler</span></code></pre>

<p>before running <code>./configure</code>.</p>

<p>You can test that YJIT works correctly by running:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Quick tests found in /bootstraptest
</span><span class='id identifier rubyid_make'>make</span> <span class='id identifier rubyid_btest'>btest</span>

<span class='comment'># Complete set of tests
</span><span class='id identifier rubyid_make'>make</span> <span class='op'>-</span><span class='id identifier rubyid_j16'>j16</span> <span class='id identifier rubyid_test'>test</span><span class='op'>-</span><span class='id identifier rubyid_all'>all</span></code></pre>

<h2>Usage</h2>

<h3>Examples</h3>

<p>Once YJIT is built, you can either use <code>./miniruby</code> from within your build directory, or switch to the YJIT version of <code>ruby</code>
by using the <code>chruby</code> tool:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_chruby'>chruby</span> <span class='id identifier rubyid_ruby'>ruby</span><span class='op'>-</span><span class='id identifier rubyid_yjit'>yjit</span>
<span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_myscript'>myscript</span>.<span class='id identifier rubyid_rb'>rb</span></code></pre>

<p>You can dump statistics about compilation and execution by running YJIT with the <code>--yjit-stats</code> command-line option:</p>

<pre class="code ruby"><code class="ruby">.<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>miniruby --yjit-stats myscript.rb</span></code></pre>

<p>The machine code generated for a given method can be printed by adding <code>puts RubyVM::YJIT.disasm(method(:method_name))</code> to a Ruby script. Note that no code will be generated if the method is not compiled.</p>

<h3>Command-Line Options</h3>

<p>YJIT supports all command-line options supported by upstream CRuby, but also adds a few YJIT-specific options:</p>

<ul>
<li><code>--disable-yjit</code>: turn off YJIT (enabled by default)</li>
<li><code>--yjit-stats</code>: produce statistics after the execution of a program (must compile with <code>cppflags=-DRUBY_DEBUG</code> to use this)</li>
<li><code>--yjit-exec-mem-size=N</code>: size of the executable memory block to allocate (default 256 MiB)</li>
<li><code>--yjit-call-threshold=N</code>: number of calls after which YJIT begins to compile a function (default 2)</li>
<li><code>--yjit-max-versions=N</code>: maximum number of versions to generate per basic block (default 4)</li>
<li><code>--yjit-greedy-versioning</code>: greedy versioning mode (disabled by default, may increase code size)</li>
</ul>

<h3>Benchmarking</h3>

<p>We have collected a set of benchmarks and implemented a simple benchmarking harness in the <a href="https://github.com/Shopify/yjit-bench">yjit-bench</a> repository. This benchmarking harness is designed to disable CPU frequency scaling, set process affinity and disable address space randomization so that the variance between benchmarking runs will be as small as possible. Please kindly note that we are at an early stage in this project.</p>

<h3>Performance Tips</h3>

<p>This section contains tips on writing Ruby code that will run as fast as possible on YJIT. Some of this advice is based on current limitations of YJIT, while other advice is broadly applicable. It probably won&#39;t be practical to apply these tips everywhere in your codebase, but you can profile your code using a tool such as <a href="https://github.com/tmm1/stackprof">stackprof</a> and refactor the specific methods that make up the largest fractions of the execution time.</p>

<ul>
<li>Use exceptions for error recovery only, not as part of normal control-flow</li>
<li>Avoid redefining basic integer operations (i.e. +, -, &lt;, &gt;, etc.)</li>
<li>Avoid redefining the meaning of <code>nil</code>, equality, etc.</li>
<li>Avoid allocating objects in the hot parts of your code</li>
<li>Use while loops if you can, instead of <code>integer.times</code></li>
<li>Minimize layers of indirection

<ul>
<li>Avoid classes that wrap objects if you can</li>
<li>Avoid methods that just call another method, trivial one liner methods</li>
</ul></li>
<li>CRuby method calls are costly. Favor larger methods over smaller methods.</li>
<li>Try to write code so that the same variables always have the same type</li>
</ul>

<p>You can also compile YJIT in debug mode and use the <code>--yjit-stats</code> command-line option to see which bytecodes cause YJIT to exit, and refactor your code to avoid using these instructions in the hottest methods of your code.</p>

<h2>Contributing</h2>

<p>We welcome open source contributors. You should feel free to open new issues to report bugs or just to ask questions.
Suggestions on how to make this readme file more helpful for new contributors are most welcome.</p>

<p>Bug fixes and bug reports are very valuable to us. If you find a bug in YJIT, it&#39;s very possible be that nobody has reported it before,
or that we don&#39;t have a good reproduction for it, so please open an issue and provide as much information as you can about your configuration and a description of how you encountered the problem. List the commands you used to run YJIT so that we can easily reproduce the issue on our end and investigate it. If you are able to produce a small program reproducing the error to help us track it down, that is very much appreciated as well.</p>

<p>If you would like to contribute a large patch to YJIT, we suggest opening an issue or a discussion on this repository so that
we can have an active discussion. A common problem is that sometimes people submit large pull requests to open source projects
without prior communication, and we have to reject them because the work they implemented does not fit within the design of the
project. We want to save you time and frustration, so please reach out and we can have a productive discussion as to how
you can contribute things we will want to merge into YJIT.</p>

<h3>Source Code Organization</h3>

<p>The YJIT source code is divided between:</p>

<ul>
<li><code>yjit_asm.c</code>: x86 in-memory assembler we use to generate machine code</li>
<li><code>yjit_codegen.c</code>: logic for translating Ruby bytecode to machine code</li>
<li><code>yjit_core.c</code>: basic block versioning logic, core structure of YJIT</li>
<li><code>yjit_iface.c</code>: code YJIT uses to interface with the rest of CRuby</li>
<li><code>yjit.h</code>: C definitions YJIT exposes to the rest of the CRuby</li>
<li><code>yjit.rb</code>: <code>YJIT</code> Ruby module that is exposed to Ruby</li>
<li><code>misc/test_yjit_asm.sh</code>: script to compile and run the in-memory assembler tests</li>
<li><code>misc/yjit_asm_tests.c</code>: tests for the in-memory assembler</li>
</ul>

<p>The core of CRuby&#39;s interpreter logic is found in:</p>

<ul>
<li><code>insns.def</code>: defines Ruby&#39;s bytecode instructions (gets compiled into <code>vm.inc</code>)</li>
<li><code>vm_insnshelper.c</code>: logic used by Ruby&#39;s bytecode instructions</li>
<li><code>vm_exec.c</code>: Ruby interpreter loop</li>
</ul>

<h3>Coding &amp; Debugging Protips</h3>

<p>There are 3 test suites:</p>

<ul>
<li><code>make btest</code> (see <code>/bootstraptest</code>)</li>
<li><code>make test-all</code></li>
<li><code>make test-spec</code></li>
<li><code>make check</code> runs all of the above</li>
</ul>

<p>The tests can be run in parallel like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_make'>make</span> <span class='op'>-</span><span class='id identifier rubyid_j16'>j16</span> <span class='id identifier rubyid_test'>test</span><span class='op'>-</span><span class='id identifier rubyid_all'>all</span> <span class='const'>RUN_OPTS</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--yjit-call-threshold=1</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>Or single-threaded like this, to more easily identify which specific test is failing:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_make'>make</span> <span class='id identifier rubyid_test'>test</span><span class='op'>-</span><span class='id identifier rubyid_all'>all</span> <span class='const'>TESTOPTS</span><span class='op'>=</span><span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_verbose'>verbose</span> <span class='const'>RUN_OPTS</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--yjit-call-threshold=1</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>To debug a single test in <code>test-all</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_make'>make</span> <span class='id identifier rubyid_test'>test</span><span class='op'>-</span><span class='id identifier rubyid_all'>all</span> <span class='const'>TESTS</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test/-ext-/marshal/test_usrmarshal.rb</span><span class='tstring_end'>&#39;</span></span> <span class='const'>RUNRUBYOPT</span><span class='op'>=</span><span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_debugger'>debugger</span><span class='op'>=</span><span class='id identifier rubyid_lldb'>lldb</span> <span class='const'>RUN_OPTS</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--yjit-call-threshold=1</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>You can also run one specific test in <code>btest</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_make'>make</span> <span class='id identifier rubyid_btest'>btest</span> <span class='const'>BTESTS</span><span class='op'>=</span><span class='id identifier rubyid_bootstraptest'>bootstraptest</span><span class='op'>/</span><span class='id identifier rubyid_test_ractor'>test_ractor</span>.<span class='id identifier rubyid_rb'>rb</span> <span class='const'>RUN_OPTS</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--yjit-call-threshold=1</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>There are shortcuts to run/debug your own test/repro in <code>test.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_make'>make</span> <span class='id identifier rubyid_run'>run</span>  <span class='comment'># runs ./miniruby test.rb
</span><span class='id identifier rubyid_make'>make</span> <span class='id identifier rubyid_lldb'>lldb</span> <span class='comment'># launches ./miniruby test.rb in lldb</span></code></pre>

<p>You can use the Intel syntax for disassembly in LLDB, keeping it consistent with YJIT&#39;s disassembly:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_echo'>echo</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>settings set target.x86-disassembly-flavor intel</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&gt;&gt;</span> <span class='op'>~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.lldbinit</span></code></pre>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>