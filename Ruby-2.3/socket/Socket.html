<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Socket &mdash; socket Ruby-2.3.2 p139</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Socket",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Ruby-2.3.2</a> &raquo; 
          <a href='index.html'>socket</a> &raquo; 
          <a href='_index.html'>Index (S)</a> &raquo; 
          <span class='title'>Socket</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Socket</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="BasicSocket.html" title="BasicSocket (class)">BasicSocket</a></span>
      <ul class='fullTree'>
        <li>Object</li>
        <li class='next'>IO</li>
        <li class='next'><a href="BasicSocket.html" title="BasicSocket (class)">BasicSocket</a></li>
        <li class='next'>Socket</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>

  <tr>
    <td class='box_1'>Child Classes:</td>
    <td>
      <a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)">AncillaryData</a>,
    <a href="Socket/Ifaddr.html" title="Socket::Ifaddr (class)">Ifaddr</a>,
    <a href="Socket/Option.html" title="Socket::Option (class)">Option</a>,
    <a href="Socket/UDPSource.html" title="Socket::UDPSource (class)">UDPSource</a>
    </td>
  </tr>




  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
<a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1907'>ext/socket/socket.c</a><span class='defines'>,<br /><a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/ifaddr.c#L429'>ext/socket/ifaddr.c</a>,<br/> <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L451'>ext/socket/lib/socket.rb</a></span>
</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Class <a href="" title="Socket (class)">Socket</a> provides access to the underlying operating system socket
implementations.  It can be used to provide more operating system specific
functionality than the protocol-specific socket classes.</p>

<p>The constants defined under Constants are also defined under
Socket.  For example, AF_INET is usable as well as
Constants::AF_INET.  See Constants for the list of
constants.</p>

<h5 id="label-What-27s+a+socket-3F">What&#39;s a socket?</h5>

<p>Sockets are endpoints of a bidirectional communication channel. Sockets can
communicate within a process, between processes on the same machine or
between different machines.  There are many types of socket: TCPSocket,
UDPSocket or UNIXSocket for example.</p>

<p>Sockets have their own vocabulary:</p>

<p><strong>domain:</strong> The family of protocols:</p>
<ul><li>
<p>PF_INET</p>
</li><li>
<p>PF_INET6</p>
</li><li>
<p>PF_UNIX</p>
</li><li>
<p>etc.</p>
</li></ul>

<p><strong>type:</strong> The type of communications between the two
endpoints, typically</p>
<ul><li>
<p>SOCK_STREAM</p>
</li><li>
<p>SOCK_DGRAM.</p>
</li></ul>

<p><strong>protocol:</strong> Typically <em>zero</em>. This may be used to
identify a variant of a protocol.</p>

<p><strong>hostname:</strong> The identifier of a network interface:</p>
<ul><li>
<p>a string (hostname, IPv4 or IPv6 address or <code>broadcast</code></p>

<pre class="code ruby"><code class="ruby">which specifies a broadcast address)</code></pre>
</li><li>
<p>a zero-length string which specifies INADDR_ANY</p>
</li><li>
<p>an integer (interpreted as binary address in host byte order).</p>
</li></ul>

<h5 id="label-Quick+start">Quick start</h5>

<p>Many of the classes, such as TCPSocket, UDPSocket or UNIXSocket, ease the
use of sockets comparatively to the equivalent C programming interface.</p>

<p>Let&#39;s create an internet socket using the IPv4 protocol in a C-like
manner:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>Socket</span><span class='op'>::</span><span class='const'>SOCK_STREAM</span>
<span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span><span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example.com</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>

<p>You could also use the TCPSocket class:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example.com</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>80</span>
</code></pre>

<p>A simple server might look like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='const'><a href="TCPServer.html" title="TCPServer (class)">TCPServer</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPServer.html#new-class_method" title="TCPServer.new (method)">new</a></span> <span class='int'>2000</span> <span class='comment'># Server bound to port 2000
</span>
<span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>    <span class='comment'># Wait for a client to connect
</span>  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello !</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Time is </span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span>
</code></pre>

<p>A simple client may look like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><a href="TCPSocket.html" title="TCPSocket (class)">TCPSocket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="TCPSocket.html#new-class_method" title="TCPSocket.new (method)">new</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>2000</span>

<span class='kw'>while</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span> <span class='comment'># Read lines from socket
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_line'>line</span>         <span class='comment'># and print them
</span><span class='kw'>end</span>

<span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>             <span class='comment'># close socket when done
</span></code></pre>

<h5 id="label-Exception+Handling">Exception Handling</h5>

<p>Ruby&#39;s Socket implementation raises exceptions based on the error
generated by the system dependent implementation.  This is why the methods
are documented in a way that isolate Unix-based system exceptions from
Windows based exceptions. If more information on a particular exception is
needed, please refer to the Unix manual pages or the Windows WinSock
reference.</p>

<h5 id="label-Convenience+methods">Convenience methods</h5>

<p>Although the general way to create socket is <a href="#new-class_method" title="Socket.new (method)">Socket.new</a>, there are
several methods of socket creation for most cases.</p>
<dl class="rdoc-list note-list"><dt>TCP client socket
<dd>
<p>Socket.tcp, TCPSocket.open</p>
</dd><dt>TCP server socket
<dd>
<p>Socket.tcp_server_loop, TCPServer.open</p>
</dd><dt>UNIX client socket
<dd>
<p>Socket.unix, UNIXSocket.open</p>
</dd><dt>UNIX server socket
<dd>
<p>Socket.unix_server_loop, UNIXServer.open</p>
</dd></dl>

<h5 id="label-Documentation+by">Documentation by</h5>
<ul><li>
<p>Zach Dennis</p>
</li><li>
<p>Sam Roberts</p>
</li><li>
<p><em>Programming Ruby</em> from The Pragmatic Bookshelf.</p>
</li></ul>

<p>Much material in this documentation is taken with permission from
<em>Programming Ruby</em> from The Pragmatic Bookshelf.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#accept_loop-class_method" title=".accept_loop (class method)">.<strong>accept_loop</strong>(*sockets)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>yield socket and client address for each a connection accepted via given
sockets.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getaddrinfo-class_method" title="getaddrinfo (class method)">.<strong>getaddrinfo</strong>(nodename, servname[, family[, socktype[, protocol[, flags[, reverse_lookup]]]]])  &#x21d2; Array </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Obtains address information for <em>nodename</em>:<em>servname</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#gethostbyaddr-class_method" title="gethostbyaddr (class method)">.<strong>gethostbyaddr</strong>(address_string[, address_family])  &#x21d2; hostent </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Obtains the host information for <em>address</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#gethostbyname-class_method" title="gethostbyname (class method)">.<strong>gethostbyname</strong>(hostname)  &#x21d2; Array, ... </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Obtains the host information for <em>hostname</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#gethostname-class_method" title="gethostname (class method)">.<strong>gethostname</strong>  &#x21d2; hostname </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the hostname.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getifaddrs-class_method" title="getifaddrs (class method)">.<strong>getifaddrs</strong>  &#x21d2; Array, ... </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an array of interface addresses.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getnameinfo-class_method" title="getnameinfo (class method)">.<strong>getnameinfo</strong>(sockaddr[, flags])  &#x21d2; Array, servicename </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Obtains name information for <em>sockaddr</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getservbyname-class_method" title="getservbyname (class method)">.<strong>getservbyname</strong>(service_name)  &#x21d2; port_number </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Obtains the port number for <em>service_name</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#getservbyport-class_method" title="getservbyport (class method)">.<strong>getservbyport</strong>(port[, protocol_name])  &#x21d2; service </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Obtains the port number for <em>port</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ip_address_list-class_method" title="ip_address_list (class method)">.<strong>ip_address_list</strong>  &#x21d2; Array </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns local IP addresses as an array.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ip_sockets_port0-class_method" title=".ip_sockets_port0 (class method)">.<strong>ip_sockets_port0</strong>(ai_list, reuseaddr)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>:stopdoc:</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(domain, socktype[, protocol])  &#x21d2; socket </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a new socket object.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#pack_sockaddr_in-class_method" title="pack_sockaddr_in (class method)">.<strong>pack_sockaddr_in</strong>(port, host)  &#x21d2; sockaddr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">Socket.sockaddr_in</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#pack_sockaddr_un-class_method" title="pack_sockaddr_un (class method)">.<strong>pack_sockaddr_un</strong>(path)  &#x21d2; sockaddr </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#sockaddr_un-class_method" title="Socket.sockaddr_un (method)">Socket.sockaddr_un</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#pair-class_method" title="pair (class method)">.<strong>pair</strong>(domain, type, protocol)  &#x21d2; Array, socket2 </a>
        (also: .socketpair)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a pair of sockets connected each other.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sockaddr_in-class_method" title="sockaddr_in (class method)">.<strong>sockaddr_in</strong>(port, host)  &#x21d2; sockaddr </a>
        (also: .pack_sockaddr_in)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Packs <em>port</em> and <em>host</em> as an AF_INET/AF_INET6 sockaddr
string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sockaddr_un-class_method" title="sockaddr_un (class method)">.<strong>sockaddr_un</strong>(path)  &#x21d2; sockaddr </a>
        (also: .pack_sockaddr_un)
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Packs <em>path</em> as an AF_UNIX sockaddr string.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#socketpair-class_method" title="socketpair (class method)">.<strong>socketpair</strong>(domain, type, protocol)  &#x21d2; Array, socket2 </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Alias for <a href="#pair-class_method" title="Socket.pair (method)">Socket.pair</a>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#tcp-class_method" title="tcp (class method)">.<strong>tcp</strong>(host, port, local_host = nil, local_port = nil, [opts]) {|socket| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates a new socket object connected to host:port using TCP/IP.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#tcp_server_loop-class_method" title=".tcp_server_loop (class method)">.<strong>tcp_server_loop</strong>(host = nil, port, &amp;b)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates a TCP/IP server on <em>port</em> and calls the block for each
connection accepted.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#tcp_server_sockets-class_method" title=".tcp_server_sockets (class method)">.<strong>tcp_server_sockets</strong>(host = nil, port)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates TCP/IP server sockets for <em>host</em> and <em>port</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#tcp_server_sockets_port0-class_method" title=".tcp_server_sockets_port0 (class method)">.<strong>tcp_server_sockets_port0</strong>(host)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#udp_server_loop-class_method" title="udp_server_loop (class method)">.<strong>udp_server_loop</strong>(port) {|msg, msg_src| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates a UDP/IP server on <em>port</em> and calls the block for each
message arrived.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#udp_server_loop_on-class_method" title="udp_server_loop_on (class method)">.<strong>udp_server_loop_on</strong>(sockets) {|msg, msg_src| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Run UDP/IP server loop on the given sockets.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#udp_server_recv-class_method" title="udp_server_recv (class method)">.<strong>udp_server_recv</strong>(sockets) {|msg, msg_src| ... } </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Receive UDP/IP packets from the given <em>sockets</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#udp_server_sockets-class_method" title="udp_server_sockets (class method)">.<strong>udp_server_sockets</strong>([host, ])  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates UDP/IP sockets for a UDP server.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unix-class_method" title=".unix (class method)">.<strong>unix</strong>(path)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates a new socket connected to path using UNIX socket socket.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unix_server_loop-class_method" title=".unix_server_loop (class method)">.<strong>unix_server_loop</strong>(path, &amp;b)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates a UNIX socket server on <em>path</em>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unix_server_socket-class_method" title=".unix_server_socket (class method)">.<strong>unix_server_socket</strong>(path)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>creates a UNIX server socket on <em>path</em></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unix_socket_abstract_name%3F-class_method" title=".unix_socket_abstract_name? (class method)">.<strong>unix_socket_abstract_name?</strong>(path)  &#x21d2; Boolean </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unpack_sockaddr_in-class_method" title="unpack_sockaddr_in (class method)">.<strong>unpack_sockaddr_in</strong>(sockaddr)  &#x21d2; Array, ip_address </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Unpacks <em>sockaddr</em> into port and ip_address.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unpack_sockaddr_un-class_method" title="unpack_sockaddr_un (class method)">.<strong>unpack_sockaddr_un</strong>(sockaddr)  &#x21d2; path </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Unpacks <em>sockaddr</em> into path.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#accept-instance_method" title="#accept (instance method)">#<strong>accept</strong>  &#x21d2; Array, client_addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Accepts a next connection.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#accept_nonblock-instance_method" title="#accept_nonblock (instance method)">#<strong>accept_nonblock</strong>([options])  &#x21d2; Array, client_addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Accepts an incoming connection using accept(2) after O_NONBLOCK is set for
the underlying file descriptor.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#bind-instance_method" title="#bind (instance method)">#<strong>bind</strong>(local_sockaddr)  &#x21d2; 0 </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Binds to the given local address.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#connect-instance_method" title="#connect (instance method)">#<strong>connect</strong>(remote_sockaddr)  &#x21d2; 0 </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Requests a connection to be made on the given <code>remote_sockaddr</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#connect_nonblock-instance_method" title="#connect_nonblock (instance method)">#<strong>connect_nonblock</strong>(remote_sockaddr, [options])  &#x21d2; 0 </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Requests a connection to be made on the given <code>remote_sockaddr</code>
after O_NONBLOCK is set for the underlying file descriptor.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ipv6only%21-instance_method" title="#ipv6only! (instance method)">#<strong>ipv6only!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>enable the socket option IPV6_V6ONLY if IPV6_V6ONLY is available.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#listen-instance_method" title="#listen (instance method)">#<strong>listen</strong>(int)  &#x21d2; 0 </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Listens for connections, using the specified <code>int</code> as the
backlog.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#recvfrom-instance_method" title="#recvfrom (instance method)">#<strong>recvfrom</strong>(maxlen)  &#x21d2; Array, sender_addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#recvfrom_nonblock-instance_method" title="#recvfrom_nonblock (instance method)">#<strong>recvfrom_nonblock</strong>(maxlen[, flags[, outbuf[, opts]]])  &#x21d2; Array, sender_addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code> using
recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sysaccept-instance_method" title="#sysaccept (instance method)">#<strong>sysaccept</strong>  &#x21d2; Array, client_addrinfo </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Accepts an incoming connection returning an array containing the (integer)
file descriptor for the incoming connection, <em>client_socket_fd</em>, and
an Addrinfo, <em>client_addrinfo</em>.</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <a href="BasicSocket.html" title="BasicSocket (class)">BasicSocket</a></h3>
  <p class="inherited"><a href="BasicSocket.html#__recv_nonblock-instance_method" title="BasicSocket#__recv_nonblock (method)">#__recv_nonblock</a>, <a href="BasicSocket.html#__recvmsg-instance_method" title="BasicSocket#__recvmsg (method)">#__recvmsg</a>, <a href="BasicSocket.html#__recvmsg_nonblock-instance_method" title="BasicSocket#__recvmsg_nonblock (method)">#__recvmsg_nonblock</a>, <a href="BasicSocket.html#__sendmsg-instance_method" title="BasicSocket#__sendmsg (method)">#__sendmsg</a>, <a href="BasicSocket.html#__sendmsg_nonblock-instance_method" title="BasicSocket#__sendmsg_nonblock (method)">#__sendmsg_nonblock</a>, <a href="BasicSocket.html#close_read-instance_method" title="BasicSocket#close_read (method)">#close_read</a>, <a href="BasicSocket.html#close_write-instance_method" title="BasicSocket#close_write (method)">#close_write</a>, <a href="BasicSocket.html#connect_address-instance_method" title="BasicSocket#connect_address (method)">#connect_address</a>, <a href="BasicSocket.html#do_not_reverse_lookup-instance_method" title="BasicSocket#do_not_reverse_lookup (method)">#do_not_reverse_lookup</a>, <a href="BasicSocket.html#do_not_reverse_lookup-class_method" title="BasicSocket.do_not_reverse_lookup (method)">.do_not_reverse_lookup</a>, <a href="BasicSocket.html#do_not_reverse_lookup%3D-class_method" title="BasicSocket.do_not_reverse_lookup= (method)">.do_not_reverse_lookup=</a>, <a href="BasicSocket.html#do_not_reverse_lookup%3D-instance_method" title="BasicSocket#do_not_reverse_lookup= (method)">#do_not_reverse_lookup=</a>, <a href="BasicSocket.html#for_fd-class_method" title="BasicSocket.for_fd (method)">.for_fd</a>, <a href="BasicSocket.html#getpeereid-instance_method" title="BasicSocket#getpeereid (method)">#getpeereid</a>, <a href="BasicSocket.html#getpeername-instance_method" title="BasicSocket#getpeername (method)">#getpeername</a>, <a href="BasicSocket.html#getsockname-instance_method" title="BasicSocket#getsockname (method)">#getsockname</a>, <a href="BasicSocket.html#getsockopt-instance_method" title="BasicSocket#getsockopt (method)">#getsockopt</a>, <a href="BasicSocket.html#local_address-instance_method" title="BasicSocket#local_address (method)">#local_address</a>, <a href="BasicSocket.html#recv-instance_method" title="BasicSocket#recv (method)">#recv</a>, <a href="BasicSocket.html#recv_nonblock-instance_method" title="BasicSocket#recv_nonblock (method)">#recv_nonblock</a>, <a href="BasicSocket.html#recvmsg-instance_method" title="BasicSocket#recvmsg (method)">#recvmsg</a>, <a href="BasicSocket.html#recvmsg_nonblock-instance_method" title="BasicSocket#recvmsg_nonblock (method)">#recvmsg_nonblock</a>, <a href="BasicSocket.html#remote_address-instance_method" title="BasicSocket#remote_address (method)">#remote_address</a>, <a href="BasicSocket.html#send-instance_method" title="BasicSocket#send (method)">#send</a>, <a href="BasicSocket.html#sendmsg-instance_method" title="BasicSocket#sendmsg (method)">#sendmsg</a>, <a href="BasicSocket.html#sendmsg_nonblock-instance_method" title="BasicSocket#sendmsg_nonblock (method)">#sendmsg_nonblock</a>, <a href="BasicSocket.html#setsockopt-instance_method" title="BasicSocket#setsockopt (method)">#setsockopt</a>, <a href="BasicSocket.html#shutdown-instance_method" title="BasicSocket#shutdown (method)">#shutdown</a></p>

  <h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(domain, socktype[, protocol])  &#x21d2; <tt>socket</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a new socket object.</p>

<p><em>domain</em> should be a communications domain such as: :INET, :INET6,
:UNIX, etc.</p>

<p><em>socktype</em> should be a socket type such as: :STREAM, :DGRAM, :RAW,
etc.</p>

<p><em>protocol</em> is optional and should be a protocol defined in the
domain. If protocol is not given, 0 is used internally.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='rparen'>)</span> <span class='comment'># TCP socket
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:DGRAM</span><span class='rparen'>)</span>  <span class='comment'># UDP socket
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='rparen'>)</span> <span class='comment'># UNIX stream socket
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:DGRAM</span><span class='rparen'>)</span>  <span class='comment'># UNIX datagram socket
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L132'>GitHub</a> ]</span>

</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="accept_loop-class_method">
  <h3 class='signature first'>
  .<strong>accept_loop</strong>(*sockets)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>yield socket and client address for each a connection accepted via given
sockets.</p>

<p>The arguments are a list of sockets. The individual argument should be a
socket or an array of sockets.</p>

<p>This method yields the block sequentially. It means that the next
connection is not accepted until the block returns. So concurrent
mechanism, thread for example, should be used to service multiple clients
at a time.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L794'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


794
795
796
797
798
799
800
801
802
803
804
805
806
807</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 794</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_accept_loop'>accept_loop</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_sockets'>sockets</span><span class='rparen'>)</span> <span class='comment'># :yield: socket, client_addrinfo
</span>  <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_flatten!'>flatten!</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no sockets</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_readable'>readable</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_readable'>readable</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
      <span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_accept_nonblock'>accept_nonblock</span><span class='lparen'>(</span><span class='label'>exception:</span> <span class='kw'>false</span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_sock'>sock</span> <span class='op'>==</span> <span class='symbol'>:wait_readable</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_addr'>addr</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="getaddrinfo-class_method">
  <h3 class='signature'>
  .<strong>getaddrinfo</strong>(nodename, servname[, family[, socktype[, protocol[, flags[, reverse_lookup]]]]])  &#x21d2; <tt>Array</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Obtains address information for <em>nodename</em>:<em>servname</em>.</p>

<p><em>family</em> should be an address family such as: :INET, :INET6, etc.</p>

<p><em>socktype</em> should be a socket type such as: :STREAM, :DGRAM, :RAW,
etc.</p>

<p><em>protocol</em> should be a protocol defined in the family, and defaults
to 0 for the family.</p>

<p><em>flags</em> should be bitwise OR of Socket::AI_* constants.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getaddrinfo'>getaddrinfo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [[&quot;AF_INET&quot;, 80, &quot;carbon.ruby-lang.org&quot;, &quot;221.186.184.68&quot;, 2, 1, 6]] # PF_INET/SOCK_STREAM/IPPROTO_TCP
</span>
<span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getaddrinfo'>getaddrinfo</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [[&quot;AF_INET&quot;, 0, &quot;localhost&quot;, &quot;127.0.0.1&quot;, 2, 1, 6],  # PF_INET/SOCK_STREAM/IPPROTO_TCP
</span><span class='comment'>#    [&quot;AF_INET&quot;, 0, &quot;localhost&quot;, &quot;127.0.0.1&quot;, 2, 2, 17], # PF_INET/SOCK_DGRAM/IPPROTO_UDP
</span><span class='comment'>#    [&quot;AF_INET&quot;, 0, &quot;localhost&quot;, &quot;127.0.0.1&quot;, 2, 3, 0]]  # PF_INET/SOCK_RAW/IPPROTO_IP
</span></code></pre>

<p><em>reverse_lookup</em> directs the form of the third element, and has to
be one of below.  If <em>reverse_lookup</em> is omitted, the default value
is <code>nil</code>.</p>

<pre class="code ruby"><code class="ruby">true, :hostname:  hostname is obtained from numeric address using reverse lookup, which may take a time.
false, :numeric:  hostname is same as numeric address.
nil:              obey to the current do_not_reverse_lookup flag.</code></pre>

<p>If Addrinfo object is preferred, use <a href="Addrinfo.html#getaddrinfo-class_method" title="Addrinfo.getaddrinfo (method)">Addrinfo.getaddrinfo</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1166'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="gethostbyaddr-class_method">
  <h3 class='signature'>
  .<strong>gethostbyaddr</strong>(address_string[, address_family])  &#x21d2; <tt>hostent</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Obtains the host information for <em>address</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_gethostbyaddr'>gethostbyaddr</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='int'>221</span><span class='comma'>,</span><span class='int'>186</span><span class='comma'>,</span><span class='int'>184</span><span class='comma'>,</span><span class='int'>68</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CCCC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [&quot;carbon.ruby-lang.org&quot;, [], 2, &quot;\xDD\xBA\xB8D&quot;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1008'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="gethostbyname-class_method">
  <h3 class='signature'>
  .<strong>gethostbyname</strong>(hostname)  &#x21d2; <tt>Array</tt>, ... 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Obtains the host information for <em>hostname</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_gethostbyname'>gethostbyname</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hal</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; [&quot;localhost&quot;, [&quot;hal&quot;], 2, &quot;\x7F\x00\x00\x01&quot;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L991'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="gethostname-class_method">
  <h3 class='signature'>
  .<strong>gethostname</strong>  &#x21d2; <tt>hostname</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the hostname.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_gethostname'>gethostname</span> <span class='comment'>#=&gt; &quot;hal&quot;
</span></code></pre>

<p>Note that it is not guaranteed to be able to convert to IP address using
gethostbyname, getaddrinfo, etc. If you need local IP address, use
<a href="#ip_address_list-class_method" title="Socket.ip_address_list (method)">ip_address_list</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L885'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="getifaddrs-class_method">
  <h3 class='signature'>
  .<strong>getifaddrs</strong>  &#x21d2; <tt>Array</tt>, <tt>...</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an array of interface addresses. An element of the array is an
instance of <a href="Socket/Ifaddr.html" title="Socket::Ifaddr (class)">Ifaddr</a>.</p>

<p>This method can be used to find multicast-enabled interfaces:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pp'>pp</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getifaddrs'>getifaddrs</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='op'>|</span>
  <span class='op'>!</span><span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='period'>.</span><span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_ip?'>ip?</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='period'>.</span><span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IFF_MULTICAST</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='period'>.</span><span class='id identifier rubyid_ifindex'>ifindex</span><span class='comma'>,</span> <span class='id identifier rubyid_ifaddr'>ifaddr</span><span class='period'>.</span><span class='id identifier rubyid_addr'>addr</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='comment'>#=&gt; [[&quot;eth0&quot;, 2, #&lt;Addrinfo: 221.186.184.67&gt;],
</span><span class='comment'>#    [&quot;eth0&quot;, 2, #&lt;Addrinfo: fe80::216:3eff:fe95:88bb%eth0&gt;]]
</span></code></pre>

<p>Example result on GNU/Linux:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pp'>pp</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getifaddrs'>getifaddrs</span>
<span class='comment'>#=&gt; [#&lt;Socket::Ifaddr lo UP,LOOPBACK,RUNNING,0x10000 PACKET[protocol=0 lo hatype=772 HOST hwaddr=00:00:00:00:00:00]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr eth0 UP,BROADCAST,RUNNING,MULTICAST,0x10000 PACKET[protocol=0 eth0 hatype=1 HOST hwaddr=00:16:3e:95:88:bb] broadcast=PACKET[protocol=0 eth0 hatype=1 HOST hwaddr=ff:ff:ff:ff:ff:ff]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr sit0 NOARP PACKET[protocol=0 sit0 hatype=776 HOST hwaddr=00:00:00:00]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr lo UP,LOOPBACK,RUNNING,0x10000 127.0.0.1 netmask=255.0.0.0&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr eth0 UP,BROADCAST,RUNNING,MULTICAST,0x10000 221.186.184.67 netmask=255.255.255.240 broadcast=221.186.184.79&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr lo UP,LOOPBACK,RUNNING,0x10000 ::1 netmask=ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr eth0 UP,BROADCAST,RUNNING,MULTICAST,0x10000 fe80::216:3eff:fe95:88bb%eth0 netmask=ffff:ffff:ffff:ffff::&gt;]
</span></code></pre>

<p>Example result on FreeBSD:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pp'>pp</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getifaddrs'>getifaddrs</span>
<span class='comment'>#=&gt; [#&lt;Socket::Ifaddr usbus0 UP,0x10000 LINK[usbus0]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr re0 UP,BROADCAST,RUNNING,MULTICAST,0x800 LINK[re0 3a:d0:40:9a:fe:e8]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr re0 UP,BROADCAST,RUNNING,MULTICAST,0x800 10.250.10.18 netmask=255.255.255.? (7 bytes for 16 bytes sockaddr_in) broadcast=10.250.10.255&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr re0 UP,BROADCAST,RUNNING,MULTICAST,0x800 fe80:2::38d0:40ff:fe9a:fee8 netmask=ffff:ffff:ffff:ffff::&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr re0 UP,BROADCAST,RUNNING,MULTICAST,0x800 2001:2e8:408:10::12 netmask=UNSPEC&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr plip0 POINTOPOINT,MULTICAST,0x800 LINK[plip0]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr lo0 UP,LOOPBACK,RUNNING,MULTICAST LINK[lo0]&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr lo0 UP,LOOPBACK,RUNNING,MULTICAST ::1 netmask=ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr lo0 UP,LOOPBACK,RUNNING,MULTICAST fe80:4::1 netmask=ffff:ffff:ffff:ffff::&gt;,
</span><span class='comment'>#    #&lt;Socket::Ifaddr lo0 UP,LOOPBACK,RUNNING,MULTICAST 127.0.0.1 netmask=255.?.?.? (5 bytes for 16 bytes sockaddr_in)&gt;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/ifaddr.c#L429'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="getnameinfo-class_method">
  <h3 class='signature'>
  .<strong>getnameinfo</strong>(sockaddr[, flags])  &#x21d2; <tt>Array</tt>, <tt>servicename</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Obtains name information for <em>sockaddr</em>.</p>

<p><em>sockaddr</em> should be one of follows.</p>
<ul><li>
<p>packed sockaddr string such as Socket.sockaddr_in(80, 127.0.0.1)</p>
</li><li>
<p>3-elements array such as [AF_INET, 80, 127.0.0.1]</p>
</li><li>
<p>4-elements array such as [AF_INET, 80, ignored, 127.0.0.1]</p>
</li></ul>

<p><em>flags</em> should be bitwise OR of Socket::NI_* constants.</p>

<p>Note: The last form is compatible with <a href="IPSocket.html#addr-instance_method" title="IPSocket#addr (method)">IPSocket#addr</a> and
<a href="IPSocket.html#peeraddr-instance_method" title="IPSocket#peeraddr (method)">IPSocket#peeraddr</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getnameinfo'>getnameinfo</span><span class='lparen'>(</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>       <span class='comment'>#=&gt; [&quot;localhost&quot;, &quot;www&quot;]
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getnameinfo'>getnameinfo</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>              <span class='comment'>#=&gt; [&quot;localhost&quot;, &quot;www&quot;]
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getnameinfo'>getnameinfo</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AF_INET</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'>#=&gt; [&quot;localhost&quot;, &quot;www&quot;]
</span></code></pre>

<p>If Addrinfo object is preferred, use <a href="Addrinfo.html#getnameinfo-instance_method" title="Addrinfo#getnameinfo (method)">Addrinfo#getnameinfo</a>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1220'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="getservbyname-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>getservbyname</strong>(service_name)  &#x21d2; <tt>port_number</tt> </span>
    <span class='overload'>.<strong>getservbyname</strong>(service_name, protocol_name)  &#x21d2; <tt>port_number</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Obtains the port number for <em>service_name</em>.</p>

<p>If <em>protocol_name</em> is not given, tcp is assumed.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getservbyname'>getservbyname</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>smtp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>          <span class='comment'>#=&gt; 25
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getservbyname'>getservbyname</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>shell</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>         <span class='comment'>#=&gt; 514
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getservbyname'>getservbyname</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>syslog</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>udp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; 514
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1070'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="getservbyport-class_method">
  <h3 class='signature'>
  .<strong>getservbyport</strong>(port[, protocol_name])  &#x21d2; <tt>service</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Obtains the port number for <em>port</em>.</p>

<p>If <em>protocol_name</em> is not given, tcp is assumed.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getservbyport'>getservbyport</span><span class='lparen'>(</span><span class='int'>80</span><span class='rparen'>)</span>         <span class='comment'>#=&gt; &quot;www&quot;
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getservbyport'>getservbyport</span><span class='lparen'>(</span><span class='int'>514</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tcp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;shell&quot;
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_getservbyport'>getservbyport</span><span class='lparen'>(</span><span class='int'>514</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>udp</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;syslog&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1111'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="ip_address_list-class_method">
  <h3 class='signature'>
  .<strong>ip_address_list</strong>  &#x21d2; <tt>Array</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns local IP addresses as an array.</p>

<p>The array contains Addrinfo objects.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pp'>pp</span> <span class='lbrace'>{</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_ip_address_list'>ip_address_list</span><span class='rbrace'>}</span>
<span class='comment'>#=&gt; [#&lt;Addrinfo: 127.0.0.1&gt;,
</span>     <span class='comment'>#&lt;Addrinfo: 192.168.0.128&gt;,
</span>     <span class='comment'>#&lt;Addrinfo: ::1&gt;,
</span>     <span class='comment'>#...]</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1593'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="ip_sockets_port0-class_method">
  <h3 class='signature'>
  .<strong>ip_sockets_port0</strong>(ai_list, reuseaddr)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>:stopdoc:</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L663'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 663</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ip_sockets_port0'>ip_sockets_port0</span><span class='lparen'>(</span><span class='id identifier rubyid_ai_list'>ai_list</span><span class='comma'>,</span> <span class='id identifier rubyid_reuseaddr'>reuseaddr</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_ai_list'>ai_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ai'>ai</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>SystemCallError</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_s'>s</span>
      <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_ipv6only!'>ipv6only!</span> <span class='kw'>if</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ipv6?'>ipv6?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_reuseaddr'>reuseaddr</span>
        <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:REUSEADDR</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_port'>port</span>
        <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='id identifier rubyid_ai'>ai</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_family_addrinfo'>family_addrinfo</span><span class='lparen'>(</span><span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EADDRINUSE</span>
    <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='rbrace'>}</span>
    <span class='kw'>retry</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span>
    <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_sockets'>sockets</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="pack_sockaddr_in-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>sockaddr_in</strong>(port, host)  &#x21d2; <tt>sockaddr</tt> </span>
    <span class='overload'>.<strong>pack_sockaddr_in</strong>(port, host)  &#x21d2; <tt>sockaddr</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="pack_sockaddr_un-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>sockaddr_un</strong>(path)  &#x21d2; <tt>sockaddr</tt> </span>
    <span class='overload'>.<strong>pack_sockaddr_un</strong>(path)  &#x21d2; <tt>sockaddr</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#sockaddr_un-class_method" title="Socket.sockaddr_un (method)">sockaddr_un</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="pair-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>pair</strong>(domain, type, protocol)  &#x21d2; <tt>Array</tt>, <tt>socket2</tt> </span>
    <span class='overload'>.<strong>socketpair</strong>(domain, type, protocol)  &#x21d2; <tt>Array</tt>, <tt>socket2</tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>socketpair</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a pair of sockets connected each other.</p>

<p><em>domain</em> should be a communications domain such as: :INET, :INET6,
:UNIX, etc.</p>

<p><em>socktype</em> should be a socket type such as: :STREAM, :DGRAM, :RAW,
etc.</p>

<p><em>protocol</em> should be a protocol defined in the domain, defaults to 0
for the domain.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'>pair</span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;ab&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;&quot;
</span>
<span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pair'>pair</span><span class='lparen'>(</span><span class='symbol'>:UNIX</span><span class='comma'>,</span> <span class='symbol'>:DGRAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;a&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;b&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L280'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="sockaddr_in-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>sockaddr_in</strong>(port, host)  &#x21d2; <tt>sockaddr</tt> </span>
    <span class='overload'>.<strong>pack_sockaddr_in</strong>(port, host)  &#x21d2; <tt>sockaddr</tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>pack_sockaddr_in</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Packs <em>port</em> and <em>host</em> as an AF_INET/AF_INET6 sockaddr
string.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'>sockaddr_in</span><span class='lparen'>(</span><span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; &quot;\x02\x00\x00P\x7F\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00&quot;
</span>
<span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'>sockaddr_in</span><span class='lparen'>(</span><span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; &quot;\n\x00\x00P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1371'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="sockaddr_un-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>sockaddr_un</strong>(path)  &#x21d2; <tt>sockaddr</tt> </span>
    <span class='overload'>.<strong>pack_sockaddr_un</strong>(path)  &#x21d2; <tt>sockaddr</tt> </span>
  <span class='aliases'>Also known as: <span class='names'><span>pack_sockaddr_un</span></span>
  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Packs <em>path</em> as an AF_UNIX sockaddr string.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_un'>sockaddr_un</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;\x01\x00/tmp/sock\x00\x00...&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1437'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="socketpair-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>pair</strong>(domain, type, protocol)  &#x21d2; <tt>Array</tt>, <tt>socket2</tt> </span>
    <span class='overload'>.<strong>socketpair</strong>(domain, type, protocol)  &#x21d2; <tt>Array</tt>, <tt>socket2</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Alias for <a href="#pair-class_method" title="Socket.pair (method)">pair</a>.</p>


  </div>
</div>

</section>
  <section class='method_details' id="tcp-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>tcp</strong>(host, port, local_host = nil, local_port = nil, [opts]) {|socket| ... } </span>
    <span class='overload'>.<strong>tcp</strong>(host, port, local_host = nil, local_port = nil, [opts])  </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates a new socket object connected to host:port using TCP/IP.</p>

<p>If local_host:local_port is given, the socket is bound to it.</p>

<p>The optional last argument <em>opts</em> is options represented by a hash.
<em>opts</em> may have following options:</p>
<dl class="rdoc-list label-list"><dt>:connect_timeout
<dd>
<p>specify the timeout in seconds.</p>
</dd></dl>

<p>If a block is given, the block is called with the socket. The value of the
block is returned. The socket is closed when this method returns.</p>

<p>If no block is given, the socket is returned.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp'>tcp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>www.ruby-lang.org</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>80</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.0\r\nHost: www.ruby-lang.org\r\n\r\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_close_write'>close_write</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<tt>ArgumentError</tt>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L612'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 612</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_tcp'>tcp</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span> <span class='comment'># :yield: socket
</span>  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>?</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong number of arguments (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> for 2)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='int'>2</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_rest'>rest</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_local_host'>local_host</span><span class='comma'>,</span> <span class='id identifier rubyid_local_port'>local_port</span> <span class='op'>=</span> <span class='id identifier rubyid_rest'>rest</span>
  <span class='id identifier rubyid_last_error'>last_error</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_connect_timeout'>connect_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:connect_timeout</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_local_addr_list'>local_addr_list</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_local_host'>local_host</span> <span class='op'>!=</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='id identifier rubyid_local_port'>local_port</span> <span class='op'>!=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_local_addr_list'>local_addr_list</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_getaddrinfo'><a href="Addrinfo.html#getaddrinfo-class_method" title="Addrinfo.getaddrinfo (method)">getaddrinfo</a></span><span class='lparen'>(</span><span class='id identifier rubyid_local_host'>local_host</span><span class='comma'>,</span> <span class='id identifier rubyid_local_port'>local_port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_foreach'><a href="Addrinfo.html#foreach-class_method" title="Addrinfo.foreach (method)">foreach</a></span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ai'>ai</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_local_addr_list'>local_addr_list</span>
      <span class='id identifier rubyid_local_addr'>local_addr</span> <span class='op'>=</span> <span class='id identifier rubyid_local_addr_list'>local_addr_list</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_local_ai'>local_ai</span><span class='op'>|</span> <span class='id identifier rubyid_local_ai'>local_ai</span><span class='period'>.</span><span class='id identifier rubyid_afamily'>afamily</span> <span class='op'>==</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_afamily'>afamily</span> <span class='rbrace'>}</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_local_addr'>local_addr</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_local_addr'>local_addr</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='id identifier rubyid_local_addr'>local_addr</span> <span class='op'>?</span>
        <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_connect_from'>connect_from</span><span class='lparen'>(</span><span class='id identifier rubyid_local_addr'>local_addr</span><span class='comma'>,</span> <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='rparen'>)</span> <span class='op'>:</span>
        <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span><span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>SystemCallError</span>
      <span class='id identifier rubyid_last_error'>last_error</span> <span class='op'>=</span> <span class='gvar'>$!</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>
    <span class='kw'>break</span>
  <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_ret'>ret</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_last_error'>last_error</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_last_error'>last_error</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="SocketError.html" title="SocketError (class)">SocketError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no appropriate local address</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_ret'>ret</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ret'>ret</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="tcp_server_loop-class_method">
  <h3 class='signature'>
  .<strong>tcp_server_loop</strong>(host = nil, port, &amp;b)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates a TCP/IP server on <em>port</em> and calls the block for each
connection accepted. The block is called with a socket and a client_address
as an Addrinfo object.</p>

<p>If <em>host</em> is specified, it is used with <em>port</em> to determine
the server addresses.</p>

<p>The socket is <strong>not</strong> closed when the block returns. So
application should close it explicitly.</p>

<p>This method calls the block sequentially. It means that the next connection
is not accepted until the block returns. So concurrent mechanism, thread
for example, should be used to service multiple clients at a time.</p>

<p>Note that <a href="Addrinfo.html#getaddrinfo-class_method" title="Addrinfo.getaddrinfo (method)">Addrinfo.getaddrinfo</a> is used to determine the server socket
addresses. When <a href="Addrinfo.html#getaddrinfo-class_method" title="Addrinfo.getaddrinfo (method)">Addrinfo.getaddrinfo</a> returns two or more addresses, IPv4
and IPv6 address for example, all of them are used.
<a href="#tcp_server_loop-class_method" title="Socket.tcp_server_loop (method)">tcp_server_loop</a> succeeds if one socket can be used at least.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Sequential echo server.
</span><span class='comment'># It services only one client at a time.
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_loop'>tcp_server_loop</span><span class='lparen'>(</span><span class='int'>16807</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span>

<span class='comment'># Threaded echo server
</span><span class='comment'># It services multiple clients at a time.
</span><span class='comment'># Note that it may accept connections too much.
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_loop'>tcp_server_loop</span><span class='lparen'>(</span><span class='int'>16807</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span><span class='op'>|</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span>
    <span class='kw'>begin</span>
      <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L850'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


850
851
852
853
854</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 850</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_loop'>tcp_server_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='comment'># :yield: socket, client_addrinfo
</span>  <span class='id identifier rubyid_tcp_server_sockets'>tcp_server_sockets</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sockets'>sockets</span><span class='op'>|</span>
    <span class='id identifier rubyid_accept_loop'>accept_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="tcp_server_sockets-class_method">
  <h3 class='signature'>
  .<strong>tcp_server_sockets</strong>(host = nil, port)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates TCP/IP server sockets for <em>host</em> and <em>port</em>.
<em>host</em> is optional.</p>

<p>If no block given, it returns an array of listening sockets.</p>

<p>If a block is given, the block is called with the sockets. The value of the
block is returned. The socket is closed when this method returns.</p>

<p>If <em>port</em> is 0, actual port number is chosen dynamically. However
all sockets in the result has same port number.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># tcp_server_sockets returns two sockets.
</span><span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_sockets'>tcp_server_sockets</span><span class='lparen'>(</span><span class='int'>1296</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sockets'>sockets</span> <span class='comment'>#=&gt; [#&lt;Socket:fd 3&gt;, #&lt;Socket:fd 4&gt;]
</span>
<span class='comment'># The sockets contains IPv6 and IPv4 sockets.
</span><span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span> <span class='rbrace'>}</span>
<span class='comment'>#=&gt; #&lt;Addrinfo: [::]:1296 TCP&gt;
</span><span class='comment'>#   #&lt;Addrinfo: 0.0.0.0:1296 TCP&gt;
</span>
<span class='comment'># IPv6 and IPv4 socket has same port number, 53114, even if it is chosen dynamically.
</span><span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_sockets'>tcp_server_sockets</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span> <span class='rbrace'>}</span>
<span class='comment'>#=&gt; #&lt;Addrinfo: [::]:53114 TCP&gt;
</span><span class='comment'>#   #&lt;Addrinfo: 0.0.0.0:53114 TCP&gt;
</span>
<span class='comment'># The block is called with the sockets.
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_sockets'>tcp_server_sockets</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sockets'>sockets</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sockets'>sockets</span> <span class='comment'>#=&gt; [#&lt;Socket:fd 3&gt;, #&lt;Socket:fd 4&gt;]
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L750'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 750</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_sockets'>tcp_server_sockets</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='id identifier rubyid_tcp_server_sockets_port0'>tcp_server_sockets_port0</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_last_error'>last_error</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>begin</span>
      <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_foreach'><a href="Addrinfo.html#foreach-class_method" title="Addrinfo.foreach (method)">foreach</a></span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AI_PASSIVE</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ai'>ai</span><span class='op'>|</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span>
        <span class='kw'>rescue</span> <span class='const'>SystemCallError</span>
          <span class='id identifier rubyid_last_error'>last_error</span> <span class='op'>=</span> <span class='gvar'>$!</span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_s'>s</span>
      <span class='rbrace'>}</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_last_error'>last_error</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span>
      <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_raise'>raise</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_sockets'>sockets</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sockets'>sockets</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="tcp_server_sockets_port0-class_method">
  <h3 class='signature'>
  .<strong>tcp_server_sockets_port0</strong>(host)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L699'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


699
700
701
702
703
704
705
706
707
708
709
710
711</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 699</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_tcp_server_sockets_port0'>tcp_server_sockets_port0</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ai_list'>ai_list</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_getaddrinfo'><a href="Addrinfo.html#getaddrinfo-class_method" title="Addrinfo.getaddrinfo (method)">getaddrinfo</a></span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AI_PASSIVE</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='id identifier rubyid_ip_sockets_port0'>ip_sockets_port0</span><span class='lparen'>(</span><span class='id identifier rubyid_ai_list'>ai_list</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
      <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>SOMAXCONN</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span>
    <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_sockets'>sockets</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="udp_server_loop-class_method">
  <h3 class='signature'>
  <span class='overload'>.<strong>udp_server_loop</strong>(port) {|msg, msg_src| ... } </span>
    <span class='overload'>.<strong>udp_server_loop</strong>(host, port) {|msg, msg_src| ... } </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates a UDP/IP server on <em>port</em> and calls the block for each
message arrived. The block is called with the message and its source
information.</p>

<p>This method allocates sockets internally using <em>port</em>. If
<em>host</em> is specified, it is used conjunction with <em>port</em> to
determine the server addresses.</p>

<p>The <em>msg</em> is a string.</p>

<p>The <em>msg_src</em> is a <a href="Socket/UDPSource.html" title="Socket::UDPSource (class)">UDPSource</a> object. It is used for reply.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># UDP/IP echo server.
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_udp_server_loop'>udp_server_loop</span><span class='lparen'>(</span><span class='int'>9261</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_msg_src'>msg_src</span><span class='op'>|</span>
  <span class='id identifier rubyid_msg_src'>msg_src</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span> <span class='id identifier rubyid_msg'>msg</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L1019'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1019
1020
1021
1022
1023</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 1019</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_udp_server_loop'>udp_server_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='comment'># :yield: message, message_source
</span>  <span class='id identifier rubyid_udp_server_sockets'>udp_server_sockets</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sockets'>sockets</span><span class='op'>|</span>
    <span class='id identifier rubyid_udp_server_loop_on'>udp_server_loop_on</span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="udp_server_loop_on-class_method">
  <h3 class='signature'>
  .<strong>udp_server_loop_on</strong>(sockets) {|msg, msg_src| ... } 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Run UDP/IP server loop on the given sockets.</p>

<p>The return value of <a href="#udp_server_sockets-class_method" title="Socket.udp_server_sockets (method)">udp_server_sockets</a> is appropriate for the
argument.</p>

<p>It calls the block for each message received.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L992'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


992
993
994
995
996
997</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 992</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_udp_server_loop_on'>udp_server_loop_on</span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='comment'># :yield: msg, msg_src
</span>  <span class='id identifier rubyid_loop'>loop</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_readable'>readable</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_udp_server_recv'>udp_server_recv</span><span class='lparen'>(</span><span class='id identifier rubyid_readable'>readable</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="udp_server_recv-class_method">
  <h3 class='signature'>
  .<strong>udp_server_recv</strong>(sockets) {|msg, msg_src| ... } 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Receive UDP/IP packets from the given <em>sockets</em>. For each packet
received, the block is called.</p>

<p>The block receives <em>msg</em> and <em>msg_src</em>. <em>msg</em> is a
string which is the payload of the received packet. <em>msg_src</em> is a
<a href="Socket/UDPSource.html" title="Socket::UDPSource (class)">UDPSource</a> object which is used for reply.</p>

<p><a href="#udp_server_loop-class_method" title="Socket.udp_server_loop (method)">udp_server_loop</a> can be implemented using this method as follows.</p>

<pre class="code ruby"><code class="ruby">udp_server_sockets(host, port) {|sockets|
  loop {
    readable, _, _ = IO.select(sockets)
    udp_server_recv(readable) {|msg, msg_src| ... }
  }
}</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L965'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 965</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_udp_server_recv'>udp_server_recv</span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
    <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_sender_addrinfo'>sender_addrinfo</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_controls'>controls</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_recvmsg_nonblock'>recvmsg_nonblock</span><span class='lparen'>(</span><span class='label'>exception:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_msg'>msg</span> <span class='op'>==</span> <span class='symbol'>:wait_readable</span>
    <span class='id identifier rubyid_ai'>ai</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ipv6?'>ipv6?</span> <span class='kw'>and</span> <span class='id identifier rubyid_pktinfo'>pktinfo</span> <span class='op'>=</span> <span class='id identifier rubyid_controls'>controls</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_cmsg_is?'>cmsg_is?</span><span class='lparen'>(</span><span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:PKTINFO</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_ai'>ai</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_udp'><a href="Addrinfo.html#udp-class_method" title="Addrinfo.udp (method)">udp</a></span><span class='lparen'>(</span><span class='id identifier rubyid_pktinfo'>pktinfo</span><span class='period'>.</span><span class='id identifier rubyid_ipv6_pktinfo_addr'>ipv6_pktinfo_addr</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span><span class='rparen'>)</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='const'><a href="Socket/UDPSource.html" title="Socket::UDPSource (class)">UDPSource</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Socket/UDPSource.html#new-class_method" title="Socket::UDPSource.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_sender_addrinfo'>sender_addrinfo</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_reply_msg'>reply_msg</span><span class='op'>|</span>
        <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_sendmsg'>sendmsg</span> <span class='id identifier rubyid_reply_msg'>reply_msg</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_sender_addrinfo'>sender_addrinfo</span><span class='comma'>,</span> <span class='id identifier rubyid_pktinfo'>pktinfo</span>
      <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='const'><a href="Socket/UDPSource.html" title="Socket::UDPSource (class)">UDPSource</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Socket/UDPSource.html#new-class_method" title="Socket::UDPSource.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_sender_addrinfo'>sender_addrinfo</span><span class='comma'>,</span> <span class='id identifier rubyid_ai'>ai</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_reply_msg'>reply_msg</span><span class='op'>|</span>
        <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='id identifier rubyid_reply_msg'>reply_msg</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_sender_addrinfo'>sender_addrinfo</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="udp_server_sockets-class_method">
  <h3 class='signature'>
  .<strong>udp_server_sockets</strong>([host, ])  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates UDP/IP sockets for a UDP server.</p>

<p>If no block given, it returns an array of sockets.</p>

<p>If a block is given, the block is called with the sockets. The value of the
block is returned. The sockets are closed when this method returns.</p>

<p>If <em>port</em> is zero, some port is chosen. But the chosen port is used
for the all sockets.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># UDP/IP echo server
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_udp_server_sockets'>udp_server_sockets</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sockets'>sockets</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span><span class='period'>.</span><span class='id identifier rubyid_ip_port'>ip_port</span>     <span class='comment'>#=&gt; 32963
</span>  <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_udp_server_loop_on'><a href="#udp_server_loop_on-class_method" title="Socket.udp_server_loop_on (method)">udp_server_loop_on</a></span><span class='lparen'>(</span><span class='id identifier rubyid_sockets'>sockets</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_msg_src'>msg_src</span><span class='op'>|</span>
    <span class='id identifier rubyid_msg_src'>msg_src</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span> <span class='id identifier rubyid_msg'>msg</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L878'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 878</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_udp_server_sockets'>udp_server_sockets</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_last_error'>last_error</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_ipv6_recvpktinfo'>ipv6_recvpktinfo</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'><a href="Socket/AncillaryData.html" title="Socket::AncillaryData (class)">AncillaryData</a></span>
    <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPV6_RECVPKTINFO</span> <span class='comment'># RFC 3542
</span>      <span class='id identifier rubyid_ipv6_recvpktinfo'>ipv6_recvpktinfo</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPV6_RECVPKTINFO</span>
    <span class='kw'>elsif</span> <span class='kw'>defined?</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPV6_PKTINFO</span> <span class='comment'># RFC 2292
</span>      <span class='id identifier rubyid_ipv6_recvpktinfo'>ipv6_recvpktinfo</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPV6_PKTINFO</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_local_addrs'>local_addrs</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_ip_address_list'><a href="#ip_address_list-class_method" title="Socket.ip_address_list (method)">ip_address_list</a></span>

  <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_foreach'><a href="Addrinfo.html#foreach-class_method" title="Addrinfo.foreach (method)">foreach</a></span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:DGRAM</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>AI_PASSIVE</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ai'>ai</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ipv4?'>ipv4?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_local_addrs'>local_addrs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_ipv4?'>ipv4?</span>
        <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_sockaddr'>to_sockaddr</span><span class='comma'>,</span> <span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:DGRAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='semicolon'>;</span>
      <span class='rbrace'>}</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ipv6?'>ipv6?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_ipv6_recvpktinfo'>ipv6_recvpktinfo</span>
      <span class='id identifier rubyid_local_addrs'>local_addrs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_ipv6?'>ipv6?</span>
        <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Addrinfo.html#new-class_method" title="Addrinfo.new (method)">new</a></span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_to_sockaddr'>to_sockaddr</span><span class='comma'>,</span> <span class='symbol'>:INET6</span><span class='comma'>,</span> <span class='symbol'>:DGRAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='semicolon'>;</span>
      <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_ip_list'>ip_list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ai'>ai</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>=</span> <span class='id identifier rubyid_ip_sockets_port0'>ip_sockets_port0</span><span class='lparen'>(</span><span class='id identifier rubyid_ip_list'>ip_list</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ip_list'>ip_list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ip'>ip</span><span class='op'>|</span>
      <span class='id identifier rubyid_ai'>ai</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_udp'><a href="Addrinfo.html#udp-class_method" title="Addrinfo.udp (method)">udp</a></span><span class='lparen'>(</span><span class='id identifier rubyid_ip'>ip</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span>
      <span class='kw'>rescue</span> <span class='const'>SystemCallError</span>
        <span class='id identifier rubyid_last_error'>last_error</span> <span class='op'>=</span> <span class='gvar'>$!</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_sockets'>sockets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_s'>s</span>
    <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_last_error'>last_error</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
    <span class='id identifier rubyid_ai'>ai</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ipv6_recvpktinfo'>ipv6_recvpktinfo</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ipv6?'>ipv6?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_ai'>ai</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='id identifier rubyid_ipv6_recvpktinfo'>ipv6_recvpktinfo</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_sockets'>sockets</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_sockets'>sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_sockets'>sockets</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sockets'>sockets</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unix-class_method">
  <h3 class='signature'>
  .<strong>unix</strong>(path)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates a new socket connected to path using UNIX socket socket.</p>

<p>If a block is given, the block is called with the socket. The value of the
block is returned. The socket is closed when this method returns.</p>

<p>If no block is given, the socket is returned.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># talk to /tmp/sock socket.
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unix'>unix</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='const'>STDOUT</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='const'>STDIN</span><span class='comma'>,</span> <span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L1069'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 1069</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_unix'>unix</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='comment'># :yield: socket
</span>  <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_unix'><a href="Addrinfo.html#unix-class_method" title="Addrinfo.unix (method)">unix</a></span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='id identifier rubyid_addr'>addr</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_sock'>sock</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sock'>sock</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unix_server_loop-class_method">
  <h3 class='signature'>
  .<strong>unix_server_loop</strong>(path, &amp;b)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates a UNIX socket server on <em>path</em>. It calls the block for each
socket accepted.</p>

<p>If <em>host</em> is specified, it is used with <em>port</em> to determine
the server ports.</p>

<p>The socket is <strong>not</strong> closed when the block returns. So
application should close it.</p>

<p>This method deletes the socket file pointed by <em>path</em> at first if
the file is a socket file and it is owned by the user of the application.
This is safe only if the directory of <em>path</em> is not changed by a
malicious user. So don&#39;t use /tmp/malicious-users-directory/socket.
Note that /tmp/socket and /tmp/your-private-directory/socket is safe
assuming that /tmp has sticky bit.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Sequential echo server.
</span><span class='comment'># It services only one client at a time.
</span><span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_server_loop'>unix_server_loop</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_copy_stream'>copy_stream</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_sock'>sock</span><span class='rparen'>)</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L1156'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1156
1157
1158
1159
1160</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 1156</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_unix_server_loop'>unix_server_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span> <span class='comment'># :yield: socket, client_addrinfo
</span>  <span class='id identifier rubyid_unix_server_socket'>unix_server_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_serv'>serv</span><span class='op'>|</span>
    <span class='id identifier rubyid_accept_loop'>accept_loop</span><span class='lparen'>(</span><span class='id identifier rubyid_serv'>serv</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unix_server_socket-class_method">
  <h3 class='signature'>
  .<strong>unix_server_socket</strong>(path)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>creates a UNIX server socket on <em>path</em></p>

<p>If no block given, it returns a listening socket.</p>

<p>If a block is given, it is called with the socket and the block value is
returned. When the block exits, the socket is closed and the socket file is
removed.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_server_socket'>unix_server_socket</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/s</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_socket'>socket</span>                  <span class='comment'>#=&gt; #&lt;Socket:fd 3&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span>    <span class='comment'>#=&gt; #&lt;Addrinfo: /tmp/s SOCK_STREAM&gt;
</span>
<span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unix_server_socket'>unix_server_socket</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span>                     <span class='comment'>#=&gt; #&lt;Socket:fd 3&gt;
</span>  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span>       <span class='comment'>#=&gt; # #&lt;Addrinfo: /tmp/sock SOCK_STREAM&gt;
</span><span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L1099'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 1099</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_unix_server_socket'>unix_server_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_unix_socket_abstract_name?'>unix_socket_abstract_name?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_st'>st</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_lstat'>lstat</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_st'>st</span><span class='op'>&amp;.</span><span class='id identifier rubyid_socket?'>socket?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_st'>st</span><span class='period'>.</span><span class='id identifier rubyid_owned?'>owned?</span>
      <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span> <span class='id identifier rubyid_path'>path</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_unix'><a href="Addrinfo.html#unix-class_method" title="Addrinfo.unix (method)">unix</a></span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_s'>s</span>
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_closed?'>closed?</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_unix_socket_abstract_name?'>unix_socket_abstract_name?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
        <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span> <span class='id identifier rubyid_path'>path</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_s'>s</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unix_socket_abstract_name?-class_method">
  <h3 class='signature'>
  .<strong>unix_socket_abstract_name?</strong>(path)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L1127'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1127
1128
1129</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 1127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unix_socket_abstract_name?'>unix_socket_abstract_name?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>linux</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='const'>RUBY_PLATFORM</span> <span class='op'>&amp;&amp;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(\0|\z)</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_path'>path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unpack_sockaddr_in-class_method">
  <h3 class='signature'>
  .<strong>unpack_sockaddr_in</strong>(sockaddr)  &#x21d2; <tt>Array</tt>, <tt>ip_address</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Unpacks <em>sockaddr</em> into port and ip_address.</p>

<p><em>sockaddr</em> should be a string or an addrinfo for AF_INET/AF_INET6.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='comment'>#=&gt; &quot;\x02\x00\x00P\x7F\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unpack_sockaddr_in'>unpack_sockaddr_in</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span> <span class='comment'>#=&gt; [80, &quot;127.0.0.1&quot;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1397'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="unpack_sockaddr_un-class_method">
  <h3 class='signature'>
  .<strong>unpack_sockaddr_un</strong>(sockaddr)  &#x21d2; <tt>path</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Unpacks <em>sockaddr</em> into path.</p>

<p><em>sockaddr</em> should be a string or an addrinfo for AF_UNIX.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_un'><a href="#sockaddr_un-class_method" title="Socket.sockaddr_un (method)">sockaddr_un</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/sock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_unpack_sockaddr_un'>unpack_sockaddr_un</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span> <span class='comment'>#=&gt; &quot;/tmp/sock&quot;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L1468'>GitHub</a> ]</span>

</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="accept-instance_method">
  <h3 class='signature first'>
  #<strong>accept</strong>  &#x21d2; <tt>Array</tt>, <tt>client_addrinfo</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Accepts a next connection. Returns a new Socket object and Addrinfo object.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_serv'>serv</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span><span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_connect_address'>connect_address</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_serv'>serv</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span> <span class='comment'>#=&gt; [#&lt;Socket:fd 6&gt;, #&lt;Addrinfo: 127.0.0.1:48555 TCP&gt;]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L789'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="accept_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>accept_nonblock</strong>([options])  &#x21d2; <tt>Array</tt>, <tt>client_addrinfo</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Accepts an incoming connection using accept(2) after O_NONBLOCK is set for
the underlying file descriptor. It returns an array containing the accepted
socket for the incoming connection, <em>client_socket</em>, and an
Addrinfo, <em>client_addrinfo</em>.</p>

<h3 id="label-Example">Example</h3>

<pre class="code ruby"><code class="ruby"><span class='comment'># In one script, start this first
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span>
<span class='kw'>begin</span> <span class='comment'># emulate blocking accept
</span>  <span class='id identifier rubyid_client_socket'>client_socket</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_accept_nonblock'>accept_nonblock</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitReadable</span><span class='comma'>,</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EINTR</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_socket'>socket</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>retry</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The client said, &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_client_socket'>client_socket</span><span class='period'>.</span><span class='id identifier rubyid_readline'>readline</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_client_socket'>client_socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello from script one!</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>

<span class='comment'># In another script, start this second
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello from script 2.</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The server said, &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_readline'>readline</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<p>Refer to <a href="#accept-instance_method" title="Socket#accept (method)">#accept</a> for the exceptions that may be thrown if the call
to <em>accept_nonblock</em> fails.</p>

<p><a href="#accept_nonblock-instance_method" title="Socket#accept_nonblock (method)">#accept_nonblock</a> may raise any error corresponding to accept(2)
failure, including <code>Errno::EWOULDBLOCK</code>.</p>

<p>If the exception is <code>Errno::EWOULDBLOCK</code>, <code>Errno::EAGAIN</code>,
<code>Errno::ECONNABORTED</code> or <code>Errno::EPROTO</code>, it is extended by
<code>IO::WaitReadable</code>. So <code>IO::WaitReadable</code> can be used to rescue the
exceptions for retrying accept_nonblock.</p>

<p>By specifying <tt>exception: false</tt>, the options hash allows you to indicate
that accept_nonblock should not raise an <code>IO::WaitReadable</code> exception, but
return the symbol :wait_readable instead.</p>

<h3 id="label-See">See</h3>
<ul><li>
<p><a href="#accept-instance_method" title="Socket#accept (method)">#accept</a></p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L582'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


582
583
584</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 582</span>

<span class='kw'>def</span> <span class='id identifier rubyid_accept_nonblock'>accept_nonblock</span><span class='lparen'>(</span><span class='label'>exception:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___accept_nonblock'>__accept_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="bind-instance_method">
  <h3 class='signature'>
  #<strong>bind</strong>(local_sockaddr)  &#x21d2; <tt>0</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Binds to the given local address.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>local_sockaddr</code> - the <code>struct</code> sockaddr contained in
a string or an Addrinfo object</p>
</li></ul>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># use Addrinfo
</span><span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='symbol'>:INET</span><span class='comma'>,</span> <span class='symbol'>:STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='const'><a href="Addrinfo.html" title="Addrinfo (class)">Addrinfo</a></span><span class='period'>.</span><span class='id identifier rubyid_tcp'><a href="Addrinfo.html#tcp-class_method" title="Addrinfo.tcp (method)">tcp</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2222</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_local_address'>local_address</span> <span class='comment'>#=&gt; #&lt;Addrinfo: 127.0.0.1:2222 TCP&gt;
</span>
<span class='comment'># use struct sockaddr
</span><span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
</code></pre>

<h4 id="label-Unix-based+Exceptions">Unix-based Exceptions</h4>

<p>On unix-based based systems the following system exceptions may be raised
if the call to <em>bind</em> fails:</p>
<ul><li>
<p><code>Errno::EACCES</code> - the specified <em>sockaddr</em> is protected and the
current user does not have permission to bind to it</p>
</li><li>
<p><code>Errno::EADDRINUSE</code> - the specified <em>sockaddr</em> is already in use</p>
</li><li>
<p><code>Errno::EADDRNOTAVAIL</code> - the specified <em>sockaddr</em> is not available
from the local machine</p>
</li><li>
<p><code>Errno::EAFNOSUPPORT</code> - the specified <em>sockaddr</em> is not a valid
address for the family of the calling <code>socket</code></p>
</li><li>
<p><code>Errno::EBADF</code> - the <em>sockaddr</em> specified is not a valid file
descriptor</p>
</li><li>
<p><code>Errno::EFAULT</code> - the <em>sockaddr</em> argument cannot be accessed</p>
</li><li>
<p><code>Errno::EINVAL</code> - the <code>socket</code> is already bound to an address,
and the protocol does not support binding to the new <em>sockaddr</em> or
the <code>socket</code> has been shut down.</p>
</li><li>
<p><code>Errno::EINVAL</code> - the address length is not a valid length for the address
family</p>
</li><li>
<p><code>Errno::ENAMETOOLONG</code> - the pathname resolved had a length which exceeded
PATH_MAX</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - no buffer space is available</p>
</li><li>
<p><code>Errno::ENOSR</code> - there were insufficient STREAMS resources available to
complete the operation</p>
</li><li>
<p><code>Errno::ENOTSOCK</code> - the <code>socket</code> does not refer to a socket</p>
</li><li>
<p><code>Errno::EOPNOTSUPP</code> - the socket type of the <code>socket</code> does not
support binding to an address</p>
</li></ul>

<p>On unix-based based systems if the address family of the calling
<code>socket</code> is AF_UNIX the follow exceptions may be
raised if the call to <em>bind</em> fails:</p>
<ul><li>
<p><code>Errno::EACCES</code> - search permission is denied for a component of the prefix
path or write access to the <code>socket</code> is denied</p>
</li><li>
<p><code>Errno::EDESTADDRREQ</code> - the <em>sockaddr</em> argument is a null pointer</p>
</li><li>
<p><code>Errno::EISDIR</code> - same as <code>Errno::EDESTADDRREQ</code></p>
</li><li>
<p><code>Errno::EIO</code> - an i/o error occurred</p>
</li><li>
<p><code>Errno::ELOOP</code> - too many symbolic links were encountered in translating
the pathname in <em>sockaddr</em></p>
</li><li>
<p><code>Errno::ENAMETOOLLONG</code> - a component of a pathname exceeded NAME_MAX
characters, or an entire pathname exceeded PATH_MAX characters</p>
</li><li>
<p><code>Errno::ENOENT</code> - a component of the pathname does not name an existing
file or the pathname is an empty string</p>
</li><li>
<p><code>Errno::ENOTDIR</code> - a component of the path prefix of the pathname in
<em>sockaddr</em> is not a directory</p>
</li><li>
<p><code>Errno::EROFS</code> - the name would reside on a read only filesystem</p>
</li></ul>

<h4 id="label-Windows+Exceptions">Windows Exceptions</h4>

<p>On Windows systems the following system exceptions may be raised if the
call to <em>bind</em> fails:</p>
<ul><li>
<p>Errno::ENETDOWN the network is down</p>
</li><li>
<p><code>Errno::EACCES</code> - the attempt to connect the datagram socket to the
broadcast address failed</p>
</li><li>
<p><code>Errno::EADDRINUSE</code> - the socket&#39;s local address is already in use</p>
</li><li>
<p><code>Errno::EADDRNOTAVAIL</code> - the specified address is not a valid address for
this computer</p>
</li><li>
<p><code>Errno::EFAULT</code> - the socket&#39;s internal address or address length
parameter is too small or is not a valid part of the user space addressed</p>
</li><li>
<p><code>Errno::EINVAL</code> - the <code>socket</code> is already bound to an address</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - no buffer space is available</p>
</li><li>
<p><code>Errno::ENOTSOCK</code> - the <code>socket</code> argument does not refer to a
socket</p>
</li></ul>

<h4 id="label-See">See</h4>
<ul><li>
<p>bind manual pages on unix-based systems</p>
</li><li>
<p>bind function in Microsoft&#39;s Winsock functions reference</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L559'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="connect-instance_method">
  <h3 class='signature'>
  #<strong>connect</strong>(remote_sockaddr)  &#x21d2; <tt>0</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Requests a connection to be made on the given <code>remote_sockaddr</code>.
Returns 0 if successful, otherwise an exception is raised.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>remote_sockaddr</code> - the <code>struct</code> sockaddr contained
in a string or Addrinfo object</p>
</li></ul>

<h4 id="label-Example-3A">Example:</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Pull down Google&#39;s web page
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>www.google.com</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.0\r\n\r\n</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
</code></pre>

<h4 id="label-Unix-based+Exceptions">Unix-based Exceptions</h4>

<p>On unix-based systems the following system exceptions may be raised if the
call to <em>connect</em> fails:</p>
<ul><li>
<p><code>Errno::EACCES</code> - search permission is denied for a component of the prefix
path or write access to the <code>socket</code> is denied</p>
</li><li>
<p><code>Errno::EADDRINUSE</code> - the <em>sockaddr</em> is already in use</p>
</li><li>
<p><code>Errno::EADDRNOTAVAIL</code> - the specified <em>sockaddr</em> is not available
from the local machine</p>
</li><li>
<p><code>Errno::EAFNOSUPPORT</code> - the specified <em>sockaddr</em> is not a valid
address for the address family of the specified <code>socket</code></p>
</li><li>
<p><code>Errno::EALREADY</code> - a connection is already in progress for the specified
socket</p>
</li><li>
<p><code>Errno::EBADF</code> - the <code>socket</code> is not a valid file descriptor</p>
</li><li>
<p><code>Errno::ECONNREFUSED</code> - the target <em>sockaddr</em> was not listening for
connections refused the connection request</p>
</li><li>
<p><code>Errno::ECONNRESET</code> - the remote host reset the connection request</p>
</li><li>
<p><code>Errno::EFAULT</code> - the <em>sockaddr</em> cannot be accessed</p>
</li><li>
<p><code>Errno::EHOSTUNREACH</code> - the destination host cannot be reached (probably
because the host is down or a remote router cannot reach it)</p>
</li><li>
<p><code>Errno::EINPROGRESS</code> - the O_NONBLOCK is set for the <code>socket</code>
and the connection cannot be immediately established; the connection will
be established asynchronously</p>
</li><li>
<p><code>Errno::EINTR</code> - the attempt to establish the connection was interrupted by
delivery of a signal that was caught; the connection will be established
asynchronously</p>
</li><li>
<p><code>Errno::EISCONN</code> - the specified <code>socket</code> is already connected</p>
</li><li>
<p><code>Errno::EINVAL</code> - the address length used for the <em>sockaddr</em> is not
a valid length for the address family or there is an invalid family in
<em>sockaddr</em></p>
</li><li>
<p><code>Errno::ENAMETOOLONG</code> - the pathname resolved had a length which exceeded
PATH_MAX</p>
</li><li>
<p><code>Errno::ENETDOWN</code> - the local interface used to reach the destination is
down</p>
</li><li>
<p><code>Errno::ENETUNREACH</code> - no route to the network is present</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - no buffer space is available</p>
</li><li>
<p><code>Errno::ENOSR</code> - there were insufficient STREAMS resources available to
complete the operation</p>
</li><li>
<p><code>Errno::ENOTSOCK</code> - the <code>socket</code> argument does not refer to a
socket</p>
</li><li>
<p><code>Errno::EOPNOTSUPP</code> - the calling <code>socket</code> is listening and
cannot be connected</p>
</li><li>
<p><code>Errno::EPROTOTYPE</code> - the <em>sockaddr</em> has a different type than the
socket bound to the specified peer address</p>
</li><li>
<p><code>Errno::ETIMEDOUT</code> - the attempt to connect time out before a connection
was made.</p>
</li></ul>

<p>On unix-based systems if the address family of the calling
<code>socket</code> is AF_UNIX the follow exceptions may be raised if the
call to <em>connect</em> fails:</p>
<ul><li>
<p><code>Errno::EIO</code> - an i/o error occurred while reading from or writing to the
file system</p>
</li><li>
<p><code>Errno::ELOOP</code> - too many symbolic links were encountered in translating
the pathname in <em>sockaddr</em></p>
</li><li>
<p><code>Errno::ENAMETOOLLONG</code> - a component of a pathname exceeded NAME_MAX
characters, or an entire pathname exceeded PATH_MAX characters</p>
</li><li>
<p><code>Errno::ENOENT</code> - a component of the pathname does not name an existing
file or the pathname is an empty string</p>
</li><li>
<p><code>Errno::ENOTDIR</code> - a component of the path prefix of the pathname in
<em>sockaddr</em> is not a directory</p>
</li></ul>

<h4 id="label-Windows+Exceptions">Windows Exceptions</h4>

<p>On Windows systems the following system exceptions may be raised if the
call to <em>connect</em> fails:</p>
<ul><li>
<p><code>Errno::ENETDOWN</code> - the network is down</p>
</li><li>
<p><code>Errno::EADDRINUSE</code> - the socket&#39;s local address is already in use</p>
</li><li>
<p><code>Errno::EINTR</code> - the socket was cancelled</p>
</li><li>
<p><code>Errno::EINPROGRESS</code> - a blocking socket is in progress or the service
provider is still processing a callback function. Or a nonblocking connect
call is in progress on the <code>socket</code>.</p>
</li><li>
<p><code>Errno::EALREADY</code> - see <code>Errno::EINVAL</code></p>
</li><li>
<p><code>Errno::EADDRNOTAVAIL</code> - the remote address is not a valid address, such as
ADDR_ANY TODO check ADDRANY TO INADDR_ANY</p>
</li><li>
<p><code>Errno::EAFNOSUPPORT</code> - addresses in the specified family cannot be used
with with this <code>socket</code></p>
</li><li>
<p><code>Errno::ECONNREFUSED</code> - the target <em>sockaddr</em> was not listening for
connections refused the connection request</p>
</li><li>
<p><code>Errno::EFAULT</code> - the socket&#39;s internal address or address length
parameter is too small or is not a valid part of the user space address</p>
</li><li>
<p><code>Errno::EINVAL</code> - the <code>socket</code> is a listening socket</p>
</li><li>
<p><code>Errno::EISCONN</code> - the <code>socket</code> is already connected</p>
</li><li>
<p><code>Errno::ENETUNREACH</code> - the network cannot be reached from this host at this
time</p>
</li><li>
<p><code>Errno::EHOSTUNREACH</code> - no route to the network is present</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - no buffer space is available</p>
</li><li>
<p><code>Errno::ENOTSOCK</code> - the <code>socket</code> argument does not refer to a
socket</p>
</li><li>
<p><code>Errno::ETIMEDOUT</code> - the attempt to connect time out before a connection
was made.</p>
</li><li>
<p><code>Errno::EWOULDBLOCK</code> - the socket is marked as nonblocking and the
connection cannot be completed immediately</p>
</li><li>
<p><code>Errno::EACCES</code> - the attempt to connect the datagram socket to the
broadcast address failed</p>
</li></ul>

<h4 id="label-See">See</h4>
<ul><li>
<p>connect manual pages on unix-based systems</p>
</li><li>
<p>connect function in Microsoft&#39;s Winsock functions reference</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L422'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="connect_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>connect_nonblock</strong>(remote_sockaddr, [options])  &#x21d2; <tt>0</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Requests a connection to be made on the given <code>remote_sockaddr</code>
after O_NONBLOCK is set for the underlying file descriptor. Returns 0 if
successful, otherwise an exception is raised.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>

<pre class="code ruby"><code class="ruby"><span class='comment'># &lt;code&gt;remote_sockaddr&lt;/code&gt; - the &lt;code&gt;struct&lt;/code&gt; sockaddr contained in a string or Addrinfo object
</span></code></pre>

<h3 id="label-Example-3A">Example:</h3>

<pre class="code ruby"><code class="ruby"><span class='comment'># Pull down Google&#39;s web page
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>80</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>www.google.com</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>begin</span> <span class='comment'># emulate blocking connect
</span>  <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect_nonblock'>connect_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitWritable</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_socket'>socket</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'># wait 3-way handshake completion
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect_nonblock'>connect_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span> <span class='comment'># check connection failure
</span>  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EISCONN</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET / HTTP/1.0\r\n\r\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
</code></pre>

<p>Refer to <a href="#connect-instance_method" title="Socket#connect (method)">#connect</a> for the exceptions that may be thrown if the call
to <em>connect_nonblock</em> fails.</p>

<p><a href="#connect_nonblock-instance_method" title="Socket#connect_nonblock (method)">#connect_nonblock</a> may raise any error corresponding to connect(2)
failure, including <code>Errno::EINPROGRESS</code>.</p>

<p>If the exception is <code>Errno::EINPROGRESS</code>, it is extended by
<code>IO::WaitWritable</code>. So <code>IO::WaitWritable</code> can be used to rescue the
exceptions for retrying connect_nonblock.</p>

<p>By specifying <tt>exception: false</tt>, the options hash allows you to indicate
that connect_nonblock should not raise an <code>IO::WaitWritable</code> exception, but
return the symbol :wait_writable instead.</p>

<h3 id="label-See">See</h3>

<pre class="code ruby"><code class="ruby"><span class='comment'># {Socket#connect}
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L1206'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


1206
1207
1208</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 1206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_nonblock'>connect_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___connect_nonblock'>__connect_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ipv6only!-instance_method">
  <h3 class='signature'>
  #<strong>ipv6only!</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>enable the socket option IPV6_V6ONLY if IPV6_V6ONLY is available.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L453'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


453
454
455
456
457</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 453</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ipv6only!'>ipv6only!</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>IPV6_V6ONLY</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:IPV6</span><span class='comma'>,</span> <span class='symbol'>:V6ONLY</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="listen-instance_method">
  <h3 class='signature'>
  #<strong>listen</strong>(int)  &#x21d2; <tt>0</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Listens for connections, using the specified <code>int</code> as the
backlog. A call to <em>listen</em> only applies if the <code>socket</code>
is of type SOCK_STREAM or SOCK_SEQPACKET.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>backlog</code> - the maximum length of the queue for pending
connections.</p>
</li></ul>

<h4 id="label-Example+1">Example 1</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span> <span class='int'>5</span> <span class='rparen'>)</span>
</code></pre>

<h4 id="label-Example+2+-28listening+on+an+arbitrary+port-2C+unix-based+systems+only-29-3A">Example 2 (listening on an arbitrary port, unix-based systems only):</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span> <span class='int'>1</span> <span class='rparen'>)</span>
</code></pre>

<h4 id="label-Unix-based+Exceptions">Unix-based Exceptions</h4>

<p>On unix based systems the above will work because a new
<code>sockaddr</code> struct is created on the address ADDR_ANY, for an
arbitrary port number as handed off by the kernel. It will not work on
Windows, because Windows requires that the <code>socket</code> is bound by
calling <em>bind</em> before it can <em>listen</em>.</p>

<p>If the <em>backlog</em> amount exceeds the implementation-dependent maximum
queue length, the implementation&#39;s maximum queue length will be used.</p>

<p>On unix-based based systems the following system exceptions may be raised
if the call to <em>listen</em> fails:</p>
<ul><li>
<p><code>Errno::EBADF</code> - the <em>socket</em> argument is not a valid file
descriptor</p>
</li><li>
<p><code>Errno::EDESTADDRREQ</code> - the <em>socket</em> is not bound to a local
address, and the protocol does not support listening on an unbound socket</p>
</li><li>
<p><code>Errno::EINVAL</code> - the <em>socket</em> is already connected</p>
</li><li>
<p><code>Errno::ENOTSOCK</code> - the <em>socket</em> argument does not refer to a socket</p>
</li><li>
<p><code>Errno::EOPNOTSUPP</code> - the <em>socket</em> protocol does not support listen</p>
</li><li>
<p><code>Errno::EACCES</code> - the calling process does not have appropriate privileges</p>
</li><li>
<p><code>Errno::EINVAL</code> - the <em>socket</em> has been shut down</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - insufficient resources are available in the system to
complete the call</p>
</li></ul>

<h4 id="label-Windows+Exceptions">Windows Exceptions</h4>

<p>On Windows systems the following system exceptions may be raised if the
call to <em>listen</em> fails:</p>
<ul><li>
<p><code>Errno::ENETDOWN</code> - the network is down</p>
</li><li>
<p><code>Errno::EADDRINUSE</code> - the socket&#39;s local address is already in use.
This usually occurs during the execution of <em>bind</em> but could be
delayed if the call to <em>bind</em> was to a partially wildcard address
(involving ADDR_ANY) and if a specific address needs to be committed at the
time of the call to <em>listen</em></p>
</li><li>
<p><code>Errno::EINPROGRESS</code> - a Windows Sockets 1.1 call is in progress or the
service provider is still processing a callback function</p>
</li><li>
<p><code>Errno::EINVAL</code> - the <code>socket</code> has not been bound with a call to
<em>bind</em>.</p>
</li><li>
<p><code>Errno::EISCONN</code> - the <code>socket</code> is already connected</p>
</li><li>
<p><code>Errno::EMFILE</code> - no more socket descriptors are available</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - no buffer space is available</p>
</li><li>
<p><code>Errno::ENOTSOC</code> - <code>socket</code> is not a socket</p>
</li><li>
<p><code>Errno::EOPNOTSUPP</code> - the referenced <code>socket</code> is not a type that
supports the <em>listen</em> method</p>
</li></ul>

<h4 id="label-See">See</h4>
<ul><li>
<p>listen manual pages on unix-based systems</p>
</li><li>
<p>listen function in Microsoft&#39;s Winsock functions reference</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L643'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="recvfrom-instance_method">
  <h3 class='signature'>
  <span class='overload'>#<strong>recvfrom</strong>(maxlen)  &#x21d2; <tt>Array</tt>, <tt>sender_addrinfo</tt> </span>
    <span class='overload'>#<strong>recvfrom</strong>(maxlen, flags)  &#x21d2; <tt>Array</tt>, <tt>sender_addrinfo</tt> </span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code>.
<em>flags</em> is zero or more of the <code>MSG_</code> options. The first
element of the results, <em>mesg</em>, is the data received. The second
element, <em>sender_addrinfo</em>, contains protocol-specific address
information of the sender.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>maxlen</code> - the maximum number of bytes to receive from the
socket</p>
</li><li>
<p><code>flags</code> - zero or more of the <code>MSG_</code> options</p>
</li></ul>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># In one file, start this first
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span> <span class='int'>5</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>
<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_recvfrom'>recvfrom</span><span class='lparen'>(</span> <span class='int'>20</span> <span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I only received 20 bytes &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>

<span class='comment'># In another file, start this second
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Watch this get cut short!</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<h4 id="label-Unix-based+Exceptions">Unix-based Exceptions</h4>

<p>On unix-based based systems the following system exceptions may be raised
if the call to <em>recvfrom</em> fails:</p>
<ul><li>
<p><code>Errno::EAGAIN</code> - the <code>socket</code> file descriptor is marked as
O_NONBLOCK and no data is waiting to be received; or MSG_OOB is set and no
out-of-band data is available and either the <code>socket</code> file
descriptor is marked as O_NONBLOCK or the <code>socket</code> does not
support blocking to wait for out-of-band-data</p>
</li><li>
<p><code>Errno::EWOULDBLOCK</code> - see <code>Errno::EAGAIN</code></p>
</li><li>
<p><code>Errno::EBADF</code> - the <code>socket</code> is not a valid file descriptor</p>
</li><li>
<p><code>Errno::ECONNRESET</code> - a connection was forcibly closed by a peer</p>
</li><li>
<p><code>Errno::EFAULT</code> - the socket&#39;s internal buffer, address or address
length cannot be accessed or written</p>
</li><li>
<p><code>Errno::EINTR</code> - a signal interrupted <em>recvfrom</em> before any data was
available</p>
</li><li>
<p><code>Errno::EINVAL</code> - the MSG_OOB flag is set and no out-of-band data is
available</p>
</li><li>
<p><code>Errno::EIO</code> - an i/o error occurred while reading from or writing to the
filesystem</p>
</li><li>
<p><code>Errno::ENOBUFS</code> - insufficient resources were available in the system to
perform the operation</p>
</li><li>
<p><code>Errno::ENOMEM</code> - insufficient memory was available to fulfill the request</p>
</li><li>
<p><code>Errno::ENOSR</code> - there were insufficient STREAMS resources available to
complete the operation</p>
</li><li>
<p><code>Errno::ENOTCONN</code> - a receive is attempted on a connection-mode socket that
is not connected</p>
</li><li>
<p><code>Errno::ENOTSOCK</code> - the <code>socket</code> does not refer to a socket</p>
</li><li>
<p><code>Errno::EOPNOTSUPP</code> - the specified flags are not supported for this socket
type</p>
</li><li>
<p><code>Errno::ETIMEDOUT</code> - the connection timed out during connection
establishment or due to a transmission timeout on an active connection</p>
</li></ul>

<h4 id="label-Windows+Exceptions">Windows Exceptions</h4>

<p>On Windows systems the following system exceptions may be raised if the
call to <em>recvfrom</em> fails:</p>
<ul><li>
<p><code>Errno::ENETDOWN</code> - the network is down</p>
</li><li>
<p><code>Errno::EFAULT</code> - the internal buffer and from parameters on
<code>socket</code> are not part of the user address space, or the internal
fromlen parameter is too small to accommodate the peer address</p>
</li><li>
<p><code>Errno::EINTR</code> - the (blocking) call was cancelled by an internal call to
the WinSock function WSACancelBlockingCall</p>
</li><li>
<p><code>Errno::EINPROGRESS</code> - a blocking Windows Sockets 1.1 call is in progress
or the service provider is still processing a callback function</p>
</li><li>
<p><code>Errno::EINVAL</code> - <code>socket</code> has not been bound with a call to
<em>bind</em>, or an unknown flag was specified, or MSG_OOB was specified
for a socket with SO_OOBINLINE enabled, or (for byte stream-style sockets
only) the internal len parameter on <code>socket</code> was zero or
negative</p>
</li><li>
<p><code>Errno::EISCONN</code> - <code>socket</code> is already connected. The call to
<em>recvfrom</em> is not permitted with a connected socket on a socket that
is connection oriented or connectionless.</p>
</li><li>
<p><code>Errno::ENETRESET</code> - the connection has been broken due to the keep-alive
activity detecting a failure while the operation was in progress.</p>
</li><li>
<p><code>Errno::EOPNOTSUPP</code> - MSG_OOB was specified, but <code>socket</code> is not
stream-style such as type SOCK_STREAM. OOB data is not supported in the
communication domain associated with <code>socket</code>, or
<code>socket</code> is unidirectional and supports only send operations</p>
</li><li>
<p><code>Errno::ESHUTDOWN</code> - <code>socket</code> has been shutdown. It is not
possible to call <em>recvfrom</em> on a socket after <em>shutdown</em> has
been invoked.</p>
</li><li>
<p><code>Errno::EWOULDBLOCK</code> - <code>socket</code> is marked as nonblocking and a 
call to <em>recvfrom</em> would block.</p>
</li><li>
<p><code>Errno::EMSGSIZE</code> - the message was too large to fit into the specified
buffer and was truncated.</p>
</li><li>
<p><code>Errno::ETIMEDOUT</code> - the connection has been dropped, because of a network
failure or because the system on the other end went down without notice</p>
</li><li>
<p><code>Errno::ECONNRESET</code> - the virtual circuit was reset by the remote side
executing a hard or abortive close. The application should close the
socket; it is no longer usable. On a UDP-datagram socket this error
indicates a previous send operation resulted in an ICMP Port Unreachable
message.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L762'>GitHub</a> ]</span>

</section>
  <section class='method_details' id="recvfrom_nonblock-instance_method">
  <h3 class='signature'>
  #<strong>recvfrom_nonblock</strong>(maxlen[, flags[, outbuf[, opts]]])  &#x21d2; <tt>Array</tt>, <tt>sender_addrinfo</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Receives up to <em>maxlen</em> bytes from <code>socket</code> using
recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor.
<em>flags</em> is zero or more of the <code>MSG_</code> options. The first
element of the results, <em>mesg</em>, is the data received. The second
element, <em>sender_addrinfo</em>, contains protocol-specific address
information of the sender.</p>

<p>When recvfrom(2) returns 0, <a href="#recvfrom_nonblock-instance_method" title="Socket#recvfrom_nonblock (method)">#recvfrom_nonblock</a> returns an empty
string as data. The meaning depends on the socket: EOF on TCP, empty packet
on UDP, etc.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>maxlen</code> - the maximum number of bytes to receive from the
socket</p>
</li><li>
<p><code>flags</code> - zero or more of the <code>MSG_</code> options</p>
</li><li>
<p><code>outbuf</code> - destination String buffer</p>
</li><li>
<p><code>opts</code> - keyword hash, supporting <tt>exception: false</tt></p>
</li></ul>

<h3 id="label-Example">Example</h3>

<pre class="code ruby"><code class="ruby"><span class='comment'># In one file, start this first
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span>
<span class='id identifier rubyid_client'>client</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_accept'>accept</span>
<span class='kw'>begin</span> <span class='comment'># emulate blocking recvfrom
</span>  <span class='id identifier rubyid_pair'>pair</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_recvfrom_nonblock'>recvfrom_nonblock</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitReadable</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_client'>client</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>retry</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_pair'>pair</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I only received 20 bytes &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>

<span class='comment'># In another file, start this second
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span><span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_sockaddr_in'><a href="#sockaddr_in-class_method" title="Socket.sockaddr_in (method)">sockaddr_in</a></span><span class='lparen'>(</span><span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span><span class='id identifier rubyid_sockaddr'>sockaddr</span><span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Watch this get cut short!</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<p>Refer to <a href="#recvfrom-instance_method" title="Socket#recvfrom (method)">#recvfrom</a> for the exceptions that may be thrown if the
call to <em>recvfrom_nonblock</em> fails.</p>

<p><a href="#recvfrom_nonblock-instance_method" title="Socket#recvfrom_nonblock (method)">#recvfrom_nonblock</a> may raise any error corresponding to recvfrom(2)
failure, including <code>Errno::EWOULDBLOCK</code>.</p>

<p>If the exception is <code>Errno::EWOULDBLOCK</code> or <code>Errno::EAGAIN</code>, it is extended
by <code>IO::WaitReadable</code>. So <code>IO::WaitReadable</code> can be used to rescue the
exceptions for retrying recvfrom_nonblock.</p>

<p>By specifying <tt>exception: false</tt>, the options hash allows you to indicate
that accept_nonblock should not raise an <code>IO::WaitReadable</code> exception, but
return the symbol :wait_readable instead.</p>

<h3 id="label-See">See</h3>
<ul><li>
<p><a href="#recvfrom-instance_method" title="Socket#recvfrom (method)">#recvfrom</a></p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/lib/socket.rb#L525'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


525
526
527</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'ext/socket/lib/socket.rb', line 525</span>

<span class='kw'>def</span> <span class='id identifier rubyid_recvfrom_nonblock'>recvfrom_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>exception:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid___recvfrom_nonblock'>__recvfrom_nonblock</span><span class='lparen'>(</span><span class='id identifier rubyid_len'>len</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='id identifier rubyid_exception'>exception</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sysaccept-instance_method">
  <h3 class='signature'>
  #<strong>sysaccept</strong>  &#x21d2; <tt>Array</tt>, <tt>client_addrinfo</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Accepts an incoming connection returning an array containing the (integer)
file descriptor for the incoming connection, <em>client_socket_fd</em>, and
an Addrinfo, <em>client_addrinfo</em>.</p>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># In one script, start this first
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_listen'>listen</span><span class='lparen'>(</span> <span class='int'>5</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_client_fd'>client_fd</span><span class='comma'>,</span> <span class='id identifier rubyid_client_addrinfo'>client_addrinfo</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_sysaccept'>sysaccept</span>
<span class='id identifier rubyid_client_socket'>client_socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_for_fd'><a href="BasicSocket.html#for_fd-class_method" title="BasicSocket.for_fd (method)">for_fd</a></span><span class='lparen'>(</span> <span class='id identifier rubyid_client_fd'>client_fd</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The client said, &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_client_socket'>client_socket</span><span class='period'>.</span><span class='id identifier rubyid_readline'>readline</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_client_socket'>client_socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello from script one!</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>

<span class='comment'># In another script, start this second
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>socket</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='op'>::</span><span class='const'>Constants</span>
<span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Socket.new (method)">new</a></span><span class='lparen'>(</span> <span class='const'>AF_INET</span><span class='comma'>,</span> <span class='const'>SOCK_STREAM</span><span class='comma'>,</span> <span class='int'>0</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='op'>=</span> <span class='const'><a href="" title="Socket (class)">Socket</a></span><span class='period'>.</span><span class='id identifier rubyid_pack_sockaddr_in'>pack_sockaddr_in</span><span class='lparen'>(</span> <span class='int'>2200</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span><span class='lparen'>(</span> <span class='id identifier rubyid_sockaddr'>sockaddr</span> <span class='rparen'>)</span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello from script 2.</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The server said, &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_readline'>readline</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
</code></pre>

<p>Refer to <a href="#accept-instance_method" title="Socket#accept (method)">#accept</a> for the exceptions that may be thrown if the call
to <em>sysaccept</em> fails.</p>

<h4 id="label-See">See</h4>
<ul><li>
<p><a href="#accept-instance_method" title="Socket#accept (method)">#accept</a></p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/ruby/ruby/blob/ruby_2_3/ext/socket/socket.c#L859'>GitHub</a> ]</span>

</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>