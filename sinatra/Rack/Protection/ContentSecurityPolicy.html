<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Rack::Protection::ContentSecurityPolicy &mdash; Sinatra main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Rack::Protection::ContentSecurityPolicy",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Sinatra main</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../Rack.html" title="Rack (module)">Rack</a> &raquo; 
        <a href="../Protection.html" title="Rack::Protection (module)">Protection</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ContentSecurityPolicy&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Rack::Protection::ContentSecurityPolicy</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Base.html" title="Rack::Protection::Base (class)"><code>Base</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Base.html" title="Rack::Protection::Base (class)"><code>Base</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Base.html" title="Rack::Protection::Base (class)">Rack::Protection::Base</a></span>
        <ul class='fullTree'>
          <li>Object</li>
          <li class='next'><a href="Base.html" title="Rack::Protection::Base (class)">Rack::Protection::Base</a></li>
          <li class='next'>Rack::Protection::ContentSecurityPolicy</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/sinatra/sinatra/blob/main/rack-protection/lib/rack/protection/content_security_policy.rb#L39'>rack-protection/lib/rack/protection/content_security_policy.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    <p>Prevented attack::   XSS and others
Supported browsers:: Firefox 23+, Safari 7+, Chrome 25+, Opera 15+</p>

<p>Description:: Content Security Policy, a mechanism web applications
              can use to mitigate a broad class of content injection
              vulnerabilities, such as cross-site scripting (XSS).
              Content Security Policy is a declarative policy that lets
              the authors (or server administrators) of a web application
              inform the client about the sources from which the
              application expects to load resources.</p>

<p>More info::   W3C CSP Level 1 : <a href="https://www.w3.org/TR/CSP1/">https://www.w3.org/TR/CSP1/</a> (deprecated)
              W3C CSP Level 2 : <a href="https://www.w3.org/TR/CSP2/">https://www.w3.org/TR/CSP2/</a> (current)
              W3C CSP Level 3 : <a href="https://www.w3.org/TR/CSP3/">https://www.w3.org/TR/CSP3/</a> (draft)
              <a href="https://developer.mozilla.org/en-US/docs/Web/Security/CSP">https://developer.mozilla.org/en-US/docs/Web/Security/CSP</a>
              <a href="http://caniuse.com/#search=ContentSecurityPolicy">http://caniuse.com/#search=ContentSecurityPolicy</a>
              <a href="http://content-security-policy.com/">http://content-security-policy.com/</a>
              <a href="https://securityheaders.io">https://securityheaders.io</a>
              <a href="https://scotthelme.co.uk/csp-cheat-sheet/">https://scotthelme.co.uk/csp-cheat-sheet/</a>
              <a href="http://www.html5rocks.com/en/tutorials/security/content-security-policy/">http://www.html5rocks.com/en/tutorials/security/content-security-policy/</a></p>

<p>Sets the &#39;content-security-policy[-report-only]&#39; header.</p>

<p>Options: <code>ContentSecurityPolicy</code> configuration is a complex topic with
         several levels of support that has evolved over time.
         See the W3C documentation and the links in the more info
         section for CSP usage examples and best practices. The
         CSP3 directives in the &#39;NO_ARG_DIRECTIVES&#39; constant need to be
         presented in the options hash with a boolean &#39;true&#39; in order
         to be used in a policy.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='DIRECTIVES-constant' class='summary_signature'>DIRECTIVES =</span>
    <br/>
    <a class='repo' href='https://github.com/sinatra/sinatra/blob/main/rack-protection/lib/rack/protection/content_security_policy.rb#L42-L48'># File 'rack-protection/lib/rack/protection/content_security_policy.rb', line 42</a>    <pre class='code ruby'><span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='tstring_content'>base_uri</span><span class='words_sep'> </span><span class='tstring_content'>child_src</span><span class='words_sep'> </span><span class='tstring_content'>connect_src</span><span class='words_sep'> </span><span class='tstring_content'>default_src</span><span class='words_sep'>
</span><span class='tstring_content'>font_src</span><span class='words_sep'> </span><span class='tstring_content'>form_action</span><span class='words_sep'> </span><span class='tstring_content'>frame_ancestors</span><span class='words_sep'> </span><span class='tstring_content'>frame_src</span><span class='words_sep'>
</span><span class='tstring_content'>img_src</span><span class='words_sep'> </span><span class='tstring_content'>manifest_src</span><span class='words_sep'> </span><span class='tstring_content'>media_src</span><span class='words_sep'> </span><span class='tstring_content'>object_src</span><span class='words_sep'>
</span><span class='tstring_content'>plugin_types</span><span class='words_sep'> </span><span class='tstring_content'>referrer</span><span class='words_sep'> </span><span class='tstring_content'>reflected_xss</span><span class='words_sep'> </span><span class='tstring_content'>report_to</span><span class='words_sep'>
</span><span class='tstring_content'>report_uri</span><span class='words_sep'> </span><span class='tstring_content'>require_sri_for</span><span class='words_sep'> </span><span class='tstring_content'>sandbox</span><span class='words_sep'> </span><span class='tstring_content'>script_src</span><span class='words_sep'>
</span><span class='tstring_content'>style_src</span><span class='words_sep'> </span><span class='tstring_content'>worker_src</span><span class='words_sep'> </span><span class='tstring_content'>webrtc_src</span><span class='words_sep'> </span><span class='tstring_content'>navigate_to</span><span class='words_sep'>
</span><span class='tstring_content'>prefetch_src</span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
  <li>
    <span id='NO_ARG_DIRECTIVES-constant' class='summary_signature'>NO_ARG_DIRECTIVES =</span>
    <br/>
    <a class='repo' href='https://github.com/sinatra/sinatra/blob/main/rack-protection/lib/rack/protection/content_security_policy.rb#L50-L51'># File 'rack-protection/lib/rack/protection/content_security_policy.rb', line 50</a>    <pre class='code ruby'><span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='tstring_content'>block_all_mixed_content</span><span class='words_sep'> </span><span class='tstring_content'>disown_opener</span><span class='words_sep'>
</span><span class='tstring_content'>upgrade_insecure_requests</span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="Base.html" title="Rack::Protection::Base (class)"><code>Base</code></a> - Inherited</h3>
  <p  class='inherited'>
    <a href="Base.html#DEFAULT_OPTIONS-constant" title="Rack::Protection::Base::DEFAULT_OPTIONS (constant)">DEFAULT_OPTIONS</a>
  </p>
</div>

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Base.html" title="Rack::Protection::Base (class)"><code>Base</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Base.html#default_options-class_method" title="Rack::Protection::Base.default_options (method)">.default_options</a>,
        <a class='i_m ' href="Base.html#default_reaction-class_method" title="Rack::Protection::Base.default_reaction (method)">.default_reaction</a>,
        <a class='i_m ' href="Base.html#new-class_method" title="Rack::Protection::Base.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_Attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Base.html" title="Rack::Protection::Base (class)"><code>Base</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Base.html#app-instance_method" title="Rack::Protection::Base#app (method)">#app</a>,
        <a class='i_m ro' href="Base.html#options-instance_method" title="Rack::Protection::Base#options (method)">#options</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(env)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#csp_policy-instance_method" title="#csp_policy (instance method)">#<strong>csp_policy</strong>  </a>
    </span>
  </li>
</ul>

<h3 class='inherited'><a href="Base.html" title="Rack::Protection::Base (class)"><code>Base</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Base.html#accepts%3F-instance_method" title="Rack::Protection::Base#accepts? (method)">#accepts?</a>,
        <a class='i_m ' href="Base.html#call-instance_method" title="Rack::Protection::Base#call (method)">#call</a>,
        <a class='i_m ' href="Base.html#debug-instance_method" title="Rack::Protection::Base#debug (method)">#debug</a>,
        <a class='i_m ' href="Base.html#default_options-instance_method" title="Rack::Protection::Base#default_options (method)">#default_options</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Base.html#default_reaction-instance_method" title="Rack::Protection::Base#default_reaction (method)">#default_reaction</a></td>
      <td><div class='inline'><p>Alias for <a href="Base.html#deny-instance_method" title="Rack::Protection::Base#deny (method)">Base#deny</a>.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Base.html#deny-instance_method" title="Rack::Protection::Base#deny (method)">#deny</a>,
        <a class='i_m ' href="Base.html#drop_session-instance_method" title="Rack::Protection::Base#drop_session (method)">#drop_session</a>,
        <a class='i_m ' href="Base.html#encrypt-instance_method" title="Rack::Protection::Base#encrypt (method)">#encrypt</a>,
        <a class='i_m ' href="Base.html#html%3F-instance_method" title="Rack::Protection::Base#html? (method)">#html?</a>,
        <a class='i_m ' href="Base.html#instrument-instance_method" title="Rack::Protection::Base#instrument (method)">#instrument</a>,
        <a class='i_m ' href="Base.html#origin-instance_method" title="Rack::Protection::Base#origin (method)">#origin</a>,
        <a class='i_m ' href="Base.html#random_string-instance_method" title="Rack::Protection::Base#random_string (method)">#random_string</a>,
        <a class='i_m ' href="Base.html#react-instance_method" title="Rack::Protection::Base#react (method)">#react</a>,
        <a class='i_m ' href="Base.html#referrer-instance_method" title="Rack::Protection::Base#referrer (method)">#referrer</a>,
        <a class='i_m ' href="Base.html#report-instance_method" title="Rack::Protection::Base#report (method)">#report</a>,
        <a class='i_m ' href="Base.html#safe%3F-instance_method" title="Rack::Protection::Base#safe? (method)">#safe?</a>,
        <a class='i_m ' href="Base.html#secure_compare-instance_method" title="Rack::Protection::Base#secure_compare (method)">#secure_compare</a>,
        <a class='i_m ' href="Base.html#session-instance_method" title="Rack::Protection::Base#session (method)">#session</a>,
        <a class='i_m ' href="Base.html#session%3F-instance_method" title="Rack::Protection::Base#session? (method)">#session?</a>,
        <a class='i_m ' href="Base.html#warn-instance_method" title="Rack::Protection::Base#warn (method)">#warn</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <p class='notice'>This class inherits a constructor from <a href="Base.html#new-class_method" title="Rack::Protection::Base.new (method)">Rack::Protection::Base</a></p>
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="call-instance_method">
  <h3 class='signature  first'>
    #<strong>call</strong>(env)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/rack-protection/lib/rack/protection/content_security_policy.rb#L72-L77'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='72' data-end='77'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rack-protection/lib/rack/protection/content_security_policy.rb', line 72</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='ivar'>@app</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='id identifier rubyid_options'><a href="../../Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_report_only'>report_only</span>] <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-security-policy-report-only</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-security-policy</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_headers'>headers</span>[<span class='id identifier rubyid_header'>header</span>] <span class='op'>||=</span> <span class='id identifier rubyid_csp_policy'><a href="#csp_policy-instance_method" title="Rack::Protection::ContentSecurityPolicy#csp_policy (method)">csp_policy</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_html?'>html?</span> <span class='id identifier rubyid_headers'>headers</span>
  [<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="csp_policy-instance_method">
  <h3 class='signature '>
    #<strong>csp_policy</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/rack-protection/lib/rack/protection/content_security_policy.rb#L53-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='53' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'rack-protection/lib/rack/protection/content_security_policy.rb', line 53</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_csp_policy'>csp_policy</span>
  <span class='id identifier rubyid_directives'>directives</span> <span class='op'>=</span> []

  <span class='const'><a href="#DIRECTIVES-constant" title="Rack::Protection::ContentSecurityPolicy::DIRECTIVES (constant)">DIRECTIVES</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../../Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_d'>d</span>)
      <span class='id identifier rubyid_directives'>directives</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_d'>d</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>_</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_options'><a href="../../Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span>[<span class='id identifier rubyid_d'>d</span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Set these key values to boolean &#39;true&#39; to include in policy
</span>  <span class='const'><a href="#NO_ARG_DIRECTIVES-constant" title="Rack::Protection::ContentSecurityPolicy::NO_ARG_DIRECTIVES (constant)">NO_ARG_DIRECTIVES</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_options'><a href="../../Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_d'>d</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'><a href="../../Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span>[<span class='id identifier rubyid_d'>d</span>].<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>TrueClass</span>)
      <span class='id identifier rubyid_directives'>directives</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_d'>d</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_tr'>tr</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_directives'>directives</span>.<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_sort'>sort</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>; </span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>