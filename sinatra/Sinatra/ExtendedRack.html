<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Sinatra::ExtendedRack &mdash; Sinatra main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Sinatra::ExtendedRack",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Sinatra main</a> &raquo; 
      <a href='../_index.html#alpha_E'>Index (E)</a> &raquo; 
        <a href="../Sinatra.html" title="Sinatra (module)">Sinatra</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ExtendedRack&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Sinatra::ExtendedRack</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Struct
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          Struct
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Struct</span>
        <ul class='fullTree'>
          <li>Object</li>
          <li class='next'>Struct</li>
          <li class='next'>Sinatra::ExtendedRack</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/sinatra/sinatra/blob/main/lib/sinatra/base.rb#L222'>lib/sinatra/base.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    <p>Some Rack handlers implement an extended body object protocol, however,
some middleware (namely Rack::Lint) will break it by not mirroring the methods in question.
This middleware will detect an extended body object and will make sure it reaches the
handler directly. We do this here, so our middleware and middleware set up by the app will
still be able to run.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#app-instance_method" title="#app (instance method)">#<strong>app</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Some Rack handlers implement an extended body object protocol, however, some middleware (namely Rack::Lint) will break it by not mirroring the methods in question.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(env)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#after_response-instance_method" title="#after_response (instance method)">#<strong>after_response</strong>(&amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#async%3F-instance_method" title="#async? (instance method)">#<strong>async?</strong>(status, _headers, body)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setup_close-instance_method" title="#setup_close (instance method)">#<strong>setup_close</strong>(env, _status, _headers, body)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="app-instance_method">
  <h3 class='signature rw first'>
    #<strong>app</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    <p>Some Rack handlers implement an extended body object protocol, however,
some middleware (namely Rack::Lint) will break it by not mirroring the methods in question.
This middleware will detect an extended body object and will make sure it reaches the
handler directly. We do this here, so our middleware and middleware set up by the app will
still be able to run.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/lib/sinatra/base.rb#L222-L222'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='222' data-end='222'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sinatra/base.rb', line 222</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>ExtendedRack</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="../Sinatra.html#new-class_method" title="Sinatra.new (method)">new</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_app'>app</span>)
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="after_response-instance_method">
  <h3 class='signature priv first'>
    #<strong>after_response</strong>(&amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>NotImplementedError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/lib/sinatra/base.rb#L242-L246'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='242' data-end='246'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sinatra/base.rb', line 242</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_after_response'>after_response</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>only supports EventMachine at the moment</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='const'>EventMachine</span>

  <span class='const'>EventMachine</span>.<span class='id identifier rubyid_next_tick'>next_tick</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="async?-instance_method">
  <h3 class='signature priv'>
    #<strong>async?</strong>(status, _headers, body)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/lib/sinatra/base.rb#L248-L252'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='248' data-end='252'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sinatra/base.rb', line 248</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_async?'>async?</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid__headers'>_headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span>)
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>

  <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_callback'>callback</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_errback'>errback</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="call-instance_method">
  <h3 class='signature '>
    #<strong>call</strong>(env)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/lib/sinatra/base.rb#L223-L231'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='223' data-end='231'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sinatra/base.rb', line 223</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_app'><a href="#app-instance_method" title="Sinatra::ExtendedRack#app (method)">app</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='id identifier rubyid_callback'>callback</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>async.callback</span><span class='tstring_end'>&#39;</span></span>]
  <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='id identifier rubyid_callback'>callback</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_async?'><a href="#async%3F-instance_method" title="Sinatra::ExtendedRack#async? (method)">async?</a></span>(<span class='op'>*</span><span class='id identifier rubyid_result'>result</span>)

  <span class='id identifier rubyid_after_response'><a href="#after_response-instance_method" title="Sinatra::ExtendedRack#after_response (method)">after_response</a></span> { <span class='id identifier rubyid_callback'>callback</span>.<span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_result'>result</span> }
  <span class='id identifier rubyid_setup_close'><a href="#setup_close-instance_method" title="Sinatra::ExtendedRack#setup_close (method)">setup_close</a></span>(<span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_result'>result</span>)
  <span class='id identifier rubyid_throw'>throw</span> <span class='symbeg'>:</span><span class='id identifier rubyid_async'>async</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setup_close-instance_method">
  <h3 class='signature priv'>
    #<strong>setup_close</strong>(env, _status, _headers, body)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sinatra/sinatra/blob/main/lib/sinatra/base.rb#L235-L240'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='235' data-end='240'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sinatra/base.rb', line 235</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_close'>setup_close</span>(<span class='id identifier rubyid_env'>env</span><span class='comma'>,</span> <span class='id identifier rubyid__status'>_status</span><span class='comma'>,</span> <span class='id identifier rubyid__headers'>_headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span>)
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>async.close</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>async.close</span><span class='tstring_end'>&#39;</span></span>].<span class='id identifier rubyid_callback'>callback</span> { <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_close'>close</span> }
  <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>async.close</span><span class='tstring_end'>&#39;</span></span>].<span class='id identifier rubyid_errback'>errback</span> { <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_close'>close</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>