<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: README &mdash; Sinatra main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "README",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Sinatra main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: README&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1><a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a></h1>

<p><a href="https://badge.fury.io/rb/sinatra"><img src="https://badge.fury.io/rb/sinatra.svg" alt="Gem Version"></a>
<a href="https://github.com/sinatra/sinatra/actions/workflows/test.yml"><img src="https://github.com/sinatra/sinatra/actions/workflows/test.yml/badge.svg" alt="Testing"></a></p>

<p><a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> is a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> for
quickly creating web applications in Ruby with minimal effort:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># myapp.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello world!</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>Install the gems needed:</p>

<pre class="code shell"><code class="shell">gem install sinatra rackup puma
</code></pre>

<p>And run with:</p>

<pre class="code shell"><code class="shell">ruby myapp.rb
</code></pre>

<p>View at: <a href="http://localhost:4567">http://localhost:4567</a></p>

<p>The code you changed will not take effect until you restart the server.
Please restart the server every time you change or use a code reloader
like <a href="https://github.com/alexch/rerun">rerun</a> or
<a href="https://github.com/jeremyevans/rack-unreloader">rack-unreloader</a>.</p>

<h2>Table of Contents</h2>

<ul>
<li><a href="#sinatra">Sinatra</a>

<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#routes">Routes</a></li>
<li><a href="#conditions">Conditions</a></li>
<li><a href="#return-values">Return Values</a></li>
<li><a href="#custom-route-matchers">Custom Route Matchers</a></li>
<li><a href="#static-files">Static Files</a></li>
<li><a href="#views--templates">Views / Templates</a></li>
<li><a href="#literal-templates">Literal Templates</a></li>
<li><a href="#available-template-languages">Available Template Languages</a>

<ul>
<li><a href="#haml-templates">Haml Templates</a></li>
<li><a href="#erb-templates">Erb Templates</a></li>
<li><a href="#builder-templates">Builder Templates</a></li>
<li><a href="#nokogiri-templates">Nokogiri Templates</a></li>
<li><a href="#sass-templates">Sass Templates</a></li>
<li><a href="#scss-templates">Scss Templates</a></li>
<li><a href="#liquid-templates">Liquid Templates</a></li>
<li><a href="#markdown-templates">Markdown Templates</a></li>
<li><a href="#rdoc-templates">RDoc Templates</a></li>
<li><a href="#asciidoc-templates">AsciiDoc Templates</a></li>
<li><a href="#markaby-templates">Markaby Templates</a></li>
<li><a href="#rabl-templates">RABL Templates</a></li>
<li><a href="#slim-templates">Slim Templates</a></li>
<li><a href="#yajl-templates">Yajl Templates</a></li>
</ul></li>
<li><a href="#accessing-variables-in-templates">Accessing Variables in Templates</a></li>
<li><a href="#templates-with-yield-and-nested-layouts">Templates with <code>yield</code> and nested layouts</a></li>
<li><a href="#inline-templates">Inline Templates</a></li>
<li><a href="#named-templates">Named Templates</a></li>
<li><a href="#associating-file-extensions">Associating File Extensions</a></li>
<li><a href="#adding-your-own-template-engine">Adding Your Own Template Engine</a></li>
<li><a href="#using-custom-logic-for-template-lookup">Using Custom Logic for Template Lookup</a></li>
<li><a href="#filters">Filters</a></li>
<li><a href="#helpers">Helpers</a></li>
<li><a href="#using-sessions">Using Sessions</a>

<ul>
<li><a href="#session-secret-security">Session Secret Security</a></li>
<li><a href="#session-config">Session Config</a></li>
<li><a href="#choosing-your-own-session-middleware">Choosing Your Own Session Middleware</a></li>
</ul></li>
<li><a href="#halting">Halting</a></li>
<li><a href="#passing">Passing</a></li>
<li><a href="#triggering-another-route">Triggering Another Route</a></li>
<li><a href="#setting-body-status-code-and-headers">Setting Body, Status Code, and Headers</a></li>
<li><a href="#streaming-responses">Streaming Responses</a></li>
<li><a href="#logging">Logging</a></li>
<li><a href="#mime-types">Mime Types</a></li>
<li><a href="#generating-urls">Generating URLs</a></li>
<li><a href="#browser-redirect">Browser Redirect</a></li>
<li><a href="#cache-control">Cache Control</a></li>
<li><a href="#sending-files">Sending Files</a></li>
<li><a href="#accessing-the-request-object">Accessing the Request Object</a></li>
<li><a href="#attachments">Attachments</a></li>
<li><a href="#dealing-with-date-and-time">Dealing with Date and Time</a></li>
<li><a href="#looking-up-template-files">Looking Up Template Files</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#configuring-attack-protection">Configuring attack protection</a></li>
<li><a href="#available-settings">Available Settings</a></li>
<li><a href="#lifecycle-events">Lifecycle Events</a></li>
<li><a href="#environments">Environments</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#not-found">Not Found</a></li>
<li><a href="#error">Error</a></li>
<li><a href="#rack-middleware">Rack Middleware</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#sinatrabase---middleware-libraries-and-modular-apps">Sinatra::Base - Middleware, Libraries, and Modular Apps</a></li>
<li><a href="#modular-vs-classic-style">Modular vs. Classic Style</a></li>
<li><a href="#serving-a-modular-application">Serving a Modular Application</a></li>
<li><a href="#using-a-classic-style-application-with-a-configru">Using a Classic Style Application with a config.ru</a></li>
<li><a href="#when-to-use-a-configru">When to use a config.ru?</a></li>
<li><a href="#using-sinatra-as-middleware">Using Sinatra as Middleware</a></li>
<li><a href="#dynamic-application-creation">Dynamic Application Creation</a></li>
<li><a href="#scopes-and-binding">Scopes and Binding</a></li>
<li><a href="#applicationclass-scope">Application/Class Scope</a></li>
<li><a href="#requestinstance-scope">Request/Instance Scope</a></li>
<li><a href="#delegation-scope">Delegation Scope</a></li>
<li><a href="#command-line">Command Line</a></li>
<li><a href="#multi-threading">Multi-threading</a></li>
<li><a href="#requirement">Requirement</a></li>
<li><a href="#the-bleeding-edge">The Bleeding Edge</a></li>
<li><a href="#with-bundler">With Bundler</a></li>
<li><a href="#versioning">Versioning</a></li>
<li><a href="#further-reading">Further Reading</a></li>
</ul></li>
</ul>

<h2>Routes</h2>

<p>In Sinatra, a route is an HTTP method paired with a URL-matching pattern.
Each route is associated with a block:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_show'>show</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_create'>create</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_put'><a href="Sinatra/Delegator.html#put-instance_method" title="Sinatra::Delegator#put (method)">put</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_replace'>replace</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_patch'><a href="Sinatra/Delegator.html#patch-instance_method" title="Sinatra::Delegator#patch (method)">patch</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_modify'>modify</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_delete'><a href="Sinatra/Delegator.html#delete-instance_method" title="Sinatra::Delegator#delete (method)">delete</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_annihilate'>annihilate</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_options'><a href="Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_appease'>appease</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_link'><a href="Sinatra/Delegator.html#link-instance_method" title="Sinatra::Delegator#link (method)">link</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_affiliate'>affiliate</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_unlink'><a href="Sinatra/Delegator.html#unlink-instance_method" title="Sinatra::Delegator#unlink (method)">unlink</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='op'>..</span> <span class='id identifier rubyid_separate'>separate</span> <span class='id identifier rubyid_something'>something</span> <span class='op'>..</span>
<span class='kw'>end</span></code></pre>

<p>Routes are matched in the order they are defined. The first route that
matches the request is invoked.</p>

<p>Routes with trailing slashes are different from the ones without:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Does not match &quot;GET /foo/&quot;
</span><span class='kw'>end</span></code></pre>

<p>Route patterns may include named parameters, accessible via the
<code>params</code> hash:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/hello/:name</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># matches &quot;GET /hello/foo&quot; and &quot;GET /hello/bar&quot;
</span>  <span class='comment'># params[&#39;name&#39;] is &#39;foo&#39; or &#39;bar&#39;
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>]<span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>You can also access named parameters via block parameters:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/hello/:name</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
  <span class='comment'># matches &quot;GET /hello/foo&quot; and &quot;GET /hello/bar&quot;
</span>  <span class='comment'># params[&#39;name&#39;] is &#39;foo&#39; or &#39;bar&#39;
</span>  <span class='comment'># n stores params[&#39;name&#39;]
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n'>n</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Route patterns may also include splat (or wildcard) parameters, accessible
via the <code>params[&#39;splat&#39;]</code> array:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/say/*/to/*</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># matches /say/hello/to/world
</span>  <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>splat</span><span class='tstring_end'>&#39;</span></span>] <span class='comment'># =&gt; [&quot;hello&quot;, &quot;world&quot;]
</span><span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/download/*.*</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># matches /download/path/to/file.xml
</span>  <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>splat</span><span class='tstring_end'>&#39;</span></span>] <span class='comment'># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
</span><span class='kw'>end</span></code></pre>

<p>Or with block parameters:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/download/*.*</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_ext'>ext</span><span class='op'>|</span>
  [<span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_ext'>ext</span>] <span class='comment'># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]
</span><span class='kw'>end</span></code></pre>

<p>Route matching with Regular Expressions:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\/hello\/([\w]+)</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>captures</span><span class='tstring_end'>&#39;</span></span>].<span class='id identifier rubyid_first'>first</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Or with a block parameter:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>/hello/([\w]+)</span><span class='regexp_end'>}</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='comment'># Matches &quot;GET /meta/hello/world&quot;, &quot;GET /hello/world/1234&quot; etc.
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Route patterns may have optional parameters:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/posts/:format?</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># matches &quot;GET /posts/&quot; and any extension &quot;GET /posts/json&quot;, &quot;GET /posts/xml&quot; etc
</span><span class='kw'>end</span></code></pre>

<p>Routes may also utilize query parameters:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/posts</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># matches &quot;GET /posts?title=foo&amp;author=bar&quot;
</span>  <span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span>]
  <span class='id identifier rubyid_author'>author</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>author</span><span class='tstring_end'>&#39;</span></span>]
  <span class='comment'># uses title and author variables; query is optional to the /posts route
</span><span class='kw'>end</span></code></pre>

<p>By the way, unless you disable the path traversal attack protection (see
<a href="#configuring-attack-protection">below</a>), the request path might be modified before
matching against your routes.</p>

<p>You may customize the <a href="https://github.com/sinatra/mustermann#readme">Mustermann</a>
options used for a given route by passing in a <code>:mustermann_opts</code> hash:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\A/posts\z</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_mustermann_opts'>mustermann_opts</span> <span class='op'>=&gt;</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_regexp'>regexp</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_check_anchors'>check_anchors</span> <span class='op'>=&gt;</span> <span class='kw'>false</span> } <span class='kw'>do</span>
  <span class='comment'># matches /posts exactly, with explicit anchoring
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>If you match an anchored pattern clap your hands!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>It looks like a <a href="#conditions">condition</a>, but it isn&#39;t one! These options will
be merged into the global <code>:mustermann_opts</code> hash described
<a href="#available-settings">below</a>.</p>

<h2>Conditions</h2>

<p>Routes may include a variety of matching conditions, such as the user agent:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_agent'>agent</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>Songbird (\d\.\d)[\d\/]*?</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re using Songbird version </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>agent</span><span class='tstring_end'>&#39;</span></span>][<span class='int'>0</span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Matches non-songbird browsers
</span><span class='kw'>end</span></code></pre>

<p>Other available conditions are <code>host_name</code> and <code>provides</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_host_name'>host_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^admin\.</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Admin Area, Access denied!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_provides'>provides</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_provides'>provides</span> <span class='op'>=&gt;</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rss</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>atom</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xml</span><span class='tstring_end'>&#39;</span></span>] <span class='kw'>do</span>
  <span class='id identifier rubyid_builder'>builder</span> <span class='symbeg'>:</span><span class='id identifier rubyid_feed'>feed</span>
<span class='kw'>end</span></code></pre>

<p><code>provides</code> searches the request&#39;s Accept header.</p>

<p>You can easily define your own conditions:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_probability'>probability</span>) { <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_condition'>condition</span> { <span class='id identifier rubyid_rand'>rand</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_value'>value</span> } }

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/win_a_car</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_probability'>probability</span> <span class='op'>=&gt;</span> <span class='float'>0.1</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You won!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/win_a_car</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sorry, you lost.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>For a condition that takes multiple values use a splat:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_roles'>roles</span><span class='op'>|</span>   <span class='comment'># &lt;- notice the splat here
</span>  <span class='id identifier rubyid_condition'>condition</span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_logged_in?'>logged_in?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_roles'>roles</span>.<span class='id identifier rubyid_any?'>any?</span> {<span class='op'>|</span><span class='id identifier rubyid_role'>role</span><span class='op'>|</span> <span class='id identifier rubyid_current_user'>current_user</span>.<span class='id identifier rubyid_in_role?'>in_role?</span> <span class='id identifier rubyid_role'>role</span> }
      <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/login/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>303</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/my/account/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span> <span class='op'>=&gt;</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_admin'>admin</span>] <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your Account Details</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/only/admin/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_auth'>auth</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_admin'>admin</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Only admins are allowed here!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<h2>Return Values</h2>

<p>The return value of a route block determines at least the response body
passed on to the HTTP client or at least the next middleware in the
Rack stack. Most commonly, this is a string, as in the above examples.
But other values are also accepted.</p>

<p>You can return an object that would either be a valid Rack response, Rack
body object or HTTP status code:</p>

<ul>
<li>An Array with three elements: <code>[status (Integer), headers (Hash), response
body (responds to #each)]</code></li>
<li>An Array with two elements: <code>[status (Integer), response body (responds to
#each)]</code></li>
<li>An object that responds to <code>#each</code> and passes nothing but strings to
the given block</li>
<li>A Integer representing the status code</li>
</ul>

<p>That way we can, for instance, easily implement a streaming example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Stream</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
    <span class='int'>100</span>.<span class='id identifier rubyid_times'>times</span> { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='kw'>yield</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> }
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='const'>Stream</span>.<span class='id identifier rubyid_new'>new</span> }</code></pre>

<p>You can also use the <code>stream</code> helper method (<a href="#streaming-responses">described below</a>) to reduce
boilerplate and embed the streaming logic in the route.</p>

<h2>Custom Route Matchers</h2>

<p>As shown above, Sinatra ships with built-in support for using String
patterns and regular expressions as route matches. However, it does not
stop there. You can easily define your own matchers:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>AllButPattern</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_except'>except</span>)
    <span class='ivar'>@except</span> <span class='op'>=</span> <span class='id identifier rubyid_except'>except</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_to_pattern'>to_pattern</span>(<span class='id identifier rubyid_options'><a href="Sinatra/Delegator.html#options-instance_method" title="Sinatra::Delegator#options (method)">options</a></span>)
    <span class='kw'>return</span> <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_params'>params</span>(<span class='id identifier rubyid_route'>route</span>)
    <span class='kw'>return</span> {} <span class='kw'>unless</span> <span class='ivar'>@except</span> <span class='op'>===</span> <span class='id identifier rubyid_route'>route</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all_but'>all_but</span>(<span class='id identifier rubyid_pattern'>pattern</span>)
  <span class='const'>AllButPattern</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_pattern'>pattern</span>)
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='id identifier rubyid_all_but'>all_but</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/index</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
  <span class='comment'># ...
</span><span class='kw'>end</span></code></pre>

<p>Note that the above example might be over-engineered, as it can also be
expressed as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.*</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_pass'>pass</span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path_info'>path_info</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/index</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># ...
</span><span class='kw'>end</span></code></pre>

<h2>Static Files</h2>

<p>Static files are served from the <code>./public</code> directory. You can specify
a different location by setting the <code>:public_folder</code> option:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_public_folder'>public_folder</span><span class='comma'>,</span> <span class='id identifier rubyid___dir__'>__dir__</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/static</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>Note that the public directory name is not included in the URL. A file
<code>./public/css/style.css</code> is made available as
<code>http://example.com/css/style.css</code>.</p>

<p>Use the <code>:static_cache_control</code> setting (see <a href="#cache-control">below</a>) to add
<code>Cache-Control</code> header info.</p>

<p>By default, Sinatra serves static files from the <code>public/</code> folder without running middleware or filters. To add custom headers (e.g, for CORS or caching), use the <code>:static_headers</code> setting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_static_headers'>static_headers</span><span class='comma'>,</span> {
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>access-control-allow-origin</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>x-static-asset</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>served-by-sinatra</span><span class='tstring_end'>&#39;</span></span>
}</code></pre>

<h2>Views / Templates</h2>

<p>Each template language is exposed via its own rendering method. These
methods simply return a string:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>This renders <code>views/index.erb</code>.</p>

<p>Instead of a template name, you can also just pass in the template content
directly:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;%= Time.now %&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='id identifier rubyid_code'>code</span>
<span class='kw'>end</span></code></pre>

<p>Templates take a second argument, the options hash:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_layout'><a href="Sinatra/Delegator.html#layout-instance_method" title="Sinatra::Delegator#layout (method)">layout</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span>
<span class='kw'>end</span></code></pre>

<p>This will render <code>views/index.erb</code> embedded in the
<code>views/post.erb</code> (default is <code>views/layout.erb</code>, if it exists).</p>

<p>Any options not understood by Sinatra will be passed on to the template
engine:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_format'>format</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_html5'>html5</span>
<span class='kw'>end</span></code></pre>

<p>You can also set options per template language in general:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_haml'>haml</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_format'>format</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_html5'>html5</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>Options passed to the render method override options set via <code>set</code>.</p>

<p>Available Options:</p>

<dl>
  <dt>locals</dt>
  <dd>
    List of locals passed to the document. Handy with partials.
    Example: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    String encoding to use if uncertain. Defaults to
    <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Views folder to load templates from. Defaults to <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
    Whether to use a layout (<tt>true</tt> or <tt>false</tt>). If it's a
    Symbol, specifies what template to use. Example:
    <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    Content-Type the template produces. Default depends on template language.
  </dd>

  <dt>scope</dt>
  <dd>
    Scope to render template under. Defaults to the application
    instance. If you change this, instance variables and helper methods
    will not be available.
  </dd>

  <dt>layout_engine</dt>
  <dd>
    Template engine to use for rendering the layout. Useful for
    languages that do not support layouts otherwise. Defaults to the
    engine used for the template. Example: <tt>set :rdoc, :layout_engine
    => :erb</tt>
  </dd>

  <dt>layout_options</dt>
  <dd>
    Special options only used for rendering the layout. Example:
    <tt>set :rdoc, :layout_options => { :views => 'views/layouts' }</tt>
  </dd>
</dl>

<p>Templates are assumed to be located directly under the <code>./views</code>
directory. To use a different views directory:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='id identifier rubyid_settings'><a href="Sinatra/Delegator.html#settings-instance_method" title="Sinatra::Delegator#settings (method)">settings</a></span>.<span class='id identifier rubyid_root'>root</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/templates</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>One important thing to remember is that you always have to reference
templates with symbols, even if they&#39;re in a subdirectory (in this case,
use: <code>:&#39;subdir/template&#39;</code> or <code>&#39;subdir/template&#39;.to_sym</code>). You must use a
symbol because otherwise rendering methods will render any strings
passed to them directly.</p>

<h3>Literal Templates</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%div.title Hello World</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>Renders the template string. You can optionally specify <code>:path</code> and
<code>:line</code> for a clearer backtrace if there is a filesystem path or line
associated with that string:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%div.title Hello World</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_path'>path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>examples/file.haml</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_line'>line</span> <span class='op'>=&gt;</span> <span class='int'>3</span>
<span class='kw'>end</span></code></pre>

<h3>Available Template Languages</h3>

<p>Some languages have multiple implementations. To specify what implementation
to use (and to be thread-safe), you should simply require it first:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rdiscount</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='id identifier rubyid_markdown'>markdown</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span> }</code></pre>

<h4>Haml Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>

<h4>Erb Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td>
      <a href="https://github.com/jeremyevans/erubi" title="erubi">erubi</a>
      or erb (included in Ruby)
    </td>
  </tr>
  <tr>
    <td>File Extensions</td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubi</tt> (Erubi only)</td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>

<h4>Builder Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td>
      <a href="https://github.com/jimweirich/builder" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>It also takes a block for inline templates (see <a href="#inline-templates">example</a>).</p>

<h4>Nokogiri Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://www.nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>

<p>It also takes a block for inline templates (see <a href="#inline-templates">example</a>).</p>

<h4>Sass Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/ntkme/sass-embedded-host-ruby" title="sass-embedded">sass-embedded</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<h4>Scss Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/ntkme/sass-embedded-host-ruby" title="sass-embedded">sass-embedded</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>

<h4>Liquid Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://shopify.github.io/liquid/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>

<p>Since you cannot call Ruby methods (except for <code>yield</code>) from a Liquid
template, you almost always want to pass locals to it.</p>

<h4>Markdown Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td>
      Anyone of:
        <a href="https://github.com/davidfstr/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="https://kramdown.gettalong.org/" title="kramdown">kramdown</a>,
        <a href="https://github.com/gjtorikian/commonmarker" title="commonmarker">commonmarker</a>
        <a href="https://github.com/alphabetum/pandoc-ruby" title="pandoc">pandoc</a>
    </td>
  </tr>
  <tr>
    <td>File Extensions</td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>It is not possible to call methods from Markdown, nor to pass locals to it.
You therefore will usually use it in combination with another rendering
engine:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_overview'>overview</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_locals'>locals</span> <span class='op'>=&gt;</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_markdown'>markdown</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_introduction'>introduction</span>) }</code></pre>

<p>Note that you may also call the <code>markdown</code> method from within other
templates:</p>

<pre class="code ruby"><code class="ruby">%h1 Hello From Haml!
%p= markdown(:greetings)</code></pre>

<p>Since you cannot call Ruby from Markdown, you cannot use layouts written in
Markdown. However, it is possible to use another rendering engine for the
template than for the layout by passing the <code>:layout_engine</code> option.</p>

<h4>RDoc Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://rdoc.sourceforge.net/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>It is not possible to call methods from RDoc, nor to pass locals to it. You
therefore will usually use it in combination with another rendering engine:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_overview'>overview</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_locals'>locals</span> <span class='op'>=&gt;</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_rdoc'>rdoc</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_introduction'>introduction</span>) }</code></pre>

<p>Note that you may also call the <code>rdoc</code> method from within other templates:</p>

<pre class="code ruby"><code class="ruby">%h1 Hello From Haml!
%p= rdoc(:greetings)</code></pre>

<p>Since you cannot call Ruby from RDoc, you cannot use layouts written in
RDoc. However, it is possible to use another rendering engine for the
template than for the layout by passing the <code>:layout_engine</code> option.</p>

<h4>AsciiDoc Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="http://asciidoctor.org/" title="Asciidoctor">Asciidoctor</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.asciidoc</tt>, <tt>.adoc</tt> and <tt>.ad</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>asciidoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>

<p>Since you cannot call Ruby methods directly from an AsciiDoc template, you
almost always want to pass locals to it.</p>

<h4>Markaby Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://markaby.github.io/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>

<p>It also takes a block for inline templates (see <a href="#inline-templates">example</a>).</p>

<h4>RABL Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>

<h4>Slim Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://slim-template.github.io/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>

<h4>Yajl Templates</h4>

<table>
  <tr>
    <td>Dependency</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td>File Extension</td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td>Example</td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>

<p>The template source is evaluated as a Ruby string, and the
resulting json variable is converted using <code>#to_json</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_json'>json</span> <span class='op'>=</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span> }
<span class='id identifier rubyid_json'>json</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_baz'>baz</span>] <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span></code></pre>

<p>The <code>:callback</code> and <code>:variable</code> options can be used to decorate the rendered
object:</p>

<pre class="code javascript"><code class="javascript">var resource = {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;qux&quot;};
present(resource);
</code></pre>

<h3>Accessing Variables in Templates</h3>

<p>Templates are evaluated within the same context as route handlers. Instance
variables set in route handlers are directly accessible by templates:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@foo</span> <span class='op'>=</span> <span class='const'>Foo</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span>])
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%h1= @foo.name</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>Or, specify an explicit Hash of local variables:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:id</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_foo'>foo</span> <span class='op'>=</span> <span class='const'>Foo</span>.<span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span>])
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%h1= bar.name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_locals'>locals</span> <span class='op'>=&gt;</span> { <span class='symbeg'>:</span><span class='id identifier rubyid_bar'>bar</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_foo'>foo</span> }
<span class='kw'>end</span></code></pre>

<p>This is typically used when rendering templates as partials from within
other templates.</p>

<h3>Templates with <code>yield</code> and nested layouts</h3>

<p>A layout is usually just a template that calls <code>yield</code>.
Such a template can be used either through the <code>:template</code> option as
described above, or it can be rendered with a block as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_layout'><a href="Sinatra/Delegator.html#layout-instance_method" title="Sinatra::Delegator#layout (method)">layout</a></span> <span class='op'>=&gt;</span> <span class='kw'>false</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>This code is mostly equivalent to <code>erb :index, :layout =&gt; :post</code>.</p>

<p>Passing blocks to rendering methods is most useful for creating nested
layouts:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_main_layout'>main_layout</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_layout'><a href="Sinatra/Delegator.html#layout-instance_method" title="Sinatra::Delegator#layout (method)">layout</a></span> <span class='op'>=&gt;</span> <span class='kw'>false</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_admin_layout'>admin_layout</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This can also be done in fewer lines of code with:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_admin_layout'>admin_layout</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_layout'><a href="Sinatra/Delegator.html#layout-instance_method" title="Sinatra::Delegator#layout (method)">layout</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_main_layout'>main_layout</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>
<span class='kw'>end</span></code></pre>

<p>Currently, the following rendering methods accept a block: <code>erb</code>, <code>haml</code>,
<code>liquid</code>, <code>slim</code>. Also, the general <code>render</code> method accepts a block.</p>

<h3>Inline Templates</h3>

<p>Templates may be defined at the end of the source file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span>

<span class='__end__'>__END__
</span></code></pre>

<p>NOTE: Inline templates defined in the source file that requires Sinatra are
automatically loaded. Call <code>enable :inline_templates</code> explicitly if you
have inline templates in other source files.</p>

<h3>Named Templates</h3>

<p>Templates may also be defined using the top-level <code>template</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_template'><a href="Sinatra/Delegator.html#template-instance_method" title="Sinatra::Delegator#template (method)">template</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_layout'><a href="Sinatra/Delegator.html#layout-instance_method" title="Sinatra::Delegator#layout (method)">layout</a></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%html\n  =yield\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_template'><a href="Sinatra/Delegator.html#template-instance_method" title="Sinatra::Delegator#template (method)">template</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%div.title Hello World!</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>If a template named &quot;layout&quot; exists, it will be used each time a template
is rendered. You can individually disable layouts by passing
<code>:layout =&gt; false</code> or disable them by default via
<code>set :haml, :layout =&gt; false</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_layout'><a href="Sinatra/Delegator.html#layout-instance_method" title="Sinatra::Delegator#layout (method)">layout</a></span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_xhr?'>xhr?</span>
<span class='kw'>end</span></code></pre>

<h3>Associating File Extensions</h3>

<p>To associate a file extension with a template engine, use
<code>Tilt.register</code>. For instance, if you like to use the file extension
<code>tt</code> for Haml templates, you can do the following:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Tilt</span>.<span class='id identifier rubyid_register'>register</span> <span class='const'>Tilt</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_haml'>haml</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tt'>tt</span></code></pre>

<h3>Adding Your Own Template Engine</h3>

<p>First, register your engine with Tilt, then create a rendering method:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Tilt</span>.<span class='id identifier rubyid_register'>register</span> <span class='const'>MyAwesomeTemplateEngine</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_myat'>myat</span>

<span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_myat'>myat</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='id identifier rubyid_render'>render</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_myat'>myat</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_myat'>myat</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>Renders <code>./views/index.myat</code>. Learn more about
<a href="https://github.com/rtomayko/tilt#readme">Tilt</a>.</p>

<h3>Using Custom Logic for Template Lookup</h3>

<p>To implement your own template lookup mechanism you can write your
own <code>#find_template</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> [ <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>./views/a</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>./views/b</span><span class='tstring_end'>&#39;</span></span> ]
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_template'>find_template</span>(<span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='const'>Array</span>(<span class='id identifier rubyid_views'>views</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>super</span>(<span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h2>Filters</h2>

<p>Before filters are evaluated before each request within the same context
as the routes will be and can modify the request and response. Instance
variables set in filters are accessible by routes and templates:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> <span class='kw'>do</span>
  <span class='ivar'>@note</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hi!</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path_info'>path_info</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo/bar/baz</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo/*</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@note</span> <span class='comment'>#=&gt; &#39;Hi!&#39;
</span>  <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>splat</span><span class='tstring_end'>&#39;</span></span>] <span class='comment'>#=&gt; &#39;bar/baz&#39;
</span><span class='kw'>end</span></code></pre>

<p>After filters are evaluated after each request within the same context
as the routes will be and can also modify the request and response.
Instance variables set in before filters and routes are accessible by
after filters:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_after'><a href="Sinatra/Delegator.html#after-instance_method" title="Sinatra::Delegator#after (method)">after</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_status'>status</span>
<span class='kw'>end</span></code></pre>

<p>Note: Unless you use the <code>body</code> method rather than just returning a
String from the routes, the body will not yet be available in the after
filter, since it is generated later on.</p>

<p>Filters optionally take a pattern, causing them to be evaluated only if the
request path matches that pattern:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected/*</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_authenticate!'>authenticate!</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_after'><a href="Sinatra/Delegator.html#after-instance_method" title="Sinatra::Delegator#after (method)">after</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/create/:slug</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_slug'>slug</span><span class='op'>|</span>
  <span class='id identifier rubyid_session'>session</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_last_slug'>last_slug</span>] <span class='op'>=</span> <span class='id identifier rubyid_slug'>slug</span>
<span class='kw'>end</span></code></pre>

<p>Like routes, filters also take conditions:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_agent'>agent</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>Songbird</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>

<span class='id identifier rubyid_after'><a href="Sinatra/Delegator.html#after-instance_method" title="Sinatra::Delegator#after (method)">after</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/blog/*</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_host_name'>host_name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example.com</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span><span class='kw'>end</span></code></pre>

<h2>Helpers</h2>

<p>Use the top-level <code>helpers</code> method to define helper methods for use in
route handlers and templates:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_bar'>bar</span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:name</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_bar'>bar</span>(<span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>])
<span class='kw'>end</span></code></pre>

<p>Alternatively, helper methods can be separately defined in a module:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>FooUtils</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_foo'>foo</span>(<span class='id identifier rubyid_name'>name</span>) <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>module</span> <span class='const'>BarUtils</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_bar'>bar</span>(<span class='id identifier rubyid_name'>name</span>) <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='const'>FooUtils</span><span class='comma'>,</span> <span class='const'>BarUtils</span></code></pre>

<p>The effect is the same as including the modules in the application class.</p>

<h3>Using Sessions</h3>

<p>A session is used to keep state during requests. If activated, you have one
session hash per user session:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value = </span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_session'>session</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>].<span class='id identifier rubyid_inspect'>inspect</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/:value</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_session'>session</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span>]
<span class='kw'>end</span></code></pre>

<h4>Session Secret Security</h4>

<p>To improve security, the session data in the cookie is signed with a session
secret using <code>HMAC-SHA1</code>. This session secret should optimally be a
cryptographically secure random value of an appropriate length which for
<code>HMAC-SHA1</code> is greater than or equal to 64 bytes (512 bits, 128 hex
characters). You would be advised not to use a secret that is less than 32
bytes of randomness (256 bits, 64 hex characters). It is therefore <strong>very
important</strong> that you don&#39;t just make the secret up, but instead use a secure
random number generator to create it. Humans are extremely bad at generating
random values.</p>

<p>By default, a 32 byte secure random session secret is generated for you by
Sinatra, but it will change with every restart of your application. If you
have multiple instances of your application, and you let Sinatra generate the
key, each instance would then have a different session key which is probably
not what you want.</p>

<p>For better security and usability it&#39;s
<a href="https://12factor.net/config">recommended</a> that you generate a secure random
secret and store it in an environment variable on each host running your
application so that all of your application instances will share the same
secret. You should periodically rotate this session secret to a new value.
Here are some examples of how you might create a 64-byte secret and set it:</p>

<p><strong>Session Secret Generation</strong></p>

<pre class="code text"><code class="text">$ ruby -e &quot;require &#39;securerandom&#39;; puts SecureRandom.hex(64)&quot;
99ae8af...snip...ec0f262ac
</code></pre>

<p><strong>Session Secret Environment Variable</strong></p>

<p>Set a <code>SESSION_SECRET</code> environment variable for Sinatra to the value you
generated. Make this value persistent across reboots of your host. Since the
method for doing this will vary across systems this is for illustrative
purposes only:</p>

<pre class="code bash"><code class="bash"># echo &quot;export SESSION_SECRET=99ae8af...snip...ec0f262ac&quot; &gt;&gt; ~/.bashrc
</code></pre>

<p><strong>Session Secret App Config</strong></p>

<p>Set up your app config to fail-safe to a secure random secret
if the <code>SESSION_SECRET</code> environment variable is not available:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>securerandom</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_session_secret'>session_secret</span><span class='comma'>,</span> <span class='const'>ENV</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SESSION_SECRET</span><span class='tstring_end'>&#39;</span></span>) { <span class='const'>SecureRandom</span>.<span class='id identifier rubyid_hex'>hex</span>(<span class='int'>64</span>) }</code></pre>

<h4>Session Config</h4>

<p>If you want to configure it further, you may also store a hash with options
in the <code>sessions</code> setting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_domain'>domain</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo.com</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>To share your session across other apps on subdomains of foo.com, prefix the
domain with a <em>.</em> like this instead:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_domain'>domain</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.foo.com</span><span class='tstring_end'>&#39;</span></span></code></pre>

<h4>Choosing Your Own Session Middleware</h4>

<p>Note that <code>enable :sessions</code> actually stores all data in a cookie. This
might not always be what you want (storing lots of data will increase your
traffic, for instance). You can use any Rack session middleware in order to
do so, one of the following methods can be used:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span>
<span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_session_store'>session_store</span><span class='comma'>,</span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Session</span><span class='op'>::</span><span class='const'>Pool</span></code></pre>

<p>Or to set up sessions with a hash of options:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_expire_after'>expire_after</span> <span class='op'>=&gt;</span> <span class='int'>2592000</span>
<span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_session_store'>session_store</span><span class='comma'>,</span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Session</span><span class='op'>::</span><span class='const'>Pool</span></code></pre>

<p>Another option is to <strong>not</strong> call <code>enable :sessions</code>, but instead pull in
your middleware of choice as you would any other middleware.</p>

<p>It is important to note that when using this method, session based
protection <strong>will not be enabled by default</strong>.</p>

<p>The Rack middleware to do that will also need to be added:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Session</span><span class='op'>::</span><span class='const'>Pool</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_expire_after'>expire_after</span> <span class='op'>=&gt;</span> <span class='int'>2592000</span>
<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'><a href="Rack/Protection.html" title="Rack::Protection (module)">Protection</a></span><span class='op'>::</span><span class='const'><a href="Rack/Protection/RemoteToken.html" title="Rack::Protection::RemoteToken (class)">RemoteToken</a></span>
<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'><a href="Rack/Protection.html" title="Rack::Protection (module)">Protection</a></span><span class='op'>::</span><span class='const'><a href="Rack/Protection/SessionHijacking.html" title="Rack::Protection::SessionHijacking (class)">SessionHijacking</a></span></code></pre>

<p>See &#39;<a href="#configuring-attack-protection">Configuring attack protection</a>&#39; for more information.</p>

<h3>Halting</h3>

<p>To immediately stop a request within a filter or route use:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span></code></pre>

<p>You can also specify the status when halting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='int'>410</span></code></pre>

<p>Or the body:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>this will be the body</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>Or both:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='int'>401</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>go away!</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>With headers:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='int'>402</span><span class='comma'>,</span> {<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>&#39;</span></span>}<span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>revenge</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>It is of course possible to combine a template with <code>halt</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='id identifier rubyid_erb'>erb</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span>)</code></pre>

<h3>Passing</h3>

<p>A route can punt processing to the next matching route using <code>pass</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/guess/:who</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_pass'>pass</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>who</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Frank</span><span class='tstring_end'>&#39;</span></span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You got me!</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/guess/*</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You missed!</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>The route block is immediately exited and control continues with the next
matching route. If no matching route is found, a 404 is returned.</p>

<h3>Triggering Another Route</h3>

<p>Sometimes <code>pass</code> is not what you want, instead, you would like to get the
result of calling another route. Simply use <code>call</code> to achieve this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PATH_INFO</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span>)
  [<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_upcase'>upcase</span>)]
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Note that in the example above, you would ease testing and increase
performance by simply moving <code>&quot;bar&quot;</code> into a helper used by both <code>/foo</code> and
<code>/bar</code>.</p>

<p>If you want the request to be sent to the same application instance rather
than a duplicate, use <code>call!</code> instead of <code>call</code>.</p>

<p>Check out the Rack specification if you want to learn more about <code>call</code>.</p>

<h3>Setting Body, Status Code, and Headers</h3>

<p>It is possible and recommended to set the status code and response body with
the return value of the route block. However, in some scenarios, you might
want to set the body at an arbitrary point in the execution flow. You can do
so with the <code>body</code> helper method. If you do so, you can use that method from
thereon to access the body:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_body'>body</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_after'><a href="Sinatra/Delegator.html#after-instance_method" title="Sinatra::Delegator#after (method)">after</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_body'>body</span>
<span class='kw'>end</span></code></pre>

<p>It is also possible to pass a block to <code>body</code>, which will be executed by the
Rack handler (this can be used to implement streaming, <a href="#return-values">see &quot;Return Values&quot;</a>).</p>

<p>Similar to the body, you can also set the status code and headers:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_status'>status</span> <span class='int'>418</span>
  <span class='id identifier rubyid_headers'>headers</span> \
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Allow</span><span class='tstring_end'>&quot;</span></span>   <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BREW, POST, GET, PROPFIND, WHEN</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Refresh</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Refresh: 20; https://ietf.org/rfc/rfc2324.txt</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_body'>body</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I&#39;m a teapot!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Like <code>body</code>, <code>headers</code> and <code>status</code> with no arguments can be used to access
their current values.</p>

<h3>Streaming Responses</h3>

<p>Sometimes you want to start sending out data while still generating parts of
the response body. In extreme examples, you want to keep sending data until
the client closes the connection. You can use the <code>stream</code> helper to avoid
creating your own wrapper:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_stream'>stream</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_out'>out</span><span class='op'>|</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>It&#39;s gonna be legen -\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.5</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> (wait for it) \n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>- dary!\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This allows you to implement streaming APIs,
<a href="https://w3c.github.io/eventsource/">Server Sent Events</a>, and can be used as
the basis for <a href="https://en.wikipedia.org/wiki/WebSocket">WebSockets</a>. It can
also be used to increase throughput if some but not all content depends on a
slow resource.</p>

<p>Note that the streaming behavior, especially the number of concurrent
requests, highly depends on the webserver used to serve the application.
Some servers might not even support streaming at all. If the server does not
support streaming, the body will be sent all at once after the block passed
to <code>stream</code> finishes executing. Streaming does not work at all with Shotgun.</p>

<p>If the optional parameter is set to <code>keep_open</code>, it will not call <code>close</code> on
the stream object, allowing you to close it at any later point in the
execution flow.</p>

<p>You can have a look at the <a href="https://github.com/sinatra/sinatra/blob/main/examples/chat.rb">chat example</a></p>

<p>It&#39;s also possible for the client to close the connection when trying to
write to the socket. Because of this, it&#39;s recommended to check
<code>out.closed?</code> before trying to write.</p>

<h3>Logging</h3>

<p>In the request scope, the <code>logger</code> helper exposes a <code>Logger</code> instance:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>loading data</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># ...
</span><span class='kw'>end</span></code></pre>

<p>This logger will automatically take your Rack handler&#39;s logging settings into
account. If logging is disabled, this method will return a dummy object, so
you do not have to worry about it in your routes and filters.</p>

<p>Note that logging is only enabled for <a href="Sinatra/Application.html" title="Sinatra::Application (class)"><code>::Sinatra::Application</code></a> by default, so
if you inherit from <a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a>, you probably want to enable it yourself:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_production'>production</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_development'>development</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_logging'>logging</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>To avoid any logging middleware to be set up, set the <code>logging</code> option to
<code>nil</code>. However, keep in mind that <code>logger</code> will in that case return <code>nil</code>. A
common use case is when you want to set your own logger. Sinatra will use
whatever it will find in <code>env[&#39;rack.logger&#39;]</code>.</p>

<h3>Mime Types</h3>

<p>When using <code>send_file</code> or static files you may have mime types Sinatra
doesn&#39;t understand. Use <code>mime_type</code> to register them by file extension:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_mime_type'><a href="Sinatra/Delegator.html#mime_type-instance_method" title="Sinatra::Delegator#mime_type (method)">mime_type</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/foo</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>You can also use it with the <code>content_type</code> helper:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo foo foo</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<h3>Generating URLs</h3>

<p>For generating URLs you should use the <code>url</code> helper method, for instance, in
Haml:</p>

<pre class="code ruby"><code class="ruby">%a{:href =&gt; url(&#39;/foo&#39;)} foo</code></pre>

<p>It takes reverse proxies and Rack routers into account - if present.</p>

<p>This method is also aliased to <code>to</code> (see <a href="#browser-redirect">below</a> for an example).</p>

<h3>Browser Redirect</h3>

<p>You can trigger a browser redirect with the <code>redirect</code> helper method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_to'>to</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span></code></pre>

<p>Any additional parameters are handled like arguments passed to <code>halt</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_to'>to</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span>)<span class='comma'>,</span> <span class='int'>303</span>
<span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.google.com/</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>wrong place, buddy</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>You can also easily redirect back to the page the user came from with
<code>redirect back</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;a href=&#39;/bar&#39;&gt;do something&lt;/a&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_do_something'>do_something</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_back'>back</span>
<span class='kw'>end</span></code></pre>

<p>To pass arguments with a redirect, either add them to the query:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_to'>to</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar?sum=42</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>Or use a session:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_session'>session</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_secret'>secret</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_to'>to</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_session'>session</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_secret'>secret</span>]
<span class='kw'>end</span></code></pre>

<h3>Cache Control</h3>

<p>Setting your headers correctly is the foundation for proper HTTP caching.</p>

<p>You can easily set the Cache-Control header like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_cache_control'>cache_control</span> <span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cache it!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Pro tip: Set up caching in a before filter:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_cache_control'>cache_control</span> <span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_must_revalidate'>must_revalidate</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_age'>max_age</span> <span class='op'>=&gt;</span> <span class='int'>60</span>
<span class='kw'>end</span></code></pre>

<p>If you are using the <code>expires</code> helper to set the corresponding header,
<code>Cache-Control</code> will be set automatically for you:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_expires'>expires</span> <span class='int'>500</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_must_revalidate'>must_revalidate</span>
<span class='kw'>end</span></code></pre>

<p>To properly use caches, you should consider using <code>etag</code> or <code>last_modified</code>.
It is recommended to call those helpers <em>before</em> doing any heavy lifting, as
they will immediately flush a response if the client already has the current
version in its cache:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/article/:id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@article</span> <span class='op'>=</span> <span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span>]
  <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_updated_at'>updated_at</span>
  <span class='id identifier rubyid_etag'>etag</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_sha1'>sha1</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_article'>article</span>
<span class='kw'>end</span></code></pre>

<p>It is also possible to use a
<a href="https://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak ETag</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_etag'>etag</span> <span class='ivar'>@article</span>.<span class='id identifier rubyid_sha1'>sha1</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_weak'>weak</span></code></pre>

<p>These helpers will not do any caching for you, but rather feed the necessary
information to your cache. If you are looking for a quick
reverse-proxy caching solution, try
<a href="https://github.com/rtomayko/rack-cache#readme">rack-cache</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack/cache</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Cache</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_cache_control'>cache_control</span> <span class='symbeg'>:</span><span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max_age'>max_age</span> <span class='op'>=&gt;</span> <span class='int'>36000</span>
  <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>5</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Use the <code>:static_cache_control</code> setting (see <a href="#cache-control">below</a>) to add
<code>Cache-Control</code> header info to static files.</p>

<p>According to RFC 2616, your application should behave differently if the
If-Match or If-None-Match header is set to <code>*</code>, depending on whether the
resource requested is already in existence. Sinatra assumes resources for
safe (like get) and idempotent (like put) requests are already in existence,
whereas other resources (for instance post requests) are treated as new
resources. You can change this behavior by passing in a <code>:new_resource</code>
option:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/create</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_etag'>etag</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new_resource'>new_resource</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
  <span class='const'>Article</span>.<span class='id identifier rubyid_create'>create</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new_article'>new_article</span>
<span class='kw'>end</span></code></pre>

<p>If you still want to use a weak ETag, pass in a <code>:kind</code> option:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_etag'>etag</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_new_resource'>new_resource</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_kind'>kind</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_weak'>weak</span></code></pre>

<h3>Sending Files</h3>

<p>To return the contents of a file as the response, you can use the <code>send_file</code>
helper method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_send_file'>send_file</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo.png</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>It also takes options:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_send_file'>send_file</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo.png</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jpg'>jpg</span></code></pre>

<p>The options are:</p>

<dl>
  <dt>filename</dt>
    <dd>File name to be used in the response,
    defaults to the real file name.</dd>
  <dt>last_modified</dt>
    <dd>Value for Last-Modified header, defaults to the file's mtime.</dd>

  <dt>type</dt>
    <dd>Value for Content-Type header, guessed from the file extension if
    missing.</dd>

  <dt>disposition</dt>
    <dd>
      Value for Content-Disposition header, possible values: <tt>nil</tt>
      (default), <tt>:attachment</tt> and <tt>:inline</tt>
    </dd>

  <dt>length</dt>
    <dd>Value for Content-Length header, defaults to file size.</dd>

  <dt>status</dt>
    <dd>
      Status code to be sent. Useful when sending a static file as an error
      page. If supported by the Rack handler, other means than streaming
      from the Ruby process will be used. If you use this helper method,
      Sinatra will automatically handle range requests.
    </dd>
</dl>

<h3>Accessing the Request Object</h3>

<p>The incoming request object can be accessed from request level (filter,
routes, error handlers) through the <code>request</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app running on http://example.com/example
</span><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>text/css</span><span class='words_sep'> </span><span class='tstring_content'>text/html</span><span class='words_sep'> </span><span class='tstring_content'>application/javascript</span><span class='tstring_end'>]</span></span>
  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_accept'>accept</span>              <span class='comment'># [&#39;text/html&#39;, &#39;*/*&#39;]
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_accept?'>accept?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/xml</span><span class='tstring_end'>&#39;</span></span>  <span class='comment'># true
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_preferred_type'>preferred_type</span>(<span class='id identifier rubyid_t'>t</span>)   <span class='comment'># &#39;text/html&#39;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_body'>body</span>                <span class='comment'># request body sent by the client (see below)
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_scheme'>scheme</span>              <span class='comment'># &quot;http&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_script_name'>script_name</span>         <span class='comment'># &quot;/example&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path_info'>path_info</span>           <span class='comment'># &quot;/foo&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_port'>port</span>                <span class='comment'># 80
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_request_method'>request_method</span>      <span class='comment'># &quot;GET&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_query_string'>query_string</span>        <span class='comment'># &quot;&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_content_length'>content_length</span>      <span class='comment'># length of request.body
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_media_type'>media_type</span>          <span class='comment'># media type of request.body
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_host'>host</span>                <span class='comment'># &quot;example.com&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_get?'>get?</span>                <span class='comment'># true (similar methods for other verbs)
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_form_data?'>form_data?</span>          <span class='comment'># false
</span>  <span class='id identifier rubyid_request'>request</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>some_param</span><span class='tstring_end'>&quot;</span></span>]       <span class='comment'># value of some_param parameter. [] is a shortcut to the params hash.
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_referrer'>referrer</span>            <span class='comment'># the referrer of the client or &#39;/&#39;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_user_agent'>user_agent</span>          <span class='comment'># user agent (used by :agent condition)
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_cookies'>cookies</span>             <span class='comment'># hash of browser cookies
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_xhr?'>xhr?</span>                <span class='comment'># is this an ajax request?
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_url'>url</span>                 <span class='comment'># &quot;http://example.com/example/foo&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path'>path</span>                <span class='comment'># &quot;/example/foo&quot;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_ip'>ip</span>                  <span class='comment'># client IP address
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_secure?'>secure?</span>             <span class='comment'># false (would be true over ssl)
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_forwarded?'>forwarded?</span>          <span class='comment'># true (if running behind a reverse proxy)
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_env'>env</span>                 <span class='comment'># raw env hash handed in by Rack
</span><span class='kw'>end</span></code></pre>

<p>Some options, like <code>script_name</code> or <code>path_info</code>, can also be written:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> { <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path_info'>path_info</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span> }

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>all requests end up here</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>The <code>request.body</code> is an IO or StringIO object:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/api</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_rewind'>rewind</span>  <span class='comment'># in case someone already read it
</span>  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'>JSON</span>.<span class='id identifier rubyid_parse'>parse</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_read'>read</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>]<span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<h3>Attachments</h3>

<p>You can use the <code>attachment</code> helper to tell the browser the response should
be stored on disk rather than displayed in the browser:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_attachment'>attachment</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>store it!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>You can also pass it a file name:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_attachment'>attachment</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>info.txt</span><span class='tstring_end'>&quot;</span></span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>store it!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<h3>Dealing with Date and Time</h3>

<p>Sinatra offers a <code>time_for</code> helper method that generates a Time object from
the given value. It is also able to convert <code>DateTime</code>, <code>Date</code> and similar
classes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_pass'>pass</span> <span class='kw'>if</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_time_for'>time_for</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Dec 23, 2016</span><span class='tstring_end'>&#39;</span></span>)
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>still time</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>This method is used internally by <code>expires</code>, <code>last_modified</code> and akin. You
can therefore easily extend the behavior of those methods by overriding
<code>time_for</code> in your application:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_time_for'>time_for</span>(<span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>case</span> <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_yesterday'>yesterday</span> <span class='kw'>then</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>24</span><span class='op'>*</span><span class='int'>60</span><span class='op'>*</span><span class='int'>60</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tomorrow'>tomorrow</span>  <span class='kw'>then</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='int'>24</span><span class='op'>*</span><span class='int'>60</span><span class='op'>*</span><span class='int'>60</span>
    <span class='kw'>else</span> <span class='kw'>super</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_last_modified'>last_modified</span> <span class='symbeg'>:</span><span class='id identifier rubyid_yesterday'>yesterday</span>
  <span class='id identifier rubyid_expires'>expires</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tomorrow'>tomorrow</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<h3>Looking Up Template Files</h3>

<p>The <code>find_template</code> helper is used to find template files for rendering:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_find_template'>find_template</span> <span class='id identifier rubyid_settings'><a href="Sinatra/Delegator.html#settings-instance_method" title="Sinatra::Delegator#settings (method)">settings</a></span>.<span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='const'>Tilt</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_haml'>haml</span>] <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>could be </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>This is not really useful. But it is useful that you can actually override
this method to hook in your own lookup mechanism. For instance, if you want
to be able to use more than one view directory:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>views</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>templates</span><span class='tstring_end'>&#39;</span></span>]

<span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_find_template'>find_template</span>(<span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='const'>Array</span>(<span class='id identifier rubyid_views'>views</span>).<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='kw'>super</span>(<span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Another example would be using different directories for different engines:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_haml'>haml</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>templates</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_default'>default</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>views</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_find_template'>find_template</span>(<span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_folder'>folder</span> <span class='op'>=</span> <span class='id identifier rubyid_views'>views</span>.<span class='id identifier rubyid_detect'>detect</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_engine'>engine</span> <span class='op'>==</span> <span class='const'>Tilt</span>[<span class='id identifier rubyid_k'>k</span>] }
    <span class='id identifier rubyid_folder'>folder</span> <span class='op'>||=</span> <span class='id identifier rubyid_views'>views</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_default'>default</span>]
    <span class='kw'>super</span>(<span class='id identifier rubyid_folder'>folder</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_engine'>engine</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You can also easily wrap this up in an extension and share it with others!</p>

<p>Note that <code>find_template</code> does not check if the file really exists but
rather calls the given block for all possible paths. This is not a
performance issue, since <code>render</code> will use <code>break</code> as soon as a file is
found. Also, template locations (and content) will be cached if you are not
running in development mode. You should keep that in mind if you write a
really crazy method.</p>

<h2>Configuration</h2>

<p>Run once, at startup, in any environment:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='kw'>do</span>
  <span class='comment'># setting one option
</span>  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_option'>option</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>value</span><span class='tstring_end'>&#39;</span></span>

  <span class='comment'># setting multiple options
</span>  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_a'>a</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_b'>b</span> <span class='op'>=&gt;</span> <span class='int'>2</span>

  <span class='comment'># same as `set :option, true`
</span>  <span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_option'>option</span>

  <span class='comment'># same as `set :option, false`
</span>  <span class='id identifier rubyid_disable'><a href="Sinatra/Delegator.html#disable-instance_method" title="Sinatra::Delegator#disable (method)">disable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_option'>option</span>

  <span class='comment'># you can also have dynamic settings with blocks
</span>  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_css_dir'>css_dir</span>) { <span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='id identifier rubyid_views'>views</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>css</span><span class='tstring_end'>&#39;</span></span>) }
<span class='kw'>end</span></code></pre>

<p>Run only when the environment (<code>APP_ENV</code> environment variable) is set to
<code>:production</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_production'>production</span> <span class='kw'>do</span>
  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>

<p>Run when the environment is set to either <code>:production</code> or <code>:test</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_production'>production</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_test'>test</span> <span class='kw'>do</span>
  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>

<p>You can access those options via <code>settings</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_configure'><a href="Sinatra/Delegator.html#configure-instance_method" title="Sinatra::Delegator#configure (method)">configure</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_settings'><a href="Sinatra/Delegator.html#settings-instance_method" title="Sinatra::Delegator#settings (method)">settings</a></span>.<span class='id identifier rubyid_foo?'>foo?</span> <span class='comment'># =&gt; true
</span>  <span class='id identifier rubyid_settings'><a href="Sinatra/Delegator.html#settings-instance_method" title="Sinatra::Delegator#settings (method)">settings</a></span>.<span class='id identifier rubyid_foo'>foo</span>  <span class='comment'># =&gt; &#39;bar&#39;
</span>  <span class='op'>...</span>
<span class='kw'>end</span></code></pre>

<h3>Configuring attack protection</h3>

<p>Sinatra is using
<a href="https://github.com/sinatra/sinatra/tree/main/rack-protection#readme">Rack::Protection</a> to
defend your application against common, opportunistic attacks. You can
easily disable this behavior (which will open up your application to tons
of common vulnerabilities):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_disable'><a href="Sinatra/Delegator.html#disable-instance_method" title="Sinatra::Delegator#disable (method)">disable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_protection'>protection</span></code></pre>

<p>To skip a single defense layer, set <code>protection</code> to an options hash:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_protection'>protection</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_except'>except</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_path_traversal'>path_traversal</span></code></pre>

<p>You can also hand in an array in order to disable a list of protections:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_protection'>protection</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_except'>except</span> <span class='op'>=&gt;</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_path_traversal'>path_traversal</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_remote_token'>remote_token</span>]</code></pre>

<p>By default, Sinatra will only set up session based protection if <code>:sessions</code>
have been enabled. See &#39;<a href="#using-sessions">Using Sessions</a>&#39;. Sometimes you may want to set up
sessions &quot;outside&quot; of the Sinatra app, such as in the config.ru or with a
separate <a href="Rack/Builder.html" title="Rack::Builder (class)"><code>::Rack::Builder</code></a> instance. In that case, you can still set up session
based protection by passing the <code>:session</code> option:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_protection'>protection</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_session'>session</span> <span class='op'>=&gt;</span> <span class='kw'>true</span></code></pre>

<h3>Available Settings</h3>

<dl>
  <dt>absolute_redirects</dt>
    <dd>
      If disabled, Sinatra will allow relative redirects, however, Sinatra
      will no longer conform with RFC 2616 (HTTP 1.1), which only allows
      absolute redirects.
    </dd>
    <dd>
      Enable if your app is running behind a reverse proxy that has not been
      set up properly. Note that the <tt>url</tt> helper will still produce
      absolute URLs, unless you pass in <tt>false</tt> as the second
      parameter.
    </dd>
    <dd>Disabled by default.</dd>

  <dt>add_charset</dt>
    <dd>
      Mime types the <tt>content_type</tt> helper will automatically add the
      charset info to. You should add to it rather than overriding this
      option: <tt>settings.add_charset << "application/foobar"</tt>
    </dd>

  <dt>app_file</dt>
    <dd>
      Path to the main application file, used to detect project root, views
      and public folder and inline templates.
    </dd>

  <dt>bind</dt>
    <dd>
      IP address to bind to (default: <tt>0.0.0.0</tt> <em>or</em>
      <tt>localhost</tt> if your <code>environment</code> is set to development). Only
      used for built-in server.
    </dd>

  <dt>default_content_type</dt>
  <dd>
    Content-Type to assume if unknown (defaults to <tt>"text/html"</tt>). Set
    to <tt>nil</tt> to not set a default Content-Type on every response; when
    configured so, you must set the Content-Type manually when emitting content
    or the user-agent will have to sniff it (or, if <tt>nosniff</tt> is enabled
    in Rack::Protection::XSSHeader, assume <tt>application/octet-stream</tt>).
  </dd>

  <dt>default_encoding</dt>
    <dd>Encoding to assume if unknown (defaults to <tt>"utf-8"</tt>).</dd>

  <dt>dump_errors</dt>
    <dd>Display errors in the log. Enabled by default unless environment is "test".</dd>

  <dt>environment</dt>
    <dd>
      Current environment. Defaults to <code>ENV['APP_ENV']</code>, or
      <tt>"development"</tt> if not available.
    </dd>

  <dt>host_authorization</dt>
  <dd>
    <p>
      You can pass a hash of options to <tt>host_authorization</tt>,
      to be used by the <a href="Rack/Protection/HostAuthorization.html" title="Rack::Protection::HostAuthorization (class)"><code>::Rack::Protection::HostAuthorization</code></a> middleware.
    </p>
    <p>
      The middleware can block requests with unrecognized hostnames, to prevent DNS rebinding
      and other host header attacks. It checks the <code>Host</code>, <code>X-Forwarded-Host</code>
      and <code>Forwarded</code> headers.
    </p>
    <p>
      Useful options are:
      <ul>
        <li><tt>permitted_hosts</tt> – an array of hostnames (and <code>IPAddr</code> objects) your app recognizes
          <ul>
            <li>in the <tt>development</tt> environment, it is set to <tt>.localhost</tt>, <tt>.test</tt> and any IPv4/IPv6 address</li>
            <li>if empty, any hostname is permitted (the default for any other environment)</li>
          </ul>
        </li>
        <li><tt>status</tt> – the HTTP status code used in the response when a request is blocked (defaults to <tt>403</tt>)</li>
        <li><tt>message</tt> – the body used in the response when a request is blocked (defaults to <tt>Host not permitted</tt>)</li>
        <li><tt>allow_if</tt> – supply a <code>Proc</code> to use custom allow/deny logic, the proc is passed the request environment</li>
      </ul>
    </p>
  </dd>

  <dt>logging</dt>
    <dd>Use the logger.</dd>

  <dt>lock</dt>
    <dd>
      Places a lock around every request, only running processing on request
      per Ruby process concurrently.
    </dd>
    <dd>Enabled if your app is not thread-safe. Disabled by default.</dd>

  <dt>method_override</dt>
    <dd>
      Use <tt>_method</tt> magic to allow put/delete forms in browsers that
      don't support it.
    </dd>

  <dt>mustermann_opts</dt>
  <dd>
    A default hash of options to pass to Mustermann.new when compiling routing
    paths.
  </dd>

  <dt>port</dt>
    <dd>Port to listen on. Only used for built-in server.</dd>

  <dt>prefixed_redirects</dt>
    <dd>
      Whether or not to insert <tt>request.script_name</tt> into redirects
      if no absolute path is given. That way <tt>redirect '/foo'</tt> would
        behave like <tt>redirect to('/foo')</tt>. Disabled by default.
    </dd>

  <dt>protection</dt>
    <dd>
      Whether or not to enable web attack protections. See protection section
      above.
    </dd>

  <dt>public_dir</dt>
    <dd>Alias for <tt>public_folder</tt>. See below.</dd>

  <dt>public_folder</dt>
    <dd>
      Path to the folder public files are served from. Only used if static
      file serving is enabled (see <tt>static</tt> setting below). Inferred
      from <tt>app_file</tt> setting if not set.
    </dd>

  <dt>quiet</dt>
    <dd>
      Disables logs generated by Sinatra's start and stop commands.
      <tt>false</tt> by default.
    </dd>

  <dt>reload_templates</dt>
    <dd>
      Whether or not to reload templates between requests. Enabled in
      development mode.
    </dd>

  <dt>root</dt>
    <dd>
      Path to project root folder. Inferred from <tt>app_file</tt> setting
      if not set.
    </dd>

  <dt>raise_errors</dt>
    <dd>
      Raise unhandled errors (will stop application). Enabled by default when
      <tt>environment</tt> is set to <tt>"test"</tt>, disabled otherwise.
    </dd>
    <dd>
      Any explicitly defined error handlers always override this setting. See 
      the "Error" section below.
    </dd>

  <dt>run</dt>
    <dd>
      If enabled, Sinatra will handle starting the web server. Do not
      enable if using rackup or other means.
    </dd>

  <dt>running</dt>
    <dd>Is the built-in server running now? Do not change this setting!</dd>

  <dt>server</dt>
    <dd>
      Server or list of servers to use for built-in server. Order indicates
      priority, default depends on Ruby implementation.
    </dd>

  <dt>server_settings</dt>
    <dd>
      You can pass a hash of options to <tt>server_settings</tt>,
      such as <code>Host</code> or <code>Port</code>.
    </dd>

  <dt>sessions</dt>
    <dd>
      Enable cookie-based sessions support using
      <code>Rack::Session::Cookie</code>. See 'Using Sessions' section for more
      information.
    </dd>

  <dt>session_store</dt>
    <dd>
      The Rack session middleware used. Defaults to
      <code>Rack::Session::Cookie</code>. See 'Using Sessions' section for more
      information.
    </dd>

  <dt>show_exceptions</dt>
    <dd>
      Show a stack trace in the browser when an exception happens. Enabled by
      default when <tt>environment</tt> is set to <tt>"development"</tt>,
      disabled otherwise.
    </dd>
    <dd>
      Can also be set to <tt>:after_handler</tt> to trigger app-specified
      error handling before showing a stack trace in the browser.
    </dd>

  <dt>static</dt>
    <dd>Whether Sinatra should handle serving static files.</dd>
    <dd>Disable when using a server able to do this on its own.</dd>
    <dd>Disabling will boost performance.</dd>
    <dd>
      Enabled by default in classic style, disabled for modular apps.
    </dd>

  <dt>static_cache_control</dt>
    <dd>
      When Sinatra is serving static files, set this to add
      <code>Cache-Control</code> headers to the responses. Uses the
      <tt>cache_control</tt> helper. Disabled by default.
    </dd>
    <dd>
      Use an explicit array when setting multiple values:
      <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
    </dd>

  <dt>static_headers</dt>
    <dd>
      Allows you to define custom header settings for static file responses.
    </dd>
    <dd>
      For example: <br>
      <tt>set :static_headers, {'access-control-allow-origin' => '*', 'x-static-asset' => 'served-by-sinatra'}</tt>
    </dd>


  <dt>threaded</dt>
    <dd>
      If set to <tt>true</tt>, will tell server to use
      <code>EventMachine.defer</code> for processing the request.
    </dd>

  <dt>traps</dt>
    <dd>Whether Sinatra should handle system signals.</dd>

  <dt>views</dt>
    <dd>
      Path to the views folder. Inferred from <tt>app_file</tt> setting if
      not set.
    </dd>

  <dt>x_cascade</dt>
    <dd>
      Whether or not to set the X-Cascade header if no route matches.
      Defaults to <tt>true</tt>.
    </dd>
</dl>

<h2>Lifecycle Events</h2>

<p>There are 2 lifecycle events currently exposed by Sinatra. One when the server starts and one when it stops.</p>

<p>They can be used like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_on_start'><a href="Sinatra/Delegator.html#on_start-instance_method" title="Sinatra::Delegator#on_start (method)">on_start</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>===== Booting up =====</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_on_stop'><a href="Sinatra/Delegator.html#on_stop-instance_method" title="Sinatra::Delegator#on_stop (method)">on_stop</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>===== Shutting down =====</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>Note that these callbacks only work when using Sinatra to start the web server.</p>

<h2>Environments</h2>

<p>There are three predefined <code>environments</code>: <code>&quot;development&quot;</code>,
<code>&quot;production&quot;</code> and <code>&quot;test&quot;</code>. Environments can be set through the
<code>APP_ENV</code> environment variable. The default value is <code>&quot;development&quot;</code>.
In the <code>&quot;development&quot;</code> environment all templates are reloaded between
requests, and special <code>not_found</code> and <code>error</code> handlers display stack
traces in your browser. In the <code>&quot;production&quot;</code> and <code>&quot;test&quot;</code> environments,
templates are cached by default.</p>

<p>To run different environments, set the <code>APP_ENV</code> environment variable:</p>

<pre class="code shell"><code class="shell">APP_ENV=production ruby my_app.rb
</code></pre>

<p>You can use predefined methods: <code>development?</code>, <code>test?</code> and <code>production?</code> to
check the current environment setting:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_settings'><a href="Sinatra/Delegator.html#settings-instance_method" title="Sinatra::Delegator#settings (method)">settings</a></span>.<span class='id identifier rubyid_development?'>development?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>development!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not development!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h2>Error Handling</h2>

<p>Error handlers run within the same context as routes and before filters,
which means you get all the goodies it has to offer, like <code>haml</code>, <code>erb</code>,
<code>halt</code>, etc.</p>

<h3>Not Found</h3>

<p>When a <a href="Sinatra/NotFound.html" title="Sinatra::NotFound (class)"><code>::Sinatra::NotFound</code></a> exception is raised, or the response&#39;s status
code is 404, the <code>not_found</code> handler is invoked:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_not_found'><a href="Sinatra/Delegator.html#not_found-instance_method" title="Sinatra::Delegator#not_found (method)">not_found</a></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>This is nowhere to be found.</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<h3>Error</h3>

<p>The <code>error</code> handler is invoked any time an exception is raised from a route
block or a filter. But note in development it will only run if you set the
show exceptions option to <code>:after_handler</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_show_exceptions'>show_exceptions</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_handler'>after_handler</span></code></pre>

<p>A catch-all error handler can be defined with <code>error</code> and a block:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sorry there was a nasty error</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>The exception object can be obtained from the <code>sinatra.error</code> Rack variable:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sorry there was a nasty error - </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra.error</span><span class='tstring_end'>&#39;</span></span>].<span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span></code></pre>

<p>Pass an error class as an argument to create handlers for custom errors:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='const'>MyCustomError</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>So what happened was...</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra.error</span><span class='tstring_end'>&#39;</span></span>].<span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span></code></pre>

<p>Then, if this happens:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MyCustomError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>something bad</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>You get this:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>So</span> <span class='id identifier rubyid_what'>what</span> <span class='id identifier rubyid_happened'>happened</span> <span class='id identifier rubyid_was'>was</span><span class='op'>...</span> <span class='id identifier rubyid_something'>something</span> <span class='id identifier rubyid_bad'>bad</span></code></pre>

<p>Alternatively, you can install an error handler for a status code:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='int'>403</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Access forbidden</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/secret</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='int'>403</span>
<span class='kw'>end</span></code></pre>

<p>Or a range:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='int'>400</span><span class='op'>..</span><span class='int'>510</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Boom</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>Sinatra installs special <code>not_found</code> and <code>error</code> handlers when
running under the development environment to display nice stack traces
and additional debugging information in your browser.</p>

<h3>Behavior with <code>raise_errors</code> option</h3>

<p>When <code>raise_errors</code> option is <code>true</code>, errors that are unhandled are raised 
outside of the application. Additionally, any errors that would have been 
caught by the catch-all error handler are raised.</p>

<p>For example, consider the following configuration:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># First handler
</span><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='const'>MyCustomError</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>A custom message</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='comment'># Second handler
</span><span class='id identifier rubyid_error'><a href="Sinatra/Delegator.html#error-instance_method" title="Sinatra::Delegator#error (method)">error</a></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>A catch-all message</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>If <code>raise_errors</code> is <code>false</code>:</p>

<ul>
<li>When <code>MyCustomError</code> or descendant is raised, the first handler is invoked.
The HTTP response body will contain <code>&quot;A custom message&quot;</code>.</li>
<li>When any other error is raised, the second handler is invoked. The HTTP 
response body will contain <code>&quot;A catch-all message&quot;</code>.</li>
</ul>

<p>If <code>raise_errors</code> is <code>true</code>:</p>

<ul>
<li>When <code>MyCustomError</code> or descendant is raised, the behavior is identical to 
when <code>raise_errors</code> is <code>false</code>, described above.</li>
<li>When any other error is raised, the second handler is <em>not</em> invoked, and 
the error is raised outside of the application.

<ul>
<li>If the environment is <code>production</code>, the HTTP response body will contain 
a generic error message, e.g. <code>&quot;An unhandled lowlevel error occurred. The
application logs may have details.&quot;</code></li>
<li>If the environment is not <code>production</code>, the HTTP response body will contain
the verbose error backtrace.</li>
<li>Regardless of environment, if <code>show_exceptions</code> is set to <code>:after_handler</code>, 
the HTTP response body will contain the verbose error backtrace.</li>
</ul></li>
</ul>

<p>In the <code>test</code> environment, <code>raise_errors</code> is set to <code>true</code> by default. This 
means that in order to write a test for a catch-all error handler, 
<code>raise_errors</code> must temporarily be set to <code>false</code> for that particular test.</p>

<h2>Rack Middleware</h2>

<p>Sinatra rides on <a href="https://rack.github.io/">Rack</a>, a minimal standard
interface for Ruby web frameworks. One of Rack&#39;s most interesting
capabilities for application developers is support for &quot;middleware&quot; --
components that sit between the server and your application monitoring
and/or manipulating the HTTP request/response to provide various types
of common functionality.</p>

<p>Sinatra makes building Rack middleware pipelines a cinch via a top-level
<code>use</code> method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my_custom_middleware</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Lint</span>
<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'>MyCustomMiddleware</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/hello</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello World</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>The semantics of <code>use</code> are identical to those defined for the
<a href="https://www.rubydoc.info/github/rack/rack/main/Rack/Builder">Rack::Builder</a> DSL
(most frequently used from rackup files). For example, the <code>use</code> method
accepts multiple/variable args as well as blocks:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Auth</span><span class='op'>::</span><span class='const'>Basic</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='op'>|</span>
  <span class='id identifier rubyid_username'>username</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>Rack is distributed with a variety of standard middleware for logging,
debugging, URL routing, authentication, and session handling. Sinatra uses
many of these components automatically based on configuration so you
typically don&#39;t have to <code>use</code> them explicitly.</p>

<p>You can find useful middleware in
<a href="https://github.com/rack/rack/tree/main/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
or in the <a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>.</p>

<h2>Testing</h2>

<p>Sinatra tests can be written using any Rack-based testing library or
framework.
<a href="https://www.rubydoc.info/github/rack/rack-test/main/frames">Rack::Test</a>
is recommended:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my_sinatra_app</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>minitest/autorun</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack/test</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>MyAppTest</span> <span class='op'>&lt;</span> <span class='const'>Minitest</span><span class='op'>::</span><span class='const'>Test</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Test</span><span class='op'>::</span><span class='const'>Methods</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Application.html" title="Sinatra::Application (class)">Application</a></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_my_default'>test_my_default</span>
    <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello World!</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_with_params'>test_with_params</span>
    <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/meet</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Frank</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello Frank!</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_with_user_agent'>test_with_user_agent</span>
    <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> {}<span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_USER_AGENT</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Songbird</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re using Songbird!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Note: If you are using Sinatra in the modular style, replace
<a href="Sinatra/Application.html" title="Sinatra::Application (class)"><code>::Sinatra::Application</code></a> above with the class name of your app.</p>

<h2>Sinatra::Base - Middleware, Libraries, and Modular Apps</h2>

<p>Defining your app at the top-level works well for micro-apps but has
considerable drawbacks when building reusable components such as Rack
middleware, Rails metal, simple libraries with a server component, or even
Sinatra extensions. The top-level assumes a micro-app style configuration
(e.g., a single application file, <code>./public</code> and <code>./views</code>
directories, logging, exception detail page, etc.). That&#39;s where
<a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a> comes into play:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span><span class='comma'>,</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello world!</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The methods available to <a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a> subclasses are exactly the same
as those available via the top-level DSL. Most top-level apps can be
converted to <a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a> components with two modifications:</p>

<ul>
<li>Your file should require <code>sinatra/base</code> instead of <code>sinatra</code>;
otherwise, all of Sinatra&#39;s DSL methods are imported into the main
namespace.</li>
<li>Put your app&#39;s routes, error handlers, filters, and options in a subclass
of <a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a>.</li>
</ul>

<p><a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a> is a blank slate. Most options are disabled by default,
including the built-in server. See <a href="http://www.sinatrarb.com/configuration.html">Configuring
Settings</a> for details on
available options and their behavior. If you want behavior more similar
to when you define your app at the top level (also known as Classic
style), you can subclass <a href="Sinatra/Application.html" title="Sinatra::Application (class)"><code>::Sinatra::Application</code></a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Application.html" title="Sinatra::Application (class)">Application</a></span>
  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello world!</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h3>Modular vs. Classic Style</h3>

<p>Contrary to common belief, there is nothing wrong with the classic
style. If it suits your application, you do not have to switch to a
modular application.</p>

<p>The main disadvantage of using the classic style rather than the modular
style is that you will only have one Sinatra application per Ruby
process. If you plan to use more than one, switch to the modular style.
There is no reason you cannot mix the modular and classic styles.</p>

<p>If switching from one style to the other, you should be aware of
slightly different default settings:</p>

<table>
  <tr>
    <th>Setting</th>
    <th>Classic</th>
    <th>Modular</th>
    <th>Modular</th>
  </tr>

  <tr>
    <td>app_file</td>
    <td>file loading sinatra</td>
    <td>file subclassing Sinatra::Base</td>
    <td>file subclassing Sinatra::Application</td>
  </tr>

  <tr>
    <td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
    <td>false</td>
  </tr>

  <tr>
    <td>logging</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>method_override</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>inline_templates</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>static</td>
    <td>true</td>
    <td>File.exist?(public_folder)</td>
    <td>true</td>
  </tr>
</table>

<h3>Serving a Modular Application</h3>

<p>There are two common options for starting a modular app, actively
starting with <code>run!</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># my_app.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='comment'># ... app code here ...
</span>
  <span class='comment'># start the server if ruby file executed directly
</span>  <span class='id identifier rubyid_run!'>run!</span> <span class='kw'>if</span> <span class='id identifier rubyid_app_file'>app_file</span> <span class='op'>==</span> <span class='gvar'>$0</span>
<span class='kw'>end</span></code></pre>

<p>Start with:</p>

<pre class="code shell"><code class="shell">ruby my_app.rb
</code></pre>

<p>Or with a <code>config.ru</code> file, which allows using any Rack handler:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config.ru (run with rackup)
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>./my_app</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_run'>run</span> <span class='const'>MyApp</span></code></pre>

<p>Run:</p>

<pre class="code shell"><code class="shell">rackup -p 4567
</code></pre>

<h3>Using a Classic Style Application with a config.ru</h3>

<p>Write your app file:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello world!</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>And a corresponding <code>config.ru</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>./app</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_run'>run</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Application.html" title="Sinatra::Application (class)">Application</a></span></code></pre>

<h3>When to use a config.ru?</h3>

<p>A <code>config.ru</code> file is recommended if:</p>

<ul>
<li>You want to deploy with a different Rack handler (Passenger, Unicorn,
Heroku, ...).</li>
<li>You want to use more than one subclass of <a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a>.</li>
<li>You want to use Sinatra only for middleware, and not as an endpoint.</li>
</ul>

<p><strong>There is no need to switch to a <code>config.ru</code> simply because you
switched to the modular style, and you don&#39;t have to use the modular
style for running with a <code>config.ru</code>.</strong></p>

<h3>Using Sinatra as Middleware</h3>

<p>Not only is Sinatra able to use other Rack middleware, any Sinatra
application can, in turn, be added in front of any Rack endpoint as
middleware itself. This endpoint could be another Sinatra application,
or any other Rack-based application (Rails/Hanami/Roda/...):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>LoginScreen</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span>

  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/login</span><span class='tstring_end'>&#39;</span></span>) { <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_login'>login</span> }

  <span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/login</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_session'>session</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_name</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>]
    <span class='kw'>else</span>
      <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/login</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='comment'># middleware will run before filters
</span>  <span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'>LoginScreen</span>

  <span class='id identifier rubyid_before'><a href="Sinatra/Delegator.html#before-instance_method" title="Sinatra::Delegator#before (method)">before</a></span> <span class='kw'>do</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_name</span><span class='tstring_end'>&#39;</span></span>]
      <span class='id identifier rubyid_halt'>halt</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Access denied, please &lt;a href=&#39;/login&#39;&gt;login&lt;/a&gt;.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user_name</span><span class='tstring_end'>&#39;</span></span>]<span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> }
<span class='kw'>end</span></code></pre>

<h3>Dynamic Application Creation</h3>

<p>Sometimes you want to create new applications at runtime without having to
assign them to a constant. You can do this with <a href="Sinatra.html#new-class_method" title="Sinatra.new (method)">Sinatra.new</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_my_app'>my_app</span> <span class='op'>=</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span>.<span class='id identifier rubyid_new'><a href="Sinatra.html#new-class_method" title="Sinatra.new (method)">new</a></span> { <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hi</span><span class='tstring_end'>&quot;</span></span> } }
<span class='id identifier rubyid_my_app'>my_app</span>.<span class='id identifier rubyid_run!'>run!</span></code></pre>

<p>It takes the application to inherit from as an optional argument:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># config.ru (run with rackup)
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_controller'>controller</span> <span class='op'>=</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span>.<span class='id identifier rubyid_new'><a href="Sinatra.html#new-class_method" title="Sinatra.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_logging'>logging</span>
  <span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='const'>MyHelpers</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_map'>map</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/a</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span>
  <span class='id identifier rubyid_run'>run</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span>.<span class='id identifier rubyid_new'><a href="Sinatra.html#new-class_method" title="Sinatra.new (method)">new</a></span>(<span class='id identifier rubyid_controller'>controller</span>) { <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a</span><span class='tstring_end'>&#39;</span></span> } }
<span class='kw'>end</span>

<span class='id identifier rubyid_map'>map</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/b</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span>
  <span class='id identifier rubyid_run'>run</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span>.<span class='id identifier rubyid_new'><a href="Sinatra.html#new-class_method" title="Sinatra.new (method)">new</a></span>(<span class='id identifier rubyid_controller'>controller</span>) { <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>b</span><span class='tstring_end'>&#39;</span></span> } }
<span class='kw'>end</span></code></pre>

<p>This is especially useful for testing Sinatra extensions or using Sinatra in
your own library.</p>

<p>This also makes using Sinatra as middleware extremely easy:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>...</span> }
<span class='kw'>end</span>

<span class='id identifier rubyid_run'>run</span> <span class='const'>RailsProject</span><span class='op'>::</span><span class='const'>Application</span></code></pre>

<h2>Scopes and Binding</h2>

<p>The scope you are currently in determines what methods and variables are
available.</p>

<h3>Application/Class Scope</h3>

<p>Every Sinatra application corresponds to a subclass of <a href="Sinatra/Base.html" title="Sinatra::Base (class)"><code>::Sinatra::Base</code></a>.
If you are using the top-level DSL (<code>require &#39;sinatra&#39;</code>), then this
class is <a href="Sinatra/Application.html" title="Sinatra::Application (class)"><code>::Sinatra::Application</code></a>, otherwise it is the subclass you
created explicitly. At the class level, you have methods like <code>get</code> or
<code>before</code>, but you cannot access the <code>request</code> or <code>session</code> objects, as
there is only a single application class for all requests.</p>

<p>Options created via <code>set</code> are methods at class level:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='comment'># Hey, I&#39;m in the application scope!
</span>  <span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='int'>42</span>
  <span class='id identifier rubyid_foo'>foo</span> <span class='comment'># =&gt; 42
</span>
  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='comment'># Hey, I&#39;m no longer in the application scope!
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You have the application scope binding inside:</p>

<ul>
<li>Your application class body</li>
<li>Methods defined by extensions</li>
<li>The block passed to <code>helpers</code></li>
<li>Procs/blocks used as a value for <code>set</code></li>
<li>The block passed to <a href="Sinatra.html#new-class_method" title="Sinatra.new (method)">Sinatra.new</a></li>
</ul>

<p>You can reach the scope object (the class) like this:</p>

<ul>
<li>Via the object passed to configure blocks (<code>configure { |c| ... }</code>)</li>
<li><code>settings</code> from within the request scope</li>
</ul>

<h3>Request/Instance Scope</h3>

<p>For every incoming request, a new instance of your application class is
created, and all handler blocks run in that scope. From within this scope you
can access the <code>request</code> and <code>session</code> objects or call rendering methods like
<code>erb</code> or <code>haml</code>. You can access the application scope from within the request
scope via the <code>settings</code> helper:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>MyApp</span> <span class='op'>&lt;</span> <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Base.html" title="Sinatra::Base (class)">Base</a></span>
  <span class='comment'># Hey, I&#39;m in the application scope!
</span>  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/define_route/:name</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
    <span class='comment'># Request scope for &#39;/define_route/:name&#39;
</span>    <span class='ivar'>@value</span> <span class='op'>=</span> <span class='int'>42</span>

    <span class='id identifier rubyid_settings'><a href="Sinatra/Delegator.html#settings-instance_method" title="Sinatra::Delegator#settings (method)">settings</a></span>.<span class='id identifier rubyid_get'>get</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span>
      <span class='comment'># Request scope for &quot;/#{params[&#39;name&#39;]}&quot;
</span>      <span class='ivar'>@value</span> <span class='comment'># =&gt; nil (not the same request)
</span>    <span class='kw'>end</span>

    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Route defined!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>You have the request scope binding inside:</p>

<ul>
<li>get, head, post, put, delete, options, patch, link and unlink blocks</li>
<li>before and after filters</li>
<li>helper methods</li>
<li>templates/views</li>
</ul>

<h3>Delegation Scope</h3>

<p>The delegation scope just forwards methods to the class scope. However, it
does not behave exactly like the class scope, as you do not have the class
binding. Only methods explicitly marked for delegation are available, and you
do not share variables/state with the class scope (read: you have a different
<code>self</code>). You can explicitly add method delegations by calling
<code>Sinatra::Delegator.delegate :method_name</code>.</p>

<p>You have the delegate scope binding inside:</p>

<ul>
<li>The top-level binding, if you did <code>require &quot;sinatra&quot;</code></li>
<li>An object extended with the <a href="Sinatra/Delegator.html" title="Sinatra::Delegator (module)"><code>::Sinatra::Delegator</code></a> mixin</li>
</ul>

<p>Have a look at the code for yourself: here&#39;s the
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633">Sinatra::Delegator mixin</a>
being <a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">extending the main object</a>.</p>

<h2>Command Line</h2>

<p>Sinatra applications can be run directly:</p>

<pre class="code shell"><code class="shell">ruby myapp.rb [-h] [-x] [-q] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]
</code></pre>

<p>Options are:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span><span class='id identifier rubyid_h'>h</span> <span class='comment'># help
</span><span class='op'>-</span><span class='id identifier rubyid_p'>p</span> <span class='comment'># set the port (default is 4567)
</span><span class='op'>-</span><span class='id identifier rubyid_o'>o</span> <span class='comment'># set the host (default is 0.0.0.0)
</span><span class='op'>-</span><span class='id identifier rubyid_e'>e</span> <span class='comment'># set the environment (default is development)
</span><span class='op'>-</span><span class='id identifier rubyid_s'>s</span> <span class='comment'># specify rack server/handler (default is puma)
</span><span class='op'>-</span><span class='id identifier rubyid_q'>q</span> <span class='comment'># turn on quiet mode for server (default is off)
</span><span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='comment'># turn on the mutex lock (default is off)</span></code></pre>

<h3>Multi-threading</h3>

<p><em>Paraphrasing from
<a href="https://stackoverflow.com/a/6282999/5245129">this StackOverflow answer</a>
by Konstantin</em></p>

<p>Sinatra doesn&#39;t impose any concurrency model but leaves that to the
underlying Rack handler (server) like Puma or Falcon. Sinatra
itself is thread-safe, so there won&#39;t be any problem if the Rack handler
uses a threaded model of concurrency.</p>

<h2>Requirement</h2>

<p>The following Ruby versions are officially supported:</p>

<dl>
  <dt>Ruby</dt>
  <dd>
    <a href="https://www.ruby-lang.org/en/downloads/">The stable releases</a> are fully supported and recommended.
  </dd>

  <dt>TruffleRuby</dt>
  <dd>
    The latest stable release of TruffleRuby is supported.
  </dd>

  <dt>JRuby</dt>
  <dd>
    The latest stable release of JRuby is supported. It is not
    recommended to use C extensions with JRuby.
  </dd>
</dl>

<p>Versions of Ruby before 2.7.8 are no longer supported as of Sinatra 4.0.0.</p>

<p>Sinatra should work on any operating system supported by the chosen Ruby
implementation.</p>

<p>Running Sinatra on a not officially supported Ruby flavor means that if things only break there we assume it&#39;s not our issue but theirs.</p>

<h2>The Bleeding Edge</h2>

<p>If you would like to use Sinatra&#39;s latest bleeding-edge code, feel free
to run your application against the main branch, it should be rather
stable.</p>

<p>We also push out prerelease gems from time to time, so you can do a</p>

<pre class="code shell"><code class="shell">gem install sinatra --pre
</code></pre>

<p>to get some of the latest features.</p>

<h3>With Bundler</h3>

<p>If you want to run your application with the latest Sinatra, using
<a href="https://bundler.io">Bundler</a> is the recommended way.</p>

<p>First, install bundler, if you haven&#39;t:</p>

<pre class="code shell"><code class="shell">gem install bundler
</code></pre>

<p>Then, in your project directory, create a <code>Gemfile</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_source'>source</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://rubygems.org</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_github'>github</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra/sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># other dependencies
</span><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>haml</span><span class='tstring_end'>&#39;</span></span>                    <span class='comment'># for instance, if you use haml</span></code></pre>

<p>Note that you will have to list all your application&#39;s dependencies in
the <code>Gemfile</code>. Sinatra&#39;s direct dependencies (Rack and Tilt) will,
however, be automatically fetched and added by Bundler.</p>

<p>Now you can run your app like this:</p>

<pre class="code shell"><code class="shell">bundle exec ruby myapp.rb
</code></pre>

<h2>Versioning</h2>

<p>Sinatra follows <a href="https://semver.org/">Semantic Versioning</a>, both SemVer and
SemVerTag.</p>

<h2>Further Reading</h2>

<ul>
<li><a href="https://sinatrarb.com/">Project Website</a> - Additional documentation,
news, and links to other resources.</li>
<li><a href="https://sinatrarb.com/contributing">Contributing</a> - Find a bug? Need
help? Have a patch?</li>
<li><a href="https://github.com/sinatra/sinatra/issues">Issue tracker</a></li>
<li><a href="https://twitter.com/sinatra">Twitter</a></li>
<li><a href="https://groups.google.com/forum/#!forum/sinatrarb">Mailing List</a></li>
<li>IRC: <a href="irc://chat.freenode.net/#sinatra">#sinatra</a> on <a href="https://freenode.net">Freenode</a></li>
<li><a href="https://discord.gg/ncjsfsNHh7">Sinatra &amp; Friends</a> on Discord</li>
<li><a href="https://github.com/sinatra/sinatra-book">Sinatra Book</a> - Cookbook Tutorial</li>
<li><a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a> - Community contributed
recipes</li>
<li>API documentation for the <a href="https://www.rubydoc.info/gems/sinatra">latest release</a>
or the <a href="https://www.rubydoc.info/github/sinatra/sinatra">current HEAD</a> on
<a href="https://www.rubydoc.info/">RubyDoc</a></li>
<li><a href="https://github.com/sinatra/sinatra/actions">CI Actions</a></li>
</ul>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>