<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Faq &mdash; Sinatra main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "faq",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Sinatra main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Faq&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Frequently Asked Questions</h1>

<ul>
<li>this will become the toc
<code>:toc</code></li>
</ul>

<h2>How do I make my <a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> app reload on changes? <code>#reloading</code></h2>

<p>First off, in-process code reloading in Ruby is hard
and having a solution that works for every scenario is technically impossible.</p>

<p>Which is why we recommend you to do out-of-process reloading.</p>

<p>First you need to install <a href="https://github.com/alexch/rerun" target="_parent" title="rerun">rerun</a> if you haven&#39;t already:</p>

<pre class="code ruby"><code class="ruby">$ gem install rerun</code></pre>

<p>Now if you start your <a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> app like this:</p>

<pre class="code ruby"><code class="ruby">$ ruby app.rb</code></pre>

<p>All you have to do for reloading is instead do this:</p>

<pre class="code ruby"><code class="ruby">$ rerun &#39;ruby app.rb&#39;</code></pre>

<p>If you are for instance using <code>rackup</code>, instead do the following:</p>

<pre class="code ruby"><code class="ruby">$ rerun &#39;rackup&#39;</code></pre>

<p>You get the idea.</p>

<p>If you still want in-process reloading, check out <a href="/contrib/reloader">Sinatra::Reloader</a>.</p>

<h2>What are my deployment options? <code>#deploy</code></h2>

<p>See the <a href="https://github.com/sinatra/sinatra-book" target="_parent" title="book">book</a>.</p>

<h2>How do I use sessions? <code>#sessions</code></h2>

<p>Sessions are disabled by default. You need to enable them and then use the
<code>session</code> hash from routes and views:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_enable'><a href="Sinatra/Delegator.html#enable-instance_method" title="Sinatra::Delegator#enable (method)">enable</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_sessions'>sessions</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_session'>session</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_message'>message</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Hello World!</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_to'>to</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_session'>session</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_message'>message</span>]   <span class='comment'># =&gt; &#39;Hello World!&#39;
</span><span class='kw'>end</span></code></pre>

<p>See the <a href="http://www.sinatrarb.com/intro.html#Using%20Sessions" target="_parent" title="{Sinatra">{Sinatra</a> README}
on how to set additional parameters for sessions, like the session secret
or expiration date.</p>

<p>You can also use <a href="http://www.rubydoc.info/github/rack/rack/Rack/Session/Cookie" target="_parent" title="Rack::Session::Cookie">Rack::Session::Cookie</a> directly instead of <code>enable :sessions</code> (example from <em>Rack</em> documentation):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Session</span><span class='op'>::</span><span class='const'>Cookie</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.session</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                           <span class='symbeg'>:</span><span class='id identifier rubyid_domain'>domain</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo.com</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                           <span class='symbeg'>:</span><span class='id identifier rubyid_path'>path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                           <span class='symbeg'>:</span><span class='id identifier rubyid_expire_after'>expire_after</span> <span class='op'>=&gt;</span> <span class='int'>2592000</span><span class='comma'>,</span> <span class='comment'># In seconds
</span>                           <span class='symbeg'>:</span><span class='id identifier rubyid_secret'>secret</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>change_me</span><span class='tstring_end'>&#39;</span></span></code></pre>

<h2>How do I use session-based flash? <code>#flash</code></h2>

<p>Use <a href="https://github.com/treeder/rack-flash" target="_parent" title="Rack::Flash">Rack::Flash</a>.</p>

<h2>Can I run <a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> under Ruby 1.9? <code>#ruby19</code></h2>

<p>Yes. As of <a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> 0.9.2, <a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> is fully Ruby 1.9 and <a href="Rack.html" title="Rack (module)"><code>Rack</code></a> 1.0 compatible.
Since 1.1 you do not have to deal with encodings on your own, unless you want to.</p>

<h2>How do I get the &quot;route&quot; for the current page? <code>#path_info</code></h2>

<p>The <code>request</code> object probably has what you&#39;re looking for:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/hello-world</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path_info'>path_info</span>   <span class='comment'># =&gt; &#39;/hello-world&#39;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fullpath'>fullpath</span>    <span class='comment'># =&gt; &#39;/hello-world?foo=bar&#39;
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_url'>url</span>         <span class='comment'># =&gt; &#39;http://example.com/hello-world?foo=bar&#39;
</span><span class='kw'>end</span></code></pre>

<p>See <a href="http://www.rubydoc.info/gems/rack/Rack/Request" target="_parent" title="Rack::Request">Rack::Request</a>
for a detailed list of methods supported by the <code>request</code> object.</p>

<h2>How do I access helpers from within my views? <code>#helpview</code></h2>

<p>Call them! Views automatically have access to all helper methods. In fact,
<a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> evaluates routes, views, and helpers within the same exact object
context so they all have access to the same methods and instance variables.</p>

<p>In <code>hello.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_em'>em</span>(<span class='id identifier rubyid_text'>text</span>)
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;em&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_text'>text</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/em&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/hello</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@subject</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>World</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:</span><span class='id identifier rubyid_hello'>hello</span>
<span class='kw'>end</span></code></pre>

<p>In <code>views/hello.haml</code>:</p>

<pre class="code ruby"><code class="ruby">%p= &quot;Hello &quot; + em(@subject)</code></pre>

<h2>How do I render partials? <code>#partials</code></h2>

<p>Sinatra&#39;s template system is simple enough that it can be used for page and
fragment level rendering tasks. The <code>erb</code> and <code>haml</code> methods simply return a
string.</p>

<p>Since Sinatra 1.1, you can use the same calls for partials you use in the routes:</p>

<pre class="code xml"><code class="xml">&lt;%= erb :mypartial %&gt;
</code></pre>

<p>In versions prior to 1.1, you need to make sure you disable layout rendering as
follows:</p>

<pre class="code xml"><code class="xml">&lt;%= erb :mypartial, :layout =&gt; false %&gt;
</code></pre>

<h2>Can I have multiple URLs trigger the same route/handler? <code>#multiroute</code></h2>

<p>Sure:</p>

<pre class="code ruby"><code class="ruby">[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/baz</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
  <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='id identifier rubyid_path'>path</span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;ve reached me at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path_info'>path_info</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Seriously.</p>

<h2>How do I make the trailing slash optional? <code>#slash</code></h2>

<p>Put a question mark after it:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo/bar/?</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello World</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>The route matches <code>&quot;/foo/bar&quot;</code> and <code>&quot;/foo/bar/&quot;</code>.</p>

<h2>How do I render templates nested in subdirectories? <code>#subdir</code></h2>

<p><a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> apps do not typically have a very complex file hierarchy under
<code>views</code>. First, consider whether you really need subdirectories at all.
If so, you can use the <code>views/foo/bar.haml</code> file as a template with:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbeg'>:&#39;</span><span class='tstring_content'>foo/bar</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>This is basically the same as sending <code>#to_sym</code> to the filename and can also
be written as:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo/bar</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></code></pre>

<h2>I&#39;m running Thin and an error occurs but there&#39;s no output <code>#thindebug</code></h2>

<p>Try starting Thin with the <code>--debug</code> argument:</p>

<pre class="code ruby"><code class="ruby">thin --debug --rackup config.ru start</code></pre>

<p>That should give you an exception and backtrace on <code>stderr</code>.</p>

<h2>How do I send email from Sinatra? <code>#email</code></h2>

<p>How about a <a href="http://adam.herokuapp.com/past/2008/11/2/pony_the_express_way_to_send_email_from_ruby/" target="_parent" title="Pony">Pony</a>
(<code>sudo gem install pony</code>):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pony</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/signup</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='const'>Pony</span>.<span class='id identifier rubyid_mail'>mail</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to'>to</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>you@example.com</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
            <span class='symbeg'>:</span><span class='id identifier rubyid_from'>from</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>me@example.com</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
            <span class='symbeg'>:</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Howdy, Partna!</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></code></pre>

<p>You can even use templates to render the body. In <code>email.erb</code>:</p>

<pre class="code ruby"><code class="ruby">Good day &lt;%= params[:name] %&gt;,

Thanks for signing my guestbook. You&#39;re a doll.

Frank</code></pre>

<p>And in <code>mailerapp.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_post'><a href="Sinatra/Delegator.html#post-instance_method" title="Sinatra::Delegator#post (method)">post</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/guestbook/sign</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='const'>Pony</span>.<span class='id identifier rubyid_mail'>mail</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to'>to</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_email'>email</span>]<span class='comma'>,</span>
            <span class='symbeg'>:</span><span class='id identifier rubyid_from'>from</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>me@example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='symbeg'>:</span><span class='id identifier rubyid_subject'>subject</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thanks for signing my guestbook, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]<span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_erb'>erb</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_email'>email</span>)
<span class='kw'>end</span></code></pre>

<h2>How do I escape HTML? <code>#escape_html</code></h2>

<p>Use <a href="http://www.rubydoc.info/github/rack/rack/Rack/Utils" target="_parent" title="Rack::Utils">Rack::Utils</a>
in your helpers as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_h'>h</span>(<span class='id identifier rubyid_text'>text</span>)
    <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Utils</span>.<span class='id identifier rubyid_escape_html'>escape_html</span>(<span class='id identifier rubyid_text'>text</span>)
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_hattr'>hattr</span>(<span class='id identifier rubyid_text'>text</span>)
    <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Utils</span>.<span class='id identifier rubyid_escape_path'>escape_path</span>(<span class='id identifier rubyid_text'>text</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Now you can escape HTML entities inside outputted text in your templates in one of two ways:</p>

<pre class="code xml"><code class="xml">&lt;div&gt;&lt;%= h scary_output %&gt;&lt;/div&gt;
</code></pre>

<p>or using the <code>&lt;%==</code> feature:</p>

<pre class="code xml"><code class="xml">&lt;div&gt;&lt;%== scary_output %&gt;&lt;/div&gt;
</code></pre>

<p>And you can escape text inside element attributes in your templates like this:</p>

<pre class="code xml"><code class="xml">&lt;a href=&quot;&lt;%= hattr scary_output %&gt;&quot; &gt;A nice safe link!&lt;/a&gt;
</code></pre>

<p>Thanks to <a href="http://www.gittr.com/index.php/archive/using-rackutils-in-sinatra-escape_html-h-in-rails/" target="_parent" title="Chris Schneider">Chris Schneider</a>
for the tip!</p>

<h2>How do I automatically escape HTML? <code>#auto_escape_html</code></h2>

<p>Require <a href="https://rubygems.org/gems/erubis" target="_parent" title="Erubis">Erubis</a> or <a href="https://rubygems.org/gems/erubi" target="_parent" title="Erubi">Erubi</a> and set <code>escape_html</code> to <code>true</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>erubis</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># or &#39;erubi&#39;
</span><span class='id identifier rubyid_set'><a href="Sinatra/Delegator.html#set-instance_method" title="Sinatra::Delegator#set (method)">set</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_erb'>erb</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_escape_html'>escape_html</span> <span class='op'>=&gt;</span> <span class='kw'>true</span></code></pre>

<p>Then, any templates rendered with Erubis will be automatically escaped:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>Read more on the <a href="https://groups.google.com/forum/#!topic/tiltrb/PPm-sMz6Swc" target="_parent" title="Tilt Google Group">Tilt Google Group</a> for details.</p>

<h2>How do I use ActiveRecord migrations? <code>#ar-migrations</code></h2>

<p>From <a href="http://adam.herokuapp.com/past/2009/2/28/activerecord_migrations_outside_rails/" target="_parent" title="Adam Wiggins&amp;#39;s blog">Adam Wiggins&#39;s blog</a>:</p>

<blockquote>
<p>To use ActiveRecord’s migrations with <a href="Sinatra.html" title="Sinatra (module)"><code>Sinatra</code></a> (or other non-Rails project),
add the following to your Rakefile:</p>

<pre class="code ruby"><code class="ruby">namespace &lt;code&gt;:db&lt;/code&gt; do
  desc &quot;Migrate the database&quot;
  task(:migrate =&gt; &lt;code&gt;:environment&lt;/code&gt;) do
    ActiveRecord::Base.logger = Logger.new(STDOUT)
    ActiveRecord::Migration.verbose = true
    ActiveRecord::Migrator.migrate(&quot;db/migrate&quot;)
  end
end</code></pre>

<p>This assumes you have a task called <code>:environment</code> which loads your app’s
environment (requires the right files, sets up the database connection, etc).</p>

<p>Now you can create a directory called <code>db/migrate</code> and fill in your
migrations. I usually call the first one <code>001_init.rb</code>.
(I prefer the old sequential method for numbering migrations vs. the
datetime method used since Rails 2.1, but either will work.)</p>
</blockquote>

<p>For another option, check out the <a href="https://github.com/janko/sinatra-activerecord" target="_parent" title="{Sinatra">{Sinatra</a> ActiveRecord Extension}.</p>

<h2>How do I use HTTP authentication? <code>#auth</code></h2>

<p>You have at least two options for implementing basic access authentication (Basic HTTP Auth) in your application.</p>

<p>I. When you want to protect all requests in the application, simply put Rack::Auth::Basic middleware in the request processing chain by the <code>use</code> directive:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Auth</span><span class='op'>::</span><span class='const'>Basic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Restricted Area</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='op'>|</span>
  <span class='id identifier rubyid_username'>username</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re welcome</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/foo</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re also welcome</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>II. When you want to protect only certain URLs in the application, or want the authorization to be more complex, you may use something like this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_helpers'><a href="Sinatra/Delegator.html#helpers-instance_method" title="Sinatra::Delegator#helpers (method)">helpers</a></span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_protected!'>protected!</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_authorized?'>authorized?</span>
    <span class='id identifier rubyid_headers'>headers</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WWW-Authenticate</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Basic realm=&quot;Restricted Area&quot;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='int'>401</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not authorized\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_authorized?'>authorized?</span>
    <span class='ivar'>@auth</span> <span class='op'>||=</span>  <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Auth</span><span class='op'>::</span><span class='const'>Basic</span><span class='op'>::</span><span class='const'>Request</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_env'>env</span>)
    <span class='ivar'>@auth</span>.<span class='id identifier rubyid_provided?'>provided?</span> <span class='kw'>and</span> <span class='ivar'>@auth</span>.<span class='id identifier rubyid_basic?'>basic?</span> <span class='kw'>and</span> <span class='ivar'>@auth</span>.<span class='id identifier rubyid_credentials'>credentials</span> <span class='kw'>and</span> <span class='ivar'>@auth</span>.<span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>==</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Everybody can see this page</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_protected!'>protected!</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Welcome, authenticated client</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<h2>How do I test HTTP authentication? <code>#test_http_auth</code></h2>

<p>Assuming you have this simple implementation of HTTP authentication in your <code>application.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_use'><a href="Sinatra/Delegator.html#use-instance_method" title="Sinatra::Delegator#use (method)">use</a></span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Auth</span><span class='op'>::</span><span class='const'>Basic</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='op'>|</span>
  <span class='id identifier rubyid_username'>username</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re welcome</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>You can test it like this with <a href="https://github.com/brynary/rack-test" target="_parent" title="&lt;em&gt;Rack::Test&lt;/em&gt;"><em>Rack::Test</em></a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>APP_ENV</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test/unit</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack/test</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>ApplicationTest</span> <span class='op'>&lt;</span> <span class='const'>Test</span><span class='op'>::</span><span class='const'>Unit</span><span class='op'>::</span><span class='const'>TestCase</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><a href="Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'>Test</span><span class='op'>::</span><span class='const'>Methods</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='const'><a href="Sinatra.html" title="Sinatra (module)">Sinatra</a></span><span class='op'>::</span><span class='const'><a href="Sinatra/Application.html" title="Sinatra::Application (class)">Application</a></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_without_authentication'>test_without_authentication</span>
    <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>401</span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_status'>status</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_with_bad_credentials'>test_with_bad_credentials</span>
    <span class='id identifier rubyid_authorize'>authorize</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bad</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>boy</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>401</span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_status'>status</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_with_proper_credentials'>test_with_proper_credentials</span>
    <span class='id identifier rubyid_authorize'>authorize</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_get'><a href="Sinatra/Delegator.html#get-instance_method" title="Sinatra::Delegator#get (method)">get</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>200</span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_status'>status</span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You&#39;re welcome</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span>.<span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<!--

### <a id='queue' href='#queue'>How do I process jobs in the background?</a>
### <a id='auth' href='#auth'>How do I process file uploads?</a>

-->

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>