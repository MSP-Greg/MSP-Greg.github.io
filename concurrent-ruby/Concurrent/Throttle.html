<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Concurrent::Throttle &mdash; Concurrent RubyÂ master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Concurrent::Throttle",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Concurrent</a> &raquo; 
      <a href='../_index.html#alpha_T'>Index (T)</a> &raquo; 
        <a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Throttle&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Concurrent::Throttle</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Throttle/ProxyExecutor.html" title="Concurrent::Throttle::ProxyExecutor (class)"><code>ProxyExecutor</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Promises/FactoryMethods.html" title="Concurrent::Promises::FactoryMethods (module)"><code>Promises::FactoryMethods</code></a>,
          <a href="Promises/FactoryMethods/OldChannelIntegration.html" title="Concurrent::Promises::FactoryMethods::OldChannelIntegration (module)"><code>Promises::FactoryMethods::OldChannelIntegration</code></a>,
          <a href="Promises/FactoryMethods/Configuration.html" title="Concurrent::Promises::FactoryMethods::Configuration (module)"><code>Promises::FactoryMethods::Configuration</code></a>,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)">Concurrent::Synchronization::AbstractObject</a></li>
          <li class='next'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></li>
          <li class='next'>Concurrent::Throttle</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L23'>lib/concurrent-ruby-edge/concurrent/edge/throttle.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>**Edge Features** are under active development and may change frequently.</p>
<ul><li>
<p>Deprecations are not added before incompatible changes.</p>
</li><li>
<p><a href="Edge.html" title="Concurrent::Edge (module)"><code>Edge</code></a> version: <em>major</em> is always 0, <em>minor</em> bump means incompatible change, <em>patch</em> bump means compatible change.</p>
</li><li>
<p><a href="Edge.html" title="Concurrent::Edge (module)"><code>Edge</code></a> features may also lack tests and documentation.</p>
</li><li>
<p>Features developed in <code>concurrent-ruby-edge</code> are expected to move to <code>concurrent-ruby</code> when finalised.</p>
</li></ul>
</div>
  </div>


<p>A tool managing concurrency level of tasks. The maximum capacity is set in constructor. Each acquire will lower the available capacity and release will increase it. When there is no available capacity the current thread may either be blocked or an event is returned which will be resolved when capacity becomes available.</p>

<p>The more common usage of the <code>Throttle</code> is with a proxy executor <code>a_throttle.on(Concurrent.global_io_executor)</code>. Anything executed on the proxy executor will be throttled and execute on the given executor. There can be more than one proxy executors. All abstractions which execute tasks have option to specify executor, therefore the proxy executor can be injected to any abstraction throttling its concurrency level.</p>

<p>==== Examples</p>

<p><strong>Limiting concurrency level of a concurrently executed block to two</strong> </p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_max_two'>max_two</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Throttle</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Throttle.new (method)">new</a></span>} <span class='int'>2</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Throttle:0x000002 capacity available 2 of 2&gt;
</span>
<span class='op'>===</span> <span class='id identifier rubyid_used'>used</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_track'>track</span> <span class='id identifier rubyid_concurrency'>concurrency</span> <span class='id identifier rubyid_level'>level</span>
<span class='id identifier rubyid_concurrency_level'>concurrency_level</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::AtomicFixnum:0x000003 value:0&gt;
</span><span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span> <span class='kw'>do</span>
  <span class='comment'># increase the current level at the beginning of the throttled block    
</span>  <span class='id identifier rubyid_concurrency_level'>concurrency_level</span>.<span class='id identifier rubyid_increment'>increment</span>
  <span class='comment'># work, takes some time
</span>  <span class='id identifier rubyid_do_stuff'>do_stuff</span>
  <span class='comment'># read the current concurrency level 
</span>  <span class='id identifier rubyid_current_concurrency_level'>current_concurrency_level</span> <span class='op'>=</span> <span class='id identifier rubyid_concurrency_level'>concurrency_level</span>.<span class='id identifier rubyid_value'>value</span>
  <span class='comment'># decrement the concurrency level back at the end of the block            
</span>  <span class='id identifier rubyid_concurrency_level'>concurrency_level</span>.<span class='id identifier rubyid_decrement'>decrement</span>
  <span class='comment'># return the observed concurrency level 
</span>  <span class='id identifier rubyid_current_concurrency_level'>current_concurrency_level</span>
<span class='kw'>end</span> 

<span class='op'>===</span> <span class='id identifier rubyid_create'>create</span> <span class='int'>10</span> <span class='id identifier rubyid_threads'>threads</span> <span class='id identifier rubyid_running'>running</span> <span class='id identifier rubyid_concurrently'>concurrently</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_jobs'>jobs</span>
{<span class='const'><a href="Array.html" title="Concurrent::Array (class)">Array</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>}(<span class='int'>10</span>) <span class='kw'>do</span>  
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Throttle.new (method)">new</a></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_max_two'>max_two</span>.<span class='id identifier rubyid_acquire'><a href="#acquire-instance_method" title="Concurrent::Throttle#acquire (method)">acquire</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_job'>job</span>)   
  <span class='kw'>end</span>
<span class='op'>===</span> <span class='id identifier rubyid_wait'>wait</span> <span class='kw'>for</span> <span class='id identifier rubyid_all'>all</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_threads'>threads</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_finish'>finish</span> <span class='kw'>and</span> <span class='id identifier rubyid_read'>read</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_observed'>observed</span> 
<span class='op'>===</span> <span class='id identifier rubyid_concurrency'>concurrency</span> <span class='id identifier rubyid_level'>level</span> <span class='kw'>in</span> <span class='id identifier rubyid_each'>each</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_them'>them</span>   
<span class='kw'>end</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>)                         <span class='comment'># =&gt; [2, 2, 1, 1, 1, 2, 2, 2, 2, 1]</span></code></pre>

<p>Notice that the returned array has no number bigger than 2 therefore 
the concurrency level of the block with the <code>do_stuff</code> was never bigger than 2. </p>

<pre class="code ruby"><code class="ruby"><span class='op'>===</span> <span class='id identifier rubyid_runs'>runs</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_block'>block</span><span class='comma'>,</span> <span class='kw'>and</span> <span class='id identifier rubyid_returns'>returns</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_observed'>observed</span> <span class='id identifier rubyid_concurrency'>concurrency</span> <span class='id identifier rubyid_level'>level</span> <span class='id identifier rubyid_during'>during</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_execution'>execution</span>
<span class='kw'>def</span> <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level'>concurrency_level</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_concurrency_level'>concurrency_level</span>.<span class='id identifier rubyid_increment'>increment</span>
  <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_call'>call</span>
  <span class='id identifier rubyid_current_concurrency_level'>current_concurrency_level</span> <span class='op'>=</span> <span class='id identifier rubyid_concurrency_level'>concurrency_level</span>.<span class='id identifier rubyid_value'>value</span>
  <span class='id identifier rubyid_concurrency_level'>concurrency_level</span>.<span class='id identifier rubyid_decrement'>decrement</span>
  <span class='comment'># return the observed concurrency level
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_current_concurrency_level'>current_concurrency_level</span> 
<span class='kw'>end</span> 

<span class='id identifier rubyid_throttle'>throttle</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Throttle</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Throttle.new (method)">new</a></span>} <span class='int'>3</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Throttle:0x000004 capacity available 3 of 3&gt;
</span><span class='id identifier rubyid_concurrency_level'>concurrency_level</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>} 
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::AtomicFixnum:0x000005 value:0&gt;
</span>
{<span class='const'><a href="Array.html" title="Concurrent::Array (class)">Array</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>}(<span class='int'>10</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='comment'># create throttled future
</span>  <span class='id identifier rubyid_throttle'>throttle</span>.<span class='id identifier rubyid_future'>future</span>(<span class='id identifier rubyid_i'>i</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level'>concurrency_level</span>) { <span class='id identifier rubyid_do_stuff'>do_stuff</span> <span class='id identifier rubyid_arg'>arg</span> }  
    <span class='comment'># fulfill with the observed concurrency level
</span>  <span class='kw'>end</span>
<span class='op'>===</span> <span class='id identifier rubyid_collect'>collect</span> <span class='id identifier rubyid_observed'>observed</span> <span class='id identifier rubyid_concurrency'>concurrency</span> <span class='id identifier rubyid_levels'>levels</span>   
<span class='kw'>end</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value!'>value!</span>)                        <span class='comment'># =&gt; [3, 2, 1, 2, 1, 3, 3, 1, 2, 1]</span></code></pre>

<p>The concurrency level does not rise above 3.</p>

<p>It works by setting the executor of the future created from the throttle. 
The executor is a proxy executor for the <code>Concurrent::Promises.default_executor</code> 
which can be obtained using <a href="#on-instance_method" title="Concurrent::Throttle#on (method)">#on</a> method. 
Therefore the above example could be instead more explicitly written as follows</p>

<pre class="code ruby"><code class="ruby"><span class='op'>===</span> <span class='op'>...</span>
{<span class='const'><a href="Array.html" title="Concurrent::Array (class)">Array</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>}(<span class='int'>10</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='comment'># create throttled future
</span>  <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_future_on'><a href="Promises/FactoryMethods.html#future_on-instance_method" title="Concurrent::Promises::FactoryMethods#future_on (method)">future_on</a></span>(<span class='id identifier rubyid_throttle'>throttle</span>.<span class='id identifier rubyid_on'><a href="#on-instance_method" title="Concurrent::Throttle#on (method)">on</a></span>(<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_default_executor'><a href="Promises/FactoryMethods/Configuration.html#default_executor-instance_method" title="Concurrent::Promises::FactoryMethods::Configuration#default_executor (method)">default_executor</a></span>)) <span class='kw'>do</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value!'>value!</span>)</code></pre>

<p>Anything executed on the proxy executor is throttled. 
A throttle can have more proxy executors for different executors, 
all jobs share the same capacity provided by the throttle.</p>

<p>Since the proxy executor becomes the executor of the future, 
any chained futures will also be throttled. 
It can be changed by using different executor.
It the following example the first 2 futures in the chain are throttled, 
the last is not.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_concurrency_level_throttled'>concurrency_level_throttled</span>   <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>} 
<span class='id identifier rubyid_concurrency_level_unthrottled'>concurrency_level_unthrottled</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>} 
{<span class='const'><a href="Array.html" title="Concurrent::Array (class)">Array</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>}(<span class='int'>10</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='id identifier rubyid_throttle'>throttle</span>.<span class='id identifier rubyid_future'>future</span>(<span class='id identifier rubyid_i'>i</span>) <span class='kw'>do</span> 
    <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level_throttled'>concurrency_level_throttled</span>) { <span class='id identifier rubyid_do_stuff'>do_stuff</span> } 
  <span class='kw'>end</span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    [<span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level_throttled'>concurrency_level_throttled</span>) { <span class='id identifier rubyid_do_stuff'>do_stuff</span> }]
  <span class='kw'>end</span>.<span class='id identifier rubyid_then_on'>then_on</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_io'>io</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_l1'>l1</span><span class='comma'>,</span> <span class='id identifier rubyid_l2'>l2</span><span class='op'>|</span>
    [<span class='id identifier rubyid_l1'>l1</span><span class='comma'>,</span> <span class='id identifier rubyid_l2'>l2</span><span class='comma'>,</span> <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level_unthrottled'>concurrency_level_unthrottled</span>) { <span class='int'>5</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_do_stuff'>do_stuff</span> } }]
  <span class='kw'>end</span>
<span class='kw'>end</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value!'>value!</span>) 
<span class='op'>===</span> <span class='op'>=&gt;</span> [[<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>7</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>9</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>10</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>6</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>5</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>8</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>4</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span>]]</code></pre>

<p>In the output you can see that the first 2 columns do not cross the 3 capacity limit
and the last column which is untroubled does.</p>

<p>TODO (pitr-ch 20-Dec-2018): example with virtual throttled executor, 
throttling only part of promises chain.  </p>

<p><strong>Other abstraction</strong></p>

<p>The proxy executor created with throttle can be used with other abstractions as well 
and combined.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_concurrency_level'>concurrency_level</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>} 
<span class='id identifier rubyid_futures'>futures</span> <span class='op'>=</span> {<span class='const'><a href="Array.html" title="Concurrent::Array (class)">Array</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>}(<span class='int'>5</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='comment'># create throttled future
</span>  <span class='id identifier rubyid_throttle'>throttle</span>.<span class='id identifier rubyid_future'>future</span>(<span class='id identifier rubyid_i'>i</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level'>concurrency_level</span>) { <span class='id identifier rubyid_do_stuff'>do_stuff</span> <span class='id identifier rubyid_arg'>arg</span> }  
    <span class='comment'># fulfill with the observed concurrency level
</span>  <span class='kw'>end</span>
<span class='kw'>end</span> 
<span class='id identifier rubyid_agents'>agents</span> <span class='op'>=</span> {<span class='const'><a href="Array.html" title="Concurrent::Array (class)">Array</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>}(<span class='int'>5</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='id identifier rubyid_agent'>agent</span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Agent.html" title="Concurrent::Agent (class)">Agent</a></span>.<span class='id identifier rubyid_new'><a href="Agent.html#new-class_method" title="Concurrent::Agent.new (method)">new</a></span> <span class='int'>0</span>
  <span class='comment'># execute agent update on throttled executor
</span>  <span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_send_via'>send_via</span>(<span class='id identifier rubyid_throttle'>throttle</span>.<span class='id identifier rubyid_on'><a href="#on-instance_method" title="Concurrent::Throttle#on (method)">on</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_io'>io</span>)) { <span class='id identifier rubyid_monitor_concurrency_level'>monitor_concurrency_level</span>(<span class='id identifier rubyid_concurrency_level_throttled'>concurrency_level_throttled</span>) { <span class='id identifier rubyid_do_stuff'>do_stuff</span> } }
  <span class='id identifier rubyid_agent'>agent</span> 
<span class='kw'>end</span> 
<span class='id identifier rubyid_futures'>futures</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value!'>value!</span>)                    <span class='comment'># =&gt; [3, 3, 3, 2, 1]
</span><span class='id identifier rubyid_agents'>agents</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_await'>await</span> }.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>) 
<span class='op'>===</span> <span class='op'>=&gt;</span> [<span class='int'>3</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>1</span>]</code></pre>

<p>There is no observed concurrency level above 3.</p>

  </div>
</div>
<div class='tags'>
  
</div>
</div>
<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Synchronization/Object.html#safe_initialization%3F-class_method" title="Concurrent::Synchronization::Object.safe_initialization? (method)">.safe_initialization?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(capacity)  &#x21d2; Throttle </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create throttle.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#atomic_attribute%3F-class_method" title="Concurrent::Synchronization::Object.atomic_attribute? (method)">.atomic_attribute?</a>,
        <a class='i_m ' href="Synchronization/Object.html#atomic_attributes-class_method" title="Concurrent::Synchronization::Object.atomic_attributes (method)">.atomic_attributes</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_atomic-class_method" title="Concurrent::Synchronization::Object.attr_atomic (method)">.attr_atomic</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing to a instance variable with volatile (Java) semantic as <code>.attr_volatile</code> does.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_volatile-class_method" title="Concurrent::Synchronization::Object.attr_volatile (method)">.attr_volatile</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing (as <code>attr_accessor</code> does) to a instance variable with volatile (Java) semantic.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#ensure_safe_initialization_when_final_fields_are_present-class_method" title="Concurrent::Synchronization::Object.ensure_safe_initialization_when_final_fields_are_present (method)">.ensure_safe_initialization_when_final_fields_are_present</a></td>
      <td><div class='inline'><p>For testing purposes, quite slow.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#new-class_method" title="Concurrent::Synchronization::Object.new (method)">.new</a></td>
      <td><div class='inline'><p>Has to be called by children.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#safe_initialization!-class_method" title="Concurrent::Synchronization::Object.safe_initialization! (method)">.safe_initialization!</a>,
        <a class='i_m priv' href="Synchronization/Object.html#define_initialize_atomic_fields-class_method" title="Concurrent::Synchronization::Object.define_initialize_atomic_fields (method)">.define_initialize_atomic_fields</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/AbstractObject.html#attr_volatile-class_method" title="Concurrent::Synchronization::AbstractObject.attr_volatile (method)">.attr_volatile</a>,
        <a class='i_m ' href="Synchronization/AbstractObject.html#new-class_method" title="Concurrent::Synchronization::AbstractObject.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#acquire-instance_method" title="#acquire (instance method)">#<strong>acquire</strong>(timeout = nil) { ... } &#x21d2; Object, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks current thread until there is capacity available in the throttle.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#available_capacity-instance_method" title="#available_capacity (instance method)">#<strong>available_capacity</strong>  &#x21d2; Integer </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#default_executor-instance_method" title="#default_executor (instance method)">#<strong>default_executor</strong>  &#x21d2; ExecutorService </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Uses executor provided by <a href="#on-instance_method" title="Concurrent::Throttle#on (method)">#on</a> therefore all events and futures created using factory methods on this object will be throttled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#to_s-instance_method" title="Concurrent::Throttle#to_s (method)">#to_s</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#max_capacity-instance_method" title="#max_capacity (instance method)">#<strong>max_capacity</strong>  &#x21d2; Integer </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#on-instance_method" title="#on (instance method)">#<strong>on</strong>(executor = Promises::FactoryMethods.default_executor)  &#x21d2; ExecutorService </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#release-instance_method" title="#release (instance method)">#<strong>release</strong>  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Releases previously acquired capacity back to <code>Throttle</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
      (also: #inspect)
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#try_acquire-instance_method" title="#try_acquire (instance method)">#<strong>try_acquire</strong>  &#x21d2; true, false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tries to acquire capacity from the throttle.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#acquire_or_event-instance_method" title="#acquire_or_event (instance method)">#<strong>acquire_or_event</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="Promises/FactoryMethods.html" title="Concurrent::Promises::FactoryMethods (module)"><code>Promises::FactoryMethods</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any-instance_method" title="Concurrent::Promises::FactoryMethods#any (method)">#any</a></td>
      <td><div class='inline'><p>Alias for <a href="Promises/FactoryMethods.html#any_resolved_future-instance_method" title="Concurrent::Promises::FactoryMethods#any_resolved_future (method)">Promises::FactoryMethods#any_resolved_future</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any_event-instance_method" title="Concurrent::Promises::FactoryMethods#any_event (method)">#any_event</a></td>
      <td><div class='inline'><p>Shortcut of <code>#any_event_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any_event_on-instance_method" title="Concurrent::Promises::FactoryMethods#any_event_on (method)">#any_event_on</a></td>
      <td><div class='inline'><p>Creates a new event which becomes resolved after the first futures_and_or_events resolves.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any_fulfilled_future-instance_method" title="Concurrent::Promises::FactoryMethods#any_fulfilled_future (method)">#any_fulfilled_future</a></td>
      <td><div class='inline'><p>Shortcut of <code>#any_fulfilled_future_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any_fulfilled_future_on-instance_method" title="Concurrent::Promises::FactoryMethods#any_fulfilled_future_on (method)">#any_fulfilled_future_on</a></td>
      <td><div class='inline'><p>Creates a new future which is resolved after the first futures_and_or_events is fulfilled.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any_resolved_future-instance_method" title="Concurrent::Promises::FactoryMethods#any_resolved_future (method)">#any_resolved_future</a></td>
      <td><div class='inline'><p>Shortcut of <code>#any_resolved_future_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#any_resolved_future_on-instance_method" title="Concurrent::Promises::FactoryMethods#any_resolved_future_on (method)">#any_resolved_future_on</a></td>
      <td><div class='inline'><p>Creates a new future which is resolved after the first futures_and_or_events is resolved.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#delay-instance_method" title="Concurrent::Promises::FactoryMethods#delay (method)">#delay</a></td>
      <td><div class='inline'><p>Shortcut of <code>#delay_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#delay_on-instance_method" title="Concurrent::Promises::FactoryMethods#delay_on (method)">#delay_on</a></td>
      <td><div class='inline'><p>Creates a new event or future which is resolved only after it is touched, see <code>Concurrent::AbstractEventFuture#touch</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#fulfilled_future-instance_method" title="Concurrent::Promises::FactoryMethods#fulfilled_future (method)">#fulfilled_future</a></td>
      <td><div class='inline'><p>Creates a resolved future which will be fulfilled with the given value.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#future-instance_method" title="Concurrent::Promises::FactoryMethods#future (method)">#future</a></td>
      <td><div class='inline'><p>Shortcut of <code>#future_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#future_on-instance_method" title="Concurrent::Promises::FactoryMethods#future_on (method)">#future_on</a></td>
      <td><div class='inline'><p>Constructs a new <a href="Future.html" title="Concurrent::Future (class)"><code>Future</code></a> which will be resolved after block is evaluated on default executor.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#make_future-instance_method" title="Concurrent::Promises::FactoryMethods#make_future (method)">#make_future</a></td>
      <td><div class='inline'><p>General constructor.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#rejected_future-instance_method" title="Concurrent::Promises::FactoryMethods#rejected_future (method)">#rejected_future</a></td>
      <td><div class='inline'><p>Creates a resolved future which will be rejected with the given reason.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#resolvable_event-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_event (method)">#resolvable_event</a></td>
      <td><div class='inline'><p>Shortcut of <code>#resolvable_event_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#resolvable_event_on-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_event_on (method)">#resolvable_event_on</a></td>
      <td><div class='inline'><p>Creates a resolvable event, user is responsible for resolving the event once by calling <a href="Promises/ResolvableEvent.html#resolve-instance_method" title="Concurrent::Promises::ResolvableEvent#resolve (method)">Promises::ResolvableEvent#resolve</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#resolvable_future-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_future (method)">#resolvable_future</a></td>
      <td><div class='inline'><p>Shortcut of <code>#resolvable_future_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#resolvable_future_on-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_future_on (method)">#resolvable_future_on</a></td>
      <td><div class='inline'><p>Creates resolvable future, user is responsible for resolving the future once by <a href="Promises/ResolvableFuture.html#resolve-instance_method" title="Concurrent::Promises::ResolvableFuture#resolve (method)">Promises::ResolvableFuture#resolve</a>, <a href="Promises/ResolvableFuture.html#fulfill-instance_method" title="Concurrent::Promises::ResolvableFuture#fulfill (method)">Promises::ResolvableFuture#fulfill</a>, or <a href="Promises/ResolvableFuture.html#reject-instance_method" title="Concurrent::Promises::ResolvableFuture#reject (method)">Promises::ResolvableFuture#reject</a></p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#resolved_event-instance_method" title="Concurrent::Promises::FactoryMethods#resolved_event (method)">#resolved_event</a></td>
      <td><div class='inline'><p>Creates resolved event.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#resolved_future-instance_method" title="Concurrent::Promises::FactoryMethods#resolved_future (method)">#resolved_future</a></td>
      <td><div class='inline'><p>Creates a resolved future with will be either fulfilled with the given value or rejected with the given reason.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#schedule-instance_method" title="Concurrent::Promises::FactoryMethods#schedule (method)">#schedule</a></td>
      <td><div class='inline'><p>Shortcut of <code>#schedule_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#schedule_on-instance_method" title="Concurrent::Promises::FactoryMethods#schedule_on (method)">#schedule_on</a></td>
      <td><div class='inline'><p>Creates a new event or future which is resolved in intended_time.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip-instance_method" title="Concurrent::Promises::FactoryMethods#zip (method)">#zip</a></td>
      <td><div class='inline'><p>Alias for <a href="Promises/FactoryMethods.html#zip_futures-instance_method" title="Concurrent::Promises::FactoryMethods#zip_futures (method)">Promises::FactoryMethods#zip_futures</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip_events-instance_method" title="Concurrent::Promises::FactoryMethods#zip_events (method)">#zip_events</a></td>
      <td><div class='inline'><p>Shortcut of <code>#zip_events_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip_events_on-instance_method" title="Concurrent::Promises::FactoryMethods#zip_events_on (method)">#zip_events_on</a></td>
      <td><div class='inline'><p>Creates a new event which is resolved after all futures_and_or_events are resolved.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip_futures-instance_method" title="Concurrent::Promises::FactoryMethods#zip_futures (method)">#zip_futures</a></td>
      <td><div class='inline'><p>Shortcut of <code>#zip_futures_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip_futures_on-instance_method" title="Concurrent::Promises::FactoryMethods#zip_futures_on (method)">#zip_futures_on</a></td>
      <td><div class='inline'><p>Creates a new future which is resolved after all futures_and_or_events are resolved.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip_futures_over-instance_method" title="Concurrent::Promises::FactoryMethods#zip_futures_over (method)">#zip_futures_over</a></td>
      <td><div class='inline'><p>Shortcut of <code>#zip_futures_over_on</code> with default <code>:io</code> executor supplied.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Promises/FactoryMethods.html#zip_futures_over_on-instance_method" title="Concurrent::Promises::FactoryMethods#zip_futures_over_on (method)">#zip_futures_over_on</a></td>
      <td><div class='inline'><p>Creates new future which is resolved after all the futures created by future_factory from enumerable elements are resolved.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Promises/FactoryMethods/OldChannelIntegration.html" title="Concurrent::Promises::FactoryMethods::OldChannelIntegration (module)"><code>Promises::FactoryMethods::OldChannelIntegration</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="Promises/FactoryMethods/OldChannelIntegration.html#select-instance_method" title="Concurrent::Promises::FactoryMethods::OldChannelIntegration#select (method)">#select</a></td>
      <td><div class='inline'><p>only proof of concept.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Promises/FactoryMethods/Configuration.html" title="Concurrent::Promises::FactoryMethods::Configuration (module)"><code>Promises::FactoryMethods::Configuration</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Promises/FactoryMethods/Configuration.html#default_executor-instance_method" title="Concurrent::Promises::FactoryMethods::Configuration#default_executor (method)">#default_executor</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/Object.html#__initialize_atomic_fields__-instance_method" title="Concurrent::Synchronization::Object#__initialize_atomic_fields__ (method)">#__initialize_atomic_fields__</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Volatile.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::Volatile#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/AbstractObject.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::AbstractObject#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(capacity)  &#x21d2; <code>Throttle</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create throttle.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>capacity</span>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>How many tasks using this throttle can run at the same time.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L37-L43'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='37' data-end='43'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 37</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">initialize</a></span>(<span class='id identifier rubyid_capacity'>capacity</span>)
  <span class='kw'>super</span>()
  <span class='ivar'>@MaxCapacity</span>            <span class='op'>=</span> <span class='id identifier rubyid_capacity'>capacity</span>
  <span class='ivar'>@Queue</span>                  <span class='op'>=</span> <span class='const'><a href="LockFreeQueue.html" title="Concurrent::LockFreeQueue (class)">LockFreeQueue</a></span>.<span class='id identifier rubyid_new'><a href="LockFreeQueue.html#new-class_method" title="Concurrent::LockFreeQueue.new (method)">new</a></span>
  <span class='ivar'>@executor_cache</span>         <span class='op'>=</span> [<span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span>]
  <span class='kw'>self</span>.<span class='id identifier rubyid_capacity'>capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_capacity'>capacity</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="acquire-instance_method">
  <h3 class='signature  first'>
    #<strong>acquire</strong>(timeout = nil) { ... } &#x21d2; <a href="../Object.html" title="Object (class)">Object</a>, ... 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks current thread until there is capacity available in the throttle. The acquired capacity has to be returned to the throttle by calling <a href="#release-instance_method" title="Concurrent::Throttle#release (method)">#release</a>. If block is passed then the block is called after the capacity is acquired and it is automatically released after the block is executed.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Numeric</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>the maximum time in second to wait.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'></span>
    <div class='inline'><dl class="rdoc-list label-list"><dt></dt>
<dd>
<p>block to execute after the capacity is acquired</p>
</dd></dl>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>, <code>self</code>, <code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'><ul><li>
<p>When no timeout and no block it returns self</p>
</li><li>
<p>When no timeout and with block it returns the result of the block</p>
</li><li>
<p>When with timeout and no block it returns true when acquired and false when timed out</p>
</li><li>
<p>When with timeout and with block it returns the result of the block of nil on timing out</p>
</li></ul>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="#release-instance_method" title="Concurrent::Throttle#release (method)">#release</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L63-L95'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='63' data-end='95'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 63</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_acquire'>acquire</span>(<span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='id identifier rubyid_acquire_or_event'><a href="#acquire_or_event-instance_method" title="Concurrent::Throttle#acquire_or_event (method)">acquire_or_event</a></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_event'>event</span>
    <span class='id identifier rubyid_within_timeout'>within_timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span>.<span class='id identifier rubyid_wait'>wait</span>(<span class='id identifier rubyid_timeout'>timeout</span>)
    <span class='comment'># release immediately when acquired later after the timeout since it is unused
</span>    <span class='id identifier rubyid_event'>event</span>.<span class='id identifier rubyid_on_resolution!'>on_resolution!</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_release'><a href="#release-instance_method" title="Concurrent::Throttle#release (method)">release</a></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_within_timeout'>within_timeout</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_within_timeout'>within_timeout</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_called'>called</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_within_timeout'>within_timeout</span>
        <span class='id identifier rubyid_called'>called</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_call'>call</span>
      <span class='kw'>else</span>
        <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_within_timeout'>within_timeout</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
      <span class='id identifier rubyid_called'>called</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_call'>call</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_release'><a href="#release-instance_method" title="Concurrent::Throttle#release (method)">release</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_called'>called</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="acquire_or_event-instance_method">
  <h3 class='signature priv'>
    #<strong>acquire_or_event</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L140-L153'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='140' data-end='153'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 140</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_acquire_or_event'>acquire_or_event</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_capacity'>capacity</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_compare_and_set_capacity'>compare_and_set_capacity</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='kw'>return</span> <span class='kw'>nil</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_resolvable_event'><a href="Promises/FactoryMethods.html#resolvable_event-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_event (method)">resolvable_event</a></span>
        <span class='ivar'>@Queue</span>.<span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_event'>event</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_event'>event</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="available_capacity-instance_method">
  <h3 class='signature '>
    #<strong>available_capacity</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The available capacity.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L30-L33'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='30' data-end='33'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 30</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_available_capacity'>available_capacity</span>
  <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_capacity'>capacity</span>
  <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>&gt;=</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>:</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="default_executor-instance_method">
  <h3 class='signature '>
    #<strong>default_executor</strong>  &#x21d2; <a href="ExecutorService.html" title="Concurrent::ExecutorService (module)">ExecutorService</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Uses executor provided by <a href="#on-instance_method" title="Concurrent::Throttle#on (method)">#on</a> therefore all events and futures created using factory methods on this object will be throttled. Overrides <code>Promises::FactoryMethods#default_executor</code>.</p>

  </div>
</div>
<div class='tags'>
    <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><code>Promises::FactoryMethods#default_executor</code></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L183-L185'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='183' data-end='185'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 183</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_default_executor'>default_executor</span>
  <span class='id identifier rubyid_on'><a href="#on-instance_method" title="Concurrent::Throttle#on (method)">on</a></span>(<span class='kw'>super</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#to_s-instance_method" title="Concurrent::Throttle#to_s (method)">#to_s</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L137-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='137' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 137</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_inspect'>inspect</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to_s'><a href="#to_s-instance_method" title="Concurrent::Throttle#to_s (method)">to_s</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_capacity-instance_method">
  <h3 class='signature '>
    #<strong>max_capacity</strong>  &#x21d2; <code>Integer</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The maximum capacity.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L46-L48'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='46' data-end='48'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 46</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_max_capacity'>max_capacity</span>
  <span class='ivar'>@MaxCapacity</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="on-instance_method">
  <h3 class='signature '>
    #<strong>on</strong>(executor = Promises::FactoryMethods.default_executor)  &#x21d2; <a href="ExecutorService.html" title="Concurrent::ExecutorService (module)">ExecutorService</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
        <p class='example_title'><div class='inline'>
<p>throttling future</p>
</div></p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_a_future'>a_future</span>.<span class='id identifier rubyid_then_on'>then_on</span>(<span class='id identifier rubyid_a_throttle'>a_throttle</span>.<span class='id identifier rubyid_on'>on</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_io'>io</span>)) { <span class='id identifier rubyid_a_throttled_task'>a_throttled_task</span> }</code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>executor</span>
    <span class='type'>(<a href="ExecutorService.html" title="Concurrent::ExecutorService (module)">ExecutorService</a>)</span>
    <em class='default'>(defaults to: <tt>Promises::FactoryMethods.default_executor</tt>)</em>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="ExecutorService.html" title="Concurrent::ExecutorService (module)">ExecutorService</a>)</span>
&mdash;    <div class='inline'>
<p>An executor which wraps given executor and allows to post tasks only as available capacity in the throttle allows.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L162-L175'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='162' data-end='175'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 162</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_on'>on</span>(<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span> <span class='op'>=</span> <span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span><span class='op'>::</span><span class='const'><a href="Promises/FactoryMethods.html" title="Concurrent::Promises::FactoryMethods (module)">FactoryMethods</a></span>.<span class='id identifier rubyid_default_executor'><a href="Promises/FactoryMethods/Configuration.html#default_executor-instance_method" title="Concurrent::Promises::FactoryMethods::Configuration#default_executor (method)">default_executor</a></span>)
  <span class='id identifier rubyid_current_executor'>current_executor</span><span class='comma'>,</span> <span class='id identifier rubyid_current_cache'>current_cache</span> <span class='op'>=</span> <span class='ivar'>@executor_cache</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_current_cache'>current_cache</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_executor'>current_executor</span> <span class='op'>==</span> <span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_current_cache'>current_cache</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_current_executor'>current_executor</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='comment'># cache first proxy
</span>    <span class='id identifier rubyid_proxy_executor'>proxy_executor</span>  <span class='op'>=</span> <span class='const'><a href="Throttle/ProxyExecutor.html" title="Concurrent::Throttle::ProxyExecutor (class)">ProxyExecutor</a></span>.<span class='id identifier rubyid_new'><a href="Throttle/ProxyExecutor.html#new-class_method" title="Concurrent::Throttle::ProxyExecutor.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>(<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>))
    <span class='ivar'>@executor_cache</span> <span class='op'>=</span> [<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span><span class='comma'>,</span> <span class='id identifier rubyid_proxy_executor'>proxy_executor</span>]
    <span class='kw'>return</span> <span class='id identifier rubyid_proxy_executor'>proxy_executor</span>
  <span class='kw'>else</span>
    <span class='comment'># do not cache more than 1 executor
</span>    <span class='const'><a href="Throttle/ProxyExecutor.html" title="Concurrent::Throttle::ProxyExecutor (class)">ProxyExecutor</a></span>.<span class='id identifier rubyid_new'><a href="Throttle/ProxyExecutor.html#new-class_method" title="Concurrent::Throttle::ProxyExecutor.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>(<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>))
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="release-instance_method">
  <h3 class='signature '>
    #<strong>release</strong>  &#x21d2; <code>self</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Releases previously acquired capacity back to <code>Throttle</code>. Has to be called exactly once for each acquired capacity.</p>

  </div>
</div>
<div class='tags'>
    <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><code>{#acquire}, {#try_acquire}</code></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L118-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='118' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_release'>release</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_capacity'>capacity</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_compare_and_set_capacity'>compare_and_set_capacity</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>+</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>&lt;</span> <span class='int'>0</span>
        <span class='comment'># release called after trigger which pushed a trigger, busy wait is ok
</span>        <span class='const'>Thread</span>.<span class='id identifier rubyid_pass'>pass</span> <span class='kw'>until</span> (<span class='id identifier rubyid_trigger'>trigger</span> <span class='op'>=</span> <span class='ivar'>@Queue</span>.<span class='id identifier rubyid_pop'>pop</span>)
        <span class='id identifier rubyid_trigger'>trigger</span>.<span class='id identifier rubyid_resolve'>resolve</span>
      <span class='kw'>end</span>
      <span class='kw'>return</span> <span class='kw'>self</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    #<strong>to_s</strong>  &#x21d2; <code>String</code> 
    <span class='aliases'>Also known as: <span class='names'>#inspect</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>String</code>)</span>
&mdash;    <div class='inline'>
<p>Short string representation.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L133-L135'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='133' data-end='135'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 133</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_format'>format</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%s capacity available %d of %d&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>super</span>[<span class='int'>0</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_capacity'>capacity</span><span class='comma'>,</span> <span class='ivar'>@MaxCapacity</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="try_acquire-instance_method">
  <h3 class='signature '>
    #<strong>try_acquire</strong>  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tries to acquire capacity from the throttle. Returns true when there is capacity available. The acquired capacity has to be returned to the throttle by calling <a href="#release-instance_method" title="Concurrent::Throttle#release (method)">#release</a>.</p>

  </div>
</div>
<div class='tags'>
    <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="#release-instance_method" title="Concurrent::Throttle#release (method)">#release</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/throttle.rb#L102-L112'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='102' data-end='112'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/throttle.rb', line 102</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_try_acquire'>try_acquire</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_capacity'>capacity</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_compare_and_set_capacity'>compare_and_set_capacity</span>(
          <span class='id identifier rubyid_current_capacity'>current_capacity</span><span class='comma'>,</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>-</span> <span class='int'>1</span>)
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>