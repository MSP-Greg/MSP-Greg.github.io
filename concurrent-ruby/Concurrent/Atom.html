<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Concurrent::Atom &mdash; Concurrent Ruby master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Concurrent::Atom",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Concurrent</a> &raquo; 
      <a href='../_index.html#alpha_A'>Index (A)</a> &raquo; 
        <a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Atom&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Concurrent::Atom</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)"><code>Concern::Observable</code></a>,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)">Concurrent::Synchronization::AbstractObject</a></li>
          <li class='next'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></li>
          <li class='next'>Concurrent::Atom</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L95'>lib/concurrent-ruby/concurrent/atom.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Atoms provide a way to manage shared, synchronous, independent state.</p>

<p>An atom is initialized with an initial value and an optional validation proc. At any time the value of the atom can be synchronously and safely changed. If a validator is given at construction then any new value will be checked against the validator and will be rejected if the validator returns false or raises an exception.</p>

<p>There are two ways to change the value of an atom: <a href="#compare_and_set-instance_method" title="Concurrent::Atom#compare_and_set (method)">#compare_and_set</a> and <a href="#swap-instance_method" title="Concurrent::Atom#swap (method)">#swap</a>. The former will set the new value if and only if it validates and the current value matches the new value. The latter will atomically set the new value to the result of running the given block if and only if that value validates.</p>

<h4 id="label-Example">Example</h4>

<p>“‘ def next_fibonacci(set = nil)</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>return</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span>] <span class='kw'>if</span> <span class='id identifier rubyid_set'>set</span>.<span class='id identifier rubyid_nil?'>nil?</span>
<span class='id identifier rubyid_set'>set</span> <span class='op'>+</span> [<span class='id identifier rubyid_set'>set</span>[<span class='op'>-</span><span class='int'>2</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>].<span class='id identifier rubyid_reduce'>reduce</span>{<span class='op'>|</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_x'>x</span> }]</code></pre>

<p>end</p>

<h3 id="label-create+an+atom+with+an+initial+value">create an atom with an initial value</h3>

<p>atom = <code>Atom</code>.new(next_fibonacci)</p>

<h3 id="label-send+a+few+update+requests">send a few update requests</h3>

<p>5.times do</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_atom'>atom</span>.<span class='id identifier rubyid_swap'><a href="#swap-instance_method" title="Concurrent::Atom#swap (method)">swap</a></span>{<span class='op'>|</span><span class='id identifier rubyid_set'>set</span><span class='op'>|</span> <span class='id identifier rubyid_next_fibonacci'>next_fibonacci</span>(<span class='id identifier rubyid_set'>set</span>) }</code></pre>

<p>end</p>

<h3 id="label-get+the+current+value">get the current value</h3>

<p>atom.value #=&gt; [0, 1, 1, 2, 3, 5, 8] “‘</p>

<h4 id="label-Observation">Observation</h4>

<p>Atoms support observers through the <code>Concurrent::Observable</code> mixin module. Notification of observers occurs every time the value of the Atom changes. When notified the observer will receive three arguments: <code>time</code>, <code>old_value</code>, and <code>new_value</code>. The <code>time</code> argument is the time at which the value change occurred. The <code>old_value</code> is the value of the Atom when the change began The <code>new_value</code> is the value to which the Atom was set when the change completed. Note that <code>old_value</code> and <code>new_value</code> may be the same. This is not an error. It simply means that the change operation returned the same value.</p>

<p>Unlike in Clojure, <code>Atom</code> cannot participate in <a href="TVar.html" title="Concurrent::TVar (class)"><code>TVar</code></a> transactions.</p>

<p>## Thread-safe Variable Classes</p>

<p>Each of the thread-safe variable classes is designed to solve a different problem. In general:</p>
<ul><li>
<p>*<a href="Agent.html" title="Concurrent::Agent (class)"><code>Agent</code></a>:* Shared, mutable variable providing independent, uncoordinated, <strong>asynchronous</strong> change of individual values. Best used when the value will undergo frequent, complex updates. Suitable when the result of an update does not need to be known immediately.</p>
</li><li>
<p>*<code>Atom</code>:* Shared, mutable variable providing independent, uncoordinated, <strong>synchronous</strong> change of individual values. Best used when the value will undergo frequent reads but only occasional, though complex, updates. Suitable when the result of an update must be known immediately.</p>
</li><li>
<p>*<a href="AtomicReference.html" title="Concurrent::AtomicReference (class)"><code>AtomicReference</code></a>:* A simple object reference that can be updated atomically. Updates are synchronous but fast. Best used when updates a simple set operations. Not suitable when updates are complex. <a href="AtomicBoolean.html" title="Concurrent::AtomicBoolean (class)"><code>AtomicBoolean</code></a> and <a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)"><code>AtomicFixnum</code></a> are similar but optimized for the given data type.</p>
</li><li>
<p>*<a href="Exchanger.html" title="Concurrent::Exchanger (class)"><code>Exchanger</code></a>:* Shared, stateless synchronization point. Used when two or more threads need to exchange data. The threads will pair then block on each other until the exchange is complete.</p>
</li><li>
<p>*<a href="MVar.html" title="Concurrent::MVar (class)"><code>MVar</code></a>:* Shared synchronization point. Used when one thread must give a value to another, which must take the value. The threads will block on each other until the exchange is complete.</p>
</li><li>
<p>*<a href="ThreadLocalVar.html" title="Concurrent::ThreadLocalVar (class)"><code>ThreadLocalVar</code></a>:* Shared, mutable, isolated variable which holds a different value for each thread which has access. Often used as an instance variable in objects which must maintain different state for different threads.</p>
</li><li>
<p>*<a href="TVar.html" title="Concurrent::TVar (class)"><code>TVar</code></a>:* Shared, mutable variables which provide <strong>coordinated</strong>, <strong>synchronous</strong>, change of <strong>many</strong> stated. Used when multiple value must change together, in an all-or-nothing transaction.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
    <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="http://clojure.org/atoms" target="_parent" title="Clojure Atoms">Clojure Atoms</a></li>
          <li><a href="http://clojure.org/state" target="_parent" title="Values and Change - Clojure&#39;s approach to Identity and State">Values and Change - Clojure's approach to Identity and State</a></li>
      </ul>

</div>
</div>
<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Synchronization/Object.html#safe_initialization%3F-class_method" title="Concurrent::Synchronization::Object.safe_initialization? (method)">.safe_initialization?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(value, opts = {})  &#x21d2; Atom </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new atom with the given initial value.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#atomic_attribute%3F-class_method" title="Concurrent::Synchronization::Object.atomic_attribute? (method)">.atomic_attribute?</a>,
        <a class='i_m ' href="Synchronization/Object.html#atomic_attributes-class_method" title="Concurrent::Synchronization::Object.atomic_attributes (method)">.atomic_attributes</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_atomic-class_method" title="Concurrent::Synchronization::Object.attr_atomic (method)">.attr_atomic</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing to a instance variable with volatile (Java) semantic as <code>.attr_volatile</code> does.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_volatile-class_method" title="Concurrent::Synchronization::Object.attr_volatile (method)">.attr_volatile</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing (as <code>attr_accessor</code> does) to a instance variable with volatile (Java) semantic.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#ensure_safe_initialization_when_final_fields_are_present-class_method" title="Concurrent::Synchronization::Object.ensure_safe_initialization_when_final_fields_are_present (method)">.ensure_safe_initialization_when_final_fields_are_present</a></td>
      <td><div class='inline'><p>For testing purposes, quite slow.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#new-class_method" title="Concurrent::Synchronization::Object.new (method)">.new</a></td>
      <td><div class='inline'><p>Has to be called by children.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#safe_initialization!-class_method" title="Concurrent::Synchronization::Object.safe_initialization! (method)">.safe_initialization!</a>,
        <a class='i_m priv' href="Synchronization/Object.html#define_initialize_atomic_fields-class_method" title="Concurrent::Synchronization::Object.define_initialize_atomic_fields (method)">.define_initialize_atomic_fields</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/AbstractObject.html#attr_volatile-class_method" title="Concurrent::Synchronization::AbstractObject.attr_volatile (method)">.attr_volatile</a>,
        <a class='i_m ' href="Synchronization/AbstractObject.html#new-class_method" title="Concurrent::Synchronization::AbstractObject.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#compare_and_set-instance_method" title="#compare_and_set (instance method)">#<strong>compare_and_set</strong>(old_value, new_value)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Atomically sets the value of atom to the new value if and only if the current value of the atom is identical to the old value and the new value successfully validates against the (optional) validator given at construction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#deref-instance_method" title="#deref (instance method)">#<strong>deref</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset-instance_method" title="#reset (instance method)">#<strong>reset</strong>(new_value)  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Atomically sets the value of atom to the new value without regard for the current value so long as the new value successfully validates against the (optional) validator given at construction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#swap-instance_method" title="#swap (instance method)">#<strong>swap</strong>(*args) {|value, args| ... } &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Atomically swaps the value of atom using the given block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The current value of the atom.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid%3F-instance_method" title="#valid? (instance method)">#<strong>valid?</strong>(new_value)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Is the new value valid?</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)"><code>Concern::Observable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#add_observer-instance_method" title="Concurrent::Concern::Observable#add_observer (method)">#add_observer</a></td>
      <td><div class='inline'><p>Adds an observer to this set.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#count_observers-instance_method" title="Concurrent::Concern::Observable#count_observers (method)">#count_observers</a></td>
      <td><div class='inline'><p>Return the number of observers associated with this object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#delete_observer-instance_method" title="Concurrent::Concern::Observable#delete_observer (method)">#delete_observer</a></td>
      <td><div class='inline'><p>Remove <code>observer</code> as an observer on this object so that it will no longer receive notifications.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#delete_observers-instance_method" title="Concurrent::Concern::Observable#delete_observers (method)">#delete_observers</a></td>
      <td><div class='inline'><p>Remove all observers associated with this object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#with_observer-instance_method" title="Concurrent::Concern::Observable#with_observer (method)">#with_observer</a></td>
      <td><div class='inline'><p>As <code>#add_observer</code> but can be used for chaining.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/Object.html#__initialize_atomic_fields__-instance_method" title="Concurrent::Synchronization::Object#__initialize_atomic_fields__ (method)">#__initialize_atomic_fields__</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Volatile.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::Volatile#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/AbstractObject.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::AbstractObject#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(value, opts = {})  &#x21d2; <code>Atom</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new atom with the given initial value.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The initial value</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<a href="Hash.html" title="Concurrent::Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>The options used to configure the atom</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:validator</span>
          <span class='type'>(<code>Proc</code>)</span>
          <span class='default'> &mdash; default:
              <tt>nil</tt>          </span>
            &mdash; <div class='inline'>
<p>Optional proc used to validate new values. It must accept one and only one argument which will be the intended new value. The validator will return true if the new value is acceptable else return false (preferably) or raise an exception.</p>
</div>        </li>
        <li>
          <span class='name'>:dup_on_deref</span>
          <span class='type'>(<code>Boolean</code>)</span>
          <span class='default'> &mdash; default:
              <tt>false</tt>          </span>
            &mdash; <div class='inline'>
<p>Call <code>#dup</code> before returning the data from <a href="#value-instance_method" title="Concurrent::Atom#value (method)">#value</a></p>
</div>        </li>
        <li>
          <span class='name'>:freeze_on_deref</span>
          <span class='type'>(<code>Boolean</code>)</span>
          <span class='default'> &mdash; default:
              <tt>false</tt>          </span>
            &mdash; <div class='inline'>
<p>Call <code>#freeze</code> before returning the data from <a href="#value-instance_method" title="Concurrent::Atom#value (method)">#value</a></p>
</div>        </li>
        <li>
          <span class='name'>:copy_on_deref</span>
          <span class='type'>(<code>Proc</code>)</span>
          <span class='default'> &mdash; default:
              <tt>nil</tt>          </span>
            &mdash; <div class='inline'>
<p>When calling the <a href="#value-instance_method" title="Concurrent::Atom#value (method)">#value</a> method, call the given proc passing the internal value as the sole argument then return the new value returned from the proc.</p>
</div>        </li>
    </ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
&mdash;    <div class='inline'>
<p>if the validator is not a <code>Proc</code> (when given)</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L121-L126'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='121' data-end='126'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atom.rb', line 121</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">initialize</a></span>(<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='kw'>super</span>()
  <span class='ivar'>@Validator</span>     <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_validator'>validator</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='id identifier rubyid_v'>v</span> <span class='tlambeg'>{</span> <span class='kw'>true</span> })
  <span class='kw'>self</span>.<span class='id identifier rubyid_observers'>observers</span> <span class='op'>=</span> <span class='const'><a href="Collection.html" title="Concurrent::Collection (module)">Collection</a></span><span class='op'>::</span><span class='const'><a href="Collection/CopyOnNotifyObserverSet.html" title="Concurrent::Collection::CopyOnNotifyObserverSet (class)">CopyOnNotifyObserverSet</a></span>.<span class='id identifier rubyid_new'><a href="Collection/CopyOnNotifyObserverSet.html#new-class_method" title="Concurrent::Collection::CopyOnNotifyObserverSet.new (method)">new</a></span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span>     <span class='op'>=</span> <span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="compare_and_set-instance_method">
  <h3 class='signature  first'>
    #<strong>compare_and_set</strong>(old_value, new_value)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Atomically sets the value of atom to the new value if and only if the current value of the atom is identical to the old value and the new value successfully validates against the (optional) validator given at construction.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>old_value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The expected current value.</p>
</div>
  </li>
  <li>
    <span class='name'>new_value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The intended new value.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>True if the value is changed else false.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L181-L188'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='181' data-end='188'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atom.rb', line 181</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='id identifier rubyid_new_value'>new_value</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_valid?'><a href="#valid%3F-instance_method" title="Concurrent::Atom#valid? (method)">valid?</a></span>(<span class='id identifier rubyid_new_value'>new_value</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_compare_and_set_value'>compare_and_set_value</span>(<span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='id identifier rubyid_observers'>observers</span>.<span class='id identifier rubyid_notify_observers'>notify_observers</span>(<span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span><span class='comma'>,</span> <span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="deref-instance_method">
  <h3 class='signature '>
    #<strong>deref</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L102-L102'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='102' data-end='102'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atom.rb', line 102</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_deref'>deref</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset-instance_method">
  <h3 class='signature '>
    #<strong>reset</strong>(new_value)  &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Atomically sets the value of atom to the new value without regard for the current value so long as the new value successfully validates against the (optional) validator given at construction.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>new_value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The intended new value.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The final value of the atom after all operations and validations are complete.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L198-L207'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='198' data-end='207'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atom.rb', line 198</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reset'>reset</span>(<span class='id identifier rubyid_new_value'>new_value</span>)
  <span class='id identifier rubyid_old_value'>old_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_valid?'><a href="#valid%3F-instance_method" title="Concurrent::Atom#valid? (method)">valid?</a></span>(<span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='kw'>self</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span> <span class='op'>=</span> <span class='id identifier rubyid_new_value'>new_value</span>
    <span class='id identifier rubyid_observers'>observers</span>.<span class='id identifier rubyid_notify_observers'>notify_observers</span>(<span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span><span class='comma'>,</span> <span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='id identifier rubyid_new_value'>new_value</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_old_value'>old_value</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="swap-instance_method">
  <h3 class='signature '>
    #<strong>swap</strong>(*args) {|value, args| ... } &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>The given block may be called multiple times, and thus should be free of side effects.</p>
</div>
  </div>


<p>Atomically swaps the value of atom using the given block. The current value will be passed to the block, as will any arguments passed as arguments to the function. The new value will be validated against the (optional) validator proc given at construction. If validation fails the value will not be changed.</p>

<p>Internally, <code>#swap</code> reads the current value, applies the block to it, and attempts to compare-and-set it in. Since another thread may have changed the value in the intervening time, it may have to retry, and does so in a spin loop. The net effect is that the value will always be the result of the application of the supplied block to a current value, atomically. However, because the block might be called multiple times, it must be free of side effects.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>Zero or more arguments passed to the block.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a>, <code>args</code>)</span>
&mdash;    <div class='inline'>
<p>Calculates a new value for the atom based on the current value and any supplied arguments.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The current value of the atom.</p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>All arguments passed to the function, in order.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The intended new value of the atom.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The final value of the atom after all operations and validations are complete.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
&mdash;    <div class='inline'>
<p>When no block is given.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L157-L170'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='157' data-end='170'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atom.rb', line 157</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_swap'>swap</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Atom.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no block given</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_old_value'>old_value</span> <span class='op'>=</span> <span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Atom#value (method)">value</a></span>
    <span class='id identifier rubyid_new_value'>new_value</span> <span class='op'>=</span> <span class='kw'>yield</span>(<span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
    <span class='kw'>begin</span>
      <span class='kw'>break</span> <span class='id identifier rubyid_old_value'>old_value</span> <span class='kw'>unless</span> <span class='id identifier rubyid_valid?'><a href="#valid%3F-instance_method" title="Concurrent::Atom#valid? (method)">valid?</a></span>(<span class='id identifier rubyid_new_value'>new_value</span>)
      <span class='kw'>break</span> <span class='id identifier rubyid_new_value'>new_value</span> <span class='kw'>if</span> <span class='id identifier rubyid_compare_and_set'><a href="#compare_and_set-instance_method" title="Concurrent::Atom#compare_and_set (method)">compare_and_set</a></span>(<span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='kw'>rescue</span>
      <span class='kw'>break</span> <span class='id identifier rubyid_old_value'>old_value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid?-instance_method">
  <h3 class='signature priv'>
    #<strong>valid?</strong>(new_value)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Is the new value valid?</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>new_value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The intended new value.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>false if the validator function returns false or raises an exception else true</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L216-L220'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='216' data-end='220'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atom.rb', line 216</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid?'>valid?</span>(<span class='id identifier rubyid_new_value'>new_value</span>)
  <span class='ivar'>@Validator</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_new_value'>new_value</span>)
<span class='kw'>rescue</span>
  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="value-instance_method">
  <h3 class='signature '>
    #<strong>value</strong>  &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The current value of the atom.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>The current value.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atom.rb#L104-L104'>GitHub</a> ]</span>

</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>