<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Concurrent::ReadWriteLock &mdash; Concurrent Ruby master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Concurrent::ReadWriteLock",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Concurrent</a> &raquo; 
      <a href='../_index.html#alpha_R'>Index (R)</a> &raquo; 
        <a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ReadWriteLock&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Concurrent::ReadWriteLock</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)">Concurrent::Synchronization::AbstractObject</a></li>
          <li class='next'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></li>
          <li class='next'>Concurrent::ReadWriteLock</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L31'>lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>Do <strong>not</strong> try to acquire the write lock while already holding a read lock <strong>or</strong> try to acquire the write lock while you already have it. This will lead to deadlock</p>
</div>
  </div>


<p>Ruby read-write lock implementation</p>

<p>Allows any number of concurrent readers, but only one concurrent writer (And if the “write” lock is taken, any readers who come along will have to wait)</p>

<p>If readers are already active when a writer comes along, the writer will wait for all the readers to finish before going ahead. Any additional readers that come when the writer is already waiting, will also wait (so writers are not starved).</p>

<p>This implementation is based on <code>java.util.concurrent.ReentrantReadWriteLock</code>.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code "#{object.source_type}"'><code><span class='id identifier rubyid_lock'>lock</span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>ReadWriteLock</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::ReadWriteLock.new (method)">new</a></span>
<span class='id identifier rubyid_lock'>lock</span>.<span class='id identifier rubyid_with_read_lock'><a href="#with_read_lock-instance_method" title="Concurrent::ReadWriteLock#with_read_lock (method)">with_read_lock</a></span>  { <span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_retrieve'>retrieve</span> }
<span class='id identifier rubyid_lock'>lock</span>.<span class='id identifier rubyid_with_write_lock'><a href="#with_write_lock-instance_method" title="Concurrent::ReadWriteLock#with_write_lock (method)">with_write_lock</a></span> { <span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_modify!'>modify!</span> }</code></pre>
  </div>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html" target="_parent" title="java.util.concurrent.ReentrantReadWriteLock">java.util.concurrent.ReentrantReadWriteLock</a></li>
      </ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='MAX_READERS-constant' class='summary_signature priv'>MAX_READERS =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L40-L40'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 40</a>    <pre class='code ruby'><span class='const'><a href="#WAITING_WRITER-constant" title="Concurrent::ReadWriteLock::WAITING_WRITER (constant)">WAITING_WRITER</a></span> <span class='op'>-</span> <span class='int'>1</span></pre>
  </li>
  <li>
    <span id='MAX_WRITERS-constant' class='summary_signature priv'>MAX_WRITERS =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L43-L43'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 43</a>    <pre class='code ruby'><span class='const'><a href="#RUNNING_WRITER-constant" title="Concurrent::ReadWriteLock::RUNNING_WRITER (constant)">RUNNING_WRITER</a></span> <span class='op'>-</span> <span class='const'><a href="#MAX_READERS-constant" title="Concurrent::ReadWriteLock::MAX_READERS (constant)">MAX_READERS</a></span> <span class='op'>-</span> <span class='int'>1</span></pre>
  </li>
  <li>
    <span id='RUNNING_WRITER-constant' class='summary_signature priv'>RUNNING_WRITER =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L37-L37'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 37</a>    <pre class='code ruby'><span class='int'>1</span> <span class='op'>&lt;&lt;</span> <span class='int'>29</span></pre>
  </li>
  <li>
    <span id='WAITING_WRITER-constant' class='summary_signature priv'>WAITING_WRITER =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L34-L34'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 34</a>    <pre class='code ruby'><span class='int'>1</span> <span class='op'>&lt;&lt;</span> <span class='int'>15</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Synchronization/Object.html#safe_initialization%3F-class_method" title="Concurrent::Synchronization::Object.safe_initialization? (method)">.safe_initialization?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>  &#x21d2; ReadWriteLock </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new <code>ReadWriteLock</code> in the unlocked state.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#atomic_attribute%3F-class_method" title="Concurrent::Synchronization::Object.atomic_attribute? (method)">.atomic_attribute?</a>,
        <a class='i_m ' href="Synchronization/Object.html#atomic_attributes-class_method" title="Concurrent::Synchronization::Object.atomic_attributes (method)">.atomic_attributes</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_atomic-class_method" title="Concurrent::Synchronization::Object.attr_atomic (method)">.attr_atomic</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing to a instance variable with volatile (Java) semantic as <code>.attr_volatile</code> does.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_volatile-class_method" title="Concurrent::Synchronization::Object.attr_volatile (method)">.attr_volatile</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing (as <code>attr_accessor</code> does) to a instance variable with volatile (Java) semantic.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#ensure_safe_initialization_when_final_fields_are_present-class_method" title="Concurrent::Synchronization::Object.ensure_safe_initialization_when_final_fields_are_present (method)">.ensure_safe_initialization_when_final_fields_are_present</a></td>
      <td><div class='inline'><p>For testing purposes, quite slow.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#new-class_method" title="Concurrent::Synchronization::Object.new (method)">.new</a></td>
      <td><div class='inline'><p>Has to be called by children.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#safe_initialization!-class_method" title="Concurrent::Synchronization::Object.safe_initialization! (method)">.safe_initialization!</a>,
        <a class='i_m priv' href="Synchronization/Object.html#define_initialize_atomic_fields-class_method" title="Concurrent::Synchronization::Object.define_initialize_atomic_fields (method)">.define_initialize_atomic_fields</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/AbstractObject.html#attr_volatile-class_method" title="Concurrent::Synchronization::AbstractObject.attr_volatile (method)">.attr_volatile</a>,
        <a class='i_m ' href="Synchronization/AbstractObject.html#new-class_method" title="Concurrent::Synchronization::AbstractObject.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#has_waiters%3F-instance_method" title="#has_waiters? (instance method)">#<strong>has_waiters?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Queries whether any threads are waiting to acquire the read or write lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#write_locked%3F-instance_method" title="#write_locked? (instance method)">#<strong>write_locked?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Queries if the write lock is held by any thread.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#acquire_read_lock-instance_method" title="#acquire_read_lock (instance method)">#<strong>acquire_read_lock</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Acquire a read lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#acquire_write_lock-instance_method" title="#acquire_write_lock (instance method)">#<strong>acquire_write_lock</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Acquire a write lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#release_read_lock-instance_method" title="#release_read_lock (instance method)">#<strong>release_read_lock</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Release a previously acquired read lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#release_write_lock-instance_method" title="#release_write_lock (instance method)">#<strong>release_write_lock</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Release a previously acquired write lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_read_lock-instance_method" title="#with_read_lock (instance method)">#<strong>with_read_lock</strong> { ... } &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute a block operation within a read lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_write_lock-instance_method" title="#with_write_lock (instance method)">#<strong>with_write_lock</strong> { ... } &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute a block operation within a write lock.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#max_readers%3F-instance_method" title="#max_readers? (instance method)">#<strong>max_readers?</strong>(c = @Counter.value)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#max_writers%3F-instance_method" title="#max_writers? (instance method)">#<strong>max_writers?</strong>(c = @Counter.value)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#running_readers-instance_method" title="#running_readers (instance method)">#<strong>running_readers</strong>(c = @Counter.value)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#running_readers%3F-instance_method" title="#running_readers? (instance method)">#<strong>running_readers?</strong>(c = @Counter.value)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#running_writer%3F-instance_method" title="#running_writer? (instance method)">#<strong>running_writer?</strong>(c = @Counter.value)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#waiting_writer%3F-instance_method" title="#waiting_writer? (instance method)">#<strong>waiting_writer?</strong>(c = @Counter.value)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#waiting_writers-instance_method" title="#waiting_writers (instance method)">#<strong>waiting_writers</strong>(c = @Counter.value)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/Object.html#__initialize_atomic_fields__-instance_method" title="Concurrent::Synchronization::Object#__initialize_atomic_fields__ (method)">#__initialize_atomic_fields__</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Volatile.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::Volatile#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/AbstractObject.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::AbstractObject#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>  &#x21d2; <code>ReadWriteLock</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new <code>ReadWriteLock</code> in the unlocked state.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L59-L64'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='59' data-end='64'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 59</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">initialize</a></span>
  <span class='kw'>super</span>()
  <span class='ivar'>@Counter</span>   <span class='op'>=</span> <span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>(<span class='int'>0</span>) <span class='comment'># single integer which represents lock state
</span>  <span class='ivar'>@ReadLock</span>  <span class='op'>=</span> <span class='const'><a href="Synchronization.html" title="Concurrent::Synchronization (module)">Synchronization</a></span><span class='op'>::</span><span class='const'><a href="Synchronization/Lock.html" title="Concurrent::Synchronization::Lock (class)">Lock</a></span>.<span class='id identifier rubyid_new'><a href="Synchronization.html#initialize-instance_method" title="Concurrent::Synchronization#initialize (method)">new</a></span>
  <span class='ivar'>@WriteLock</span> <span class='op'>=</span> <span class='const'><a href="Synchronization.html" title="Concurrent::Synchronization (module)">Synchronization</a></span><span class='op'>::</span><span class='const'><a href="Synchronization/Lock.html" title="Concurrent::Synchronization::Lock (class)">Lock</a></span>.<span class='id identifier rubyid_new'><a href="Synchronization.html#initialize-instance_method" title="Concurrent::Synchronization#initialize (method)">new</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="has_waiters?-instance_method">
  <h3 class='signature ro first'>
    #<strong>has_waiters?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Queries whether any threads are waiting to acquire the read or write lock.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if any threads are waiting for a lock else false</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L214-L216'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='214' data-end='216'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 214</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_waiters?'>has_waiters?</span>
  <span class='id identifier rubyid_waiting_writer?'><a href="#waiting_writer%3F-instance_method" title="Concurrent::ReadWriteLock#waiting_writer? (method)">waiting_writer?</a></span>(<span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_locked?-instance_method">
  <h3 class='signature ro'>
    #<strong>write_locked?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Queries if the write lock is held by any thread.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the write lock is held else false`</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L207-L209'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='207' data-end='209'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 207</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_locked?'>write_locked?</span>
  <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;=</span> <span class='const'><a href="#RUNNING_WRITER-constant" title="Concurrent::ReadWriteLock::RUNNING_WRITER (constant)">RUNNING_WRITER</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="acquire_read_lock-instance_method">
  <h3 class='signature  first'>
    #<strong>acquire_read_lock</strong>  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Acquire a read lock. If a write lock has been acquired will block until it is released. Will not block if other read locks have been acquired.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the lock is successfully acquired</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Concurrent.html#ResourceLimitError-constant" title="Concurrent::ResourceLimitError (constant)">Concurrent::ResourceLimitError</a>)</span>
&mdash;    <div class='inline'>
<p>if the maximum number of readers is exceeded.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L111-L135'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='111' data-end='135'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_acquire_read_lock'>acquire_read_lock</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Concurrent.html#ResourceLimitError-constant" title="Concurrent::ResourceLimitError (constant)">ResourceLimitError</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Too many reader threads</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>if</span> <span class='id identifier rubyid_max_readers?'><a href="#max_readers%3F-instance_method" title="Concurrent::ReadWriteLock#max_readers? (method)">max_readers?</a></span>(<span class='id identifier rubyid_c'>c</span>)

    <span class='comment'># If a writer is waiting when we first queue up, we need to wait
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_waiting_writer?'><a href="#waiting_writer%3F-instance_method" title="Concurrent::ReadWriteLock#waiting_writer? (method)">waiting_writer?</a></span>(<span class='id identifier rubyid_c'>c</span>)
      <span class='ivar'>@ReadLock</span>.<span class='id identifier rubyid_wait_until'>wait_until</span> { <span class='op'>!</span><span class='id identifier rubyid_waiting_writer?'><a href="#waiting_writer%3F-instance_method" title="Concurrent::ReadWriteLock#waiting_writer? (method)">waiting_writer?</a></span> }

      <span class='comment'># after a reader has waited once, they are allowed to &quot;barge&quot; ahead of waiting writers
</span>      <span class='comment'># but if a writer is *running*, the reader still needs to wait (naturally)
</span>      <span class='kw'>while</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_running_writer?'><a href="#running_writer%3F-instance_method" title="Concurrent::ReadWriteLock#running_writer? (method)">running_writer?</a></span>(<span class='id identifier rubyid_c'>c</span>)
          <span class='ivar'>@ReadLock</span>.<span class='id identifier rubyid_wait_until'>wait_until</span> { <span class='op'>!</span><span class='id identifier rubyid_running_writer?'><a href="#running_writer%3F-instance_method" title="Concurrent::ReadWriteLock#running_writer? (method)">running_writer?</a></span> }
        <span class='kw'>else</span>
          <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span><span class='op'>+</span><span class='int'>1</span>)
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span><span class='op'>+</span><span class='int'>1</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="acquire_write_lock-instance_method">
  <h3 class='signature '>
    #<strong>acquire_write_lock</strong>  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Acquire a write lock. Will block and wait for all active readers and writers.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the lock is successfully acquired</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Concurrent.html#ResourceLimitError-constant" title="Concurrent::ResourceLimitError (constant)">Concurrent::ResourceLimitError</a>)</span>
&mdash;    <div class='inline'>
<p>if the maximum number of writers is exceeded.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L160-L191'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='160' data-end='191'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 160</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_acquire_write_lock'>acquire_write_lock</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Concurrent.html#ResourceLimitError-constant" title="Concurrent::ResourceLimitError (constant)">ResourceLimitError</a></span>.<span class='id identifier rubyid_new'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Too many writer threads</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>if</span> <span class='id identifier rubyid_max_writers?'><a href="#max_writers%3F-instance_method" title="Concurrent::ReadWriteLock#max_writers? (method)">max_writers?</a></span>(<span class='id identifier rubyid_c'>c</span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='int'>0</span> <span class='comment'># no readers OR writers running
</span>      <span class='comment'># if we successfully swap the RUNNING_WRITER bit on, then we can go ahead
</span>      <span class='kw'>break</span> <span class='kw'>if</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='const'><a href="#RUNNING_WRITER-constant" title="Concurrent::ReadWriteLock::RUNNING_WRITER (constant)">RUNNING_WRITER</a></span>)
    <span class='kw'>elsif</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span><span class='op'>+</span><span class='const'><a href="#WAITING_WRITER-constant" title="Concurrent::ReadWriteLock::WAITING_WRITER (constant)">WAITING_WRITER</a></span>)
      <span class='kw'>while</span> <span class='kw'>true</span>
        <span class='comment'># Now we have successfully incremented, so no more readers will be able to increment
</span>        <span class='comment'>#   (they will wait instead)
</span>        <span class='comment'># However, readers OR writers could decrement right here, OR another writer could increment
</span>        <span class='ivar'>@WriteLock</span>.<span class='id identifier rubyid_wait_until'>wait_until</span> <span class='kw'>do</span>
          <span class='comment'># So we have to do another check inside the synchronized section
</span>          <span class='comment'># If a writer OR reader is running, then go to sleep
</span>          <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>
          <span class='op'>!</span><span class='id identifier rubyid_running_writer?'><a href="#running_writer%3F-instance_method" title="Concurrent::ReadWriteLock#running_writer? (method)">running_writer?</a></span>(<span class='id identifier rubyid_c'>c</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_running_readers?'><a href="#running_readers%3F-instance_method" title="Concurrent::ReadWriteLock#running_readers? (method)">running_readers?</a></span>(<span class='id identifier rubyid_c'>c</span>)
        <span class='kw'>end</span>

        <span class='comment'># We just came out of a wait
</span>        <span class='comment'># If we successfully turn the RUNNING_WRITER bit on with an atomic swap,
</span>        <span class='comment'># Then we are OK to stop waiting and go ahead
</span>        <span class='comment'># Otherwise go back and wait again
</span>        <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>
        <span class='kw'>break</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_running_writer?'><a href="#running_writer%3F-instance_method" title="Concurrent::ReadWriteLock#running_writer? (method)">running_writer?</a></span>(<span class='id identifier rubyid_c'>c</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_running_readers?'><a href="#running_readers%3F-instance_method" title="Concurrent::ReadWriteLock#running_readers? (method)">running_readers?</a></span>(<span class='id identifier rubyid_c'>c</span>) <span class='op'>&amp;&amp;</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span><span class='op'>+</span><span class='const'><a href="#RUNNING_WRITER-constant" title="Concurrent::ReadWriteLock::RUNNING_WRITER (constant)">RUNNING_WRITER</a></span><span class='op'>-</span><span class='const'><a href="#WAITING_WRITER-constant" title="Concurrent::ReadWriteLock::WAITING_WRITER (constant)">WAITING_WRITER</a></span>)
      <span class='kw'>end</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_readers?-instance_method">
  <h3 class='signature priv'>
    #<strong>max_readers?</strong>(c = @Counter.value)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L246-L248'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='246' data-end='248'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 246</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_max_readers?'>max_readers?</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  (<span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;</span> <span class='const'><a href="#MAX_READERS-constant" title="Concurrent::ReadWriteLock::MAX_READERS (constant)">MAX_READERS</a></span>) <span class='op'>==</span> <span class='const'><a href="#MAX_READERS-constant" title="Concurrent::ReadWriteLock::MAX_READERS (constant)">MAX_READERS</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="max_writers?-instance_method">
  <h3 class='signature priv'>
    #<strong>max_writers?</strong>(c = @Counter.value)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L251-L253'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='251' data-end='253'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 251</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_max_writers?'>max_writers?</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  (<span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;</span> <span class='const'><a href="#MAX_WRITERS-constant" title="Concurrent::ReadWriteLock::MAX_WRITERS (constant)">MAX_WRITERS</a></span>) <span class='op'>==</span> <span class='const'><a href="#MAX_WRITERS-constant" title="Concurrent::ReadWriteLock::MAX_WRITERS (constant)">MAX_WRITERS</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="release_read_lock-instance_method">
  <h3 class='signature '>
    #<strong>release_read_lock</strong>  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Release a previously acquired read lock.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the lock is successfully released</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L140-L152'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='140' data-end='152'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 140</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_release_read_lock'>release_read_lock</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>
    <span class='kw'>if</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_compare_and_set'>compare_and_set</span>(<span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span><span class='op'>-</span><span class='int'>1</span>)
      <span class='comment'># If one or more writers were waiting, and we were the last reader, wake a writer up
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_waiting_writer?'><a href="#waiting_writer%3F-instance_method" title="Concurrent::ReadWriteLock#waiting_writer? (method)">waiting_writer?</a></span>(<span class='id identifier rubyid_c'>c</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_running_readers'><a href="#running_readers-instance_method" title="Concurrent::ReadWriteLock#running_readers (method)">running_readers</a></span>(<span class='id identifier rubyid_c'>c</span>) <span class='op'>==</span> <span class='int'>1</span>
        <span class='ivar'>@WriteLock</span>.<span class='id identifier rubyid_signal'>signal</span>
      <span class='kw'>end</span>
      <span class='kw'>break</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="release_write_lock-instance_method">
  <h3 class='signature '>
    #<strong>release_write_lock</strong>  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Release a previously acquired write lock.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the lock is successfully released</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L196-L202'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='196' data-end='202'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 196</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_release_write_lock'>release_write_lock</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_running_writer?'><a href="#running_writer%3F-instance_method" title="Concurrent::ReadWriteLock#running_writer? (method)">running_writer?</a></span>
  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_update'>update</span> { <span class='op'>|</span><span class='id identifier rubyid_counter'>counter</span><span class='op'>|</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>-</span> <span class='const'><a href="#RUNNING_WRITER-constant" title="Concurrent::ReadWriteLock::RUNNING_WRITER (constant)">RUNNING_WRITER</a></span> }
  <span class='ivar'>@ReadLock</span>.<span class='id identifier rubyid_broadcast'>broadcast</span>
  <span class='ivar'>@WriteLock</span>.<span class='id identifier rubyid_signal'>signal</span> <span class='kw'>if</span> <span class='id identifier rubyid_waiting_writers'><a href="#waiting_writers-instance_method" title="Concurrent::ReadWriteLock#waiting_writers (method)">waiting_writers</a></span>(<span class='id identifier rubyid_c'>c</span>) <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="running_readers-instance_method">
  <h3 class='signature priv'>
    #<strong>running_readers</strong>(c = @Counter.value)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L221-L223'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='221' data-end='223'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 221</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_running_readers'>running_readers</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;</span> <span class='const'><a href="#MAX_READERS-constant" title="Concurrent::ReadWriteLock::MAX_READERS (constant)">MAX_READERS</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="running_readers?-instance_method">
  <h3 class='signature priv'>
    #<strong>running_readers?</strong>(c = @Counter.value)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L226-L228'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='226' data-end='228'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 226</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_running_readers?'>running_readers?</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  (<span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;</span> <span class='const'><a href="#MAX_READERS-constant" title="Concurrent::ReadWriteLock::MAX_READERS (constant)">MAX_READERS</a></span>) <span class='op'>&gt;</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="running_writer?-instance_method">
  <h3 class='signature priv'>
    #<strong>running_writer?</strong>(c = @Counter.value)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L231-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='231' data-end='233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 231</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_running_writer?'>running_writer?</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_c'>c</span> <span class='op'>&gt;=</span> <span class='const'><a href="#RUNNING_WRITER-constant" title="Concurrent::ReadWriteLock::RUNNING_WRITER (constant)">RUNNING_WRITER</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="waiting_writer?-instance_method">
  <h3 class='signature priv'>
    #<strong>waiting_writer?</strong>(c = @Counter.value)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L241-L243'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='241' data-end='243'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 241</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_waiting_writer?'>waiting_writer?</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_c'>c</span> <span class='op'>&gt;=</span> <span class='const'><a href="#WAITING_WRITER-constant" title="Concurrent::ReadWriteLock::WAITING_WRITER (constant)">WAITING_WRITER</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="waiting_writers-instance_method">
  <h3 class='signature priv'>
    #<strong>waiting_writers</strong>(c = @Counter.value)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L236-L238'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='236' data-end='238'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 236</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_waiting_writers'>waiting_writers</span>(<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@Counter</span>.<span class='id identifier rubyid_value'>value</span>)
  (<span class='id identifier rubyid_c'>c</span> <span class='op'>&amp;</span> <span class='const'><a href="#MAX_WRITERS-constant" title="Concurrent::ReadWriteLock::MAX_WRITERS (constant)">MAX_WRITERS</a></span>) <span class='op'>/</span> <span class='const'><a href="#WAITING_WRITER-constant" title="Concurrent::ReadWriteLock::WAITING_WRITER (constant)">WAITING_WRITER</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_read_lock-instance_method">
  <h3 class='signature '>
    #<strong>with_read_lock</strong> { ... } &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute a block operation within a read lock.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'></span>
    <div class='inline'>
<p>the task to be performed within the lock.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the result of the block operation.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
&mdash;    <div class='inline'>
<p>when no block is given.</p>
</div>
  </li>
  <li>
    <span class='type'>(<a href="../Concurrent.html#ResourceLimitError-constant" title="Concurrent::ResourceLimitError (constant)">Concurrent::ResourceLimitError</a>)</span>
&mdash;    <div class='inline'>
<p>if the maximum number of readers is exceeded.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L75-L83'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='75' data-end='83'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 75</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_read_lock'>with_read_lock</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::ReadWriteLock.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no block given</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='id identifier rubyid_acquire_read_lock'><a href="#acquire_read_lock-instance_method" title="Concurrent::ReadWriteLock#acquire_read_lock (method)">acquire_read_lock</a></span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_release_read_lock'><a href="#release_read_lock-instance_method" title="Concurrent::ReadWriteLock#release_read_lock (method)">release_read_lock</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_write_lock-instance_method">
  <h3 class='signature '>
    #<strong>with_write_lock</strong> { ... } &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute a block operation within a write lock.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'></span>
    <div class='inline'>
<p>the task to be performed within the lock.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the result of the block operation.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
&mdash;    <div class='inline'>
<p>when no block is given.</p>
</div>
  </li>
  <li>
    <span class='type'>(<a href="../Concurrent.html#ResourceLimitError-constant" title="Concurrent::ResourceLimitError (constant)">Concurrent::ResourceLimitError</a>)</span>
&mdash;    <div class='inline'>
<p>if the maximum number of readers is exceeded.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb#L94-L102'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='94' data-end='102'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/atomic/read_write_lock.rb', line 94</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_write_lock'>with_write_lock</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::ReadWriteLock.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no block given</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='id identifier rubyid_acquire_write_lock'><a href="#acquire_write_lock-instance_method" title="Concurrent::ReadWriteLock#acquire_write_lock (method)">acquire_write_lock</a></span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_release_write_lock'><a href="#release_write_lock-instance_method" title="Concurrent::ReadWriteLock#release_write_lock (method)">release_write_lock</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>