<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Concurrent::Promises::Resolvable &mdash; Concurrent Ruby master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Concurrent::Promises::Resolvable",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Concurrent</a> &raquo; 
      <a href='../../_index.html#alpha_R'>Index (R)</a> &raquo; 
        <a href="../../Concurrent.html" title="Concurrent (module)">Concurrent</a> &raquo; 
        <a href="../Promises.html" title="Concurrent::Promises (module)">Promises</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Resolvable&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Concurrent::Promises::Resolvable</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="ResolvableEvent.html" title="Concurrent::Promises::ResolvableEvent (class)"><code>ResolvableEvent</code></a>,
          <a href="ResolvableFuture.html" title="Concurrent::Promises::ResolvableFuture (class)"><code>ResolvableFuture</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="InternalStates.html" title="Concurrent::Promises::InternalStates (module)"><code>InternalStates</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/promises.rb#L1299'>lib/concurrent-ruby/concurrent/promises.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/promises.rb#L96'>lib/concurrent-ruby-edge/concurrent/edge/promises.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Marker module of <a href="Future.html" title="Concurrent::Promises::Future (class)"><code>Future</code></a>, <a href="Event.html" title="Concurrent::Promises::Event (class)"><code>Event</code></a> resolved manually.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
  <h3 class='inherited'><a href="InternalStates.html" title="Concurrent::Promises::InternalStates (module)"><code>InternalStates</code></a> - Included</h3>
  <p  class='inherited'>
    <a class='priv ' href="InternalStates.html#PENDING-constant" title="Concurrent::Promises::InternalStates::PENDING (constant)">PENDING</a>, 
    <a class='priv ' href="InternalStates.html#RESERVED-constant" title="Concurrent::Promises::InternalStates::RESERVED (constant)">RESERVED</a>, 
    <a class='priv ' href="InternalStates.html#RESOLVED-constant" title="Concurrent::Promises::InternalStates::RESOLVED (constant)">RESOLVED</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#atomic_resolution-class_method" title=".atomic_resolution (class method)">.<strong>atomic_resolution</strong>(resolvable_map)  &#x21d2; true, false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Resolves all passed events and futures to the given resolutions if possible (all are unresolved) or none.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#locking_order_by-class_method" title=".locking_order_by (class method)">.<strong>locking_order_by</strong>(resolvable)  &#x21d2; Comparable </a>
    </span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#release-instance_method" title="#release (instance method)">#<strong>release</strong>  &#x21d2; true, false </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reserve-instance_method" title="#reserve (instance method)">#<strong>reserve</strong>  &#x21d2; true, false </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reserves the event or future, if reserved others are prevented from resolving it.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="atomic_resolution-class_method">
  <h3 class='signature  first'>
    .<strong>atomic_resolution</strong>(resolvable_map)  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Resolves all passed events and futures to the given resolutions if possible (all are unresolved) or none.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>resolvable_map</span>
    <span class='type'>(<a href="../Hash.html" title="Concurrent::Hash (class)">Hash</a>{<code>Resolvable</code>=&gt;<code>resolve_arguments</code>}, <a href="../Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Array.html" title="Concurrent::Array (class)">Array</a>(<code>Resolvable</code>, <code>resolve_arguments</code>)&gt;)</span>
&mdash;    <div class='inline'>
<p>collection of resolvable events and futures which should be resolved all at once and what should they be resolved to, examples: “‘ruby { a_resolvable_future1 =&gt; [true, :val, nil],</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a_resolvable_future2'>a_resolvable_future2</span> <span class='op'>=&gt;</span> [<span class='kw'>false</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_err'>err</span>]<span class='comma'>,</span>
<span class='id identifier rubyid_a_resolvable_event'>a_resolvable_event</span> <span class='op'>=&gt;</span> [] <span class='embexpr_end'>}</span></code></pre>

<p>“‘</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>or</span></code></pre>

<p>“‘ruby [[a_resolvable_future1, [true, :val, nil]],</p>

<pre class="code ruby"><code class="ruby">[<span class='id identifier rubyid_a_resolvable_future2'>a_resolvable_future2</span><span class='comma'>,</span> [<span class='kw'>false</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_err'>err</span>]]<span class='comma'>,</span>
[<span class='id identifier rubyid_a_resolvable_event'>a_resolvable_event</span><span class='comma'>,</span> []]]</code></pre>

<p>“‘</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>if success</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/promises.rb#L150-L169'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='150' data-end='169'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/promises.rb', line 150</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_atomic_resolution'>atomic_resolution</span>(<span class='id identifier rubyid_resolvable_map'>resolvable_map</span>)
  <span class='comment'># atomic_resolution event =&gt; [], future =&gt; [true, :v, nil]
</span>  <span class='id identifier rubyid_sorted'>sorted</span> <span class='op'>=</span> <span class='id identifier rubyid_resolvable_map'>resolvable_map</span>.<span class='id identifier rubyid_to_a'>to_a</span>.<span class='id identifier rubyid_sort_by'>sort_by</span> { <span class='op'>|</span><span class='id identifier rubyid_resolvable'>resolvable</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_locking_order_by'><a href="#locking_order_by-class_method" title="Concurrent::Promises::Resolvable.locking_order_by (method)">locking_order_by</a></span> <span class='id identifier rubyid_resolvable'>resolvable</span> }

  <span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_sorted'>sorted</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sorted'>sorted</span>[<span class='id identifier rubyid_reserved'>reserved</span>].<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_reserve'><a href="#reserve-instance_method" title="Concurrent::Promises::Resolvable#reserve (method)">reserve</a></span>
    <span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>==</span> <span class='id identifier rubyid_sorted'>sorted</span>.<span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_sorted'>sorted</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_resolvable'>resolvable</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_resolvable'>resolvable</span>.<span class='id identifier rubyid_resolve'>resolve</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='kw'>true</span>) }
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>-=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>has to be reserved</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_sorted'>sorted</span>[<span class='id identifier rubyid_reserved'>reserved</span>].<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_release'><a href="#release-instance_method" title="Concurrent::Promises::Resolvable#release (method)">release</a></span>
    <span class='kw'>end</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="locking_order_by-class_method">
  <h3 class='signature '>
    .<strong>locking_order_by</strong>(resolvable)  &#x21d2; <code>Comparable</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Comparable</code>)</span>
&mdash;    <div class='inline'>
<p>an item to sort the resolvable events or futures by to get the right global locking order of resolvable events or futures</p>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="#atomic_resolution-class_method" title="Concurrent::Promises::Resolvable.atomic_resolution (method)">.atomic_resolution</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/promises.rb#L128-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='128' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/promises.rb', line 128</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_locking_order_by'>locking_order_by</span>(<span class='id identifier rubyid_resolvable'>resolvable</span>)
  <span class='id identifier rubyid_resolvable'>resolvable</span>.<span class='id identifier rubyid_object_id'>object_id</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="release-instance_method">
  <h3 class='signature  first'>
    #<strong>release</strong>  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>on successful release of the reservation</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/promises.rb#L121-L123'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='121' data-end='123'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/promises.rb', line 121</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_release'>release</span>
  <span class='id identifier rubyid_compare_and_set_internal_state'>compare_and_set_internal_state</span>(<span class='const'><a href="InternalStates.html#RESERVED-constant" title="Concurrent::Promises::InternalStates::RESERVED (constant)">RESERVED</a></span><span class='comma'>,</span> <span class='const'><a href="InternalStates.html#PENDING-constant" title="Concurrent::Promises::InternalStates::PENDING (constant)">PENDING</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reserve-instance_method">
  <h3 class='signature '>
    #<strong>reserve</strong>  &#x21d2; <code>true</code>, <code>false</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reserves the event or future, if reserved others are prevented from resolving it. Advanced feature. Be careful about the order of reservation to avoid deadlocks, the method blocks if the future or event is already reserved until it is released or resolved.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'><a href="../../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="../Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_resolvable_future'><a href="FactoryMethods.html#resolvable_future-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_future (method)">resolvable_future</a></span>
<span class='id identifier rubyid_reserved'>reserved</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_reserve'>reserve</span>
<span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_resolve'>resolve</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='kw'>nil</span> } <span class='comment'># fails
</span><span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_resolve'>resolve</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_reserved'>reserved</span> <span class='comment'># must be called only if reserved</span></code></pre>
  </div>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>true</code>, <code>false</code>)</span>
&mdash;    <div class='inline'>
<p>on successful reservation</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/promises.rb#L111-L118'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='111' data-end='118'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/promises.rb', line 111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reserve'>reserve</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_compare_and_set_internal_state'>compare_and_set_internal_state</span>(<span class='const'><a href="InternalStates.html#PENDING-constant" title="Concurrent::Promises::InternalStates::PENDING (constant)">PENDING</a></span><span class='comma'>,</span> <span class='const'><a href="InternalStates.html#RESERVED-constant" title="Concurrent::Promises::InternalStates::RESERVED (constant)">RESERVED</a></span>)
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_resolved?'>resolved?</span>
    <span class='comment'># FIXME (pitr-ch 17-Jan-2019): sleep until given up or resolved instead of busy wait
</span>    <span class='const'>Thread</span>.<span class='id identifier rubyid_pass'>pass</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>