<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Concurrent::Cancellation &mdash; Concurrent RubyÂ master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Concurrent::Cancellation",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Concurrent</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Cancellation&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Concurrent::Cancellation</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a>,
          <a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a>,
          <a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)">Concurrent::Synchronization::AbstractObject</a></li>
          <li class='next'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)">Concurrent::Synchronization::Object</a></li>
          <li class='next'>Concurrent::Cancellation</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L36'>lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'>
<p>**Edge Features** are under active development and may change frequently.</p>
<ul><li>
<p>Deprecations are not added before incompatible changes.</p>
</li><li>
<p><a href="Edge.html" title="Concurrent::Edge (module)"><code>Edge</code></a> version: <em>major</em> is always 0, <em>minor</em> bump means incompatible change, <em>patch</em> bump means compatible change.</p>
</li><li>
<p><a href="Edge.html" title="Concurrent::Edge (module)"><code>Edge</code></a> features may also lack tests and documentation.</p>
</li><li>
<p>Features developed in <code>concurrent-ruby-edge</code> are expected to move to <code>concurrent-ruby</code> when finalised.</p>
</li></ul>
</div>
  </div>


<p>The Cancellation abstraction provides cooperative cancellation.</p>

<p>The standard methods <code>Thread#raise</code> of <code>Thread#kill</code> available in Ruby are very dangerous (see linked the blog posts bellow). Therefore concurrent-ruby provides an alternative.</p>
<ul><li>
<p>&lt;<a href="https://jvns.ca/blog/2015/11/27/why-rubys-timeout-is-dangerous-and-thread-dot-raise-is-terrifying">jvns.ca/blog/2015/11/27/why-rubys-timeout-is-dangerous-and-thread-dot-raise-is-terrifying</a>/&gt;</p>
</li><li>
<p>&lt;<a href="http://www.mikeperham.com/2015/05/08/timeout-rubys-most-dangerous-api">www.mikeperham.com/2015/05/08/timeout-rubys-most-dangerous-api</a>/&gt;</p>
</li><li>
<p>&lt;<a href="http://blog.headius.com/2008/02/rubys-threadraise-threadkill-timeoutrb.html">blog.headius.com/2008/02/rubys-threadraise-threadkill-timeoutrb.html</a>&gt;</p>
</li></ul>

<p>It provides an object which represents a task which can be executed, the task has to get the reference to the object and periodically cooperatively check that it is not cancelled. Good practices to make tasks cancellable:</p>
<ul><li>
<p>check cancellation every cycle of a loop which does significant work,</p>
</li><li>
<p>do all blocking actions in a loop with a timeout then on timeout check cancellation and if ok block again with the timeout</p>
</li></ul>

<p>The idea was inspired by &lt;<a href="https://msdn.microsoft.com/en-us/library/dd537607(v=vs.110).aspx">msdn.microsoft.com/en-us/library/dd537607(v=vs.110).aspx</a>&gt; ==== Examples</p>

<p><strong>Run async task until cancelled</strong></p>

<p>Create cancellation and then run work in a background thread until it is cancelled. </p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000002 pending&gt;
</span><span class='op'>===</span> <span class='op'>-</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_used'>used</span> <span class='kw'>for</span> <span class='id identifier rubyid_cancelling'>cancelling</span><span class='comma'>,</span> <span class='id identifier rubyid_resolve'>resolve</span> <span class='id identifier rubyid_it'>it</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_cancel'>cancel</span> 
<span class='op'>===</span> <span class='op'>-</span> <span class='id identifier rubyid_cancellation'>cancellation</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_passed'>passed</span> <span class='id identifier rubyid_down'>down</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_tasks'>tasks</span> <span class='kw'>for</span> <span class='id identifier rubyid_cooperative'>cooperative</span> <span class='id identifier rubyid_cancellation'>cancellation</span>
<span class='id identifier rubyid_async_task'>async_task</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>}.<span class='id identifier rubyid_future'>future</span>(<span class='id identifier rubyid_cancellation'>cancellation</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cancellation'>cancellation</span><span class='op'>|</span>
  <span class='comment'># Do work repeatedly until it is cancelled
</span>  <span class='id identifier rubyid_do_stuff'>do_stuff</span> <span class='kw'>until</span> <span class='id identifier rubyid_cancellation'>cancellation</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_stopped_gracefully'>stopped_gracefully</span>
<span class='kw'>end</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::Future:0x000003 pending&gt;
</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.01</span>                               <span class='comment'># =&gt; 0
</span><span class='op'>===</span> <span class='const'>Wait</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_bit'>bit</span> <span class='kw'>then</span> <span class='id identifier rubyid_stop'>stop</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_thread'>thread</span> <span class='id identifier rubyid_by'>by</span> <span class='id identifier rubyid_resolving'>resolving</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_cancellation'>cancellation</span>
<span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>.<span class='id identifier rubyid_resolve'>resolve</span> 
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::ResolvableEvent:0x000004 resolved&gt;
</span><span class='id identifier rubyid_async_task'>async_task</span>.<span class='id identifier rubyid_value!'>value!</span>                        <span class='comment'># =&gt; :stopped_gracefully</span></code></pre>

<p>Or let it raise an error.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000005 pending&gt;
</span><span class='id identifier rubyid_async_task'>async_task</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>}.<span class='id identifier rubyid_future'>future</span>(<span class='id identifier rubyid_cancellation'>cancellation</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cancellation'>cancellation</span><span class='op'>|</span>
  <span class='comment'># Do work repeatedly until it is cancelled
</span>  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_cancellation'>cancellation</span>.<span class='id identifier rubyid_check!'><a href="#check!-instance_method" title="Concurrent::Cancellation#check! (method)">check!</a></span>     
    <span class='id identifier rubyid_do_stuff'>do_stuff</span> 
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::Future:0x000006 pending&gt;
</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.01</span>                               <span class='comment'># =&gt; 0
</span><span class='op'>===</span> <span class='const'>Wait</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_bit'>bit</span> <span class='kw'>then</span> <span class='id identifier rubyid_stop'>stop</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_thread'>thread</span> <span class='id identifier rubyid_by'>by</span> <span class='id identifier rubyid_resolving'>resolving</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_cancellation'>cancellation</span>
<span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>.<span class='id identifier rubyid_resolve'>resolve</span> 
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::ResolvableEvent:0x000007 resolved&gt;
</span><span class='id identifier rubyid_async_task'>async_task</span>.<span class='id identifier rubyid_result'>result</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> [<span class='kw'>false</span><span class='comma'>,</span>
<span class='op'>===</span>     <span class='kw'>nil</span><span class='comma'>,</span>
<span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::CancelledOperationError: Concurrent::CancelledOperationError&gt;]</span></code></pre>

<p><strong>Run additional tasks on Cancellation</strong> </p>

<p>Cancellation can also be used to log or plan re-execution.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation'>cancellation</span>.<span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>.<span class='id identifier rubyid_chain'>chain</span> <span class='kw'>do</span>
  <span class='comment'># This block is executed after the Cancellation is cancelled  
</span>  <span class='comment'># It can then log cancellation or e.g. plan new re-execution
</span><span class='kw'>end</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::Future:0x000008 pending&gt;</span></code></pre>

<p><strong>Run only for limited time â Timeout replacement</strong></p>

<p>Execute task for a given time then finish. 
Instead of letting Cancellation crate its own origin, it can be passed in as argument.
The passed in origin is scheduled to be resolved in given time which then cancels the Cancellation.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>} {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_schedule'><a href="Promises/FactoryMethods.html#schedule-instance_method" title="Concurrent::Promises::FactoryMethods#schedule (method)">schedule</a></span>}(<span class='float'>0.02</span>)
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000009 pending&gt;
</span><span class='op'>===</span> <span class='kw'>or</span> <span class='id identifier rubyid_using'>using</span> <span class='id identifier rubyid_shortcut'>shortcut</span> <span class='id identifier rubyid_helper'>helper</span> <span class='id identifier rubyid_method'>method</span>
<span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span>} <span class='float'>0.02</span> 
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x00000a pending&gt;
</span><span class='id identifier rubyid_count'>count</span>   <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)">AtomicFixnum</a></span>.<span class='id identifier rubyid_new'><a href="AtomicFixnum.html#new-class_method" title="Concurrent::AtomicFixnum.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::AtomicFixnum:0x00000b value:0&gt;
</span>{<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_global_io_executor'><a href="../Concurrent.html#global_io_executor-class_method" title="Concurrent.global_io_executor (method)">global_io_executor</a></span>}.<span class='id identifier rubyid_post'>post</span>(<span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span><span class='op'>|</span>
  <span class='comment'># do stuff until cancelled  
</span>  <span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_increment'>increment</span> <span class='kw'>until</span> <span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>
<span class='kw'>end</span> 

<span class='id identifier rubyid_timeout'><a href="#timeout-class_method" title="Concurrent::Cancellation.timeout (method)">timeout</a></span>.<span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>.<span class='id identifier rubyid_wait'>wait</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::Event:0x00000c resolved&gt;
</span><span class='id identifier rubyid_count'>count</span>.<span class='id identifier rubyid_value'>value</span>                              <span class='comment'># =&gt; 177576</span></code></pre>

<p><strong>Parallel background processing with single cancellation</strong></p>

<p>Each task tries to count to 1000 but there is a randomly failing test. The
tasks share single cancellation, when one of them fails it cancels the others.
The failing tasks ends with an error, the other tasks are gracefully cancelled.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x00000d pending&gt;
</span><span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='int'>4</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_future'><a href="Promises/FactoryMethods.html#future-instance_method" title="Concurrent::Promises::FactoryMethods#future (method)">future</a></span>(<span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='int'>100</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
      <span class='kw'>break</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cancelled'>cancelled</span> <span class='kw'>if</span> <span class='id identifier rubyid_cancellation'>cancellation</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>
      <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.001</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_rand'>rand</span> <span class='op'>&gt;</span> <span class='float'>0.95</span>
        <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>.<span class='id identifier rubyid_resolve'>resolve</span> <span class='comment'># cancel
</span>        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random error</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_count'>count</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> [<span class='comment'>#&lt;Concurrent::Promises::Future:0x00000e pending&gt;,
</span><span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::Promises::Future:0x00000f pending&gt;,
</span><span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::Promises::Future:0x000010 pending&gt;,
</span><span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::Promises::Future:0x000011 pending&gt;]
</span>{<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>}.<span class='id identifier rubyid_zip'>zip</span>(<span class='op'>*</span><span class='id identifier rubyid_tasks'>tasks</span>).<span class='id identifier rubyid_result'>result</span> 
<span class='op'>===</span> <span class='op'>=&gt;</span> [<span class='kw'>false</span><span class='comma'>,</span>
<span class='op'>===</span>     [<span class='symbeg'>:</span><span class='id identifier rubyid_cancelled'>cancelled</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cancelled'>cancelled</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cancelled'>cancelled</span>]<span class='comma'>,</span>
<span class='op'>===</span>     [<span class='kw'>nil</span><span class='comma'>,</span> <span class='comment'>#&lt;RuntimeError: random error&gt;, nil, nil]]</span></code></pre>

<p>Without the randomly failing part it produces following.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000012 pending&gt;
</span><span class='id identifier rubyid_tasks'>tasks</span> <span class='op'>=</span> <span class='int'>4</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_future'><a href="Promises/FactoryMethods.html#future-instance_method" title="Concurrent::Promises::FactoryMethods#future (method)">future</a></span>(<span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='int'>100</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
      <span class='kw'>break</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cancelled'>cancelled</span> <span class='kw'>if</span> <span class='id identifier rubyid_cancellation'>cancellation</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>
      <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.001</span>
      <span class='comment'># if rand &gt; 0.95
</span>      <span class='comment'>#   origin.resolve
</span>      <span class='comment'>#   raise &#39;random error&#39;
</span>      <span class='comment'># end
</span>      <span class='id identifier rubyid_count'>count</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> [<span class='comment'>#&lt;Concurrent::Promises::Future:0x000013 pending&gt;,
</span><span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::Promises::Future:0x000014 pending&gt;,
</span><span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::Promises::Future:0x000015 pending&gt;,
</span><span class='op'>===</span>     <span class='comment'>#&lt;Concurrent::Promises::Future:0x000016 pending&gt;]
</span>{<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>}.<span class='id identifier rubyid_zip'>zip</span>(<span class='op'>*</span><span class='id identifier rubyid_tasks'>tasks</span>).<span class='id identifier rubyid_result'>result</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> [<span class='kw'>true</span><span class='comma'>,</span> [<span class='int'>100</span><span class='comma'>,</span> <span class='int'>100</span><span class='comma'>,</span> <span class='int'>100</span><span class='comma'>,</span> <span class='int'>100</span>]<span class='comma'>,</span> <span class='kw'>nil</span>]</code></pre>

<p><strong>Combine cancellations</strong></p>

<p>The combination created by joining two cancellations cancels when the first or the other does.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation_a'>cancellation_a</span><span class='comma'>,</span> <span class='id identifier rubyid_origin_a'>origin_a</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000017 pending&gt;
</span><span class='id identifier rubyid_cancellation_b'>cancellation_b</span><span class='comma'>,</span> <span class='id identifier rubyid_origin_b'>origin_b</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000018 pending&gt;
</span><span class='id identifier rubyid_combined_cancellation'>combined_cancellation</span>    <span class='op'>=</span> <span class='id identifier rubyid_cancellation_a'>cancellation_a</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Concurrent::Cancellation#join (method)">join</a></span>(<span class='id identifier rubyid_cancellation_b'>cancellation_b</span>)
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x000019 pending&gt;
</span>
<span class='id identifier rubyid_origin_a'>origin_a</span>.<span class='id identifier rubyid_resolve'>resolve</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::ResolvableEvent:0x00001a resolved&gt;
</span>
<span class='id identifier rubyid_cancellation_a'>cancellation_a</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>                 <span class='comment'># =&gt; true
</span><span class='id identifier rubyid_cancellation_b'>cancellation_b</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>                 <span class='comment'># =&gt; false
</span><span class='id identifier rubyid_combined_cancellation'>combined_cancellation</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>          <span class='comment'># =&gt; true</span></code></pre>

<p>If a different rule for joining is needed, the source can be combined manually.
The manually created cancellation cancels when both the first and the other cancels.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cancellation_a'>cancellation_a</span><span class='comma'>,</span> <span class='id identifier rubyid_origin_a'>origin_a</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x00001b pending&gt;
</span><span class='id identifier rubyid_cancellation_b'>cancellation_b</span><span class='comma'>,</span> <span class='id identifier rubyid_origin_b'>origin_b</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>}
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x00001c pending&gt;
</span><span class='op'>===</span> <span class='id identifier rubyid_cancels'>cancels</span> <span class='id identifier rubyid_only'>only</span> <span class='kw'>when</span> <span class='id identifier rubyid_both'>both</span> <span class='id identifier rubyid_a'>a</span> <span class='kw'>and</span> <span class='id identifier rubyid_b'>b</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_cancelled'>cancelled</span>
<span class='id identifier rubyid_combined_cancellation'>combined_cancellation</span>    <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>} <span class='id identifier rubyid_origin_a'>origin_a</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_origin_b'>origin_b</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Cancellation:0x00001d pending&gt;
</span>
<span class='id identifier rubyid_origin_a'>origin_a</span>.<span class='id identifier rubyid_resolve'>resolve</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::ResolvableEvent:0x00001e resolved&gt;
</span>
<span class='id identifier rubyid_cancellation_a'>cancellation_a</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>        <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_cancellation_b'>cancellation_b</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>        <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_combined_cancellation'>combined_cancellation</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span> <span class='comment'>#=&gt; false
</span>
<span class='id identifier rubyid_origin_b'>origin_b</span>.<span class='id identifier rubyid_resolve'>resolve</span>
<span class='op'>===</span> <span class='op'>=&gt;</span> <span class='comment'>#&lt;Concurrent::Promises::ResolvableEvent:0x00001f resolved&gt;
</span><span class='id identifier rubyid_combined_cancellation'>combined_cancellation</span>.<span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span> <span class='comment'>#=&gt; true</span></code></pre>
</p>

  </div>
</div>
<div class='tags'>
  
</div>
</div>
<h2 class='h2_sum' id='class_Attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="Synchronization/Object.html#safe_initialization%3F-class_method" title="Concurrent::Synchronization::Object.safe_initialization? (method)">.safe_initialization?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(origin = Promises.resolvable_event)  &#x21d2; Cancellation </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates the cancellation object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#timeout-class_method" title=".timeout (class method)">.<strong>timeout</strong>(intended_time)  &#x21d2; Cancellation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Create Cancellation which will cancel itself in given time.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#atomic_attribute%3F-class_method" title="Concurrent::Synchronization::Object.atomic_attribute? (method)">.atomic_attribute?</a>,
        <a class='i_m ' href="Synchronization/Object.html#atomic_attributes-class_method" title="Concurrent::Synchronization::Object.atomic_attributes (method)">.atomic_attributes</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_atomic-class_method" title="Concurrent::Synchronization::Object.attr_atomic (method)">.attr_atomic</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing to a instance variable with volatile (Java) semantic as <code>.attr_volatile</code> does.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#attr_volatile-class_method" title="Concurrent::Synchronization::Object.attr_volatile (method)">.attr_volatile</a></td>
      <td><div class='inline'><p>Creates methods for reading and writing (as <code>attr_accessor</code> does) to a instance variable with volatile (Java) semantic.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#ensure_safe_initialization_when_final_fields_are_present-class_method" title="Concurrent::Synchronization::Object.ensure_safe_initialization_when_final_fields_are_present (method)">.ensure_safe_initialization_when_final_fields_are_present</a></td>
      <td><div class='inline'><p>For testing purposes, quite slow.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Synchronization/Object.html#new-class_method" title="Concurrent::Synchronization::Object.new (method)">.new</a></td>
      <td><div class='inline'><p>Has to be called by children.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Object.html#safe_initialization!-class_method" title="Concurrent::Synchronization::Object.safe_initialization! (method)">.safe_initialization!</a>,
        <a class='i_m priv' href="Synchronization/Object.html#define_initialize_atomic_fields-class_method" title="Concurrent::Synchronization::Object.define_initialize_atomic_fields (method)">.define_initialize_atomic_fields</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/AbstractObject.html#attr_volatile-class_method" title="Concurrent::Synchronization::AbstractObject.attr_volatile (method)">.attr_volatile</a>,
        <a class='i_m ' href="Synchronization/AbstractObject.html#new-class_method" title="Concurrent::Synchronization::AbstractObject.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#canceled%3F-instance_method" title="#canceled? (instance method)">#<strong>canceled?</strong>  &#x21d2; true, false </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Is the cancellation cancelled? Respective, was the origin of the cancellation resolved.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#check!-instance_method" title="#check! (instance method)">#<strong>check!</strong>(error = CancelledOperationError)  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raise error when cancelled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#to_s-instance_method" title="Concurrent::Cancellation#to_s (method)">#to_s</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#join-instance_method" title="#join (instance method)">#<strong>join</strong>(*cancellations)  &#x21d2; Cancellation </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new <code>Cancellation</code> which is cancelled when first of the supplied cancellations or self is cancelled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#origin-instance_method" title="#origin (instance method)">#<strong>origin</strong>  &#x21d2; Promises::Future, Promises::Event </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The event or future which is the origin of the cancellation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_ary-instance_method" title="#to_ary (instance method)">#<strong>to_ary</strong>  &#x21d2; Array(Cancellation, {Promises::Future}), Array(Cancellation, {Promises::Event}) </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Allow to multi-assign the <code>Cancellation</code> object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
      (also: #inspect)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Short string representation.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="Synchronization/Object.html" title="Concurrent::Synchronization::Object (class)"><code>Synchronization::Object</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/Object.html#__initialize_atomic_fields__-instance_method" title="Concurrent::Synchronization::Object#__initialize_atomic_fields__ (method)">#__initialize_atomic_fields__</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/Volatile.html" title="Concurrent::Synchronization::Volatile (module)"><code>Synchronization::Volatile</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/Volatile.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::Volatile#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/AbstractObject.html" title="Concurrent::Synchronization::AbstractObject (class)"><code>Synchronization::AbstractObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m priv' href="Synchronization/AbstractObject.html#full_memory_barrier-instance_method" title="Concurrent::Synchronization::AbstractObject#full_memory_barrier (method)">#full_memory_barrier</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(origin = Promises.resolvable_event)  &#x21d2; <code>Cancellation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates the cancellation object.</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'>new</span></code></pre>
  </div>
<p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>origin</span>
    <span class='type'>(<a href="Promises/Future.html" title="Concurrent::Promises::Future (class)">Promises::Future</a>, <a href="Promises/Event.html" title="Concurrent::Promises::Event (class)">Promises::Event</a>)</span>
    <em class='default'>(defaults to: <tt>Promises.resolvable_event</tt>)</em>
&mdash;    <div class='inline'>
<p>of the cancellation. When it is resolved the cancellation is canceled.</p>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="#to_ary-instance_method" title="Concurrent::Cancellation#to_ary (method)">#to_ary</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L54-L57'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='54' data-end='57'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 54</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">initialize</a></span>(<span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> <span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_resolvable_event'><a href="Promises/FactoryMethods.html#resolvable_event-instance_method" title="Concurrent::Promises::FactoryMethods#resolvable_event (method)">resolvable_event</a></span>)
  <span class='kw'>super</span>()
  <span class='ivar'>@Origin</span> <span class='op'>=</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="timeout-class_method">
  <h3 class='signature  first'>
    .<strong>timeout</strong>(intended_time)  &#x21d2; <code>Cancellation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create Cancellation which will cancel itself in given time</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>intended_time</span>
    <span class='type'>(<code>Numeric</code>, <code>Time</code>)</span>
&mdash;    <div class='inline'>
<p><code>Numeric</code> means to run in <code>intended_time</code> seconds. <code>Time</code> means to run on <code>intended_time</code>.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L43-L45'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='43' data-end='45'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 43</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_timeout'>timeout</span>(<span class='id identifier rubyid_intended_time'>intended_time</span>)
  <span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_schedule'><a href="Promises/FactoryMethods.html#schedule-instance_method" title="Concurrent::Promises::FactoryMethods#schedule (method)">schedule</a></span>(<span class='id identifier rubyid_intended_time'>intended_time</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="canceled?-instance_method">
  <h3 class='signature ro first'>
    #<strong>canceled?</strong>  &#x21d2; <code>true</code>, <code>false</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Is the cancellation cancelled? Respective, was the origin of the cancellation resolved.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L77-L79'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='77' data-end='79'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 77</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_canceled?'>canceled?</span>
  <span class='ivar'>@Origin</span>.<span class='id identifier rubyid_resolved?'>resolved?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="check!-instance_method">
  <h3 class='signature  first'>
    #<strong>check!</strong>(error = CancelledOperationError)  &#x21d2; <code>self</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raise error when cancelled</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>error</span>
    <span class='type'>(#<code>exception</code>)</span>
    <em class='default'>(defaults to: <tt>CancelledOperationError</tt>)</em>
&mdash;    <div class='inline'>
<p>to be risen</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'></span>
    <div class='inline'>
<p>the error</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L85-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='85' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 85</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check!'>check!</span>(<span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html#CancelledOperationError-constant" title="Concurrent::CancelledOperationError (constant)">CancelledOperationError</a></span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_error'>error</span> <span class='kw'>if</span> <span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#to_s-instance_method" title="Concurrent::Cancellation#to_s (method)">#to_s</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L105-L105'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='105' data-end='105'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 105</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_inspect'>inspect</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to_s'><a href="#to_s-instance_method" title="Concurrent::Cancellation#to_s (method)">to_s</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="join-instance_method">
  <h3 class='signature '>
    #<strong>join</strong>(*cancellations)  &#x21d2; <code>Cancellation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new <code>Cancellation</code> which is cancelled when first of the supplied cancellations or self is cancelled.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>cancellations</span>
    <span class='type'>(<code>Cancellation</code>)</span>
&mdash;    <div class='inline'>
<p>to combine</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Cancellation</code>)</span>
&mdash;    <div class='inline'>
<p>new cancellation</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L95-L97'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='95' data-end='97'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 95</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_join'>join</span>(<span class='op'>*</span><span class='id identifier rubyid_cancellations'>cancellations</span>)
  <span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span> <span class='const'><a href="Promises.html" title="Concurrent::Promises (module)">Promises</a></span>.<span class='id identifier rubyid_any_event'><a href="Promises/FactoryMethods.html#any_event-instance_method" title="Concurrent::Promises::FactoryMethods#any_event (method)">any_event</a></span>(<span class='op'>*</span>[<span class='ivar'>@Origin</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_cancellations'>cancellations</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span>)])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="origin-instance_method">
  <h3 class='signature '>
    #<strong>origin</strong>  &#x21d2; <a href="Promises/Future.html" title="Concurrent::Promises::Future (class)">Promises::Future</a>, <a href="Promises/Event.html" title="Concurrent::Promises::Event (class)">Promises::Event</a> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The event or future which is the origin of the cancellation</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L70-L72'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='72'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_origin'>origin</span>
  <span class='ivar'>@Origin</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_ary-instance_method">
  <h3 class='signature '>
    #<strong>to_ary</strong>  &#x21d2; <a href="Array.html" title="Concurrent::Array (class)">Array</a>(<code>Cancellation</code>, {<a href="Promises/Future.html" title="Concurrent::Promises::Future (class)">Promises::Future</a>}), <a href="Array.html" title="Concurrent::Array (class)">Array</a>(<code>Cancellation</code>, {<a href="Promises/Event.html" title="Concurrent::Promises::Event (class)">Promises::Event</a>}) 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allow to multi-assign the <code>Cancellation</code> object</p>

  </div>
</div>
<div class='tags'>
    <div class='examples'>
    <p class='tag_title'>Examples:</p>
      <pre class='example code ruby'><code><span class='id identifier rubyid_cancellation'>cancellation</span>         <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span>
<span class='id identifier rubyid_cancellation'>cancellation</span><span class='comma'>,</span> <span class='id identifier rubyid_origin'><a href="#origin-instance_method" title="Concurrent::Cancellation#origin (method)">origin</a></span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Cancellation</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Cancellation.new (method)">new</a></span></code></pre>
  </div>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L64-L66'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='64' data-end='66'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 64</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_ary'>to_ary</span>
  [<span class='kw'>self</span><span class='comma'>,</span> <span class='ivar'>@Origin</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    #<strong>to_s</strong>  &#x21d2; <code>String</code> 
    <span class='aliases'>Also known as: <span class='names'>#inspect</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Short string representation.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb#L101-L103'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='101' data-end='103'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby-edge/concurrent/edge/cancellation.rb', line 101</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_format'>format</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%s %s&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>super</span>[<span class='int'>0</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_canceled?'><a href="#canceled%3F-instance_method" title="Concurrent::Cancellation#canceled? (method)">canceled?</a></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>canceled</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>