<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Concurrent::Agent &mdash; Concurrent Ruby master</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Concurrent::Agent",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Concurrent</a> &raquo; 
      <a href='../_index.html#alpha_A'>Index (A)</a> &raquo; 
        <a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Agent&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Concurrent::Agent</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Agent/Job.html" title="Concurrent::Agent::Job (class)"><code>Job</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="Agent/Error.html" title="Concurrent::Agent::Error (class)"><code>Error</code></a>,
        <a href="Agent/ValidationError.html" title="Concurrent::Agent::ValidationError (class)"><code>ValidationError</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="Synchronization/LockableObject.html" title="Concurrent::Synchronization::LockableObject (class)"><code>Synchronization::LockableObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)"><code>Concern::Observable</code></a>,
          <a href="Synchronization/LockableObject.html" title="Concurrent::Synchronization::LockableObject (class)"><code>Synchronization::LockableObject</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Synchronization/LockableObject.html" title="Concurrent::Synchronization::LockableObject (class)">Concurrent::Synchronization::LockableObject</a></span>
        <ul class='fullTree'>
          <li><a href="../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a href="Synchronization/LockableObject.html" title="Concurrent::Synchronization::LockableObject (class)">Concurrent::Synchronization::LockableObject</a></li>
          <li class='next'>Concurrent::Agent</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L145'>lib/concurrent-ruby/concurrent/agent.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    <p><code>Agent</code> is inspired by Clojure&#39;s <a href="http://clojure.org/agents" target="_parent" title="agent">agent</a>
function. An agent is a shared, mutable variable providing independent,
uncoordinated, <em>asynchronous</em> change of individual values. Best used when
the value will undergo frequent, complex updates. Suitable when the result
of an update does not need to be known immediately. <code>Agent</code> is (mostly)
functionally equivalent to Clojure&#39;s agent, except where the runtime
prevents parity.</p>

<p>Agents are reactive, not autonomous - there is no imperative message loop
and no blocking receive. The state of an <code>Agent</code> should be itself immutable
and the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of an <code>Agent</code> is always immediately available for reading by
any thread without any messages, i.e. observation does not require
cooperation or coordination.</p>

<p><code>Agent</code> action dispatches are made using the various <a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> methods. These
methods always return immediately. At some point later, in another thread,
the following will happen:</p>

<ol>
<li>The given <code>action</code> will be applied to the state of the <code>Agent</code> and the
<code>args</code>, if any were supplied.</li>
<li>The return value of <code>action</code> will be passed to the validator lambda,
if one has been set on the Agent.</li>
<li>If the validator succeeds or if no validator was given, the return value
of the given <code>action</code> will become the new <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the Agent. See
<a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">#initialize</a> for details.</li>
<li>If any observers were added to the <code>Agent</code>, they will be notified. See
<code>#add_observer</code> for details.</li>
<li>If during the <code>action</code> execution any other dispatches are made (directly
or indirectly), they will be held until after the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the Agent
has been changed.</li>
</ol>

<p>If any exceptions are thrown by an action function, no nested dispatches
will occur, and the exception will be cached in the <code>Agent</code> itself. When an
<code>Agent</code> has errors cached, any subsequent interactions will immediately throw
an exception, until the agent&#39;s errors are cleared. <code>Agent</code> errors can be
examined with <a href="#error-instance_method" title="Concurrent::Agent#error (method)">#error</a> and the agent restarted with <a href="#restart-instance_method" title="Concurrent::Agent#restart (method)">#restart</a>.</p>

<p>The actions of all Agents get interleaved amongst threads in a thread pool.
At any point in time, at most one action for each <code>Agent</code> is being executed.
Actions dispatched to an agent from another single agent or thread will
occur in the order they were sent, potentially interleaved with actions
dispatched to the same agent from other sources. The <a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> method should
be used for actions that are CPU limited, while the <a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a> method is
appropriate for actions that may block on IO.</p>

<p>Unlike in Clojure, <code>Agent</code> cannot participate in <a href="TVar.html" title="Concurrent::TVar (class)"><code>TVar</code></a> transactions.</p>

<h4>Example</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_next_fibonacci'>next_fibonacci</span>(<span class='id identifier rubyid_set'>set</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>return</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span>] <span class='kw'>if</span> <span class='id identifier rubyid_set'>set</span>.<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_set'>set</span> <span class='op'>+</span> [<span class='id identifier rubyid_set'>set</span>[<span class='op'>-</span><span class='int'>2</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>].<span class='id identifier rubyid_reduce'>reduce</span>{<span class='op'>|</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_x'>x</span> }]
<span class='kw'>end</span>

<span class='comment'>### create an agent with an initial value
</span><span class='id identifier rubyid_agent'>agent</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Agent</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>}(<span class='id identifier rubyid_next_fibonacci'>next_fibonacci</span>)

<span class='comment'>### send a few update requests
</span><span class='int'>5</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Concurrent::Agent#send (method)">send</a></span>{<span class='op'>|</span><span class='id identifier rubyid_set'>set</span><span class='op'>|</span> <span class='id identifier rubyid_next_fibonacci'>next_fibonacci</span>(<span class='id identifier rubyid_set'>set</span>) }
<span class='kw'>end</span>

<span class='comment'>### wait for them to complete
</span><span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_await'><a href="#await-class_method" title="Concurrent::Agent.await (method)">await</a></span>

<span class='comment'>### get the current value
</span><span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='comment'>#=&gt; [0, 1, 1, 2, 3, 5, 8]</span></code></pre>

<h4>Observation</h4>

<p>Agents support observers through the <code>Concurrent::Observable</code> mixin module.
Notification of observers occurs every time an action dispatch returns and
the new value is successfully validated. Observation will <em>not</em> occur if the
action raises an exception, if validation fails, or when a <a href="#restart-instance_method" title="Concurrent::Agent#restart (method)">#restart</a> occurs.</p>

<p>When notified the observer will receive three arguments: <code>time</code>, <code>old_value</code>,
and <code>new_value</code>. The <code>time</code> argument is the time at which the value change
occurred. The <code>old_value</code> is the value of the Agent when the action began
processing. The <code>new_value</code> is the value to which the Agent was set when the
action completed. Note that <code>old_value</code> and <code>new_value</code> may be the same.
This is not an error. It simply means that the action returned the same
value.</p>

<h4>Nested Actions</h4>

<p>It is possible for an Agent action to post further actions back to itself.
The nested actions will be enqueued normally then processed <em>after</em> the
outer action completes, in the order they were sent, possibly interleaved
with action dispatches from other threads. Nested actions never deadlock
with one another and a failure in a nested action will never affect the
outer action.</p>

<p>Nested actions can be called using the Agent reference from the enclosing
scope or by passing the reference in as a &quot;send&quot; argument. Nested actions
cannot be post using <code>self</code> from within the action block/proc/lambda; <code>self</code>
in this context will not reference the Agent. The preferred method for
dispatching nested actions is to pass the Agent as an argument. This allows
Ruby to more effectively manage the closing scope.</p>

<p>Prefer this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_agent'>agent</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Agent</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>}(<span class='int'>0</span>)
<span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Concurrent::Agent#send (method)">send</a></span>(<span class='id identifier rubyid_agent'>agent</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span><span class='comma'>,</span> <span class='id identifier rubyid_this'>this</span><span class='op'>|</span>
  <span class='id identifier rubyid_this'>this</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Concurrent::Agent#send (method)">send</a></span> {<span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>+</span> <span class='int'>42</span> }
  <span class='float'>3.14</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='comment'>#=&gt; 45.14</span></code></pre>

<p>Over this:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_agent'>agent</span> <span class='op'>=</span> {<span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'>Agent</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>}(<span class='int'>0</span>)
<span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Concurrent::Agent#send (method)">send</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span><span class='op'>|</span>
  <span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Concurrent::Agent#send (method)">send</a></span> {<span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>+</span> <span class='int'>42</span> }
  <span class='float'>3.14</span>
<span class='kw'>end</span></code></pre>

<p><strong>NOTE</strong> Never, <em>under any circumstances</em>, call any of the &quot;await&quot; methods
(<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action
block/proc/lambda. The call will block the Agent and will always fail.
Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will
hopelessly deadlock the Agent with no possibility of recovery.</p>

<h2>Thread-safe Variable Classes</h2>

<p>Each of the thread-safe variable classes is designed to solve a different
problem. In general:</p>

<ul>
<li><em><code>Agent</code>:</em> Shared, mutable variable providing independent,
uncoordinated, <em>asynchronous</em> change of individual values. Best used when
the value will undergo frequent, complex updates. Suitable when the result
of an update does not need to be known immediately.</li>
<li><em><a href="Atom.html" title="Concurrent::Atom (class)"><code>Atom</code></a>:</em> Shared, mutable variable providing independent,
uncoordinated, <em>synchronous</em> change of individual values. Best used when
the value will undergo frequent reads but only occasional, though complex,
updates. Suitable when the result of an update must be known immediately.</li>
<li><em><a href="AtomicReference.html" title="Concurrent::AtomicReference (class)"><code>AtomicReference</code></a>:</em> A simple object reference that can be updated
atomically. Updates are synchronous but fast. Best used when updates a
simple set operations. Not suitable when updates are complex.
<a href="AtomicBoolean.html" title="Concurrent::AtomicBoolean (class)"><code>AtomicBoolean</code></a> and <a href="AtomicFixnum.html" title="Concurrent::AtomicFixnum (class)"><code>AtomicFixnum</code></a> are similar
but optimized for the given data type.</li>
<li><em><a href="Exchanger.html" title="Concurrent::Exchanger (class)"><code>Exchanger</code></a>:</em> Shared, stateless synchronization point. Used
when two or more threads need to exchange data. The threads will pair then
block on each other until the exchange is complete.</li>
<li><em><a href="MVar.html" title="Concurrent::MVar (class)"><code>MVar</code></a>:</em> Shared synchronization point. Used when one thread
must give a value to another, which must take the value. The threads will
block on each other until the exchange is complete.</li>
<li><em><a href="ThreadLocalVar.html" title="Concurrent::ThreadLocalVar (class)"><code>ThreadLocalVar</code></a>:</em> Shared, mutable, isolated variable which
holds a different value for each thread which has access. Often used as
an instance variable in objects which must maintain different state
for different threads.</li>
<li><em><a href="TVar.html" title="Concurrent::TVar (class)"><code>TVar</code></a>:</em> Shared, mutable variables which provide
<em>coordinated</em>, <em>synchronous</em>, change of <em>many</em> stated. Used when multiple
value must change together, in an all-or-nothing transaction.</li>
</ul>

  </div>
</div>
<div class='tags'>
    <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="http://clojure.org/Agents" target="_parent" title="Clojure Agents">Clojure Agents</a></li>
          <li><a href="http://clojure.org/state" target="_parent" title="Values and Change - Clojure&#39;s approach to Identity and State">Values and Change - Clojure's approach to Identity and State</a></li>
      </ul>

</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='AWAIT_ACTION-constant' class='summary_signature priv'>AWAIT_ACTION =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L154-L154'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 154</a>    <pre class='code ruby'><span class='tlambda'>-&gt;</span>(<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span><span class='comma'>,</span> <span class='id identifier rubyid_latch'>latch</span>) <span class='tlambeg'>{</span> <span class='id identifier rubyid_latch'>latch</span>.<span class='id identifier rubyid_count_down'>count_down</span><span class='semicolon'>;</span> <span class='const'><a href="#AWAIT_FLAG-constant" title="Concurrent::Agent::AWAIT_FLAG (constant)">AWAIT_FLAG</a></span> }</pre>
  </li>
  <li>
    <span id='AWAIT_FLAG-constant' class='summary_signature priv'>AWAIT_FLAG =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L151-L151'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 151</a>    <pre class='code ruby'><span class='op'>::</span><span class='const'><a href="../Object.html" title="Object (class)">Object</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span></pre>
  </li>
  <li>
    <span id='DEFAULT_ERROR_HANDLER-constant' class='summary_signature priv'>DEFAULT_ERROR_HANDLER =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L157-L157'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 157</a>    <pre class='code ruby'><span class='tlambda'>-&gt;</span>(<span class='id identifier rubyid_agent'>agent</span><span class='comma'>,</span> <span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span>) <span class='tlambeg'>{</span> <span class='kw'>nil</span> }</pre>
  </li>
  <li>
    <span id='DEFAULT_VALIDATOR-constant' class='summary_signature priv'>DEFAULT_VALIDATOR =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L160-L160'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 160</a>    <pre class='code ruby'><span class='tlambda'>-&gt;</span>(<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>) <span class='tlambeg'>{</span> <span class='kw'>true</span> }</pre>
  </li>
  <li>
    <span id='ERROR_MODES-constant' class='summary_signature priv'>ERROR_MODES =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L148-L148'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 148</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_continue'>continue</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fail'>fail</span>].<span class='id identifier rubyid_freeze'>freeze</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#await-class_method" title=".await (class method)">.<strong>await</strong>(*agents)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread (indefinitely!) until all actions dispatched thus far to all the given Agents, from this thread or nested by the given Agents, have occurred.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#await_for-class_method" title=".await_for (class method)">.<strong>await_for</strong>(timeout, *agents)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread until all actions dispatched thus far to all the given Agents, from this thread or nested by the given Agents, have occurred, or the timeout (in seconds) has elapsed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#await_for!-class_method" title=".await_for! (class method)">.<strong>await_for!</strong>(timeout, *agents)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread until all actions dispatched thus far to all the given Agents, from this thread or nested by the given Agents, have occurred, or the timeout (in seconds) has elapsed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(initial, opts = {})  &#x21d2; Agent </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new <code>Agent</code> with the given initial value and options.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#error_mode-instance_method" title="#error_mode (instance method)">#<strong>error_mode</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>The error mode this <code>Agent</code> is operating in.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#failed%3F-instance_method" title="#failed? (instance method)">#<strong>failed?</strong>  &#x21d2; Boolean </a>
      (also: #stopped?)
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Is the <code>Agent</code> in a failed state?</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#stopped%3F-instance_method" title="#stopped? (instance method)">#<strong>stopped?</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#<<-instance_method" title="#&lt;&lt; (instance method)">#<strong>&lt;&lt;</strong>(action)  &#x21d2; Concurrent::Agent </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#await-instance_method" title="#await (instance method)">#<strong>await</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread (indefinitely!) until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#await_for-instance_method" title="#await_for (instance method)">#<strong>await_for</strong>(timeout)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred, or the timeout (in seconds) has elapsed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#await_for!-instance_method" title="#await_for! (instance method)">#<strong>await_for!</strong>(timeout)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred, or the timeout (in seconds) has elapsed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#deref-instance_method" title="#deref (instance method)">#<strong>deref</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#error-instance_method" title="#error (instance method)">#<strong>error</strong>  &#x21d2; nil, Error </a>
      (also: #reason)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>When <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a> and <a href="#error_mode-instance_method" title="Concurrent::Agent#error_mode (method)">#error_mode</a> is <code>:fail</code>, returns the error object which caused the failure, else <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#post-instance_method" title="#post (instance method)">#<strong>post</strong>(*args, &amp;action)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reason-instance_method" title="#reason (instance method)">#<strong>reason</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#error-instance_method" title="Concurrent::Agent#error (method)">#error</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#restart-instance_method" title="#restart (instance method)">#<strong>restart</strong>(new_value, opts = {})  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>When an <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>, changes the <code>Agent</code> <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> to <code>new_value</code> then un-fails the <code>Agent</code> so that action dispatches are allowed again.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send-instance_method" title="#send (instance method)">#<strong>send</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send!-instance_method" title="#send! (instance method)">#<strong>send!</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_off-instance_method" title="#send_off (instance method)">#<strong>send_off</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; Boolean </a>
      (also: #post)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_off!-instance_method" title="#send_off! (instance method)">#<strong>send_off!</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_via-instance_method" title="#send_via (instance method)">#<strong>send_via</strong>(executor, *args, &amp;action) {|agent, value, *args| ... } &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send_via!-instance_method" title="#send_via! (instance method)">#<strong>send_via!</strong>(executor, *args, &amp;action) {|agent, value, *args| ... } &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dispatches an action to the <code>Agent</code> and returns immediately.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; Object </a>
      (also: #deref)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The current value (state) of the <code>Agent</code>, irrespective of any pending or in-progress actions.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#wait-instance_method" title="#wait (instance method)">#<strong>wait</strong>(timeout = nil)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current thread until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred, or the timeout (in seconds) has elapsed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#enqueue_action_job-instance_method" title="#enqueue_action_job (instance method)">#<strong>enqueue_action_job</strong>(action, args, executor)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#enqueue_await_job-instance_method" title="#enqueue_await_job (instance method)">#<strong>enqueue_await_job</strong>(latch)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#execute_next_job-instance_method" title="#execute_next_job (instance method)">#<strong>execute_next_job</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#handle_error-instance_method" title="#handle_error (instance method)">#<strong>handle_error</strong>(error)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ns_enqueue_job-instance_method" title="#ns_enqueue_job (instance method)">#<strong>ns_enqueue_job</strong>(job, index = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ns_find_last_job_for_thread-instance_method" title="#ns_find_last_job_for_thread (instance method)">#<strong>ns_find_last_job_for_thread</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ns_initialize-instance_method" title="#ns_initialize (instance method)">#<strong>ns_initialize</strong>(initial, opts)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ns_post_next_job-instance_method" title="#ns_post_next_job (instance method)">#<strong>ns_post_next_job</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ns_validate-instance_method" title="#ns_validate (instance method)">#<strong>ns_validate</strong>(value)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="Concern/Observable.html" title="Concurrent::Concern::Observable (module)"><code>Concern::Observable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#add_observer-instance_method" title="Concurrent::Concern::Observable#add_observer (method)">#add_observer</a></td>
      <td><div class='inline'><p>Adds an observer to this set.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#count_observers-instance_method" title="Concurrent::Concern::Observable#count_observers (method)">#count_observers</a></td>
      <td><div class='inline'><p>Return the number of observers associated with this object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#delete_observer-instance_method" title="Concurrent::Concern::Observable#delete_observer (method)">#delete_observer</a></td>
      <td><div class='inline'><p>Remove <code>observer</code> as an observer on this object so that it will no longer receive notifications.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#delete_observers-instance_method" title="Concurrent::Concern::Observable#delete_observers (method)">#delete_observers</a></td>
      <td><div class='inline'><p>Remove all observers associated with this object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Concern/Observable.html#with_observer-instance_method" title="Concurrent::Concern::Observable#with_observer (method)">#with_observer</a></td>
      <td><div class='inline'><p>As <code>#add_observer</code> but can be used for chaining.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Synchronization/LockableObject.html" title="Concurrent::Synchronization::LockableObject (class)"><code>Synchronization::LockableObject</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="Synchronization/LockableObject.html#new_condition-instance_method" title="Concurrent::Synchronization::LockableObject#new_condition (method)">#new_condition</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(initial, opts = {})  &#x21d2; <code>Agent</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new <code>Agent</code> with the given initial value and options.</p>

<p>The <code>:validator</code> option must be <code>nil</code> or a side-effect free proc/lambda which takes one argument. On any intended value change the validator, if provided, will be called. If the new value is invalid the validator should return <code>false</code> or raise an error.</p>

<p>The <code>:error_handler</code> option must be <code>nil</code> or a proc/lambda which takes two arguments. When an action raises an error or validation fails, either by returning false or raising an error, the error handler will be called. The arguments to the error handler will be a reference to the agent itself and the error object which was raised.</p>

<p>The <code>:error_mode</code> may be either <code>:continue</code> (the default if an error handler is given) or <code>:fail</code> (the default if error handler nil or not given).</p>

<p>If an action being run by the agent throws an error or doesn’t pass validation the error handler, if present, will be called. After the handler executes if the error mode is <code>:continue</code> the <code>Agent</code> will continue as if neither the action that caused the error nor the error itself ever happened.</p>

<p>If the mode is <code>:fail</code> the <code>Agent</code> will become <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a> and will stop accepting new action dispatches. Any previously queued actions will be held until <a href="#restart-instance_method" title="Concurrent::Agent#restart (method)">#restart</a> is called. The <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> method will still work, returning the value of the <code>Agent</code> before the error.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>initial</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the initial value</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<a href="Hash.html" title="Concurrent::Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>the configuration options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:error_mode</span>
          <span class='type'>(<code>Symbol</code>)</span>
            &mdash; <div class='inline'>
<p>either <code>:continue</code> or <code>:fail</code></p>
</div>        </li>
        <li>
          <span class='name'>:error_handler</span>
          <span class='type'>(<code>nil</code>, <code>Proc</code>)</span>
            &mdash; <div class='inline'>
<p>the (optional) error handler</p>
</div>        </li>
        <li>
          <span class='name'>:validator</span>
          <span class='type'>(<code>nil</code>, <code>Proc</code>)</span>
            &mdash; <div class='inline'>
<p>the (optional) validation procedure</p>
</div>        </li>
    </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L220-L223'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='220' data-end='223'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 220</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">initialize</a></span>(<span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='kw'>super</span>()
  <span class='id identifier rubyid_synchronize'>synchronize</span> { <span class='id identifier rubyid_ns_initialize'><a href="#ns_initialize-instance_method" title="Concurrent::Agent#ns_initialize (method)">ns_initialize</a></span>(<span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="await-class_method">
  <h3 class='signature  first'>
    .<strong>await</strong>(*agents)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread (indefinitely!) until all actions dispatched thus far to all the given Agents, from this thread or nested by the given Agents, have occurred. Will block when any of the agents are failed. Will never return if a failed <code>Agent</code> is restart with <code>:clear_actions</code> true.</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action block/proc/lambda. The call will block the <code>Agent</code> and will always fail. Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will hopelessly deadlock the <code>Agent</code> with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>agents</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<code>Agent</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the Agents on which to wait</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L449-L452'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='449' data-end='452'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 449</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_await'>await</span>(<span class='op'>*</span><span class='id identifier rubyid_agents'>agents</span>)
  <span class='id identifier rubyid_agents'>agents</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_agent'>agent</span><span class='op'>|</span> <span class='id identifier rubyid_agent'>agent</span>.<span class='id identifier rubyid_await'>await</span> }
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="await_for-class_method">
  <h3 class='signature '>
    .<strong>await_for</strong>(timeout, *agents)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread until all actions dispatched thus far to all the given Agents, from this thread or nested by the given Agents, have occurred, or the timeout (in seconds) has elapsed.</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action block/proc/lambda. The call will block the <code>Agent</code> and will always fail. Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will hopelessly deadlock the <code>Agent</code> with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>the maximum number of seconds to wait</p>
</div>
  </li>
  <li>
    <span class='name'>agents</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<code>Agent</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the Agents on which to wait</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if all actions complete before timeout else false</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L463-L470'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='463' data-end='470'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 463</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_await_for'>await_for</span>(<span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_agents'>agents</span>)
  <span class='id identifier rubyid_end_at'>end_at</span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_monotonic_time'><a href="../Concurrent.html#monotonic_time-class_method" title="Concurrent.monotonic_time (method)">monotonic_time</a></span> <span class='op'>+</span> <span class='id identifier rubyid_timeout'>timeout</span>.<span class='id identifier rubyid_to_f'>to_f</span>
  <span class='id identifier rubyid_ok'>ok</span>     <span class='op'>=</span> <span class='id identifier rubyid_agents'>agents</span>.<span class='id identifier rubyid_length'>length</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='kw'>break</span> <span class='kw'>false</span> <span class='kw'>if</span> (<span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='id identifier rubyid_end_at'>end_at</span> <span class='op'>-</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_monotonic_time'><a href="../Concurrent.html#monotonic_time-class_method" title="Concurrent.monotonic_time (method)">monotonic_time</a></span>) <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='kw'>break</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_agents'>agents</span>[<span class='id identifier rubyid_i'>i</span>].<span class='id identifier rubyid_await_for'>await_for</span>(<span class='id identifier rubyid_delay'>delay</span>)
  <span class='kw'>end</span>
  <span class='op'>!</span><span class='op'>!</span><span class='id identifier rubyid_ok'>ok</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="await_for!-class_method">
  <h3 class='signature '>
    .<strong>await_for!</strong>(timeout, *agents)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread until all actions dispatched thus far to all the given Agents, from this thread or nested by the given Agents, have occurred, or the timeout (in seconds) has elapsed.</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action block/proc/lambda. The call will block the <code>Agent</code> and will always fail. Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will hopelessly deadlock the <code>Agent</code> with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>the maximum number of seconds to wait</p>
</div>
  </li>
  <li>
    <span class='name'>agents</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<code>Agent</code>&gt;)</span>
&mdash;    <div class='inline'>
<p>the Agents on which to wait</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if all actions complete before timeout</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Concurrent.html#TimeoutError-constant" title="Concurrent::TimeoutError (constant)">Concurrent::TimeoutError</a>)</span>
&mdash;    <div class='inline'>
<p>when timeout is reached</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L482-L485'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='482' data-end='485'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 482</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_await_for!'>await_for!</span>(<span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_agents'>agents</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="../Concurrent.html#TimeoutError-constant" title="Concurrent::TimeoutError (constant)">TimeoutError</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_await_for'><a href="#await_for-class_method" title="Concurrent::Agent.await_for (method)">await_for</a></span>(<span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_agents'>agents</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="error_mode-instance_method">
  <h3 class='signature ro first'>
    #<strong>error_mode</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The error mode this <code>Agent</code> is operating in. See <a href="../Concurrent.html#initialize-instance_method" title="Concurrent#initialize (method)">Concurrent#initialize</a> for details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L184-L184'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='184' data-end='184'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 184</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_error_mode'>error_mode</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="failed?-instance_method">
  <h3 class='signature ro'>
    #<strong>failed?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#stopped?</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Is the <code>Agent</code> in a failed state?</p>

  </div>
</div>
<div class='tags'>
    <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="#restart-instance_method" title="Concurrent::Agent#restart (method)">#restart</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L402-L404'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='402' data-end='404'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 402</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_failed?'>failed?</span>
  <span class='op'>!</span><span class='ivar'>@error</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>.<span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stopped?-instance_method">
  <h3 class='signature ro'>
    #<strong>stopped?</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L406-L406'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='406' data-end='406'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 406</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_stopped?'>stopped?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_failed?'><a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">failed?</a></span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="<<-instance_method">
  <h3 class='signature  first'>
    #<strong>&lt;&lt;</strong>(action)  &#x21d2; <code>Agent</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Appropriate for actions that may block on IO.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Agent</code>)</span>
&mdash;    <div class='inline'>
<p>self</p>
</div>
  </li>
</ul>
  <p class='tag_title'>See Also:</p>
  <ul class='see'>
      <li><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a></li>
      </ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L331-L334'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='331' data-end='334'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 331</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span>(<span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_send_off'><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">send_off</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="await-instance_method">
  <h3 class='signature '>
    #<strong>await</strong>  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread (indefinitely!) until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred. Will block when <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>. Will never return if a failed <code>Agent</code> is <a href="#restart-instance_method" title="Concurrent::Agent#restart (method)">#restart</a> with <code>:clear_actions</code> true.</p>

<p>Returns a reference to <code>self</code> to support method chaining:</p>

<p>“‘ current_value = agent.await.value “`</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<code>#await</code>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action block/proc/lambda. The call will block the Agent and will always fail. Calling either <code>#await</code> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will hopelessly deadlock the Agent with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>self</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L350-L353'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='350' data-end='353'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 350</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_await'>await</span>
  <span class='id identifier rubyid_wait'><a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">wait</a></span>(<span class='kw'>nil</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="await_for-instance_method">
  <h3 class='signature '>
    #<strong>await_for</strong>(timeout)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred, or the timeout (in seconds) has elapsed.</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <code>#await_for</code>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action block/proc/lambda. The call will block the <code>Agent</code> and will always fail. Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will hopelessly deadlock the <code>Agent</code> with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>the maximum number of seconds to wait</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if all actions complete before timeout else false</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L363-L365'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='363' data-end='365'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 363</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_await_for'>await_for</span>(<span class='id identifier rubyid_timeout'>timeout</span>)
  <span class='id identifier rubyid_wait'><a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">wait</a></span>(<span class='id identifier rubyid_timeout'>timeout</span>.<span class='id identifier rubyid_to_f'>to_f</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="await_for!-instance_method">
  <h3 class='signature '>
    #<strong>await_for!</strong>(timeout)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred, or the timeout (in seconds) has elapsed.</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <code>#await_for!</code>, and <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a>) from within an action block/proc/lambda. The call will block the <code>Agent</code> and will always fail. Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">#wait</a> (with a timeout of <code>nil</code>) will hopelessly deadlock the <code>Agent</code> with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>)</span>
&mdash;    <div class='inline'>
<p>the maximum number of seconds to wait</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if all actions complete before timeout</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Concurrent.html#TimeoutError-constant" title="Concurrent::TimeoutError (constant)">Concurrent::TimeoutError</a>)</span>
&mdash;    <div class='inline'>
<p>when timeout is reached</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L377-L380'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='377' data-end='380'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 377</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_await_for!'>await_for!</span>(<span class='id identifier rubyid_timeout'>timeout</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="../Concurrent.html#TimeoutError-constant" title="Concurrent::TimeoutError (constant)">TimeoutError</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_wait'><a href="#wait-instance_method" title="Concurrent::Agent#wait (method)">wait</a></span>(<span class='id identifier rubyid_timeout'>timeout</span>.<span class='id identifier rubyid_to_f'>to_f</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="deref-instance_method">
  <h3 class='signature '>
    #<strong>deref</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L233-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='233' data-end='233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 233</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_deref'>deref</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="enqueue_action_job-instance_method">
  <h3 class='signature priv'>
    #<strong>enqueue_action_job</strong>(action, args, executor)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L510-L514'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='510' data-end='514'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 510</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_enqueue_action_job'>enqueue_action_job</span>(<span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>no action given</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_action'>action</span>
  <span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='const'><a href="Agent/Job.html" title="Concurrent::Agent::Job (class)">Job</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>(<span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span><span class='comma'>,</span> <span class='ivar'>@caller</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='op'>||</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_object_id'>object_id</span>)
  <span class='id identifier rubyid_synchronize'>synchronize</span> { <span class='id identifier rubyid_ns_enqueue_job'><a href="#ns_enqueue_job-instance_method" title="Concurrent::Agent#ns_enqueue_job (method)">ns_enqueue_job</a></span>(<span class='id identifier rubyid_job'>job</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="enqueue_await_job-instance_method">
  <h3 class='signature priv'>
    #<strong>enqueue_await_job</strong>(latch)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L516-L527'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='516' data-end='527'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 516</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_enqueue_await_job'>enqueue_await_job</span>(<span class='id identifier rubyid_latch'>latch</span>)
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>if</span> (<span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_ns_find_last_job_for_thread'><a href="#ns_find_last_job_for_thread-instance_method" title="Concurrent::Agent#ns_find_last_job_for_thread (method)">ns_find_last_job_for_thread</a></span>)
      <span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='const'><a href="Agent/Job.html" title="Concurrent::Agent::Job (class)">Job</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>(<span class='const'><a href="#AWAIT_ACTION-constant" title="Concurrent::Agent::AWAIT_ACTION (constant)">AWAIT_ACTION</a></span><span class='comma'>,</span> [<span class='id identifier rubyid_latch'>latch</span>]<span class='comma'>,</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_global_immediate_executor'><a href="../Concurrent.html#global_immediate_executor-class_method" title="Concurrent.global_immediate_executor (method)">global_immediate_executor</a></span><span class='comma'>,</span>
                    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_object_id'>object_id</span>)
      <span class='id identifier rubyid_ns_enqueue_job'><a href="#ns_enqueue_job-instance_method" title="Concurrent::Agent#ns_enqueue_job (method)">ns_enqueue_job</a></span>(<span class='id identifier rubyid_job'>job</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>+</span><span class='int'>1</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_latch'>latch</span>.<span class='id identifier rubyid_count_down'>count_down</span>
      <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="error-instance_method">
  <h3 class='signature '>
    #<strong>error</strong>  &#x21d2; <code>nil</code>, <a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Error</a> 
    <span class='aliases'>Also known as: <span class='names'>#reason</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a> and <a href="#error_mode-instance_method" title="Concurrent::Agent#error_mode (method)">#error_mode</a> is <code>:fail</code>, returns the error object which caused the failure, else <code>nil</code>. When <a href="#error_mode-instance_method" title="Concurrent::Agent#error_mode (method)">#error_mode</a> is <code>:continue</code> will <strong>always</strong> return <code>nil</code>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>nil</code>, <a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Error</a>)</span>
&mdash;    <div class='inline'>
<p>the error which caused the failure when <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L240-L242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='240' data-end='242'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 240</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_error'>error</span>
  <span class='ivar'>@error</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute_next_job-instance_method">
  <h3 class='signature priv'>
    #<strong>execute_next_job</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L543-L568'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='543' data-end='568'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 543</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_next_job'>execute_next_job</span>
  <span class='id identifier rubyid_job'>job</span>       <span class='op'>=</span> <span class='id identifier rubyid_synchronize'>synchronize</span> { <span class='ivar'>@queue</span>.<span class='id identifier rubyid_first'>first</span> }
  <span class='id identifier rubyid_old_value'>old_value</span> <span class='op'>=</span> <span class='ivar'>@current</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>

  <span class='ivar'>@caller</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_caller'>caller</span> <span class='comment'># for nested actions
</span>  <span class='id identifier rubyid_new_value'>new_value</span>     <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_action'>action</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_args'>args</span>)
  <span class='ivar'>@caller</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_new_value'>new_value</span> <span class='op'>==</span> <span class='const'><a href="#AWAIT_FLAG-constant" title="Concurrent::Agent::AWAIT_FLAG (constant)">AWAIT_FLAG</a></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ns_validate'><a href="#ns_validate-instance_method" title="Concurrent::Agent#ns_validate (method)">ns_validate</a></span>(<span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='ivar'>@current</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='op'>=</span> <span class='id identifier rubyid_new_value'>new_value</span>
    <span class='id identifier rubyid_observers'>observers</span>.<span class='id identifier rubyid_notify_observers'>notify_observers</span>(<span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span><span class='comma'>,</span> <span class='id identifier rubyid_old_value'>old_value</span><span class='comma'>,</span> <span class='id identifier rubyid_new_value'>new_value</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_handle_error'><a href="#handle_error-instance_method" title="Concurrent::Agent#handle_error (method)">handle_error</a></span>(<span class='const'><a href="Agent/ValidationError.html" title="Concurrent::Agent::ValidationError (class)">ValidationError</a></span>.<span class='id identifier rubyid_new'><a href="Agent/ValidationError.html#new-class_method" title="Concurrent::Agent::ValidationError.new (method)">new</a></span>)
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span>
  <span class='id identifier rubyid_handle_error'><a href="#handle_error-instance_method" title="Concurrent::Agent#handle_error (method)">handle_error</a></span>(<span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span>)
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@queue</span>.<span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_failed?'><a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">failed?</a></span> <span class='op'>||</span> <span class='ivar'>@queue</span>.<span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_ns_post_next_job'><a href="#ns_post_next_job-instance_method" title="Concurrent::Agent#ns_post_next_job (method)">ns_post_next_job</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_error-instance_method">
  <h3 class='signature priv'>
    #<strong>handle_error</strong>(error)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L576-L582'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='576' data-end='582'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 576</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_error'>handle_error</span>(<span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span>)
  <span class='comment'># stop new jobs from posting
</span>  <span class='ivar'>@error</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='op'>=</span> <span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span> <span class='kw'>if</span> <span class='ivar'>@error_mode</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fail'>fail</span>
  <span class='ivar'>@error_handler</span>.<span class='id identifier rubyid_call'>call</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span>)
<span class='kw'>rescue</span>
  <span class='comment'># do nothing
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ns_enqueue_job-instance_method">
  <h3 class='signature priv'>
    #<strong>ns_enqueue_job</strong>(job, index = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L529-L537'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='529' data-end='537'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 529</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ns_enqueue_job'>ns_enqueue_job</span>(<span class='id identifier rubyid_job'>job</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='comment'># a non-nil index means this is an await job
</span>  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_failed?'><a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">failed?</a></span>
  <span class='id identifier rubyid_index'>index</span> <span class='op'>||=</span> <span class='ivar'>@queue</span>.<span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@queue</span>.<span class='id identifier rubyid_insert'>insert</span>(<span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_job'>job</span>)
  <span class='comment'># if this is the only job, post to executor
</span>  <span class='id identifier rubyid_ns_post_next_job'><a href="#ns_post_next_job-instance_method" title="Concurrent::Agent#ns_post_next_job (method)">ns_post_next_job</a></span> <span class='kw'>if</span> <span class='ivar'>@queue</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ns_find_last_job_for_thread-instance_method">
  <h3 class='signature priv'>
    #<strong>ns_find_last_job_for_thread</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L584-L586'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='584' data-end='586'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 584</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ns_find_last_job_for_thread'>ns_find_last_job_for_thread</span>
  <span class='ivar'>@queue</span>.<span class='id identifier rubyid_rindex'>rindex</span> { <span class='op'>|</span><span class='id identifier rubyid_job'>job</span><span class='op'>|</span> <span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_caller'>caller</span> <span class='op'>==</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_object_id'>object_id</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ns_initialize-instance_method">
  <h3 class='signature priv'>
    #<strong>ns_initialize</strong>(initial, opts)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L490-L508'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='490' data-end='508'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 490</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ns_initialize'>ns_initialize</span>(<span class='id identifier rubyid_initial'>initial</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
  <span class='ivar'>@error_mode</span>    <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_error_mode'><a href="#error_mode-instance_method" title="Concurrent::Agent#error_mode (method)">error_mode</a></span>]
  <span class='ivar'>@error_handler</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_error_handler'>error_handler</span>]

  <span class='kw'>if</span> <span class='ivar'>@error_mode</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='const'><a href="#ERROR_MODES-constant" title="Concurrent::Agent::ERROR_MODES (constant)">ERROR_MODES</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='ivar'>@error_mode</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Concurrent::Agent.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unrecognized error mode</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>elsif</span> <span class='ivar'>@error_mode</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@error_mode</span> <span class='op'>=</span> <span class='ivar'>@error_handler</span> <span class='op'>?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_continue'>continue</span> <span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fail'>fail</span>
  <span class='kw'>end</span>

  <span class='ivar'>@error_handler</span> <span class='op'>||=</span> <span class='const'><a href="#DEFAULT_ERROR_HANDLER-constant" title="Concurrent::Agent::DEFAULT_ERROR_HANDLER (constant)">DEFAULT_ERROR_HANDLER</a></span>
  <span class='ivar'>@validator</span>     <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_validator'>validator</span><span class='comma'>,</span> <span class='const'><a href="#DEFAULT_VALIDATOR-constant" title="Concurrent::Agent::DEFAULT_VALIDATOR (constant)">DEFAULT_VALIDATOR</a></span>)
  <span class='ivar'>@current</span>       <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicReference.html" title="Concurrent::AtomicReference (class)">AtomicReference</a></span>.<span class='id identifier rubyid_new'><a href="AtomicReference.html#new-class_method" title="Concurrent::AtomicReference.new (method)">new</a></span>(<span class='id identifier rubyid_initial'>initial</span>)
  <span class='ivar'>@error</span>         <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="AtomicReference.html" title="Concurrent::AtomicReference (class)">AtomicReference</a></span>.<span class='id identifier rubyid_new'><a href="AtomicReference.html#new-class_method" title="Concurrent::AtomicReference.new (method)">new</a></span>(<span class='kw'>nil</span>)
  <span class='ivar'>@caller</span>        <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="ThreadLocalVar.html" title="Concurrent::ThreadLocalVar (class)">ThreadLocalVar</a></span>.<span class='id identifier rubyid_new'><a href="ThreadLocalVar.html#new-class_method" title="Concurrent::ThreadLocalVar.new (method)">new</a></span>(<span class='kw'>nil</span>)
  <span class='ivar'>@queue</span>         <span class='op'>=</span> []

  <span class='kw'>self</span>.<span class='id identifier rubyid_observers'>observers</span> <span class='op'>=</span> <span class='const'><a href="Collection.html" title="Concurrent::Collection (module)">Collection</a></span><span class='op'>::</span><span class='const'><a href="Collection/CopyOnNotifyObserverSet.html" title="Concurrent::Collection::CopyOnNotifyObserverSet (class)">CopyOnNotifyObserverSet</a></span>.<span class='id identifier rubyid_new'><a href="Collection/CopyOnNotifyObserverSet.html#new-class_method" title="Concurrent::Collection::CopyOnNotifyObserverSet.new (method)">new</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ns_post_next_job-instance_method">
  <h3 class='signature priv'>
    #<strong>ns_post_next_job</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L539-L541'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='539' data-end='541'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 539</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ns_post_next_job'>ns_post_next_job</span>
  <span class='ivar'>@queue</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>.<span class='id identifier rubyid_post'><a href="#post-instance_method" title="Concurrent::Agent#post (method)">post</a></span> { <span class='id identifier rubyid_execute_next_job'><a href="#execute_next_job-instance_method" title="Concurrent::Agent#execute_next_job (method)">execute_next_job</a></span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ns_validate-instance_method">
  <h3 class='signature priv'>
    #<strong>ns_validate</strong>(value)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L570-L574'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='570' data-end='574'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 570</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ns_validate'>ns_validate</span>(<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>)
  <span class='ivar'>@validator</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>)
<span class='kw'>rescue</span>
  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="post-instance_method">
  <h3 class='signature '>
    #<strong>post</strong>(*args, &amp;action)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L298-L298'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='298' data-end='298'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 298</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_post'>post</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_off'><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">send_off</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reason-instance_method">
  <h3 class='signature '>
    #<strong>reason</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#error-instance_method" title="Concurrent::Agent#error (method)">#error</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L244-L244'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='244' data-end='244'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 244</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reason'>reason</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_error'><a href="#error-instance_method" title="Concurrent::Agent#error (method)">error</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="restart-instance_method">
  <h3 class='signature '>
    #<strong>restart</strong>(new_value, opts = {})  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When an <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>, changes the <code>Agent</code> <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> to <code>new_value</code> then un-fails the <code>Agent</code> so that action dispatches are allowed again. If the <code>:clear_actions</code> option is give and true, any actions queued on the <code>Agent</code> that were being held while it was failed will be discarded, otherwise those held actions will proceed. The <code>new_value</code> must pass the validator if any, or <code>restart</code> will raise an exception and the <code>Agent</code> will remain failed with its old <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> and <a href="#error-instance_method" title="Concurrent::Agent#error (method)">#error</a>. Observers, if any, will not be notified of the new state.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>new_value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value for the <code>Agent</code> once restarted</p>
</div>
  </li>
  <li>
    <span class='name'>opts</span>
    <span class='type'>(<a href="Hash.html" title="Concurrent::Hash (class)">Hash</a>)</span>
    <em class='default'>(defaults to: <tt>{}</tt>)</em>
&mdash;    <div class='inline'>
<p>the configuration options</p>
</div>
  </li>
</ul>
    <p class='tag_title'>Options Hash (<tt>opts</tt>):</p>
    <ul class='option'>
        <li>
          <span class='name'>:clear_actions</span>
          <span class='type'>(<code>Symbol</code>)</span>
            &mdash; <div class='inline'>
<p>true if all enqueued but unprocessed actions should be discarded on restart, else false (default: false)</p>
</div>        </li>
    </ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>Concurrent:AgentError</code>)</span>
&mdash;    <div class='inline'>
<p>when not failed</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L424-L435'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='424' data-end='435'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 424</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_restart'>restart</span>(<span class='id identifier rubyid_new_value'>new_value</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_clear_actions'>clear_actions</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_clear_actions'>clear_actions</span><span class='comma'>,</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Error</a></span>.<span class='id identifier rubyid_new'><a href="Agent/Error.html#new-class_method" title="Concurrent::Agent::Error.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>agent is not failed</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_failed?'><a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">failed?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Agent/ValidationError.html" title="Concurrent::Agent::ValidationError (class)">ValidationError</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_ns_validate'><a href="#ns_validate-instance_method" title="Concurrent::Agent#ns_validate (method)">ns_validate</a></span>(<span class='id identifier rubyid_new_value'>new_value</span>)
    <span class='ivar'>@current</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span> <span class='op'>=</span> <span class='id identifier rubyid_new_value'>new_value</span>
    <span class='ivar'>@error</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a></span>   <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@queue</span>.<span class='id identifier rubyid_clear'>clear</span> <span class='kw'>if</span> <span class='id identifier rubyid_clear_actions'>clear_actions</span>
    <span class='id identifier rubyid_ns_post_next_job'><a href="#ns_post_next_job-instance_method" title="Concurrent::Agent#ns_post_next_job (method)">ns_post_next_job</a></span> <span class='kw'>unless</span> <span class='ivar'>@queue</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send-instance_method">
  <h3 class='signature '>
    #<strong>send</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Action dispatches are only allowed when the <code>Agent</code> is not <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

<p>The action must be a block/proc/lambda which takes 1 or more arguments. The first argument is the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code>. Any arguments passed to the send method via the <code>args</code> parameter will be passed to the action as the remaining arguments. The action must return the new value of the <code>Agent</code>.</p>
<ul><li>
<p><code>#send</code> and <a href="#send!-instance_method" title="Concurrent::Agent#send! (method)">#send!</a> should be used for actions that are CPU limited</p>
</li><li>
<p><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>, <a href="#send_off!-instance_method" title="Concurrent::Agent#send_off! (method)">#send_off!</a>, and <a href="#<<-instance_method" title="Concurrent::Agent#&lt;&lt; (method)">#&lt;&lt;</a> are appropriate for actions that may block on IO</p>
</li><li>
<p><a href="#send_via-instance_method" title="Concurrent::Agent#send_via (method)">#send_via</a> and <a href="#send_via!-instance_method" title="Concurrent::Agent#send_via! (method)">#send_via!</a> are used when a specific executor is to be used for the action</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to be passed to the action</p>
</div>
  </li>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>agent</code>, <a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a>, *<code>args</code>)</span>
&mdash;    <div class='inline'>
<p>process the old value and return the new</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code></p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to pass to the action</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value of the <code>Agent</code></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the action is successfully enqueued, false if the <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L278-L280'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='278' data-end='280'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 278</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send'>send</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_enqueue_action_job'><a href="#enqueue_action_job-instance_method" title="Concurrent::Agent#enqueue_action_job (method)">enqueue_action_job</a></span>(<span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_global_fast_executor'><a href="../Concurrent.html#global_fast_executor-class_method" title="Concurrent.global_fast_executor (method)">global_fast_executor</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send!-instance_method">
  <h3 class='signature '>
    #<strong>send!</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Action dispatches are only allowed when the <code>Agent</code> is not <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

<p>The action must be a block/proc/lambda which takes 1 or more arguments. The first argument is the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code>. Any arguments passed to the send method via the <code>args</code> parameter will be passed to the action as the remaining arguments. The action must return the new value of the <code>Agent</code>.</p>
<ul><li>
<p><a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> and <code>#send!</code> should be used for actions that are CPU limited</p>
</li><li>
<p><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>, <a href="#send_off!-instance_method" title="Concurrent::Agent#send_off! (method)">#send_off!</a>, and <a href="#<<-instance_method" title="Concurrent::Agent#&lt;&lt; (method)">#&lt;&lt;</a> are appropriate for actions that may block on IO</p>
</li><li>
<p><a href="#send_via-instance_method" title="Concurrent::Agent#send_via (method)">#send_via</a> and <a href="#send_via!-instance_method" title="Concurrent::Agent#send_via! (method)">#send_via!</a> are used when a specific executor is to be used for the action</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to be passed to the action</p>
</div>
  </li>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>agent</code>, <a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a>, *<code>args</code>)</span>
&mdash;    <div class='inline'>
<p>process the old value and return the new</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code></p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to pass to the action</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value of the <code>Agent</code></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the action is successfully enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Concurrent::Agent::Error</a>)</span>
&mdash;    <div class='inline'>
<p>if the <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L287-L290'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='287' data-end='290'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 287</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send!'>send!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Error</a></span>.<span class='id identifier rubyid_new'><a href="Agent/Error.html#new-class_method" title="Concurrent::Agent::Error.new (method)">new</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_send'><a href="#send-instance_method" title="Concurrent::Agent#send (method)">send</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_off-instance_method">
  <h3 class='signature '>
    #<strong>send_off</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; <code>Boolean</code> 
    <span class='aliases'>Also known as: <span class='names'>#post</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Action dispatches are only allowed when the <code>Agent</code> is not <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

<p>The action must be a block/proc/lambda which takes 1 or more arguments. The first argument is the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code>. Any arguments passed to the send method via the <code>args</code> parameter will be passed to the action as the remaining arguments. The action must return the new value of the <code>Agent</code>.</p>
<ul><li>
<p><a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> and <a href="#send!-instance_method" title="Concurrent::Agent#send! (method)">#send!</a> should be used for actions that are CPU limited</p>
</li><li>
<p><code>#send_off</code>, <a href="#send_off!-instance_method" title="Concurrent::Agent#send_off! (method)">#send_off!</a>, and <a href="#<<-instance_method" title="Concurrent::Agent#&lt;&lt; (method)">#&lt;&lt;</a> are appropriate for actions that may block on IO</p>
</li><li>
<p><a href="#send_via-instance_method" title="Concurrent::Agent#send_via (method)">#send_via</a> and <a href="#send_via!-instance_method" title="Concurrent::Agent#send_via! (method)">#send_via!</a> are used when a specific executor is to be used for the action</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to be passed to the action</p>
</div>
  </li>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>agent</code>, <a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a>, *<code>args</code>)</span>
&mdash;    <div class='inline'>
<p>process the old value and return the new</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code></p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to pass to the action</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value of the <code>Agent</code></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the action is successfully enqueued, false if the <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L294-L296'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='294' data-end='296'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 294</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_off'>send_off</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_enqueue_action_job'><a href="#enqueue_action_job-instance_method" title="Concurrent::Agent#enqueue_action_job (method)">enqueue_action_job</a></span>(<span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span>.<span class='id identifier rubyid_global_io_executor'><a href="../Concurrent.html#global_io_executor-class_method" title="Concurrent.global_io_executor (method)">global_io_executor</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_off!-instance_method">
  <h3 class='signature '>
    #<strong>send_off!</strong>(*args, &amp;action) {|agent, value, *args| ... } &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Action dispatches are only allowed when the <code>Agent</code> is not <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

<p>The action must be a block/proc/lambda which takes 1 or more arguments. The first argument is the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code>. Any arguments passed to the send method via the <code>args</code> parameter will be passed to the action as the remaining arguments. The action must return the new value of the <code>Agent</code>.</p>
<ul><li>
<p><a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> and <a href="#send!-instance_method" title="Concurrent::Agent#send! (method)">#send!</a> should be used for actions that are CPU limited</p>
</li><li>
<p><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>, <code>#send_off!</code>, and <a href="#<<-instance_method" title="Concurrent::Agent#&lt;&lt; (method)">#&lt;&lt;</a> are appropriate for actions that may block on IO</p>
</li><li>
<p><a href="#send_via-instance_method" title="Concurrent::Agent#send_via (method)">#send_via</a> and <a href="#send_via!-instance_method" title="Concurrent::Agent#send_via! (method)">#send_via!</a> are used when a specific executor is to be used for the action</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to be passed to the action</p>
</div>
  </li>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>agent</code>, <a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a>, *<code>args</code>)</span>
&mdash;    <div class='inline'>
<p>process the old value and return the new</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code></p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to pass to the action</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value of the <code>Agent</code></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the action is successfully enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Concurrent::Agent::Error</a>)</span>
&mdash;    <div class='inline'>
<p>if the <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L302-L305'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='302' data-end='305'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 302</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_off!'>send_off!</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Error</a></span>.<span class='id identifier rubyid_new'><a href="Agent/Error.html#new-class_method" title="Concurrent::Agent::Error.new (method)">new</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_send_off'><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">send_off</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_via-instance_method">
  <h3 class='signature '>
    #<strong>send_via</strong>(executor, *args, &amp;action) {|agent, value, *args| ... } &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Action dispatches are only allowed when the <code>Agent</code> is not <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

<p>The action must be a block/proc/lambda which takes 1 or more arguments. The first argument is the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code>. Any arguments passed to the send method via the <code>args</code> parameter will be passed to the action as the remaining arguments. The action must return the new value of the <code>Agent</code>.</p>
<ul><li>
<p><a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> and <a href="#send!-instance_method" title="Concurrent::Agent#send! (method)">#send!</a> should be used for actions that are CPU limited</p>
</li><li>
<p><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>, <a href="#send_off!-instance_method" title="Concurrent::Agent#send_off! (method)">#send_off!</a>, and <a href="#<<-instance_method" title="Concurrent::Agent#&lt;&lt; (method)">#&lt;&lt;</a> are appropriate for actions that may block on IO</p>
</li><li>
<p><code>#send_via</code> and <a href="#send_via!-instance_method" title="Concurrent::Agent#send_via! (method)">#send_via!</a> are used when a specific executor is to be used for the action</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to be passed to the action</p>
</div>
  </li>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
  <li>
    <span class='name'>executor</span>
    <span class='type'>(<a href="ExecutorService.html" title="Concurrent::ExecutorService (module)">Concurrent::ExecutorService</a>)</span>
&mdash;    <div class='inline'>
<p>the executor on which the action is to be dispatched</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>agent</code>, <a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a>, *<code>args</code>)</span>
&mdash;    <div class='inline'>
<p>process the old value and return the new</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code></p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to pass to the action</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value of the <code>Agent</code></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the action is successfully enqueued, false if the <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L311-L313'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='311' data-end='313'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 311</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_via'>send_via</span>(<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_enqueue_action_job'><a href="#enqueue_action_job-instance_method" title="Concurrent::Agent#enqueue_action_job (method)">enqueue_action_job</a></span>(<span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send_via!-instance_method">
  <h3 class='signature '>
    #<strong>send_via!</strong>(executor, *args, &amp;action) {|agent, value, *args| ... } &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dispatches an action to the <code>Agent</code> and returns immediately. Subsequently, in a thread from a thread pool, the <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> will be set to the return value of the action. Action dispatches are only allowed when the <code>Agent</code> is not <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a>.</p>

<p>The action must be a block/proc/lambda which takes 1 or more arguments. The first argument is the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code>. Any arguments passed to the send method via the <code>args</code> parameter will be passed to the action as the remaining arguments. The action must return the new value of the <code>Agent</code>.</p>
<ul><li>
<p><a href="#send-instance_method" title="Concurrent::Agent#send (method)">#send</a> and <a href="#send!-instance_method" title="Concurrent::Agent#send! (method)">#send!</a> should be used for actions that are CPU limited</p>
</li><li>
<p><a href="#send_off-instance_method" title="Concurrent::Agent#send_off (method)">#send_off</a>, <a href="#send_off!-instance_method" title="Concurrent::Agent#send_off! (method)">#send_off!</a>, and <a href="#<<-instance_method" title="Concurrent::Agent#&lt;&lt; (method)">#&lt;&lt;</a> are appropriate for actions that may block on IO</p>
</li><li>
<p><a href="#send_via-instance_method" title="Concurrent::Agent#send_via (method)">#send_via</a> and <code>#send_via!</code> are used when a specific executor is to be used for the action</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to be passed to the action</p>
</div>
  </li>
  <li>
    <span class='name'>action</span>
    <span class='type'>(<code>Proc</code>)</span>
&mdash;    <div class='inline'>
<p>the action dispatch to be enqueued</p>
</div>
  </li>
  <li>
    <span class='name'>executor</span>
    <span class='type'>(<a href="ExecutorService.html" title="Concurrent::ExecutorService (module)">Concurrent::ExecutorService</a>)</span>
&mdash;    <div class='inline'>
<p>the executor on which the action is to be dispatched</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>agent</code>, <a href="#value-instance_method" title="Concurrent::Agent#value (method)">value</a>, *<code>args</code>)</span>
&mdash;    <div class='inline'>
<p>process the old value and return the new</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Parameters:</p>
<ul class='yieldparam'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current <a href="#value-instance_method" title="Concurrent::Agent#value (method)">#value</a> of the <code>Agent</code></p>
</div>
  </li>
  <li>
    <span class='name'>args</span>
    <span class='type'>(<a href="Array.html" title="Concurrent::Array (class)">Array</a>&lt;<a href="../Object.html" title="Object (class)">Object</a>&gt;)</span>
&mdash;    <div class='inline'>
<p>zero or more arguments to pass to the action</p>
</div>
  </li>
</ul>
<p class='tag_title'>Yield Returns:</p>
<ul class='yieldreturn'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the new value of the <code>Agent</code></p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if the action is successfully enqueued</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Concurrent::Agent::Error</a>)</span>
&mdash;    <div class='inline'>
<p>if the <code>Agent</code> is <a href="#failed%3F-instance_method" title="Concurrent::Agent#failed? (method)">#failed?</a></p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L319-L322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='319' data-end='322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 319</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send_via!'>send_via!</span>(<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Agent/Error.html" title="Concurrent::Agent::Error (class)">Error</a></span>.<span class='id identifier rubyid_new'><a href="Agent/Error.html#new-class_method" title="Concurrent::Agent::Error.new (method)">new</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_send_via'><a href="#send_via-instance_method" title="Concurrent::Agent#send_via (method)">send_via</a></span>(<span class='id identifier rubyid_executor'><a href="../Concurrent.html#executor-class_method" title="Concurrent.executor (method)">executor</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_action'>action</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="value-instance_method">
  <h3 class='signature '>
    #<strong>value</strong>  &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> 
    <span class='aliases'>Also known as: <span class='names'>#deref</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The current value (state) of the <code>Agent</code>, irrespective of any pending or in-progress actions. The value is always available and is non-blocking.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<a href="../Object.html" title="Object (class)">Object</a>)</span>
&mdash;    <div class='inline'>
<p>the current value</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L229-L231'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='229' data-end='231'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 229</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_value'>value</span>
  <span class='ivar'>@current</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'># TODO (pitr 12-Sep-2015): broken unsafe read?
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="wait-instance_method">
  <h3 class='signature '>
    #<strong>wait</strong>(timeout = nil)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current thread until all actions dispatched thus far, from this thread or nested by the <code>Agent</code>, have occurred, or the timeout (in seconds) has elapsed. Will block indefinitely when timeout is nil or not given.</p>

<p>Provided mainly for consistency with other classes in this library. Prefer the various <a href="#await-class_method" title="Concurrent::Agent.await (method)">.await</a> methods instead.</p>

<p><strong>NOTE</strong> Never, *under any circumstances*, call any of the “await” methods (<a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a>, <a href="#await_for-instance_method" title="Concurrent::Agent#await_for (method)">#await_for</a>, <a href="#await_for!-instance_method" title="Concurrent::Agent#await_for! (method)">#await_for!</a>, and <code>#wait</code>) from within an action block/proc/lambda. The call will block the <code>Agent</code> and will always fail. Calling either <a href="#await-instance_method" title="Concurrent::Agent#await (method)">#await</a> or <code>#wait</code> (with a timeout of <code>nil</code>) will hopelessly deadlock the <code>Agent</code> with no possibility of recovery.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>timeout</span>
    <span class='type'>(<code>Float</code>)</span>
    <em class='default'>(defaults to: <tt>nil</tt>)</em>
&mdash;    <div class='inline'>
<p>the maximum number of seconds to wait</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Boolean</code>)</span>
&mdash;    <div class='inline'>
<p>true if all actions complete before timeout else false</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby-concurrency/concurrent-ruby/blob/master/lib/concurrent-ruby/concurrent/agent.rb#L393-L397'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='393' data-end='397'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/concurrent-ruby/concurrent/agent.rb', line 393</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_wait'>wait</span>(<span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_latch'>latch</span> <span class='op'>=</span> <span class='const'><a href="../Concurrent.html" title="Concurrent (module)">Concurrent</a></span><span class='op'>::</span><span class='const'><a href="CountDownLatch.html" title="Concurrent::CountDownLatch (class)">CountDownLatch</a></span>.<span class='id identifier rubyid_new'><a href="CountDownLatch.html#new-class_method" title="Concurrent::CountDownLatch.new (method)">new</a></span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_enqueue_await_job'><a href="#enqueue_await_job-instance_method" title="Concurrent::Agent#enqueue_await_job (method)">enqueue_await_job</a></span>(<span class='id identifier rubyid_latch'>latch</span>)
  <span class='id identifier rubyid_latch'>latch</span>.<span class='id identifier rubyid_wait'>wait</span>(<span class='id identifier rubyid_timeout'>timeout</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>