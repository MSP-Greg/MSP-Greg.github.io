<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: RubyInstaller::Build::Utils &mdash; RubyInstaller2 master</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyInstaller::Build::Utils",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>RubyInstaller2 master</a> &raquo; 
      <a href='../../_index.html#alpha_U'>Index (U)</a> &raquo; 
        <a href="../../RubyInstaller.html" title="RubyInstaller (module)">RubyInstaller</a> &raquo; 
        <a href="../Build.html" title="RubyInstaller::Build (module)">Build</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Utils&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: RubyInstaller::Build::Utils</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="ErbCompiler.html" title="RubyInstaller::Build::ErbCompiler (class)"><code>ErbCompiler</code></a>,
          <a href="Task.html" title="RubyInstaller::Build::Task (class)"><code>Task</code></a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L3'>lib/ruby_installer/build/utils.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='GEM_ROOT-constant' class='summary_signature'>GEM_ROOT =</span>
    <br/>
    <a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L42-L42'># File 'lib/ruby_installer/build/utils.rb', line 42</a>    <pre class='code ruby'><span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>../../../..</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>__FILE__</span>)</pre>
  </li>
  <li>
    <span id='WINDOWS_CMD_SHEBANG-constant' class='summary_signature'>WINDOWS_CMD_SHEBANG =</span>
    <br/>
    <a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L4-L13'># File 'lib/ruby_installer/build/utils.rb', line 4</a>    <pre class='code ruby'><span class='heredoc_beg'>&lt;&lt;-EOT</span>.<span class='id identifier rubyid_freeze'>freeze</span>
<span class='tstring_content'>:&quot;&quot;||{ &quot;&quot;=&gt; %q&lt;-*- ruby -*-
@&quot;%~dp0ruby&quot; -x &quot;%~f0&quot; %*
@exit /b %ERRORLEVEL%
};{ #
bindir=&quot;${0%/*}&quot; #
exec &quot;$bindir/ruby&quot; -x &quot;$0&quot; &quot;$@&quot; #
&gt;, #
} #
</span><span class='heredoc_end'>EOT</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#eval_file-instance_method" title="#eval_file (instance method)">#<strong>eval_file</strong>(filename)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#file-instance_method" title="#file (instance method)">#<strong>file</strong>(name, *args, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Extend rake’s file task to be defined only once and to check the expected file is indeed generated.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#msys_sh-instance_method" title="#msys_sh (instance method)">#<strong>msys_sh</strong>(cmd)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#ovl_expand_file-instance_method" title="#ovl_expand_file (instance method)">#<strong>ovl_expand_file</strong>(rel_file)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the absolute path of <code>rel_file</code> within the current directory or, if it doesn’t exist, from the gem root directory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#ovl_glob-instance_method" title="#ovl_glob (instance method)">#<strong>ovl_glob</strong>(rel_pattern)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Scan the current and the gem root directory for files matching <code>rel_pattern</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#ovl_read_file-instance_method" title="#ovl_read_file (instance method)">#<strong>ovl_read_file</strong>(rel_file)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Read <code>rel_file</code> from the current directory or, if it doesn’t exist, from the gem root directory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#q_inno-instance_method" title="#q_inno (instance method)">#<strong>q_inno</strong>(text)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Quote a string according to the rules of Inno-Setup.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#rubyinstaller_build_gem_files-instance_method" title="#rubyinstaller_build_gem_files (instance method)">#<strong>rubyinstaller_build_gem_files</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the gem files of “rubyinstaller-build”.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#task-instance_method" title="#task (instance method)">#<strong>task</strong>(name, *args, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Extend rake’s task definition to be defined only once, even if called several times.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_env-instance_method" title="#with_env (instance method)">#<strong>with_env</strong>(hash)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_sandbox_ruby-instance_method" title="#with_sandbox_ruby (instance method)">#<strong>with_sandbox_ruby</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#task_once-instance_method" title="#task_once (instance method)">#<strong>task_once</strong>(name, block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="eval_file-instance_method">
  <h3 class='signature  first'>
    #<strong>eval_file</strong>(filename)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L86-L89'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='86' data-end='89'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 86</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_eval_file'>eval_file</span>(<span class='id identifier rubyid_filename'>filename</span>)
  <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='label'>encoding:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_instance_eval'>instance_eval</span>(<span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="file-instance_method">
  <h3 class='signature '>
    #<strong>file</strong>(name, *args, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Extend rake’s file task to be defined only once and to check the expected file is indeed generated</p>

<p>The same as #task, but for #file. In addition this file task raises an error, if the file that is expected to be generated is not present after the block was executed.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L108-L116'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='108' data-end='116'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 108</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_file'>file</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_task_once'><a href="#task_once-instance_method" title="RubyInstaller::Build::Utils#task_once (method)">task_once</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span>) <span class='kw'>do</span>
    <span class='kw'>super</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ta'>ta</span><span class='op'>|</span>
      <span class='id identifier rubyid_block'>block</span><span class='op'>&amp;.</span><span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_ta'>ta</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ta'>ta</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> is missing after task executed</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_ta'>ta</span>.<span class='id identifier rubyid_name'>name</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="msys_sh-instance_method">
  <h3 class='signature '>
    #<strong>msys_sh</strong>(cmd)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L15-L19'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='15' data-end='19'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 15</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_msys_sh'>msys_sh</span>(<span class='id identifier rubyid_cmd'>cmd</span>)
  <span class='const'><a href="../Build.html" title="RubyInstaller::Build (module)">Build</a></span>.<span class='id identifier rubyid_enable_msys_apps'><a href="../Build.html#enable_msys_apps-class_method" title="RubyInstaller::Build.enable_msys_apps (method)">enable_msys_apps</a></span>
  <span class='id identifier rubyid_pwd'>pwd</span> <span class='op'>=</span> <span class='const'>Dir</span>.<span class='id identifier rubyid_pwd'>pwd</span>
  <span class='id identifier rubyid_sh'>sh</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sh</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-lc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cd `cygpath -u </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pwd'>pwd</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>`; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ovl_expand_file-instance_method">
  <h3 class='signature '>
    #<strong>ovl_expand_file</strong>(rel_file)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the absolute path of <code>rel_file</code> within the current directory or, if it doesn’t exist, from the gem root directory.</p>

<p>Raises Errno::ENOENT if neither of them exist.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L76-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='76' data-end='84'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 76</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ovl_expand_file'>ovl_expand_file</span>(<span class='id identifier rubyid_rel_file'>rel_file</span>)
  <span class='kw'>if</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_rel_file'>rel_file</span>)
    <span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span>(<span class='id identifier rubyid_rel_file'>rel_file</span>)
  <span class='kw'>elsif</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_a'>a</span><span class='op'>=</span><span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='const'><a href="#GEM_ROOT-constant" title="RubyInstaller::Build::Utils::GEM_ROOT (constant)">GEM_ROOT</a></span><span class='comma'>,</span> <span class='id identifier rubyid_rel_file'>rel_file</span>))
    <span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span>(<span class='id identifier rubyid_a'>a</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span><span class='comma'>,</span> <span class='id identifier rubyid_rel_file'>rel_file</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ovl_glob-instance_method">
  <h3 class='signature '>
    #<strong>ovl_glob</strong>(rel_pattern)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Scan the current and the gem root directory for files matching <code>rel_pattern</code>.</p>

<p>All paths returned are relative.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L64-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='64' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 64</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ovl_glob'>ovl_glob</span>(<span class='id identifier rubyid_rel_pattern'>rel_pattern</span>)
  <span class='id identifier rubyid_gem_files'>gem_files</span> <span class='op'>=</span> <span class='const'>Dir</span>.<span class='id identifier rubyid_glob'>glob</span>(<span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='const'><a href="#GEM_ROOT-constant" title="RubyInstaller::Build::Utils::GEM_ROOT (constant)">GEM_ROOT</a></span><span class='comma'>,</span> <span class='id identifier rubyid_rel_pattern'>rel_pattern</span>)).<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'>path</span><span class='op'>|</span>
    <span class='id identifier rubyid_path'>path</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='const'><a href="#GEM_ROOT-constant" title="RubyInstaller::Build::Utils::GEM_ROOT (constant)">GEM_ROOT</a></span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>

  (<span class='id identifier rubyid_gem_files'>gem_files</span> <span class='op'>+</span> <span class='const'>Dir</span>.<span class='id identifier rubyid_glob'>glob</span>(<span class='id identifier rubyid_rel_pattern'>rel_pattern</span>)).<span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ovl_read_file-instance_method">
  <h3 class='signature '>
    #<strong>ovl_read_file</strong>(rel_file)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Read <code>rel_file</code> from the current directory or, if it doesn’t exist, from the gem root directory. Raises Errno::ENOENT if neither of them exist.</p>

<p>Returns the file content as String with UTF-8 encoding.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L95-L97'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='95' data-end='97'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 95</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ovl_read_file'>ovl_read_file</span>(<span class='id identifier rubyid_rel_file'>rel_file</span>)
  <span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='id identifier rubyid_ovl_expand_file'><a href="#ovl_expand_file-instance_method" title="RubyInstaller::Build::Utils#ovl_expand_file (method)">ovl_expand_file</a></span>(<span class='id identifier rubyid_rel_file'>rel_file</span>)<span class='comma'>,</span> <span class='label'>encoding:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="q_inno-instance_method">
  <h3 class='signature '>
    #<strong>q_inno</strong>(text)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Quote a string according to the rules of Inno-Setup</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L100-L102'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='100' data-end='102'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 100</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_q_inno'>q_inno</span>(<span class='id identifier rubyid_text'>text</span>)
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_text'>text</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_gsub'>gsub</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;&quot;</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="rubyinstaller_build_gem_files-instance_method">
  <h3 class='signature '>
    #<strong>rubyinstaller_build_gem_files</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the gem files of “rubyinstaller-build”</p>

<p>The gemspec is either already loaded or taken from our root directory.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L47-L59'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='47' data-end='59'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 47</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rubyinstaller_build_gem_files'>rubyinstaller_build_gem_files</span>
  <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> <span class='const'>Gem</span>.<span class='id identifier rubyid_loaded_specs'>loaded_specs</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rubyinstaller-build</span><span class='tstring_end'>&quot;</span></span>]
  <span class='kw'>if</span> <span class='id identifier rubyid_spec'>spec</span>
    <span class='comment'># A loaded gemspec has empty #files -&gt; fetch the files from its path.
</span>    <span class='comment'># This is preferred to gemspec loading to avoid a dependency to git.
</span>    <span class='const'>Dir</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>**/*</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>base:</span> <span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_full_gem_path'>full_gem_path</span>].<span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
      <span class='const'>FileTest</span>.<span class='id identifier rubyid_file?'>file?</span>(<span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_full_gem_path'>full_gem_path</span><span class='comma'>,</span> <span class='id identifier rubyid_f'>f</span>))
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Not yet loaded -&gt; load the gemspec and return the files added to the gemspec.
</span>    <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Specification</span>.<span class='id identifier rubyid_load'>load</span>(<span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='const'><a href="#GEM_ROOT-constant" title="RubyInstaller::Build::Utils::GEM_ROOT (constant)">GEM_ROOT</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rubyinstaller-build.gemspec</span><span class='tstring_end'>&quot;</span></span>)).<span class='id identifier rubyid_files'>files</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="task-instance_method">
  <h3 class='signature '>
    #<strong>task</strong>(name, *args, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Extend rake’s task definition to be defined only once, even if called several times</p>

<p>This allows to define common tasks next to specific tasks. It is expected that any variation of the task’s block is reflected in the task name or namespace. If the task name is identical, the task block is executed only once, even if the file task definition is executed twice.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L123-L127'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='123' data-end='127'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 123</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_task'>task</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_task_once'><a href="#task_once-instance_method" title="RubyInstaller::Build::Utils#task_once (method)">task_once</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span>) <span class='kw'>do</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="task_once-instance_method">
  <h3 class='signature priv'>
    #<strong>task_once</strong>(name, block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L129-L144'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='129' data-end='144'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 129</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_task_once'>task_once</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_first'>first</span> <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Hash</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span> <span class='op'>&amp;&amp;</span>
      <span class='const'>Rake</span><span class='op'>::</span><span class='const'><a href="Task.html" title="RubyInstaller::Build::Task (class)">Task</a></span>.<span class='id identifier rubyid_task_defined?'>task_defined?</span>(<span class='id identifier rubyid_name'>name</span>) <span class='op'>&amp;&amp;</span>
      <span class='const'>Rake</span><span class='op'>::</span><span class='const'><a href="Task.html" title="RubyInstaller::Build::Task (class)">Task</a></span>[<span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@task_block_location</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>==</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_source_location'>source_location</span>
    <span class='comment'># task is already defined for this target and the same block
</span>    <span class='comment'># So skip double definition of the same action
</span>    <span class='const'>Rake</span><span class='op'>::</span><span class='const'><a href="Task.html" title="RubyInstaller::Build::Task (class)">Task</a></span>[<span class='id identifier rubyid_name'>name</span>]
  <span class='kw'>elsif</span> <span class='id identifier rubyid_block'>block</span>
    <span class='kw'>yield</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span>
      <span class='const'>Rake</span><span class='op'>::</span><span class='const'><a href="Task.html" title="RubyInstaller::Build::Task (class)">Task</a></span>[<span class='id identifier rubyid_name'>name</span>].<span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>@task_block_location</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span>.<span class='id identifier rubyid_source_location'>source_location</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_env-instance_method">
  <h3 class='signature '>
    #<strong>with_env</strong>(hash)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L21-L33'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='33'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_env'>with_env</span>(<span class='id identifier rubyid_hash'>hash</span>)
  <span class='id identifier rubyid_olds'>olds</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_map'>map</span>{<span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> [<span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='const'>ENV</span>[<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span>]] }
  <span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='const'>ENV</span>[<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
  <span class='kw'>end</span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_olds'>olds</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='const'>ENV</span>[<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_sandbox_ruby-instance_method">
  <h3 class='signature '>
    #<strong>with_sandbox_ruby</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/oneclick/rubyinstaller2/blob/master/lib/ruby_installer/build/utils.rb#L35-L40'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='35' data-end='40'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_installer/build/utils.rb', line 35</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_sandbox_ruby'>with_sandbox_ruby</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span> <span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span>(<span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='id identifier rubyid_sandboxdir'>sandboxdir</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bin</span><span class='tstring_end'>&quot;</span></span>)) <span class='embexpr_end'>}</span><span class='tstring_content'>;</span><span class='embexpr_beg'>#{</span> <span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PATH</span><span class='tstring_end'>&quot;</span></span>] <span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_with_env'><a href="#with_env-instance_method" title="RubyInstaller::Build::Utils#with_env (method)">with_env</a></span>(<span class='label'>GEM_HOME:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>GEM_PATH:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>RUBYOPT:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>RUBYLIB:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>PATH:</span> <span class='id identifier rubyid_path'>path</span>) <span class='kw'>do</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>