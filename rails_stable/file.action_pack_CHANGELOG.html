<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Action Pack CHANGELOG &mdash; Rails 7-1-stable</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "action_pack_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 7-1-stable</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Action Pack CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<ul>
<li><p>Fix <a href="ActionDispatch/Executor.html" title="ActionDispatch::Executor (class)"><code>::ActionDispatch::Executor</code></a> middleware to report errors handled by <a href="ActionDispatch/ShowExceptions.html" title="ActionDispatch::ShowExceptions (class)"><code>::ActionDispatch::ShowExceptions</code></a></p>

<p>In the default production environment, <code>ShowExceptions</code> rescue uncaught errors
and returns a response. Because if this the executor wouldn&#39;t report production
errors with the default Rails configuration.</p>

<p><em>Jean Boussier</em></p></li>
</ul>

<h2>Rails 7.1.3.2 (February 21, 2024)</h2>

<ul>
<li><p>Fix <code>raise_on_missing_translations</code> not working correctly with the
<code>translate</code> method in controllers after the patch for CVE-2024-26143.</p>

<p><em>John Hawthorn</em></p></li>
</ul>

<h2>Rails 7.1.3.1 (February 21, 2024)</h2>

<ul>
<li><p>Fix possible XSS vulnerability with the <code>translate</code> method in controllers</p>

<p>CVE-2024-26143</p>

<p><em>ooooooo-q + Aaron Patterson</em></p></li>
<li><p>Fix ReDoS in Accept header parsing</p>

<p>CVE-2024-26142</p>

<p><em>Aaron Patterson</em></p></li>
</ul>

<h2>Rails 7.1.3 (January 16, 2024)</h2>

<ul>
<li><p>Fix including <code>Rails.application.routes.url_helpers</code> directly in an
<code>ActiveSupport::Concern.</code></p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Fix system tests when using a Chrome binary that has been downloaded by
Selenium.</p>

<p><em>Jonathan Hefner</em></p></li>
</ul>

<h2>Rails 7.1.2 (November 10, 2023)</h2>

<ul>
<li><p>Fix a race condition that could cause a <code>Text file busy - chromedriver</code>
error with parallel system tests</p>

<p><em>Matt Brictson</em></p></li>
<li><p>Fix <code>StrongParameters#extract_value</code> to include blank values</p>

<p>Otherwise composite parameters may not be parsed correctly when one of the
component is blank.</p>

<p><em>fatkodima</em>, <em>Yasha Krasnou</em>, <em>Matthias Eiglsperger</em></p></li>
<li><p>Add <code>racc</code> as a dependency since it will become a bundled gem in Ruby 3.4.0</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Support handling Enumerator for non-buffered responses.</p>

<p><em>Zachary Scott</em></p></li>
</ul>

<h2>Rails 7.1.1 (October 11, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 7.1.0 (October 05, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 7.1.0.rc2 (October 01, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 7.1.0.rc1 (September 27, 2023)</h2>

<ul>
<li><p>Add support for <code>#deep_merge</code> and <code>#deep_merge!</code> to
<a href="ActionController/Parameters.html" title="ActionController::Parameters (class)"><code>::ActionController::Parameters</code></a>.</p>

<p><em>Sean Doyle</em></p></li>
</ul>

<h2>Rails 7.1.0.beta1 (September 13, 2023)</h2>

<ul>
<li><p><code>AbstractController::Translation.raise_on_missing_translations</code> removed</p>

<p>This was a private API, and has been removed in favour of a more broadly applicable
<code>config.i18n.raise_on_missing_translations</code>. See the upgrading guide for more information.</p>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Add <a href="ActionController/Parameters.html#extract_value-instance_method" title="ActionController::Parameters#extract_value (method)">ActionController::Parameters#extract_value</a> method to allow extracting serialized values from params</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Parameters.html" title="ActionController::Parameters (class)">Parameters</a></span>.<span class='id identifier rubyid_new'><a href="ActionController/Parameters.html#new-class_method" title="ActionController::Parameters.new (method)">new</a></span>(<span class='label'>id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1_123</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>tags:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ruby,rails</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_extract_value'>extract_value</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>) <span class='comment'># =&gt; [&quot;1&quot;, &quot;123&quot;]
</span><span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_extract_value'>extract_value</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_tags'>tags</span><span class='comma'>,</span> <span class='label'>delimiter:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; [&quot;ruby&quot;, &quot;rails&quot;]</span></code></pre>

<p><em>Nikita Vasilevsky</em></p></li>
<li><p>Parse JSON <code>response.parsed_body</code> with <a href="ActiveSupport/HashWithIndifferentAccess.html" title="ActiveSupport::HashWithIndifferentAccess (class)"><code>::ActiveSupport::HashWithIndifferentAccess</code></a></p>

<p>Integrate with Minitest&#39;s new <code>assert_pattern</code> by parsing the JSON contents
of <code>response.parsed_body</code> with <a href="ActiveSupport/HashWithIndifferentAccess.html" title="ActiveSupport::HashWithIndifferentAccess (class)"><code>::ActiveSupport::HashWithIndifferentAccess</code></a>, so
that it&#39;s pattern-matching compatible.</p>

<p><em>Sean Doyle</em></p></li>
<li><p>Add support for Playwright as a driver for system tests.</p>

<p><em>Yuki Nishijima</em></p></li>
<li><p>Fix <code>HostAuthorization</code> potentially displaying the value of the
X_FORWARDED_HOST header when the HTTP_HOST header is being blocked.</p>

<p><em>Hartley McGuire</em>, <em>Daniel Schlosser</em></p></li>
<li><p>Rename <code>fixture_file_upload</code> method to <code>file_fixture_upload</code></p>

<p>Declare an alias to preserve the backwards compatibility of <code>fixture_file_upload</code></p>

<p><em>Sean Doyle</em></p></li>
<li><p><a href="ActionDispatch/SystemTesting/TestHelpers/ScreenshotHelper.html" title="ActionDispatch::SystemTesting::TestHelpers::ScreenshotHelper (module)"><code>::ActionDispatch::SystemTesting::TestHelpers::ScreenshotHelper</code></a> saves the screenshot path in test metadata on failure.</p>

<p><em>Matija Čupić</em></p></li>
<li><p><code>config.dom_testing_default_html_version</code> controls the HTML parser used by
<a href="ActionDispatch/Assertions.html#html_document-instance_method" title="ActionDispatch::Assertions#html_document (method)">ActionDispatch::Assertions#html_document</a>.</p>

<p>The Rails 7.1 default configuration opts into the HTML5 parser when it is supported, to better
represent what the DOM would be in a browser user agent. Previously this test helper always used
Nokogiri&#39;s HTML4 parser.</p>

<p><em>Mike Dalessio</em></p></li>
<li><p>Ensure an uncaught exception when rendering a Turbo Frame properly breaks
out of the Frame and shows the <code>DebugView</code> error page in development.</p>

<p><em>Joé Dupuis</em></p></li>
<li><p>The <code>with_routing</code> helper can now be called at the class level. When called at the class level, the routes will
be setup before each test, and reset after every test. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>RoutingTest</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/TestCase.html" title="ActionController::TestCase (class)">TestCase</a></span>
  <span class='id identifier rubyid_with_routing'>with_routing</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_routes'>routes</span><span class='op'>|</span>
    <span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_articles'>articles</span>
      <span class='id identifier rubyid_resources'>resources</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authors'>authors</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_articles_route'>test_articles_route</span>
    <span class='id identifier rubyid_assert_routing'>assert_routing</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/articles</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>articles</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>

   <span class='kw'>def</span> <span class='id identifier rubyid_test_authors_route'>test_authors_route</span>
    <span class='id identifier rubyid_assert_routing'>assert_routing</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/authors</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>controller:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>authors</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Andrew Novoselac</em></p></li>
<li><p>The <a href="Mime/Type.html" title="Mime::Type (class)"><code>::Mime::Type</code></a> now supports handling types with parameters and correctly handles quotes.
When parsing the accept header, the parameters before the q-parameter are kept and if a matching mime-type exists it is used.
To keep the current functionality, a fallback is created to look for the media-type without the parameters.</p>

<p>This change allows for custom MIME-types that are more complex like <code>application/vnd.api+json; profile=&quot;https://jsonapi.org/profiles/ethanresnick/cursor-pagination/&quot; ext=&quot;https://jsonapi.org/ext/atomic&quot;</code> for the <a href="https://jsonapi.org/">JSON API</a>.</p>

<p><em>Nicolas Erni</em></p></li>
<li><p>The url_for helpers now support a new option called <code>path_params</code>.
This is very useful in situations where you only want to add a required param that is part of the route&#39;s URL but for other route not append an extraneous query param.</p>

<p>Given the following router...</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_routes'>routes</span>.<span class='id identifier rubyid_draw'>draw</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_scope'>scope</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:account_id</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dashboard</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pages#dashboard</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>as:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dashboard'>dashboard</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>search/:term</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>search#search</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>as:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_search'>search</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>signout</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sessions#destroy</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>as:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_signout'>signout</span>
<span class='kw'>end</span></code></pre>

<p>And given the following <code>ApplicationController</code></p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_default_url_options'>default_url_options</span>
    { <span class='label'>path_params:</span> { <span class='label'>account_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> } }
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The standard url_for helper and friends will now behave as follows:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_dashboard_path'>dashboard_path</span> <span class='comment'># =&gt; /foo/dashboard
</span><span class='id identifier rubyid_dashboard_path'>dashboard_path</span>(<span class='label'>account_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; /bar/dashboard
</span>
<span class='id identifier rubyid_signout_path'>signout_path</span> <span class='comment'># =&gt; /signout
</span><span class='id identifier rubyid_signout_path'>signout_path</span>(<span class='label'>account_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; /signout?account_id=bar
</span><span class='id identifier rubyid_signout_path'>signout_path</span>(<span class='label'>account_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>path_params:</span> { <span class='label'>account_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span> }) <span class='comment'># =&gt; /signout?account_id=bar
</span><span class='id identifier rubyid_search_path'>search_path</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>quin</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; /foo/search/quin</span></code></pre>

<p><em>Jason Meller, Jeremy Beker</em></p></li>
<li><p>Change <code>action_dispatch.show_exceptions</code> to one of <code>:all</code>, <code>:rescuable</code>, or
<code>:none</code>. <code>:all</code> and <code>:none</code> behave the same as the previous <code>true</code> and
<code>false</code> respectively. The new <code>:rescuable</code> option will only show exceptions
that can be rescued (e.g. <a href="ActiveRecord/RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>::ActiveRecord::RecordNotFound</code></a>). <code>:rescuable</code> is
now the default for the test environment.</p>

<p><em>Jon Dufresne</em></p></li>
<li><p><code>config.action_dispatch.cookies_serializer</code> now accepts <code>:message_pack</code> and
<code>:message_pack_allow_marshal</code> as serializers. These serializers require the
<a href="https://rubygems.org/gems/msgpack"><code>msgpack</code> gem</a> (&gt;= 1.7.0).</p>

<p>The Message Pack format can provide improved performance and smaller payload
sizes. It also supports roundtripping some Ruby types that are not supported
by JSON. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cookies'>cookies</span>.<span class='id identifier rubyid_encrypted'>encrypted</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>] <span class='op'>=</span> [{ <span class='label'>a:</span> <span class='int'>1</span> }<span class='comma'>,</span> { <span class='label'>b:</span> <span class='int'>2</span> }.<span class='id identifier rubyid_with_indifferent_access'>with_indifferent_access</span><span class='comma'>,</span> <span class='int'>1</span>.<span class='id identifier rubyid_to_d'>to_d</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_at'>at</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='int'>123</span>)]

<span class='comment'># BEFORE with config.action_dispatch.cookies_serializer = :json
</span><span class='id identifier rubyid_cookies'>cookies</span>.<span class='id identifier rubyid_encrypted'>encrypted</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>]
<span class='comment'># =&gt; [{&quot;a&quot;=&gt;1}, {&quot;b&quot;=&gt;2}, &quot;1.0&quot;, &quot;1969-12-31T18:00:00.000-06:00&quot;]
</span><span class='id identifier rubyid_cookies'>cookies</span>.<span class='id identifier rubyid_encrypted'>encrypted</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>].<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='kw'>class</span>)
<span class='comment'># =&gt; [Hash, Hash, String, String]
</span>
<span class='comment'># AFTER with config.action_dispatch.cookies_serializer = :message_pack
</span><span class='id identifier rubyid_cookies'>cookies</span>.<span class='id identifier rubyid_encrypted'>encrypted</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>]
<span class='comment'># =&gt; [{:a=&gt;1}, {&quot;b&quot;=&gt;2}, 0.1e1, 1969-12-31 18:00:00.000123 -0600]
</span><span class='id identifier rubyid_cookies'>cookies</span>.<span class='id identifier rubyid_encrypted'>encrypted</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>].<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='kw'>class</span>)
<span class='comment'># =&gt; [Hash, ActiveSupport::HashWithIndifferentAccess, BigDecimal, Time]</span></code></pre>

<p>The <code>:message_pack</code> serializer can fall back to deserializing with
<a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a> when necessary, and the <code>:message_pack_allow_marshal</code>
serializer can fall back to deserializing with <code>Marshal</code> as well as
<a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a>. Additionally, the <code>:marshal</code>, <code>:json</code>, and
<code>:json_allow_marshal</code> (AKA <code>:hybrid</code>) serializers can now fall back to
deserializing with <a href="ActiveSupport/MessagePack.html" title="ActiveSupport::MessagePack (module)"><code>::ActiveSupport::MessagePack</code></a> when necessary. These
behaviors ensure old cookies can still be read so that migration is easier.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Remove leading dot from domains on cookies set with <code>domain: :all</code>, to meet RFC6265 requirements</p>

<p><em>Gareth Adams</em></p></li>
<li><p>Include source location in routes extended view.</p>

<pre class="code bash"><code class="bash">$ bin/rails routes --expanded

...
--[ Route 14 ]----------
Prefix            | new_gist
Verb              | GET
URI               | /gist(.:format)
Controller#Action | gists/gists#new
Source Location   | config/routes/gist.rb:3
</code></pre>

<p><em>Luan Vieira, John Hawthorn and Daniel Colson</em></p></li>
<li><p>Add <code>without</code> as an alias of <code>except</code> on <code>ActiveController::Parameters</code>.</p>

<p><em>Hidde-Jan Jongsma</em></p></li>
<li><p>Expand search field on <code>rails/info/routes</code> to also search <strong>route name</strong>, <strong>http verb</strong> and <strong>controller#action</strong>.</p>

<p><em>Jason Kotchoff</em></p></li>
<li><p>Remove deprecated <code>poltergeist</code> and <code>webkit</code> (capybara-webkit) driver registration for system testing.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated ability to assign a single value to <code>config.action_dispatch.trusted_proxies</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>config.action_dispatch.return_only_request_media_type_on_content_type</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated behavior on <code>Request#content_type</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Change <a href="ActionController/Instrumentation.html" title="ActionController::Instrumentation (module)"><code>::ActionController::Instrumentation</code></a> to pass <code>filtered_path</code> instead of <code>fullpath</code> in the event payload to filter sensitive query params</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/posts?password=test</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_fullpath'>fullpath</span>         <span class='comment'># =&gt; &quot;/posts?password=test&quot;
</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_filtered_path'>filtered_path</span>    <span class='comment'># =&gt; &quot;/posts?password=[FILTERED]&quot;</span></code></pre>

<p><em>Ritikesh G</em></p></li>
<li><p>Deprecate <code>AbstractController::Helpers::MissingHelperError</code></p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Change <code>ActionDispatch::Testing::TestResponse#parsed_body</code> to parse HTML as
a Nokogiri document</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/posts</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_content_type'>content_type</span>         <span class='comment'># =&gt; &quot;text/html; charset=utf-8&quot;
</span><span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_parsed_body'>parsed_body</span>.<span class='id identifier rubyid_class'>class</span>    <span class='comment'># =&gt; Nokogiri::HTML5::Document
</span><span class='id identifier rubyid_response'>response</span>.<span class='id identifier rubyid_parsed_body'>parsed_body</span>.<span class='id identifier rubyid_to_html'>to_html</span>  <span class='comment'># =&gt; &quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n...&quot;</span></code></pre>

<p><em>Sean Doyle</em></p></li>
<li><p>Deprecate <code>ActionDispatch::IllegalStateError</code>.</p>

<p><em>Samuel Williams</em></p></li>
<li><p>Add HTTP::Request#route_uri_pattern that returns URI pattern of matched route.</p>

<p><em>Joel Hawksley</em>, <em>Kate Higa</em></p></li>
<li><p>Add <a href="ActionDispatch/AssumeSSL.html" title="ActionDispatch::AssumeSSL (class)"><code>::ActionDispatch::AssumeSSL</code></a> middleware that can be turned on via <code>config.assume_ssl</code>.
It makes the application believe that all requests are arriving over SSL. This is useful
when proxying through a load balancer that terminates SSL, the forwarded request will appear
as though its HTTP instead of HTTPS to the application. This makes redirects and cookie
security target HTTP instead of HTTPS. This middleware makes the server assume that the
proxy already terminated SSL, and that the request really is HTTPS.</p>

<p><em>DHH</em></p></li>
<li><p>Only use HostAuthorization middleware if <code>config.hosts</code> is not empty</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Allow raising an error when a callback&#39;s only/unless symbols aren&#39;t existing methods.</p>

<p>When <code>before_action :callback, only: :action_name</code> is declared on a controller that doesn&#39;t respond to <code>action_name</code>, raise an exception at request time. This is a safety measure to ensure that typos or forgetfulness don&#39;t prevent a crucial callback from being run when it should.</p>

<p>For new applications, raising an error for undefined actions is turned on by default. If you do not want to opt-in to this behavior set <code>config.action_controller.raise_on_missing_callback_actions</code> to <code>false</code> in your application configuration. See #43487 for more details.</p>

<p><em>Jess Bees</em></p></li>
<li><p>Allow cookie options[:domain] to accept a proc to set the cookie domain on a more flexible per-request basis</p>

<p><em>RobL</em></p></li>
<li><p>When a host is not specified for an <a href="ActionController/Renderer.html" title="ActionController::Renderer (class)"><code>::ActionController::Renderer</code></a>&#39;s env,
the host and related options will now be derived from the routes&#39;
<code>default_url_options</code> and <a href="ActionDispatch/Http/URL.html#secure_protocol-class_method" title="ActionDispatch::Http::URL.secure_protocol (method)">ActionDispatch::Http::URL.secure_protocol</a>.</p>

<p>This means that for an application with a configuration like:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_default_url_options'>default_url_options</span> <span class='op'>=</span> { <span class='label'>host:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rubyonrails.org</span><span class='tstring_end'>&quot;</span></span> }
<span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_force_ssl'>force_ssl</span> <span class='op'>=</span> <span class='kw'>true</span></code></pre>

<p>rendering a URL like:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>ApplicationController</span>.<span class='id identifier rubyid_renderer'>renderer</span>.<span class='id identifier rubyid_render'>render</span> <span class='label'>inline:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;%= blog_url %&gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>will now return <code>&quot;https://rubyonrails.org/blog&quot;</code> instead of
<code>&quot;http://example.org/blog&quot;</code>.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Add details of cookie name and size to <code>CookieOverflow</code> exception.</p>

<p><em>Andy Waite</em></p></li>
<li><p>Don&#39;t double log the <code>controller</code>, <code>action</code>, or <code>namespaced_controller</code> when using <code>ActiveRecord::QueryLog</code></p>

<p>Previously if you set <code>config.active_record.query_log_tags</code> to an array that included
<code>:controller</code>, <code>:namespaced_controller</code>, or <code>:action</code>, that item would get logged twice.
This bug has been fixed.</p>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Add the following permissions policy directives: <code>hid</code>, <code>idle-detection</code>, <code>screen-wake-lock</code>,
<code>serial</code>, <code>sync-xhr</code>, <code>web-share</code>.</p>

<p><em>Guillaume Cabanel</em></p></li>
<li><p>The <code>speaker</code>, <code>vibrate</code>, and <code>vr</code> permissions policy directives are now
deprecated.</p>

<p>There is no browser support for these directives, and no plan for browser
support in the future. You can just remove these directives from your
application.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Added the <code>:status</code> option to <code>assert_redirected_to</code> to specify the precise
HTTP status of the redirect. Defaults to <code>:redirect</code> for backwards
compatibility.</p>

<p><em>Jon Dufresne</em></p></li>
<li><p>Rescue <code>JSON::ParserError</code> in Cookies JSON deserializer to discards marshal dumps:</p>

<p>Without this change, if <code>action_dispatch.cookies_serializer</code> is set to <code>:json</code> and
the app tries to read a <code>:marshal</code> serialized cookie, it would error out which wouldn&#39;t
clear the cookie and force app users to manually clear it in their browser.</p>

<p>(See #45127 for original bug discussion)</p>

<p><em>Nathan Bardoux</em></p></li>
<li><p>Add <code>HTTP_REFERER</code> when following redirects on integration tests</p>

<p>This makes <code>follow_redirect!</code> a closer simulation of what happens in a real browser</p>

<p><em>Felipe Sateler</em></p></li>
<li><p>Added <code>exclude?</code> method to <a href="ActionController/Parameters.html" title="ActionController::Parameters (class)"><code>::ActionController::Parameters</code></a>.</p>

<p><em>Ian Neubert</em></p></li>
<li><p>Rescue <code>EOFError</code> exception from <code>rack</code> on a multipart request.</p>

<p><em>Nikita Vasilevsky</em></p></li>
<li><p>Log redirects from routes the same way as redirects from controllers.</p>

<p><em>Dennis Paagman</em></p></li>
<li><p>Prevent <a href="ActionDispatch/ServerTiming.html" title="ActionDispatch::ServerTiming (class)"><code>::ActionDispatch::ServerTiming</code></a> from overwriting existing values in <code>Server-Timing</code>.
Previously, if another middleware down the chain set <code>Server-Timing</code> header,
it would overwritten by <a href="ActionDispatch/ServerTiming.html" title="ActionDispatch::ServerTiming (class)"><code>::ActionDispatch::ServerTiming</code></a>.</p>

<p><em>Jakub Malinowski</em></p></li>
<li><p>Allow opting out of the <code>SameSite</code> cookie attribute when setting a cookie.</p>

<p>You can opt out of <code>SameSite</code> by passing <code>same_site: nil</code>.</p>

<p><code>cookies[:foo] = { value: &quot;bar&quot;, same_site: nil }</code></p>

<p>Previously, this incorrectly set the <code>SameSite</code> attribute to the value of the <code>cookies_same_site_protection</code> setting.</p>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Allow using <code>helper_method</code>s in <code>content_security_policy</code> and <code>permissions_policy</code></p>

<p>Previously you could access basic helpers (defined in helper modules), but not
helper methods defined using <code>helper_method</code>. Now you can use either.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_default_src'>default_src</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://example.com</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_script_src'>script_src</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://example.com</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_helpers'>helpers</span>.<span class='id identifier rubyid_script_csp?'>script_csp?</span>
<span class='kw'>end</span></code></pre>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Reimplement <a href="ActionController/Parameters.html#has_value%3F-instance_method" title="ActionController::Parameters#has_value? (method)">ActionController::Parameters#has_value?</a> and <code>#value?</code> to avoid parameters and hashes comparison.</p>

<p>Deprecated equality between parameters and hashes is going to be removed in Rails 7.2.
The new implementation takes care of conversions.</p>

<p><em>Seva Stefkin</em></p></li>
<li><p>Allow only <a href="String.html" title="String (class)"><code>String</code></a> and <a href="Symbol.html" title="Symbol (class)"><code>Symbol</code></a> keys in <a href="ActionController/Parameters.html" title="ActionController::Parameters (class)"><code>::ActionController::Parameters</code></a>.
Raise <a href="ActionController/InvalidParameterKey.html" title="ActionController::InvalidParameterKey (class)"><code>::ActionController::InvalidParameterKey</code></a> when initializing Parameters
with keys that aren&#39;t strings or symbols.</p>

<p><em>Seva Stefkin</em></p></li>
<li><p>Add the ability to use custom logic for storing and retrieving CSRF tokens.</p>

<p>By default, the token will be stored in the session.  Custom classes can be
defined to specify arbitrary behavior, but the ability to store them in
encrypted cookies is built in.</p>

<p><em>Andrew Kowpak</em></p></li>
<li><p>Make ActionController::Parameters#values cast nested hashes into parameters.</p>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Introduce <code>html:</code> and <code>screenshot:</code> kwargs for system test screenshot helper</p>

<p>Use these as an alternative to the already-available environment variables.</p>

<p>For example, this will display a screenshot in iTerm, save the HTML, and output
its path.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_take_screenshot'>take_screenshot</span>(<span class='label'>html:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>screenshot:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inline</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Allow <a href="ActionController/Parameters.html#to_h-instance_method" title="ActionController::Parameters#to_h (method)">ActionController::Parameters#to_h</a> to receive a block.</p>

<p><em>Bob Farrell</em></p></li>
<li><p>Allow relative redirects when <code>raise_on_open_redirects</code> is enabled</p>

<p><em>Tom Hughes</em></p></li>
<li><p>Allow Content Security Policy DSL to generate for API responses.</p>

<p><em>Tim Wade</em></p></li>
<li><p>Fix <code>authenticate_with_http_basic</code> to allow for missing password.</p>

<p>Before Rails 7.0 it was possible to handle basic authentication with only a username.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_authenticate_with_http_basic'>authenticate_with_http_basic</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span>
  <span class='const'>ApiClient</span>.<span class='id identifier rubyid_authenticate'>authenticate</span>(<span class='id identifier rubyid_token'>token</span>)
<span class='kw'>end</span></code></pre>

<p>This ability is restored.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Fix <code>content_security_policy</code> returning invalid directives.</p>

<p>Directives such as <code>self</code>, <code>unsafe-eval</code> and few others were not
single quoted when the directive was the result of calling a lambda
returning an array.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_policy'>policy</span><span class='op'>|</span>
  <span class='id identifier rubyid_policy'>policy</span>.<span class='id identifier rubyid_frame_ancestors'>frame_ancestors</span> <span class='id identifier rubyid_lambda'>lambda</span> { [<span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://example.com</span><span class='tstring_end'>&quot;</span></span>] }
<span class='kw'>end</span></code></pre>

<p>With this fix the policy generated from above will now be valid.</p>

<p><em>Edouard Chin</em></p></li>
<li><p>Fix <code>skip_forgery_protection</code> to run without raising an error if forgery
protection has not been enabled / <code>verify_authenticity_token</code> is not a
defined callback.</p>

<p>This fix prevents the Rails 7.0 Welcome Page (<code>/</code>) from raising an
<code>ArgumentError</code> if <code>default_protect_from_forgery</code> is false.</p>

<p><em>Brad Trick</em></p></li>
<li><p>Make <code>redirect_to</code> return an empty response body.</p>

<p>Application controllers that wish to add a response body after calling
<code>redirect_to</code> can continue to do so.</p>

<p><em>Jon Dufresne</em></p></li>
<li><p>Use non-capturing group for subdomain matching in <a href="ActionDispatch/HostAuthorization.html" title="ActionDispatch::HostAuthorization (class)"><code>::ActionDispatch::HostAuthorization</code></a></p>

<p>Since we do nothing with the captured subdomain group, we can use a non-capturing group instead.</p>

<p><em>Sam Bostock</em></p></li>
<li><p>Fix <a href="ActionController/Live.html" title="ActionController::Live (module)"><code>::ActionController::Live</code></a> to copy the IsolatedExecutionState in the ephemeral thread.</p>

<p>Since its inception <a href="ActionController/Live.html" title="ActionController::Live (module)"><code>::ActionController::Live</code></a> has been copying thread local variables
to keep things such as <code>CurrentAttributes</code> set from middlewares working in the controller action.</p>

<p>With the introduction of <code>IsolatedExecutionState</code> in 7.0, some of that global state was lost in
<a href="ActionController/Live.html" title="ActionController::Live (module)"><code>::ActionController::Live</code></a> controllers.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Fix setting <code>trailing_slash: true</code> in route definition.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/test</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test#index</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>as:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_test'>test</span><span class='comma'>,</span> <span class='label'>trailing_slash:</span> <span class='kw'>true</span>

<span class='id identifier rubyid_test_path'>test_path</span>() <span class='comment'># =&gt; &quot;/test/&quot;</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Make <code>Session#merge!</code> stringify keys.</p>

<p>Previously <code>Session#update</code> would, but <code>merge!</code> wouldn&#39;t.</p>

<p><em>Drew Bragg</em></p></li>
<li><p>Add <code>:unsafe_hashes</code> mapping for <code>content_security_policy</code></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='id identifier rubyid_policy'>policy</span>.<span class='id identifier rubyid_script_src'>script_src</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_strict_dynamic'>strict_dynamic</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;unsafe-hashes&#39;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;sha256-rRMdkshZyJlCmDX27XnL7g3zXaxv7ei6Sg+yt4R3svU=&#39;</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># After
</span><span class='id identifier rubyid_policy'>policy</span>.<span class='id identifier rubyid_script_src'>script_src</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_strict_dynamic'>strict_dynamic</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unsafe_hashes'>unsafe_hashes</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;sha256-rRMdkshZyJlCmDX27XnL7g3zXaxv7ei6Sg+yt4R3svU=&#39;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><em>Igor Morozov</em></p></li>
</ul>

<p>Please check [7-0-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>