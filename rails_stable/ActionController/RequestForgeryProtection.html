<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::RequestForgeryProtection &mdash; Rails 8-0-stable</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionController::RequestForgeryProtection",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails 8-0-stable</a> &raquo; 
      <a href='../_index.html#alpha_R'>Index (R)</a> &raquo; 
        <a href="../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>RequestForgeryProtection&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionController::RequestForgeryProtection</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="RequestForgeryProtection/ClassMethods.html" title="ActionController::RequestForgeryProtection::ClassMethods (module)"><code>ClassMethods</code></a>,
        <a href="RequestForgeryProtection/ProtectionMethods.html" title="ActionController::RequestForgeryProtection::ProtectionMethods (module)"><code>ProtectionMethods</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="RequestForgeryProtection/CookieStore.html" title="ActionController::RequestForgeryProtection::CookieStore (class)"><code>CookieStore</code></a>,
        <a href="RequestForgeryProtection/SessionStore.html" title="ActionController::RequestForgeryProtection::SessionStore (class)"><code>SessionStore</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActionController::Base (class)"><code>Base</code></a>,
          <a href="../ActionView/TestCase/TestController.html" title="ActionView::TestCase::TestController (class)"><code>::ActionView::TestCase::TestController</code></a>,
          <a class='nodoc' href="../Rails/ApplicationController.html" title="Rails::ApplicationController (class)"><code>::Rails::ApplicationController</code></a>,
          <a href="../Rails/HealthController.html" title="Rails::HealthController (class)"><code>::Rails::HealthController</code></a>,
          <a class='nodoc' href="../Rails/InfoController.html" title="Rails::InfoController (class)"><code>::Rails::InfoController</code></a>,
          <a class='nodoc' href="../Rails/MailersController.html" title="Rails::MailersController (class)"><code>::Rails::MailersController</code></a>,
          <a class='nodoc' href="../Rails/PwaController.html" title="Rails::PwaController (class)"><code>::Rails::PwaController</code></a>,
          <a class='nodoc' href="../Rails/WelcomeController.html" title="Rails::WelcomeController (class)"><code>::Rails::WelcomeController</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/DescendantsTracker.html" title="ActiveSupport::DescendantsTracker (module)"><code>::ActiveSupport::DescendantsTracker</code></a>,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)"><code>::AbstractController::Callbacks</code></a>,
          <a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>::ActiveSupport::Callbacks</code></a>,
          <a href="../AbstractController/Helpers.html" title="AbstractController::Helpers (module)"><code>::AbstractController::Helpers</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L63'>actionpack/lib/action_controller/metal/request_forgery_protection.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Controller actions are protected from Cross-Site Request Forgery (CSRF) attacks by including a token in the rendered HTML for your application. This token is stored as a random string in the session, to which an attacker does not have access. When a request reaches your application, <a href="../Rails.html" title="Rails (module)"><code>::Rails</code></a> verifies the received token with the token in the session. All requests are checked except GET requests as these should be idempotent. Keep in mind that all session-oriented requests are CSRF protected by default, including JavaScript and HTML requests.</p>

<p>Since HTML and JavaScript requests are typically made from the browser, we need to ensure to verify request authenticity for the web browser. We can use session-oriented authentication for these types of requests, by using the <code>protect_from_forgery</code> method in our controllers.</p>

<p>GET requests are not protected since they don’t have side effects like writing to the database and don’t leak sensitive information. JavaScript requests are an exception: a third-party site can use a &lt;script&gt; tag to reference a JavaScript URL on your site. When your JavaScript response loads on their site, it executes. With carefully crafted JavaScript on their end, sensitive data in your JavaScript response may be extracted. To prevent this, only XmlHttpRequest (known as XHR or Ajax) requests are allowed to make requests for JavaScript responses.</p>

<p>Subclasses of <a href="Base.html" title="ActionController::Base (class)"><code>Base</code></a> are protected by default with the <code>:exception</code> strategy, which raises an <a href="InvalidAuthenticityToken.html" title="ActionController::InvalidAuthenticityToken (class)"><code>InvalidAuthenticityToken</code></a> error on unverified requests.</p>

<p>APIs may want to disable this behavior since they are typically designed to be state-less: that is, the request <a href="API.html" title="ActionController::API (class)"><code>API</code></a> client handles the session instead of <a href="../Rails.html" title="Rails (module)"><code>::Rails</code></a>. One way to achieve this is to use the <code>:null_session</code> strategy instead, which allows unverified requests to be handled, but with an empty session:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>with:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_null_session'>null_session</span>
<span class='kw'>end</span></code></pre>

<p>Note that <a href="API.html" title="ActionController::API (class)"><code>API</code></a> only applications don’t include this module or a session middleware by default, and so don’t require CSRF protection to be configured.</p>

<p>The token parameter is named <code>authenticity_token</code> by default. The name and value of this token must be added to every layout that renders forms by including <code>csrf_meta_tags</code> in the HTML <code>head</code>.</p>

<p>Learn more about CSRF attacks and securing your application in the [Ruby on <a href="../Rails.html" title="Rails (module)"><code>::Rails</code></a> Security Guide](<a href="https://guides.rubyonrails.org/security.html">guides.rubyonrails.org/security.html</a>).</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='AUTHENTICITY_TOKEN_LENGTH-constant' class='summary_signature'>AUTHENTICITY_TOKEN_LENGTH =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L454-L454'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 454</a>    <pre class='code ruby'><span class='int'>32</span></pre>
  </li>
  <li>
    <span id='CROSS_ORIGIN_JAVASCRIPT_WARNING-constant' class='summary_signature priv'>CROSS_ORIGIN_JAVASCRIPT_WARNING =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L419-L422'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 419</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Security warning: an embedded </span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;script&gt; tag on another site requested protected JavaScript. </span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>If you know what you&#39;re doing, go ahead and disable forgery </span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>protection on this action to permit cross-origin JavaScript embedding.</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='CSRF_TOKEN-constant' class='summary_signature'>CSRF_TOKEN =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L64-L64'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 64</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action_controller.csrf_token</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='GLOBAL_CSRF_TOKEN_IDENTIFIER-constant' class='summary_signature priv'>GLOBAL_CSRF_TOKEN_IDENTIFIER =</span>
    <span class='note title private'>private</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L580-L580'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 580</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>!real_csrf_token</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='NULL_ORIGIN_MESSAGE-constant' class='summary_signature'>NULL_ORIGIN_MESSAGE =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L616-L623'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 616</a>    <pre class='code ruby'><span class='heredoc_beg'>&lt;&lt;~MSG</span>
<span class='ignored_sp'>  </span><span class='tstring_content'>The browser returned a &#39;null&#39; origin for a request with origin-based forgery protection turned on. This usually
</span><span class='ignored_sp'>  </span><span class='tstring_content'>means you have the &#39;no-referrer&#39; Referrer-Policy header enabled, or that the request came from a site that
</span><span class='ignored_sp'>  </span><span class='tstring_content'>refused to give its origin. This makes it impossible for Rails to verify the source of the requests. Likely the
</span><span class='ignored_sp'>  </span><span class='tstring_content'>best solution is to change your referrer policy to something less strict like same-origin or strict-origin.
</span><span class='ignored_sp'>  </span><span class='tstring_content'>If you cannot change the referrer policy, you can disable origin checking with the
</span><span class='ignored_sp'>  </span><span class='tstring_content'>Rails.application.config.action_controller.forgery_protection_origin_check setting.
</span><span class='heredoc_end'>MSG</span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>::ActiveSupport::Callbacks</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="../ActiveSupport/Callbacks.html#CALLBACK_FILTER_TYPES-constant" title="ActiveSupport::Callbacks::CALLBACK_FILTER_TYPES (constant)">CALLBACK_FILTER_TYPES</a>
  </p>
</div>

<h2 class='h2_sum'><a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)"><code>::AbstractController::Callbacks</code></a> - Attributes &amp; Methods</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#raise_on_missing_callback_actions-class_method" title=".raise_on_missing_callback_actions (class method)">.<strong>raise_on_missing_callback_actions</strong>  </a>
      (also: #raise_on_missing_callback_actions)
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#raise_on_missing_callback_actions-instance_method" title="#raise_on_missing_callback_actions (instance method)">#<strong>raise_on_missing_callback_actions</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
</ul>
</div>

<h2 class='h2_sum'><a href="../AbstractController/Helpers.html" title="AbstractController::Helpers (module)"><code>::AbstractController::Helpers</code></a> - Attributes &amp; Methods</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods-class_method" title="._helper_methods (class method)">.<strong>_helper_methods</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods-instance_method" title="#_helper_methods (instance method)">#<strong>_helper_methods</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods%3F-class_method" title="._helper_methods? (class method)">.<strong>_helper_methods?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#_helper_methods%3F-instance_method" title="#_helper_methods? (instance method)">#<strong>_helper_methods?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/DescendantsTracker.html" title="ActiveSupport::DescendantsTracker (module)"><code>::ActiveSupport::DescendantsTracker</code></a> - self</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../ActiveSupport/DescendantsTracker.html#descendants-class_method" title="ActiveSupport::DescendantsTracker.descendants (method)">descendants</a>,
        <a class='i_m ' href="../ActiveSupport/DescendantsTracker.html#subclasses-class_method" title="ActiveSupport::DescendantsTracker.subclasses (method)">subclasses</a>,
        <a class='i_m nodoc' href="../ActiveSupport/DescendantsTracker.html#clear-class_method" title="ActiveSupport::DescendantsTracker.clear (method)">clear</a>,
        <a class='i_m nodoc' href="../ActiveSupport/DescendantsTracker.html#disable_clear!-class_method" title="ActiveSupport::DescendantsTracker.disable_clear! (method)">disable_clear!</a>,
        <a class='i_m nodoc' href="../ActiveSupport/DescendantsTracker.html#reject!-class_method" title="ActiveSupport::DescendantsTracker.reject! (method)">reject!</a>
      </td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#prepend_features-instance_method" title="ActiveSupport::Concern#prepend_features (method)">prepend_features</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#any_authenticity_token_valid%3F-instance_method" title="#any_authenticity_token_valid? (instance method)">#<strong>any_authenticity_token_valid?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if any of the authenticity tokens from the request are valid.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#marked_for_same_origin_verification%3F-instance_method" title="#marked_for_same_origin_verification? (instance method)">#<strong>marked_for_same_origin_verification?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>If the <a href="#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">#verify_authenticity_token</a> before_action ran, verify that JavaScript responses are only served to same-origin GET requests.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#non_xhr_javascript_response%3F-instance_method" title="#non_xhr_javascript_response? (instance method)">#<strong>non_xhr_javascript_response?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check for cross-origin JavaScript responses.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#protect_against_forgery%3F-instance_method" title="#protect_against_forgery? (instance method)">#<strong>protect_against_forgery?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the controller allows forgery protection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#valid_request_origin%3F-instance_method" title="#valid_request_origin? (instance method)">#<strong>valid_request_origin?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the request originated from the same origin by looking at the Origin header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#verified_request%3F-instance_method" title="#verified_request? (instance method)">#<strong>verified_request?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true or false if a request is verified.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)"><code>::AbstractController::Callbacks</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro' href="../AbstractController/Callbacks.html#__callbacks-instance_method" title="AbstractController::Callbacks#__callbacks (method)">#__callbacks</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#commit_csrf_token-instance_method" title="#commit_csrf_token (instance method)">#<strong>commit_csrf_token</strong>(request)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset_csrf_token-instance_method" title="#reset_csrf_token (instance method)">#<strong>reset_csrf_token</strong>(request)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compare_with_global_token-instance_method" title="#compare_with_global_token (instance method)">#<strong>compare_with_global_token</strong>(token, session = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compare_with_real_token-instance_method" title="#compare_with_real_token (instance method)">#<strong>compare_with_real_token</strong>(token, session = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#csrf_token_hmac-instance_method" title="#csrf_token_hmac (instance method)">#<strong>csrf_token_hmac</strong>(session, identifier)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#decode_csrf_token-instance_method" title="#decode_csrf_token (instance method)">#<strong>decode_csrf_token</strong>(encoded_csrf_token)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#encode_csrf_token-instance_method" title="#encode_csrf_token (instance method)">#<strong>encode_csrf_token</strong>(csrf_token)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#form_authenticity_param-instance_method" title="#form_authenticity_param (instance method)">#<strong>form_authenticity_param</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>The form’s authenticity parameter.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#form_authenticity_token-instance_method" title="#form_authenticity_token (instance method)">#<strong>form_authenticity_token</strong>(form_options: {})  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates the authenticity token for the current request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#generate_csrf_token-instance_method" title="#generate_csrf_token (instance method)">#<strong>generate_csrf_token</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#global_csrf_token-instance_method" title="#global_csrf_token (instance method)">#<strong>global_csrf_token</strong>(session = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#handle_unverified_request-instance_method" title="#handle_unverified_request (instance method)">#<strong>handle_unverified_request</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#mark_for_same_origin_verification!-instance_method" title="#mark_for_same_origin_verification! (instance method)">#<strong>mark_for_same_origin_verification!</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>GET requests are checked for cross-origin JavaScript after rendering.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#mask_token-instance_method" title="#mask_token (instance method)">#<strong>mask_token</strong>(raw_token)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#masked_authenticity_token-instance_method" title="#masked_authenticity_token (instance method)">#<strong>masked_authenticity_token</strong>(form_options: {})  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a masked version of the authenticity token that varies on each request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#normalize_action_path-instance_method" title="#normalize_action_path (instance method)">#<strong>normalize_action_path</strong>(action_path)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#normalize_relative_action_path-instance_method" title="#normalize_relative_action_path (instance method)">#<strong>normalize_relative_action_path</strong>(rel_action_path)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#per_form_csrf_token-instance_method" title="#per_form_csrf_token (instance method)">#<strong>per_form_csrf_token</strong>(session, action_path, method)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#real_csrf_token-instance_method" title="#real_csrf_token (instance method)">#<strong>real_csrf_token</strong>(_session = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#request_authenticity_tokens-instance_method" title="#request_authenticity_tokens (instance method)">#<strong>request_authenticity_tokens</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Possible authenticity tokens sent in the request.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#unmask_token-instance_method" title="#unmask_token (instance method)">#<strong>unmask_token</strong>(masked_token)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#unverified_request_warning_message-instance_method" title="#unverified_request_warning_message (instance method)">#<strong>unverified_request_warning_message</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid_authenticity_token%3F-instance_method" title="#valid_authenticity_token? (instance method)">#<strong>valid_authenticity_token?</strong>(session, encoded_masked_token)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks the client’s masked token to see if it matches the session token.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#valid_per_form_csrf_token%3F-instance_method" title="#valid_per_form_csrf_token? (instance method)">#<strong>valid_per_form_csrf_token?</strong>(token, session = nil)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_authenticity_token-instance_method" title="#verify_authenticity_token (instance method)">#<strong>verify_authenticity_token</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>The actual before_action that is used to verify the CSRF token.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#verify_same_origin_request-instance_method" title="#verify_same_origin_request (instance method)">#<strong>verify_same_origin_request</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>If <a href="#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">#verify_authenticity_token</a> was run (indicating that we have forgery protection enabled for this request) then also verify that we aren’t serving an unauthorized cross-origin response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#xor_byte_strings-instance_method" title="#xor_byte_strings (instance method)">#<strong>xor_byte_strings</strong>(s1, s2)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)"><code>::AbstractController::Callbacks</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../AbstractController/Callbacks.html#process_action-instance_method" title="AbstractController::Callbacks#process_action (method)">#process_action</a></td>
      <td><div class='inline'><p>Override <a href="../AbstractController/Base.html#process_action-instance_method" title="AbstractController::Base#process_action (method)">AbstractController::Base#process_action</a> to run the <code>process_action</code> callbacks around the normal behavior.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>::ActiveSupport::Callbacks</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Callbacks.html#run_callbacks-instance_method" title="ActiveSupport::Callbacks#run_callbacks (method)">#run_callbacks</a></td>
      <td><div class='inline'><p>Runs the callbacks for the given event.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="../ActiveSupport/Callbacks.html#halted_callback_hook-instance_method" title="ActiveSupport::Callbacks#halted_callback_hook (method)">#halted_callback_hook</a></td>
      <td><div class='inline'><p>A hook invoked every time a before callback is halted.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../AbstractController/Helpers.html" title="AbstractController::Helpers (module)"><code>::AbstractController::Helpers</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="../AbstractController/Helpers.html#_helpers-instance_method" title="AbstractController::Helpers#_helpers (method)">#_helpers</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L71-L104'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='comment'># Sets the token parameter name for RequestForgery. Calling
</span>  <span class='comment'># `protect_from_forgery` sets it to `:authenticity_token` by default.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span> <span class='op'>||=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authenticity_token'>authenticity_token</span>

  <span class='comment'># Holds the class which implements the request forgery protection.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='comment'># Controls whether request forgery protection is turned on or not. Turned off by
</span>  <span class='comment'># default only in test mode.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'># Controls whether a CSRF failure logs a warning. On by default.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># Controls whether the Origin header is checked in addition to the CSRF token.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># Controls whether form-action/method specific CSRF tokens are used.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># The strategy to use for storing and retrieving CSRF tokens.
</span>  <span class='id identifier rubyid_config_accessor'>config_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_csrf_token_storage_strategy'>csrf_token_storage_strategy</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_csrf_token_storage_strategy'>csrf_token_storage_strategy</span> <span class='op'>=</span> <span class='const'><a href="RequestForgeryProtection/SessionStore.html" title="ActionController::RequestForgeryProtection::SessionStore (class)">SessionStore</a></span>.<span class='id identifier rubyid_new'><a href="#initialize-instance_method" title="ActionController::RequestForgeryProtection#initialize (method)">new</a></span>

  <span class='id identifier rubyid_helper_method'>helper_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_form_authenticity_token'><a href="#form_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#form_authenticity_token (method)">form_authenticity_token</a></span>
  <span class='id identifier rubyid_helper_method'>helper_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_protect_against_forgery?'><a href="#protect_against_forgery%3F-instance_method" title="ActionController::RequestForgeryProtection#protect_against_forgery? (method)">protect_against_forgery?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="_helper_methods-class_method">
  <h3 class='signature rw first'>
    .<strong>_helper_methods</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/abstract_controller/helpers.rb#L13-L13'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='13' data-end='13'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 13</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'>_helper_methods</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_new'>new</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helper_methods?-class_method">
  <h3 class='signature rw'>
    .<strong>_helper_methods?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/abstract_controller/helpers.rb#L13-L13'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='13' data-end='13'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 13</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'><a href="#_helper_methods-class_method" title="ActionController::RequestForgeryProtection._helper_methods (method)">_helper_methods</a></span><span class='comma'>,</span> <span class='label'>default:</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_new'>new</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_on_missing_callback_actions-class_method">
  <h3 class='signature rw'>
    .<strong>raise_on_missing_callback_actions</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#raise_on_missing_callback_actions</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/abstract_controller/callbacks.rb#L36-L36'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='36' data-end='36'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/callbacks.rb', line 36</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_mattr_accessor'>mattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_raise_on_missing_callback_actions'>raise_on_missing_callback_actions</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="_helper_methods-instance_method">
  <h3 class='signature rw first'>
    #<strong>_helper_methods</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/abstract_controller/helpers.rb#L13-L13'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='13' data-end='13'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 13</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'>_helper_methods</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_new'>new</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_helper_methods?-instance_method">
  <h3 class='signature rw'>
    #<strong>_helper_methods?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/abstract_controller/helpers.rb#L13-L13'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='13' data-end='13'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/helpers.rb', line 13</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid__helper_methods'><a href="#_helper_methods-class_method" title="ActionController::RequestForgeryProtection._helper_methods (method)">_helper_methods</a></span><span class='comma'>,</span> <span class='label'>default:</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_new'>new</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="any_authenticity_token_valid?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>any_authenticity_token_valid?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if any of the authenticity tokens from the request are valid.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L469-L473'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='469' data-end='473'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 469</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_any_authenticity_token_valid?'>any_authenticity_token_valid?</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_request_authenticity_tokens'><a href="#request_authenticity_tokens-instance_method" title="ActionController::RequestForgeryProtection#request_authenticity_tokens (method)">request_authenticity_tokens</a></span>.<span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token'>token</span><span class='op'>|</span>
    <span class='id identifier rubyid_valid_authenticity_token?'><a href="#valid_authenticity_token%3F-instance_method" title="ActionController::RequestForgeryProtection#valid_authenticity_token? (method)">valid_authenticity_token?</a></span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="marked_for_same_origin_verification?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>marked_for_same_origin_verification?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the <a href="#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">#verify_authenticity_token</a> before_action ran, verify that JavaScript responses are only served to same-origin GET requests.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L445-L447'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='445' data-end='447'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 445</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_marked_for_same_origin_verification?'>marked_for_same_origin_verification?</span> <span class='comment'># :doc:
</span>  <span class='ivar'>@_marked_for_same_origin_verification</span> <span class='op'>||=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="non_xhr_javascript_response?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>non_xhr_javascript_response?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check for cross-origin JavaScript responses.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L450-L452'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='450' data-end='452'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 450</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_non_xhr_javascript_response?'>non_xhr_javascript_response?</span> <span class='comment'># :doc:
</span>  <span class='tstring'><span class='regexp_beg'>%r(</span><span class='tstring_content'>\A(?:text|application)/javascript</span><span class='regexp_end'>)</span></span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='id identifier rubyid_media_type'>media_type</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_xhr?'>xhr?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="protect_against_forgery?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>protect_against_forgery?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the controller allows forgery protection.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L612-L614'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='612' data-end='614'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 612</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_protect_against_forgery?'>protect_against_forgery?</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span> <span class='op'>&amp;&amp;</span> (<span class='op'>!</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_enabled?'>enabled?</span>) <span class='op'>||</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_enabled?'>enabled?</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise_on_missing_callback_actions-instance_method">
  <h3 class='signature rw'>
    #<strong>raise_on_missing_callback_actions</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/abstract_controller/callbacks.rb#L36-L36'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='36' data-end='36'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/abstract_controller/callbacks.rb', line 36</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_mattr_accessor'>mattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_raise_on_missing_callback_actions'>raise_on_missing_callback_actions</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='kw'>false</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_request_origin?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>valid_request_origin?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the request originated from the same origin by looking at the Origin header.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L627-L635'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='627' data-end='635'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 627</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_request_origin?'>valid_request_origin?</span> <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span>
    <span class='comment'># We accept blank origin headers because some user agents don&#39;t send it.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="InvalidAuthenticityToken.html" title="ActionController::InvalidAuthenticityToken (class)">InvalidAuthenticityToken</a></span><span class='comma'>,</span> <span class='const'><a href="#NULL_ORIGIN_MESSAGE-constant" title="ActionController::RequestForgeryProtection::NULL_ORIGIN_MESSAGE (constant)">NULL_ORIGIN_MESSAGE</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_origin'>origin</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>null</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_origin'>origin</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_origin'>origin</span> <span class='op'>==</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_base_url'>base_url</span>
  <span class='kw'>else</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verified_request?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>verified_request?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true or false if a request is verified. Checks:</p>
<ul><li>
<p>Is it a GET or HEAD request? GETs should be safe and idempotent</p>
</li><li>
<p>Does the form_authenticity_token match the given token value from the params?</p>
</li><li>
<p>Does the <code>X-CSRF-Token</code> header match the form_authenticity_token?</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L463-L466'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='463' data-end='466'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 463</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verified_request?'>verified_request?</span> <span class='comment'># :doc:
</span>  <span class='op'>!</span><span class='id identifier rubyid_protect_against_forgery?'><a href="#protect_against_forgery%3F-instance_method" title="ActionController::RequestForgeryProtection#protect_against_forgery? (method)">protect_against_forgery?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_get?'>get?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_head?'>head?</span> <span class='op'>||</span>
    (<span class='id identifier rubyid_valid_request_origin?'><a href="#valid_request_origin%3F-instance_method" title="ActionController::RequestForgeryProtection#valid_request_origin? (method)">valid_request_origin?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_any_authenticity_token_valid?'><a href="#any_authenticity_token_valid%3F-instance_method" title="ActionController::RequestForgeryProtection#any_authenticity_token_valid? (method)">any_authenticity_token_valid?</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="commit_csrf_token-instance_method">
  <h3 class='signature  first'>
    #<strong>commit_csrf_token</strong>(request)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L376-L379'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='376' data-end='379'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 376</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_commit_csrf_token'>commit_csrf_token</span>(<span class='id identifier rubyid_request'>request</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_csrf_token'>csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="#CSRF_TOKEN-constant" title="ActionController::RequestForgeryProtection::CSRF_TOKEN (constant)">CSRF_TOKEN</a></span>]
  <span class='id identifier rubyid_csrf_token_storage_strategy'>csrf_token_storage_strategy</span>.<span class='id identifier rubyid_store'>store</span>(<span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_csrf_token'>csrf_token</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_csrf_token'>csrf_token</span>.<span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compare_with_global_token-instance_method">
  <h3 class='signature priv'>
    #<strong>compare_with_global_token</strong>(token, session = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L550-L552'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='550' data-end='552'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 550</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compare_with_global_token'>compare_with_global_token</span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :doc:
</span>  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span>.<span class='id identifier rubyid_fixed_length_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#fixed_length_secure_compare-class_method" title="ActiveSupport::SecurityUtils.fixed_length_secure_compare (method)">fixed_length_secure_compare</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_global_csrf_token'><a href="#global_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#global_csrf_token (method)">global_csrf_token</a></span>(<span class='id identifier rubyid_session'>session</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compare_with_real_token-instance_method">
  <h3 class='signature priv'>
    #<strong>compare_with_real_token</strong>(token, session = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L546-L548'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='546' data-end='548'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 546</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :doc:
</span>  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span>.<span class='id identifier rubyid_fixed_length_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#fixed_length_secure_compare-class_method" title="ActiveSupport::SecurityUtils.fixed_length_secure_compare (method)">fixed_length_secure_compare</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_real_csrf_token'><a href="#real_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#real_csrf_token (method)">real_csrf_token</a></span>(<span class='id identifier rubyid_session'>session</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="csrf_token_hmac-instance_method">
  <h3 class='signature priv'>
    #<strong>csrf_token_hmac</strong>(session, identifier)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L587-L593'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='587' data-end='593'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 587</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_csrf_token_hmac'>csrf_token_hmac</span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_identifier'>identifier</span>) <span class='comment'># :doc:
</span>  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span>.<span class='id identifier rubyid_digest'>digest</span>(
    <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'><a href="../Digest.html" title="Digest (module)">Digest</a></span><span class='op'>::</span><span class='const'>SHA256</span>.<span class='id identifier rubyid_new'>new</span><span class='comma'>,</span>
    <span class='id identifier rubyid_real_csrf_token'><a href="#real_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#real_csrf_token (method)">real_csrf_token</a></span>(<span class='id identifier rubyid_session'>session</span>)<span class='comma'>,</span>
    <span class='id identifier rubyid_identifier'>identifier</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decode_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>decode_csrf_token</strong>(encoded_csrf_token)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L665-L667'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='665' data-end='667'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 665</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decode_csrf_token'>decode_csrf_token</span>(<span class='id identifier rubyid_encoded_csrf_token'>encoded_csrf_token</span>)
  <span class='const'>Base64</span>.<span class='id identifier rubyid_urlsafe_decode64'>urlsafe_decode64</span>(<span class='id identifier rubyid_encoded_csrf_token'>encoded_csrf_token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encode_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>encode_csrf_token</strong>(csrf_token)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L661-L663'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='661' data-end='663'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 661</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_csrf_token'>encode_csrf_token</span>(<span class='id identifier rubyid_csrf_token'>csrf_token</span>)
  <span class='const'>Base64</span>.<span class='id identifier rubyid_urlsafe_encode64'>urlsafe_encode64</span>(<span class='id identifier rubyid_csrf_token'>csrf_token</span><span class='comma'>,</span> <span class='label'>padding:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="form_authenticity_param-instance_method">
  <h3 class='signature priv'>
    #<strong>form_authenticity_param</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The form’s authenticity parameter. Override to provide your own.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L607-L609'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='607' data-end='609'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 607</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_form_authenticity_param'>form_authenticity_param</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_params'>params</span>[<span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="form_authenticity_token-instance_method">
  <h3 class='signature priv'>
    #<strong>form_authenticity_token</strong>(form_options: {})   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates the authenticity token for the current request.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L481-L483'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='481' data-end='483'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 481</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_form_authenticity_token'>form_authenticity_token</span>(<span class='label'>form_options:</span> {}) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_masked_authenticity_token'><a href="#masked_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#masked_authenticity_token (method)">masked_authenticity_token</a></span>(<span class='label'>form_options:</span> <span class='id identifier rubyid_form_options'>form_options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generate_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>generate_csrf_token</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L657-L659'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='657' data-end='659'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 657</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_csrf_token'>generate_csrf_token</span>
  <span class='const'><a href="../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span>.<span class='id identifier rubyid_urlsafe_base64'>urlsafe_base64</span>(<span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="global_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>global_csrf_token</strong>(session = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L583-L585'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='583' data-end='585'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 583</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_global_csrf_token'>global_csrf_token</span>(<span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_csrf_token_hmac'><a href="#csrf_token_hmac-instance_method" title="ActionController::RequestForgeryProtection#csrf_token_hmac (method)">csrf_token_hmac</a></span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='const'><a href="#GLOBAL_CSRF_TOKEN_IDENTIFIER-constant" title="ActionController::RequestForgeryProtection::GLOBAL_CSRF_TOKEN_IDENTIFIER (constant)">GLOBAL_CSRF_TOKEN_IDENTIFIER</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_unverified_request-instance_method">
  <h3 class='signature priv'>
    #<strong>handle_unverified_request</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L401-L409'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='401' data-end='409'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 401</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
  <span class='id identifier rubyid_protection_strategy'>protection_strategy</span> <span class='op'>=</span> <span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span>.<span class='id identifier rubyid_new'>new</span>(<span class='kw'>self</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_protection_strategy'>protection_strategy</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_warning_message'>warning_message</span>)
    <span class='id identifier rubyid_protection_strategy'>protection_strategy</span>.<span class='id identifier rubyid_warning_message'>warning_message</span> <span class='op'>=</span> <span class='id identifier rubyid_unverified_request_warning_message'><a href="#unverified_request_warning_message-instance_method" title="ActionController::RequestForgeryProtection#unverified_request_warning_message (method)">unverified_request_warning_message</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_protection_strategy'>protection_strategy</span>.<span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="initialize-instance_method">
  <h3 class='signature '>
    #<strong>initialize</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L366-L369'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='366' data-end='369'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 366</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='op'>...</span>)
  <span class='kw'>super</span>
  <span class='ivar'>@_marked_for_same_origin_verification</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="mark_for_same_origin_verification!-instance_method">
  <h3 class='signature priv'>
    #<strong>mark_for_same_origin_verification!</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>GET requests are checked for cross-origin JavaScript after rendering.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L439-L441'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='439' data-end='441'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 439</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_mark_for_same_origin_verification!'>mark_for_same_origin_verification!</span> <span class='comment'># :doc:
</span>  <span class='ivar'>@_marked_for_same_origin_verification</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_get?'>get?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="mask_token-instance_method">
  <h3 class='signature priv'>
    #<strong>mask_token</strong>(raw_token)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L539-L544'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='539' data-end='544'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 539</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_mask_token'>mask_token</span>(<span class='id identifier rubyid_raw_token'>raw_token</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>=</span> <span class='const'><a href="../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span>.<span class='id identifier rubyid_random_bytes'>random_bytes</span>(<span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span>)
  <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_byte_strings'><a href="#xor_byte_strings-instance_method" title="ActionController::RequestForgeryProtection#xor_byte_strings (method)">xor_byte_strings</a></span>(<span class='id identifier rubyid_one_time_pad'>one_time_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_token'>raw_token</span>)
  <span class='id identifier rubyid_masked_token'>masked_token</span> <span class='op'>=</span> <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>+</span> <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span>
  <span class='id identifier rubyid_encode_csrf_token'><a href="#encode_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#encode_csrf_token (method)">encode_csrf_token</a></span>(<span class='id identifier rubyid_masked_token'>masked_token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="masked_authenticity_token-instance_method">
  <h3 class='signature priv'>
    #<strong>masked_authenticity_token</strong>(form_options: {})   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a masked version of the authenticity token that varies on each request. The masking is used to mitigate SSL attacks like BREACH.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L487-L498'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='487' data-end='498'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 487</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_masked_authenticity_token'>masked_authenticity_token</span>(<span class='label'>form_options:</span> {})
  <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_form_options'>form_options</span>.<span class='id identifier rubyid_values_at'>values_at</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_method'>method</span>)

  <span class='id identifier rubyid_raw_token'>raw_token</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_method'>method</span>
    <span class='id identifier rubyid_action_path'>action_path</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_action_path'><a href="#normalize_action_path-instance_method" title="ActionController::RequestForgeryProtection#normalize_action_path (method)">normalize_action_path</a></span>(<span class='id identifier rubyid_action'>action</span>)
    <span class='id identifier rubyid_per_form_csrf_token'><a href="#per_form_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#per_form_csrf_token (method)">per_form_csrf_token</a></span>(<span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_global_csrf_token'><a href="#global_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#global_csrf_token (method)">global_csrf_token</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mask_token'><a href="#mask_token-instance_method" title="ActionController::RequestForgeryProtection#mask_token (method)">mask_token</a></span>(<span class='id identifier rubyid_raw_token'>raw_token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="normalize_action_path-instance_method">
  <h3 class='signature priv'>
    #<strong>normalize_action_path</strong>(action_path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L637-L645'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='637' data-end='645'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 637</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span>(<span class='id identifier rubyid_action_path'>action_path</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'>URI</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_action_path'>action_path</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_relative?'>relative?</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_action_path'>action_path</span>.<span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_action_path'>action_path</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>))
    <span class='id identifier rubyid_normalize_relative_action_path'><a href="#normalize_relative_action_path-instance_method" title="ActionController::RequestForgeryProtection#normalize_relative_action_path (method)">normalize_relative_action_path</a></span>(<span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_path'>path</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_path'>path</span>.<span class='id identifier rubyid_chomp'>chomp</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="normalize_relative_action_path-instance_method">
  <h3 class='signature priv'>
    #<strong>normalize_relative_action_path</strong>(rel_action_path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L647-L655'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='647' data-end='655'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 647</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_relative_action_path'>normalize_relative_action_path</span>(<span class='id identifier rubyid_rel_action_path'>rel_action_path</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'>URI</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path'>path</span>)
  <span class='comment'># add the action path to the request.path
</span>  <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_path'>path</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rel_action_path'>rel_action_path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># relative path with &quot;./path&quot;
</span>  <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_path'>path</span>.<span class='id identifier rubyid_gsub!'>gsub!</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/./</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>)

  <span class='id identifier rubyid_uri'>uri</span>.<span class='id identifier rubyid_path'>path</span>.<span class='id identifier rubyid_chomp'>chomp</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="per_form_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>per_form_csrf_token</strong>(session, action_path, method)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L576-L578'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='576' data-end='578'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 576</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_csrf_token_hmac'><a href="#csrf_token_hmac-instance_method" title="ActionController::RequestForgeryProtection#csrf_token_hmac (method)">csrf_token_hmac</a></span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> [<span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>.<span class='id identifier rubyid_downcase'>downcase</span>].<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#</span><span class='tstring_end'>&quot;</span></span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="real_csrf_token-instance_method">
  <h3 class='signature priv'>
    #<strong>real_csrf_token</strong>(_session = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L568-L574'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='568' data-end='574'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 568</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span>(<span class='id identifier rubyid__session'>_session</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_csrf_token'>csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='const'><a href="#CSRF_TOKEN-constant" title="ActionController::RequestForgeryProtection::CSRF_TOKEN (constant)">CSRF_TOKEN</a></span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="#CSRF_TOKEN-constant" title="ActionController::RequestForgeryProtection::CSRF_TOKEN (constant)">CSRF_TOKEN</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_csrf_token_storage_strategy'>csrf_token_storage_strategy</span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='id identifier rubyid_request'>request</span>) <span class='op'>||</span> <span class='id identifier rubyid_generate_csrf_token'><a href="#generate_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#generate_csrf_token (method)">generate_csrf_token</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_decode_csrf_token'><a href="#decode_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#decode_csrf_token (method)">decode_csrf_token</a></span>(<span class='id identifier rubyid_csrf_token'>csrf_token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="request_authenticity_tokens-instance_method">
  <h3 class='signature priv'>
    #<strong>request_authenticity_tokens</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Possible authenticity tokens sent in the request.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L476-L478'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='476' data-end='478'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 476</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_request_authenticity_tokens'>request_authenticity_tokens</span> <span class='comment'># :doc:
</span>  [<span class='id identifier rubyid_form_authenticity_param'><a href="#form_authenticity_param-instance_method" title="ActionController::RequestForgeryProtection#form_authenticity_param (method)">form_authenticity_param</a></span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_x_csrf_token'>x_csrf_token</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset_csrf_token-instance_method">
  <h3 class='signature '>
    #<strong>reset_csrf_token</strong>(request)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L371-L374'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='371' data-end='374'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 371</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_csrf_token'>reset_csrf_token</span>(<span class='id identifier rubyid_request'>request</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='const'><a href="#CSRF_TOKEN-constant" title="ActionController::RequestForgeryProtection::CSRF_TOKEN (constant)">CSRF_TOKEN</a></span>)
  <span class='id identifier rubyid_csrf_token_storage_strategy'>csrf_token_storage_strategy</span>.<span class='id identifier rubyid_reset'>reset</span>(<span class='id identifier rubyid_request'>request</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unmask_token-instance_method">
  <h3 class='signature priv'>
    #<strong>unmask_token</strong>(masked_token)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L532-L537'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='532' data-end='537'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 532</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unmask_token'>unmask_token</span>(<span class='id identifier rubyid_masked_token'>masked_token</span>) <span class='comment'># :doc:
</span>  <span class='comment'># Split the token into the one-time pad and the encrypted value and decrypt it.
</span>  <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_masked_token'>masked_token</span>[<span class='int'>0</span><span class='op'>...</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span>]
  <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_masked_token'>masked_token</span>[<span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>]
  <span class='id identifier rubyid_xor_byte_strings'><a href="#xor_byte_strings-instance_method" title="ActionController::RequestForgeryProtection#xor_byte_strings (method)">xor_byte_strings</a></span>(<span class='id identifier rubyid_one_time_pad'>one_time_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unverified_request_warning_message-instance_method">
  <h3 class='signature priv'>
    #<strong>unverified_request_warning_message</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L411-L417'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='411' data-end='417'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 411</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unverified_request_warning_message'>unverified_request_warning_message</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_valid_request_origin?'><a href="#valid_request_origin%3F-instance_method" title="ActionController::RequestForgeryProtection#valid_request_origin? (method)">valid_request_origin?</a></span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t verify CSRF token authenticity.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP Origin header (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_origin'>origin</span><span class='embexpr_end'>}</span><span class='tstring_content'>) didn&#39;t match request.base_url (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_base_url'>base_url</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_authenticity_token?-instance_method">
  <h3 class='signature priv'>
    #<strong>valid_authenticity_token?</strong>(session, encoded_masked_token)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks the client’s masked token to see if it matches the session token. Essentially the inverse of <a href="#masked_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#masked_authenticity_token (method)">#masked_authenticity_token</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L502-L530'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='502' data-end='530'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 502</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_authenticity_token?'>valid_authenticity_token?</span>(<span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span>) <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../String.html" title="String (class)">String</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_masked_token'>masked_token</span> <span class='op'>=</span> <span class='id identifier rubyid_decode_csrf_token'><a href="#decode_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#decode_csrf_token (method)">decode_csrf_token</a></span>(<span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span>)
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='comment'># encoded_masked_token is invalid Base64
</span>    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># See if it&#39;s actually a masked token or not. In order to deploy this code, we
</span>  <span class='comment'># should be able to handle any unmasked tokens that we&#39;ve issued without error.
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_masked_token'>masked_token</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span>
    <span class='comment'># This is actually an unmasked token. This is expected if you have just upgraded
</span>    <span class='comment'># to masked tokens, but should stop happening shortly after installing this gem.
</span>    <span class='id identifier rubyid_compare_with_real_token'><a href="#compare_with_real_token-instance_method" title="ActionController::RequestForgeryProtection#compare_with_real_token (method)">compare_with_real_token</a></span> <span class='id identifier rubyid_masked_token'>masked_token</span>

  <span class='kw'>elsif</span> <span class='id identifier rubyid_masked_token'>masked_token</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span> <span class='op'>*</span> <span class='int'>2</span>
    <span class='id identifier rubyid_csrf_token'>csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_unmask_token'><a href="#unmask_token-instance_method" title="ActionController::RequestForgeryProtection#unmask_token (method)">unmask_token</a></span>(<span class='id identifier rubyid_masked_token'>masked_token</span>)

    <span class='id identifier rubyid_compare_with_global_token'><a href="#compare_with_global_token-instance_method" title="ActionController::RequestForgeryProtection#compare_with_global_token (method)">compare_with_global_token</a></span>(<span class='id identifier rubyid_csrf_token'>csrf_token</span>) <span class='op'>||</span>
      <span class='id identifier rubyid_compare_with_real_token'><a href="#compare_with_real_token-instance_method" title="ActionController::RequestForgeryProtection#compare_with_real_token (method)">compare_with_real_token</a></span>(<span class='id identifier rubyid_csrf_token'>csrf_token</span>) <span class='op'>||</span>
      <span class='id identifier rubyid_valid_per_form_csrf_token?'><a href="#valid_per_form_csrf_token%3F-instance_method" title="ActionController::RequestForgeryProtection#valid_per_form_csrf_token? (method)">valid_per_form_csrf_token?</a></span>(<span class='id identifier rubyid_csrf_token'>csrf_token</span>)
  <span class='kw'>else</span>
    <span class='kw'>false</span> <span class='comment'># Token is malformed.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="valid_per_form_csrf_token?-instance_method">
  <h3 class='signature priv'>
    #<strong>valid_per_form_csrf_token?</strong>(token, session = nil)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L554-L566'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='554' data-end='566'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 554</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_per_form_csrf_token?'>valid_per_form_csrf_token?</span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='kw'>nil</span>) <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span>
    <span class='id identifier rubyid_correct_token'>correct_token</span> <span class='op'>=</span> <span class='id identifier rubyid_per_form_csrf_token'><a href="#per_form_csrf_token-instance_method" title="ActionController::RequestForgeryProtection#per_form_csrf_token (method)">per_form_csrf_token</a></span>(
      <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
      <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_path'>path</span>.<span class='id identifier rubyid_chomp'>chomp</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>)<span class='comma'>,</span>
      <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_request_method'>request_method</span>
    )

    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span>.<span class='id identifier rubyid_fixed_length_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#fixed_length_secure_compare-class_method" title="ActiveSupport::SecurityUtils.fixed_length_secure_compare (method)">fixed_length_secure_compare</a></span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_correct_token'>correct_token</span>)
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_authenticity_token-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_authenticity_token</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The actual before_action that is used to verify the CSRF token. Don’t override this directly. Provide your own forgery protection strategy instead. If you override, you’ll disable same-origin <code><script></code> verification.</p>

<p>Lean on the protect_from_forgery declaration to mark which actions are due for same-origin request verification. If protect_from_forgery is enabled on an action, this before_action flags its after_action to verify that JavaScript responses are for XHR requests, ensuring they follow the browser’s same-origin policy.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L391-L399'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='391' data-end='399'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 391</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_authenticity_token'>verify_authenticity_token</span> <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_mark_for_same_origin_verification!'><a href="#mark_for_same_origin_verification!-instance_method" title="ActionController::RequestForgeryProtection#mark_for_same_origin_verification! (method)">mark_for_same_origin_verification!</a></span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_verified_request?'><a href="#verified_request%3F-instance_method" title="ActionController::RequestForgeryProtection#verified_request? (method)">verified_request?</a></span>
    <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_warn'>warn</span> <span class='id identifier rubyid_unverified_request_warning_message'><a href="#unverified_request_warning_message-instance_method" title="ActionController::RequestForgeryProtection#unverified_request_warning_message (method)">unverified_request_warning_message</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>

    <span class='id identifier rubyid_handle_unverified_request'><a href="#handle_unverified_request-instance_method" title="ActionController::RequestForgeryProtection#handle_unverified_request (method)">handle_unverified_request</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_same_origin_request-instance_method">
  <h3 class='signature priv'>
    #<strong>verify_same_origin_request</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If <a href="#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">#verify_authenticity_token</a> was run (indicating that we have forgery protection enabled for this request) then also verify that we aren’t serving an unauthorized cross-origin response.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L429-L436'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='429' data-end='436'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 429</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_same_origin_request'>verify_same_origin_request</span> <span class='comment'># :doc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_marked_for_same_origin_verification?'><a href="#marked_for_same_origin_verification%3F-instance_method" title="ActionController::RequestForgeryProtection#marked_for_same_origin_verification? (method)">marked_for_same_origin_verification?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_non_xhr_javascript_response?'><a href="#non_xhr_javascript_response%3F-instance_method" title="ActionController::RequestForgeryProtection#non_xhr_javascript_response? (method)">non_xhr_javascript_response?</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
      <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_warn'>warn</span> <span class='const'><a href="#CROSS_ORIGIN_JAVASCRIPT_WARNING-constant" title="ActionController::RequestForgeryProtection::CROSS_ORIGIN_JAVASCRIPT_WARNING (constant)">CROSS_ORIGIN_JAVASCRIPT_WARNING</a></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="InvalidCrossOriginRequest.html" title="ActionController::InvalidCrossOriginRequest (class)">InvalidCrossOriginRequest</a></span><span class='comma'>,</span> <span class='const'><a href="#CROSS_ORIGIN_JAVASCRIPT_WARNING-constant" title="ActionController::RequestForgeryProtection::CROSS_ORIGIN_JAVASCRIPT_WARNING (constant)">CROSS_ORIGIN_JAVASCRIPT_WARNING</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="xor_byte_strings-instance_method">
  <h3 class='signature priv'>
    #<strong>xor_byte_strings</strong>(s1, s2)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L595-L604'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='595' data-end='604'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 595</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span>(<span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_bytesize'>bytesize</span>
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_setbyte'>setbyte</span>(<span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_s1'>s1</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='id identifier rubyid_i'>i</span>) <span class='op'>^</span> <span class='id identifier rubyid_s2'>s2</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='id identifier rubyid_i'>i</span>))
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_s2'>s2</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>