<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::AutosaveAssociation &mdash; Rails 8-0-stable</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::AutosaveAssociation",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails 8-0-stable</a> &raquo; 
      <a href='../_index.html#alpha_A'>Index (A)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>AutosaveAssociation&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::AutosaveAssociation</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a class='nodoc' href="AutosaveAssociation/AssociationBuilderExtension.html" title="ActiveRecord::AutosaveAssociation::AssociationBuilderExtension (module)"><code>AssociationBuilderExtension</code></a>,
        <a class='nodoc' href="AutosaveAssociation/ClassMethods.html" title="ActiveRecord::AutosaveAssociation::ClassMethods (module)"><code>ClassMethods</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="ActiveRecord::Base (class)"><code>Base</code></a>
      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L140'>activerecord/lib/active_record/autosave_association.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>AutosaveAssociation</code> is a module that takes care of automatically saving associated records when their parent is saved. In addition to saving, it also destroys any associated records that were marked for destruction. (See <a href="#mark_for_destruction-instance_method" title="ActiveRecord::AutosaveAssociation#mark_for_destruction (method)">#mark_for_destruction</a> and <a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">#marked_for_destruction?</a>).</p>

<p>Saving of the parent, its associations, and the destruction of marked associations, all happen inside a transaction. This should never leave the database in an inconsistent state.</p>

<p>If validations for any of the associations fail, their error messages will be applied to the parent.</p>

<p>Note that it also means that associations marked for destruction won’t be destroyed directly. They will however still be marked for destruction.</p>

<p>Note that <code>autosave: false</code> is not same as not declaring <code>:autosave</code>. When the <code>:autosave</code> option is not present then new association records are saved but the updated association records are not saved.</p>

<h3 id="label-Validation">Validation</h3>

<p>Child records are validated unless <code>:validate</code> is <code>false</code>.</p>

<h3 id="label-Callbacks">Callbacks</h3>

<p>Association with autosave option defines several callbacks on your model (around_save, before_save, after_create, after_update). Please note that callbacks are executed in the order they were defined in model. You should avoid modifying the association content before autosave callbacks are executed. Placing your callbacks after associations is usually a good practice.</p>

<h4 id="label-One-to-one+Example">One-to-one Example</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_one'>has_one</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span><span class='comma'>,</span> <span class='label'>autosave:</span> <span class='kw'>true</span>
<span class='kw'>end</span></code></pre>

<p>Saving changes to the parent and its associated model can now be performed automatically <em>and</em> atomically:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_title'>title</span>       <span class='comment'># =&gt; &quot;The current global position of migrating ducks&quot;
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &quot;alloy&quot;
</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_title'>title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>On the migration of ducks</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloy Duran</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_reload'><a href="#reload-instance_method" title="ActiveRecord::AutosaveAssociation#reload (method)">reload</a></span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_title'>title</span>       <span class='comment'># =&gt; &quot;On the migration of ducks&quot;
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; &quot;Eloy Duran&quot;</span></code></pre>

<p>Destroying an associated model, as part of the parent’s save action, is as simple as marking it for destruction:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_mark_for_destruction'><a href="#mark_for_destruction-instance_method" title="ActiveRecord::AutosaveAssociation#mark_for_destruction (method)">mark_for_destruction</a></span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span> <span class='comment'># =&gt; true</span></code></pre>

<p>Note that the model is <em>not</em> yet removed from the database:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_id'>id</span>
<span class='const'>Author</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>id:</span> <span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># =&gt; false
</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_reload'><a href="#reload-instance_method" title="ActiveRecord::AutosaveAssociation#reload (method)">reload</a></span>.<span class='id identifier rubyid_author'>author</span> <span class='comment'># =&gt; nil</span></code></pre>

<p>Now it <em>is</em> removed from the database:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Author</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>id:</span> <span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># =&gt; true</span></code></pre>

<h4 id="label-One-to-many+Example">One-to-many Example</h4>

<p>When <code>:autosave</code> is not declared new children are saved when their parent is saved:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span> <span class='comment'># :autosave option is not declared
</span><span class='kw'>end</span>

<span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby rocks</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span> <span class='comment'># =&gt; saves both post and comment
</span>
<span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby rocks</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span> <span class='comment'># =&gt; saves both post and comment
</span>
<span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby rocks</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_comment'>comment</span>.<span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hi everyone</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span> <span class='comment'># =&gt; saves post, but not comment</span></code></pre>

<p>When <code>:autosave</code> is true all children are saved, no matter whether they are new records or not:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span><span class='comma'>,</span> <span class='label'>autosave:</span> <span class='kw'>true</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_post'>post</span> <span class='op'>=</span> <span class='const'>Post</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby rocks</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_comment'>comment</span>.<span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hi everyone</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>body:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>good morning.</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span> <span class='comment'># =&gt; saves post and both comments.</span></code></pre>

<p>Destroying one of the associated models as part of the parent’s save action is as simple as marking it for destruction:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span> <span class='comment'># =&gt; [#&lt;Comment id: 1, ...&gt;, #&lt;Comment id: 2, ...]&gt;
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>[<span class='int'>1</span>].<span class='id identifier rubyid_mark_for_destruction'><a href="#mark_for_destruction-instance_method" title="ActiveRecord::AutosaveAssociation#mark_for_destruction (method)">mark_for_destruction</a></span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>[<span class='int'>1</span>].<span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span> <span class='comment'># =&gt; true
</span><span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_length'>length</span> <span class='comment'># =&gt; 2</span></code></pre>

<p>Note that the model is <em>not</em> yet removed from the database:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_id'>id</span>
<span class='const'>Comment</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>id:</span> <span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># =&gt; false
</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_save'>save</span>
<span class='id identifier rubyid_post'>post</span>.<span class='id identifier rubyid_reload'><a href="#reload-instance_method" title="ActiveRecord::AutosaveAssociation#reload (method)">reload</a></span>.<span class='id identifier rubyid_comments'>comments</span>.<span class='id identifier rubyid_length'>length</span> <span class='comment'># =&gt; 1</span></code></pre>

<p>Now it <em>is</em> removed from the database:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Comment</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>id:</span> <span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_nil?'>nil?</span> <span class='comment'># =&gt; true</span></code></pre>

<h4 id="label-Caveats">Caveats</h4>

<p>Note that autosave will only trigger for already-persisted association records if the records themselves have been changed. This is to protect against <code>SystemStackError</code> caused by circular association validations. The one exception is if a custom validation context is used, in which case the validations will always fire on the associated records.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)"><code>::ActiveSupport::Concern</code></a> - Extended</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a></td>
      <td><div class='inline'><p>Define class methods from given block.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../ActiveSupport/Concern.html#prepended-instance_method" title="ActiveSupport::Concern#prepended (method)">prepended</a></td>
      <td><div class='inline'><p>Evaluate given block in context of base class, so that you can write class macros here.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>,
        <a class='i_m nodoc' href="../ActiveSupport/Concern.html#prepend_features-instance_method" title="ActiveSupport::Concern#prepend_features (method)">prepend_features</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#changed_for_autosave%3F-instance_method" title="#changed_for_autosave? (instance method)">#<strong>changed_for_autosave?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not this record has been changed in any way (including whether any of its nested autosave associations are likewise changed).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#destroyed_by_association-instance_method" title="#destroyed_by_association (instance method)">#<strong>destroyed_by_association</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the association for the parent being destroyed.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#destroyed_by_association=-instance_method" title="#destroyed_by_association= (instance method)">#<strong>destroyed_by_association=</strong>(reflection)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Records the association that is being destroyed and destroying this record in the process.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#marked_for_destruction%3F-instance_method" title="#marked_for_destruction? (instance method)">#<strong>marked_for_destruction?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not this record will be destroyed as part of the parent’s save transaction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#nested_records_changed_for_autosave%3F-instance_method" title="#nested_records_changed_for_autosave? (instance method)">#<strong>nested_records_changed_for_autosave?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Go through nested autosave associations that are loaded in memory (without loading any new ones), and return true if any are changed for autosave.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#autosaving_belongs_to_for%3F-instance_method" title="#autosaving_belongs_to_for? (instance method)">#<strong>autosaving_belongs_to_for?</strong>(association)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#mark_for_destruction-instance_method" title="#mark_for_destruction (instance method)">#<strong>mark_for_destruction</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Marks this record to be destroyed as part of the parent’s save transaction.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reload-instance_method" title="#reload (instance method)">#<strong>reload</strong>(options = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reloads the attributes of the object as usual and clears <code>marked_for_destruction</code> flag.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#validating_belongs_to_for%3F-instance_method" title="#validating_belongs_to_for? (instance method)">#<strong>validating_belongs_to_for?</strong>(association)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_ensure_no_duplicate_errors-instance_method" title="#_ensure_no_duplicate_errors (instance method)">#<strong>_ensure_no_duplicate_errors</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#_record_changed%3F-instance_method" title="#_record_changed? (instance method)">#<strong>_record_changed?</strong>(reflection, record, key)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>If the record is new or it has changed, returns true.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#around_save_collection_association-instance_method" title="#around_save_collection_association (instance method)">#<strong>around_save_collection_association</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Is used as an around_save callback to check while saving a collection association whether or not the parent was a new record before saving.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#associated_records_to_validate_or_save-instance_method" title="#associated_records_to_validate_or_save (instance method)">#<strong>associated_records_to_validate_or_save</strong>(association, new_record, autosave)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the record for an association collection that should be validated or saved.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#association_foreign_key_changed%3F-instance_method" title="#association_foreign_key_changed? (instance method)">#<strong>association_foreign_key_changed?</strong>(reflection, record, key)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#association_valid%3F-instance_method" title="#association_valid? (instance method)">#<strong>association_valid?</strong>(association, record)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not the association is valid and applies any errors to the parent, <code>self</code>, if it wasn’t.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compute_primary_key-instance_method" title="#compute_primary_key (instance method)">#<strong>compute_primary_key</strong>(reflection, record)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#init_internals-instance_method" title="#init_internals (instance method)">#<strong>init_internals</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#inverse_polymorphic_association_changed%3F-instance_method" title="#inverse_polymorphic_association_changed? (instance method)">#<strong>inverse_polymorphic_association_changed?</strong>(reflection, record)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#save_belongs_to_association-instance_method" title="#save_belongs_to_association (instance method)">#<strong>save_belongs_to_association</strong>(reflection)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Saves the associated record if it’s new or <code>:autosave</code> is enabled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#save_collection_association-instance_method" title="#save_collection_association (instance method)">#<strong>save_collection_association</strong>(reflection)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Saves any new associated records, or all loaded autosave associations if <code>:autosave</code> is enabled on the association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#save_has_one_association-instance_method" title="#save_has_one_association (instance method)">#<strong>save_has_one_association</strong>(reflection)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Saves the associated record if it’s new or <code>:autosave</code> is enabled on the association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_belongs_to_association-instance_method" title="#validate_belongs_to_association (instance method)">#<strong>validate_belongs_to_association</strong>(reflection)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validate the association if <code>:validate</code> or <code>:autosave</code> is turned on for the belongs_to association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_collection_association-instance_method" title="#validate_collection_association (instance method)">#<strong>validate_collection_association</strong>(reflection)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validate the associated records if <code>:validate</code> or <code>:autosave</code> is turned on for the association specified by <code>reflection</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#validate_has_one_association-instance_method" title="#validate_has_one_association (instance method)">#<strong>validate_has_one_association</strong>(reflection)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Validate the association if <code>:validate</code> or <code>:autosave</code> is turned on for the has_one association.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>DSL Calls</h2>
<section class='method_details first' id="included-dslcall">
<h3 class='signature'><strong>included</strong></h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L153-L155'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num'>


153
154
155</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 153</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
  <span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/Builder.html" title="ActiveRecord::Associations::Builder (module)">Builder</a></span><span class='op'>::</span><span class='const'><a href="Associations/Builder/Association.html" title="ActiveRecord::Associations::Builder::Association (class)">Association</a></span>.<span class='id identifier rubyid_extensions'><a href="Associations/Builder/Association.html#extensions-class_method" title="ActiveRecord::Associations::Builder::Association.extensions (method)">extensions</a></span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="AutosaveAssociation/AssociationBuilderExtension.html" title="ActiveRecord::AutosaveAssociation::AssociationBuilderExtension (module)">AssociationBuilderExtension</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="changed_for_autosave?-instance_method">
  <h3 class='signature ro first'>
    #<strong>changed_for_autosave?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not this record has been changed in any way (including whether any of its nested autosave associations are likewise changed)</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L275-L277'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='275' data-end='277'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 275</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_changed_for_autosave?'>changed_for_autosave?</span>
  <span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>||</span> <span class='id identifier rubyid_has_changes_to_save?'>has_changes_to_save?</span> <span class='op'>||</span> <span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_nested_records_changed_for_autosave?'><a href="#nested_records_changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#nested_records_changed_for_autosave? (method)">nested_records_changed_for_autosave?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroyed_by_association-instance_method">
  <h3 class='signature rw'>
    #<strong>destroyed_by_association</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the association for the parent being destroyed.</p>

<p>Used to avoid updating the counter cache unnecessarily.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L269-L271'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='269' data-end='271'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 269</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroyed_by_association'>destroyed_by_association</span>
  <span class='ivar'>@destroyed_by_association</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroyed_by_association=-instance_method">
  <h3 class='signature rw'>
    #<strong>destroyed_by_association=</strong>(reflection)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Records the association that is being destroyed and destroying this record in the process.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L262-L264'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='262' data-end='264'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 262</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroyed_by_association='>destroyed_by_association=</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='ivar'>@destroyed_by_association</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="marked_for_destruction?-instance_method">
  <h3 class='signature ro'>
    #<strong>marked_for_destruction?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not this record will be destroyed as part of the parent’s save transaction.</p>

<p>Only useful if the <code>:autosave</code> option on the parent is enabled for this associated model.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L256-L258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='256' data-end='258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 256</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_marked_for_destruction?'>marked_for_destruction?</span>
  <span class='ivar'>@marked_for_destruction</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="nested_records_changed_for_autosave?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>nested_records_changed_for_autosave?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Go through nested autosave associations that are loaded in memory (without loading any new ones), and return true if any are changed for autosave. Returns false if already called to prevent an infinite loop.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L311-L325'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='311' data-end='325'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 311</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_nested_records_changed_for_autosave?'>nested_records_changed_for_autosave?</span>
  <span class='ivar'>@_nested_records_changed_for_autosave_already_called</span> <span class='op'>||=</span> <span class='kw'>false</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='ivar'>@_nested_records_changed_for_autosave_already_called</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@_nested_records_changed_for_autosave_already_called</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__reflections'>_reflections</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_reflection'>reflection</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>]
        <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
        <span class='id identifier rubyid_association'>association</span> <span class='op'>&amp;&amp;</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_wrap'><a href="../Array.html#wrap-class_method" title="Array.wrap (method)">wrap</a></span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_target'>target</span>).<span class='id identifier rubyid_any?'>any?</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>ensure</span>
    <span class='ivar'>@_nested_records_changed_for_autosave_already_called</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_ensure_no_duplicate_errors-instance_method">
  <h3 class='signature priv first'>
    #<strong>_ensure_no_duplicate_errors</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L592-L594'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='592' data-end='594'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 592</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__ensure_no_duplicate_errors'>_ensure_no_duplicate_errors</span>
  <span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_uniq!'>uniq!</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_record_changed?-instance_method">
  <h3 class='signature priv'>
    #<strong>_record_changed?</strong>(reflection, record, key)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the record is new or it has changed, returns true.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L510-L515'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='510' data-end='515'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 510</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__record_changed?'>_record_changed?</span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span>)
  <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>||</span>
    (<span class='id identifier rubyid_association_foreign_key_changed?'><a href="#association_foreign_key_changed%3F-instance_method" title="ActiveRecord::AutosaveAssociation#association_foreign_key_changed? (method)">association_foreign_key_changed?</a></span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span>) <span class='op'>||</span>
    <span class='id identifier rubyid_inverse_polymorphic_association_changed?'><a href="#inverse_polymorphic_association_changed%3F-instance_method" title="ActiveRecord::AutosaveAssociation#inverse_polymorphic_association_changed? (method)">inverse_polymorphic_association_changed?</a></span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)) <span class='op'>||</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_will_save_change_to_attribute?'>will_save_change_to_attribute?</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_foreign_key'>foreign_key</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="around_save_collection_association-instance_method">
  <h3 class='signature priv'>
    #<strong>around_save_collection_association</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Is used as an around_save callback to check while saving a collection association whether or not the parent was a new record before saving.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L402-L409'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='402' data-end='409'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 402</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_around_save_collection_association'>around_save_collection_association</span>
  <span class='id identifier rubyid_previously_new_record_before_save'>previously_new_record_before_save</span> <span class='op'>=</span> (<span class='ivar'>@new_record_before_save</span> <span class='op'>||=</span> <span class='kw'>false</span>)
  <span class='ivar'>@new_record_before_save</span> <span class='op'>=</span> <span class='op'>!</span><span class='id identifier rubyid_previously_new_record_before_save'>previously_new_record_before_save</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_new_record?'>new_record?</span>

  <span class='kw'>yield</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@new_record_before_save</span> <span class='op'>=</span> <span class='id identifier rubyid_previously_new_record_before_save'>previously_new_record_before_save</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="associated_records_to_validate_or_save-instance_method">
  <h3 class='signature priv'>
    #<strong>associated_records_to_validate_or_save</strong>(association, new_record, autosave)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the record for an association collection that should be validated or saved. If <code>autosave</code> is <code>false</code> only new records will be returned, unless the parent is/was a new record itself.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L298-L306'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='298' data-end='306'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 298</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_associated_records_to_validate_or_save'>associated_records_to_validate_or_save</span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_new_record'>new_record</span><span class='comma'>,</span> <span class='id identifier rubyid_autosave'>autosave</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_new_record'>new_record</span> <span class='op'>||</span> <span class='id identifier rubyid_custom_validation_context?'>custom_validation_context?</span>
    <span class='id identifier rubyid_association'>association</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_target'>target</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_autosave'>autosave</span>
    <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_find_all'>find_all</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_find_all'>find_all</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record?'>new_record?</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="association_foreign_key_changed?-instance_method">
  <h3 class='signature priv'>
    #<strong>association_foreign_key_changed?</strong>(reflection, record, key)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L517-L524'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='517' data-end='524'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 517</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_association_foreign_key_changed?'>association_foreign_key_changed?</span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_through_reflection?'>through_reflection?</span>

  <span class='id identifier rubyid_foreign_key'>foreign_key</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_foreign_key'>foreign_key</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_foreign_key'>foreign_key</span>.<span class='id identifier rubyid_all?'>all?</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__has_attribute?'>_has_attribute?</span>(<span class='id identifier rubyid_key'>key</span>) }

  <span class='id identifier rubyid_foreign_key'>foreign_key</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_key'>key</span>) } <span class='op'>!=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_key'>key</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="association_valid?-instance_method">
  <h3 class='signature priv'>
    #<strong>association_valid?</strong>(association, record)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not the association is valid and applies any errors to the parent, <code>self</code>, if it wasn’t. Skips any <code>:autosave</code> enabled records if they’re marked_for_destruction? or destroyed.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L371-L398'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='371' data-end='398'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 371</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_association_valid?'>association_valid?</span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroyed?'>destroyed?</span> <span class='op'>||</span> (<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span>)

  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_validation_context'>validation_context</span> <span class='kw'>if</span> <span class='id identifier rubyid_custom_validation_context?'>custom_validation_context?</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_valid?'>valid?</span>(<span class='id identifier rubyid_context'>context</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>||</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span>
    <span class='id identifier rubyid_associated_errors'>associated_errors</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_objects'>objects</span>
  <span class='kw'>else</span>
    <span class='comment'># If there are existing invalid records in the DB, we should still be able to reference them.
</span>    <span class='comment'># Unless a record (no matter where in the association chain) is invalid and is being changed.
</span>    <span class='id identifier rubyid_associated_errors'>associated_errors</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_objects'>objects</span>.<span class='id identifier rubyid_select'>select</span> { <span class='op'>|</span><span class='id identifier rubyid_error'>error</span><span class='op'>|</span> <span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/NestedError.html" title="ActiveRecord::Associations::NestedError (class)">NestedError</a></span>) }
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>]
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_equal?'>equal?</span>(<span class='id identifier rubyid_record'>record</span>)

    <span class='id identifier rubyid_associated_errors'>associated_errors</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_error'>error</span><span class='op'>|</span>
      <span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_objects'>objects</span>.<span class='id identifier rubyid_append'>append</span>(
        <span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/NestedError.html" title="ActiveRecord::Associations::NestedError (class)">NestedError</a></span>.<span class='id identifier rubyid_new'><a href="Associations/NestedError.html#new-class_method" title="ActiveRecord::Associations::NestedError.new (method)">new</a></span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span>)
      )
    }
  <span class='kw'>elsif</span> <span class='id identifier rubyid_associated_errors'>associated_errors</span>.<span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_add'>add</span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_any?'>any?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="autosaving_belongs_to_for?-instance_method">
  <h3 class='signature '>
    #<strong>autosaving_belongs_to_for?</strong>(association)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L284-L287'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='284' data-end='287'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 284</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_autosaving_belongs_to_for?'>autosaving_belongs_to_for?</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='ivar'>@autosaving_belongs_to_for</span> <span class='op'>||=</span> {}
  <span class='ivar'>@autosaving_belongs_to_for</span>[<span class='id identifier rubyid_association'>association</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compute_primary_key-instance_method">
  <h3 class='signature priv'>
    #<strong>compute_primary_key</strong>(reflection, record)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L576-L590'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='576' data-end='590'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 576</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compute_primary_key'>compute_primary_key</span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_primary_key_options'>primary_key_options</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_primary_key'>primary_key</span>]
    <span class='id identifier rubyid_primary_key_options'>primary_key_options</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_query_constraints'>query_constraints</span>] <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_query_constraints'>query_constraints</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>)
    <span class='id identifier rubyid_query_constraints'>query_constraints</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_has_query_constraints?'>has_query_constraints?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foreign_key'>foreign_key</span>]
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_composite_primary_key?'>composite_primary_key?</span>
    <span class='comment'># If record has composite primary key of shape [:&lt;tenant_key&gt;, :id], infer primary_key as :id
</span>    <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>
    <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_primary_key'>primary_key</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="init_internals-instance_method">
  <h3 class='signature priv'>
    #<strong>init_internals</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L290-L293'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='290' data-end='293'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 290</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_init_internals'>init_internals</span>
  <span class='kw'>super</span>
  <span class='ivar'>@_already_called</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inverse_polymorphic_association_changed?-instance_method">
  <h3 class='signature priv'>
    #<strong>inverse_polymorphic_association_changed?</strong>(reflection, record)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L526-L531'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='526' data-end='531'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 526</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inverse_polymorphic_association_changed?'>inverse_polymorphic_association_changed?</span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_inverse_of'>inverse_of</span><span class='op'>&amp;.</span><span class='id identifier rubyid_polymorphic?'>polymorphic?</span>

  <span class='id identifier rubyid_class_name'>class_name</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_inverse_of'>inverse_of</span>.<span class='id identifier rubyid_foreign_type'>foreign_type</span>)
  <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_active_record'>active_record</span>.<span class='id identifier rubyid_polymorphic_name'>polymorphic_name</span> <span class='op'>!=</span> <span class='id identifier rubyid_class_name'>class_name</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="mark_for_destruction-instance_method">
  <h3 class='signature '>
    #<strong>mark_for_destruction</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Marks this record to be destroyed as part of the parent’s save transaction. This does <em>not</em> actually destroy the record instantly, rather child record will be destroyed when <code>parent.save</code> is called.</p>

<p>Only useful if the <code>:autosave</code> option on the parent is enabled for this associated model.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L249-L251'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='249' data-end='251'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 249</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_mark_for_destruction'>mark_for_destruction</span>
  <span class='ivar'>@marked_for_destruction</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reload-instance_method">
  <h3 class='signature '>
    #<strong>reload</strong>(options = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reloads the attributes of the object as usual and clears <code>marked_for_destruction</code> flag.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L238-L242'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='238' data-end='242'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 238</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reload'>reload</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='ivar'>@marked_for_destruction</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@destroyed_by_association</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>super</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save_belongs_to_association-instance_method">
  <h3 class='signature priv'>
    #<strong>save_belongs_to_association</strong>(reflection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Saves the associated record if it’s new or <code>:autosave</code> is enabled.</p>

<p>In addition, it will destroy the association if it was marked for destruction.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L536-L574'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='536' data-end='574'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 536</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save_belongs_to_association'>save_belongs_to_association</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_association'>association</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_loaded?'>loaded?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_stale_target?'>stale_target?</span>

  <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_load_target'>load_target</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroyed?'>destroyed?</span>
    <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>]

    <span class='kw'>if</span> <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span>
      <span class='id identifier rubyid_foreign_key'>foreign_key</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_foreign_key'>foreign_key</span>)
      <span class='id identifier rubyid_foreign_key'>foreign_key</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='kw'>self</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='kw'>nil</span> }
      <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroy'>destroy</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>!=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_saved'>saved</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>||</span> (<span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span>)
        <span class='kw'>begin</span>
          <span class='ivar'>@autosaving_belongs_to_for</span> <span class='op'>||=</span> {}
          <span class='ivar'>@autosaving_belongs_to_for</span>[<span class='id identifier rubyid_association'>association</span>] <span class='op'>=</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_save'>save</span>(<span class='label'>validate:</span> <span class='op'>!</span><span class='id identifier rubyid_autosave'>autosave</span>)
        <span class='kw'>ensure</span>
          <span class='ivar'>@autosaving_belongs_to_for</span>[<span class='id identifier rubyid_association'>association</span>] <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_updated?'>updated?</span>
        <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_compute_primary_key'><a href="#compute_primary_key-instance_method" title="ActiveRecord::AutosaveAssociation#compute_primary_key (method)">compute_primary_key</a></span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)
        <span class='id identifier rubyid_foreign_key'>foreign_key</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_foreign_key'>foreign_key</span>)

        <span class='id identifier rubyid_primary_key_foreign_key_pairs'>primary_key_foreign_key_pairs</span> <span class='op'>=</span> <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_zip'>zip</span>(<span class='id identifier rubyid_foreign_key'>foreign_key</span>)
        <span class='id identifier rubyid_primary_key_foreign_key_pairs'>primary_key_foreign_key_pairs</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='comma'>,</span> <span class='id identifier rubyid_foreign_key'>foreign_key</span><span class='op'>|</span>
          <span class='id identifier rubyid_association_id'>association_id</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>)
          <span class='kw'>self</span>[<span class='id identifier rubyid_foreign_key'>foreign_key</span>] <span class='op'>=</span> <span class='id identifier rubyid_association_id'>association_id</span> <span class='kw'>unless</span> <span class='kw'>self</span>[<span class='id identifier rubyid_foreign_key'>foreign_key</span>] <span class='op'>==</span> <span class='id identifier rubyid_association_id'>association_id</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_loaded!'>loaded!</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_saved'>saved</span> <span class='kw'>if</span> <span class='id identifier rubyid_autosave'>autosave</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save_collection_association-instance_method">
  <h3 class='signature priv'>
    #<strong>save_collection_association</strong>(reflection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Saves any new associated records, or all loaded autosave associations if <code>:autosave</code> is enabled on the association.</p>

<p>In addition, it destroys all children that were marked for destruction with <a href="#mark_for_destruction-instance_method" title="ActiveRecord::AutosaveAssociation#mark_for_destruction (method)">#mark_for_destruction</a>.</p>

<p>This all happens inside a transaction, <em>if</em> the <a href="Transactions.html" title="ActiveRecord::Transactions (module)"><code>Transactions</code></a> module is included into <a href="Base.html" title="ActiveRecord::Base (class)"><code>Base</code></a> after the <code>AutosaveAssociation</code> module, which it does by default.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L419-L463'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='419' data-end='463'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 419</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save_collection_association'>save_collection_association</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
    <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>]

    <span class='comment'># By saving the instance variable in a local variable,
</span>    <span class='comment'># we make the whole callback re-entrant.
</span>    <span class='id identifier rubyid_new_record_before_save'>new_record_before_save</span> <span class='op'>=</span> <span class='ivar'>@new_record_before_save</span>

    <span class='comment'># reconstruct the scope now that we know the owner&#39;s id
</span>    <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_reset_scope'>reset_scope</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_associated_records_to_validate_or_save'><a href="#associated_records_to_validate_or_save-instance_method" title="ActiveRecord::AutosaveAssociation#associated_records_to_validate_or_save (method)">associated_records_to_validate_or_save</a></span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_new_record_before_save'>new_record_before_save</span><span class='comma'>,</span> <span class='id identifier rubyid_autosave'>autosave</span>)
      <span class='kw'>if</span> <span class='id identifier rubyid_autosave'>autosave</span>
        <span class='id identifier rubyid_records_to_destroy'>records_to_destroy</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_select'>select</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span>)
        <span class='id identifier rubyid_records_to_destroy'>records_to_destroy</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_destroy'>destroy</span>(<span class='id identifier rubyid_record'>record</span>) }
        <span class='id identifier rubyid_records'>records</span> <span class='op'>-=</span> <span class='id identifier rubyid_records_to_destroy'>records_to_destroy</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroyed?'>destroyed?</span>

        <span class='id identifier rubyid_saved'>saved</span> <span class='op'>=</span> <span class='kw'>true</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>!=</span> <span class='kw'>false</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_new_record_before_save'>new_record_before_save</span> <span class='op'>||</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span>)
          <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_set_inverse_instance'>set_inverse_instance</span>(<span class='id identifier rubyid_record'>record</span>)

          <span class='kw'>if</span> <span class='id identifier rubyid_autosave'>autosave</span>
            <span class='id identifier rubyid_saved'>saved</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_insert_record'>insert_record</span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='kw'>false</span>)
          <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_nested?'>nested?</span>
            <span class='id identifier rubyid_association_saved'>association_saved</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_insert_record'>insert_record</span>(<span class='id identifier rubyid_record'>record</span>)

            <span class='kw'>if</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_validate?'>validate?</span>
              <span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_add'>add</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_association_saved'>association_saved</span>
              <span class='id identifier rubyid_saved'>saved</span> <span class='op'>=</span> <span class='id identifier rubyid_association_saved'>association_saved</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_autosave'>autosave</span>
          <span class='id identifier rubyid_saved'>saved</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_save'>save</span>(<span class='label'>validate:</span> <span class='kw'>false</span>)
        <span class='kw'>end</span>

        <span class='id identifier rubyid_raise'>raise</span>(<span class='const'><a href="RecordInvalid.html" title="ActiveRecord::RecordInvalid (class)">RecordInvalid</a></span>.<span class='id identifier rubyid_new'><a href="RecordInvalid.html#new-class_method" title="ActiveRecord::RecordInvalid.new (method)">new</a></span>(<span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_owner'>owner</span>)) <span class='kw'>unless</span> <span class='id identifier rubyid_saved'>saved</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save_has_one_association-instance_method">
  <h3 class='signature priv'>
    #<strong>save_has_one_association</strong>(reflection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Saves the associated record if it’s new or <code>:autosave</code> is enabled on the association.</p>

<p>In addition, it will destroy the association if it was marked for destruction with <a href="#mark_for_destruction-instance_method" title="ActiveRecord::AutosaveAssociation#mark_for_destruction (method)">#mark_for_destruction</a>.</p>

<p>This all happens inside a transaction, <em>if</em> the <a href="Transactions.html" title="ActiveRecord::Transactions (module)"><code>Transactions</code></a> module is included into <a href="Base.html" title="ActiveRecord::Base (class)"><code>Base</code></a> after the <code>AutosaveAssociation</code> module, which it does by default.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L473-L507'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='473' data-end='507'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 473</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save_has_one_association'>save_has_one_association</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_association'>association</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_loaded?'>loaded?</span>

  <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_load_target'>load_target</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_record'>record</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroyed?'>destroyed?</span>

  <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>]

  <span class='kw'>if</span> <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_marked_for_destruction?'><a href="#marked_for_destruction%3F-instance_method" title="ActiveRecord::AutosaveAssociation#marked_for_destruction? (method)">marked_for_destruction?</a></span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_destroy'>destroy</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>!=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_compute_primary_key'><a href="#compute_primary_key-instance_method" title="ActiveRecord::AutosaveAssociation#compute_primary_key (method)">compute_primary_key</a></span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='kw'>self</span>)).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)
    <span class='id identifier rubyid_primary_key_value'>primary_key_value</span> <span class='op'>=</span> <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_key'>key</span>) }
    <span class='kw'>return</span> <span class='kw'>unless</span> (<span class='id identifier rubyid_autosave'>autosave</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span>) <span class='op'>||</span> <span class='id identifier rubyid__record_changed?'><a href="#_record_changed%3F-instance_method" title="ActiveRecord::AutosaveAssociation#_record_changed? (method)">_record_changed?</a></span>(<span class='id identifier rubyid_reflection'>reflection</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_primary_key_value'>primary_key_value</span>)

    <span class='kw'>unless</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_through_reflection'>through_reflection</span>
      <span class='id identifier rubyid_foreign_key'>foreign_key</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_foreign_key'>foreign_key</span>)
      <span class='id identifier rubyid_primary_key_foreign_key_pairs'>primary_key_foreign_key_pairs</span> <span class='op'>=</span> <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_zip'>zip</span>(<span class='id identifier rubyid_foreign_key'>foreign_key</span>)

      <span class='id identifier rubyid_primary_key_foreign_key_pairs'>primary_key_foreign_key_pairs</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='comma'>,</span> <span class='id identifier rubyid_foreign_key'>foreign_key</span><span class='op'>|</span>
        <span class='id identifier rubyid_association_id'>association_id</span> <span class='op'>=</span> <span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>)
        <span class='id identifier rubyid_record'>record</span>[<span class='id identifier rubyid_foreign_key'>foreign_key</span>] <span class='op'>=</span> <span class='id identifier rubyid_association_id'>association_id</span> <span class='kw'>unless</span> <span class='id identifier rubyid_record'>record</span>[<span class='id identifier rubyid_foreign_key'>foreign_key</span>] <span class='op'>==</span> <span class='id identifier rubyid_association_id'>association_id</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_set_inverse_instance'>set_inverse_instance</span>(<span class='id identifier rubyid_record'>record</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_inverse_association'>inverse_association</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_inverse_of'>inverse_of</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_association'>association</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_inverse_of'>inverse_of</span>.<span class='id identifier rubyid_name'>name</span>)
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_inverse_association'>inverse_association</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_autosaving_belongs_to_for?'><a href="#autosaving_belongs_to_for%3F-instance_method" title="ActiveRecord::AutosaveAssociation#autosaving_belongs_to_for? (method)">autosaving_belongs_to_for?</a></span>(<span class='id identifier rubyid_inverse_association'>inverse_association</span>)

    <span class='id identifier rubyid_saved'>saved</span> <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_save'>save</span>(<span class='label'>validate:</span> <span class='op'>!</span><span class='id identifier rubyid_autosave'>autosave</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_saved'>saved</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_autosave'>autosave</span>
    <span class='id identifier rubyid_saved'>saved</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_belongs_to_association-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_belongs_to_association</strong>(reflection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validate the association if <code>:validate</code> or <code>:autosave</code> is turned on for the belongs_to association.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L343-L355'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='343' data-end='355'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 343</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_belongs_to_association'>validate_belongs_to_association</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_record'>record</span>      <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_reader'>reader</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_record'>record</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_custom_validation_context?'>custom_validation_context?</span>)

  <span class='kw'>begin</span>
    <span class='ivar'>@validating_belongs_to_for</span> <span class='op'>||=</span> {}
    <span class='ivar'>@validating_belongs_to_for</span>[<span class='id identifier rubyid_association'>association</span>] <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_association_valid?'><a href="#association_valid%3F-instance_method" title="ActiveRecord::AutosaveAssociation#association_valid? (method)">association_valid?</a></span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>ensure</span>
    <span class='ivar'>@validating_belongs_to_for</span>[<span class='id identifier rubyid_association'>association</span>] <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_collection_association-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_collection_association</strong>(reflection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validate the associated records if <code>:validate</code> or <code>:autosave</code> is turned on for the association specified by <code>reflection</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L360-L366'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='360' data-end='366'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 360</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_collection_association'>validate_collection_association</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_associated_records_to_validate_or_save'><a href="#associated_records_to_validate_or_save-instance_method" title="ActiveRecord::AutosaveAssociation#associated_records_to_validate_or_save (method)">associated_records_to_validate_or_save</a></span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_new_record?'>new_record?</span><span class='comma'>,</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_autosave'>autosave</span>])
      <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_association_valid?'><a href="#association_valid%3F-instance_method" title="ActiveRecord::AutosaveAssociation#association_valid? (method)">association_valid?</a></span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>) }
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validate_has_one_association-instance_method">
  <h3 class='signature priv'>
    #<strong>validate_has_one_association</strong>(reflection)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Validate the association if <code>:validate</code> or <code>:autosave</code> is turned on for the has_one association.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L329-L339'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='329' data-end='339'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 329</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_has_one_association'>validate_has_one_association</span>(<span class='id identifier rubyid_reflection'>reflection</span>)
  <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association_instance_get'>association_instance_get</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_record'>record</span>      <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_association'>association</span>.<span class='id identifier rubyid_reader'>reader</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_record'>record</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_changed_for_autosave?'><a href="#changed_for_autosave%3F-instance_method" title="ActiveRecord::AutosaveAssociation#changed_for_autosave? (method)">changed_for_autosave?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_custom_validation_context?'>custom_validation_context?</span>)

  <span class='id identifier rubyid_inverse_association'>inverse_association</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_inverse_of'>inverse_of</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_association'>association</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_inverse_of'>inverse_of</span>.<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_inverse_association'>inverse_association</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_validating_belongs_to_for?'><a href="#validating_belongs_to_for%3F-instance_method" title="ActiveRecord::AutosaveAssociation#validating_belongs_to_for? (method)">validating_belongs_to_for?</a></span>(<span class='id identifier rubyid_inverse_association'>inverse_association</span>) <span class='op'>||</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_autosaving_belongs_to_for?'><a href="#autosaving_belongs_to_for%3F-instance_method" title="ActiveRecord::AutosaveAssociation#autosaving_belongs_to_for? (method)">autosaving_belongs_to_for?</a></span>(<span class='id identifier rubyid_inverse_association'>inverse_association</span>))

  <span class='id identifier rubyid_association_valid?'><a href="#association_valid%3F-instance_method" title="ActiveRecord::AutosaveAssociation#association_valid? (method)">association_valid?</a></span>(<span class='id identifier rubyid_association'>association</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="validating_belongs_to_for?-instance_method">
  <h3 class='signature '>
    #<strong>validating_belongs_to_for?</strong>(association)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/autosave_association.rb#L279-L282'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='279' data-end='282'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/autosave_association.rb', line 279</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validating_belongs_to_for?'>validating_belongs_to_for?</span>(<span class='id identifier rubyid_association'>association</span>)
  <span class='ivar'>@validating_belongs_to_for</span> <span class='op'>||=</span> {}
  <span class='ivar'>@validating_belongs_to_for</span>[<span class='id identifier rubyid_association'>association</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>