<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::ConnectionAdapters::ConnectionPool::Queue &mdash; Rails 8-0-stable</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::ConnectionAdapters::ConnectionPool::Queue",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Rails 8-0-stable</a> &raquo; 
      <a href='../../../_index.html#alpha_Q'>Index (Q)</a> &raquo; 
        <a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../../ConnectionAdapters.html" title="ActiveRecord::ConnectionAdapters (module)">ConnectionAdapters</a> &raquo; 
        <a href="../ConnectionPool.html" title="ActiveRecord::ConnectionAdapters::ConnectionPool (class)">ConnectionPool</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Queue&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveRecord::ConnectionAdapters::ConnectionPool::Queue</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a class='nodoc' href="ConnectionLeasingQueue.html" title="ActiveRecord::ConnectionAdapters::ConnectionPool::ConnectionLeasingQueue (class)">ConnectionLeasingQueue</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../../../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L12'>activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Active+Record+Connection+Pool+Queue">Active Record Connection Pool Queue</h3>

<p>Threadsafe, fair, LIFO queue.  Meant to be used by <a href="../ConnectionPool.html" title="ActiveRecord::ConnectionAdapters::ConnectionPool (class)"><code>::ActiveRecord::ConnectionAdapters::ConnectionPool</code></a> with which it shares a Monitor.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(lock = Monitor.new)  &#x21d2; Queue </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#any_waiting%3F-instance_method" title="#any_waiting? (instance method)">#<strong>any_waiting?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Test if any threads are currently waiting on the queue.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#any%3F-instance_method" title="#any? (instance method)">#<strong>any?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Test if the queue currently contains any elements.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#can_remove_no_wait%3F-instance_method" title="#can_remove_no_wait? (instance method)">#<strong>can_remove_no_wait?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>A thread can remove an element from the queue without waiting if and only if the number of currently available connections is strictly greater than the number of waiting threads.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#add-instance_method" title="#add (instance method)">#<strong>add</strong>(element)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add <code>element</code> to the queue.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#clear-instance_method" title="#clear (instance method)">#<strong>clear</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove all elements from the queue.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(element)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>If <code>element</code> is in the queue, remove and return it, or <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#num_waiting-instance_method" title="#num_waiting (instance method)">#<strong>num_waiting</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the number of threads currently waiting on this queue.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#poll-instance_method" title="#poll (instance method)">#<strong>poll</strong>(timeout = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove the head of the queue.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#internal_poll-instance_method" title="#internal_poll (instance method)">#<strong>internal_poll</strong>(timeout)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#no_wait_poll-instance_method" title="#no_wait_poll (instance method)">#<strong>no_wait_poll</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Remove and return the head of the queue if the number of available elements is strictly greater than the number of threads currently waiting.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#remove-instance_method" title="#remove (instance method)">#<strong>remove</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes and returns the head of the queue if possible, or <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#synchronize-instance_method" title="#synchronize (instance method)">#<strong>synchronize</strong>(&amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#wait_poll-instance_method" title="#wait_poll (instance method)">#<strong>wait_poll</strong>(timeout)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Waits on the queue up to <code>timeout</code> seconds, then removes and returns the head of the queue.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(lock = Monitor.new)  &#x21d2; <code>Queue</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L13-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='13' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 13</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_lock'>lock</span> <span class='op'>=</span> <span class='const'>Monitor</span>.<span class='id identifier rubyid_new'>new</span>)
  <span class='ivar'>@lock</span> <span class='op'>=</span> <span class='id identifier rubyid_lock'>lock</span>
  <span class='ivar'>@cond</span> <span class='op'>=</span> <span class='ivar'>@lock</span>.<span class='id identifier rubyid_new_cond'>new_cond</span>
  <span class='ivar'>@num_waiting</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@queue</span> <span class='op'>=</span> []
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="any?-instance_method">
  <h3 class='signature ro priv first'>
    #<strong>any?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Test if the queue currently contains any elements.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L85-L87'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='85' data-end='87'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 85</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_any?'>any?</span>
  <span class='op'>!</span><span class='ivar'>@queue</span>.<span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="any_waiting?-instance_method">
  <h3 class='signature ro'>
    #<strong>any_waiting?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Test if any threads are currently waiting on the queue.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L21-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_any_waiting?'>any_waiting?</span>
  <span class='id identifier rubyid_synchronize'><a href="#synchronize-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#synchronize (method)">synchronize</a></span> <span class='kw'>do</span>
    <span class='ivar'>@num_waiting</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="can_remove_no_wait?-instance_method">
  <h3 class='signature ro priv'>
    #<strong>can_remove_no_wait?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A thread can remove an element from the queue without waiting if and only if the number of currently available connections is strictly greater than the number of waiting threads.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L93-L95'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='93' data-end='95'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 93</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_can_remove_no_wait?'>can_remove_no_wait?</span>
  <span class='ivar'>@queue</span>.<span class='id identifier rubyid_size'><a href="../ConnectionPool.html#size-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool#size (method)">size</a></span> <span class='op'>&gt;</span> <span class='ivar'>@num_waiting</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="add-instance_method">
  <h3 class='signature  first'>
    #<strong>add</strong>(element)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add <code>element</code> to the queue.  Never blocks.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L36-L41'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='36' data-end='41'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 36</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add'>add</span>(<span class='id identifier rubyid_element'>element</span>)
  <span class='id identifier rubyid_synchronize'><a href="#synchronize-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#synchronize (method)">synchronize</a></span> <span class='kw'>do</span>
    <span class='ivar'>@queue</span>.<span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_element'>element</span>
    <span class='ivar'>@cond</span>.<span class='id identifier rubyid_signal'>signal</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear-instance_method">
  <h3 class='signature '>
    #<strong>clear</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove all elements from the queue.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L51-L55'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='51' data-end='55'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 51</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>
  <span class='id identifier rubyid_synchronize'><a href="#synchronize-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#synchronize (method)">synchronize</a></span> <span class='kw'>do</span>
    <span class='ivar'>@queue</span>.<span class='id identifier rubyid_clear'>clear</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>(element)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If <code>element</code> is in the queue, remove and return it, or <code>nil</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L44-L48'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='44' data-end='48'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 44</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_element'>element</span>)
  <span class='id identifier rubyid_synchronize'><a href="#synchronize-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#synchronize (method)">synchronize</a></span> <span class='kw'>do</span>
    <span class='ivar'>@queue</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_element'>element</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="internal_poll-instance_method">
  <h3 class='signature priv'>
    #<strong>internal_poll</strong>(timeout)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L76-L78'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='76' data-end='78'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 76</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_internal_poll'>internal_poll</span>(<span class='id identifier rubyid_timeout'>timeout</span>)
  <span class='id identifier rubyid_no_wait_poll'><a href="#no_wait_poll-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#no_wait_poll (method)">no_wait_poll</a></span> <span class='op'>||</span> (<span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_wait_poll'><a href="#wait_poll-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#wait_poll (method)">wait_poll</a></span>(<span class='id identifier rubyid_timeout'>timeout</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="no_wait_poll-instance_method">
  <h3 class='signature priv'>
    #<strong>no_wait_poll</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove and return the head of the queue if the number of available elements is strictly greater than the number of threads currently waiting.  Otherwise, return <code>nil</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L105-L107'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='105' data-end='107'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 105</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_no_wait_poll'>no_wait_poll</span>
  <span class='id identifier rubyid_remove'><a href="#remove-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#remove (method)">remove</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_can_remove_no_wait?'><a href="#can_remove_no_wait%3F-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#can_remove_no_wait? (method)">can_remove_no_wait?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="num_waiting-instance_method">
  <h3 class='signature '>
    #<strong>num_waiting</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the number of threads currently waiting on this queue.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L29-L33'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='29' data-end='33'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 29</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_num_waiting'>num_waiting</span>
  <span class='id identifier rubyid_synchronize'><a href="#synchronize-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#synchronize (method)">synchronize</a></span> <span class='kw'>do</span>
    <span class='ivar'>@num_waiting</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="poll-instance_method">
  <h3 class='signature '>
    #<strong>poll</strong>(timeout = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Remove the head of the queue.</p>

<p>If <code>timeout</code> is not given, remove and return the head of the queue if the number of available elements is strictly greater than the number of threads currently waiting (that is, don’t jump ahead in line).  Otherwise, return <code>nil</code>.</p>

<p>If <code>timeout</code> is given, block if there is no element available, waiting up to <code>timeout</code> seconds for an element to become available.</p>

<p>Raises:</p>
<ul><li>
<p><a href="../../ConnectionTimeoutError.html" title="ActiveRecord::ConnectionTimeoutError (class)"><code>::ActiveRecord::ConnectionTimeoutError</code></a> if <code>timeout</code> is given and no element</p>
</li></ul>

<p>becomes available within <code>timeout</code> seconds,</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L71-L73'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='73'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_poll'>poll</span>(<span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_synchronize'><a href="#synchronize-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#synchronize (method)">synchronize</a></span> { <span class='id identifier rubyid_internal_poll'><a href="#internal_poll-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#internal_poll (method)">internal_poll</a></span>(<span class='id identifier rubyid_timeout'>timeout</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remove-instance_method">
  <h3 class='signature priv'>
    #<strong>remove</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes and returns the head of the queue if possible, or <code>nil</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L98-L100'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='98' data-end='100'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 98</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_remove'>remove</span>
  <span class='ivar'>@queue</span>.<span class='id identifier rubyid_pop'>pop</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="synchronize-instance_method">
  <h3 class='signature priv'>
    #<strong>synchronize</strong>(&amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L80-L82'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='80' data-end='82'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 80</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_synchronize'>synchronize</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='ivar'>@lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="wait_poll-instance_method">
  <h3 class='signature priv'>
    #<strong>wait_poll</strong>(timeout)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Waits on the queue up to <code>timeout</code> seconds, then removes and returns the head of the queue.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb#L111-L132'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='111' data-end='132'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool/queue.rb', line 111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_wait_poll'>wait_poll</span>(<span class='id identifier rubyid_timeout'>timeout</span>)
  <span class='ivar'>@num_waiting</span> <span class='op'>+=</span> <span class='int'>1</span>

  <span class='id identifier rubyid_t0'>t0</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span>)
  <span class='id identifier rubyid_elapsed'>elapsed</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='const'><a href="../../../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../../../ActiveSupport/Dependencies.html" title="ActiveSupport::Dependencies (module)">Dependencies</a></span>.<span class='id identifier rubyid_interlock'><a href="../../../ActiveSupport/Dependencies.html#interlock-instance_method" title="ActiveSupport::Dependencies#interlock (method)">interlock</a></span>.<span class='id identifier rubyid_permit_concurrent_loads'>permit_concurrent_loads</span> <span class='kw'>do</span>
      <span class='ivar'>@cond</span>.<span class='id identifier rubyid_wait'>wait</span>(<span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>-</span> <span class='id identifier rubyid_elapsed'>elapsed</span>)
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_remove'><a href="#remove-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#remove (method)">remove</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_any?'><a href="#any%3F-instance_method" title="ActiveRecord::ConnectionAdapters::ConnectionPool::Queue#any? (method)">any?</a></span>

    <span class='id identifier rubyid_elapsed'>elapsed</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span>) <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_elapsed'>elapsed</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_timeout'>timeout</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>could not obtain a connection from the pool within %0.3f seconds (waited %0.3f seconds); all pooled connections were in use</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
        [<span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='id identifier rubyid_elapsed'>elapsed</span>]
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../ConnectionTimeoutError.html" title="ActiveRecord::ConnectionTimeoutError (class)">ConnectionTimeoutError</a></span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@num_waiting</span> <span class='op'>-=</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>