<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Persistence::ClassMethods &mdash; Rails 7-1-stable</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Persistence::ClassMethods",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 7-1-stable</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../Persistence.html" title="ActiveRecord::Persistence (module)">Persistence</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::Persistence::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L10'>activerecord/lib/active_record/persistence.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#has_query_constraints%3F-instance_method" title="#has_query_constraints? (instance method)">#<strong>has_query_constraints?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#build-instance_method" title="#build (instance method)">#<strong>build</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Builds an object (or multiple objects) and returns either the built object or a list of built objects.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates an object (or multiple objects) and saves it to the database, if validations pass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create!-instance_method" title="#create! (instance method)">#<strong>create!</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates an object (or multiple objects) and saves it to the database, if validations pass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(id_or_array)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the row with a primary key matching the <code>id</code> argument, using an SQL <code>DELETE</code> statement, and returns the number of rows deleted.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>(id)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Destroy an object (or multiple objects) that has the given id.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert-instance_method" title="#insert (instance method)">#<strong>insert</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts a single record into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert!-instance_method" title="#insert! (instance method)">#<strong>insert!</strong>(attributes, returning: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts a single record into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert_all-instance_method" title="#insert_all (instance method)">#<strong>insert_all</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts multiple records into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert_all!-instance_method" title="#insert_all! (instance method)">#<strong>insert_all!</strong>(attributes, returning: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts multiple records into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#instantiate-instance_method" title="#instantiate (instance method)">#<strong>instantiate</strong>(attributes, column_types = {}, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Given an attributes hash, <code>instantiate</code> returns a new instance of the appropriate class.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#query_constraints-instance_method" title="#query_constraints (instance method)">#<strong>query_constraints</strong>(*columns_list)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Accepts a list of attribute names to be used in the WHERE clause of SELECT / UPDATE / DELETE queries and in the ORDER BY clause for <code>#first</code> and <code>#last</code> finder methods.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(id = :all, attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates an object (or multiple objects) and saves it to the database, if validations pass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update!-instance_method" title="#update! (instance method)">#<strong>update!</strong>(id = :all, attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the object (or multiple objects) just like <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a> but calls <a href="#update!-instance_method" title="ActiveRecord::Persistence::ClassMethods#update! (method)">#update!</a> instead of <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a>, so an exception is raised if the record is invalid and saving will fail.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#upsert-instance_method" title="#upsert (instance method)">#<strong>upsert</strong>(attributes, **kwargs)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates or inserts (upserts) a single record into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#upsert_all-instance_method" title="#upsert_all (instance method)">#<strong>upsert_all</strong>(attributes, on_duplicate: :update, update_only: nil, returning: nil, unique_by: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates or inserts (upserts) multiple records into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_default_constraint-instance_method" title="#build_default_constraint (instance method)">#<strong>build_default_constraint</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Called by <a href="#_update_record-instance_method" title="ActiveRecord::Persistence::ClassMethods#_update_record (method)">#_update_record</a> and <a href="#_delete_record-instance_method" title="ActiveRecord::Persistence::ClassMethods#_delete_record (method)">#_delete_record</a> to build <code>where</code> clause from default scopes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#discriminate_class_for_record-instance_method" title="#discriminate_class_for_record (instance method)">#<strong>discriminate_class_for_record</strong>(record)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Called by <a href="#instantiate-instance_method" title="ActiveRecord::Persistence::ClassMethods#instantiate (method)">#instantiate</a> to decide which class to use for a new record instance.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#inherited-instance_method" title="#inherited (instance method)">#<strong>inherited</strong>(subclass)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#instantiate_instance_of-instance_method" title="#instantiate_instance_of (instance method)">#<strong>instantiate_instance_of</strong>(klass, attributes, column_types = {}, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Given a class, an attributes hash, <code>instantiate_instance_of</code> returns a new instance of the class.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_delete_record-instance_method" title="#_delete_record (instance method)">#<strong>_delete_record</strong>(constraints)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_insert_record-instance_method" title="#_insert_record (instance method)">#<strong>_insert_record</strong>(values, returning)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_update_record-instance_method" title="#_update_record (instance method)">#<strong>_update_record</strong>(values, constraints)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#composite_query_constraints_list-instance_method" title="#composite_query_constraints_list (instance method)">#<strong>composite_query_constraints_list</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of column names to be used in queries.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#query_constraints_list-instance_method" title="#query_constraints_list (instance method)">#<strong>query_constraints_list</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="has_query_constraints?-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>has_query_constraints?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L495-L497'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='495' data-end='497'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 495</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_query_constraints?'>has_query_constraints?</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@has_query_constraints</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_delete_record-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>_delete_record</strong>(constraints)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L611-L625'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='611' data-end='625'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 611</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__delete_record'>_delete_record</span>(<span class='id identifier rubyid_constraints'>constraints</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_constraints'>constraints</span> <span class='op'>=</span> <span class='id identifier rubyid_constraints'>constraints</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>[<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>] }

  <span class='id identifier rubyid_default_constraint'>default_constraint</span> <span class='op'>=</span> <span class='id identifier rubyid_build_default_constraint'><a href="#build_default_constraint-instance_method" title="ActiveRecord::Persistence::ClassMethods#build_default_constraint (method)">build_default_constraint</a></span>
  <span class='id identifier rubyid_constraints'>constraints</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_default_constraint'>default_constraint</span> <span class='kw'>if</span> <span class='id identifier rubyid_default_constraint'>default_constraint</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_current_scope'>current_scope</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_global_current_scope'>global_current_scope</span>
    <span class='id identifier rubyid_constraints'>constraints</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_current_scope'>current_scope</span>.<span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_ast'>ast</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_dm'>dm</span> <span class='op'>=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../../Arel/DeleteManager.html" title="Arel::DeleteManager (class)">DeleteManager</a></span>.<span class='id identifier rubyid_new'><a href="../../Arel/DeleteManager.html#new-class_method" title="Arel::DeleteManager.new (method)">new</a></span>(<span class='id identifier rubyid_arel_table'>arel_table</span>)
  <span class='id identifier rubyid_dm'>dm</span>.<span class='id identifier rubyid_wheres'>wheres</span> <span class='op'>=</span> <span class='id identifier rubyid_constraints'>constraints</span>

  <span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Persistence::ClassMethods#delete (method)">delete</a></span>(<span class='id identifier rubyid_dm'>dm</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'> Destroy</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_insert_record-instance_method">
  <h3 class='signature nodoc'>
    #<strong>_insert_record</strong>(values, returning)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L569-L592'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='569' data-end='592'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 569</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__insert_record'>_insert_record</span>(<span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='id identifier rubyid_returning'>returning</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>
  <span class='id identifier rubyid_primary_key_value'>primary_key_value</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_prefetch_primary_key?'>prefetch_primary_key?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_primary_key'>primary_key</span>
    <span class='id identifier rubyid_values'>values</span>[<span class='id identifier rubyid_primary_key'>primary_key</span>] <span class='op'>||=</span> <span class='kw'>begin</span>
      <span class='id identifier rubyid_primary_key_value'>primary_key_value</span> <span class='op'>=</span> <span class='id identifier rubyid_next_sequence_value'>next_sequence_value</span>
      <span class='id identifier rubyid__default_attributes'>_default_attributes</span>[<span class='id identifier rubyid_primary_key'>primary_key</span>].<span class='id identifier rubyid_with_cast_value'>with_cast_value</span>(<span class='id identifier rubyid_primary_key_value'>primary_key_value</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_im'>im</span> <span class='op'>=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../../Arel/InsertManager.html" title="Arel::InsertManager (class)">InsertManager</a></span>.<span class='id identifier rubyid_new'><a href="../../Arel/InsertManager.html#new-class_method" title="Arel::InsertManager.new (method)">new</a></span>(<span class='id identifier rubyid_arel_table'>arel_table</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_im'>im</span>.<span class='id identifier rubyid_insert'><a href="#insert-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert (method)">insert</a></span>(<span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_empty_insert_statement_value'>empty_insert_statement_value</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>))
  <span class='kw'>else</span>
    <span class='id identifier rubyid_im'>im</span>.<span class='id identifier rubyid_insert'><a href="#insert-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert (method)">insert</a></span>(<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_transform_keys'>transform_keys</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_arel_table'>arel_table</span>[<span class='id identifier rubyid_name'>name</span>] })
  <span class='kw'>end</span>

  <span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_insert'><a href="#insert-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert (method)">insert</a></span>(
    <span class='id identifier rubyid_im'>im</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'> Create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>||</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_primary_key_value'>primary_key_value</span><span class='comma'>,</span>
    <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_update_record-instance_method">
  <h3 class='signature nodoc'>
    #<strong>_update_record</strong>(values, constraints)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L594-L609'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='594' data-end='609'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 594</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__update_record'>_update_record</span>(<span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='id identifier rubyid_constraints'>constraints</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_constraints'>constraints</span> <span class='op'>=</span> <span class='id identifier rubyid_constraints'>constraints</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_predicate_builder'>predicate_builder</span>[<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>] }

  <span class='id identifier rubyid_default_constraint'>default_constraint</span> <span class='op'>=</span> <span class='id identifier rubyid_build_default_constraint'><a href="#build_default_constraint-instance_method" title="ActiveRecord::Persistence::ClassMethods#build_default_constraint (method)">build_default_constraint</a></span>
  <span class='id identifier rubyid_constraints'>constraints</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_default_constraint'>default_constraint</span> <span class='kw'>if</span> <span class='id identifier rubyid_default_constraint'>default_constraint</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_current_scope'>current_scope</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_global_current_scope'>global_current_scope</span>
    <span class='id identifier rubyid_constraints'>constraints</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_current_scope'>current_scope</span>.<span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_ast'>ast</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_um'>um</span> <span class='op'>=</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span><span class='op'>::</span><span class='const'><a href="../../Arel/UpdateManager.html" title="Arel::UpdateManager (class)">UpdateManager</a></span>.<span class='id identifier rubyid_new'><a href="../../Arel/UpdateManager.html#new-class_method" title="Arel::UpdateManager.new (method)">new</a></span>(<span class='id identifier rubyid_arel_table'>arel_table</span>)
  <span class='id identifier rubyid_um'>um</span>.<span class='id identifier rubyid_set'>set</span>(<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_transform_keys'>transform_keys</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span> <span class='id identifier rubyid_arel_table'>arel_table</span>[<span class='id identifier rubyid_name'>name</span>] })
  <span class='id identifier rubyid_um'>um</span>.<span class='id identifier rubyid_wheres'>wheres</span> <span class='op'>=</span> <span class='id identifier rubyid_constraints'>constraints</span>

  <span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_update'><a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">update</a></span>(<span class='id identifier rubyid_um'>um</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_content'> Update</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build-instance_method">
  <h3 class='signature '>
    #<strong>build</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Builds an object (or multiple objects) and returns either the built object or a list of built objects.</p>

<p>The <code>attributes</code> parameter can be either a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> or an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. These Hashes describe the attributes on the objects that are to be built.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Build a single new object
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Build an Array of new objects
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }])

<span class='comment'># Build a single object and pass it into a block to set other attributes.
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>

<span class='comment'># Building an Array of new objects using a block, where the block is executed for each object:
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L82-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='82' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 82</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build'>build</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_build'>build</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_default_constraint-instance_method">
  <h3 class='signature priv'>
    #<strong>build_default_constraint</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Called by <a href="#_update_record-instance_method" title="ActiveRecord::Persistence::ClassMethods#_update_record (method)">#_update_record</a> and <a href="#_delete_record-instance_method" title="ActiveRecord::Persistence::ClassMethods#_delete_record (method)">#_delete_record</a> to build <code>where</code> clause from default scopes. Skips empty scopes.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L655-L660'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='655' data-end='660'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 655</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_default_constraint'>build_default_constraint</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_default_scopes?'>default_scopes?</span>(<span class='label'>all_queries:</span> <span class='kw'>true</span>)

  <span class='id identifier rubyid_default_where_clause'>default_where_clause</span> <span class='op'>=</span> <span class='id identifier rubyid_default_scoped'>default_scoped</span>(<span class='label'>all_queries:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_where_clause'>where_clause</span>
  <span class='id identifier rubyid_default_where_clause'>default_where_clause</span>.<span class='id identifier rubyid_ast'>ast</span> <span class='kw'>unless</span> <span class='id identifier rubyid_default_where_clause'>default_where_clause</span>.<span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="composite_query_constraints_list-instance_method">
  <h3 class='signature nodoc'>
    #<strong>composite_query_constraints_list</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of column names to be used in queries. The source of column names is derived from <a href="#query_constraints_list-instance_method" title="ActiveRecord::Persistence::ClassMethods#query_constraints_list (method)">#query_constraints_list</a> or <code>primary_key</code>. This method is for internal use when the primary key is to be treated as an array.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L510-L512'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='510' data-end='512'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 510</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_composite_query_constraints_list'>composite_query_constraints_list</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@composite_query_constraints_list</span> <span class='op'>||=</span> <span class='id identifier rubyid_query_constraints_list'><a href="#query_constraints_list-instance_method" title="ActiveRecord::Persistence::ClassMethods#query_constraints_list (method)">query_constraints_list</a></span> <span class='op'>||</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_primary_key'>primary_key</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create-instance_method">
  <h3 class='signature '>
    #<strong>create</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was saved successfully to the database or not.</p>

<p>The <code>attributes</code> parameter can be either a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> or an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. These Hashes describe the attributes on the objects that are to be created.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Create a single new object
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Create an Array of new objects
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }])

<span class='comment'># Create a single object and pass it into a block to set other attributes.
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>

<span class='comment'># Creating an Array of new objects using a block, where the block is executed for each object:
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L33-L41'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='33' data-end='41'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 33</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_save'><a href="../Persistence.html#save-instance_method" title="ActiveRecord::Persistence#save (method)">save</a></span>
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create!-instance_method">
  <h3 class='signature '>
    #<strong>create!</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates an object (or multiple objects) and saves it to the database, if validations pass. Raises a <a href="../RecordInvalid.html" title="ActiveRecord::RecordInvalid (class)"><code>::ActiveRecord::RecordInvalid</code></a> error if validations fail, unlike <code>Base#create</code>.</p>

<p>The <code>attributes</code> parameter can be either a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> or an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. These describe which attributes to be created on the object, or multiple objects when given an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L50-L58'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='58'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create!'>create!</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_create!'>create!</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_save!'><a href="../Persistence.html#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">save!</a></span>
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>(id_or_array)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the row with a primary key matching the <code>id</code> argument, using an SQL <code>DELETE</code> statement, and returns the number of rows deleted. Active Record objects are not instantiated, so the object’s callbacks are not executed, including any <code>:dependent</code> association options.</p>

<p>You can delete multiple rows at once by passing an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of <code>id</code>s.</p>

<p>Note: Although it is often much faster than the alternative, <a href="#destroy-instance_method" title="ActiveRecord::Persistence::ClassMethods#destroy (method)">#destroy</a>, skipping callbacks might bypass business logic in your application that ensures referential integrity or performs other essential jobs.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Delete a single row
</span><span class='const'>Todo</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='int'>1</span>)

<span class='comment'># Delete multiple rows
</span><span class='const'>Todo</span>.<span class='id identifier rubyid_delete'>delete</span>([<span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>4</span>])</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L565-L567'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='565' data-end='567'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 565</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_id_or_array'>id_or_array</span>)
  <span class='id identifier rubyid_delete_by'>delete_by</span>(<span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id_or_array'>id_or_array</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy-instance_method">
  <h3 class='signature '>
    #<strong>destroy</strong>(id)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Destroy an object (or multiple objects) that has the given id. The object is instantiated first, therefore all callbacks and filters are fired off before the object is deleted. This method is less efficient than <a href="#delete-instance_method" title="ActiveRecord::Persistence::ClassMethods#delete (method)">#delete</a> but allows cleanup methods and other actions to be run.</p>

<p>This essentially finds the object (or multiple objects) with the given id, creates a new object from the attributes, and then calls destroy on it.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>id</code> - This should be the id or an array of ids to be destroyed.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Destroy a single object
</span><span class='const'>Todo</span>.<span class='id identifier rubyid_destroy'>destroy</span>(<span class='int'>1</span>)

<span class='comment'># Destroy multiple objects
</span><span class='id identifier rubyid_todos'>todos</span> <span class='op'>=</span> [<span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span>]
<span class='const'>Todo</span>.<span class='id identifier rubyid_destroy'>destroy</span>(<span class='id identifier rubyid_todos'>todos</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L533-L545'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='533' data-end='545'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 533</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>(<span class='id identifier rubyid_id'>id</span>)
  <span class='id identifier rubyid_multiple_ids'>multiple_ids</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_composite_primary_key?'>composite_primary_key?</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_multiple_ids'>multiple_ids</span>
    <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_destroy'>destroy</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="discriminate_class_for_record-instance_method">
  <h3 class='signature priv'>
    #<strong>discriminate_class_for_record</strong>(record)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Called by <a href="#instantiate-instance_method" title="ActiveRecord::Persistence::ClassMethods#instantiate (method)">#instantiate</a> to decide which class to use for a new record instance.</p>

<p>See <code>ActiveRecord::Inheritance#discriminate_class_for_record</code> for the single-table inheritance discriminator.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L648-L650'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='648' data-end='650'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 648</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_discriminate_class_for_record'>discriminate_class_for_record</span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inherited-instance_method">
  <h3 class='signature priv'>
    #<strong>inherited</strong>(subclass)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L628-L634'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='628' data-end='634'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 628</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inherited'>inherited</span>(<span class='id identifier rubyid_subclass'>subclass</span>)
  <span class='kw'>super</span>
  <span class='id identifier rubyid_subclass'>subclass</span>.<span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
    <span class='ivar'>@_query_constraints_list</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@has_query_constraints</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert-instance_method">
  <h3 class='signature '>
    #<strong>insert</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>See <a href="#insert_all-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert_all (method)">#insert_all</a> for documentation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L96-L98'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='96' data-end='98'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 96</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert'>insert</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_insert_all'><a href="#insert_all-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert_all (method)">insert_all</a></span>([ <span class='id identifier rubyid_attributes'>attributes</span> ]<span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='id identifier rubyid_unique_by'>unique_by</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert!-instance_method">
  <h3 class='signature '>
    #<strong>insert!</strong>(attributes, returning: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>See <a href="#insert_all!-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert_all! (method)">#insert_all!</a> for more.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L185-L187'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='185' data-end='187'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 185</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert!'>insert!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_insert_all!'><a href="#insert_all!-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert_all! (method)">insert_all!</a></span>([ <span class='id identifier rubyid_attributes'>attributes</span> ]<span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_all-instance_method">
  <h3 class='signature '>
    #<strong>insert_all</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>The <code>attributes</code> parameter is an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. Every Hash determines the attributes for a single row and must have the same keys.</p>

<p>Rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped. Override with <code>:unique_by</code> (see below).</p>

<p>Returns an <a href="../Result.html" title="ActiveRecord::Result (class)"><code>::ActiveRecord::Result</code></a> with its contents based on <code>:returning</code> (see below).</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt>:returning
<dd>
<p>(PostgreSQL and SQLite3 only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p>

<p>You can also pass an SQL string if you need more control on the return values (for example, <code>returning: Arel.sql(&quot;id, name as new_name&quot;)</code>).</p>
</dd><dt>:unique_by
<dd>
<p>(PostgreSQL and SQLite only) By default rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped.</p>

<p>To skip rows according to just one unique index pass <code>:unique_by</code>.</p>

<p>Consider a Book model where no duplicate ISBNs make sense, but if any row has an existing id, or is not unique by another unique index, ActiveRecord::RecordNotUnique is raised.</p>

<p>Unique indexes can be identified by columns or name:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='words_sep'> </span><span class='tstring_content'>author_id</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index_books_on_isbn'>index_books_on_isbn</span></code></pre>
</dd><dt>:record_timestamps
<dd>
<p>By default, automatic setting of timestamp columns is controlled by the model’s <code>record_timestamps</code> config, matching typical behavior.</p>

<p>To override this and force automatic setting of timestamp columns one way or the other, pass <code>:record_timestamps</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>true</span>  <span class='comment'># Always set timestamps automatically
</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>false</span> <span class='comment'># Never set timestamps automatically</span></code></pre>
</dd></dl>

<p>Because it relies on the index information from the database <code>:unique_by</code> is recommended to be paired with Active Record’s schema_cache.</p>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Insert records and skip inserting any duplicates.
</span><span class='comment'># Here &quot;Eloquent Ruby&quot; is skipped because its id is not unique.
</span>
<span class='const'>Book</span>.<span class='id identifier rubyid_insert_all'>insert_all</span>([
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span> }
])

<span class='comment'># insert_all works on chained scopes, and you can use create_with
</span><span class='comment'># to set default attributes for all inserted records.
</span>
<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_books'>books</span>.<span class='id identifier rubyid_create_with'>create_with</span>(<span class='label'>created_at:</span> <span class='const'><a href="../../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>).<span class='id identifier rubyid_insert_all'>insert_all</span>([
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span> }
])</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L175-L177'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='175' data-end='177'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 175</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert_all'>insert_all</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="../InsertAll.html" title="ActiveRecord::InsertAll (class)">InsertAll</a></span>.<span class='id identifier rubyid_new'><a href="../InsertAll.html#new-class_method" title="ActiveRecord::InsertAll.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_skip'>skip</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='id identifier rubyid_unique_by'>unique_by</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>).<span class='id identifier rubyid_execute'><a href="../InsertAll.html#execute-instance_method" title="ActiveRecord::InsertAll#execute (method)">execute</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_all!-instance_method">
  <h3 class='signature '>
    #<strong>insert_all!</strong>(attributes, returning: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>The <code>attributes</code> parameter is an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. Every Hash determines the attributes for a single row and must have the same keys.</p>

<p>Raises <a href="../RecordNotUnique.html" title="ActiveRecord::RecordNotUnique (class)"><code>::ActiveRecord::RecordNotUnique</code></a> if any rows violate a unique index on the table. In that case, no rows are inserted.</p>

<p>To skip duplicate rows, see <a href="#insert_all-instance_method" title="ActiveRecord::Persistence::ClassMethods#insert_all (method)">#insert_all</a>. To replace them, see <a href="#upsert_all-instance_method" title="ActiveRecord::Persistence::ClassMethods#upsert_all (method)">#upsert_all</a>.</p>

<p>Returns an <a href="../Result.html" title="ActiveRecord::Result (class)"><code>::ActiveRecord::Result</code></a> with its contents based on <code>:returning</code> (see below).</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt>:returning
<dd>
<p>(PostgreSQL and SQLite3 only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p>

<p>You can also pass an SQL string if you need more control on the return values (for example, <code>returning: Arel.sql(&quot;id, name as new_name&quot;)</code>).</p>
</dd><dt>:record_timestamps
<dd>
<p>By default, automatic setting of timestamp columns is controlled by the model’s <code>record_timestamps</code> config, matching typical behavior.</p>

<p>To override this and force automatic setting of timestamp columns one way or the other, pass <code>:record_timestamps</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>true</span>  <span class='comment'># Always set timestamps automatically
</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>false</span> <span class='comment'># Never set timestamps automatically</span></code></pre>
</dd></dl>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Insert multiple records
</span><span class='const'>Book</span>.<span class='id identifier rubyid_insert_all!'>insert_all!</span>([
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span> }
])

<span class='comment'># Raises ActiveRecord::RecordNotUnique because &quot;Eloquent Ruby&quot;
</span><span class='comment'># does not have a unique id.
</span><span class='const'>Book</span>.<span class='id identifier rubyid_insert_all!'>insert_all!</span>([
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span> }
])</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L242-L244'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='242' data-end='244'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 242</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert_all!'>insert_all!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="../InsertAll.html" title="ActiveRecord::InsertAll (class)">InsertAll</a></span>.<span class='id identifier rubyid_new'><a href="../InsertAll.html#new-class_method" title="ActiveRecord::InsertAll.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_raise'>raise</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>).<span class='id identifier rubyid_execute'><a href="../InsertAll.html#execute-instance_method" title="ActiveRecord::InsertAll#execute (method)">execute</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instantiate-instance_method">
  <h3 class='signature '>
    #<strong>instantiate</strong>(attributes, column_types = {}, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given an attributes hash, <code>instantiate</code> returns a new instance of the appropriate class. Accepts only keys as strings.</p>

<p>For example, <code>Post.all</code> may return Comments, Messages, and Emails by storing the record’s subclass in a <code>type</code> attribute. By calling <code>instantiate</code> instead of <code>new</code>, finder methods ensure they get new instances of the appropriate class for each record.</p>

<p>See <code>ActiveRecord::Inheritance#discriminate_class_for_record</code> to see how this “single-table” inheritance mapping is implemented.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L376-L379'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='376' data-end='379'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 376</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instantiate'>instantiate</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='id identifier rubyid_discriminate_class_for_record'><a href="#discriminate_class_for_record-instance_method" title="ActiveRecord::Persistence::ClassMethods#discriminate_class_for_record (method)">discriminate_class_for_record</a></span>(<span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='id identifier rubyid_instantiate_instance_of'><a href="#instantiate_instance_of-instance_method" title="ActiveRecord::Persistence::ClassMethods#instantiate_instance_of (method)">instantiate_instance_of</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instantiate_instance_of-instance_method">
  <h3 class='signature priv'>
    #<strong>instantiate_instance_of</strong>(klass, attributes, column_types = {}, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given a class, an attributes hash, <code>instantiate_instance_of</code> returns a new instance of the class. Accepts only keys as strings.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L638-L641'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='638' data-end='641'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 638</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instantiate_instance_of'>instantiate_instance_of</span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_attributes_builder'>attributes_builder</span>.<span class='id identifier rubyid_build_from_database'>build_from_database</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span>)
  <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_allocate'>allocate</span>.<span class='id identifier rubyid_init_with_attributes'>init_with_attributes</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="query_constraints-instance_method">
  <h3 class='signature '>
    #<strong>query_constraints</strong>(*columns_list)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Accepts a list of attribute names to be used in the WHERE clause of SELECT / UPDATE / DELETE queries and in the ORDER BY clause for <code>#first</code> and <code>#last</code> finder methods.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Developer</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_query_constraints'>query_constraints</span> <span class='symbeg'>:</span><span class='id identifier rubyid_company_id'>company_id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_developer'>developer</span> <span class='op'>=</span> <span class='const'>Developer</span>.<span class='id identifier rubyid_first'>first</span>
<span class='comment'># SELECT &quot;developers&quot;.* FROM &quot;developers&quot; ORDER BY &quot;developers&quot;.&quot;company_id&quot; ASC, &quot;developers&quot;.&quot;id&quot; ASC LIMIT 1
</span><span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'># =&gt; #&lt;Developer id: 1, company_id: 1, ...&gt;
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_update!'><a href="#update!-instance_method" title="ActiveRecord::Persistence::ClassMethods#update! (method)">update!</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Nikita</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># UPDATE &quot;developers&quot; SET &quot;name&quot; = &#39;Nikita&#39; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='comment'># It is possible to update an attribute used in the query_constraints clause:
</span><span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_update!'><a href="#update!-instance_method" title="ActiveRecord::Persistence::ClassMethods#update! (method)">update!</a></span>(<span class='label'>company_id:</span> <span class='int'>2</span>)
<span class='comment'># UPDATE &quot;developers&quot; SET &quot;company_id&quot; = 2 WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_save!'><a href="../Persistence.html#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">save!</a></span>
<span class='comment'># UPDATE &quot;developers&quot; SET &quot;name&quot; = &#39;Bob&#39; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_destroy!'><a href="../Persistence.html#destroy!-instance_method" title="ActiveRecord::Persistence#destroy! (method)">destroy!</a></span>
<span class='comment'># DELETE FROM &quot;developers&quot; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Persistence::ClassMethods#delete (method)">delete</a></span>
<span class='comment'># DELETE FROM &quot;developers&quot; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_reload'><a href="../Persistence.html#reload-instance_method" title="ActiveRecord::Persistence#reload (method)">reload</a></span>
<span class='comment'># SELECT &quot;developers&quot;.* FROM &quot;developers&quot; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1 LIMIT 1</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L488-L493'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='488' data-end='493'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 488</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_query_constraints'>query_constraints</span>(<span class='op'>*</span><span class='id identifier rubyid_columns_list'>columns_list</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must specify at least one column to be used in querying</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_columns_list'>columns_list</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='ivar'>@query_constraints_list</span> <span class='op'>=</span> <span class='id identifier rubyid_columns_list'>columns_list</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)
  <span class='ivar'>@has_query_constraints</span> <span class='op'>=</span> <span class='ivar'>@query_constraints_list</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="query_constraints_list-instance_method">
  <h3 class='signature nodoc'>
    #<strong>query_constraints_list</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L499-L505'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='499' data-end='505'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 499</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@query_constraints_list</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='id identifier rubyid_base_class?'>base_class?</span> <span class='op'>||</span> <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>!=</span> <span class='id identifier rubyid_base_class'>base_class</span>.<span class='id identifier rubyid_primary_key'>primary_key</span>
    <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='kw'>if</span> <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_base_class'>base_class</span>.<span class='id identifier rubyid_query_constraints_list'>query_constraints_list</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update-instance_method">
  <h3 class='signature '>
    #<strong>update</strong>(id = :all, attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was saved successfully to the database or not.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>id</code> - This should be the id or an array of ids to be updated. Optional argument, defaults to all records in the relation.</p>
</li><li>
<p><code>attributes</code> - This should be a hash of attributes or an array of hashes.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Updates one record
</span><span class='const'>Person</span>.<span class='id identifier rubyid_update'>update</span>(<span class='int'>15</span><span class='comma'>,</span> <span class='label'>user_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Samuel</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expert</span><span class='tstring_end'>&quot;</span></span>)

<span class='comment'># Updates multiple records
</span><span class='id identifier rubyid_people'>people</span> <span class='op'>=</span> { <span class='int'>1</span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>first_name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span> <span class='int'>2</span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>first_name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&quot;</span></span> } }
<span class='const'>Person</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_people'>people</span>.<span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='id identifier rubyid_people'>people</span>.<span class='id identifier rubyid_values'>values</span>)

<span class='comment'># Updates multiple records from the result of a relation
</span><span class='id identifier rubyid_people'>people</span> <span class='op'>=</span> <span class='const'>Person</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expert</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_people'>people</span>.<span class='id identifier rubyid_update'>update</span>(<span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>masters</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>Note: Updating a large number of records will run an UPDATE query for each record, which may cause a performance issue. When running callbacks is not needed for each record update, it is preferred to use <a href="../Relation.html#update_all-instance_method" title="ActiveRecord::Relation#update_all (method)">update_all</a> for updating all records in a single query.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L408-L430'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='408' data-end='430'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 408</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_any?'>any?</span>(<span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an array of ActiveRecord::Base instances to `update`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the ids of the objects by calling `pluck(:id)` or `map(&amp;:id)`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_one_id'>one_id</span><span class='op'>|</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_one_id'>one_id</span>) }.<span class='id identifier rubyid_each_with_index'>each_with_index</span> { <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>[<span class='id identifier rubyid_idx'>idx</span>])
    }
  <span class='kw'>elsif</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>
    <span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>) }
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span> <span class='op'>===</span> <span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an instance of ActiveRecord::Base to `update`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the id of the object by calling `.id`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update!-instance_method">
  <h3 class='signature '>
    #<strong>update!</strong>(id = :all, attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the object (or multiple objects) just like <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a> but calls <code>#update!</code> instead of <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a>, so an exception is raised if the record is invalid and saving will fail.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L434-L456'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='434' data-end='456'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 434</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_any?'>any?</span>(<span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an array of ActiveRecord::Base instances to `update!`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the ids of the objects by calling `pluck(:id)` or `map(&amp;:id)`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_one_id'>one_id</span><span class='op'>|</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_one_id'>one_id</span>) }.<span class='id identifier rubyid_each_with_index'>each_with_index</span> { <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>[<span class='id identifier rubyid_idx'>idx</span>])
    }
  <span class='kw'>elsif</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>
    <span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>) }
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span> <span class='op'>===</span> <span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an instance of ActiveRecord::Base to `update!`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the id of the object by calling `.id`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="upsert-instance_method">
  <h3 class='signature '>
    #<strong>upsert</strong>(attributes, **kwargs)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates or inserts (upserts) a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>See <a href="#upsert_all-instance_method" title="ActiveRecord::Persistence::ClassMethods#upsert_all (method)">#upsert_all</a> for documentation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L252-L254'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='252' data-end='254'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 252</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_upsert'>upsert</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
  <span class='id identifier rubyid_upsert_all'><a href="#upsert_all-instance_method" title="ActiveRecord::Persistence::ClassMethods#upsert_all (method)">upsert_all</a></span>([ <span class='id identifier rubyid_attributes'>attributes</span> ]<span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="upsert_all-instance_method">
  <h3 class='signature '>
    #<strong>upsert_all</strong>(attributes, on_duplicate: :update, update_only: nil, returning: nil, unique_by: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates or inserts (upserts) multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>The <code>attributes</code> parameter is an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. Every Hash determines the attributes for a single row and must have the same keys.</p>

<p>Returns an <a href="../Result.html" title="ActiveRecord::Result (class)"><code>::ActiveRecord::Result</code></a> with its contents based on <code>:returning</code> (see below).</p>

<p>By default, <code>upsert_all</code> will update all the columns that can be updated when there is a conflict. These are all the columns except primary keys, read-only columns, and columns covered by the optional <code>unique_by</code>.</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt>:returning
<dd>
<p>(PostgreSQL and SQLite3 only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p>

<p>You can also pass an SQL string if you need more control on the return values (for example, <code>returning: Arel.sql(&quot;id, name as new_name&quot;)</code>).</p>
</dd><dt>:unique_by
<dd>
<p>(PostgreSQL and SQLite only) By default rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped.</p>

<p>To skip rows according to just one unique index pass <code>:unique_by</code>.</p>

<p>Consider a Book model where no duplicate ISBNs make sense, but if any row has an existing id, or is not unique by another unique index, ActiveRecord::RecordNotUnique is raised.</p>

<p>Unique indexes can be identified by columns or name:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='words_sep'> </span><span class='tstring_content'>author_id</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index_books_on_isbn'>index_books_on_isbn</span></code></pre>
</dd></dl>

<p>Because it relies on the index information from the database <code>:unique_by</code> is recommended to be paired with Active Record’s schema_cache.</p>
<dl class="rdoc-list label-list"><dt>:on_duplicate
<dd>
<p>Configure the SQL update sentence that will be used in case of conflict.</p>

<p>NOTE: If you use this option you must provide all the columns you want to update by yourself.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Commodity</span>.<span class='id identifier rubyid_upsert_all'>upsert_all</span>(
  [
    { <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Copper</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>4.84</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>4</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gold</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>1380.87</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>6</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Aluminium</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>0.35</span> }
  ]<span class='comma'>,</span>
  <span class='label'>on_duplicate:</span> <span class='const'><a href="../../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price = GREATEST(commodities.price, EXCLUDED.price)</span><span class='tstring_end'>&quot;</span></span>)
)</code></pre>

<p>See the related <code>:update_only</code> option. Both options can’t be used at the same time.</p>
</dd><dt>:update_only
<dd>
<p>Provide a list of column names that will be updated in case of conflict. If not provided, <code>upsert_all</code> will update all the columns that can be updated. These are all the columns except primary keys, read-only columns, and columns covered by the optional <code>unique_by</code></p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Commodity</span>.<span class='id identifier rubyid_upsert_all'>upsert_all</span>(
  [
    { <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Copper</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>4.84</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>4</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gold</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>1380.87</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>6</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Aluminium</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>0.35</span> }
  ]<span class='comma'>,</span>
  <span class='label'>update_only:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_price'>price</span>] <span class='comment'># Only prices will be updated
</span>)</code></pre>

<p>See the related <code>:on_duplicate</code> option. Both options can’t be used at the same time.</p>
</dd><dt>:record_timestamps
<dd>
<p>By default, automatic setting of timestamp columns is controlled by the model’s <code>record_timestamps</code> config, matching typical behavior.</p>

<p>To override this and force automatic setting of timestamp columns one way or the other, pass <code>:record_timestamps</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>true</span>  <span class='comment'># Always set timestamps automatically
</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>false</span> <span class='comment'># Never set timestamps automatically</span></code></pre>
</dd></dl>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Inserts multiple records, performing an upsert when records have duplicate ISBNs.
</span><span class='comment'># Here &quot;Eloquent Ruby&quot; overwrites &quot;Rework&quot; because its ISBN is duplicate.
</span>
<span class='const'>Book</span>.<span class='id identifier rubyid_upsert_all'>upsert_all</span>([
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>isbn:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>isbn:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> }
]<span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span>)

<span class='const'>Book</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>isbn:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_title'>title</span> <span class='comment'># =&gt; &quot;Eloquent Ruby&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/persistence.rb#L362-L364'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='362' data-end='364'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 362</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_upsert_all'>upsert_all</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'><a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">update</a></span><span class='comma'>,</span> <span class='label'>update_only:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="../InsertAll.html" title="ActiveRecord::InsertAll (class)">InsertAll</a></span>.<span class='id identifier rubyid_new'><a href="../InsertAll.html#new-class_method" title="ActiveRecord::InsertAll.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='id identifier rubyid_on_duplicate'>on_duplicate</span><span class='comma'>,</span> <span class='label'>update_only:</span> <span class='id identifier rubyid_update_only'>update_only</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='id identifier rubyid_unique_by'>unique_by</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>).<span class='id identifier rubyid_execute'><a href="../InsertAll.html#execute-instance_method" title="ActiveRecord::InsertAll#execute (method)">execute</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>