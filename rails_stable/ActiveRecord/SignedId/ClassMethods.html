<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::SignedId::ClassMethods &mdash; Rails 8-0-stable</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::SignedId::ClassMethods",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 8-0-stable</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../SignedId.html" title="ActiveRecord::SignedId (module)">SignedId</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::SignedId::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/signed_id.rb#L26'>activerecord/lib/active_record/signed_id.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#signed_id_verifier-instance_method" title="#signed_id_verifier (instance method)">#<strong>signed_id_verifier</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>The verifier instance that all signed ids are generated and verified from.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#signed_id_verifier=-instance_method" title="#signed_id_verifier= (instance method)">#<strong>signed_id_verifier=</strong>(verifier)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Allows you to pass in a custom verifier used for the signed ids.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#find_signed-instance_method" title="#find_signed (instance method)">#<strong>find_signed</strong>(signed_id, purpose: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Lets you find a record based on a signed id that’s safe to put into the world without risk of tampering.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_signed!-instance_method" title="#find_signed! (instance method)">#<strong>find_signed!</strong>(signed_id, purpose: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Works like find_signed, but will raise an <a href="../../ActiveSupport/MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)"><code>::ActiveSupport::MessageVerifier::InvalidSignature</code></a> exception if the <a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">#signed_id</a> has either expired, has a purpose mismatch, is for another record, or has been tampered with.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#combine_signed_id_purposes-instance_method" title="#combine_signed_id_purposes (instance method)">#<strong>combine_signed_id_purposes</strong>(purpose)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="signed_id_verifier-instance_method">
  <h3 class='signature rw first'>
    #<strong>signed_id_verifier</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The verifier instance that all signed ids are generated and verified from. By default, it’ll be initialized with the class-level <code>signed_id_verifier_secret</code>, which within <a href="../../Rails.html" title="Rails (module)"><code>::Rails</code></a> comes from <a href="../../Rails/Application.html#key_generator-instance_method" title="Rails::Application#key_generator (method)">{Rails.application</a>.key_generator}. By default, it’s SHA256 for the digest and JSON for the serialization.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/signed_id.rb#L82-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='82' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 82</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_signed_id_verifier'>signed_id_verifier</span>
  <span class='ivar'>@signed_id_verifier</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_secret'>secret</span> <span class='op'>=</span> <span class='id identifier rubyid_signed_id_verifier_secret'>signed_id_verifier_secret</span>
    <span class='id identifier rubyid_secret'>secret</span> <span class='op'>=</span> <span class='id identifier rubyid_secret'>secret</span>.<span class='id identifier rubyid_call'>call</span> <span class='kw'>if</span> <span class='id identifier rubyid_secret'>secret</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_secret'>secret</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must set ActiveRecord::Base.signed_id_verifier_secret to use signed ids</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='const'><a href="../../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)">MessageVerifier</a></span>.<span class='id identifier rubyid_new'><a href="../../ActiveSupport/MessageVerifier.html#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span> <span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='label'>digest:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SHA256</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>serializer:</span> <span class='const'>JSON</span><span class='comma'>,</span> <span class='label'>url_safe:</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="signed_id_verifier=-instance_method">
  <h3 class='signature rw'>
    #<strong>signed_id_verifier=</strong>(verifier)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Allows you to pass in a custom verifier used for the signed ids. This also allows you to use different verifiers for different classes. This is also helpful if you need to rotate keys, as you can prepare your custom verifier for that in advance. See <a href="../../ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a> for details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/signed_id.rb#L98-L100'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='98' data-end='100'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 98</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_signed_id_verifier='>signed_id_verifier=</span>(<span class='id identifier rubyid_verifier'>verifier</span>)
  <span class='ivar'>@signed_id_verifier</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="combine_signed_id_purposes-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>combine_signed_id_purposes</strong>(purpose)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/signed_id.rb#L103-L105'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='103' data-end='105'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 103</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_combine_signed_id_purposes'>combine_signed_id_purposes</span>(<span class='id identifier rubyid_purpose'>purpose</span>)
  [ <span class='id identifier rubyid_base_class'>base_class</span>.<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_underscore'>underscore</span><span class='comma'>,</span> <span class='id identifier rubyid_purpose'>purpose</span>.<span class='id identifier rubyid_to_s'>to_s</span> ].<span class='id identifier rubyid_compact_blank'>compact_blank</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_signed-instance_method">
  <h3 class='signature '>
    #<strong>find_signed</strong>(signed_id, purpose: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Lets you find a record based on a signed id that’s safe to put into the world without risk of tampering. This is particularly useful for things like password reset or email verification, where you want the bearer of the signed id to be able to interact with the underlying record, but usually only within a certain time period.</p>

<p>You set the time period that the signed id is valid for during generation, using the instance method <code>signed_id(expires_in: 15.minutes)</code>. If the time has elapsed before a signed find is attempted, the signed id will no longer be valid, and nil is returned.</p>

<p>It’s possible to further restrict the use of a signed id with a purpose. This helps when you have a general base model, like a User, which might have signed ids for several things, like password reset or email verification. The purpose that was set during generation must match the purpose set when finding. If there’s a mismatch, nil is again returned.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span> <span class='label'>expires_in:</span> <span class='int'>15</span>.<span class='id identifier rubyid_minutes'>minutes</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span>

<span class='const'>User</span>.<span class='id identifier rubyid_find_signed'>find_signed</span> <span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span> <span class='comment'># =&gt; nil, since the purpose does not match
</span>
<span class='id identifier rubyid_travel'>travel</span> <span class='int'>16</span>.<span class='id identifier rubyid_minutes'>minutes</span>
<span class='const'>User</span>.<span class='id identifier rubyid_find_signed'>find_signed</span> <span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span> <span class='comment'># =&gt; nil, since the signed id has expired
</span>
<span class='id identifier rubyid_travel_back'>travel_back</span>
<span class='const'>User</span>.<span class='id identifier rubyid_find_signed'>find_signed</span> <span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_password_reset'>password_reset</span> <span class='comment'># =&gt; User.first</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../UnknownPrimaryKey.html" title="ActiveRecord::UnknownPrimaryKey (class)">UnknownPrimaryKey</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/signed_id.rb#L52-L58'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='52' data-end='58'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 52</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_signed'>find_signed</span>(<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../UnknownPrimaryKey.html" title="ActiveRecord::UnknownPrimaryKey (class)">UnknownPrimaryKey</a></span>.<span class='id identifier rubyid_new'><a href="../UnknownPrimaryKey.html#new-class_method" title="ActiveRecord::UnknownPrimaryKey.new (method)">new</a></span>(<span class='kw'>self</span>) <span class='kw'>if</span> <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_signed_id_verifier'><a href="#signed_id_verifier-instance_method" title="ActiveRecord::SignedId::ClassMethods#signed_id_verifier (method)">signed_id_verifier</a></span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='id identifier rubyid_combine_signed_id_purposes'><a href="#combine_signed_id_purposes-instance_method" title="ActiveRecord::SignedId::ClassMethods#combine_signed_id_purposes (method)">combine_signed_id_purposes</a></span>(<span class='id identifier rubyid_purpose'>purpose</span>))
    <span class='id identifier rubyid_find_by'>find_by</span> <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_signed!-instance_method">
  <h3 class='signature '>
    #<strong>find_signed!</strong>(signed_id, purpose: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Works like find_signed, but will raise an <a href="../../ActiveSupport/MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)"><code>::ActiveSupport::MessageVerifier::InvalidSignature</code></a> exception if the <a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">ActiveRecord::SignedId#signed_id</a> has either expired, has a purpose mismatch, is for another record, or has been tampered with. It will also raise an <a href="../RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>::ActiveRecord::RecordNotFound</code></a> exception if the valid signed id can’t find a record.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_find_signed!'>find_signed!</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bad data</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># =&gt; ActiveSupport::MessageVerifier::InvalidSignature
</span>
<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span>
<span class='const'>User</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_destroy'>destroy</span>
<span class='const'>User</span>.<span class='id identifier rubyid_find_signed!'>find_signed!</span> <span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span> <span class='comment'># =&gt; ActiveRecord::RecordNotFound</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/8-0-stable/activerecord/lib/active_record/signed_id.rb#L72-L76'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='72' data-end='76'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/signed_id.rb', line 72</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_signed!'>find_signed!</span>(<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_signed_id_verifier'><a href="#signed_id_verifier-instance_method" title="ActiveRecord::SignedId::ClassMethods#signed_id_verifier (method)">signed_id_verifier</a></span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_signed_id'><a href="../SignedId.html#signed_id-instance_method" title="ActiveRecord::SignedId#signed_id (method)">signed_id</a></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='id identifier rubyid_combine_signed_id_purposes'><a href="#combine_signed_id_purposes-instance_method" title="ActiveRecord::SignedId::ClassMethods#combine_signed_id_purposes (method)">combine_signed_id_purposes</a></span>(<span class='id identifier rubyid_purpose'>purpose</span>))
    <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>