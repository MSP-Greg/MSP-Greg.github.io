<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Associations::CollectionAssociation &mdash; Rails 7-1-stable</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Associations::CollectionAssociation",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 7-1-stable</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a class='nodoc' href="../Associations.html" title="ActiveRecord::Associations (module)">Associations</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>CollectionAssociation&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveRecord::Associations::CollectionAssociation</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a class='nodoc' href="HasManyAssociation.html" title="ActiveRecord::Associations::HasManyAssociation (class)">HasManyAssociation</a>, <a class='nodoc' href="HasManyThroughAssociation.html" title="ActiveRecord::Associations::HasManyThroughAssociation (class)">HasManyThroughAssociation</a>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="Association.html" title="ActiveRecord::Associations::Association (class)"><code>Association</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a class='nodoc' href="Association.html" title="ActiveRecord::Associations::Association (class)"><code>Association</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a class='nodoc' href="Association.html" title="ActiveRecord::Associations::Association (class)">ActiveRecord::Associations::Association</a></span>
        <ul class='fullTree'>
          <li><a href="../../Object.html" title="Object (class)"><code>::Object</code></a></li>
          <li class='next'><a class='nodoc' href="Association.html" title="ActiveRecord::Associations::Association (class)">ActiveRecord::Associations::Association</a></li>
          <li class='next'>ActiveRecord::Associations::CollectionAssociation</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L30'>activerecord/lib/active_record/associations/collection_association.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Active+Record+Association+Collection">Active Record Association Collection</h3>

<p><code>CollectionAssociation</code> is an abstract class that provides common stuff to ease the implementation of association proxies that represent collections. See the class hierarchy in <a href="Association.html" title="ActiveRecord::Associations::Association (class)"><code>Association</code></a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>CollectionAssociation</span><span class='op'>:</span>
  <span class='const'><a href="HasManyAssociation.html" title="ActiveRecord::Associations::HasManyAssociation (class)">HasManyAssociation</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_has_many'>has_many</span>
    <span class='const'><a href="HasManyThroughAssociation.html" title="ActiveRecord::Associations::HasManyThroughAssociation (class)">HasManyThroughAssociation</a></span> <span class='op'>+</span> <span class='const'><a href="ThroughAssociation.html" title="ActiveRecord::Associations::ThroughAssociation (module)">ThroughAssociation</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_has_many'>has_many</span> <span class='op'>:</span><span class='id identifier rubyid_through'>through</span></code></pre>

<p>The CollectionAssociation class provides common methods to the collections defined by <code>has_and_belongs_to_many</code>, <code>has_many</code> or <code>has_many</code> with the <code>:through association</code> option.</p>

<p>You need to be careful with assumptions regarding the target: The proxy does not fetch records from the database until it needs them, but new ones created with <a href="#build-instance_method" title="ActiveRecord::Associations::CollectionAssociation#build (method)">#build</a> are added to the target. So, the target may be non-empty and still lack children waiting to be read from the database. If you look directly to the database you cannot assume that’s the entire collection because new records may have been added to the target, etc.</p>

<p>If you need to work on all current children, new and existing records, <a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">#load_target</a> and the <code>loaded</code> flag are your friends.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_Method_summary'>Class Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited nodoc'><a href="Association.html" title="ActiveRecord::Associations::Association (class)"><code>Association</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Association.html#new-class_method" title="ActiveRecord::Associations::Association.new (method)">.new</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#empty%3F-instance_method" title="#empty? (instance method)">#<strong>empty?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if the collection is empty.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#find_from_target%3F-instance_method" title="#find_from_target? (instance method)">#<strong>find_from_target?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#null_scope%3F-instance_method" title="#null_scope? (instance method)">#<strong>null_scope?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature wo nodoc'>
      <a href="#target=-instance_method" title="#target= (instance method)">#<strong>target=</strong>(record)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="Association.html" title="ActiveRecord::Associations::Association (class)"><code>Association</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ro nodoc' href="Association.html#disable_joins-instance_method" title="ActiveRecord::Associations::Association#disable_joins (method)">#disable_joins</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc' href="Association.html#loaded%3F-instance_method" title="ActiveRecord::Associations::Association#loaded? (method)">#loaded?</a></td>
      <td><div class='inline'><p>Has the target been already loaded?</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro nodoc' href="Association.html#options-instance_method" title="ActiveRecord::Associations::Association#options (method)">#options</a>,
        <a class='i_m rw nodoc' href="Association.html#owner-instance_method" title="ActiveRecord::Associations::Association#owner (method)">#owner</a>,
        <a class='i_m ro nodoc' href="Association.html#reflection-instance_method" title="ActiveRecord::Associations::Association#reflection (method)">#reflection</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro nodoc' href="Association.html#stale_target%3F-instance_method" title="ActiveRecord::Associations::Association#stale_target? (method)">#stale_target?</a></td>
      <td><div class='inline'><p>The target is stale if the target no longer points to the record(s) that the relevant foreign_key(s) refers to.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m rw nodoc' href="Association.html#target-instance_method" title="ActiveRecord::Associations::Association#target (method)">#target</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m rw nodoc' href="Association.html#target=-instance_method" title="ActiveRecord::Associations::Association#target= (method)">#target=</a></td>
      <td><div class='inline'><p>Sets the target of this association to <code>\target</code>, and the loaded flag to <code>true</code>.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro priv nodoc' href="Association.html#find_target-instance_method" title="ActiveRecord::Associations::Association#find_target (method)">#find_target</a>,
        <a class='i_m ro priv nodoc' href="Association.html#find_target%3F-instance_method" title="ActiveRecord::Associations::Association#find_target? (method)">#find_target?</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ro priv nodoc' href="Association.html#foreign_key_present%3F-instance_method" title="ActiveRecord::Associations::Association#foreign_key_present? (method)">#foreign_key_present?</a></td>
      <td><div class='inline'><p>Returns true if there is a foreign key present on the owner which references the target.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ro priv nodoc' href="Association.html#violates_strict_loading%3F-instance_method" title="ActiveRecord::Associations::Association#violates_strict_loading? (method)">#violates_strict_loading?</a>
      </td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#add_to_target-instance_method" title="#add_to_target (instance method)">#<strong>add_to_target</strong>(record, skip_callbacks: false, replace: false, &amp;block)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#build-instance_method" title="#build (instance method)">#<strong>build</strong>(attributes = nil, &amp;block)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#concat-instance_method" title="#concat (instance method)">#<strong>concat</strong>(*records)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Add <code>records</code> to this association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(*records)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes <code>records</code> from this association calling <code>before_remove</code> and <code>after_remove</code> callbacks.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#delete_all-instance_method" title="#delete_all (instance method)">#<strong>delete_all</strong>(dependent = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes all records from the association without calling callbacks on the associated records.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>(*records)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the <code>records</code> and removes them from this association calling <code>before_remove</code>, <code>after_remove</code>, <code>before_destroy</code> and <code>after_destroy</code> callbacks.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#destroy_all-instance_method" title="#destroy_all (instance method)">#<strong>destroy_all</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Destroy all the records from this association.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#find-instance_method" title="#find (instance method)">#<strong>find</strong>(*args)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#ids_reader-instance_method" title="#ids_reader (instance method)">#<strong>ids_reader</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Implements the ids reader method, e.g.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#ids_writer-instance_method" title="#ids_writer (instance method)">#<strong>ids_writer</strong>(ids)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Implements the ids writer method, e.g.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#include%3F-instance_method" title="#include? (instance method)">#<strong>include?</strong>(record)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#load_target-instance_method" title="#load_target (instance method)">#<strong>load_target</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#reader-instance_method" title="#reader (instance method)">#<strong>reader</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Implements the reader method, e.g.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#replace-instance_method" title="#replace (instance method)">#<strong>replace</strong>(other_array)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Replace this collection with <code>other_array</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#reset-instance_method" title="#reset (instance method)">#<strong>reset</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#scope-instance_method" title="#scope (instance method)">#<strong>scope</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the size of the collection by executing a SELECT COUNT(*) query if the collection hasn’t been loaded, and calling <code>collection.size</code> if it has.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#writer-instance_method" title="#writer (instance method)">#<strong>writer</strong>(records)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Implements the writer method, e.g.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_create_record-instance_method" title="#_create_record (instance method)">#<strong>_create_record</strong>(attributes, raise = false, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#callback-instance_method" title="#callback (instance method)">#<strong>callback</strong>(method, record)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#callbacks_for-instance_method" title="#callbacks_for (instance method)">#<strong>callbacks_for</strong>(callback_name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#concat_records-instance_method" title="#concat_records (instance method)">#<strong>concat_records</strong>(records, raise = false)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#delete_or_destroy-instance_method" title="#delete_or_destroy (instance method)">#<strong>delete_or_destroy</strong>(records, method)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#delete_records-instance_method" title="#delete_records (instance method)">#<strong>delete_records</strong>(records, method)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Delete the given records from the association, using one of the methods <code>:destroy</code>, <code>:delete_all</code> or <code>:nullify</code> (or <code>nil</code>, in which case a default is used).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#find_by_scan-instance_method" title="#find_by_scan (instance method)">#<strong>find_by_scan</strong>(*args)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>If the <code>:inverse_of</code> option has been specified, then <a href="#find-instance_method" title="ActiveRecord::Associations::CollectionAssociation#find (method)">#find</a> scans the entire collection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#include_in_memory%3F-instance_method" title="#include_in_memory? (instance method)">#<strong>include_in_memory?</strong>(record)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#insert_record-instance_method" title="#insert_record (instance method)">#<strong>insert_record</strong>(record, validate = true, raise = false, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Do the relevant stuff to insert the given record into the association collection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#merge_target_lists-instance_method" title="#merge_target_lists (instance method)">#<strong>merge_target_lists</strong>(persisted, memory)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>We have some records loaded from the database (persisted) and some that are in-memory (memory).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#remove_records-instance_method" title="#remove_records (instance method)">#<strong>remove_records</strong>(existing_records, records, method)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#replace_common_records_in_memory-instance_method" title="#replace_common_records_in_memory (instance method)">#<strong>replace_common_records_in_memory</strong>(new_target, original_target)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#replace_on_target-instance_method" title="#replace_on_target (instance method)">#<strong>replace_on_target</strong>(record, skip_callbacks, replace:, inversing: false)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#replace_records-instance_method" title="#replace_records (instance method)">#<strong>replace_records</strong>(new_target, original_target)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#transaction-instance_method" title="#transaction (instance method)">#<strong>transaction</strong>(&amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited nodoc'><a href="Association.html" title="ActiveRecord::Associations::Association (class)"><code>Association</code></a> - Inherited</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Association.html#create-instance_method" title="ActiveRecord::Associations::Association#create (method)">#create</a>,
        <a class='i_m nodoc' href="Association.html#create!-instance_method" title="ActiveRecord::Associations::Association#create! (method)">#create!</a>,
        <a class='i_m nodoc' href="Association.html#extensions-instance_method" title="ActiveRecord::Associations::Association#extensions (method)">#extensions</a>,
        <a class='i_m nodoc' href="Association.html#initialize_attributes-instance_method" title="ActiveRecord::Associations::Association#initialize_attributes (method)">#initialize_attributes</a>,
        <a class='i_m nodoc' href="Association.html#inversed_from-instance_method" title="ActiveRecord::Associations::Association#inversed_from (method)">#inversed_from</a>,
        <a class='i_m nodoc' href="Association.html#inversed_from_queries-instance_method" title="ActiveRecord::Associations::Association#inversed_from_queries (method)">#inversed_from_queries</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#klass-instance_method" title="ActiveRecord::Associations::Association#klass (method)">#klass</a></td>
      <td><div class='inline'><p>Returns the class of the target.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#load_target-instance_method" title="ActiveRecord::Associations::Association#load_target (method)">#load_target</a></td>
      <td><div class='inline'><p>Loads the target if needed and returns it.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#loaded!-instance_method" title="ActiveRecord::Associations::Association#loaded! (method)">#loaded!</a></td>
      <td><div class='inline'><p>Asserts the target has been loaded setting the loaded flag to <code>true</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#marshal_dump-instance_method" title="ActiveRecord::Associations::Association#marshal_dump (method)">#marshal_dump</a></td>
      <td><div class='inline'><p>We can’t dump @reflection and @through_reflection since it contains the scope proc.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Association.html#marshal_load-instance_method" title="ActiveRecord::Associations::Association#marshal_load (method)">#marshal_load</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#reload-instance_method" title="ActiveRecord::Associations::Association#reload (method)">#reload</a></td>
      <td><div class='inline'><p>Reloads the target and returns <code>self</code> on success.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#remove_inverse_instance-instance_method" title="ActiveRecord::Associations::Association#remove_inverse_instance (method)">#remove_inverse_instance</a></td>
      <td><div class='inline'><p>Remove the inverse association, if possible.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#reset-instance_method" title="ActiveRecord::Associations::Association#reset (method)">#reset</a></td>
      <td><div class='inline'><p>Resets the loaded flag to <code>false</code> and sets the target to <code>nil</code>.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Association.html#reset_negative_cache-instance_method" title="ActiveRecord::Associations::Association#reset_negative_cache (method)">#reset_negative_cache</a>,
        <a class='i_m nodoc' href="Association.html#reset_scope-instance_method" title="ActiveRecord::Associations::Association#reset_scope (method)">#reset_scope</a>,
        <a class='i_m nodoc' href="Association.html#scope-instance_method" title="ActiveRecord::Associations::Association#scope (method)">#scope</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m nodoc' href="Association.html#set_inverse_instance-instance_method" title="ActiveRecord::Associations::Association#set_inverse_instance (method)">#set_inverse_instance</a></td>
      <td><div class='inline'><p>Set the inverse association, if possible.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m nodoc' href="Association.html#set_inverse_instance_from_queries-instance_method" title="ActiveRecord::Associations::Association#set_inverse_instance_from_queries (method)">#set_inverse_instance_from_queries</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#association_scope-instance_method" title="ActiveRecord::Associations::Association#association_scope (method)">#association_scope</a></td>
      <td><div class='inline'><p>The scope for this association.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Association.html#build_record-instance_method" title="ActiveRecord::Associations::Association#build_record (method)">#build_record</a>,
        <a class='i_m priv nodoc' href="Association.html#enqueue_destroy_association-instance_method" title="ActiveRecord::Associations::Association#enqueue_destroy_association (method)">#enqueue_destroy_association</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#ensure_klass_exists!-instance_method" title="ActiveRecord::Associations::Association#ensure_klass_exists! (method)">#ensure_klass_exists!</a></td>
      <td><div class='inline'><p>Reader and writer methods call this so that consistent errors are presented when the association target class does not exist.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#foreign_key_for%3F-instance_method" title="ActiveRecord::Associations::Association#foreign_key_for? (method)">#foreign_key_for?</a></td>
      <td><div class='inline'><p>Returns true if record contains the foreign_key.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Association.html#inversable%3F-instance_method" title="ActiveRecord::Associations::Association#inversable? (method)">#inversable?</a>,
        <a class='i_m priv nodoc' href="Association.html#inverse_association_for-instance_method" title="ActiveRecord::Associations::Association#inverse_association_for (method)">#inverse_association_for</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#inverse_reflection_for-instance_method" title="ActiveRecord::Associations::Association#inverse_reflection_for (method)">#inverse_reflection_for</a></td>
      <td><div class='inline'><p>Can be redefined by subclasses, notably polymorphic belongs_to The record parameter is necessary to support polymorphic inverses as we must check for the association in the specific class of the record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#invertible_for%3F-instance_method" title="ActiveRecord::Associations::Association#invertible_for? (method)">#invertible_for?</a></td>
      <td><div class='inline'><p>Returns true if inverse association on the given record needs to be set.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Association.html#matches_foreign_key%3F-instance_method" title="ActiveRecord::Associations::Association#matches_foreign_key? (method)">#matches_foreign_key?</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#raise_on_type_mismatch!-instance_method" title="ActiveRecord::Associations::Association#raise_on_type_mismatch! (method)">#raise_on_type_mismatch!</a></td>
      <td><div class='inline'><p>Raises <a href="../AssociationTypeMismatch.html" title="ActiveRecord::AssociationTypeMismatch (class)"><code>::ActiveRecord::AssociationTypeMismatch</code></a> unless <code>record</code> is of the kind of the class of the associated objects.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Association.html#scope_for_create-instance_method" title="ActiveRecord::Associations::Association#scope_for_create (method)">#scope_for_create</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#skip_statement_cache%3F-instance_method" title="ActiveRecord::Associations::Association#skip_statement_cache? (method)">#skip_statement_cache?</a></td>
      <td><div class='inline'><p>Returns true if statement cache should be skipped on the association reader.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m priv nodoc' href="Association.html#skip_strict_loading-instance_method" title="ActiveRecord::Associations::Association#skip_strict_loading (method)">#skip_strict_loading</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#stale_state-instance_method" title="ActiveRecord::Associations::Association#stale_state (method)">#stale_state</a></td>
      <td><div class='inline'><p>This should be implemented to return the values of the relevant key(s) on the owner, so that when stale_state is different from the value stored on the last find_target, the target is stale.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv nodoc' href="Association.html#target_scope-instance_method" title="ActiveRecord::Associations::Association#target_scope (method)">#target_scope</a></td>
      <td><div class='inline'><p>Can be overridden (i.e. in <a href="ThroughAssociation.html" title="ActiveRecord::Associations::ThroughAssociation (module)"><code>ThroughAssociation</code></a>) to merge in other scopes (i.e.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <p class='notice'>This class inherits a constructor from <a href="Association.html#new-class_method" title="ActiveRecord::Associations::Association.new (method)">ActiveRecord::Associations::Association</a></p>
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="empty?-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>empty?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if the collection is empty.</p>

<p>If the collection has been loaded it is equivalent to <code>collection.size.zero?</code>. If the collection has not been loaded, it is equivalent to <code>!collection.exists?</code>. If the collection has not already been loaded and you are going to fetch the records anyway it is better to check <code>collection.length.zero?</code>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L230-L236'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='230' data-end='236'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 230</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_loaded?'>loaded?</span> <span class='op'>||</span> <span class='ivar'>@association_ids</span> <span class='op'>||</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_has_cached_counter?'>has_cached_counter?</span>
    <span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span>.<span class='id identifier rubyid_zero?'>zero?</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="ActiveRecord::Associations::CollectionAssociation#scope (method)">scope</a></span>.<span class='id identifier rubyid_exists?'>exists?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_from_target?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>find_from_target?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L304-L310'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='304' data-end='310'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 304</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_from_target?'>find_from_target?</span>
  <span class='id identifier rubyid_loaded?'>loaded?</span> <span class='op'>||</span>
    (<span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_strict_loading?'>strict_loading?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_strict_loading_all?'>strict_loading_all?</span>) <span class='op'>||</span>
    <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_strict_loading?'>strict_loading?</span> <span class='op'>||</span>
    <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>||</span>
    <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>||</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_changed?'>changed?</span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="null_scope?-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>null_scope?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L300-L302'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='300' data-end='302'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 300</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_null_scope?'>null_scope?</span>
  <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_foreign_key_present?'>foreign_key_present?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="target=-instance_method">
  <h3 class='signature wo  nodoc'>
    #<strong>target=</strong>(record)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L281-L292'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='281' data-end='292'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 281</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_target='>target=</span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>unless</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_has_many_inversing'>has_many_inversing</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>when</span> <span class='kw'>nil</span>
    <span class='comment'># It&#39;s not possible to remove the record from the inverse association.
</span>  <span class='kw'>when</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>
    <span class='kw'>super</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_replace_on_target'><a href="#replace_on_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace_on_target (method)">replace_on_target</a></span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>replace:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>inversing:</span> <span class='kw'>true</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="_create_record-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>_create_record</strong>(attributes, raise = false, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L346-L366'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='346' data-end='366'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 346</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__create_record'>_create_record</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_raise'>raise</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_persisted?'>persisted?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../RecordNotSaved.html" title="ActiveRecord::RecordNotSaved (class)">RecordNotSaved</a></span>.<span class='id identifier rubyid_new'><a href="../RecordNotSaved.html#new-class_method" title="ActiveRecord::RecordNotSaved.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You cannot call create unless the parent is saved</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_owner'>owner</span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid__create_record'>_create_record</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='id identifier rubyid_raise'>raise</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_build_record'>build_record</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_transaction'><a href="#transaction-instance_method" title="ActiveRecord::Associations::CollectionAssociation#transaction (method)">transaction</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_add_to_target'><a href="#add_to_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#add_to_target (method)">add_to_target</a></span>(<span class='id identifier rubyid_record'>record</span>) <span class='kw'>do</span>
        <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_insert_record'><a href="#insert_record-instance_method" title="ActiveRecord::Associations::CollectionAssociation#insert_record (method)">insert_record</a></span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_raise'>raise</span>) {
          <span class='ivar'>@_was_loaded</span> <span class='op'>=</span> <span class='id identifier rubyid_loaded?'>loaded?</span>
        }
      <span class='kw'>end</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_result'>result</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="add_to_target-instance_method">
  <h3 class='signature nodoc'>
    #<strong>add_to_target</strong>(record, skip_callbacks: false, replace: false, &amp;block)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L277-L279'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='277' data-end='279'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 277</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_to_target'>add_to_target</span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='label'>skip_callbacks:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>replace:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_replace_on_target'><a href="#replace_on_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace_on_target (method)">replace_on_target</a></span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span><span class='comma'>,</span> <span class='label'>replace:</span> <span class='id identifier rubyid_replace'><a href="#replace-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace (method)">replace</a></span> <span class='op'>||</span> <span class='id identifier rubyid_association_scope'>association_scope</span>.<span class='id identifier rubyid_distinct_value'>distinct_value</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build-instance_method">
  <h3 class='signature nodoc'>
    #<strong>build</strong>(attributes = nil, &amp;block)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L115-L121'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='115' data-end='121'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 115</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build'>build</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_build'>build</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_add_to_target'><a href="#add_to_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#add_to_target (method)">add_to_target</a></span>(<span class='id identifier rubyid_build_record'>build_record</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)<span class='comma'>,</span> <span class='label'>replace:</span> <span class='kw'>true</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="callback-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>callback</strong>(method, record)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L484-L488'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='484' data-end='488'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 484</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_callback'>callback</span>(<span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='id identifier rubyid_callbacks_for'><a href="#callbacks_for-instance_method" title="ActiveRecord::Associations::CollectionAssociation#callbacks_for (method)">callbacks_for</a></span>(<span class='id identifier rubyid_method'>method</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_callback'>callback</span><span class='op'>|</span>
    <span class='id identifier rubyid_callback'>callback</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='id identifier rubyid_owner'>owner</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="callbacks_for-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>callbacks_for</strong>(callback_name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L490-L497'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='490' data-end='497'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 490</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_callbacks_for'>callbacks_for</span>(<span class='id identifier rubyid_callback_name'>callback_name</span>)
  <span class='id identifier rubyid_full_callback_name'>full_callback_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_callback_name'>callback_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_for_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='id identifier rubyid_full_callback_name'>full_callback_name</span>)
    <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_full_callback_name'>full_callback_name</span>)
  <span class='kw'>else</span>
    []
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="concat-instance_method">
  <h3 class='signature nodoc'>
    #<strong>concat</strong>(*records)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Add <code>records</code> to this association. Since <code><<</code> flattens its argument list and inserts each record, <code>push</code> and <code>concat</code> behave identically.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L125-L133'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='125' data-end='133'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 125</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_concat'>concat</span>(<span class='op'>*</span><span class='id identifier rubyid_records'>records</span>)
  <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_flatten'>flatten</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_new_record?'>new_record?</span>
    <span class='id identifier rubyid_skip_strict_loading'>skip_strict_loading</span> { <span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span> }
    <span class='id identifier rubyid_concat_records'><a href="#concat_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#concat_records (method)">concat_records</a></span>(<span class='id identifier rubyid_records'>records</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_transaction'><a href="#transaction-instance_method" title="ActiveRecord::Associations::CollectionAssociation#transaction (method)">transaction</a></span> { <span class='id identifier rubyid_concat_records'><a href="#concat_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#concat_records (method)">concat_records</a></span>(<span class='id identifier rubyid_records'>records</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="concat_records-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>concat_records</strong>(records, raise = false)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="../Rollback.html" title="ActiveRecord::Rollback (class)">ActiveRecord::Rollback</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L430-L447'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='430' data-end='447'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 430</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_concat_records'>concat_records</span>(<span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_raise'>raise</span> <span class='op'>=</span> <span class='kw'>false</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise_on_type_mismatch!'>raise_on_type_mismatch!</span>(<span class='id identifier rubyid_record'>record</span>)
    <span class='id identifier rubyid_add_to_target'><a href="#add_to_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#add_to_target (method)">add_to_target</a></span>(<span class='id identifier rubyid_record'>record</span>) <span class='kw'>do</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_new_record?'>new_record?</span>
        <span class='id identifier rubyid_result'>result</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_insert_record'><a href="#insert_record-instance_method" title="ActiveRecord::Associations::CollectionAssociation#insert_record (method)">insert_record</a></span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_raise'>raise</span>) {
          <span class='ivar'>@_was_loaded</span> <span class='op'>=</span> <span class='id identifier rubyid_loaded?'>loaded?</span>
        }
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_result'>result</span>

  <span class='id identifier rubyid_records'>records</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature nodoc'>
    #<strong>delete</strong>(*records)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes <code>records</code> from this association calling <code>before_remove</code> and <code>after_remove</code> callbacks.</p>

<p>This method is abstract in the sense that <a href="#delete_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete_records (method)">#delete_records</a> has to be provided by descendants. Note this method does not imply the records are actually removed from the database, that depends precisely on <a href="#delete_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete_records (method)">#delete_records</a>. They are in any case removed from the collection.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L184-L186'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='184' data-end='186'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 184</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>(<span class='op'>*</span><span class='id identifier rubyid_records'>records</span>)
  <span class='id identifier rubyid_delete_or_destroy'><a href="#delete_or_destroy-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete_or_destroy (method)">delete_or_destroy</a></span>(<span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_dependent'>dependent</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_all-instance_method">
  <h3 class='signature nodoc'>
    #<strong>delete_all</strong>(dependent = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes all records from the association without calling callbacks on the associated records. It honors the <code>:dependent</code> option. However if the <code>:dependent</code> value is <code>:destroy</code> then in that case the <code>:delete_all</code> deletion strategy for the association is applied.</p>

<p>You can force a particular deletion strategy by passing a parameter.</p>

<p>Example:</p>

<p>@author.books.delete_all(:nullify) @author.books.delete_all(:delete_all)</p>

<p>See delete for more info.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L148-L165'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='148' data-end='165'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 148</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_all'>delete_all</span>(<span class='id identifier rubyid_dependent'>dependent</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_dependent'>dependent</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_nullify'>nullify</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete_all'>delete_all</span>].<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_dependent'>dependent</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Valid values are :nullify or :delete_all</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_dependent'>dependent</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_dependent'>dependent</span>
    <span class='id identifier rubyid_dependent'>dependent</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_dependent'>dependent</span>] <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'><a href="#destroy-instance_method" title="ActiveRecord::Associations::CollectionAssociation#destroy (method)">destroy</a></span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_delete_all'>delete_all</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_dependent'>dependent</span>]
  <span class='kw'>end</span>

  <span class='id identifier rubyid_delete_or_nullify_all_records'>delete_or_nullify_all_records</span>(<span class='id identifier rubyid_dependent'>dependent</span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Associations::CollectionAssociation#reset (method)">reset</a></span>
    <span class='id identifier rubyid_loaded!'>loaded!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_or_destroy-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>delete_or_destroy</strong>(records, method)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L377-L389'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='377' data-end='389'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 377</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_or_destroy'>delete_or_destroy</span>(<span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#empty? (method)">empty?</a></span>
  <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_find'><a href="#find-instance_method" title="ActiveRecord::Associations::CollectionAssociation#find (method)">find</a></span>(<span class='id identifier rubyid_records'>records</span>) <span class='kw'>if</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'><a href="../../Integer.html" title="Integer (class)">Integer</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'><a href="../../String.html" title="String (class)">String</a></span>) }
  <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_flatten'>flatten</span>
  <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_raise_on_type_mismatch!'>raise_on_type_mismatch!</span>(<span class='id identifier rubyid_record'>record</span>) }
  <span class='id identifier rubyid_existing_records'>existing_records</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_reject'>reject</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record?'>new_record?</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_existing_records'>existing_records</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#empty? (method)">empty?</a></span>
    <span class='id identifier rubyid_remove_records'><a href="#remove_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#remove_records (method)">remove_records</a></span>(<span class='id identifier rubyid_existing_records'>existing_records</span><span class='comma'>,</span> <span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_transaction'><a href="#transaction-instance_method" title="ActiveRecord::Associations::CollectionAssociation#transaction (method)">transaction</a></span> { <span class='id identifier rubyid_remove_records'><a href="#remove_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#remove_records (method)">remove_records</a></span>(<span class='id identifier rubyid_existing_records'>existing_records</span><span class='comma'>,</span> <span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_records-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>delete_records</strong>(records, method)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Delete the given records from the association, using one of the methods <code>:destroy</code>, <code>:delete_all</code> or <code>:nullify</code> (or <code>nil</code>, in which case a default is used).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>NotImplementedError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L406-L408'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='406' data-end='408'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 406</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_records'>delete_records</span>(<span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy-instance_method">
  <h3 class='signature nodoc'>
    #<strong>destroy</strong>(*records)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the <code>records</code> and removes them from this association calling <code>before_remove</code>, <code>after_remove</code>, <code>before_destroy</code> and <code>after_destroy</code> callbacks.</p>

<p>Note that this method removes records from the database ignoring the <code>:dependent</code> option.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L193-L195'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='193' data-end='195'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 193</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>(<span class='op'>*</span><span class='id identifier rubyid_records'>records</span>)
  <span class='id identifier rubyid_delete_or_destroy'><a href="#delete_or_destroy-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete_or_destroy (method)">delete_or_destroy</a></span>(<span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy_all-instance_method">
  <h3 class='signature nodoc'>
    #<strong>destroy_all</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Destroy all the records from this association.</p>

<p>See destroy for more info.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L170-L175'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='170' data-end='175'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 170</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_all'>destroy_all</span>
  <span class='id identifier rubyid_destroy'><a href="#destroy-instance_method" title="ActiveRecord::Associations::CollectionAssociation#destroy (method)">destroy</a></span>(<span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span>).<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Associations::CollectionAssociation#reset (method)">reset</a></span>
    <span class='id identifier rubyid_loaded!'>loaded!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find-instance_method">
  <h3 class='signature nodoc'>
    #<strong>find</strong>(*args)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L92-L113'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='92' data-end='113'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 92</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find'>find</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_inverse_of'>inverse_of</span>] <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_loaded?'>loaded?</span>
    <span class='id identifier rubyid_args_flatten'>args_flatten</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_flatten'>flatten</span>
    <span class='id identifier rubyid_model'>model</span> <span class='op'>=</span> <span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="ActiveRecord::Associations::CollectionAssociation#scope (method)">scope</a></span>.<span class='id identifier rubyid_klass'>klass</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_args_flatten'>args_flatten</span>.<span class='id identifier rubyid_blank?'>blank?</span>
      <span class='id identifier rubyid_error_message'>error_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Couldn&#39;t find </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> without an ID</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)">RecordNotFound</a></span>.<span class='id identifier rubyid_new'><a href="../RecordNotFound.html#new-class_method" title="ActiveRecord::RecordNotFound.new (method)">new</a></span>(<span class='id identifier rubyid_error_message'>error_message</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span>.<span class='id identifier rubyid_primary_key'>primary_key</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_find_by_scan'><a href="#find_by_scan-instance_method" title="ActiveRecord::Associations::CollectionAssociation#find_by_scan (method)">find_by_scan</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)

    <span class='id identifier rubyid_result_size'>result_size</span> <span class='op'>=</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_result'>result</span>).<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span> <span class='op'>||</span> <span class='id identifier rubyid_result_size'>result_size</span> <span class='op'>!=</span> <span class='id identifier rubyid_args_flatten'>args_flatten</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span>
      <span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="ActiveRecord::Associations::CollectionAssociation#scope (method)">scope</a></span>.<span class='id identifier rubyid_raise_record_not_found_exception!'>raise_record_not_found_exception!</span>(<span class='id identifier rubyid_args_flatten'>args_flatten</span><span class='comma'>,</span> <span class='id identifier rubyid_result_size'>result_size</span><span class='comma'>,</span> <span class='id identifier rubyid_args_flatten'>args_flatten</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="ActiveRecord::Associations::CollectionAssociation#scope (method)">scope</a></span>.<span class='id identifier rubyid_find'>find</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_by_scan-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>find_by_scan</strong>(*args)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the <code>:inverse_of</code> option has been specified, then <a href="#find-instance_method" title="ActiveRecord::Associations::CollectionAssociation#find (method)">#find</a> scans the entire collection.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L513-L524'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='513' data-end='524'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 513</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_by_scan'>find_by_scan</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_expects_array'>expects_array</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
  <span class='id identifier rubyid_ids'>ids</span>           <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_flatten'>flatten</span>.<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>).<span class='id identifier rubyid_uniq'>uniq</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span>.<span class='id identifier rubyid_detect'>detect</span> { <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_to_s'>to_s</span> }
    <span class='id identifier rubyid_expects_array'>expects_array</span> <span class='op'>?</span> [ <span class='id identifier rubyid_record'>record</span> ] <span class='op'>:</span> <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span>.<span class='id identifier rubyid_select'>select</span> { <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_to_s'>to_s</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ids_reader-instance_method">
  <h3 class='signature nodoc'>
    #<strong>ids_reader</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Implements the ids reader method, e.g. foo.item_ids for <code>Foo.has_many</code> <code>:items</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L49-L57'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='49' data-end='57'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 49</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ids_reader'>ids_reader</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_loaded?'>loaded?</span>
    <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_pluck'>pluck</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_association_primary_key'>association_primary_key</span>)
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#empty? (method)">empty?</a></span>
    <span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span>.<span class='id identifier rubyid_pluck'>pluck</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_association_primary_key'>association_primary_key</span>)
  <span class='kw'>else</span>
    <span class='ivar'>@association_ids</span> <span class='op'>||=</span> <span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="ActiveRecord::Associations::CollectionAssociation#scope (method)">scope</a></span>.<span class='id identifier rubyid_pluck'>pluck</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_association_primary_key'>association_primary_key</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ids_writer-instance_method">
  <h3 class='signature nodoc'>
    #<strong>ids_writer</strong>(ids)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Implements the ids writer method, e.g. foo.item_ids= for <code>Foo.has_many</code> <code>:items</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L60-L83'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='60' data-end='83'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 60</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ids_writer'>ids_writer</span>(<span class='id identifier rubyid_ids'>ids</span>)
  <span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_association_primary_key'>association_primary_key</span>
  <span class='id identifier rubyid_pk_type'>pk_type</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_type_for_attribute'>type_for_attribute</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>)
  <span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>(<span class='id identifier rubyid_ids'>ids</span>).<span class='id identifier rubyid_compact_blank'>compact_blank</span>
  <span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_map!'>map!</span> { <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span> <span class='id identifier rubyid_pk_type'>pk_type</span>.<span class='id identifier rubyid_cast'>cast</span>(<span class='id identifier rubyid_id'>id</span>) }

  <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_composite_primary_key?'>composite_primary_key?</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ids'>ids</span>).<span class='id identifier rubyid_index_by'>index_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
      <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>) }
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ids'>ids</span>).<span class='id identifier rubyid_index_by'>index_by</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
      <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>.<span class='id identifier rubyid_values_at'>values_at</span>(<span class='op'>*</span><span class='id identifier rubyid_ids'>ids</span>).<span class='id identifier rubyid_compact'>compact</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span> <span class='op'>!=</span> <span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span>
    <span class='id identifier rubyid_found_ids'>found_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__read_attribute'>_read_attribute</span>(<span class='id identifier rubyid_primary_key'>primary_key</span>) }
    <span class='id identifier rubyid_not_found_ids'>not_found_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_ids'>ids</span> <span class='op'>-</span> <span class='id identifier rubyid_found_ids'>found_ids</span>
    <span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_raise_record_not_found_exception!'>raise_record_not_found_exception!</span>(<span class='id identifier rubyid_ids'>ids</span><span class='comma'>,</span> <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span><span class='comma'>,</span> <span class='id identifier rubyid_ids'>ids</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Associations::CollectionAssociation#size (method)">size</a></span><span class='comma'>,</span> <span class='id identifier rubyid_primary_key'>primary_key</span><span class='comma'>,</span> <span class='id identifier rubyid_not_found_ids'>not_found_ids</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_replace'><a href="#replace-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace (method)">replace</a></span>(<span class='id identifier rubyid_records'>records</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="include?-instance_method">
  <h3 class='signature nodoc'>
    #<strong>include?</strong>(record)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L256-L266'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='256' data-end='266'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 256</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_klass'>klass</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span>
      <span class='id identifier rubyid_include_in_memory?'><a href="#include_in_memory%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include_in_memory? (method)">include_in_memory?</a></span>(<span class='id identifier rubyid_record'>record</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_loaded?'>loaded?</span> <span class='op'>?</span> <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_record'>record</span>) <span class='op'>:</span> <span class='id identifier rubyid_scope'><a href="#scope-instance_method" title="ActiveRecord::Associations::CollectionAssociation#scope (method)">scope</a></span>.<span class='id identifier rubyid_exists?'>exists?</span>(<span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_id'>id</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="include_in_memory?-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>include_in_memory?</strong>(record)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L499-L509'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='499' data-end='509'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 499</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_include_in_memory?'>include_in_memory?</span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Reflection.html" title="ActiveRecord::Reflection (module)">Reflection</a></span><span class='op'>::</span><span class='const'><a href="../Reflection/ThroughReflection.html" title="ActiveRecord::Reflection::ThroughReflection (class)">ThroughReflection</a></span>)
    <span class='id identifier rubyid_assoc'>assoc</span> <span class='op'>=</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_association'><a href="../Associations.html#association-instance_method" title="ActiveRecord::Associations#association (method)">association</a></span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_through_reflection'>through_reflection</span>.<span class='id identifier rubyid_name'>name</span>)
    <span class='id identifier rubyid_assoc'>assoc</span>.<span class='id identifier rubyid_reader'><a href="#reader-instance_method" title="ActiveRecord::Associations::CollectionAssociation#reader (method)">reader</a></span>.<span class='id identifier rubyid_any?'>any?</span> { <span class='op'>|</span><span class='id identifier rubyid_source'>source</span><span class='op'>|</span>
      <span class='id identifier rubyid_target_reflection'>target_reflection</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_source_reflection'>source_reflection</span>.<span class='id identifier rubyid_name'>name</span>)
      <span class='id identifier rubyid_target_reflection'>target_reflection</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>) <span class='op'>?</span> <span class='id identifier rubyid_target_reflection'>target_reflection</span>.<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_record'>record</span>) <span class='op'>:</span> <span class='id identifier rubyid_target_reflection'>target_reflection</span> <span class='op'>==</span> <span class='id identifier rubyid_record'>record</span>
    } <span class='op'>||</span> <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_record-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>insert_record</strong>(record, validate = true, raise = false, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Do the relevant stuff to insert the given record into the association collection.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L369-L375'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='369' data-end='375'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 369</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert_record'>insert_record</span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_validate'>validate</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_raise'>raise</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_raise'>raise</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_save!'>save!</span>(<span class='label'>validate:</span> <span class='id identifier rubyid_validate'>validate</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_save'>save</span>(<span class='label'>validate:</span> <span class='id identifier rubyid_validate'>validate</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_target-instance_method">
  <h3 class='signature nodoc'>
    #<strong>load_target</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L268-L275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='268' data-end='275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 268</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_target'>load_target</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_find_target?'>find_target?</span>
    <span class='ivar'>@target</span> <span class='op'>=</span> <span class='id identifier rubyid_merge_target_lists'><a href="#merge_target_lists-instance_method" title="ActiveRecord::Associations::CollectionAssociation#merge_target_lists (method)">merge_target_lists</a></span>(<span class='id identifier rubyid_find_target'>find_target</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_loaded!'>loaded!</span>
  <span class='id identifier rubyid_target'>target</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="merge_target_lists-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>merge_target_lists</strong>(persisted, memory)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>We have some records loaded from the database (persisted) and some that are in-memory (memory). The same record may be represented in the persisted array and in the memory array.</p>

<p>So the task of this method is to merge them according to the following rules:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>*</span> <span class='const'>The</span> <span class='id identifier rubyid_final'>final</span> <span class='id identifier rubyid_array'>array</span> <span class='id identifier rubyid_must'>must</span> <span class='kw'>not</span> <span class='id identifier rubyid_have'>have</span> <span class='id identifier rubyid_duplicates'>duplicates</span>
<span class='op'>*</span> <span class='const'>The</span> <span class='id identifier rubyid_order'>order</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_persisted'>persisted</span> <span class='id identifier rubyid_array'>array</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_be'>be</span> <span class='id identifier rubyid_preserved'>preserved</span>
<span class='op'>*</span> <span class='const'>Any</span> <span class='id identifier rubyid_changes'>changes</span> <span class='id identifier rubyid_made'>made</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_attributes'>attributes</span> <span class='id identifier rubyid_on'>on</span> <span class='id identifier rubyid_objects'>objects</span> <span class='kw'>in</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_memory'>memory</span> <span class='id identifier rubyid_array'>array</span> <span class='id identifier rubyid_are'>are</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_be'>be</span> <span class='id identifier rubyid_preserved'>preserved</span>
<span class='op'>*</span> <span class='const'>Otherwise</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span> <span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_have'>have</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_value'>value</span> <span class='id identifier rubyid_found'>found</span> <span class='kw'>in</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_database'>database</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L327-L344'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='327' data-end='344'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 327</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_merge_target_lists'>merge_target_lists</span>(<span class='id identifier rubyid_persisted'>persisted</span><span class='comma'>,</span> <span class='id identifier rubyid_memory'>memory</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_persisted'>persisted</span> <span class='kw'>if</span> <span class='id identifier rubyid_memory'>memory</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#empty? (method)">empty?</a></span>

  <span class='id identifier rubyid_persisted'>persisted</span>.<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_mem_record'>mem_record</span> <span class='op'>=</span> <span class='id identifier rubyid_memory'>memory</span>.<span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete (method)">delete</a></span>(<span class='id identifier rubyid_record'>record</span>)

      ((<span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_attribute_names'>attribute_names</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_mem_record'>mem_record</span>.<span class='id identifier rubyid_attribute_names'>attribute_names</span>) <span class='op'>-</span> <span class='id identifier rubyid_mem_record'>mem_record</span>.<span class='id identifier rubyid_changed_attribute_names_to_save'>changed_attribute_names_to_save</span> <span class='op'>-</span> <span class='id identifier rubyid_mem_record'>mem_record</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid__attr_readonly'>_attr_readonly</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
        <span class='id identifier rubyid_mem_record'>mem_record</span>.<span class='id identifier rubyid__write_attribute'>_write_attribute</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>[<span class='id identifier rubyid_name'>name</span>])
      <span class='kw'>end</span>

      <span class='id identifier rubyid_mem_record'>mem_record</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_record'>record</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_persisted'>persisted</span> <span class='op'>+</span> <span class='id identifier rubyid_memory'>memory</span>.<span class='id identifier rubyid_reject'>reject</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_persisted?'>persisted?</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reader-instance_method">
  <h3 class='signature nodoc'>
    #<strong>reader</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Implements the reader method, e.g. foo.items for <code>Foo.has_many</code> <code>:items</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L32-L41'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='32' data-end='41'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 32</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reader'>reader</span>
  <span class='id identifier rubyid_ensure_klass_exists!'>ensure_klass_exists!</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_stale_target?'>stale_target?</span>
    <span class='id identifier rubyid_reload'>reload</span>
  <span class='kw'>end</span>

  <span class='ivar'>@proxy</span> <span class='op'>||=</span> <span class='const'><a href="CollectionProxy.html" title="ActiveRecord::Associations::CollectionProxy (class)">CollectionProxy</a></span>.<span class='id identifier rubyid_create'><a href="CollectionProxy.html#create-instance_method" title="ActiveRecord::Associations::CollectionProxy#create (method)">create</a></span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='kw'>self</span>)
  <span class='ivar'>@proxy</span>.<span class='id identifier rubyid_reset_scope'>reset_scope</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remove_records-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>remove_records</strong>(existing_records, records, method)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L391-L401'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='391' data-end='401'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 391</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_records'>remove_records</span>(<span class='id identifier rubyid_existing_records'>existing_records</span><span class='comma'>,</span> <span class='id identifier rubyid_records'>records</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>)
  <span class='id identifier rubyid_catch'>catch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_abort'>abort</span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_callback'><a href="#callback-instance_method" title="ActiveRecord::Associations::CollectionAssociation#callback (method)">callback</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_before_remove'>before_remove</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>) }
  <span class='kw'>end</span> <span class='op'>||</span> <span class='kw'>return</span>

  <span class='id identifier rubyid_delete_records'><a href="#delete_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete_records (method)">delete_records</a></span>(<span class='id identifier rubyid_existing_records'>existing_records</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span>) <span class='kw'>if</span> <span class='id identifier rubyid_existing_records'>existing_records</span>.<span class='id identifier rubyid_any?'>any?</span>
  <span class='ivar'>@target</span> <span class='op'>-=</span> <span class='id identifier rubyid_records'>records</span>
  <span class='ivar'>@association_ids</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_records'>records</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_callback'><a href="#callback-instance_method" title="ActiveRecord::Associations::CollectionAssociation#callback (method)">callback</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_after_remove'>after_remove</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>) }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="replace-instance_method">
  <h3 class='signature nodoc'>
    #<strong>replace</strong>(other_array)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Replace this collection with <code>other_array</code>. This will perform a diff and delete/add only records that have changed.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L240-L254'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='240' data-end='254'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 240</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_replace'>replace</span>(<span class='id identifier rubyid_other_array'>other_array</span>)
  <span class='id identifier rubyid_other_array'>other_array</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_raise_on_type_mismatch!'>raise_on_type_mismatch!</span>(<span class='id identifier rubyid_val'>val</span>) }
  <span class='id identifier rubyid_original_target'>original_target</span> <span class='op'>=</span> <span class='id identifier rubyid_skip_strict_loading'>skip_strict_loading</span> { <span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span> }.<span class='id identifier rubyid_dup'>dup</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_new_record?'>new_record?</span>
    <span class='id identifier rubyid_replace_records'><a href="#replace_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace_records (method)">replace_records</a></span>(<span class='id identifier rubyid_other_array'>other_array</span><span class='comma'>,</span> <span class='id identifier rubyid_original_target'>original_target</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_replace_common_records_in_memory'><a href="#replace_common_records_in_memory-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace_common_records_in_memory (method)">replace_common_records_in_memory</a></span>(<span class='id identifier rubyid_other_array'>other_array</span><span class='comma'>,</span> <span class='id identifier rubyid_original_target'>original_target</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_other_array'>other_array</span> <span class='op'>!=</span> <span class='id identifier rubyid_original_target'>original_target</span>
      <span class='id identifier rubyid_transaction'><a href="#transaction-instance_method" title="ActiveRecord::Associations::CollectionAssociation#transaction (method)">transaction</a></span> { <span class='id identifier rubyid_replace_records'><a href="#replace_records-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace_records (method)">replace_records</a></span>(<span class='id identifier rubyid_other_array'>other_array</span><span class='comma'>,</span> <span class='id identifier rubyid_original_target'>original_target</span>) }
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other_array'>other_array</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="replace_common_records_in_memory-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>replace_common_records_in_memory</strong>(new_target, original_target)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L422-L428'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='422' data-end='428'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 422</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_common_records_in_memory'>replace_common_records_in_memory</span>(<span class='id identifier rubyid_new_target'>new_target</span><span class='comma'>,</span> <span class='id identifier rubyid_original_target'>original_target</span>)
  <span class='id identifier rubyid_common_records'>common_records</span> <span class='op'>=</span> <span class='id identifier rubyid_intersection'>intersection</span>(<span class='id identifier rubyid_new_target'>new_target</span><span class='comma'>,</span> <span class='id identifier rubyid_original_target'>original_target</span>)
  <span class='id identifier rubyid_common_records'>common_records</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span>
    <span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_replace_on_target'><a href="#replace_on_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace_on_target (method)">replace_on_target</a></span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span><span class='comma'>,</span> <span class='label'>replace:</span> <span class='kw'>true</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="replace_on_target-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>replace_on_target</strong>(record, skip_callbacks, replace:, inversing: false)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L449-L482'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='449' data-end='482'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 449</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_on_target'>replace_on_target</span>(<span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span><span class='comma'>,</span> <span class='label'>replace:</span><span class='comma'>,</span> <span class='label'>inversing:</span> <span class='kw'>false</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_replace'><a href="#replace-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace (method)">replace</a></span> <span class='op'>&amp;&amp;</span> (<span class='op'>!</span><span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span> <span class='op'>||</span> <span class='ivar'>@replaced_or_added_targets</span>.<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_record'>record</span>))
    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='ivar'>@target</span>.<span class='id identifier rubyid_index'>index</span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_catch'>catch</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_abort'>abort</span>) <span class='kw'>do</span>
    <span class='id identifier rubyid_callback'><a href="#callback-instance_method" title="ActiveRecord::Associations::CollectionAssociation#callback (method)">callback</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_before_add'>before_add</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>end</span> <span class='op'>||</span> <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span>

  <span class='id identifier rubyid_set_inverse_instance'>set_inverse_instance</span>(<span class='id identifier rubyid_record'>record</span>)

  <span class='ivar'>@_was_loaded</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>yield</span>(<span class='id identifier rubyid_record'>record</span>) <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_index'>index</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@replaced_or_added_targets</span>.<span class='id identifier rubyid_include?'><a href="#include%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#include? (method)">include?</a></span>(<span class='id identifier rubyid_record'>record</span>)
    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='ivar'>@target</span>.<span class='id identifier rubyid_index'>index</span>(<span class='id identifier rubyid_record'>record</span>)
  <span class='kw'>end</span>

  <span class='ivar'>@replaced_or_added_targets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_record'>record</span> <span class='kw'>if</span> <span class='id identifier rubyid_inversing'>inversing</span> <span class='op'>||</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>||</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_new_record?'>new_record?</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span>
    <span class='id identifier rubyid_target'>target</span>[<span class='id identifier rubyid_index'>index</span>] <span class='op'>=</span> <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>elsif</span> <span class='ivar'>@_was_loaded</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_loaded?'>loaded?</span>
    <span class='ivar'>@association_ids</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_target'>target</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_callback'><a href="#callback-instance_method" title="ActiveRecord::Associations::CollectionAssociation#callback (method)">callback</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_after_add'>after_add</span><span class='comma'>,</span> <span class='id identifier rubyid_record'>record</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span>

  <span class='id identifier rubyid_record'>record</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@_was_loaded</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="replace_records-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>replace_records</strong>(new_target, original_target)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L410-L420'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='410' data-end='420'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 410</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_records'>replace_records</span>(<span class='id identifier rubyid_new_target'>new_target</span><span class='comma'>,</span> <span class='id identifier rubyid_original_target'>original_target</span>)
  <span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Associations::CollectionAssociation#delete (method)">delete</a></span>(<span class='id identifier rubyid_difference'>difference</span>(<span class='id identifier rubyid_target'>target</span><span class='comma'>,</span> <span class='id identifier rubyid_new_target'>new_target</span>))

  <span class='kw'>unless</span> <span class='id identifier rubyid_concat'><a href="#concat-instance_method" title="ActiveRecord::Associations::CollectionAssociation#concat (method)">concat</a></span>(<span class='id identifier rubyid_difference'>difference</span>(<span class='id identifier rubyid_new_target'>new_target</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span>))
    <span class='ivar'>@target</span> <span class='op'>=</span> <span class='id identifier rubyid_original_target'>original_target</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../RecordNotSaved.html" title="ActiveRecord::RecordNotSaved (class)">RecordNotSaved</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to replace </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> because one or more of the </span><span class='tstring_end'>&quot;</span></span> \
                          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new records could not be saved.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_target'>target</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset-instance_method">
  <h3 class='signature nodoc'>
    #<strong>reset</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L85-L90'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='85' data-end='90'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 85</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reset'>reset</span>
  <span class='kw'>super</span>
  <span class='ivar'>@target</span> <span class='op'>=</span> []
  <span class='ivar'>@replaced_or_added_targets</span> <span class='op'>=</span> <span class='const'>Set</span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_compare_by_identity'>compare_by_identity</span>
  <span class='ivar'>@association_ids</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scope-instance_method">
  <h3 class='signature nodoc'>
    #<strong>scope</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L294-L298'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='294' data-end='298'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 294</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_scope'>scope</span>
  <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='kw'>super</span>
  <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_none!'>none!</span> <span class='kw'>if</span> <span class='id identifier rubyid_null_scope?'><a href="#null_scope%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#null_scope? (method)">null_scope?</a></span>
  <span class='id identifier rubyid_scope'>scope</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="size-instance_method">
  <h3 class='signature nodoc'>
    #<strong>size</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the size of the collection by executing a SELECT COUNT(*) query if the collection hasn’t been loaded, and calling <code>collection.size</code> if it has.</p>

<p>If the collection has been already loaded <code>size</code> and <code>length</code> are equivalent. If not and you are going to need the records anyway <code>length</code> will take one less query. Otherwise <code>size</code> is more efficient.</p>

<p>This method is abstract in the sense that it relies on <code>count_records</code>, which is a method descendants have to provide.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L207-L220'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='207' data-end='220'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 207</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_find_target?'>find_target?</span> <span class='op'>||</span> <span class='id identifier rubyid_loaded?'>loaded?</span>
    <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_size'>size</span>
  <span class='kw'>elsif</span> <span class='ivar'>@association_ids</span>
    <span class='ivar'>@association_ids</span>.<span class='id identifier rubyid_size'>size</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_association_scope'>association_scope</span>.<span class='id identifier rubyid_group_values'>group_values</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#empty? (method)">empty?</a></span>
    <span class='id identifier rubyid_load_target'><a href="#load_target-instance_method" title="ActiveRecord::Associations::CollectionAssociation#load_target (method)">load_target</a></span>.<span class='id identifier rubyid_size'>size</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_association_scope'>association_scope</span>.<span class='id identifier rubyid_distinct_value'>distinct_value</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Associations::CollectionAssociation#empty? (method)">empty?</a></span>
    <span class='id identifier rubyid_unsaved_records'>unsaved_records</span> <span class='op'>=</span> <span class='id identifier rubyid_target'>target</span>.<span class='id identifier rubyid_select'>select</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record?'>new_record?</span>)
    <span class='id identifier rubyid_unsaved_records'>unsaved_records</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>+</span> <span class='id identifier rubyid_count_records'>count_records</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_count_records'>count_records</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="transaction-instance_method">
  <h3 class='signature priv  nodoc'>
    #<strong>transaction</strong>(&amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L313-L315'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='313' data-end='315'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 313</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction'>transaction</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_reflection'>reflection</span>.<span class='id identifier rubyid_klass'>klass</span>.<span class='id identifier rubyid_transaction'>transaction</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="writer-instance_method">
  <h3 class='signature nodoc'>
    #<strong>writer</strong>(records)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Implements the writer method, e.g. foo.items= for <code>Foo.has_many</code> <code>:items</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/activerecord/lib/active_record/associations/collection_association.rb#L44-L46'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='44' data-end='46'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/associations/collection_association.rb', line 44</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_writer'>writer</span>(<span class='id identifier rubyid_records'>records</span>)
  <span class='id identifier rubyid_replace'><a href="#replace-instance_method" title="ActiveRecord::Associations::CollectionAssociation#replace (method)">replace</a></span>(<span class='id identifier rubyid_records'>records</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>