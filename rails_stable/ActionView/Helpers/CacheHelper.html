<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionView::Helpers::CacheHelper &mdash; Rails 7-1-stable</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionView::Helpers::CacheHelper",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 7-1-stable</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActionView.html" title="ActionView (module)">ActionView</a> &raquo; 
        <a class='nodoc' href="../Helpers.html" title="ActionView::Helpers (module)">Helpers</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>CacheHelper&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionView::Helpers::CacheHelper</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a class='nodoc' href="CacheHelper/CachingRegistry.html" title="ActionView::Helpers::CacheHelper::CachingRegistry (module)"><code>CachingRegistry</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="CacheHelper/UncacheableFragmentError.html" title="ActionView::Helpers::CacheHelper::UncacheableFragmentError (class)"><code>UncacheableFragmentError</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a class='nodoc' href="../../ActionDispatch/DebugView.html" title="ActionDispatch::DebugView (class)"><code>::ActionDispatch::DebugView</code></a>,
          <a href="../Base.html" title="ActionView::Base (class)"><code>::ActionView::Base</code></a>,
          <a class='nodoc' href="../Helpers.html" title="ActionView::Helpers (module)"><code>::ActionView::Helpers</code></a>,
          <a href="../TestCase.html" title="ActionView::TestCase (class)"><code>::ActionView::TestCase</code></a>,
          <a href="../TestCase/Behavior.html" title="ActionView::TestCase::Behavior (module)"><code>::ActionView::TestCase::Behavior</code></a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L6'>actionview/lib/action_view/helpers/cache_helper.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Action+View+Cache+Helpers">Action View Cache Helpers</h3>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#caching%3F-instance_method" title="#caching? (instance method)">#<strong>caching?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether the current view fragment is within a <a href="#cache-instance_method" title="ActionView::Helpers::CacheHelper#cache (method)">#cache</a> block.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#cache-instance_method" title="#cache (instance method)">#<strong>cache</strong>(name = {}, options = {}, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This helper exposes a method for caching fragments of a view rather than an entire action or page.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_fragment_name-instance_method" title="#cache_fragment_name (instance method)">#<strong>cache_fragment_name</strong>(name = {}, skip_digest: nil, digest_path: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This helper returns the name of a cache key for a given fragment cache call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_if-instance_method" title="#cache_if (instance method)">#<strong>cache_if</strong>(condition, name = {}, options = {}, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cache fragments of a view if <code>condition</code> is true.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_unless-instance_method" title="#cache_unless (instance method)">#<strong>cache_unless</strong>(condition, name = {}, options = {}, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cache fragments of a view unless <code>condition</code> is true.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uncacheable!-instance_method" title="#uncacheable! (instance method)">#<strong>uncacheable!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises <a href="CacheHelper/UncacheableFragmentError.html" title="ActionView::Helpers::CacheHelper::UncacheableFragmentError (class)"><code>UncacheableFragmentError</code></a> when called from within a <a href="#cache-instance_method" title="ActionView::Helpers::CacheHelper#cache (method)">#cache</a> block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#fragment_for-instance_method" title="#fragment_for (instance method)">#<strong>fragment_for</strong>(name = {}, options = nil, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#fragment_name_with_digest-instance_method" title="#fragment_name_with_digest (instance method)">#<strong>fragment_name_with_digest</strong>(name, digest_path)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#read_fragment_for-instance_method" title="#read_fragment_for (instance method)">#<strong>read_fragment_for</strong>(name, options)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#write_fragment_for-instance_method" title="#write_fragment_for (instance method)">#<strong>write_fragment_for</strong>(name, options, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#digest_path_from_template-instance_method" title="#digest_path_from_template (instance method)">#<strong>digest_path_from_template</strong>(template)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="caching?-instance_method">
  <h3 class='signature ro first'>
    #<strong>caching?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether the current view fragment is within a <a href="#cache-instance_method" title="ActionView::Helpers::CacheHelper#cache (method)">#cache</a> block.</p>

<p>Useful when certain fragments aren’t cacheable:</p>

<pre class="code xml"><code class="xml">&lt;% cache project do %&gt;
  &lt;% raise StandardError, &quot;Caching private data!&quot; if caching? %&gt;
&lt;% end %&gt;
</code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L188-L190'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='188' data-end='190'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 188</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_caching?'>caching?</span>
  <span class='const'><a href="CacheHelper/CachingRegistry.html" title="ActionView::Helpers::CacheHelper::CachingRegistry (module)">CachingRegistry</a></span>.<span class='id identifier rubyid_caching?'><a href="CacheHelper/CachingRegistry.html#caching%3F-instance_method" title="ActionView::Helpers::CacheHelper::CachingRegistry#caching? (method)">caching?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="cache-instance_method">
  <h3 class='signature  first'>
    #<strong>cache</strong>(name = {}, options = {}, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This helper exposes a method for caching fragments of a view rather than an entire action or page. This technique is useful caching pieces like menus, lists of new topics, static HTML fragments, and so on. This method takes a block that contains the content you wish to cache.</p>

<p>The best way to use this is by doing recyclable key-based cache expiration on top of a cache store like Memcached or Redis that’ll automatically kick out old entries.</p>

<p>When using this method, you list the cache dependency as the name of the cache, like so:</p>

<pre class="code xml"><code class="xml">&lt;% cache project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

<p>This approach will assume that when a new topic is added, you’ll touch the project. The cache key generated from this call will be something like:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_views'>views</span><span class='op'>/</span><span class='id identifier rubyid_template'>template</span><span class='op'>/</span><span class='id identifier rubyid_action'>action</span><span class='symbeg'>:</span><span class='int'>7</span><span class='id identifier rubyid_a1156131a6928cb0026877f8b749ac9'>a1156131a6928cb0026877f8b749ac9</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>projects</span><span class='regexp_end'>/</span></span><span class='int'>123</span>
      <span class='op'>^</span><span class='id identifier rubyid_template'>template</span> <span class='id identifier rubyid_path'>path</span>  <span class='op'>^</span><span class='id identifier rubyid_template'>template</span> <span class='id identifier rubyid_tree'>tree</span> <span class='id identifier rubyid_digest'>digest</span>            <span class='op'>^</span><span class='kw'>class</span>   <span class='op'>^</span><span class='id identifier rubyid_id'>id</span></code></pre>

<p>This cache key is stable, but it’s combined with a cache version derived from the project record. When the project updated_at is touched, the <code>#cache_version</code> changes, even if the key stays stable. This means that unlike a traditional key-based cache expiration approach, you won’t be generating cache trash, unused keys, simply because the dependent record is updated.</p>

<p>If your template cache depends on multiple sources (try to avoid this to keep things simple), you can name all these dependencies as part of an array:</p>

<pre class="code xml"><code class="xml">&lt;% cache [ project, current_user ] do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

<p>This will include both records as part of the cache key and updating either of them will expire the cache.</p>

<h5 id="label-Template+digest">Template digest</h5>

<p>The template digest that’s added to the cache key is computed by taking an MD5 of the contents of the entire template file. This ensures that your caches will automatically expire when you change the template file.</p>

<p>Note that the MD5 is taken of the entire template file, not just what’s within the cache do/end call. So it’s possible that changing something outside of that call will still expire the cache.</p>

<p>Additionally, the digestor will automatically look through your template file for explicit and implicit dependencies, and include those as part of the digest.</p>

<p>The digestor can be bypassed by passing skip_digest: true as an option to the cache call:</p>

<pre class="code xml"><code class="xml">&lt;% cache project, skip_digest: true do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

<h5 id="label-Implicit+dependencies">Implicit dependencies</h5>

<p>Most template dependencies can be derived from calls to render in the template itself. Here are some examples of render calls that Cache Digests knows how to decode:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments/comment</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>collection:</span> <span class='id identifier rubyid_commentable'>commentable</span>.<span class='id identifier rubyid_comments'>comments</span>
<span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments/comments</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>comments/comments</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_render'>render</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>comments/comments</span><span class='tstring_end'>&#39;</span></span>)

<span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>header</span><span class='tstring_end'>&quot;</span></span> <span class='id identifier rubyid_translates'>translates</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_render'>render</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comments/header</span><span class='tstring_end'>&quot;</span></span>)

<span class='id identifier rubyid_render'>render</span>(<span class='ivar'>@topic</span>)         <span class='id identifier rubyid_translates'>translates</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_render'>render</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>topics/topic</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_render'>render</span>(<span class='id identifier rubyid_topics'>topics</span>)         <span class='id identifier rubyid_translates'>translates</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_render'>render</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>topics/topic</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_render'>render</span>(<span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_topics'>topics</span>) <span class='id identifier rubyid_translates'>translates</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_render'>render</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>topics/topic</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>It’s not possible to derive all render calls like that, though. Here are a few examples of things that can’t be derived:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_render'>render</span> <span class='id identifier rubyid_group_of_attachments'>group_of_attachments</span>
<span class='id identifier rubyid_render'>render</span> <span class='ivar'>@project</span>.<span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>created_at</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<p>You will have to rewrite those to the explicit form:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attachments/attachment</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>collection:</span> <span class='id identifier rubyid_group_of_attachments'>group_of_attachments</span>
<span class='id identifier rubyid_render'>render</span> <span class='label'>partial:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>documents/document</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>collection:</span> <span class='ivar'>@project</span>.<span class='id identifier rubyid_documents'>documents</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>created_at</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<h4 id="label-Explicit+dependencies">Explicit dependencies</h4>

<p>Sometimes you’ll have template dependencies that can’t be derived at all. This is typically the case when you have template rendering that happens in helpers. Here’s an example:</p>

<pre class="code xml"><code class="xml">&lt;%= render_sortable_todolists @project.todolists %&gt;
</code></pre>

<p>You’ll need to use a special comment format to call those out:</p>

<pre class="code xml"><code class="xml">&lt;%# Template Dependency: todolists/todolist %&gt;
&lt;%= render_sortable_todolists @project.todolists %&gt;
</code></pre>

<p>In some cases, like a single table inheritance setup, you might have a bunch of explicit dependencies. Instead of writing every template out, you can use a wildcard to match any template in a directory:</p>

<pre class="code xml"><code class="xml">&lt;%# Template Dependency: events/* %&gt;
&lt;%= render_categorizable_events @person.events %&gt;
</code></pre>

<p>This marks every template in the directory as a dependency. To find those templates, the wildcard path must be absolutely defined from <code>app/views</code> or paths otherwise added with <code>prepend_view_path</code> or <code>append_view_path</code>. This way the wildcard for <code>app/views/recordings/events</code> would be <code>recordings/events/*</code> etc.</p>

<p>The pattern used to match explicit dependencies is <code>/# {ActionView::Template} Dependency: (\S+)/</code>, so it’s important that you type it out just so. You can only declare one template dependency per line.</p>

<h4 id="label-External+dependencies">External dependencies</h4>

<p>If you use a helper method, for example, inside a cached block and you then update that helper, you’ll have to bump the cache as well. It doesn’t really matter how you do it, but the MD5 of the template file must change. One recommendation is to simply be explicit in a comment, like:</p>

<pre class="code xml"><code class="xml">&lt;%# Helper Dependency Updated: May 6, 2012 at 6pm %&gt;
&lt;%= some_helper_method(person) %&gt;
</code></pre>

<p>Now all you have to do is change that timestamp when the helper method changes.</p>

<h4 id="label-Collection+Caching">Collection Caching</h4>

<p>When rendering a collection of objects that each use the same partial, a <code>:cached</code> option can be passed.</p>

<p>For collections rendered such:</p>

<pre class="code xml"><code class="xml">&lt;%= render partial: &#39;projects/project&#39;, collection: @projects, cached: true %&gt;
</code></pre>

<p>The <code>cached: true</code> will make Action View’s rendering read several templates from cache at once instead of one call per template.</p>

<p>Templates in the collection not already cached are written to cache.</p>

<p>Works great alongside individual template fragment caching. For instance if the template the collection renders is cached like:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># projects/_project.html.erb
</span><span class='op'>&lt;</span><span class='tstring'><span class='tstring_beg'>% </span><span class='tstring_content'>cache</span><span class='tstring_end'> </span></span><span class='id identifier rubyid_project'>project</span> <span class='kw'>do</span> <span class='tstring'><span class='tstring_beg'>%&gt;</span><span class='tstring_content'>
  &lt;%# ... %</span><span class='tstring_end'>&gt;</span></span>
<span class='op'>&lt;</span><span class='tstring'><span class='tstring_beg'>% </span><span class='tstring_content'>end</span><span class='tstring_end'> </span></span><span class='op'>%</span><span class='op'>&gt;</span></code></pre>

<p>Any collection renders will find those cached templates when attempting to read multiple templates at once.</p>

<p>If your collection cache depends on multiple sources (try to avoid this to keep things simple), you can name all these dependencies as part of a block that returns an array:</p>

<pre class="code xml"><code class="xml">&lt;%= render partial: &#39;projects/project&#39;, collection: @projects, cached: -&gt; project { [ project, current_user ] } %&gt;
</code></pre>

<p>This will include both records as part of the cache key and updating either of them will expire the cache.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L168-L179'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='168' data-end='179'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 168</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache'>cache</span>(<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_perform_caching'>perform_caching</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_perform_caching'>perform_caching</span>
    <span class='const'><a href="CacheHelper/CachingRegistry.html" title="ActionView::Helpers::CacheHelper::CachingRegistry (module)">CachingRegistry</a></span>.<span class='id identifier rubyid_track_caching'><a href="CacheHelper/CachingRegistry.html#track_caching-instance_method" title="ActionView::Helpers::CacheHelper::CachingRegistry#track_caching (method)">track_caching</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_name_options'>name_options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_slice'>slice</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_skip_digest'>skip_digest</span>)
      <span class='id identifier rubyid_safe_concat'>safe_concat</span>(<span class='id identifier rubyid_fragment_for'><a href="#fragment_for-instance_method" title="ActionView::Helpers::CacheHelper#fragment_for (method)">fragment_for</a></span>(<span class='id identifier rubyid_cache_fragment_name'><a href="#cache_fragment_name-instance_method" title="ActionView::Helpers::CacheHelper#cache_fragment_name (method)">cache_fragment_name</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_name_options'>name_options</span>)<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>))
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_fragment_name-instance_method">
  <h3 class='signature '>
    #<strong>cache_fragment_name</strong>(name = {}, skip_digest: nil, digest_path: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This helper returns the name of a cache key for a given fragment cache call. By supplying <code>skip_digest: true</code> to cache, the digestion of cache fragments can be manually bypassed. This is useful when cache fragments cannot be manually expired unless you know the exact key which is the case when using memcached.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L240-L246'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='240' data-end='246'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 240</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_fragment_name'>cache_fragment_name</span>(<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='label'>skip_digest:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>digest_path:</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_skip_digest'>skip_digest</span>
    <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fragment_name_with_digest'><a href="#fragment_name_with_digest-instance_method" title="ActionView::Helpers::CacheHelper#fragment_name_with_digest (method)">fragment_name_with_digest</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_digest_path'>digest_path</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_if-instance_method">
  <h3 class='signature '>
    #<strong>cache_if</strong>(condition, name = {}, options = {}, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cache fragments of a view if <code>condition</code> is true</p>

<pre class="code xml"><code class="xml">&lt;% cache_if admin?, project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L215-L223'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='215' data-end='223'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 215</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_if'>cache_if</span>(<span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_condition'>condition</span>
    <span class='id identifier rubyid_cache'><a href="#cache-instance_method" title="ActionView::Helpers::CacheHelper#cache (method)">cache</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>else</span>
    <span class='kw'>yield</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_unless-instance_method">
  <h3 class='signature '>
    #<strong>cache_unless</strong>(condition, name = {}, options = {}, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cache fragments of a view unless <code>condition</code> is true</p>

<pre class="code xml"><code class="xml">&lt;% cache_unless admin?, project do %&gt;
  &lt;b&gt;All the topics on this project&lt;/b&gt;
  &lt;%= render project.topics %&gt;
&lt;% end %&gt;
</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L231-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='231' data-end='233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 231</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_unless'>cache_unless</span>(<span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_cache_if'><a href="#cache_if-instance_method" title="ActionView::Helpers::CacheHelper#cache_if (method)">cache_if</a></span> <span class='op'>!</span><span class='id identifier rubyid_condition'>condition</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="digest_path_from_template-instance_method">
  <h3 class='signature nodoc'>
    #<strong>digest_path_from_template</strong>(template)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L248-L256'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='248' data-end='256'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 248</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_digest_path_from_template'>digest_path_from_template</span>(<span class='id identifier rubyid_template'>template</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='const'><a href="../Digestor.html" title="ActionView::Digestor (class)">Digestor</a></span>.<span class='id identifier rubyid_digest'><a href="../Digestor.html#digest-class_method" title="ActionView::Digestor.digest (method)">digest</a></span>(<span class='label'>name:</span> <span class='id identifier rubyid_template'>template</span>.<span class='id identifier rubyid_virtual_path'>virtual_path</span><span class='comma'>,</span> <span class='label'>format:</span> <span class='id identifier rubyid_template'>template</span>.<span class='id identifier rubyid_format'>format</span><span class='comma'>,</span> <span class='label'>finder:</span> <span class='id identifier rubyid_lookup_context'>lookup_context</span><span class='comma'>,</span> <span class='label'>dependencies:</span> <span class='id identifier rubyid_view_cache_dependencies'>view_cache_dependencies</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_digest'>digest</span>.<span class='id identifier rubyid_present?'>present?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_template'>template</span>.<span class='id identifier rubyid_virtual_path'>virtual_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_digest'>digest</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_template'>template</span>.<span class='id identifier rubyid_virtual_path'>virtual_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fragment_for-instance_method">
  <h3 class='signature priv'>
    #<strong>fragment_for</strong>(name = {}, options = nil, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L270-L278'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='270' data-end='278'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 270</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fragment_for'>fragment_for</span>(<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_read_fragment_for'><a href="#read_fragment_for-instance_method" title="ActionView::Helpers::CacheHelper#read_fragment_for (method)">read_fragment_for</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
    <span class='ivar'>@view_renderer</span>.<span class='id identifier rubyid_cache_hits'>cache_hits</span>[<span class='ivar'>@current_template</span><span class='op'>&amp;.</span><span class='id identifier rubyid_virtual_path'>virtual_path</span>] <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_hit'>hit</span> <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='ivar'>@view_renderer</span>)
    <span class='id identifier rubyid_content'>content</span>
  <span class='kw'>else</span>
    <span class='ivar'>@view_renderer</span>.<span class='id identifier rubyid_cache_hits'>cache_hits</span>[<span class='ivar'>@current_template</span><span class='op'>&amp;.</span><span class='id identifier rubyid_virtual_path'>virtual_path</span>] <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_miss'>miss</span> <span class='kw'>if</span> <span class='kw'>defined?</span>(<span class='ivar'>@view_renderer</span>)
    <span class='id identifier rubyid_write_fragment_for'><a href="#write_fragment_for-instance_method" title="ActionView::Helpers::CacheHelper#write_fragment_for (method)">write_fragment_for</a></span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fragment_name_with_digest-instance_method">
  <h3 class='signature priv'>
    #<strong>fragment_name_with_digest</strong>(name, digest_path)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L259-L268'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='259' data-end='268'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 259</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fragment_name_with_digest'>fragment_name_with_digest</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_digest_path'>digest_path</span>)
  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_url_for'>url_for</span>(<span class='id identifier rubyid_name'>name</span>).<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>://</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_last'>last</span> <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Hash.html" title="Hash (class)">Hash</a></span>)

  <span class='kw'>if</span> <span class='ivar'>@current_template</span><span class='op'>&amp;.</span><span class='id identifier rubyid_virtual_path'>virtual_path</span> <span class='op'>||</span> <span class='id identifier rubyid_digest_path'>digest_path</span>
    <span class='id identifier rubyid_digest_path'>digest_path</span> <span class='op'>||=</span> <span class='id identifier rubyid_digest_path_from_template'><a href="#digest_path_from_template-instance_method" title="ActionView::Helpers::CacheHelper#digest_path_from_template (method)">digest_path_from_template</a></span>(<span class='ivar'>@current_template</span>)
    [ <span class='id identifier rubyid_digest_path'>digest_path</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span> ]
  <span class='kw'>else</span>
    <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_fragment_for-instance_method">
  <h3 class='signature priv'>
    #<strong>read_fragment_for</strong>(name, options)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L280-L282'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='280' data-end='282'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 280</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_fragment_for'>read_fragment_for</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
  <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_read_fragment'>read_fragment</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uncacheable!-instance_method">
  <h3 class='signature '>
    #<strong>uncacheable!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises <a href="CacheHelper/UncacheableFragmentError.html" title="ActionView::Helpers::CacheHelper::UncacheableFragmentError (class)"><code>CacheHelper::UncacheableFragmentError</code></a> when called from within a <a href="#cache-instance_method" title="ActionView::Helpers::CacheHelper#cache (method)">#cache</a> block.</p>

<p>Useful to denote helper methods that can’t participate in fragment caching:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_project_name_with_time'>project_name_with_time</span>(<span class='id identifier rubyid_project'>project</span>)
  <span class='id identifier rubyid_uncacheable!'>uncacheable!</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_project'>project</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='const'><a href="../../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># Which will then raise if used within a cache block:
</span><span class='op'>&lt;</span><span class='tstring'><span class='tstring_beg'>% </span><span class='tstring_content'>cache</span><span class='tstring_end'> </span></span><span class='id identifier rubyid_project'>project</span> <span class='kw'>do</span> <span class='tstring'><span class='tstring_beg'>%&gt;</span><span class='tstring_content'>
  &lt;%= project_name_with_time(project) %</span><span class='tstring_end'>&gt;</span></span>
<span class='op'>&lt;</span><span class='tstring'><span class='tstring_beg'>% </span><span class='tstring_content'>end</span><span class='tstring_end'> </span></span><span class='op'>%</span><span class='op'>&gt;</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="CacheHelper/UncacheableFragmentError.html" title="ActionView::Helpers::CacheHelper::UncacheableFragmentError (class)">UncacheableFragmentError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L205-L207'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='205' data-end='207'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 205</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uncacheable!'>uncacheable!</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="CacheHelper/UncacheableFragmentError.html" title="ActionView::Helpers::CacheHelper::UncacheableFragmentError (class)">UncacheableFragmentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can&#39;t be fragment cached</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_caching?'><a href="#caching%3F-instance_method" title="ActionView::Helpers::CacheHelper#caching? (method)">caching?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="write_fragment_for-instance_method">
  <h3 class='signature priv'>
    #<strong>write_fragment_for</strong>(name, options, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/7-1-stable/actionview/lib/action_view/helpers/cache_helper.rb#L284-L287'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='284' data-end='287'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionview/lib/action_view/helpers/cache_helper.rb', line 284</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_write_fragment_for'>write_fragment_for</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_fragment'>fragment</span> <span class='op'>=</span> <span class='id identifier rubyid_output_buffer'>output_buffer</span>.<span class='id identifier rubyid_capture'>capture</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_controller'>controller</span>.<span class='id identifier rubyid_write_fragment'>write_fragment</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_fragment'>fragment</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>