<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: NEWS &mdash; Ruby-master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "NEWS",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Ruby-master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: NEWS&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="file_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>NEWS for Ruby 3.5.0</h1>

<p>This document is a list of user-visible feature changes
since the <strong>3.4.0</strong> release, except for bug fixes.</p>

<p>Note that each entry is kept to a minimum, see links for details.</p>

<h2>Language changes</h2>

<ul>
<li><p><code>*nil</code> no longer calls <code>nil.to_a</code>, similar to how <code>**nil</code> does
not call <code>nil.to_hash</code>.  [<a href="https://bugs.ruby-lang.org/issues/21047">Feature #21047</a>]</p></li>
<li><p>Logical binary operators (<code>||</code>, <code>&amp;&amp;</code>, <code>and</code> and <code>or</code>) at the
beginning of a line continue the previous line, like fluent dot.
The following two code are equal:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>if</span> <span class='id identifier rubyid_condition1'>condition1</span>
<span class='op'>   &amp;&amp;</span> <span class='id identifier rubyid_condition2'>condition2</span>
  <span class='comment'>#...
</span><span class='kw'>end</span></code></pre>

<pre class="code ruby"><code class="ruby"><span class='kw'>if</span> <span class='id identifier rubyid_condition1'>condition1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_condition2'>condition2</span>
  <span class='comment'>#...
</span><span class='kw'>end</span></code></pre>

<p>[<a href="https://bugs.ruby-lang.org/issues/20925">Feature #20925</a>]</p></li>
</ul>

<h2>Core classes updates</h2>

<p>Note: We&#39;re only listing outstanding class updates.</p>

<ul>
<li><p>Kernel</p>

<ul>
<li><p><code>Kernel#inspect</code> now checks for the existence of a <code>#instance_variables_to_inspect</code> method,
allowing control over which instance variables are displayed in the <code>#inspect</code> string:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>DatabaseConfig</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span>)
    <span class='ivar'>@host</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span>
    <span class='ivar'>@user</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
    <span class='ivar'>@password</span> <span class='op'>=</span> <span class='id identifier rubyid_password'>password</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_instance_variables_to_inspect'>instance_variables_to_inspect</span> <span class='op'>=</span> [<span class='symbeg'>:</span><span class='ivar'>@host</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='ivar'>@user</span>]
<span class='kw'>end</span>

<span class='id identifier rubyid_conf'>conf</span> <span class='op'>=</span> <span class='const'>DatabaseConfig</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hunter2</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_conf'>conf</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'>#=&gt; #&lt;DatabaseConfig:0x0000000104def350 @host=&quot;localhost&quot;, @user=&quot;root&quot;&gt;</span></code></pre>

<p>[<a href="https://bugs.ruby-lang.org/issues/21219">Feature #21219</a>]</p></li>
</ul></li>
<li><p>Binding</p>

<ul>
<li><code>Binding#local_variables</code> does no longer include numbered parameters.
Also, <code>Binding#local_variable_get</code> and <code>Binding#local_variable_set</code> reject
to handle numbered parameters.  [<a href="https://bugs.ruby-lang.org/issues/21049">Bug #21049</a>]</li>
</ul></li>
<li><p>IO</p>

<ul>
<li><code>IO.select</code> accepts <code>Float::INFINITY</code> as a timeout argument.
[<a href="https://bugs.ruby-lang.org/issues/20610">Feature #20610</a>]</li>
</ul></li>
<li><p>Math</p>

<ul>
<li><code>Math.log1p</code> and <code>Math.expm1</code> are added. [<a href="https://bugs.ruby-lang.org/issues/21527">Feature #21527</a>]</li>
</ul></li>
<li><p>Socket</p>

<ul>
<li><code>Socket.tcp</code> &amp; <code>TCPSocket.new</code> accepts <code>open_timeout</code> as a keyword argument to specify
the timeout for the initial connection. [<a href="https://bugs.ruby-lang.org/issues/21347">Feature #21347</a>]</li>
</ul></li>
<li><p>Ractor</p>

<ul>
<li><p><code>Ractor::Port</code> class was added for a new synchronization mechanism
to communicate between Ractors. [<a href="https://bugs.ruby-lang.org/issues/21262">Feature #21262</a>]</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_port1'>port1</span> <span class='op'>=</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'>Port</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_port2'>port2</span> <span class='op'>=</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'>Port</span>.<span class='id identifier rubyid_new'>new</span>
<span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_port1'>port1</span><span class='comma'>,</span> <span class='id identifier rubyid_port2'>port2</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_port1'>port1</span><span class='comma'>,</span> <span class='id identifier rubyid_port2'>port2</span><span class='op'>|</span>
  <span class='id identifier rubyid_port1'>port1</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span>
  <span class='id identifier rubyid_port2'>port2</span> <span class='op'>&lt;&lt;</span> <span class='int'>11</span>
  <span class='id identifier rubyid_port1'>port1</span> <span class='op'>&lt;&lt;</span> <span class='int'>2</span>
  <span class='id identifier rubyid_port2'>port2</span> <span class='op'>&lt;&lt;</span> <span class='int'>12</span>
<span class='kw'>end</span>
<span class='int'>2</span>.<span class='id identifier rubyid_times'>times</span>{ <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_port1'>port1</span>.<span class='id identifier rubyid_receive'>receive</span> } <span class='comment'>#=&gt; 1, 2
</span><span class='int'>2</span>.<span class='id identifier rubyid_times'>times</span>{ <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_port2'>port2</span>.<span class='id identifier rubyid_receive'>receive</span> } <span class='comment'>#=&gt; 11, 12</span></code></pre>

<p><code>Ractor::Port</code> provides the following methods:</p>

<ul>
<li><code>Ractor::Port#receive</code></li>
<li><code>Ractor::Port#send</code> (or <code>Ractor::Port#<<</code>)</li>
<li><code>Ractor::Port#close</code></li>
<li><code>Ractor::Port#closed?</code></li>
</ul>

<p>As result, <code>Ractor.yield</code> and <code>Ractor#take</code> were removed.</p></li>
<li><p><code>Ractor#join</code> and <code>Ractor#value</code> were added to wait for the
termination of a Ractor. These are similar to <code>Thread#join</code>
and <code>Thread#value</code>.</p></li>
<li><p><code>Ractor#monitor</code> and <code>Ractor#unmonitor</code> were added as low-level
interfaces used internally to implement <code>Ractor#join</code>.</p></li>
<li><p><code>Ractor.select</code> now only accepts Ractors and Ports. If Ractors are given,
it returns when a Ractor terminates.</p></li>
<li><p><code>Ractor#default_port</code> was added. Each <code>Ractor</code> has a default port,
which is used by <code>Ractor.send</code>, <code>Ractor.receive</code>.</p></li>
<li><p><code>Ractor#close_incoming</code> and <code>Ractor#close_outgoing</code> were removed.</p></li>
<li><p><code>Ractor.shareable_proc</code> and <code>Ractor.shareable_lambda</code> is introduced
to make shareable Proc or lambda.
[<a href="https://bugs.ruby-lang.org/issues/21550">Feature #21550</a>], [<a href="https://bugs.ruby-lang.org/issues/21557">Feature #21557</a>]</p></li>
</ul></li>
<li><p><code>Set</code></p>

<ul>
<li><code>Set</code> is now a core class, instead of an autoloaded stdlib class.
[<a href="https://bugs.ruby-lang.org/issues/21216">Feature #21216</a>]</li>
</ul></li>
<li><p>String</p>

<ul>
<li>Update Unicode to Version 16.0.0 and Emoji Version 16.0.
[<a href="https://bugs.ruby-lang.org/issues/19908">Feature #19908</a>]<a href="also%20applies%20to%20Regexp"><a href="https://bugs.ruby-lang.org/issues/20724">Feature #20724</a></a></li>
</ul></li>
<li><p>Thread</p>

<ul>
<li>Introduce support for <code>Thread#raise(cause:)</code> argument similar to
<code>Kernel#raise</code>. [<a href="https://bugs.ruby-lang.org/issues/21360">Feature #21360</a>]</li>
</ul></li>
<li><p>Fiber</p>

<ul>
<li>Introduce support for <code>Fiber#raise(cause:)</code> argument similar to
<code>Kernel#raise</code>. [<a href="https://bugs.ruby-lang.org/issues/21360">Feature #21360</a>]</li>
</ul></li>
<li><p>Fiber::Scheduler</p>

<ul>
<li>Introduce <code>Fiber::Scheduler#fiber_interrupt</code> to interrupt a fiber with a
given exception. The initial use case is to interrupt a fiber that is
waiting on a blocking IO operation when the IO operation is closed.
[<a href="https://bugs.ruby-lang.org/issues/21166">Feature #21166</a>]</li>
</ul></li>
<li><p>Pathname</p>

<ul>
<li>Pathname has been promoted from a default gem to a core class of Ruby.
[<a href="https://bugs.ruby-lang.org/issues/17473">Feature #17473</a>]</li>
</ul></li>
</ul>

<h2>Stdlib updates</h2>

<p>The following bundled gems are promoted from default gems.</p>

<ul>
<li>ostruct 0.6.3</li>
<li>pstore 0.2.0</li>
<li>benchmark 0.4.1</li>
<li>logger 1.7.0</li>
<li>rdoc 6.14.2</li>
<li>win32ole 1.9.2</li>
<li>irb 1.15.2</li>
<li>reline 0.6.2</li>
<li>readline 0.0.4</li>
<li>fiddle 1.1.8</li>
</ul>

<p>We only list stdlib changes that are notable feature changes.</p>

<p>Other changes are listed in the following sections. We also listed release
history from the previous bundled version that is Ruby 3.3.0 if it has GitHub
releases.</p>

<p>The following default gem is added.</p>

<ul>
<li>win32-registry 0.1.0</li>
</ul>

<p>The following default gems are updated.</p>

<ul>
<li>RubyGems 3.8.0.dev</li>
<li>bundler 2.8.0.dev</li>
<li>erb 5.0.2</li>
<li>etc 1.4.6</li>
<li>fcntl 1.3.0</li>
<li>io-console 0.8.1</li>
<li>io-nonblock 0.3.2</li>
<li>io-wait 0.3.2</li>
<li>json 2.14.1</li>
<li>optparse 0.7.0.dev.2</li>
<li>prism 1.5.1</li>
<li>psych 5.2.6</li>
<li>resolv 0.6.2</li>
<li>stringio 3.1.8.dev</li>
<li>strscan 3.1.6.dev</li>
<li>uri 1.0.3</li>
<li>weakref 0.1.4</li>
</ul>

<p>The following bundled gems are added.</p>

<p>The following bundled gems are updated.</p>

<ul>
<li>minitest 5.25.5</li>
<li>rake 13.3.0</li>
<li>test-unit 3.7.0</li>
<li>rexml 3.4.2</li>
<li>net-imap 0.5.10</li>
<li>net-smtp 0.5.1</li>
<li>matrix 0.4.3</li>
<li>prime 0.1.4</li>
<li>rbs 3.9.4</li>
<li>debug 1.11.0</li>
<li>base64 0.3.0</li>
<li>bigdecimal 3.2.2</li>
<li>drb 2.2.3</li>
<li>syslog 0.3.0</li>
<li>csv 3.3.5</li>
<li>repl_type_completor 0.1.11</li>
</ul>

<h2>Supported platforms</h2>

<h2>Compatibility issues</h2>

<ul>
<li><p>The following methods were removed from Ractor due because of <code>Ractor::Port</code>:</p>

<ul>
<li><code>Ractor.yield</code></li>
<li><code>Ractor#take</code></li>
<li><code>Ractor#close_incoming</code></li>
<li><code>Ractor#close_outgoging</code></li>
</ul>

<p>[<a href="https://bugs.ruby-lang.org/issues/21262">Feature #21262</a>]</p></li>
<li><p><code>ObjectSpace._id2ref</code> is deprecated. [<a href="https://bugs.ruby-lang.org/issues/15408">Feature #15408</a>]</p></li>
</ul>

<h2>Stdlib compatibility issues</h2>

<ul>
<li><p>CGI library is removed from the default gems. Now we only provide <code>cgi/escape</code> for
the following methods:</p>

<ul>
<li><code>CGI.escape</code> and <code>CGI.unescape</code></li>
<li><code>CGI.escapeHTML</code> and <code>CGI.unescapeHTML</code></li>
<li><code>CGI.escapeURIComponent</code> and <code>CGI.unescapeURIComponent</code></li>
<li><code>CGI.escapeElement</code> and <code>CGI.unescapeElement</code></li>
</ul>

<p>[<a href="https://bugs.ruby-lang.org/issues/21258">Feature #21258</a>]</p></li>
<li><p>With the move of <code>Set</code> from stdlib to core class, <code>set/sorted_set.rb</code> has
been removed, and <code>SortedSet</code> is no longer an autoloaded constant. Please
install the <code>sorted_set</code> gem and <code>require &#39;sorted_set&#39;</code> to use <code>SortedSet</code>.
[<a href="https://bugs.ruby-lang.org/issues/21287">Feature #21287</a>]</p></li>
</ul>

<h2>C API updates</h2>

<ul>
<li><p>IO</p>

<ul>
<li><code>rb_thread_fd_close</code> is deprecated and now a no-op. If you need to expose
file descriptors from C extensions to Ruby code, create an <code>IO</code> instance
using <code>RUBY_IO_MODE_EXTERNAL</code> and use <code>rb_io_close(io)</code> to close it (this
also interrupts and waits for all pending operations on the <code>IO</code>
instance). Directly closing file descriptors does not interrupt pending
operations, and may lead to undefined behaviour. In other words, if two
<code>IO</code> objects share the same file descriptor, closing one does not affect
the other. [<a href="https://bugs.ruby-lang.org/issues/18455">Feature #18455</a>]</li>
</ul></li>
</ul>

<h2>Implementation improvements</h2>

<h3>Ractor</h3>

<p>A lot of work has gone into making Ractors more stable, performant, and usable. These improvements bring Ractors implementation closer to leaving experimental status.</p>

<ul>
<li>Performance improvements

<ul>
<li>Frozen strings and the symbol table internally use a lock-free hash set</li>
<li>Method cache lookups avoid locking in most cases</li>
<li>Class (and geniv) instance variable access is faster and avoids locking</li>
<li>Cache contention is avoided during object allocation</li>
<li><code>object_id</code> avoids locking in most cases</li>
</ul></li>
<li>Bug fixes and stability

<ul>
<li>Fixed possible deadlocks when combining Ractors and Threads</li>
<li>Fixed issues with require and autoload in a Ractor</li>
<li>Fixed encoding/transcoding issues across Ractors</li>
<li>Fixed race conditions in GC operations and method invalidation</li>
<li>Fixed issues with processes forking after starting a Ractor</li>
</ul></li>
</ul>

<h2>JIT</h2>

<ul>
<li>YJIT

<ul>
<li>YJIT stats

<ul>
<li><code>ratio_in_yjit</code> no longer works in the default build.
Use <code>--enable-yjit=stats</code> on <code>configure</code> to enable it on <code>--yjit-stats</code>.</li>
<li>Add <code>invalidate_everything</code> to default stats, which is
incremented when every code is invalidated by TracePoint.</li>
</ul></li>
<li>Add <code>mem_size:</code> and <code>call_threshold:</code> options to <code>RubyVM::YJIT.enable</code>.</li>
</ul></li>
<li>ZJIT

<ul>
<li>Add an experimental method-based JIT compiler.
Use <code>--enable-zjit</code> on <code>configure</code> to enable the <code>--zjit</code> support.</li>
<li>As of Ruby 3.5.0-preview2, ZJIT is not yet ready for speeding up most benchmarks.
Please refrain from evaluating ZJIT just yet. Stay tuned for the Ruby 3.5 release.</li>
</ul></li>
<li>RJIT

<ul>
<li><code>--rjit</code> is removed. We will move the implementation of the third-party JIT API
to the <a href="https://github.com/ruby/rjit">ruby/rjit</a> repository.</li>
</ul></li>
</ul>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>