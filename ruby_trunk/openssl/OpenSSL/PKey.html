<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: OpenSSL::PKey &mdash; openssl  Ruby-master dev</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "OpenSSL::PKey",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-master</a> &raquo; 
      <a href='../'>openssl</a> &raquo; 
      <a href='../_index.html#alpha_P'>Index (P)</a> &raquo; 
        <a href="../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>PKey&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: OpenSSL::PKey</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="PKey/DH.html" title="OpenSSL::PKey::DH (class)"><code>DH</code></a>,
        <a href="PKey/DSA.html" title="OpenSSL::PKey::DSA (class)"><code>DSA</code></a>,
        <a href="PKey/EC.html" title="OpenSSL::PKey::EC (class)"><code>EC</code></a>,
        <a href="PKey/PKey.html" title="OpenSSL::PKey::PKey (class)"><code>PKey</code></a>,
        <a href="PKey/RSA.html" title="OpenSSL::PKey::RSA (class)"><code>RSA</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="PKey/DHError.html" title="OpenSSL::PKey::DHError (class)"><code>DHError</code></a>,
        <a href="PKey/DSAError.html" title="OpenSSL::PKey::DSAError (class)"><code>DSAError</code></a>,
        <a href="PKey/ECError.html" title="OpenSSL::PKey::ECError (class)"><code>ECError</code></a>,
        <a href="PKey/PKeyError.html" title="OpenSSL::PKey::PKeyError (class)"><code>PKeyError</code></a>,
        <a href="PKey/RSAError.html" title="OpenSSL::PKey::RSAError (class)"><code>RSAError</code></a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey.c#L1717'>ext/openssl/ossl_pkey.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey_dh.c#L360'>ext/openssl/ossl_pkey_dh.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey_dsa.c#L337'>ext/openssl/ossl_pkey_dsa.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey_ec.c#L1531'>ext/openssl/ossl_pkey_ec.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey_rsa.c#L540'>ext/openssl/ossl_pkey_rsa.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/lib/openssl/pkey.rb#L9'>ext/openssl/lib/openssl/pkey.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Asymmetric+Public+Key+Algorithms">Asymmetric Public Key Algorithms</h3>

<p>Asymmetric public key algorithms solve the problem of establishing and sharing secret keys to en-/decrypt messages. The key in such an algorithm consists of two parts: a public key that may be distributed to others and a private key that needs to remain secret.</p>

<p>Messages encrypted with a public key can only be decrypted by recipients that are in possession of the associated private key. Since public key algorithms are considerably slower than symmetric key algorithms (cf. <a href="Cipher.html" title="OpenSSL::Cipher (class)"><code>Cipher</code></a>) they are often used to establish a symmetric key shared between two parties that are in possession of each other’s public key.</p>

<p>Asymmetric algorithms offer a lot of nice features that are used in a lot of different areas. A very common application is the creation and validation of digital signatures. To sign a document, the signatory generally uses a message digest algorithm (cf. <a href="Digest.html" title="OpenSSL::Digest (class)"><code>Digest</code></a>) to compute a digest of the document that is then encrypted (i.e. signed) using the private key. Anyone in possession of the public key may then verify the signature by computing the message digest of the original document on their own, decrypting the signature using the signatory’s public key and comparing the result to the message digest they previously computed. The signature is valid if and only if the decrypted signature is equal to this message digest.</p>

<p>The PKey module offers support for three popular public/private key algorithms:</p>
<ul><li>
<p><a href="PKey/RSA.html" title="OpenSSL::PKey::RSA (class)"><code>RSA</code></a> (OpenSSL::PKey::RSA)</p>
</li><li>
<p><a href="PKey/DSA.html" title="OpenSSL::PKey::DSA (class)"><code>DSA</code></a> (OpenSSL::PKey::DSA)</p>
</li><li>
<p>Elliptic Curve Cryptography (OpenSSL::PKey::EC)</p>
</li></ul>

<p>Each of these implementations is in fact a sub-class of the abstract <code>PKey</code> class which offers the interface for supporting digital signatures in the form of <a href="PKey/PKey.html#sign-instance_method" title="OpenSSL::PKey::PKey#sign (method)">PKey#sign</a> and <a href="PKey/PKey.html#verify-instance_method" title="OpenSSL::PKey::PKey#verify (method)">PKey#verify</a>.</p>

<h3 id="label-Diffie-Hellman+Key+Exchange">Diffie-Hellman Key Exchange</h3>

<p>Finally PKey also features <a href="PKey/DH.html" title="OpenSSL::PKey::DH (class)"><code>DH</code></a>, an implementation of the Diffie-Hellman key exchange protocol based on discrete logarithms in finite fields, the same basis that <a href="PKey/DSA.html" title="OpenSSL::PKey::DSA (class)"><code>DSA</code></a> is built on. The Diffie-Hellman protocol can be used to exchange (symmetric) keys over insecure channels without needing any prior joint knowledge between the participating parties. As the security of <a href="PKey/DH.html" title="OpenSSL::PKey::DH (class)"><code>DH</code></a> demands relatively long “public keys” (i.e. the part that is overtly transmitted between participants) <a href="PKey/DH.html" title="OpenSSL::PKey::DH (class)"><code>DH</code></a> tends to be quite slow. If security or speed is your primary concern, <a href="PKey/EC.html" title="OpenSSL::PKey::EC (class)"><code>EC</code></a> offers another implementation of the Diffie-Hellman protocol.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature mf'>
      <a href="#generate_key-class_method" title="generate_key (class method)">.<strong>generate_key</strong>(algo_name [, options])  &#x21d2; PKey </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generates a new key (pair).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#generate_parameters-class_method" title="generate_parameters (class method)">.<strong>generate_parameters</strong>(algo_name [, options])  &#x21d2; PKey </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generates new parameters for the algorithm.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#new_raw_private_key-class_method" title="new_raw_private_key (class method)">.<strong>new_raw_private_key</strong>(algo, string)  &#x21d2; PKey </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>See the <a href="../OpenSSL.html" title="OpenSSL (module)"><code>::OpenSSL</code></a> documentation for EVP_PKEY_new_raw_private_key().</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#new_raw_public_key-class_method" title="new_raw_public_key (class method)">.<strong>new_raw_public_key</strong>(algo, string)  &#x21d2; PKey </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>See the <a href="../OpenSSL.html" title="OpenSSL (module)"><code>::OpenSSL</code></a> documentation for EVP_PKEY_new_raw_public_key().</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#read-class_method" title="read (class method)">.<strong>read</strong>(string [, pwd ])  &#x21d2; PKey </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Reads a DER or PEM encoded string from <em>string</em> or <em>io</em> and returns an instance of the appropriate <code>PKey</code> class.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="generate_key-class_method">
  <h3 class='signature private first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>generate_key</strong>(algo_name [, options])  &#x21d2; <code>PKey</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>generate_key</strong>(pkey [, options])  &#x21d2; <code>PKey</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generates a new key (pair).</p>

<p>If a String is given as the first argument, it generates a new random key for the algorithm specified by the name just as <a href="#generate_parameters-class_method" title="OpenSSL::PKey.generate_parameters (method)">.generate_parameters</a> does. If an <a href="PKey/PKey.html" title="OpenSSL::PKey::PKey (class)"><code>PKey::PKey</code></a> is given instead, it generates a new random key for the same algorithm as the key, using the parameters the key contains.</p>

<p>See <a href="#generate_parameters-class_method" title="OpenSSL::PKey.generate_parameters (method)">.generate_parameters</a> for the details of <em>options</em> and the given block.</p>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pkey_params'>pkey_params</span> <span class='op'>=</span> <span class='const'><a href="../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'>PKey</span>.<span class='id identifier rubyid_generate_parameters'><a href="#generate_parameters-class_method" title="OpenSSL::PKey.generate_parameters (method)">generate_parameters</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DSA</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dsa_paramgen_bits</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2048</span>)
<span class='id identifier rubyid_pkey_params'>pkey_params</span>.<span class='id identifier rubyid_priv_key'>priv_key</span> <span class='comment'>#=&gt; nil
</span><span class='id identifier rubyid_pkey'>pkey</span> <span class='op'>=</span> <span class='const'><a href="../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'>PKey</span>.<span class='id identifier rubyid_generate_key'>generate_key</span>(<span class='id identifier rubyid_pkey_params'>pkey_params</span>)
<span class='id identifier rubyid_pkey'>pkey</span>.<span class='id identifier rubyid_priv_key'>priv_key</span> <span class='comment'>#=&gt; #&lt;OpenSSL::BN 6277...</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey.c#L496-L500'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='496' data-end='500'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 496</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_s_generate_key(int argc, VALUE *argv, VALUE self)
{
    return pkey_generate(argc, argv, self, 0);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="generate_parameters-class_method">
  <h3 class='signature private'>
    .<strong>generate_parameters</strong>(algo_name [, options])  &#x21d2; <code>PKey</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generates new parameters for the algorithm. <em>algo_name</em> is a String that represents the algorithm. The optional argument <em>options</em> is a Hash that specifies the options specific to the algorithm. The order of the options can be important.</p>

<p>A block can be passed optionally. The meaning of the arguments passed to the block varies depending on the implementation of the algorithm. The block may be called once or multiple times, or may not even be called.</p>

<p>For the supported options, see the documentation for the ‘openssl genpkey’ utility command.</p>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pkey'>pkey</span> <span class='op'>=</span> <span class='const'><a href="../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span><span class='op'>::</span><span class='const'>PKey</span>.<span class='id identifier rubyid_generate_parameters'>generate_parameters</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DSA</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dsa_paramgen_bits</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2048</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_pkey'>pkey</span>.<span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_num_bits'>num_bits</span> <span class='comment'>#=&gt; 2048</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey.c#L470-L474'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='470' data-end='474'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 470</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_s_generate_parameters(int argc, VALUE *argv, VALUE self)
{
    return pkey_generate(argc, argv, self, 1);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new_raw_private_key-class_method">
  <h3 class='signature private'>
    .<strong>new_raw_private_key</strong>(algo, string)  &#x21d2; <code>PKey</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See the <a href="../OpenSSL.html" title="OpenSSL (module)"><code>::OpenSSL</code></a> documentation for EVP_PKEY_new_raw_private_key()</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey.c#L669-L692'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='669' data-end='692'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 669</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_new_raw_private_key(VALUE self, VALUE type, VALUE key)
{
    EVP_PKEY *pkey;
    size_t keylen;

    StringValue(key);
    keylen = RSTRING_LEN(key);

#ifdef OSSL_USE_PROVIDER
    pkey = EVP_PKEY_new_raw_private_key_ex(NULL, StringValueCStr(type), NULL,
                                           (unsigned char *)RSTRING_PTR(key),
                                           keylen);
    if (!pkey)
        ossl_raise(ePKeyError, &quot;EVP_PKEY_new_raw_private_key_ex&quot;);
#else
    int pkey_id = lookup_pkey_type(type);
    pkey = EVP_PKEY_new_raw_private_key(pkey_id, NULL, (unsigned char *)RSTRING_PTR(key), keylen);
    if (!pkey)
        ossl_raise(ePKeyError, &quot;EVP_PKEY_new_raw_private_key&quot;);
#endif

    return ossl_pkey_wrap(pkey);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new_raw_public_key-class_method">
  <h3 class='signature private'>
    .<strong>new_raw_public_key</strong>(algo, string)  &#x21d2; <code>PKey</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See the <a href="../OpenSSL.html" title="OpenSSL (module)"><code>::OpenSSL</code></a> documentation for EVP_PKEY_new_raw_public_key()</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey.c#L701-L724'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='701' data-end='724'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 701</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_new_raw_public_key(VALUE self, VALUE type, VALUE key)
{
    EVP_PKEY *pkey;
    size_t keylen;

    StringValue(key);
    keylen = RSTRING_LEN(key);

#ifdef OSSL_USE_PROVIDER
    pkey = EVP_PKEY_new_raw_public_key_ex(NULL, StringValueCStr(type), NULL,
                                          (unsigned char *)RSTRING_PTR(key),
                                          keylen);
    if (!pkey)
        ossl_raise(ePKeyError, &quot;EVP_PKEY_new_raw_public_key_ex&quot;);
#else
    int pkey_id = lookup_pkey_type(type);
    pkey = EVP_PKEY_new_raw_public_key(pkey_id, NULL, (unsigned char *)RSTRING_PTR(key), keylen);
    if (!pkey)
        ossl_raise(ePKeyError, &quot;EVP_PKEY_new_raw_public_key&quot;);
#endif

    return ossl_pkey_wrap(pkey);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>read</strong>(string [, pwd ])  &#x21d2; <code>PKey</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>read</strong>(io [, pwd ])  &#x21d2; <code>PKey</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reads a DER or PEM encoded string from <em>string</em> or <em>io</em> and returns an instance of the appropriate <code>PKey</code> class.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><em>string</em> is a DER- or PEM-encoded string containing an arbitrary private or public key.</p>
</li><li>
<p><em>io</em> is an instance of <a href="../IO.html" title="IO (class)"><code>::IO</code></a> containing a DER- or PEM-encoded arbitrary private or public key.</p>
</li><li>
<p><em>pwd</em> is an optional password in case <em>string</em> or <em>io</em> is an encrypted PEM resource.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/openssl/ossl_pkey.c#L230-L244'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='230' data-end='244'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/openssl/ossl_pkey.c', line 230</span></pre>
<pre class='code cpp'>

static VALUE
ossl_pkey_new_from_data(int argc, VALUE *argv, VALUE self)
{
    EVP_PKEY *pkey;
    BIO *bio;
    VALUE data, pass;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;data, &amp;pass);
    bio = ossl_obj2bio(&amp;data);
    pkey = ossl_pkey_read_generic(bio, ossl_pem_passwd_value(pass));
    BIO_free(bio);
    if (!pkey)
	ossl_raise(ePKeyError, &quot;Could not parse PKey&quot;);
    return ossl_pkey_wrap(pkey);
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>