<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: README &mdash; benchmark  Ruby-master dev</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "README",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-master</a> &raquo; 
      <a href='.'>benchmark</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: README&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1><a href="Benchmark.html" title="Benchmark (module)"><code>Benchmark</code></a></h1>

<p>The Benchmark module provides methods for benchmarking Ruby code, giving detailed reports on the time taken for each task.</p>

<h2>Installation</h2>

<p>Add this line to your application&#39;s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span></code></pre>

<p>And then execute:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_bundle'>bundle</span></code></pre>

<p>Or install it yourself as:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_benchmark'>benchmark</span></code></pre>

<h2>Usage</h2>

<p>The Benchmark module provides methods to measure and report the time used to execute Ruby code.</p>

<p>Measure the time to construct the string given by the expression <code>&quot;a&quot;*1_000_000_000</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='const'><a href="Benchmark.html" title="Benchmark (module)">Benchmark</a></span>.<span class='id identifier rubyid_measure'><a href="Benchmark.html#measure-class_method" title="Benchmark.measure (method)">measure</a></span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='op'>*</span><span class='int'>1_000_000_000</span> }</code></pre>

<p>On my machine (OSX 10.8.3 on i5 1.7 GHz) this generates:</p>

<pre class="code ruby"><code class="ruby"><span class='float'>0.350000</span>   <span class='float'>0.400000</span>   <span class='float'>0.750000</span> (  <span class='float'>0.835234</span>)</code></pre>

<p>This report shows the user CPU time, system CPU time, the total time (sum of user CPU time, system CPU time, children&#39;s user CPU time, and children&#39;s system CPU time), and the elapsed real time. The unit of time is seconds.</p>

<p>Do some experiments sequentially using the #bm method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'><a href="Benchmark.html" title="Benchmark (module)">Benchmark</a></span>.<span class='id identifier rubyid_bm'><a href="Benchmark.html#bm-class_method" title="Benchmark.bm (method)">bm</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span> { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span> { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span> { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">    <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='float'>1.010000</span>   <span class='float'>0.000000</span>   <span class='float'>1.010000</span> (  <span class='float'>1.014479</span>)
<span class='float'>1.000000</span>   <span class='float'>0.000000</span>   <span class='float'>1.000000</span> (  <span class='float'>0.998261</span>)
<span class='float'>0.980000</span>   <span class='float'>0.000000</span>   <span class='float'>0.980000</span> (  <span class='float'>0.981335</span>)</code></pre>

<p>Continuing the previous example, put a label in each report:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'><a href="Benchmark.html" title="Benchmark (module)">Benchmark</a></span>.<span class='id identifier rubyid_bm'><a href="Benchmark.html#bm-class_method" title="Benchmark.bm (method)">bm</a></span>(<span class='int'>7</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span>)   { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span>)  { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">              <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='kw'>for</span><span class='op'>:</span>      <span class='float'>1.010000</span>   <span class='float'>0.000000</span>   <span class='float'>1.010000</span> (  <span class='float'>1.015688</span>)
<span class='id identifier rubyid_times'>times</span><span class='op'>:</span>    <span class='float'>1.000000</span>   <span class='float'>0.000000</span>   <span class='float'>1.000000</span> (  <span class='float'>1.003611</span>)
<span class='id identifier rubyid_upto'>upto</span><span class='op'>:</span>     <span class='float'>1.030000</span>   <span class='float'>0.000000</span>   <span class='float'>1.030000</span> (  <span class='float'>1.028098</span>)</code></pre>

<p>The times for some benchmarks depend on the order in which items are run.  These differences are due to the cost of memory allocation and garbage collection. To avoid these discrepancies, the #bmbm method is provided.  For example, to compare ways to sort an array of floats:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> (<span class='int'>1</span><span class='op'>..</span><span class='int'>1000000</span>).<span class='id identifier rubyid_map'>map</span> { <span class='id identifier rubyid_rand'>rand</span> }
<span class='const'><a href="Benchmark.html" title="Benchmark (module)">Benchmark</a></span>.<span class='id identifier rubyid_bmbm'><a href="Benchmark.html#bmbm-class_method" title="Benchmark.bmbm (method)">bmbm</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort!</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_sort!'>sort!</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span>)  { <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_sort'>sort</span>  }
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rehearsal</span> <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
<span class='id identifier rubyid_sort!'>sort!</span>   <span class='float'>1.490000</span>   <span class='float'>0.010000</span>   <span class='float'>1.500000</span> (  <span class='float'>1.490520</span>)
<span class='id identifier rubyid_sort'>sort</span>    <span class='float'>1.460000</span>   <span class='float'>0.000000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.463025</span>)
<span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span> <span class='id identifier rubyid_total'>total</span><span class='op'>:</span> <span class='float'>2.960000</span><span class='id identifier rubyid_sec'>sec</span>
            <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='id identifier rubyid_sort!'>sort!</span>   <span class='float'>1.460000</span>   <span class='float'>0.000000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.460465</span>)
<span class='id identifier rubyid_sort'>sort</span>    <span class='float'>1.450000</span>   <span class='float'>0.010000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.448327</span>)</code></pre>

<p>Report statistics of sequential experiments with unique labels, using the #benchmark method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'><a href="Benchmark.html" title="Benchmark (module)">Benchmark</a></span>         <span class='comment'># we need the CAPTION and FORMAT constants
</span><span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'><a href="Benchmark.html" title="Benchmark (module)">Benchmark</a></span>.<span class='id identifier rubyid_benchmark'><a href="Benchmark.html#benchmark-class_method" title="Benchmark.benchmark (method)">benchmark</a></span>(<span class='const'>CAPTION</span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='const'>FORMAT</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;total:</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;avg:</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_tf'>tf</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span>)   { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_tt'>tt</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_tu'>tu</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span>)  { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  [<span class='id identifier rubyid_tftttu'>tftttu</span><span class='comma'>,</span> (<span class='id identifier rubyid_tftttu'>tftttu</span>)<span class='op'>/</span><span class='int'>3</span>]
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">             <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='kw'>for</span><span class='op'>:</span>      <span class='float'>0.950000</span>   <span class='float'>0.000000</span>   <span class='float'>0.950000</span> (  <span class='float'>0.952039</span>)
<span class='id identifier rubyid_times'>times</span><span class='op'>:</span>    <span class='float'>0.980000</span>   <span class='float'>0.000000</span>   <span class='float'>0.980000</span> (  <span class='float'>0.984938</span>)
<span class='id identifier rubyid_upto'>upto</span><span class='op'>:</span>     <span class='float'>0.950000</span>   <span class='float'>0.000000</span>   <span class='float'>0.950000</span> (  <span class='float'>0.946787</span>)
<span class='op'>&gt;</span><span class='id identifier rubyid_total'>total</span><span class='op'>:</span>   <span class='float'>2.880000</span>   <span class='float'>0.000000</span>   <span class='float'>2.880000</span> (  <span class='float'>2.883764</span>)
<span class='op'>&gt;</span><span class='id identifier rubyid_avg'>avg</span><span class='op'>:</span>     <span class='float'>0.960000</span>   <span class='float'>0.000000</span>   <span class='float'>0.960000</span> (  <span class='float'>0.961255</span>)</code></pre>

<h2>Development</h2>

<p>After checking out the repo, run <code>bin/setup</code> to install dependencies. Then, run <code>rake test</code> to run the tests. You can also run <code>bin/console</code> for an interactive prompt that will allow you to experiment.</p>

<p>To install this gem onto your local machine, run <code>bundle exec rake install</code>. To release a new version, update the version number in <code>version.rb</code>, and then run <code>bundle exec rake release</code>, which will create a git tag for the version, push git commits and tags, and push the <code>.gem</code> file to <a href="https://rubygems.org">rubygems.org</a>.</p>

<h2>Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at <a href="https://github.com/ruby/benchmark">https://github.com/ruby/benchmark</a>.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>