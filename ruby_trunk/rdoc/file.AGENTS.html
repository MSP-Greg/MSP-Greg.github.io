<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: AGENTS &mdash; rdoc  Ruby-master dev</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "AGENTS",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-master</a> &raquo; 
      <a href='.'>rdoc</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: AGENTS&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1><a href="RDoc.html" title="RDoc (module)"><code>RDoc</code></a> Project Guide for AI Agents</h1>

<h2>Project Overview</h2>

<p><strong>RDoc</strong> is Ruby&#39;s default documentation generation tool that produces HTML and command-line documentation for Ruby projects. It parses Ruby source code, C extensions, and markup files to generate documentation.</p>

<ul>
<li><strong>Repository:</strong> <a href="https://github.com/ruby/rdoc">https://github.com/ruby/rdoc</a></li>
<li><strong>Homepage:</strong> <a href="https://ruby.github.io/rdoc">https://ruby.github.io/rdoc</a></li>
<li><strong>Required Ruby:</strong> See the version specified in gemspec</li>
<li><strong>Main Executables:</strong> <code>rdoc</code> and <code>ri</code></li>
</ul>

<h2>Key Development Commands</h2>

<h3>Testing</h3>

<pre class="code bash"><code class="bash"># Run all tests (default task)
bundle exec rake

# Run unit tests only (excludes RubyGems integration)
bundle exec rake normal_test

# Run RubyGems integration tests only
bundle exec rake rubygems_test

# Verify generated parser files are current (CI check)
bundle exec rake verify_generated
</code></pre>

<p><strong>Test Framework:</strong> Test::Unit with <code>test-unit</code> gem
<strong>Test Location:</strong> <code>test/</code> directory
<strong>Test Helper:</strong> <code>test/lib/helper.rb</code></p>

<h3>Linting</h3>

<h4>RuboCop (Ruby Linting)</h4>

<pre class="code bash"><code class="bash"># Check Ruby code style
bundle exec rubocop

# Auto-fix style issues
bundle exec rubocop -A
</code></pre>

<p><strong>Configuration:</strong> <code>.rubocop.yml</code></p>

<ul>
<li>Target Ruby: 3.0</li>
<li>Minimal cop set (opt-in approach)</li>
<li>Excludes generated parser files</li>
</ul>

<h4>Herb Linter (ERB/RHTML Files)</h4>

<pre class="code bash"><code class="bash"># Lint ERB template files
npx @herb-tools/linter &quot;**/*.rhtml&quot;

# Lint specific directory
npx @herb-tools/linter &quot;lib/**/*.rhtml&quot;
</code></pre>

<p><strong>Template Location:</strong> <code>lib/rdoc/generator/template/**/*.rhtml</code>
<strong>CI Workflow:</strong> <code>.github/workflows/lint.yml</code></p>

<h4>Stylelint (CSS Files)</h4>

<pre class="code bash"><code class="bash"># Lint CSS files
npm run lint:css

# Auto-fix style issues
npm run lint:css -- --fix

# Lint specific file
npx stylelint &quot;lib/rdoc/generator/template/aliki/css/rdoc.css&quot;
</code></pre>

<p><strong>Configuration:</strong> <code>.stylelintrc.json</code>
<strong>Features:</strong></p>

<ul>
<li>Detects undefined CSS custom properties (variables)</li>
<li>Detects missing <code>var()</code> function for custom properties</li>
<li>Style and formatting checks</li>
<li>Many issues auto-fixable with <code>--fix</code></li>
</ul>

<h3>Type annotations</h3>

<p>Annotate method types using <a href="https://sorbet.org/docs/rbs-support">Sorbet flavored RBS</a> in inline comments.
For more information about RBS syntax, see the [documentation]).</p>

<p>A few examples:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Method that receives an integer and doesn&#39;t return anything
</span><span class='comment'>#: (Integer) -&gt; void
</span><span class='kw'>def</span> <span class='id identifier rubyid_foo'>foo</span>(<span class='id identifier rubyid_something'>something</span>)<span class='semicolon'>;</span> <span class='kw'>end</span>

<span class='comment'># Method that receives a string and returns an integer
</span><span class='comment'>#: (String) -&gt; Integer
</span><span class='kw'>def</span> <span class='id identifier rubyid_bar'>bar</span>(<span class='id identifier rubyid_something'>something</span>)
   <span class='int'>123</span>
<span class='kw'>end</span>

<span class='comment'># Method that doesn&#39;t accept arguments and returns a hash of symbol to string
</span><span class='comment'>#: () -&gt; Hash[Symbol, String]
</span><span class='kw'>def</span> <span class='id identifier rubyid_bar'>bar</span>
   { <span class='label'>key:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span> }
<span class='kw'>end</span>

<span class='comment'># Method that accepts a block, which yields a single integer argument and returns whatever the block returns
</span><span class='comment'>#: [T] () { (Integer) -&gt; T } -&gt; T
</span><span class='kw'>def</span> <span class='id identifier rubyid_bar'>bar</span>
   <span class='kw'>yield</span>(<span class='int'>5</span>)
<span class='kw'>end</span></code></pre>

<h3>Documentation Generation</h3>

<pre class="code bash"><code class="bash"># Generate documentation (creates _site directory)
bundle exec rake rdoc

# Force regenerate documentation
bundle exec rake rerdoc

# Show documentation coverage
bundle exec rake rdoc:coverage
bundle exec rake coverage
</code></pre>

<p><strong>Output Directory:</strong> <code>_site/</code> (GitHub Pages compatible)
<strong>Configuration:</strong> <code>.rdoc_options</code></p>

<h3>Parser Generation</h3>

<p>RDoc uses generated parsers for Markdown and RD formats:</p>

<pre class="code bash"><code class="bash"># Generate all parser files from sources
bundle exec rake generate

# Remove generated parser files
bundle exec rake clean
</code></pre>

<p><strong>Generated Files:</strong></p>

<ul>
<li><code>lib/rdoc/rd/block_parser.rb</code> (from <code>.ry</code> via racc)</li>
<li><code>lib/rdoc/rd/inline_parser.rb</code> (from <code>.ry</code> via racc)</li>
<li><code>lib/rdoc/markdown.rb</code> (from <code>.kpeg</code> via kpeg)</li>
<li><code>lib/rdoc/markdown/literals.rb</code> (from <code>.kpeg</code> via kpeg)</li>
</ul>

<p><strong>Note:</strong> These files are auto-generated and should not be edited manually. Always regenerate after modifying source <code>.ry</code> or <code>.kpeg</code> files.</p>

<h3>Building and Releasing</h3>

<pre class="code bash"><code class="bash"># Build gem package
bundle exec rake build

# Install gem locally
bundle exec rake install

# Create tag and push to rubygems.org
bundle exec rake release
</code></pre>

<h2>Project Structure</h2>

<pre class="code sh"><code class="sh">lib/rdoc/
├── rdoc.rb                    # Main entry point (RDoc::RDoc class)
├── version.rb                 # Version constant
├── task.rb                    # Rake task integration
├── parser/                    # Source code parsers (Ruby, C, Markdown, RD)
│   ├── ruby.rb                # Ruby code parser
│   ├── c.rb                   # C extension parser
│   ├── prism_ruby.rb          # Prism-based Ruby parser
│   └── ...
├── generator/                 # Documentation generators
│   ├── aliki.rb               # HTML generator (default theme)
│   ├── darkfish.rb            # HTML generator (deprecated, will be removed in v8.0)
│   ├── markup.rb              # Markup format generator
│   ├── ri.rb                  # RI command generator
│   └── template/              # ERB templates (.rhtml files)
│       ├── aliki/             # Aliki theme (default)
│       └── darkfish/          # Darkfish theme (deprecated)
├── markup/                    # Markup parsing and formatting
├── code_object/               # AST objects for documented items
├── markdown/                  # Markdown parsing
├── rd/                        # RD format parsing
└── ri/                        # RI (Ruby Info) tool

test/                          # 79 test files
├── lib/helper.rb              # Test helpers
└── rdoc/                      # Main test directory

exe/
├── rdoc                       # rdoc command executable
└── ri                         # ri command executable
</code></pre>

<h2>Important Files</h2>

<h3>Configuration</h3>

<ul>
<li><code>.rubocop.yml</code> - RuboCop configuration (main)</li>
<li><code>.generated_files_rubocop.yml</code> - RuboCop config for generated files</li>
<li><code>.rdoc_options</code> - RDoc generation options</li>
<li><code>.document</code> - File list for documentation</li>
<li><code>Rakefile</code> - Task definitions</li>
<li><code>lib/rdoc/task.rb</code> - Task definitions provided by RDoc</li>
<li><code>rdoc.gemspec</code> - Gem specification</li>
<li><code>Gemfile</code> - Development dependencies</li>
</ul>

<h3>CI/CD</h3>

<ul>
<li><code>.github/workflows/test.yml</code> - Test execution across Ruby versions/platforms</li>
<li><code>.github/workflows/lint.yml</code> - Linting (RuboCop + Herb)</li>
<li><code>.github/workflows/push_gem.yml</code> - Gem publishing</li>
</ul>

<h3>Documentation</h3>

<ul>
<li><code>README.md</code> - Basic usage guide and markup format reference</li>
<li><code>markup_reference/rdoc.rdoc</code> - Comprehensive RDoc markup syntax reference</li>
<li><code>markup_reference/markdown.md</code> - Markdown syntax reference</li>
<li><code>doc/rdoc/example.rb</code> - Ruby code examples for cross-references and directives</li>
</ul>

<h2>Architecture Notes</h2>

<h3>Pluggable System</h3>

<ul>
<li><strong>Parsers:</strong> Ruby, C, Markdown, RD, Prism-based Ruby (experimental)</li>
<li><strong>Generators:</strong> HTML/Aliki (default), HTML/Darkfish (deprecated), RI, POT (gettext), JSON, Markup</li>
</ul>

<h2>Common Workflows</h2>

<p>Do NOT commit anything. Ask the developer to review the changes after tasks are finished.</p>

<p>NEVER pushes code to any repositories.</p>

<h3>Making Code Changes</h3>

<p>Use Red, Green, Refactor approach:</p>

<ol>
<li><strong>Ensure Ruby version</strong>: Verify you&#39;re using Ruby 3.3.0+ (prepend <code>chruby &lt;ruby version&gt;</code> if needed)</li>
<li><strong>Red - Write failing tests</strong>: Add tests that fail for the new behavior</li>
<li><strong>Verify failure</strong>: Run <code>bundle exec rake</code> to confirm tests fail as expected</li>
<li><strong>Green - Make it work</strong>: Implement the minimum code to make tests pass</li>
<li><strong>Refactor - Make it right</strong>: Improve code quality while keeping tests green

<ul>
<li>Run <code>bundle exec rake</code> after each refactor to ensure tests still pass</li>
<li>Iterate on steps 4-5 as needed</li>
</ul></li>
<li><strong>Lint your changes</strong>:

<ul>
<li>Ruby code: <code>bundle exec rubocop -A</code> (auto-fix when possible)</li>
<li>ERB templates: <code>npx @herb-tools/linter &quot;**/*.rhtml&quot;</code> (if modified)</li>
<li>CSS files: <code>npm run lint:css -- --fix</code> (if modified)</li>
</ul></li>
</ol>

<h3>Modifying Parsers</h3>

<ol>
<li>Edit source files (<code>.ry</code> or <code>.kpeg</code>)</li>
<li>Regenerate: <code>bundle exec rake generate</code></li>
<li>Verify: <code>bundle exec rake verify_generated</code></li>
<li>Run tests: <code>bundle exec rake</code></li>
</ol>

<h3>Updating Documentation</h3>

<ol>
<li>Modify documentation comments in source</li>
<li>Regenerate: <code>bundle exec rake rerdoc</code></li>
<li>Check output in <code>_site/</code> directory</li>
<li>Check coverage: <code>bundle exec rake coverage</code></li>
</ol>

<h3>Modifying Markup Reference Documentation</h3>

<p>When editing markup reference documentation, such as <code>doc/markup_reference/markdown.md</code> and <code>doc/markup_reference/rdoc.rdoc</code>:</p>

<ol>
<li><strong>Always verify rendering</strong> - After making changes, test that the content renders correctly using Ruby:</li>
</ol>

<p>For Markdown files:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='op'>-</span><span class='id identifier rubyid_r'>r</span> <span class='id identifier rubyid_rdoc'>rdoc</span> <span class='op'>-</span><span class='id identifier rubyid_r'>r</span> <span class='id identifier rubyid_rdoc'>rdoc</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>markdown -e &#39;
md = RDoc::Markdown.new
doc = md.parse(&quot;YOUR CONTENT HERE&quot;)
formatter = RDoc::Markup::ToHtml.new(RDoc::Options.new)
puts formatter.convert(doc)
&#39;</span></code></pre>

<p>For RDoc files:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='op'>-</span><span class='id identifier rubyid_r'>r</span> <span class='id identifier rubyid_rdoc'>rdoc</span> <span class='op'>-</span><span class='id identifier rubyid_e'>e</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
parser = RDoc::Markup::Parser.new
doc = parser.parse(&quot;YOUR CONTENT HERE&quot;)
formatter = RDoc::Markup::ToHtml.new(RDoc::Options.new)
puts formatter.convert(doc)
</span><span class='tstring_end'>&#39;</span></span></code></pre>

<ol>
<li><p><strong>Watch for rendering issues:</strong></p>

<ul>
<li>Backtick escaping (especially nested code blocks)</li>
<li>Tilde characters being interpreted as strikethrough</li>
<li>Special characters in examples</li>
<li>Anchor links pointing to correct headings</li>
</ul></li>
<li><p><strong>Known RDoc Markdown limitations:</strong></p>

<ul>
<li>Only triple backticks for fenced code blocks (no tildes, no quad-backticks)</li>
<li>Tilde fences (<code>~~~</code>) conflict with strikethrough syntax</li>
<li>Use 4-space indentation to show literal code fence examples</li>
</ul></li>
<li><p><strong>Full verification</strong>: Generate documentation and inspect the HTML output:</p></li>
</ol>

<pre class="code bash"><code class="bash">   bundle exec rake rerdoc
   # Inspect the generated HTML file directly
   grep -A5 &quot;your content&quot; _site/path/to/file.html
</code></pre>

<h3>Modifying Themes/Styling</h3>

<p>When making changes to theme CSS or templates (e.g., Darkfish or Aliki themes):</p>

<ol>
<li><strong>Generate documentation</strong>: Run <code>bundle exec rake rerdoc</code> to create baseline</li>
<li><strong>Start HTTP server</strong>: Run <code>cd _site &amp;&amp; python3 -m http.server 8000</code> (use different port if 8000 is in use)</li>
<li><strong>Investigate with Playwright</strong>: Ask the AI assistant to take screenshots and inspect the documentation visually

<ul>
<li>Example: &quot;Navigate to the docs at localhost:8000 and screenshot the RDoc module page&quot;</li>
<li>See &quot;Playwright MCP for Testing Generated Documentation&quot; section below for details</li>
</ul></li>
<li><strong>Make changes</strong>: Edit files in <code>lib/rdoc/generator/template/&lt;theme&gt;/</code> as needed</li>
<li><strong>Regenerate</strong>: Run <code>bundle exec rake rerdoc</code> to rebuild documentation with changes</li>
<li><strong>Verify with Playwright</strong>: Take new screenshots and compare to original issues</li>
<li><strong>Lint changes</strong> (if modified):

<ul>
<li>ERB templates: <code>npx @herb-tools/linter &quot;lib/rdoc/generator/template/**/*.rhtml&quot;</code></li>
<li>CSS files: <code>npm run lint:css -- --fix</code></li>
</ul></li>
<li><strong>Stop server</strong>: Kill the HTTP server process when done</li>
</ol>

<p><strong>Tip:</strong> Keep HTTP server running during iteration. Just regenerate with <code>bundle exec rake rerdoc</code> between changes.</p>

<h2>Notes for AI Agents</h2>

<ol>
<li><strong>Always run tests</strong> after making changes: <code>bundle exec rake</code></li>
<li><strong>Lint your changes</strong>:

<ul>
<li>RuboCop for Ruby: <code>bundle exec rubocop -A</code></li>
<li>Herb for ERB templates: <code>npx @herb-tools/linter &quot;**/*.rhtml&quot;</code></li>
<li>Stylelint for CSS: <code>npm run lint:css -- --fix</code></li>
</ul></li>
<li><strong>Regenerate parsers</strong> if you modify <code>.ry</code> or <code>.kpeg</code> files</li>
<li><strong>Use <code>rake rerdoc</code></strong> to regenerate documentation (not just <code>rdoc</code>)</li>
<li><strong>Verify generated files</strong> with <code>rake verify_generated</code></li>
<li><strong>Don&#39;t edit generated files</strong> directly (in <code>lib/rdoc/markdown/</code> and <code>lib/rdoc/rd/</code>)</li>
</ol>

<h2>Playwright MCP for Testing Generated Documentation</h2>

<p>The Playwright MCP server enables visual inspection and interaction with generated HTML documentation. This is useful for verifying CSS styling, layout issues, and overall appearance.</p>

<p><strong>MCP Server:</strong> <code>@playwright/mcp</code> (Microsoft&#39;s official browser automation server)</p>

<h3>Setup</h3>

<p>The Playwright MCP server can be used with any MCP-compatible AI tool (Claude Code, Cursor, GitHub Copilot, OpenAI Agents, etc.).</p>

<p><strong>Claude Code:</strong></p>

<pre class="code bash"><code class="bash">/plugin playwright
</code></pre>

<p><strong>Other MCP-compatible tools:</strong></p>

<pre class="code bash"><code class="bash">npx @playwright/mcp@latest
</code></pre>

<p>Configure your tool to connect to this MCP server. Playwright launches its own browser instance automatically - no manual browser setup or extensions required.</p>

<h3>Troubleshooting: Chrome Remote Debugging Blocked</h3>

<p>If you encounter <code>DevTools remote debugging is disallowed by the system admin</code>, Chrome&#39;s debugging is blocked by the machine&#39;s policy. Use Firefox instead:</p>

<pre class="code bash"><code class="bash"># Install Firefox for Playwright
npx playwright install firefox

# Add Playwright MCP with Firefox to your project (creates/updates .mcp.json)
claude mcp add playwright --scope project -- npx -y @playwright/mcp@latest --browser firefox
</code></pre>

<p>Restart Claude Code after running these commands.</p>

<h3>Testing Generated Documentation</h3>

<p>To test the generated documentation:</p>

<pre class="code bash"><code class="bash"># Generate documentation
bundle exec rake rerdoc

# Start a simple HTTP server in the _site directory (use an available port)
cd _site &amp;&amp; python3 -m http.server 8000
</code></pre>

<p>If port 8000 is already in use, try another port (e.g., <code>python3 -m http.server 9000</code>).</p>

<p>Then ask the AI assistant to inspect the documentation. It will use the appropriate Playwright tools (<code>browser_navigate</code>, <code>browser_snapshot</code>, <code>browser_take_screenshot</code>, etc.) based on your request.</p>

<p><strong>Example requests:</strong></p>

<ul>
<li>&quot;Navigate to <code>http://localhost:8000</code> and take a screenshot&quot;</li>
<li>&quot;Take a screenshot of the RDoc module page&quot;</li>
<li>&quot;Check if code blocks are rendering properly on the Markup page&quot;</li>
<li>&quot;Compare the index page before and after my CSS changes&quot;</li>
</ul>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>