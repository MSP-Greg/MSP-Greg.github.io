<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Windows &mdash; Ruby-master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "windows",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Ruby-master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Windows&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="file_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Windows</h1>

<p>Ruby supports a few native build platforms for Windows.</p>

<ul>
<li>mswin: Build using Microsoft Visual C++ compiler with vcruntimeXXX.dll</li>
<li>mingw-msvcrt: Build using compiler for Mingw with msvcrtXX.dll</li>
<li>mingw-ucrt: Build using compiler for Mingw with Windows Universal CRT</li>
</ul>

<h2>Building Ruby using Mingw with UCRT</h2>

<p>The easiest build environment is just a standard <a href="https://rubyinstaller.org/">RubyInstaller-Devkit</a>
installation and <a href="https://gitforwindows.org/">git-for-windows</a>. You might like to use <a href="https://code.visualstudio.com/">VSCode</a> as an
editor.</p>

<h3>Build examples</h3>

<p>Ruby core development can be done either in Windows <code>cmd</code> like:</p>

<pre class="code batch"><code class="batch">ridk install
ridk enable ucrt64

pacman -S --needed %MINGW_PACKAGE_PREFIX%-openssl %MINGW_PACKAGE_PREFIX%-libyaml %MINGW_PACKAGE_PREFIX%-libffi

mkdir c:\work\ruby
cd /d c:\work\ruby

git clone https://github.com/ruby/ruby src

sh ./src/autogen.sh

mkdir build
cd build
sh ../src/configure -C --disable-install-doc
make
</code></pre>

<p>or in MSYS2 <code>bash</code> like:</p>

<pre class="code bash"><code class="bash">ridk install
ridk enable ucrt64
bash

pacman -S --needed $MINGW_PACKAGE_PREFIX-openssl $MINGW_PACKAGE_PREFIX-libyaml $MINGW_PACKAGE_PREFIX-libffi

mkdir /c/work/ruby
cd /c/work/ruby

git clone https://github.com/ruby/ruby src

./src/autogen.sh
cd build
../src/configure -C --disable-install-doc
make
</code></pre>

<p>If you have other MSYS2 environment via other package manager like <code>scoop</code>, you need to specify <code>$MINGW_PACKAGE_PREFIX</code> is <code>mingw-w64-ucrt-x86_64</code>.
And you need to add <code>--with-opt-dir</code> option to <code>configure</code> command like:</p>

<pre class="code batch"><code class="batch">sh ../../ruby/configure -C --disable-install-doc --with-opt-dir=C:\Users\username\scoop\apps\msys2\current\ucrt64
</code></pre>

<h2>Building Ruby using Visual C++</h2>

<h3>Requirement</h3>

<ol>
<li><p>Windows 10/Windows Server 2016 or later.</p></li>
<li><p>Visual C++ 14.0 (2015) or later.</p>

<p><strong>Note</strong> if you want to build x64 version, use native compiler for
x64.</p>

<p>The minimum requirement is here:</p>

<ul>
<li>VC++/MSVC on VS 2017/2019/2022 version build tools.</li>
<li>Windows 10/11 SDK</li>
</ul>

<p>You can install Visual Studio Build Tools with <code>winget</code>.
<code>win32\install-buildtools.cmd</code> is a batch file to install the
minimum requirements excluding the IDE etc.</p></li>
<li><p>Please set environment variable <code>INCLUDE</code>, <code>LIB</code>, <code>PATH</code> to run
required commands properly from the command line.  These are set
properly by <code>vsdevcmd.bat</code> or <code>vcvarall*.bat</code> usually. You can run
the following command to set them in your command line.</p>

<p>To native build:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cmd'>cmd</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>k win32\vssetup.cmd</span></code></pre>

<p>To cross build arm64 binary:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cmd'>cmd</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>k win32\vssetup.cmd -arch=arm64</span></code></pre>

<p>To cross build x64 binary:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cmd'>cmd</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>k win32\vssetup.cmd -arch=x64</span></code></pre>

<p>This batch file is a wrapper of <code>vsdevcmd.bat</code> and options are
passed to it as-is.  <code>win32\vssetup.cmd -help</code> for other command
line options.</p>

<p><strong>Note</strong> building ruby requires following commands.</p></li>
</ol>

<pre class="code ruby"><code class="ruby"><span class='op'>*</span> <span class='backtick'>`</span><span class='tstring_content'>nmake</span><span class='tstring_end'>`</span></span>
<span class='op'>*</span> <span class='backtick'>`</span><span class='tstring_content'>cl</span><span class='tstring_end'>`</span></span>
<span class='op'>*</span> <span class='backtick'>`</span><span class='tstring_content'>ml</span><span class='tstring_end'>`</span></span>
<span class='op'>*</span> <span class='backtick'>`</span><span class='tstring_content'>lib</span><span class='tstring_end'>`</span></span>
<span class='op'>*</span> <span class='backtick'>`</span><span class='tstring_content'>dumpbin</span><span class='tstring_end'>`</span></span></code></pre>

<ol>
<li><p>If you want to build from GIT source, following commands are required.</p>

<ul>
<li><code>git</code></li>
<li><code>ruby</code> 3.0 or later</li>
</ul>

<p>You can use <a href="https://scoop.sh/">scoop</a> to install them like:</p>

<pre class="code batch"><code class="batch">scoop install git ruby
</code></pre>

<p>The windows version of <code>git</code> configured with <code>autocrlf</code> is <code>true</code>. The Ruby
test suite may fail with <code>autocrlf</code> set to <code>true</code>. You can set it to <code>false</code>
like:</p>

<pre class="code batch"><code class="batch">git config --global core.autocrlf false
</code></pre></li>
<li><p>You need to install required libraries using <a href="https://vcpkg.io/">vcpkg</a> on
directory of ruby repository like:</p>

<pre class="code batch"><code class="batch">vcpkg --triplet x64-windows install
</code></pre></li>
<li><p>Enable Command Extension of your command line.  It&#39;s the default behavior
of <code>cmd.exe</code>.  If you want to enable it explicitly, run <code>cmd.exe</code> with
<code>/E:ON</code> option.</p></li>
</ol>

<h3>How to compile and install</h3>

<ol>
<li><p>Execute <code>win32\configure.bat</code> on your build directory.
You can specify the target platform as an argument.
For example, run <code>configure --target=i686-mswin32</code>.
You can also specify the install directory.
For example, run <code>configure --prefix=&lt;install_directory&gt;</code>.
Default of the install directory is <code>/usr</code> .</p></li>
<li><p>If you want to append to the executable and DLL file names,
specify <code>--program-prefix</code> and <code>--program-suffix</code>, like
<code>win32\configure.bat --program-suffix=-$(MAJOR)$(MINOR)</code>.</p>

<p>Also, the <code>--install-name</code> and <code>--so-name</code> options specify the
exact base names of the executable and DLL files, respectively,
like <code>win32\configure.bat --install-name=$(RUBY_BASE_NAME)-$(MAJOR)$(MINOR)</code>.</p>

<p>By default, the name for the executable without a console window
is generated from the <em>RUBY_INSTALL_NAME</em> specified as above by
replacing <code>ruby</code> with <code>rubyw</code>.  If you want to make it different
more, modify <em>RUBYW_INSTALL_NAME</em> directly in the Makefile.</p></li>
<li><p>You need specify vcpkg directory to use <code>--with-opt-dir</code>
option like <code>win32\configure.bat --with-opt-dir=C:/vcpkg_installed/x64-windows</code></p></li>
<li><p>Run <code>nmake up</code> if you are building from GIT source.</p></li>
<li><p>Run <code>nmake</code></p></li>
<li><p>Run <code>nmake prepare-vcpkg</code> with administrator privilege if you need to
copy vcpkg installed libraries like <code>libssl-3-x64.dll</code> to the build directory.</p></li>
<li><p>Run <code>nmake check</code></p></li>
<li><p>Run <code>nmake install</code></p></li>
</ol>

<h3>Build examples</h3>

<ul>
<li><p>Build on the ruby source directory.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_source'>source</span> <span class='label'>directory:</span>  <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_build'>build</span> <span class='label'>directory:</span>        <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_install'>install</span> <span class='label'>directory:</span>      <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_usr'>usr</span><span class='CHAR'>\</span><span class='id identifier rubyid_local'>local</span></code></pre>

<pre class="code batch"><code class="batch">C:
cd \ruby
win32\configure --prefix=/usr/local
nmake
nmake check
nmake install
</code></pre></li>
<li><p>Build on the relative directory from the ruby source directory.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_source'>source</span> <span class='label'>directory:</span>  <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_build'>build</span> <span class='label'>directory:</span>        <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span><span class='CHAR'>\</span><span class='id identifier rubyid_mswin32'>mswin32</span>
<span class='id identifier rubyid_install'>install</span> <span class='label'>directory:</span>      <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_usr'>usr</span><span class='CHAR'>\</span><span class='id identifier rubyid_local'>local</span></code></pre>

<pre class="code batch"><code class="batch">C:
cd \ruby
mkdir mswin32
cd mswin32
..\win32\configure --prefix=/usr/local
nmake
nmake check
nmake install
</code></pre></li>
<li><p>Build on the different drive.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_source'>source</span> <span class='label'>directory:</span>  <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_src'>src</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_build'>build</span> <span class='label'>directory:</span>        <span class='label'>D:</span><span class='CHAR'>\</span><span class='id identifier rubyid_build'>build</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_install'>install</span> <span class='label'>directory:</span>      <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_usr'>usr</span><span class='CHAR'>\</span><span class='id identifier rubyid_local'>local</span></code></pre>

<pre class="code batch"><code class="batch">D:
cd D:\build\ruby
C:\src\ruby\win32\configure --prefix=/usr/local
nmake
nmake check
nmake install DESTDIR=C:
</code></pre></li>
<li><p>Build x64 version (requires native x64 VC++ compiler)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_source'>source</span> <span class='label'>directory:</span>  <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_build'>build</span> <span class='label'>directory:</span>        <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_install'>install</span> <span class='label'>directory:</span>      <span class='label'>C:</span><span class='CHAR'>\</span><span class='id identifier rubyid_usr'>usr</span><span class='CHAR'>\</span><span class='id identifier rubyid_local'>local</span></code></pre>

<pre class="code batch"><code class="batch">C:
cd \ruby
win32\configure --prefix=/usr/local --target=x64-mswin64
nmake
nmake check
nmake install
</code></pre></li>
</ul>

<h3>Bugs</h3>

<p>You can <strong>NOT</strong> use a path name that contains any white space characters
as the ruby source directory, this restriction comes from the behavior
of <code>!INCLUDE</code> directives of <code>NMAKE</code>.</p>

<p>You can build ruby in any directory including the source directory,
except <code>win32</code> directory in the source directory.
This is restriction originating in the path search method of <code>NMAKE</code>.</p>

<h3>Dependency management</h3>

<p>Ruby uses <a href="https://vcpkg.io/">vcpkg</a> to manage dependencies on mswin platform.</p>

<p>You can update and install it under the build directory like:</p>

<pre class="code batch"><code class="batch">nmake update-vcpkg # Update baseline version of vcpkg
nmake install-vcpkg # Install vcpkg from build directory
</code></pre>

<h2>Icons</h2>

<p>Any icon files(<code>*.ico</code>) in the build directory, directories specified with
<em>icondirs</em> make variable and <code>win32</code> directory under the ruby
source directory will be included in DLL or executable files, according
to their base names.</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$</span>(<span class='const'>RUBY_INSTALL_NAME</span>).<span class='id identifier rubyid_ico'>ico</span> <span class='kw'>or</span> <span class='id identifier rubyid_ruby'>ruby</span>.<span class='id identifier rubyid_ico'>ico</span>   <span class='op'>-</span><span class='tlambda'>-&gt;</span> <span class='gvar'>$</span>(<span class='const'>RUBY_INSTALL_NAME</span>).<span class='id identifier rubyid_exe'>exe</span>
<span class='gvar'>$</span>(<span class='const'>RUBYW_INSTALL_NAME</span>).<span class='id identifier rubyid_ico'>ico</span> <span class='kw'>or</span> <span class='id identifier rubyid_rubyw'>rubyw</span>.<span class='id identifier rubyid_ico'>ico</span> <span class='op'>-</span><span class='tlambda'>-&gt;</span> <span class='gvar'>$</span>(<span class='const'>RUBYW_INSTALL_NAME</span>).<span class='id identifier rubyid_exe'>exe</span>
<span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_others'>others</span>                             <span class='op'>-</span><span class='tlambda'>-&gt;</span> <span class='gvar'>$</span>(<span class='const'>RUBY_SO_NAME</span>).<span class='id identifier rubyid_dll'>dll</span></code></pre>

<p>Although no icons are distributed with the ruby source, you can use
anything you like. You will be able to find many images by search engines.
For example, followings are made from <a href="https://cache.ruby-lang.org/pub/misc/logo/ruby-logo-kit.zip">Ruby logo kit</a>:</p>

<ul>
<li><p>Small <a href="https://www.ruby-lang.org/favicon.ico">favicon</a> in the official site</p></li>
<li><p><a href="http://ruby.morphball.net/vit-ruby-ico_en.html">vit-ruby.ico</a> or <a href="http://ruby.morphball.net/icon/vit-ruby.ico">icon itself</a></p></li>
</ul>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>