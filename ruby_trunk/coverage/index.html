<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Coverage &mdash; coverage  Ruby-master dev</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Coverage",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-master</a> &raquo; 
      <a href='.'>coverage</a> &raquo; 
      <a href='_index.html#alpha_C'>Index (C)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Coverage&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Coverage</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L697'>ext/coverage/coverage.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/lib/coverage.rb#L3'>ext/coverage/lib/coverage.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Coverage provides coverage measurement feature for Ruby.</p>

<p>Only process-global coverage measurement is supported, meaning that coverage cannot be measure on a per-thread basis.</p>

<h3 id="label-Quick+Start">Quick Start</h3>
<ol><li>
<p>Load coverage using <code>require &quot;coverage&quot;</code>.</p>
</li><li>
<p>Call <a href="#start-class_method" title="Coverage.start (method)">.start</a> to set up and begin coverage measurement.</p>
</li><li>
<p>All Ruby code loaded following the call to <a href="#start-class_method" title="Coverage.start (method)">.start</a> will have coverage measurement.</p>
</li><li>
<p><code>Coverage</code> results can be fetched by calling <a href="#result-class_method" title="Coverage.result (method)">.result</a>, which returns a hash that contains filenames as the keys and coverage arrays as the values. Each element of the coverage array gives the number of times each line was executed. A <code>nil</code> value means coverage was disabled for that line (e.g. lines like <code>else</code> and <code>end</code>).</p>
</li></ol>

<h3 id="label-Examples">Examples</h3>

<p>In file <code>fib.rb</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_fibonacci'>fibonacci</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='int'>0</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fibonacci'>fibonacci</span>(<span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span>) <span class='op'>+</span> <span class='id identifier rubyid_fibonacci'>fibonacci</span>(<span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>2</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_fibonacci'>fibonacci</span>(<span class='int'>10</span>)</code></pre>

<p>In another file, coverage can be measured:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fib.rb</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span> <span class='comment'># =&gt; {&quot;fib.rb&quot; =&gt; [1, 177, 34, 143, 55, nil, 88, nil, nil, nil, 1]}</span></code></pre>

<h4 id="label-Lines+Coverage">Lines Coverage</h4>

<p>Lines coverage reports the number of line executions for each line. If the coverage mode is not explicitly specified when starting coverage, lines coverage is used as the default.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>lines:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fib</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span> <span class='comment'># =&gt; {&quot;fib.rb&quot; =&gt; {lines: [1, 177, 34, 143, 55, nil, 88, nil, nil, nil, 1]}}</span></code></pre>

<p>The returned hash differs depending on how <a href="#setup-class_method" title="Coverage.setup (method)">.setup</a> or <a href="#start-class_method" title="Coverage.start (method)">.start</a> was executed.</p>

<p>If <a href="#start-class_method" title="Coverage.start (method)">.start</a> or <a href="#setup-class_method" title="Coverage.setup (method)">.setup</a> was called with no arguments, it returns a hash which contains filenames as the keys and coverage arrays as the values.</p>

<p>If <a href="#start-class_method" title="Coverage.start (method)">.start</a> or <a href="#setup-class_method" title="Coverage.setup (method)">.setup</a> was called with <code>line: true</code>, it returns a hash which contains filenames as the keys and hashes as the values. The value hash has a key <code>:lines</code> where the value is a coverage array.</p>

<p>Each element of the coverage array gives the number of times the line was executed. A <code>nil</code> value in the coverage array means coverage was disabled for that line (e.g. lines like <code>else</code> and <code>end</code>).</p>

<h4 id="label-Oneshot+Lines+Coverage">Oneshot Lines Coverage</h4>

<p>Oneshot lines coverage is similar to lines coverage, but instead of reporting the number of times a line was executed, it only reports the lines that were executed.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>oneshot_lines:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fib</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span> <span class='comment'># =&gt; {&quot;fib.rb&quot; =&gt; {oneshot_lines: [1, 11, 2, 4, 7, 5, 3]}}</span></code></pre>

<p>The value of the oneshot lines coverage result is an array containing the line numbers that were executed.</p>

<h4 id="label-Branches+Coverage">Branches Coverage</h4>

<p>Branches coverage reports the number of times each branch within each conditional was executed.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>branches:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fib</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span>
<span class='comment'># =&gt; {&quot;fib.rb&quot; =&gt; {
</span><span class='comment'>#      branches: {
</span><span class='comment'>#        [:if, 0, 2, 2, 8, 5] =&gt; {
</span><span class='comment'>#          [:then, 1, 3, 4, 3, 5] =&gt; 34,
</span><span class='comment'>#          [:else, 2, 4, 2, 8, 5] =&gt; 143},
</span><span class='comment'>#        [:if, 3, 4, 2, 8, 5] =&gt; {
</span><span class='comment'>#          [:then, 4, 5, 4, 5, 5] =&gt; 55,
</span><span class='comment'>#          [:else, 5, 7, 4, 7, 39] =&gt; 88}}}}</span></code></pre>

<p>Each entry within the branches hash is a conditional, the value of which is another hash where each entry is a branch in that conditional. The keys are arrays containing information about the branch and the values are the number of times the branch was executed.</p>

<p>The information that makes up the array that are the keys for conditional or branches are the following, from left to right:</p>
<ol><li>
<p>A label for the type of branch or conditional (e.g. <code>:if</code>, <code>:then</code>, <code>:else</code>).</p>
</li><li>
<p>A unique identifier.</p>
</li><li>
<p>Starting line number.</p>
</li><li>
<p>Starting column number.</p>
</li><li>
<p>Ending line number.</p>
</li><li>
<p>Ending column number.</p>
</li></ol>

<h4 id="label-Methods+Coverage">Methods Coverage</h4>

<p>Methods coverage reports how many times each method was executed.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>methods:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fib</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span> <span class='comment'>#=&gt; {&quot;fib.rb&quot; =&gt; {methods: {[Object, :fibonacci, 1, 0, 9, 3] =&gt; 177}}}</span></code></pre>

<p>Each entry within the methods hash represents a method. The keys are arrays containing hash are the number of times the method was executed, and the keys are identifying information about the method.</p>

<p>The information that makes up each key identifying a method is the following, from left to right:</p>
<ol><li>
<p>Class that the method was defined in.</p>
</li><li>
<p>Method name as a Symbol.</p>
</li><li>
<p>Starting line number of the method.</p>
</li><li>
<p>Starting column number of the method.</p>
</li><li>
<p>Ending line number of the method.</p>
</li><li>
<p>Ending column number of the method.</p>
</li></ol>

<h4 id="label-Eval+Coverage">Eval Coverage</h4>

<p>Eval coverage can be combined with the coverage types above to track coverage for eval.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>eval:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>lines:</span> <span class='kw'>true</span>)

<span class='id identifier rubyid_eval'>eval</span>(<span class='heredoc_beg'>&lt;&lt;~RUBY</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>eval 1</span><span class='tstring_end'>&quot;</span></span>)
<span class='ignored_sp'>  </span><span class='tstring_content'>ary = []
</span><span class='ignored_sp'>  </span><span class='tstring_content'>10.times do |i|
</span><span class='ignored_sp'>  </span><span class='tstring_content'>  ary &lt;&lt; &quot;hello&quot; * i
</span><span class='ignored_sp'>  </span><span class='tstring_content'>end
</span><span class='heredoc_end'>RUBY
</span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span> <span class='comment'># =&gt; {&quot;eval 1&quot; =&gt; {lines: [1, 1, 10, nil]}}</span></code></pre>

<p>Note that the eval must have a filename assigned, otherwise coverage will not be measured.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>eval:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>lines:</span> <span class='kw'>true</span>)

<span class='id identifier rubyid_eval'>eval</span>(<span class='heredoc_beg'>&lt;&lt;~RUBY</span>)
<span class='ignored_sp'>  </span><span class='tstring_content'>ary = []
</span><span class='ignored_sp'>  </span><span class='tstring_content'>10.times do |i|
</span><span class='ignored_sp'>  </span><span class='tstring_content'>  ary &lt;&lt; &quot;hello&quot; * i
</span><span class='ignored_sp'>  </span><span class='tstring_content'>end
</span><span class='heredoc_end'>RUBY
</span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span> <span class='comment'># =&gt; {&quot;(eval)&quot; =&gt; {lines: [nil, nil, nil, nil]}}</span></code></pre>

<p>Also note that if a line number is assigned to the eval and it is not 1, then the resulting coverage will be padded with <code>nil</code> if the line number is greater than 1, and truncated if the line number is less than 1.</p>

<pre class="code ruby"><code class="ruby"> <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
 <span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='label'>eval:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>lines:</span> <span class='kw'>true</span>)

 <span class='id identifier rubyid_eval'>eval</span>(<span class='heredoc_beg'>&lt;&lt;~RUBY</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>eval 1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>3</span>)
<span class='ignored_sp'>   </span><span class='tstring_content'>ary = []
</span><span class='ignored_sp'>   </span><span class='tstring_content'>10.times do |i|
</span><span class='ignored_sp'>   </span><span class='tstring_content'>  ary &lt;&lt; &quot;hello&quot; * i
</span><span class='ignored_sp'>   </span><span class='tstring_content'>end
</span><span class='heredoc_end'> RUBY
</span>
<span class='id identifier rubyid_eval'>eval</span>(<span class='heredoc_beg'>&lt;&lt;~RUBY</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>eval 2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span>)
<span class='ignored_sp'>   </span><span class='tstring_content'>ary = []
</span><span class='ignored_sp'>   </span><span class='tstring_content'>10.times do |i|
</span><span class='ignored_sp'>   </span><span class='tstring_content'>  ary &lt;&lt; &quot;hello&quot; * i
</span><span class='ignored_sp'>   </span><span class='tstring_content'>end
</span><span class='heredoc_end'> RUBY
</span>
 <span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span>
 <span class='comment'># =&gt; {&quot;eval 1&quot; =&gt; {lines: [nil, nil, 1, 1, 10, nil]}, &quot;eval 2&quot; =&gt; {lines: [10, nil]}}</span></code></pre>

<h4 id="label-All+Coverage+Modes">All Coverage Modes</h4>

<p>All modes of coverage can be enabled simultaneously using the Symbol <code>:all</code>. However, note that this mode runs lines coverage and not oneshot lines since they cannot be ran simultaneously.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_start'><a href="#start-class_method" title="Coverage.start (method)">start</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>)
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fib</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Coverage</span>.<span class='id identifier rubyid_result'><a href="#result-class_method" title="Coverage.result (method)">result</a></span>
<span class='comment'># =&gt; {&quot;fib.rb&quot; =&gt; {
</span><span class='comment'>#      lines: [1, 177, 34, 143, 55, nil, 88, nil, nil, nil, 1],
</span><span class='comment'>#      branches: {
</span><span class='comment'>#        [:if, 0, 2, 2, 8, 5] =&gt; {
</span><span class='comment'>#          [:then, 1, 3, 4, 3, 5] =&gt; 34,
</span><span class='comment'>#          [:else, 2, 4, 2, 8, 5] =&gt; 143},
</span><span class='comment'>#        [:if, 3, 4, 2, 8, 5] =&gt; {
</span><span class='comment'>#          [:then, 4, 5, 4, 5, 5] =&gt; 55,
</span><span class='comment'>#          [:else, 5, 7, 4, 7, 39] =&gt; 88}}}},
</span><span class='comment'>#      methods: {[Object, :fibonacci, 1, 0, 9, 3] =&gt; 177}}}</span></code></pre>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#running%3F-class_method" title="running? (class method)">.<strong>running?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if coverage stats are currently being collected (after <a href="#start-class_method" title="Coverage.start (method)">.start</a> call, but before <a href="#result-class_method" title="Coverage.result (method)">.result</a> call).</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#line_stub-class_method" title="line_stub (class method)">.<strong>line_stub</strong>(file)  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>A simple helper function that creates the “stub” of line coverage from a given source code.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#supported%3F-class_method" title="supported? (class method)">.<strong>supported?</strong>(mode)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if coverage measurement is supported for the given mode.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#peek_result-class_method" title="peek_result (class method)">.<strong>peek_result</strong>  &#x21d2; Hash </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a hash that contains filename as key and coverage array as value.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#result-class_method" title="result (class method)">.<strong>result</strong>(stop: true, clear: true)  &#x21d2; Hash </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a hash that contains filename as key and coverage array as value.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#resume-class_method" title="resume (class method)">.<strong>resume</strong>  &#x21d2; nil </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Start/resume the coverage measurement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#setup-class_method" title="setup (class method)">.<strong>setup</strong>  &#x21d2; nil </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Performs setup for coverage measurement, but does not start coverage measurement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#start-class_method" title="start (class method)">.<strong>start</strong>  &#x21d2; nil </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Enables the coverage measurement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#state-class_method" title="state (class method)">.<strong>state</strong>  &#x21d2; :idle, ... </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the state of the coverage measurement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#suspend-class_method" title="suspend (class method)">.<strong>suspend</strong>  &#x21d2; nil </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Suspend the coverage measurement.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="running?-class_method">
  <h3 class='signature ro  private first'>
    .<strong>running?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if coverage stats are currently being collected (after <a href="#start-class_method" title="Coverage.start (method)">.start</a> call, but before <a href="#result-class_method" title="Coverage.result (method)">.result</a> call)</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L476-L480'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='476' data-end='480'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 476</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_running(VALUE klass)
{
    return current_state == RUNNING ? Qtrue : Qfalse;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="line_stub-class_method">
  <h3 class='signature  first'>
    .<strong>line_stub</strong>(file)  &#x21d2; <code>Array</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A simple helper function that creates the “stub” of line coverage from a given source code.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/lib/coverage.rb#L9-L18'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='9' data-end='18'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/lib/coverage.rb', line 9</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_line_stub'>line_stub</span>(<span class='id identifier rubyid_file'>file</span>)
  <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_foreach'>foreach</span>(<span class='id identifier rubyid_file'>file</span>).<span class='id identifier rubyid_map'>map</span> { <span class='kw'>nil</span> }
  <span class='id identifier rubyid_iseqs'>iseqs</span> <span class='op'>=</span> [<span class='const'>RubyVM</span><span class='op'>::</span><span class='const'>InstructionSequence</span>.<span class='id identifier rubyid_compile_file'>compile_file</span>(<span class='id identifier rubyid_file'>file</span>)]
  <span class='kw'>until</span> <span class='id identifier rubyid_iseqs'>iseqs</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='id identifier rubyid_iseqs'>iseqs</span>.<span class='id identifier rubyid_pop'>pop</span>
    <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_trace_points'>trace_points</span>.<span class='id identifier rubyid_each'>each</span> {<span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='op'>|</span> <span class='id identifier rubyid_lines'>lines</span>[<span class='id identifier rubyid_n'>n</span> <span class='op'>-</span> <span class='int'>1</span>] <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_line'>line</span> }
    <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_each_child'>each_child</span> {<span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span> <span class='id identifier rubyid_iseqs'>iseqs</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_child'>child</span> }
  <span class='kw'>end</span>
  <span class='id identifier rubyid_lines'>lines</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="peek_result-class_method">
  <h3 class='signature private'>
    .<strong>peek_result</strong>  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a hash that contains filename as key and coverage array as value. This is the same as <code>Coverage.result(stop: false, clear: false)</code>.</p>

<pre class="code ruby"><code class="ruby">{
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file.rb</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> [<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='kw'>nil</span>]<span class='comma'>,</span>
  <span class='comment'>#...
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L359-L376'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='359' data-end='376'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 359</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_peek_result(VALUE klass)
{
    VALUE coverages = rb_get_coverages();
    VALUE ncoverages = rb_hash_new();
    if (!RTEST(coverages)) {
        rb_raise(rb_eRuntimeError, &quot;coverage measurement is not enabled&quot;);
    }

    rb_hash_foreach(coverages, coverage_peek_result_i, ncoverages);

    if (current_mode &amp; COVERAGE_TARGET_METHODS) {
        rb_objspace_each_objects(method_coverage_i, &amp;ncoverages);
    }

    rb_hash_freeze(ncoverages);
    return ncoverages;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="result-class_method">
  <h3 class='signature private'>
    .<strong>result</strong>(stop: true, clear: true)  &#x21d2; <code>Hash</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a hash that contains filename as key and coverage array as value. If <code>clear</code> is true, it clears the counters to zero. If <code>stop</code> is true, it disables coverage measurement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L412-L449'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='412' data-end='449'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 412</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_result(int argc, VALUE *argv, VALUE klass)
{
    VALUE ncoverages;
    VALUE opt;
    int stop = 1, clear = 1;

    if (current_state == IDLE) {
        rb_raise(rb_eRuntimeError, &quot;coverage measurement is not enabled&quot;);
    }

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;opt);

    if (argc == 1) {
        opt = rb_convert_type(opt, T_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);
        stop = RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;stop&quot;))));
        clear = RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;clear&quot;))));
    }

    ncoverages = rb_coverage_peek_result(klass);
    if (stop &amp;&amp; !clear) {
        rb_warn(&quot;stop implies clear&quot;);
        clear = 1;
    }
    if (clear) {
        rb_clear_coverages();
        if (!NIL_P(me2counter)) rb_hash_foreach(me2counter, clear_me2counter_i, Qnil);
    }
    if (stop) {
        if (current_state == RUNNING) {
            rb_coverage_suspend(klass);
        }
        rb_reset_coverages();
        me2counter = Qnil;
        current_state = IDLE;
    }
    return ncoverages;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="resume-class_method">
  <h3 class='signature private'>
    .<strong>resume</strong>  &#x21d2; <code>nil</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Start/resume the coverage measurement.</p>

<p>Caveat: Currently, only process-global coverage measurement is supported. You cannot measure per-thread coverage. If your process has multiple thread, using <code>Coverage.resume/suspend</code> to capture code coverage executed from only a limited code block, may yield misleading results.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L151-L163'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='151' data-end='163'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 151</span></pre>
<pre class='code cpp'>

VALUE
rb_coverage_resume(VALUE klass)
{
    if (current_state == IDLE) {
        rb_raise(rb_eRuntimeError, &quot;coverage measurement is not set up yet&quot;);
    }
    if (current_state == RUNNING) {
        rb_raise(rb_eRuntimeError, &quot;coverage measurement is already running&quot;);
    }
    rb_resume_coverages();
    current_state = RUNNING;
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setup-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>setup</strong>  &#x21d2; <code>nil</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>setup</strong>(type)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>.<strong>setup</strong>(lines: false, branches: false, methods: false, eval: false, oneshot_lines: false)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Performs setup for coverage measurement, but does not start coverage measurement. To start coverage measurement, use <a href="#resume-class_method" title="Coverage.resume (method)">.resume</a>.</p>

<p>To perform both setup and start coverage measurement, <a href="#start-class_method" title="Coverage.start (method)">.start</a> can be used.</p>

<p>With argument <code>type</code> given and <code>type</code> is symbol <code>:all</code>, enables all types of coverage (lines, branches, methods, and eval).</p>

<p>Keyword arguments or hash <code>type</code> can be given with each of the following keys:</p>
<ul><li>
<p><code>lines</code>: Enables line coverage that records the number of times each line was executed. If <code>lines</code> is enabled, <code>oneshot_lines</code> cannot be enabled. See <a href="Coverage.html#label-Lines+Coverage" title="Lines Coverage">Lines Coverage</a>.</p>
</li><li>
<p><code>branches</code>: Enables branch coverage that records the number of times each branch in each conditional was executed. See <a href="Coverage.html#label-Branches+Coverage" title="Branches Coverage">Branches Coverage</a>.</p>
</li><li>
<p><code>methods</code>: Enables method coverage that records the number of times each method was exectued. See <a href="Coverage.html#label-Methods+Coverage" title="Methods Coverage">Methods Coverage</a>.</p>
</li><li>
<p><code>eval</code>: Enables coverage for evaluations (e.g. <code>Kernel.eval</code>, <code>Module#class_eval</code>). See <a href="Coverage.html#label-Eval+Coverage" title="Eval Coverage">Eval Coverage</a>.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L79-L138'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='79' data-end='138'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 79</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_setup(int argc, VALUE *argv, VALUE klass)
{
    VALUE coverages, opt;
    int mode;

    if (current_state != IDLE) {
        rb_raise(rb_eRuntimeError, &quot;coverage measurement is already setup&quot;);
    }

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;opt);

    if (argc == 0) {
        mode = 0; /* compatible mode */
    }
    else if (opt == ID2SYM(rb_intern(&quot;all&quot;))) {
        mode = COVERAGE_TARGET_LINES | COVERAGE_TARGET_BRANCHES | COVERAGE_TARGET_METHODS | COVERAGE_TARGET_EVAL;
    }
    else {
        mode = 0;
        opt = rb_convert_type(opt, T_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);

        if (RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;lines&quot;)))))
            mode |= COVERAGE_TARGET_LINES;
        if (RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;branches&quot;)))))
            mode |= COVERAGE_TARGET_BRANCHES;
        if (RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;methods&quot;)))))
            mode |= COVERAGE_TARGET_METHODS;
        if (RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;oneshot_lines&quot;))))) {
            if (mode &amp; COVERAGE_TARGET_LINES)
                rb_raise(rb_eRuntimeError, &quot;cannot enable lines and oneshot_lines simultaneously&quot;);
            mode |= COVERAGE_TARGET_LINES;
            mode |= COVERAGE_TARGET_ONESHOT_LINES;
        }
        if (RTEST(rb_hash_lookup(opt, ID2SYM(rb_intern(&quot;eval&quot;)))))
            mode |= COVERAGE_TARGET_EVAL;
    }

    if (mode &amp; COVERAGE_TARGET_METHODS) {
        me2counter = rb_ident_hash_new();
    }
    else {
        me2counter = Qnil;
    }

    coverages = rb_get_coverages();
    if (!RTEST(coverages)) {
        coverages = rb_hash_new();
        rb_obj_hide(coverages);
        current_mode = mode;
        if (mode == 0) mode = COVERAGE_TARGET_LINES;
        rb_set_coverages(coverages, mode, me2counter);
        current_state = SUSPENDED;
    }
    else if (current_mode != mode) {
        rb_raise(rb_eRuntimeError, &quot;cannot change the measuring target during coverage measurement&quot;);
    }

    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>start</strong>  &#x21d2; <code>nil</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>start</strong>(:all)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>.<strong>start</strong>(lines: bool, branches: bool, methods: bool, eval: bool)  &#x21d2; <code>nil</code> </span>
      <span class='overload'>.<strong>start</strong>(oneshot_lines: true)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Enables the coverage measurement. See the documentation of <code>Coverage</code> class in detail. This is equivalent to <a href="#setup-class_method" title="Coverage.setup (method)">.setup</a> and <a href="#resume-class_method" title="Coverage.resume (method)">.resume</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L176-L182'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='176' data-end='182'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 176</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_start(int argc, VALUE *argv, VALUE klass)
{
    rb_coverage_setup(argc, argv, klass);
    rb_coverage_resume(klass);
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="state-class_method">
  <h3 class='signature private'>
    .<strong>state</strong>  &#x21d2; <code>:idle</code>, ...  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the state of the coverage measurement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L458-L467'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='458' data-end='467'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 458</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_state(VALUE klass)
{
    switch (current_state) {
        case IDLE: return ID2SYM(rb_intern(&quot;idle&quot;));
        case SUSPENDED: return ID2SYM(rb_intern(&quot;suspended&quot;));
        case RUNNING: return ID2SYM(rb_intern(&quot;running&quot;));
    }
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="supported?-class_method">
  <h3 class='signature '>
    .<strong>supported?</strong>(mode)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if coverage measurement is supported for the given mode.</p>

<p>The mode should be one of the following symbols: <code>:lines</code>, <code>:oneshot_lines</code>, <code>:branches</code>, <code>:methods</code>, <code>:eval</code>.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Coverage</span>.<span class='id identifier rubyid_supported?'>supported?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>)  <span class='comment'>#=&gt; true
</span><span class='const'>Coverage</span>.<span class='id identifier rubyid_supported?'>supported?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>)    <span class='comment'>#=&gt; false</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L39-L51'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='39' data-end='51'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 39</span></pre>
<pre class='code cpp'>

static VALUE
rb_coverage_supported(VALUE self, VALUE _mode)
{
    ID mode = RB_SYM2ID(_mode);

    return RBOOL(
        mode == rb_intern(&quot;lines&quot;) ||
        mode == rb_intern(&quot;oneshot_lines&quot;) ||
        mode == rb_intern(&quot;branches&quot;) ||
        mode == rb_intern(&quot;methods&quot;) ||
        mode == rb_intern(&quot;eval&quot;)
    );
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="suspend-class_method">
  <h3 class='signature private'>
    .<strong>suspend</strong>  &#x21d2; <code>nil</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Suspend the coverage measurement. You can use <a href="#resume-class_method" title="Coverage.resume (method)">.resume</a> to restart the measurement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/ext/coverage/coverage.c#L393-L402'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='393' data-end='402'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/coverage/coverage.c', line 393</span></pre>
<pre class='code cpp'>

VALUE
rb_coverage_suspend(VALUE klass)
{
    if (current_state != RUNNING) {
        rb_raise(rb_eRuntimeError, &quot;coverage measurement is not running&quot;);
    }
    rb_suspend_coverages();
    current_state = SUSPENDED;
    return Qnil;
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>