<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Random::Formatter &mdash; random  Ruby-master dev</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Random::Formatter",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-master</a> &raquo; 
      <a href='../'>random</a> &raquo; 
      <a href='../_index.html#alpha_F'>Index (F)</a> &raquo; 
        Random &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Formatter&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Random::Formatter</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L55'>lib/random/formatter.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Random+number+formatter.">Random number formatter.</h3>

<p>Formats generated random numbers in many manners. When <code>&#39;random/formatter&#39;</code> is required, several methods are added to empty core module <code>Formatter</code>, making them available as Random’s instance and module methods.</p>

<p>Standard library SecureRandom is also extended with the module, and the methods described below are available as a module methods in it.</p>

<h4 id="label-Examples">Examples</h4>

<p>Generate random hexadecimal strings:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_hex'><a href="#hex-instance_method" title="Random::Formatter#hex (method)">hex</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;52750b30ffbc7de3b362&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_hex'><a href="#hex-instance_method" title="Random::Formatter#hex (method)">hex</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;92b15d6c8dc4beb5f559&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_hex'><a href="#hex-instance_method" title="Random::Formatter#hex (method)">hex</a></span>(<span class='int'>13</span>) <span class='comment'>#=&gt; &quot;39b290146bea6ce975c37cfc23&quot;
</span><span class='comment'># or just
</span><span class='const'>Random</span>.<span class='id identifier rubyid_hex'><a href="#hex-instance_method" title="Random::Formatter#hex (method)">hex</a></span> <span class='comment'>#=&gt; &quot;1aed0c631e41be7f77365415541052ee&quot;</span></code></pre>

<p>Generate random base64 strings:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_base64'><a href="#base64-instance_method" title="Random::Formatter#base64 (method)">base64</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;EcmTPZwWRAozdA==&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_base64'><a href="#base64-instance_method" title="Random::Formatter#base64 (method)">base64</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;KO1nIU+p9DKxGg==&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_base64'><a href="#base64-instance_method" title="Random::Formatter#base64 (method)">base64</a></span>(<span class='int'>12</span>) <span class='comment'>#=&gt; &quot;7kJSM/MzBJI+75j8&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_base64'><a href="#base64-instance_method" title="Random::Formatter#base64 (method)">base64</a></span>(<span class='int'>4</span>) <span class='comment'>#=&gt; &quot;bsQ3fQ==&quot;</span></code></pre>

<p>Generate random binary strings:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;\016\t{\370g\310pbr\301&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;\323U\030TO\234\357\020\a\337&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>6</span>) <span class='comment'>#=&gt; &quot;\xA1\xE6Lr\xC43&quot;</span></code></pre>

<p>Generate alphanumeric strings:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_alphanumeric'><a href="#alphanumeric-instance_method" title="Random::Formatter#alphanumeric (method)">alphanumeric</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;S8baxMJnPl&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_alphanumeric'><a href="#alphanumeric-instance_method" title="Random::Formatter#alphanumeric (method)">alphanumeric</a></span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;aOxAg8BAJe&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_alphanumeric'><a href="#alphanumeric-instance_method" title="Random::Formatter#alphanumeric (method)">alphanumeric</a></span> <span class='comment'>#=&gt; &quot;TmP9OsJHJLtaZYhP&quot;</span></code></pre>

<p>Generate UUIDs:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_uuid'><a href="#uuid-instance_method" title="Random::Formatter#uuid (method)">uuid</a></span> <span class='comment'>#=&gt; &quot;2d931510-d99f-494a-8c67-87feb05e1594&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_uuid'><a href="#uuid-instance_method" title="Random::Formatter#uuid (method)">uuid</a></span> <span class='comment'>#=&gt; &quot;bad85eb9-0713-4da7-8d36-07a8e4b00eab&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_uuid'><a href="#uuid-instance_method" title="Random::Formatter#uuid (method)">uuid</a></span> <span class='comment'>#=&gt; &quot;f14e0271-de96-45cc-8911-8910292a42cd&quot;</span></code></pre>

<p>All methods are available in the standard library SecureRandom, too:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>SecureRandom</span>.<span class='id identifier rubyid_hex'><a href="#hex-instance_method" title="Random::Formatter#hex (method)">hex</a></span> <span class='comment'>#=&gt; &quot;05b45376a30c67238eb93b16499e50cf&quot;</span></code></pre>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='ALPHANUMERIC-constant' class='summary_signature'>ALPHANUMERIC =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default character list for <a href="#alphanumeric-instance_method" title="Random::Formatter#alphanumeric (method)">#alphanumeric</a>.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L344-L344'># File 'lib/random/formatter.rb', line 344</a>    <pre class='code ruby'>[<span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>A</span><span class='tstring_end'>&#39;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Z</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a</span><span class='tstring_end'>&#39;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>z</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>9</span><span class='tstring_end'>&#39;</span></span>]</pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#alphanumeric-instance_method" title="#alphanumeric (instance method)">#<strong>alphanumeric</strong>(n = nil, chars: ALPHANUMERIC)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random alphanumeric string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#base64-instance_method" title="#base64 (instance method)">#<strong>base64</strong>(n = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random base64 string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#hex-instance_method" title="#hex (instance method)">#<strong>hex</strong>(n = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random hexadecimal string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#random_bytes-instance_method" title="#random_bytes (instance method)">#<strong>random_bytes</strong>(n = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random binary string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#urlsafe_base64-instance_method" title="#urlsafe_base64 (instance method)">#<strong>urlsafe_base64</strong>(n = nil, padding = false)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random URL-safe base64 string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uuid-instance_method" title="#uuid (instance method)">#<strong>uuid</strong>  </a>
      (also: #uuid_v4)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random v4 UUID (Universally Unique IDentifier).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uuid_v4-instance_method" title="#uuid_v4 (instance method)">#<strong>uuid_v4</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#uuid-instance_method" title="Random::Formatter#uuid (method)">#uuid</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#uuid_v7-instance_method" title="#uuid_v7 (instance method)">#<strong>uuid_v7</strong>(extra_timestamp_bits: 0)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a random v7 UUID (Universally Unique IDentifier).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#choose-instance_method" title="#choose (instance method)">#<strong>choose</strong>(source, n)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate a string that randomly draws from a source array of characters.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#gen_random-instance_method" title="#gen_random (instance method)">#<strong>gen_random</strong>(n)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Internal interface to Random; Generate random data <em>n</em> bytes.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="alphanumeric-instance_method">
  <h3 class='signature  first'>
    #<strong>alphanumeric</strong>(n = nil, chars: ALPHANUMERIC)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random alphanumeric string.</p>

<p>The argument <em>n</em> specifies the length, in characters, of the alphanumeric string to be generated. The argument <em>chars</em> specifies the character list which the result is consist of.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The result may contain A-Z, a-z and 0-9, unless <em>chars</em> is specified.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_alphanumeric'>alphanumeric</span>     <span class='comment'>#=&gt; &quot;2BuBuLf3WfSKyQbR&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_alphanumeric'>alphanumeric</span>(<span class='int'>10</span>) <span class='comment'>#=&gt; &quot;i6K93NdqiH&quot;
</span>
<span class='const'>Random</span>.<span class='id identifier rubyid_alphanumeric'>alphanumeric</span>(<span class='int'>4</span><span class='comma'>,</span> <span class='label'>chars:</span> [<span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>9</span><span class='tstring_end'>&quot;</span></span>]) <span class='comment'>#=&gt; &quot;2952&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_alphanumeric'>alphanumeric</span>(<span class='int'>10</span><span class='comma'>,</span> <span class='label'>chars:</span> [<span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>]) <span class='comment'>#=&gt; &quot;,.,++%/&#39;&#39;.&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L369-L372'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='369' data-end='372'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 369</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_alphanumeric'>alphanumeric</span>(<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>chars:</span> <span class='const'><a href="#ALPHANUMERIC-constant" title="Random::Formatter::ALPHANUMERIC (constant)">ALPHANUMERIC</a></span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>16</span> <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_choose'><a href="#choose-instance_method" title="Random::Formatter#choose (method)">choose</a></span>(<span class='id identifier rubyid_chars'>chars</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="base64-instance_method">
  <h3 class='signature '>
    #<strong>base64</strong>(n = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random base64 string.</p>

<p>The argument <em>n</em> specifies the length, in bytes, of the random number to be generated. The length of the result string is about 4/3 of <em>n</em>.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The result may contain A-Z, a-z, 0-9, “+”, “/” and “=”.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_base64'>base64</span> <span class='comment'>#=&gt; &quot;/2BuBuLf3+WfSKyQbRcc/A==&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_base64'>base64</span> <span class='comment'>#=&gt; &quot;6BbW0pxO0YENxn38HMUbcQ==&quot;</span></code></pre>

<p>See RFC 3548 for the definition of base64.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L115-L117'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='115' data-end='117'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 115</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_base64'>base64</span>(<span class='id identifier rubyid_n'>n</span><span class='op'>=</span><span class='kw'>nil</span>)
  [<span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='id identifier rubyid_n'>n</span>)].<span class='id identifier rubyid_pack'>pack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m0</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="choose-instance_method">
  <h3 class='signature priv'>
    #<strong>choose</strong>(source, n)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a string that randomly draws from a source array of characters.</p>

<p>The argument <em>source</em> specifies the array of characters from which to generate the string. The argument <em>n</em> specifies the length, in characters, of the string to be generated.</p>

<p>The result may contain whatever characters are in the source array.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_choose'>choose</span>([<span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>l</span><span class='tstring_end'>&#39;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>r</span><span class='tstring_end'>&#39;</span></span>]<span class='comma'>,</span> <span class='int'>16</span>) <span class='comment'>#=&gt; &quot;lmrqpoonmmlqlron&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_choose'>choose</span>([<span class='op'>*</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='op'>..</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>9</span><span class='tstring_end'>&#39;</span></span>]<span class='comma'>,</span> <span class='int'>5</span>)  <span class='comment'>#=&gt; &quot;27309&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L314-L341'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='314' data-end='341'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 314</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_choose'>choose</span>(<span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='id identifier rubyid_size'>size</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_limit'>limit</span> <span class='op'>*</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>&lt;=</span> <span class='int'>0x100000000</span>
    <span class='id identifier rubyid_limit'>limit</span> <span class='op'>*=</span> <span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_m'>m</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_m'>m</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_n'>n</span>
    <span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='id identifier rubyid_random_number'>random_number</span>(<span class='id identifier rubyid_limit'>limit</span>)
    <span class='id identifier rubyid_is'>is</span> <span class='op'>=</span> <span class='id identifier rubyid_rs'>rs</span>.<span class='id identifier rubyid_digits'>digits</span>(<span class='id identifier rubyid_size'>size</span>)
    (<span class='id identifier rubyid_m'>m</span><span class='op'>-</span><span class='id identifier rubyid_is'>is</span>.<span class='id identifier rubyid_length'>length</span>).<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_is'>is</span> <span class='op'>&lt;&lt;</span> <span class='int'>0</span> }
    <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_values_at'>values_at</span>(<span class='op'>*</span><span class='id identifier rubyid_is'>is</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_n'>n</span> <span class='op'>-=</span> <span class='id identifier rubyid_m'>m</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='int'>0</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_n'>n</span>
    <span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='id identifier rubyid_random_number'>random_number</span>(<span class='id identifier rubyid_limit'>limit</span>)
    <span class='id identifier rubyid_is'>is</span> <span class='op'>=</span> <span class='id identifier rubyid_rs'>rs</span>.<span class='id identifier rubyid_digits'>digits</span>(<span class='id identifier rubyid_size'>size</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_is'>is</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_n'>n</span>
      (<span class='id identifier rubyid_n'>n</span><span class='op'>-</span><span class='id identifier rubyid_is'>is</span>.<span class='id identifier rubyid_length'>length</span>).<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_is'>is</span> <span class='op'>&lt;&lt;</span> <span class='int'>0</span> }
    <span class='kw'>else</span>
      <span class='id identifier rubyid_is'>is</span>.<span class='id identifier rubyid_pop'>pop</span> <span class='kw'>while</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_is'>is</span>.<span class='id identifier rubyid_length'>length</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_concat'>concat</span> <span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_values_at'>values_at</span>(<span class='op'>*</span><span class='id identifier rubyid_is'>is</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="gen_random-instance_method">
  <h3 class='signature priv'>
    #<strong>gen_random</strong>(n)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Internal interface to Random; Generate random data <em>n</em> bytes.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L296-L298'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='296' data-end='298'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 296</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_gen_random'>gen_random</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_bytes'>bytes</span>(<span class='id identifier rubyid_n'>n</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="hex-instance_method">
  <h3 class='signature '>
    #<strong>hex</strong>(n = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random hexadecimal string.</p>

<p>The argument <em>n</em> specifies the length, in bytes, of the random number to be generated. The length of the resulting hexadecimal string is twice of <em>n</em>.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The result may contain 0-9 and a-f.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_hex'>hex</span> <span class='comment'>#=&gt; &quot;eb693ec8252cd630102fd0d0fb7c3485&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_hex'>hex</span> <span class='comment'>#=&gt; &quot;91dc3bfb4de5b11d029d376634589b61&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L93-L95'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='93' data-end='95'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 93</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_hex'>hex</span>(<span class='id identifier rubyid_n'>n</span><span class='op'>=</span><span class='kw'>nil</span>)
  <span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='id identifier rubyid_n'>n</span>).<span class='id identifier rubyid_unpack1'>unpack1</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>H*</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="random_bytes-instance_method">
  <h3 class='signature '>
    #<strong>random_bytes</strong>(n = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random binary string.</p>

<p>The argument <em>n</em> specifies the length of the result string.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in future.</p>

<p>The result may contain any byte: “x00” - “xff”.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_random_bytes'>random_bytes</span> <span class='comment'>#=&gt; &quot;\xD8\\\xE0\xF4\r\xB2\xFC*WM\xFF\x83\x18\xF45\xB6&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_random_bytes'>random_bytes</span> <span class='comment'>#=&gt; &quot;m\xDC\xFC/\a\x00Uf\xB2\xB2P\xBD\xFF6S\x97&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L72-L75'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='72' data-end='75'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 72</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_random_bytes'>random_bytes</span>(<span class='id identifier rubyid_n'>n</span><span class='op'>=</span><span class='kw'>nil</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>?</span> <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_to_int'>to_int</span> <span class='op'>:</span> <span class='int'>16</span>
  <span class='id identifier rubyid_gen_random'><a href="#gen_random-instance_method" title="Random::Formatter#gen_random (method)">gen_random</a></span>(<span class='id identifier rubyid_n'>n</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="urlsafe_base64-instance_method">
  <h3 class='signature '>
    #<strong>urlsafe_base64</strong>(n = nil, padding = false)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random URL-safe base64 string.</p>

<p>The argument <em>n</em> specifies the length, in bytes, of the random number to be generated. The length of the result string is about 4/3 of <em>n</em>.</p>

<p>If <em>n</em> is not specified or is nil, 16 is assumed. It may be larger in the future.</p>

<p>The boolean argument <em>padding</em> specifies the padding. If it is false or nil, padding is not generated. Otherwise padding is generated. By default, padding is not generated because “=” may be used as a URL delimiter.</p>

<p>The result may contain A-Z, a-z, 0-9, “-” and “_”. “=” is also used if <em>padding</em> is true.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_urlsafe_base64'>urlsafe_base64</span> <span class='comment'>#=&gt; &quot;b4GOKm4pOYU_-BOXcrUGDg&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_urlsafe_base64'>urlsafe_base64</span> <span class='comment'>#=&gt; &quot;UZLdOkzop70Ddx-IJR0ABg&quot;
</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_urlsafe_base64'>urlsafe_base64</span>(<span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>true</span>) <span class='comment'>#=&gt; &quot;i0XQ-7gglIsHGV2_BNPrdQ==&quot;
</span><span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_urlsafe_base64'>urlsafe_base64</span>(<span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>true</span>) <span class='comment'>#=&gt; &quot;-M8rLhr7JEpJlqFGUMmOxg==&quot;</span></code></pre>

<p>See RFC 3548 for the definition of URL-safe base64.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L146-L151'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='146' data-end='151'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 146</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_urlsafe_base64'>urlsafe_base64</span>(<span class='id identifier rubyid_n'>n</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_padding'>padding</span><span class='op'>=</span><span class='kw'>false</span>)
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> [<span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='id identifier rubyid_n'>n</span>)].<span class='id identifier rubyid_pack'>pack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>m0</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_tr!'>tr!</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+/</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-_</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_delete!'>delete!</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>unless</span> <span class='id identifier rubyid_padding'>padding</span>
  <span class='id identifier rubyid_s'>s</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uuid-instance_method">
  <h3 class='signature '>
    #<strong>uuid</strong>  
    <span class='aliases'>Also known as: <span class='names'>#uuid_v4</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random v4 UUID (Universally Unique IDentifier).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_uuid'>uuid</span> <span class='comment'>#=&gt; &quot;2d931510-d99f-494a-8c67-87feb05e1594&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_uuid'>uuid</span> <span class='comment'>#=&gt; &quot;bad85eb9-0713-4da7-8d36-07a8e4b00eab&quot;
</span><span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_uuid'>uuid</span> <span class='comment'>#=&gt; &quot;62936e70-1815-439b-bf89-8492855a7e6b&quot;</span></code></pre>

<p>The version 4 UUID is purely random (except the version). It doesn’t contain meaningful information such as MAC addresses, timestamps, etc.</p>

<p>The result contains 122 random bits (15.25 random bytes).</p>

<p>See <a href="https://datatracker.ietf.org/doc/html/rfc4122">RFC4122</a> for details of UUID.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L170-L175'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='170' data-end='175'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 170</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uuid'>uuid</span>
  <span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> <span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>16</span>)
  <span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_setbyte'>setbyte</span>(<span class='int'>6</span><span class='comma'>,</span> (<span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='int'>6</span>) <span class='op'>&amp;</span> <span class='int'>0x0f</span>) <span class='op'>|</span> <span class='int'>0x40</span>)
  <span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_setbyte'>setbyte</span>(<span class='int'>8</span><span class='comma'>,</span> (<span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='int'>8</span>) <span class='op'>&amp;</span> <span class='int'>0x3f</span>) <span class='op'>|</span> <span class='int'>0x80</span>)
  <span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>H8H4H4H4H12</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_join'>join</span>(<span class='CHAR'>?-</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uuid_v4-instance_method">
  <h3 class='signature '>
    #<strong>uuid_v4</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#uuid-instance_method" title="Random::Formatter#uuid (method)">#uuid</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L177-L177'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='177' data-end='177'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 177</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_uuid_v4'>uuid_v4</span> <span class='id identifier rubyid_uuid'><a href="#uuid-instance_method" title="Random::Formatter#uuid (method)">uuid</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="uuid_v7-instance_method">
  <h3 class='signature '>
    #<strong>uuid_v7</strong>(extra_timestamp_bits: 0)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate a random v7 UUID (Universally Unique IDentifier).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>random/formatter</span><span class='tstring_end'>&#39;</span></span>

<span class='const'>Random</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span> <span class='comment'># =&gt; &quot;0188d4c3-1311-7f96-85c7-242a7aa58f1e&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span> <span class='comment'># =&gt; &quot;0188d4c3-16fe-744f-86af-38fa04c62bb5&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span> <span class='comment'># =&gt; &quot;0188d4c3-1af8-764f-b049-c204ce0afa23&quot;
</span><span class='const'>Random</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span> <span class='comment'># =&gt; &quot;0188d4c3-1e74-7085-b14f-ef6415dc6f31&quot;
</span><span class='comment'>#                    |&lt;--sorted--&gt;| |&lt;----- random ----&gt;|
</span>
<span class='comment'># or
</span><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span> <span class='comment'># =&gt; &quot;0188ca51-5e72-7950-a11d-def7ff977c98&quot;</span></code></pre>

<p>The version 7 UUID starts with the least significant 48 bits of a 64 bit Unix timestamp (milliseconds since the epoch) and fills the remaining bits with random data, excluding the version and variant bits.</p>

<p>This allows version 7 UUIDs to be sorted by creation time.  Time ordered UUIDs can be used for better database index locality of newly inserted records, which may have a significant performance benefit compared to random data inserts.</p>

<p>The result contains 74 random bits (9.25 random bytes).</p>

<p>Note that this method cannot be made reproducible because its output includes not only random bits but also timestamp.</p>

<p>See <a href="https://datatracker.ietf.org/doc/draft-ietf-uuidrev-rfc4122bis/">draft-ietf-uuidrev-rfc4122bis</a> for details of UUIDv7.</p>

<h4 id="label-Monotonicity">Monotonicity</h4>

<p>UUIDv7 has millisecond precision by default, so multiple UUIDs created within the same millisecond are not issued in monotonically increasing order.  To create UUIDs that are time-ordered with sub-millisecond precision, up to 12 bits of additional timestamp may added with <code>extra_timestamp_bits</code>.  The extra timestamp precision comes at the expense of random bits.  Setting <code>extra_timestamp_bits: 12</code> provides ~244ns of precision, but only 62 random bits (7.75 random bytes).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_prng'>prng</span> <span class='op'>=</span> <span class='const'>Random</span>.<span class='id identifier rubyid_new'>new</span>
<span class='const'>Array</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>4</span>) { <span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span>(<span class='label'>extra_timestamp_bits:</span> <span class='int'>12</span>) }
<span class='comment'># =&gt;
</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-13da-74f9-8b53-22a786ffdd5a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-13da-753b-83a5-7fb9b2afaeea</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-13da-754a-88ea-ac0baeedd8db</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-13da-7557-83e1-7cad9cda0d8d</span><span class='tstring_end'>&quot;</span></span>]
<span class='comment'># |&lt;--- sorted ---&gt;| |&lt;-- random ---&gt;|
</span>
<span class='const'>Array</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>4</span>) { <span class='id identifier rubyid_prng'>prng</span>.<span class='id identifier rubyid_uuid_v7'>uuid_v7</span>(<span class='label'>extra_timestamp_bits:</span> <span class='int'>8</span>) }
<span class='comment'># =&gt;
</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-3333-7a95-850a-de6edb858f7e</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-3333-7ae8-842e-bc3a8b7d0cf9</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='comment'># &lt;- out of order
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-3333-7ae2-995a-9f135dc44ead</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='comment'># &lt;- out of order
</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0188d4c7-3333-7af9-87c3-8f612edac82e</span><span class='tstring_end'>&quot;</span></span>]
<span class='comment'># |&lt;--- sorted --&gt;||&lt;---- random ---&gt;|</span></code></pre>

<p>Any rollbacks of the system clock will break monotonicity.  UUIDv7 is based on UTC, which excludes leap seconds and can rollback the clock.  To avoid this, the system clock can synchronize with an NTP server configured to use a “leap smear” approach.  NTP or PTP will also be needed to synchronize across distributed nodes.</p>

<p>Counters and other mechanisms for stronger guarantees of monotonicity are not implemented.  Applications with stricter requirements should follow <a href="https://www.ietf.org/archive/id/draft-ietf-uuidrev-rfc4122bis-07.html#monotonicity_counters" target="_parent" title="Section 6.2">Section 6.2</a> of the specification.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/lib/random/formatter.rb#L248-L293'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='248' data-end='293'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/random/formatter.rb', line 248</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_uuid_v7'>uuid_v7</span>(<span class='label'>extra_timestamp_bits:</span> <span class='int'>0</span>)
  <span class='kw'>case</span> (<span class='id identifier rubyid_extra_timestamp_bits'>extra_timestamp_bits</span> <span class='op'>=</span> <span class='const'>Integer</span>(<span class='id identifier rubyid_extra_timestamp_bits'>extra_timestamp_bits</span>))
  <span class='kw'>when</span> <span class='int'>0</span> <span class='comment'># min timestamp precision
</span>    <span class='id identifier rubyid_ms'>ms</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_REALTIME</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_millisecond'>millisecond</span>)
    <span class='id identifier rubyid_rand'>rand</span> <span class='op'>=</span> <span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>10</span>)
    <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_setbyte'>setbyte</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='int'>0</span>) <span class='op'>&amp;</span> <span class='int'>0x0f</span> <span class='op'>|</span> <span class='int'>0x70</span>) <span class='comment'># version
</span>    <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_setbyte'>setbyte</span>(<span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='int'>2</span>) <span class='op'>&amp;</span> <span class='int'>0x3f</span> <span class='op'>|</span> <span class='int'>0x80</span>) <span class='comment'># variant
</span>    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%08x-%04x-%s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> [
      (<span class='id identifier rubyid_ms'>ms</span> <span class='op'>&amp;</span> <span class='int'>0x0000_ffff_ffff_0000</span>) <span class='op'>&gt;&gt;</span> <span class='int'>16</span><span class='comma'>,</span>
      (<span class='id identifier rubyid_ms'>ms</span> <span class='op'>&amp;</span> <span class='int'>0x0000_0000_0000_ffff</span>)<span class='comma'>,</span>
      <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>H4H4H12</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span>)
    ]

  <span class='kw'>when</span> <span class='int'>12</span> <span class='comment'># max timestamp precision
</span>    <span class='id identifier rubyid_ms'>ms</span><span class='comma'>,</span> <span class='id identifier rubyid_ns'>ns</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_REALTIME</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_nanosecond'>nanosecond</span>)
      .<span class='id identifier rubyid_divmod'>divmod</span>(<span class='int'>1_000_000</span>)
    <span class='id identifier rubyid_extra_bits'>extra_bits</span> <span class='op'>=</span> <span class='id identifier rubyid_ns'>ns</span> <span class='op'>*</span> <span class='int'>4096</span> <span class='op'>/</span> <span class='int'>1_000_000</span>
    <span class='id identifier rubyid_rand'>rand</span> <span class='op'>=</span> <span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>8</span>)
    <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_setbyte'>setbyte</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_getbyte'>getbyte</span>(<span class='int'>0</span>) <span class='op'>&amp;</span> <span class='int'>0x3f</span> <span class='op'>|</span> <span class='int'>0x80</span>) <span class='comment'># variant
</span>    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%08x-%04x-7%03x-%s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> [
      (<span class='id identifier rubyid_ms'>ms</span> <span class='op'>&amp;</span> <span class='int'>0x0000_ffff_ffff_0000</span>) <span class='op'>&gt;&gt;</span> <span class='int'>16</span><span class='comma'>,</span>
      (<span class='id identifier rubyid_ms'>ms</span> <span class='op'>&amp;</span> <span class='int'>0x0000_0000_0000_ffff</span>)<span class='comma'>,</span>
      <span class='id identifier rubyid_extra_bits'>extra_bits</span><span class='comma'>,</span>
      <span class='id identifier rubyid_rand'>rand</span>.<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>H4H12</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span>)
    ]

  <span class='kw'>when</span> (<span class='int'>0</span><span class='op'>..</span><span class='int'>12</span>) <span class='comment'># the generic version is slower than the special cases above
</span>    <span class='id identifier rubyid_rand_a'>rand_a</span><span class='comma'>,</span> <span class='id identifier rubyid_rand_b1'>rand_b1</span><span class='comma'>,</span> <span class='id identifier rubyid_rand_b2'>rand_b2</span><span class='comma'>,</span> <span class='id identifier rubyid_rand_b3'>rand_b3</span> <span class='op'>=</span> <span class='id identifier rubyid_random_bytes'><a href="#random_bytes-instance_method" title="Random::Formatter#random_bytes (method)">random_bytes</a></span>(<span class='int'>10</span>).<span class='id identifier rubyid_unpack'>unpack</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nnnN</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_rand_mask_bits'>rand_mask_bits</span> <span class='op'>=</span> <span class='int'>12</span> <span class='op'>-</span> <span class='id identifier rubyid_extra_timestamp_bits'>extra_timestamp_bits</span>
    <span class='id identifier rubyid_ms'>ms</span><span class='comma'>,</span> <span class='id identifier rubyid_ns'>ns</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_REALTIME</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_nanosecond'>nanosecond</span>)
      .<span class='id identifier rubyid_divmod'>divmod</span>(<span class='int'>1_000_000</span>)
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%08x-%04x-%04x-%04x-%04x%08x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> [
      (<span class='id identifier rubyid_ms'>ms</span> <span class='op'>&amp;</span> <span class='int'>0x0000_ffff_ffff_0000</span>) <span class='op'>&gt;&gt;</span> <span class='int'>16</span><span class='comma'>,</span>
      (<span class='id identifier rubyid_ms'>ms</span> <span class='op'>&amp;</span> <span class='int'>0x0000_0000_0000_ffff</span>)<span class='comma'>,</span>
      <span class='int'>0x7000</span> <span class='op'>|</span>
        ((<span class='id identifier rubyid_ns'>ns</span> <span class='op'>*</span> (<span class='int'>1</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extra_timestamp_bits'>extra_timestamp_bits</span>) <span class='op'>/</span> <span class='int'>1_000_000</span>) <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_rand_mask_bits'>rand_mask_bits</span>) <span class='op'>|</span>
        <span class='id identifier rubyid_rand_a'>rand_a</span> <span class='op'>&amp;</span> ((<span class='int'>1</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_rand_mask_bits'>rand_mask_bits</span>) <span class='op'>-</span> <span class='int'>1</span>)<span class='comma'>,</span>
      <span class='int'>0x8000</span> <span class='op'>|</span> (<span class='id identifier rubyid_rand_b1'>rand_b1</span> <span class='op'>&amp;</span> <span class='int'>0x3fff</span>)<span class='comma'>,</span>
      <span class='id identifier rubyid_rand_b2'>rand_b2</span><span class='comma'>,</span>
      <span class='id identifier rubyid_rand_b3'>rand_b3</span>
    ]

  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extra_timestamp_bits must be in 0..12</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>