<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: RubyVM::ZJIT &mdash; Core  Ruby-master dev</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyVM::ZJIT",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-master</a> &raquo; 
      <a href='../'>Core</a> &raquo; 
      <a href='../_index.html#alpha_Z'>Index (Z)</a> &raquo; 
        <a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ZJIT&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: RubyVM::ZJIT</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L9'>zjit.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This module allows for introspection of <code>ZJIT</code>, CRuby’s just-in-time compiler. Everything in the module is highly implementation specific and the API might be less stable compared to the standard library.</p>

<p>This module may not exist if <code>ZJIT</code> does not support the particular platform for which CRuby is built.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#enabled%3F-class_method" title=".enabled? (class method)">.<strong>enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if <code>ZJIT</code> is enabled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#stats_enabled%3F-class_method" title=".stats_enabled? (class method)">.<strong>stats_enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if <code>–zjit-stats</code> is used.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#trace_exit_locations_enabled%3F-class_method" title=".trace_exit_locations_enabled? (class method)">.<strong>trace_exit_locations_enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if <code>–zjit-trace-exits</code> is used.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#dump_exit_locations-class_method" title=".dump_exit_locations (class method)">.<strong>dump_exit_locations</strong>(filename)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p><a href="../Marshal.html" title="Marshal (module)"><code>::Marshal</code></a> dumps exit locations to the given filename.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exit_locations-class_method" title=".exit_locations (class method)">.<strong>exit_locations</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>If –zjit-trace-exits is enabled parse the hashes from <code>Primitive.rb_zjit_get_exit_locations</code> into a format readable by Stackprof.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset_stats!-class_method" title=".reset_stats! (class method)">.<strong>reset_stats!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Discard statistics collected for <code>–zjit-stats</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stats-class_method" title=".stats (class method)">.<strong>stats</strong>(target_key = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return ZJIT statistics as a <a href="../Hash.html" title="Hash (class)"><code>::Hash</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stats_string-class_method" title=".stats_string (class method)">.<strong>stats_string</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the summary of <code>ZJIT</code> statistics as a <a href="../String.html" title="String (class)"><code>::String</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#assert_compiles-class_method" title=".assert_compiles (class method)">.<strong>assert_compiles</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Assert that any future <code>ZJIT</code> compilation will return a function pointer.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#dump_locations-class_method" title=".dump_locations (class method)">.<strong>dump_locations</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#number_with_delimiter-class_method" title=".number_with_delimiter (class method)">.<strong>number_with_delimiter</strong>(number)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#print_counters-class_method" title=".print_counters (class method)">.<strong>print_counters</strong>(keys, buf:, stats:, right_align: false, base: nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#print_counters_with_prefix-class_method" title=".print_counters_with_prefix (class method)">.<strong>print_counters_with_prefix</strong>(buf:, stats:, prefix:, prompt:, limit: nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#print_stats-class_method" title=".print_stats (class method)">.<strong>print_stats</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Print ZJIT stats.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="enabled?-class_method">
  <h3 class='signature ro first'>
    .<strong>enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if <code>ZJIT</code> is enabled</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L21-L23'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='21' data-end='23'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 21</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_enabled?'>enabled?</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_cexpr!'>cexpr!</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RBOOL(rb_zjit_enabled_p)</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stats_enabled?-class_method">
  <h3 class='signature ro'>
    .<strong>stats_enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if <code>–zjit-stats</code> is used</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L135-L137'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='135' data-end='137'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stats_enabled?'>stats_enabled?</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_zjit_stats_enabled_p'>rb_zjit_stats_enabled_p</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="trace_exit_locations_enabled?-class_method">
  <h3 class='signature ro'>
    .<strong>trace_exit_locations_enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if <code>–zjit-trace-exits</code> is used</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L26-L28'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='26' data-end='28'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 26</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'>trace_exit_locations_enabled?</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_zjit_trace_exit_locations_enabled_p'>rb_zjit_trace_exit_locations_enabled_p</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="assert_compiles-class_method">
  <h3 class='signature nodoc first'>
    .<strong>assert_compiles</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Assert that any future <code>ZJIT</code> compilation will return a function pointer</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L207-L209'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='207' data-end='209'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 207</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assert_compiles'>assert_compiles</span> <span class='comment'># :nodoc:
</span>  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_zjit_assert_compiles'>rb_zjit_assert_compiles</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dump_exit_locations-class_method">
  <h3 class='signature '>
    .<strong>dump_exit_locations</strong>(filename)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../Marshal.html" title="Marshal (module)"><code>::Marshal</code></a> dumps exit locations to the given filename.</p>

<p>Usage:</p>

<p>In a script call:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>ZJIT</span>.<span class='id identifier rubyid_dump_exit_locations'>dump_exit_locations</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_file.dump</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>Then run the file with the following options:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_zjit'>zjit</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_zjit'>zjit</span><span class='op'>-</span><span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_zjit'>zjit</span><span class='op'>-</span><span class='id identifier rubyid_trace'>trace</span><span class='op'>-</span><span class='id identifier rubyid_exits'>exits</span> <span class='id identifier rubyid_test'>test</span>.<span class='id identifier rubyid_rb'>rb</span></code></pre>

<p>Once the code is done running, use Stackprof to read the dump file. See Stackprof documentation for options.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L124-L132'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='124' data-end='132'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 124</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dump_exit_locations'>dump_exit_locations</span>(<span class='id identifier rubyid_filename'>filename</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'><a href="#trace_exit_locations_enabled%3F-class_method" title="RubyVM::ZJIT.trace_exit_locations_enabled? (method)">trace_exit_locations_enabled?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--zjit-trace-exits must be enabled to use dump_exit_locations.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'><a href="../File.html" title="File (class)">File</a></span>.<span class='id identifier rubyid_open'><a href="../File.html#open-class_method" title="File.open (method)">open</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
    <span class='const'><a href="../Marshal.html" title="Marshal (module)">Marshal</a></span>.<span class='id identifier rubyid_dump'><a href="../Marshal.html#dump-class_method" title="Marshal.dump (method)">dump</a></span>(<span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>ZJIT</span>.<span class='id identifier rubyid_exit_locations'><a href="#exit_locations-class_method" title="RubyVM::ZJIT.exit_locations (method)">exit_locations</a></span><span class='comma'>,</span> <span class='id identifier rubyid_file'>file</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dump_locations-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>dump_locations</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L275-L282'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='275' data-end='282'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 275</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dump_locations'>dump_locations</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'><a href="#trace_exit_locations_enabled%3F-class_method" title="RubyVM::ZJIT.trace_exit_locations_enabled? (method)">trace_exit_locations_enabled?</a></span>

  <span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>zjit_exit_locations.dump</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_dump_exit_locations'><a href="#dump_exit_locations-class_method" title="RubyVM::ZJIT.dump_exit_locations (method)">dump_exit_locations</a></span>(<span class='id identifier rubyid_filename'>filename</span>)

  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ZJIT exit locations dumped to `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='embexpr_end'>}</span><span class='tstring_content'>`.</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit_locations-class_method">
  <h3 class='signature '>
    .<strong>exit_locations</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If –zjit-trace-exits is enabled parse the hashes from <code>Primitive.rb_zjit_get_exit_locations</code> into a format readable by Stackprof. This will allow us to find the exact location of a side exit in <code>ZJIT</code> based on the instruction that is exiting.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L34-L108'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='34' data-end='108'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 34</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exit_locations'>exit_locations</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'><a href="#trace_exit_locations_enabled%3F-class_method" title="RubyVM::ZJIT.trace_exit_locations_enabled? (method)">trace_exit_locations_enabled?</a></span>

  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_zjit_get_exit_locations'>rb_zjit_get_exit_locations</span>
  <span class='id identifier rubyid_raw_samples'>raw_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_raw'>raw</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_line_samples'>line_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_frames'>frames</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_frames'>frames</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_samples_count'>samples_count</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='comment'># Loop through the instructions and set the frame hash with the data.
</span>  <span class='comment'># We use nonexistent.def for the file name, otherwise insns.def will be displayed
</span>  <span class='comment'># and that information isn&#39;t useful in this context.
</span>  <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'><a href="../RubyVM.html#INSTRUCTION_NAMES-constant" title="RubyVM::INSTRUCTION_NAMES (constant)">INSTRUCTION_NAMES</a></span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_frame_id'>frame_id</span><span class='op'>|</span>
    <span class='id identifier rubyid_frame_hash'>frame_hash</span> <span class='op'>=</span> { <span class='label'>samples:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>total_samples:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>edges:</span> {}<span class='comma'>,</span> <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>file:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nonexistent.def</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>line:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>lines:</span> {} }
    <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_frames'>frames</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_frame_hash'>frame_hash</span>
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_frame_hash'>frame_hash</span>
  <span class='kw'>end</span>

  <span class='comment'># Loop through the raw_samples and build the hashes for StackProf.
</span>  <span class='comment'># The loop is based off an example in the StackProf documentation and therefore
</span>  <span class='comment'># this functionality can only work with that library.
</span>  <span class='comment'>#
</span>  <span class='comment'># Raw Samples:
</span>  <span class='comment'># [ length, frame1, frame2, frameN, ..., instruction, count
</span>  <span class='comment'>#
</span>  <span class='comment'># Line Samples
</span>  <span class='comment'># [ length, line_1, line_2, line_n, ..., dummy value, count
</span>  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>.<span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_stack_length'>stack_length</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_i'>i</span>]
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='comment'># consume the stack length
</span>
    <span class='id identifier rubyid_sample_count'>sample_count</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='id identifier rubyid_stack_length'>stack_length</span>]

    <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_stack_length'>stack_length</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>+=</span> <span class='id identifier rubyid_i'>i</span>
      <span class='id identifier rubyid_frame_id'>frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]

      <span class='kw'>if</span> <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>
        <span class='id identifier rubyid_prev_frame'>prev_frame</span> <span class='op'>=</span> <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>]
        <span class='id identifier rubyid_prev_frame'>prev_frame</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_edges'>edges</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>||=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_prev_frame'>prev_frame</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_edges'>edges</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_frame_info'>frame_info</span> <span class='op'>=</span> <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_frame_id'>frame_id</span>]
      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_samples'>total_samples</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>

      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_line_samples'>line_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]] <span class='op'>||=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>]
      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_line_samples'>line_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]][<span class='int'>0</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>

      <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_frame_id'>frame_id</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='id identifier rubyid_stack_length'>stack_length</span> <span class='comment'># consume the stack
</span>
    <span class='id identifier rubyid_top_frame_id'>top_frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>
    <span class='id identifier rubyid_top_frame_line'>top_frame_line</span> <span class='op'>=</span> <span class='int'>1</span>

    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_samples'>samples</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>] <span class='op'>||=</span> {}
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_top_frame_line'>top_frame_line</span>] <span class='op'>||=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>]
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_top_frame_line'>top_frame_line</span>][<span class='int'>1</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>

    <span class='id identifier rubyid_samples_count'>samples_count</span> <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_samples'>samples</span>] <span class='op'>=</span> <span class='id identifier rubyid_samples_count'>samples_count</span>
  <span class='comment'># Set missed_samples and gc_samples to 0 as their values
</span>  <span class='comment'># don&#39;t matter to us in this context.
</span>  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_missed_samples'>missed_samples</span>] <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_gc_samples'>gc_samples</span>] <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="number_with_delimiter-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>number_with_delimiter</strong>(number)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L263-L268'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='263' data-end='268'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 263</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_number_with_delimiter'>number_with_delimiter</span>(<span class='id identifier rubyid_number'>number</span>)
  <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span>.<span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_index'>index</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>) <span class='op'>||</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_insert'>insert</span>(<span class='id identifier rubyid_i'>i</span> <span class='op'>-=</span> <span class='int'>3</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&gt;</span> <span class='int'>3</span>
  <span class='id identifier rubyid_s'>s</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_counters-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>print_counters</strong>(keys, buf:, stats:, right_align: false, base: nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L214-L239'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='214' data-end='239'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 214</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_counters'>print_counters</span>(<span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>right_align:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>base:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_key_pad'>key_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>_time_ns\z</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_time</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_size'>size</span> }.<span class='id identifier rubyid_max'>max</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_key_align'>key_align</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_right_align'>right_align</span>
  <span class='id identifier rubyid_value_pad'>value_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_filter_map'>filter_map</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>[<span class='id identifier rubyid_key'>key</span>] }.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_number_with_delimiter'><a href="#number_with_delimiter-class_method" title="RubyVM::ZJIT.number_with_delimiter (method)">number_with_delimiter</a></span>(<span class='id identifier rubyid_value'>value</span>).<span class='id identifier rubyid_size'>size</span> }.<span class='id identifier rubyid_max'>max</span>

  <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='comment'># Some stats like vm_insn_count and ratio_in_zjit are not supported on the release build
</span>    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_key'>key</span>)
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>[<span class='id identifier rubyid_key'>key</span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_base'>base</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>!=</span> <span class='id identifier rubyid_base'>base</span>
      <span class='id identifier rubyid_ratio'>ratio</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> (%4.1f%%)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> (<span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>/</span> <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>[<span class='id identifier rubyid_base'>base</span>])
    <span class='kw'>end</span>

    <span class='kw'>case</span> <span class='id identifier rubyid_key'>key</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_zjit'>ratio_in_zjit</span>
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%0.1f%%</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>_time_ns\z</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>_time_ns\z</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>_time</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number_with_delimiter'><a href="#number_with_delimiter-class_method" title="RubyVM::ZJIT.number_with_delimiter (method)">number_with_delimiter</a></span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>/</span> <span class='int'>10</span><span class='op'>**</span><span class='int'>6</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>ms</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_number_with_delimiter'><a href="#number_with_delimiter-class_method" title="RubyVM::ZJIT.number_with_delimiter (method)">number_with_delimiter</a></span>(<span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key_align'>key_align</span><span class='embexpr_end'>}</span><span class='tstring_content'>*s %*s%s\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> [<span class='id identifier rubyid_key_pad'>key_pad</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_value_pad'>value_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_ratio'>ratio</span>]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_counters_with_prefix-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>print_counters_with_prefix</strong>(buf:, stats:, prefix:, prompt:, limit: nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L241-L261'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='241' data-end='261'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 241</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_counters_with_prefix'>print_counters_with_prefix</span>(<span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>prefix:</span><span class='comma'>,</span> <span class='label'>prompt:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>.<span class='id identifier rubyid_select'>select</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='id identifier rubyid_prefix'>prefix</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;</span> <span class='int'>0</span> }
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_transform_keys!'>transform_keys!</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_delete_prefix'>delete_prefix</span>(<span class='id identifier rubyid_prefix'>prefix</span>) }
  <span class='id identifier rubyid_key_pad'>key_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_size'>size</span>).<span class='id identifier rubyid_max'>max</span>
  <span class='id identifier rubyid_value_pad'>value_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_number_with_delimiter'><a href="#number_with_delimiter-class_method" title="RubyVM::ZJIT.number_with_delimiter (method)">number_with_delimiter</a></span>(<span class='id identifier rubyid_value'>value</span>).<span class='id identifier rubyid_size'>size</span> }.<span class='id identifier rubyid_max'>max</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_sum'>sum</span>

  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_to_a'>to_a</span>
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_sort_by!'>sort_by!</span> { <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_value'>value</span> }
  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_first'>first</span>(<span class='id identifier rubyid_limit'>limit</span>) <span class='kw'>if</span> <span class='id identifier rubyid_limit'>limit</span>

  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Top-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prompt'>prompt</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> (%.1f%% of total </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_number_with_delimiter'><a href="#number_with_delimiter-class_method" title="RubyVM::ZJIT.number_with_delimiter (method)">number_with_delimiter</a></span>(<span class='id identifier rubyid_total'>total</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> (<span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_last'>last</span>).<span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_total'>total</span>) <span class='kw'>if</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  %*s: %*s (%4.1f%%)\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> [<span class='id identifier rubyid_key_pad'>key_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value_pad'>value_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_number_with_delimiter'><a href="#number_with_delimiter-class_method" title="RubyVM::ZJIT.number_with_delimiter (method)">number_with_delimiter</a></span>(<span class='id identifier rubyid_value'>value</span>)<span class='comma'>,</span> (<span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>/</span> <span class='id identifier rubyid_total'>total</span>)]
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_stats-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>print_stats</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Print ZJIT stats</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L271-L273'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='271' data-end='273'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 271</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_stats'>print_stats</span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stats_string'><a href="#stats_string-class_method" title="RubyVM::ZJIT.stats_string (method)">stats_string</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset_stats!-class_method">
  <h3 class='signature '>
    .<strong>reset_stats!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Discard statistics collected for <code>–zjit-stats</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L145-L147'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='145' data-end='147'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 145</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_stats!'>reset_stats!</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_zjit_reset_stats_bang'>rb_zjit_reset_stats_bang</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stats-class_method">
  <h3 class='signature '>
    .<strong>stats</strong>(target_key = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return ZJIT statistics as a <a href="../Hash.html" title="Hash (class)"><code>::Hash</code></a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L140-L142'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='140' data-end='142'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 140</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stats'>stats</span>(<span class='id identifier rubyid_target_key'>target_key</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_zjit_stats'>rb_zjit_stats</span>(<span class='id identifier rubyid_target_key'>target_key</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stats_string-class_method">
  <h3 class='signature '>
    .<strong>stats_string</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the summary of <code>ZJIT</code> statistics as a <a href="../String.html" title="String (class)"><code>::String</code></a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/master/zjit.rb#L150-L204'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='150' data-end='204'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'zjit.rb', line 150</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stats_string'>stats_string</span>
  <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>***ZJIT: Printing ZJIT statistics on exit***\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stats'><a href="#stats-class_method" title="RubyVM::ZJIT.stats (method)">stats</a></span>

  <span class='comment'># Show counters independent from exit_* or dynamic_send_*
</span>  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not_optimized_cfuncs_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unoptimized sends to C functions</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)

  <span class='comment'># Show fallback counters, ordered by the typical amount of fallbacks for the prefix at the time
</span>  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unspecialized_def_type_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not optimized method types</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)
  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not_optimized_yarv_insn_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not optimized instructions</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)
  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>send_fallback_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>send fallback reasons</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)

  <span class='comment'># Show exit counters, ordered by the typical amount of exits for the prefix at the time
</span>  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unhandled_yarv_insn_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unhandled YARV insns</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)
  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>compile_error_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>compile error reasons</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)
  <span class='id identifier rubyid_print_counters_with_prefix'><a href="#print_counters_with_prefix-class_method" title="RubyVM::ZJIT.print_counters_with_prefix (method)">print_counters_with_prefix</a></span>(<span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exit_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>side exit reasons</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)

  <span class='comment'># Show no-prefix counters, having the most important stat `ratio_in_zjit` at the end
</span>  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::ZJIT.print_counters (method)">print_counters</a></span>([
    <span class='symbeg'>:</span><span class='id identifier rubyid_send_count'>send_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_dynamic_send_count'>dynamic_send_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_optimized_send_count'>optimized_send_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_iseq_optimized_send_count'>iseq_optimized_send_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_inline_cfunc_optimized_send_count'>inline_cfunc_optimized_send_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_variadic_cfunc_optimized_send_count'>variadic_cfunc_optimized_send_count</span><span class='comma'>,</span>
  ]<span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span><span class='comma'>,</span> <span class='label'>right_align:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>base:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_count'>send_count</span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::ZJIT.print_counters (method)">print_counters</a></span>([
    <span class='symbeg'>:</span><span class='id identifier rubyid_dynamic_getivar_count'>dynamic_getivar_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_dynamic_setivar_count'>dynamic_setivar_count</span><span class='comma'>,</span>

    <span class='symbeg'>:</span><span class='id identifier rubyid_compiled_iseq_count'>compiled_iseq_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_failed_iseq_count'>failed_iseq_count</span><span class='comma'>,</span>

    <span class='symbeg'>:</span><span class='id identifier rubyid_compile_time_ns'>compile_time_ns</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_profile_time_ns'>profile_time_ns</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_gc_time_ns'>gc_time_ns</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_invalidation_time_ns'>invalidation_time_ns</span><span class='comma'>,</span>

    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_write_pc_count'>vm_write_pc_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_write_sp_count'>vm_write_sp_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_write_locals_count'>vm_write_locals_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_write_stack_count'>vm_write_stack_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_write_to_parent_iseq_local_count'>vm_write_to_parent_iseq_local_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_read_from_parent_iseq_local_count'>vm_read_from_parent_iseq_local_count</span><span class='comma'>,</span>

    <span class='symbeg'>:</span><span class='id identifier rubyid_code_region_bytes'>code_region_bytes</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_side_exit_count'>side_exit_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_total_insn_count'>total_insn_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_vm_insn_count'>vm_insn_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_zjit_insn_count'>zjit_insn_count</span><span class='comma'>,</span>
    <span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_zjit'>ratio_in_zjit</span><span class='comma'>,</span>
  ]<span class='comma'>,</span> <span class='label'>buf:</span><span class='comma'>,</span> <span class='label'>stats:</span>)

  <span class='id identifier rubyid_buf'>buf</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>