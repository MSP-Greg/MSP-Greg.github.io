<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Batches &mdash; Rails-4.2.7</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Batches",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-4.2.7</a> &raquo; 
          <a href='../_index.html'>Index (B)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>Batches</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActiveRecord::Batches</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>




  <tr>
    <td class='box_1'>Included in:</td>
    <td><a href="Relation.html" title="ActiveRecord::Relation (class)">Relation</a>
    </td>
  </tr>

  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/4-2-stable/activerecord/lib/active_record/relation/batches.rb#L2'>activerecord/lib/active_record/relation/batches.rb</a></div>  </td>
  </tr>
</table>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#find_each-instance_method" title="#find_each (instance method)">#<strong>find_each</strong>(options = {})  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Looping through a collection of records from the database (using the
<code>all</code> method, for example) is very inefficient since it will try
to instantiate all the objects at once.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#find_in_batches-instance_method" title="#find_in_batches (instance method)">#<strong>find_in_batches</strong>(options = {})  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Yields each batch of records that was found by the find
<code>options</code> as an array.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="find_each-instance_method">
  <h3 class='signature first'>
  #<strong>find_each</strong>(options = {})  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Looping through a collection of records from the database (using the
<code>all</code> method, for example) is very inefficient since it will try
to instantiate all the objects at once.</p>

<p>In that case, batch processing methods allow you to work with the records
in batches, thereby greatly reducing memory consumption.</p>

<p>The <a href="#find_each-instance_method" title="ActiveRecord::Batches#find_each (method)">#find_each</a> method uses <a href="#find_in_batches-instance_method" title="ActiveRecord::Batches#find_in_batches (method)">#find_in_batches</a> with a batch size of 1000
(or as specified by the <code>:batch_size</code> option).</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_find_each'>find_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_person'>person</span><span class='op'>|</span>
  <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_do_awesome_stuff'>do_awesome_stuff</span>
<span class='kw'>end</span>

<span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age &gt; 21</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find_each'>find_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_person'>person</span><span class='op'>|</span>
  <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_party_all_night!'>party_all_night!</span>
<span class='kw'>end</span>
</code></pre>

<p>If you do not provide a block to <a href="#find_each-instance_method" title="ActiveRecord::Batches#find_each (method)">#find_each</a>, it will return an Enumerator
for chaining with other methods:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_find_each'>find_each</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_person'>person</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
  <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_award_trophy'>award_trophy</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h4 id="label-Options">Options</h4>
<ul><li>
<p><code>:batch_size</code> - Specifies the size of the batch. Default to
1000.</p>
</li><li>
<p><code>:start</code> - Specifies the starting point for the batch
processing.</p>
</li></ul>

<p>This is especially useful if you want multiple workers dealing with the
same processing queue. You can make worker 1 handle all the records between
id 0 and 10,000 and worker 2 handle from 10,000 and beyond (by setting the
<code>:start</code> option on that worker).</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Let&#39;s process for a batch of 2000 records, skipping the first 2000 rows
</span><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_find_each'>find_each</span><span class='lparen'>(</span><span class='label'>start:</span> <span class='int'>2000</span><span class='comma'>,</span> <span class='label'>batch_size:</span> <span class='int'>2000</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_person'>person</span><span class='op'>|</span>
  <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_party_all_night!'>party_all_night!</span>
<span class='kw'>end</span>
</code></pre>

<p>NOTE: It&#39;s not possible to set the order. That is automatically set to
ascending on the primary key (“id ASC”) to make the batch ordering work.
This also means that this method only works with integer-based primary
keys.</p>

<p>NOTE: You can&#39;t set the limit either, that&#39;s used to control the
batch sizes.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/4-2-stable/activerecord/lib/active_record/relation/batches.rb#L48'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


48
49
50
51
52
53
54
55
56
57
58</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/relation/batches.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_each'>find_each</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_find_in_batches'>find_in_batches</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_records'>records</span><span class='op'>|</span>
      <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='kw'>yield</span> <span class='id identifier rubyid_record'>record</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:find_each</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_table'>table</span><span class='lbracket'>[</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gteq'>gteq</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>:</span> <span class='id identifier rubyid_size'>size</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="find_in_batches-instance_method">
  <h3 class='signature'>
  #<strong>find_in_batches</strong>(options = {})  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Yields each batch of records that was found by the find
<code>options</code> as an array.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age &gt; 21</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find_in_batches'>find_in_batches</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='op'>|</span>
  <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>50</span><span class='rparen'>)</span> <span class='comment'># Make sure it doesn&#39;t get too crowded in there!
</span>  <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_person'>person</span><span class='op'>|</span> <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_party_all_night!'>party_all_night!</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>If you do not provide a block to <a href="#find_in_batches-instance_method" title="ActiveRecord::Batches#find_in_batches (method)">#find_in_batches</a>, it will return an
Enumerator for chaining with other methods:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_find_in_batches'>find_in_batches</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='comma'>,</span> <span class='id identifier rubyid_batch'>batch</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processing group #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_batch'>batch</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:recover_from_last_night!</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<p>To be yielded each record one by one, use <a href="#find_each-instance_method" title="ActiveRecord::Batches#find_each (method)">#find_each</a> instead.</p>

<h4 id="label-Options">Options</h4>
<ul><li>
<p><code>:batch_size</code> - Specifies the size of the batch. Default to
1000.</p>
</li><li>
<p><code>:start</code> - Specifies the starting point for the batch
processing.</p>
</li></ul>

<p>This is especially useful if you want multiple workers dealing with the
same processing queue. You can make worker 1 handle all the records between
id 0 and 10,000 and worker 2 handle from 10,000 and beyond (by setting the
<code>:start</code> option on that worker).</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Let&#39;s process the next 2000 records
</span><span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_find_in_batches'>find_in_batches</span><span class='lparen'>(</span><span class='label'>start:</span> <span class='int'>2000</span><span class='comma'>,</span> <span class='label'>batch_size:</span> <span class='int'>2000</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='op'>|</span>
  <span class='id identifier rubyid_group'>group</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_person'>person</span><span class='op'>|</span> <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_party_all_night!'>party_all_night!</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>NOTE: It&#39;s not possible to set the order. That is automatically set to
ascending on the primary key (“id ASC”) to make the batch ordering work.
This also means that this method only works with integer-based primary
keys.</p>

<p>NOTE: You can&#39;t set the limit either, that&#39;s used to control the
batch sizes.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/4-2-stable/activerecord/lib/active_record/relation/batches.rb#L98'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/relation/batches.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_in_batches'>find_in_batches</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_assert_valid_keys'>assert_valid_keys</span><span class='lparen'>(</span><span class='symbol'>:start</span><span class='comma'>,</span> <span class='symbol'>:batch_size</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_relation'>relation</span> <span class='op'>=</span> <span class='kw'>self</span>
  <span class='id identifier rubyid_start'>start</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_batch_size'>batch_size</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:batch_size</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>1000</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_to_enum'>to_enum</span><span class='lparen'>(</span><span class='symbol'>:find_in_batches</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_start'>start</span> <span class='op'>?</span> <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_table'>table</span><span class='lbracket'>[</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gteq'>gteq</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>:</span> <span class='id identifier rubyid_size'>size</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_total'>total</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_div'>div</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_size'>batch_size</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_arel'>arel</span><span class='period'>.</span><span class='id identifier rubyid_orders'>orders</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='id identifier rubyid_arel'>arel</span><span class='period'>.</span><span class='id identifier rubyid_taken'>taken</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Scoped order and limit are ignored, it&#39;s forced to be batch order and batch size</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_relation'>relation</span> <span class='op'>=</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_reorder'>reorder</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_order'>batch_order</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='id identifier rubyid_batch_size'>batch_size</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_start'>start</span> <span class='op'>?</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_table'>table</span><span class='lbracket'>[</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gteq'>gteq</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span> <span class='op'>:</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_records_size'>records_size</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_primary_key_offset'>primary_key_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Primary key not included in the custom select clause</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_primary_key_offset'>primary_key_offset</span>

    <span class='kw'>yield</span> <span class='id identifier rubyid_records'>records</span>

    <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_records_size'>records_size</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_batch_size'>batch_size</span>

    <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_table'>table</span><span class='lbracket'>[</span><span class='id identifier rubyid_primary_key'>primary_key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_gt'>gt</span><span class='lparen'>(</span><span class='id identifier rubyid_primary_key_offset'>primary_key_offset</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>