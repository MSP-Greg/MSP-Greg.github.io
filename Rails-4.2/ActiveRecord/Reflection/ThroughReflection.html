<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Reflection::ThroughReflection &mdash; Rails-4.2.7</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Reflection::ThroughReflection",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Rails-4.2.7</a> &raquo; 
          <a href='../../_index.html'>Index (T)</a> &raquo; 
          <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <a href="../Reflection.html" title="ActiveRecord::Reflection (module)">Reflection</a> &raquo; 
          <span class='title'>ThroughReflection</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: ActiveRecord::Reflection::ThroughReflection</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="AbstractReflection.html" title="ActiveRecord::Reflection::AbstractReflection (class)">AbstractReflection</a></span>
      <ul class='fullTree'>
        <li><a href="../../Object.html" title="Object (class)">Object</a></li>
        <li class='next'><a href="AbstractReflection.html" title="ActiveRecord::Reflection::AbstractReflection (class)">AbstractReflection</a></li>
        <li class='next'>ActiveRecord::Reflection::ThroughReflection</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>





  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_min'>
activerecord/lib/active_record/reflection.rb</div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Holds all the meta-data about a :through association as it was specified in
the Active Record class.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(delegate_reflection)  &#x21d2; ThroughReflection </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>a new instance of ThroughReflection</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#association_primary_key-instance_method" title="#association_primary_key (instance method)">#<strong>association_primary_key</strong>(klass = nil)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>We want to use the klass from this reflection, rather than just delegate
straight to the source_reflection, because the source_reflection may be
polymorphic.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#chain-instance_method" title="#chain (instance method)">#<strong>chain</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns an array of reflections which are involved in this association.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#check_validity%21-instance_method" title="#check_validity! (instance method)">#<strong>check_validity!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#join_keys-instance_method" title="#join_keys (instance method)">#<strong>join_keys</strong>(assoc_klass)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#klass-instance_method" title="#klass (instance method)">#<strong>klass</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#nested%3F-instance_method" title="#nested? (instance method)">#<strong>nested?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>A through association is nested if there would be more than one join table</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#scope_chain-instance_method" title="#scope_chain (instance method)">#<strong>scope_chain</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Consider the following example:</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#source_macro-instance_method" title="#source_macro (instance method)">#<strong>source_macro</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The macro used by the source association</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#source_options-instance_method" title="#source_options (instance method)">#<strong>source_options</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#source_reflection-instance_method" title="#source_reflection (instance method)">#<strong>source_reflection</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the source of the through reflection.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#source_reflection_names-instance_method" title="#source_reflection_names (instance method)">#<strong>source_reflection_names</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Gets an array of possible <code>:through</code> source reflection names in
both singular and plural form.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#through_options-instance_method" title="#through_options (instance method)">#<strong>through_options</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#through_reflection-instance_method" title="#through_reflection (instance method)">#<strong>through_reflection</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the AssociationReflection object specified in the
<code>:through</code> option of a HasManyThrough or HasOneThrough
association.</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <a href="AbstractReflection.html" title="ActiveRecord::Reflection::AbstractReflection (class)">AbstractReflection</a></h3>
  <p class="inherited"><a href="AbstractReflection.html#build_association-instance_method" title="ActiveRecord::Reflection::AbstractReflection#build_association (method)">#build_association</a>, <a href="AbstractReflection.html#check_validity_of_inverse%21-instance_method" title="ActiveRecord::Reflection::AbstractReflection#check_validity_of_inverse! (method)">#check_validity_of_inverse!</a>, <a href="AbstractReflection.html#class_name-instance_method" title="ActiveRecord::Reflection::AbstractReflection#class_name (method)">#class_name</a>, <a href="AbstractReflection.html#inverse_of-instance_method" title="ActiveRecord::Reflection::AbstractReflection#inverse_of (method)">#inverse_of</a>, <a href="AbstractReflection.html#primary_key_type-instance_method" title="ActiveRecord::Reflection::AbstractReflection#primary_key_type (method)">#primary_key_type</a>, <a href="AbstractReflection.html#quoted_table_name-instance_method" title="ActiveRecord::Reflection::AbstractReflection#quoted_table_name (method)">#quoted_table_name</a>, <a href="AbstractReflection.html#table_name-instance_method" title="ActiveRecord::Reflection::AbstractReflection#table_name (method)">#table_name</a></p>
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(delegate_reflection)  &#x21d2; <tt><a href="" title="ActiveRecord::Reflection::ThroughReflection (class)">ThroughReflection</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>a new instance of ThroughReflection</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


643
644
645
646
647</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 643</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_delegate_reflection'>delegate_reflection</span><span class='rparen'>)</span>
  <span class='ivar'>@delegate_reflection</span> <span class='op'>=</span> <span class='id identifier rubyid_delegate_reflection'>delegate_reflection</span>
  <span class='ivar'>@klass</span>         <span class='op'>=</span> <span class='id identifier rubyid_delegate_reflection'>delegate_reflection</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:anonymous_class</span><span class='rbracket'>]</span>
  <span class='ivar'>@source_reflection_name</span> <span class='op'>=</span> <span class='id identifier rubyid_delegate_reflection'>delegate_reflection</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="association_primary_key-instance_method">
  <h3 class='signature first'>
  #<strong>association_primary_key</strong>(klass = nil)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>We want to use the klass from this reflection, rather than just delegate
straight to the source_reflection, because the source_reflection may be
polymorphic. We still need to respect the source_reflection&#39;s
:primary_key option, though.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


780
781
782
783
784</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 780</span>

<span class='kw'>def</span> <span class='id identifier rubyid_association_primary_key'>association_primary_key</span><span class='lparen'>(</span><span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># Get the &quot;actual&quot; source reflection if the immediate source reflection has a
</span>  <span class='comment'># source reflection itself
</span>  <span class='id identifier rubyid_actual_source_reflection'>actual_source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:primary_key</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_primary_key'>primary_key</span><span class='lparen'>(</span><span class='id identifier rubyid_klass'>klass</span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_klass'>klass</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="chain-instance_method">
  <h3 class='signature'>
  #<strong>chain</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns an array of reflections which are involved in this association.
Each item in the array corresponds to a table which will be part of the
query for this association.</p>

<p>The chain is built by recursively calling <a href="#chain-instance_method" title="ActiveRecord::Reflection::ThroughReflection#chain (method)">#chain</a> on the source reflection
and the through reflection. The base case for the recursion is a normal
association, which just returns</p>
<dl class="rdoc-list label-list"><dt>self
<dd>
<p>as its <a href="#chain-instance_method" title="ActiveRecord::Reflection::ThroughReflection#chain (method)">#chain</a>.</p>
</dd></dl>

<pre class="code ruby"><code class="ruby">class Post &lt; ActiveRecord::Base
  has_many :taggings
  has_many :tags, through: :taggings
end

tags_reflection = Post.reflect_on_association(:tags)
tags_reflection.chain
# =&gt; [&lt;ActiveRecord::Reflection::ThroughReflection: @delegate_reflection=#&lt;ActiveRecord::Reflection::HasManyReflection: @name=:tags...&gt;,
      &lt;ActiveRecord::Reflection::HasManyReflection: @name=:taggings, @options={}, @active_record=Post&gt;]</code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


707
708
709
710
711
712
713
714
715</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 707</span>

<span class='kw'>def</span> <span class='id identifier rubyid_chain'>chain</span>
  <span class='ivar'>@chain</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_chain'>chain</span>
    <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_chain'>chain</span>
    <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span>
    <span class='id identifier rubyid_chain'>chain</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span> <span class='comment'># Use self so we don&#39;t lose the information from :source_type
</span>    <span class='id identifier rubyid_chain'>chain</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="check_validity!-instance_method">
  <h3 class='signature'>
  #<strong>check_validity!</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 836</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_validity!'>check_validity!</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasManyThroughAssociationNotFoundError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_polymorphic?'>polymorphic?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_has_one?'>has_one?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasOneAssociationPolymorphicThroughError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasManyThroughAssociationPolymorphicThroughError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasManyThroughSourceAssociationNotFoundError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source_type</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_polymorphic?'>polymorphic?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasManyThroughAssociationPointlessSourceTypeError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_polymorphic?'>polymorphic?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source_type</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasManyThroughAssociationPolymorphicSourceError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_has_one?'>has_one?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_collection?'>collection?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>HasOneThroughCantAssociateThroughCollection</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_check_validity_of_inverse!'>check_validity_of_inverse!</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="join_keys-instance_method">
  <h3 class='signature'>
  #<strong>join_keys</strong>(assoc_klass)  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


758
759
760</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 758</span>

<span class='kw'>def</span> <span class='id identifier rubyid_join_keys'>join_keys</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_klass'>assoc_klass</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_join_keys'>join_keys</span><span class='lparen'>(</span><span class='id identifier rubyid_assoc_klass'>assoc_klass</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="klass-instance_method">
  <h3 class='signature'>
  #<strong>klass</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


649
650
651</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 649</span>

<span class='kw'>def</span> <span class='id identifier rubyid_klass'>klass</span>
  <span class='ivar'>@klass</span> <span class='op'>||=</span> <span class='id identifier rubyid_delegate_reflection'>delegate_reflection</span><span class='period'>.</span><span class='id identifier rubyid_compute_class'>compute_class</span><span class='lparen'>(</span><span class='id identifier rubyid_class_name'>class_name</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="nested?-instance_method">
  <h3 class='signature'>
  #<strong>nested?</strong>  &#x21d2; <tt>Boolean</tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>A through association is nested if there would be more than one join table</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


773
774
775</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 773</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nested?'>nested?</span>
  <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>2</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="scope_chain-instance_method">
  <h3 class='signature'>
  #<strong>scope_chain</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Consider the following example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Person</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:articles</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:comment_tags</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:articles</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Article</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:comments</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:comment_tags</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:comments</span><span class='comma'>,</span> <span class='label'>source:</span> <span class='symbol'>:tags</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Comment</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:tags</span>
<span class='kw'>end</span>
</code></pre>

<p>There may be scopes on <code>Person.comment_tags</code>, <code>Article.comment_tags</code> and/or
<code>Comment.tags</code>, but only <code>Comment.tags</code> will be represented in the
<a href="#chain-instance_method" title="ActiveRecord::Reflection::ThroughReflection#chain (method)">#chain</a>. So this method creates an array of scopes corresponding to the
chain.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 736</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scope_chain'>scope_chain</span>
  <span class='ivar'>@scope_chain</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_scope_chain'>scope_chain</span> <span class='op'>=</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_scope_chain'>scope_chain</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:dup</span><span class='rparen'>)</span>

    <span class='comment'># Add to it the scope from this reflection (if any)
</span>    <span class='id identifier rubyid_scope_chain'>scope_chain</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_scope'>scope</span> <span class='kw'>if</span> <span class='id identifier rubyid_scope'>scope</span>

    <span class='id identifier rubyid_through_scope_chain'>through_scope_chain</span> <span class='op'>=</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_scope_chain'>scope_chain</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:dup</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source_type</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_foreign_type'>foreign_type</span>
      <span class='id identifier rubyid_source_type'>source_type</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source_type</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_through_scope_chain'>through_scope_chain</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='op'>|</span>
        <span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_source_type'>source_type</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># Recursively fill out the rest of the array from the through reflection
</span>    <span class='id identifier rubyid_scope_chain'>scope_chain</span> <span class='op'>+</span> <span class='id identifier rubyid_through_scope_chain'>through_scope_chain</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="source_macro-instance_method">
  <h3 class='signature'>
  #<strong>source_macro</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The macro used by the source association</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


763
764
765
766
767
768
769
770</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 763</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source_macro'>source_macro</span>
  <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Deprecation</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='heredoc_beg'>&lt;&lt;-MSG</span><span class='period'>.</span><span class='id identifier rubyid_squish'>squish</span><span class='rparen'>)</span>
<span class='tstring_content'>    ActiveRecord::Base.source_macro is deprecated and will be removed
    without replacement.
</span><span class='heredoc_end'>  MSG
</span>
  <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_source_macro'>source_macro</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="source_options-instance_method">
  <h3 class='signature'>
  #<strong>source_options</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


824
825
826</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 824</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source_options'>source_options</span>
  <span class='id identifier rubyid_source_reflection'>source_reflection</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="source_reflection-instance_method">
  <h3 class='signature'>
  #<strong>source_reflection</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the source of the through reflection. It checks both a singularized
and pluralized form for <code>:belongs_to</code> or <code>:has_many</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:taggings</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:tags</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:taggings</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Tagging</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:post</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbol'>:tag</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_tags_reflection'>tags_reflection</span> <span class='op'>=</span> <span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_reflect_on_association'>reflect_on_association</span><span class='lparen'>(</span><span class='symbol'>:tags</span><span class='rparen'>)</span>
<span class='id identifier rubyid_tags_reflection'>tags_reflection</span><span class='period'>.</span><span class='id identifier rubyid_source_reflection'>source_reflection</span>
<span class='comment'># =&gt; &lt;ActiveRecord::Reflection::BelongsToReflection: @name=:tag, @active_record=Tagging, @plural_name=&quot;tags&quot;&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


670
671
672</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 670</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source_reflection'>source_reflection</span>
  <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid__reflect_on_association'>_reflect_on_association</span><span class='lparen'>(</span><span class='id identifier rubyid_source_reflection_name'>source_reflection_name</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="source_reflection_names-instance_method">
  <h3 class='signature'>
  #<strong>source_reflection_names</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Gets an array of possible <code>:through</code> source reflection names in
both singular and plural form.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:taggings</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:tags</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:taggings</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_tags_reflection'>tags_reflection</span> <span class='op'>=</span> <span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_reflect_on_association'>reflect_on_association</span><span class='lparen'>(</span><span class='symbol'>:tags</span><span class='rparen'>)</span>
<span class='id identifier rubyid_tags_reflection'>tags_reflection</span><span class='period'>.</span><span class='id identifier rubyid_source_reflection_names'>source_reflection_names</span>
<span class='comment'># =&gt; [:tag, :tags]
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


797
798
799</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 797</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source_reflection_names'>source_reflection_names</span>
  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_singularize'>singularize</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="through_options-instance_method">
  <h3 class='signature'>
  #<strong>through_options</strong>  
</h3>
<div class='source_code h'>
  <pre class='lines_num'>


828
829
830</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 828</span>

<span class='kw'>def</span> <span class='id identifier rubyid_through_options'>through_options</span>
  <span class='id identifier rubyid_through_reflection'>through_reflection</span><span class='period'>.</span><span class='id identifier rubyid_options'>options</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="through_reflection-instance_method">
  <h3 class='signature'>
  #<strong>through_reflection</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the AssociationReflection object specified in the
<code>:through</code> option of a HasManyThrough or HasOneThrough
association.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:taggings</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbol'>:tags</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbol'>:taggings</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_tags_reflection'>tags_reflection</span> <span class='op'>=</span> <span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_reflect_on_association'>reflect_on_association</span><span class='lparen'>(</span><span class='symbol'>:tags</span><span class='rparen'>)</span>
<span class='id identifier rubyid_tags_reflection'>tags_reflection</span><span class='period'>.</span><span class='id identifier rubyid_through_reflection'>through_reflection</span>
<span class='comment'># =&gt; &lt;ActiveRecord::Reflection::HasManyReflection: @name=:taggings, @active_record=Post, @plural_name=&quot;taggings&quot;&gt;
</span></code></pre>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


686
687
688</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/reflection.rb', line 686</span>

<span class='kw'>def</span> <span class='id identifier rubyid_through_reflection'>through_reflection</span>
  <span class='id identifier rubyid_active_record'>active_record</span><span class='period'>.</span><span class='id identifier rubyid__reflect_on_association'>_reflect_on_association</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:through</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.0 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>