<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Querying &mdash; Rails-4.2.7</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Querying",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-4.2.7</a> &raquo; 
          <a href='../_index.html'>Index (Q)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>Querying</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActiveRecord::Querying</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>




  <tr>
    <td class='box_1'>Included in:</td>
    <td><a href="Base.html" title="ActiveRecord::Base (class)">Base</a>
    </td>
  </tr>

  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/4-2-stable/activerecord/lib/active_record/querying.rb#L2'>activerecord/lib/active_record/querying.rb</a></div>  </td>
  </tr>
</table>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#count_by_sql-instance_method" title="#count_by_sql (instance method)">#<strong>count_by_sql</strong>(sql)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the result of an SQL statement that should only include a COUNT(*)
in the SELECT part.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#find_by_sql-instance_method" title="#find_by_sql (instance method)">#<strong>find_by_sql</strong>(sql, binds = [])  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Executes a custom SQL query against your database and returns all the
results.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="count_by_sql-instance_method">
  <h3 class='signature first'>
  #<strong>count_by_sql</strong>(sql)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the result of an SQL statement that should only include a COUNT(*)
in the SELECT part. The use of this method should be restricted to
complicated SQL queries that can&#39;t be executed using the
<a href="Calculations.html" title="ActiveRecord::Calculations (module)">Calculations</a> class methods. Look into those before using
this.</p>

<h6 id="label-Parameters-3A">Parameters:</h6>
<ul><li>
<p><code>sql</code> - An SQL statement which should return a count query from
the database, see the example below.</p>

<p>Product.count_by_sql “SELECT COUNT(*) FROM sales s, customers c WHERE
s.customer_id = c.id”</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/4-2-stable/activerecord/lib/active_record/querying.rb#L63'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


63
64
65
66</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_count_by_sql'>count_by_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_sql'>sql</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sql'>sql</span> <span class='op'>=</span> <span class='id identifier rubyid_sanitize_conditions'>sanitize_conditions</span><span class='lparen'>(</span><span class='id identifier rubyid_sql'>sql</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_select_value'>select_value</span><span class='lparen'>(</span><span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> Count</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="find_by_sql-instance_method">
  <h3 class='signature'>
  #<strong>find_by_sql</strong>(sql, binds = [])  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Executes a custom SQL query against your database and returns all the
results. The results will be returned as an array with columns requested
encapsulated as attributes of the model you call this method from. If you
call <code>Product.find_by_sql</code> then the results will be returned in
a <code>Product</code> object with the attributes you specified in the SQL
query.</p>

<p>If you call a complicated SQL query which spans multiple tables the columns
specified by the SELECT will be attributes of the model, whether or not
they are columns of the corresponding table.</p>

<p>The <code>sql</code> parameter is a full SQL query as a string. It will be
called as is, there will be no database agnostic conversions performed.
This should be a last resort because using, for example, MySQL specific
terms will lock you to using that particular database engine or require you
to change your call if you switch engines.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># A simple SQL query spanning multiple tables
</span><span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT p.title, c.author FROM posts p, comments c WHERE p.id = c.post_id</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'># =&gt; [#&lt;Post:0x36bff9c @attributes={&quot;title&quot;=&gt;&quot;Ruby Meetup&quot;, &quot;first_name&quot;=&gt;&quot;Quentin&quot;}&gt;, ...]
</span></code></pre>

<p>You can use the same string replacement techniques as you can with
<code>ActiveRecord::QueryMethods#where</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT title FROM posts WHERE author = ? AND created &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_author_id'>author_id</span><span class='comma'>,</span> <span class='id identifier rubyid_start_date'>start_date</span><span class='rbracket'>]</span>
<span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT body FROM comments WHERE author = :user_id OR approved_by = :user_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:user_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user_id'>user_id</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/4-2-stable/activerecord/lib/active_record/querying.rb#L38'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre>
  <div class='lines_code'>
<pre class='code ruby'
<span class='info file'># File 'activerecord/lib/active_record/querying.rb', line 38</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_set'>result_set</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_select_all'>select_all</span><span class='lparen'>(</span><span class='id identifier rubyid_sanitize_sql'>sanitize_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_sql'>sql</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> Load</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_binds'>binds</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_column_types'>column_types</span> <span class='op'>=</span> <span class='id identifier rubyid_result_set'>result_set</span><span class='period'>.</span><span class='id identifier rubyid_column_types'>column_types</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_columns_hash'>columns_hash</span><span class='period'>.</span><span class='id identifier rubyid_each_key'>each_key</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_column_types'>column_types</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_k'>k</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_message_bus'>message_bus</span> <span class='op'>=</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Notifications.html" title="ActiveSupport::Notifications (module)">Notifications</a></span><span class='period'>.</span><span class='id identifier rubyid_instrumenter'><a href="../ActiveSupport/Notifications.html#instrumenter-class_method" title="ActiveSupport::Notifications.instrumenter (method)">instrumenter</a></span>

  <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>record_count:</span> <span class='id identifier rubyid_result_set'>result_set</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span>
    <span class='label'>class_name:</span> <span class='id identifier rubyid_name'>name</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_message_bus'>message_bus</span><span class='period'>.</span><span class='id identifier rubyid_instrument'>instrument</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>instantiation.active_record</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_result_set'>result_set</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_instantiate'>instantiate</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>