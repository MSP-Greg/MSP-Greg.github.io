<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: LibXML::XML::XPath::Context &mdash; LibXML Ruby master</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "LibXML::XML::XPath::Context",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>LibXML</a> &raquo; 
      <a href='../../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../../LibXML.html" title="LibXML (module)">LibXML</a> &raquo; 
        <a href="../../XML.html" title="LibXML::XML (module)">XML</a> &raquo; 
        <a href="../XPath.html" title="LibXML::XML::XPath (module)">XPath</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Context&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: LibXML::XML::XPath::Context</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../../../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L349'>ext/libxml/ruby_xml_xpath_context.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L28'>ext/libxml/ruby_xml_xpath_context.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The <code>Context</code> class is used to evaluate <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> expressions.  Generally, you should not directly use this class, but instead use the <a href="../Document.html#find-instance_method" title="LibXML::XML::Document#find (method)">Document#find</a> and <a href="../Node.html#find-instance_method" title="LibXML::XML::Node#find (method)">Node#find</a> methods.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span> <span class='op'>=</span> <span class='const'><a href="../../XML.html" title="LibXML::XML (module)">XML</a></span><span class='op'>::</span><span class='const'><a href="../Document.html" title="LibXML::XML::Document (class)">Document</a></span>.<span class='id identifier rubyid_string'><a href="../Document.html#string-class_method" title="LibXML::XML::Document.string (method)">string</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;header&gt;content&lt;/header&gt;</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='const'><a href="../XPath.html" title="LibXML::XML::XPath (module)">XPath</a></span><span class='op'>::</span><span class='const'>Context</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="LibXML::XML::XPath::Context.new (method)">new</a></span>(<span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>)
<span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>.<span class='id identifier rubyid_root'><a href="../../../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span>
<span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_register_namespaces_from_node'><a href="#register_namespaces_from_node-instance_method" title="LibXML::XML::XPath::Context#register_namespaces_from_node (method)">register_namespaces_from_node</a></span>(<span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>.<span class='id identifier rubyid_root'><a href="../../../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span>)
<span class='id identifier rubyid_nodes'>nodes</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_find'><a href="#find-instance_method" title="LibXML::XML::XPath::Context#find (method)">find</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/header</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="XPath::Context.new (class method)"><strong>XPath::Context.new</strong>(doc)  &#x21d2; Context </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> context for the specified document.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature wo'>
      <a href="#node=-instance_method" title="#node= (instance method)">#<strong>node=</strong>(node)  </a>
    </span>
    <span class='note title writeonly'>writeonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Set the current node used by the <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> engine.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#disable_cache-instance_method" title="#disable_cache (instance method)">#<strong>disable_cache</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disables an XPath::Context’s built-in cache.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#doc-instance_method" title="#doc (instance method)">#<strong>doc</strong>  &#x21d2; document </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Obtain the <a href="../Document.html" title="LibXML::XML::Document (class)"><code>::LibXML::XML::Document</code></a> this node belongs to.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#enable_cache-instance_method" title="#enable_cache (instance method)">#<strong>enable_cache</strong>(size = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Enables an XPath::Context’s built-in cache.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find-instance_method" title="#find (instance method)">#<strong>find</strong>(&quot;xpath&quot;)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Executes the provided xpath function.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#register_namespace-instance_method" title="#register_namespace (instance method)">#<strong>register_namespace</strong>(prefix, uri)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Register the specified namespace URI with the specified prefix in this context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#register_namespaces-instance_method" title="#register_namespaces (instance method)">#<strong>register_namespaces</strong>([&quot;prefix:uri&quot;])  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Register the specified namespaces in this context.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#register_namespaces_from_node-instance_method" title="#register_namespaces_from_node (instance method)">#<strong>register_namespaces_from_node</strong>(node)  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Helper method to read in namespaces defined on a node.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    <strong>XPath::Context.new</strong>(doc)  &#x21d2; <code>Context</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> context for the specified document.  The context can then be used to evaluate an <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> expression.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span> <span class='op'>=</span> <span class='const'><a href="../../XML.html" title="LibXML::XML (module)">XML</a></span><span class='op'>::</span><span class='const'><a href="../Document.html" title="LibXML::XML::Document (class)">Document</a></span>.<span class='id identifier rubyid_string'><a href="../Document.html#string-class_method" title="LibXML::XML::Document.string (method)">string</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;header&gt;&lt;first&gt;hi&lt;/first&gt;&lt;/header&gt;</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='const'><a href="../XPath.html" title="LibXML::XML::XPath (module)">XPath</a></span><span class='op'>::</span><span class='const'>Context</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>)
<span class='id identifier rubyid_nodes'>nodes</span> <span class='op'>=</span> <span class='const'><a href="../XPath.html" title="LibXML::XML::XPath (module)">XPath</a></span><span class='op'>::</span><span class='const'><a href="Object.html" title="LibXML::XML::XPath::Object (class)">Object</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//first</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_context'>context</span>)
<span class='id identifier rubyid_nodes'>nodes</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L58-L71'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='58' data-end='71'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 58</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_initialize(VALUE self, VALUE document)
{
  xmlDocPtr xdoc;

  if (rb_obj_is_kind_of(document, cXMLDocument) != Qtrue)
  {
    rb_raise(rb_eTypeError, &quot;Supplied argument must be a document or node.&quot;);
  }

  Data_Get_Struct(document, xmlDoc, xdoc);
  DATA_PTR(self) = xmlXPathNewContext(xdoc);

  return self;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="node=-instance_method">
  <h3 class='signature wo first'>
    #<strong>node=</strong>(node)   <span class="extras">(<span class='writeonly'>writeonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Set the current node used by the <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> engine</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span> <span class='op'>=</span> <span class='const'><a href="../../XML.html" title="LibXML::XML (module)">XML</a></span><span class='op'>::</span><span class='const'><a href="../Document.html" title="LibXML::XML::Document (class)">Document</a></span>.<span class='id identifier rubyid_string'><a href="../Document.html#string-class_method" title="LibXML::XML::Document.string (method)">string</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;header&gt;&lt;first&gt;hi&lt;/first&gt;&lt;/header&gt;</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_node'>node</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>.<span class='id identifier rubyid_root'><a href="../../../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span>.<span class='id identifier rubyid_first'>first</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L250-L259'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='250' data-end='259'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 250</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_node_set(VALUE self, VALUE node)
{
  xmlXPathContextPtr xctxt;
  xmlNodePtr xnode;

  Data_Get_Struct(self, xmlXPathContext, xctxt);
  Data_Get_Struct(node, xmlNode, xnode);
  xctxt-&gt;node = xnode;
  return node;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="disable_cache-instance_method">
  <h3 class='signature  first'>
    #<strong>disable_cache</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Disables an XPath::Context’s built-in cache.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L334-L344'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='334' data-end='344'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 334</span></pre>
<pre class='code cpp'>

static VALUE
rxml_xpath_context_disable_cache(VALUE self)
{
  xmlXPathContextPtr xctxt;
  Data_Get_Struct(self, xmlXPathContext, xctxt);

  if (xmlXPathContextSetCache(xctxt, 0, 0, 0) == -1)
    rxml_raise(xmlGetLastError());

  return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="doc-instance_method">
  <h3 class='signature '>
    #<strong>doc</strong>  &#x21d2; <code>document</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Obtain the <a href="../Document.html" title="LibXML::XML::Document (class)"><code>::LibXML::XML::Document</code></a> this node belongs to.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L79-L87'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='79' data-end='87'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 79</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_doc(VALUE self)
{
  xmlDocPtr xdoc = NULL;
  xmlXPathContextPtr ctxt;
  Data_Get_Struct(self, xmlXPathContext, ctxt);
  
  xdoc = ctxt-&gt;doc;
  return rxml_document_wrap(xdoc);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="enable_cache-instance_method">
  <h3 class='signature '>
    #<strong>enable_cache</strong>(size = nil)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Enables an XPath::Context’s built-in cache.  If the cache is enabled then <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> objects will be cached internally for reuse. The size parameter controls sets the maximum number of <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> objects that will be cached per <a href="../XPath.html" title="LibXML::XML::XPath (module)"><code>::LibXML::XML::XPath</code></a> object type (node-set, string, number, boolean, and misc objects).  Set size to nil to use the default cache size of 100.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L308-L326'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='308' data-end='326'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 308</span></pre>
<pre class='code cpp'>

static VALUE
rxml_xpath_context_enable_cache(int argc,  VALUE *argv, VALUE self)
{
  xmlXPathContextPtr xctxt;
  VALUE size;
  int value = -1;

  Data_Get_Struct(self, xmlXPathContext, xctxt);

  if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;size) == 1)
  {
	  value = NUM2INT(size);
  }

  if (xmlXPathContextSetCache(xctxt, 1, value, 0) == -1)
    rxml_raise(xmlGetLastError());

  return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find-instance_method">
  <h3 class='signature '>
    #<strong>find</strong>(&quot;xpath&quot;)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Executes the provided xpath function.  The result depends on the execution of the xpath statement.  It may be true, false, a number, a string or a node set.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L269-L294'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='269' data-end='294'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 269</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_find(VALUE self, VALUE xpath_expr)
{
  xmlXPathContextPtr xctxt;
  xmlXPathObjectPtr xobject;
  xmlXPathCompExprPtr xcompexpr;

  Data_Get_Struct(self, xmlXPathContext, xctxt);

  if (TYPE(xpath_expr) == T_STRING)
  {
    VALUE expression = rb_check_string_type(xpath_expr);
    xobject = xmlXPathEval((xmlChar*) StringValueCStr(expression), xctxt);
  }
  else if (rb_obj_is_kind_of(xpath_expr, cXMLXPathExpression))
  {
    Data_Get_Struct(xpath_expr, xmlXPathCompExpr, xcompexpr);
    xobject = xmlXPathCompiledEval(xcompexpr, xctxt);
  }
  else
  {
    rb_raise(rb_eTypeError,
        &quot;Argument should be an instance of a String or XPath::Expression&quot;);
  }

  return rxml_xpath_to_value(xctxt, xobject);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="register_namespace-instance_method">
  <h3 class='signature '>
    #<strong>register_namespace</strong>(prefix, uri)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Register the specified namespace URI with the specified prefix in this context.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_register_namespace'>register_namespace</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xi</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.w3.org/2001/XInclude</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L98-L117'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='98' data-end='117'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 98</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_register_namespace(VALUE self, VALUE prefix, VALUE uri)
{
  xmlXPathContextPtr ctxt;
  Data_Get_Struct(self, xmlXPathContext, ctxt);

  /* Prefix could be a symbol. */
  prefix = rb_obj_as_string(prefix);
  
  if (xmlXPathRegisterNs(ctxt, (xmlChar*) StringValuePtr(prefix),
      (xmlChar*) StringValuePtr(uri)) == 0)
  {
    return (Qtrue);
  }
  else
  {
    /* Should raise an exception, IMHO (whose?, why shouldnt it? -danj)*/
    rb_warning(&quot;register namespace failed&quot;);
    return (Qfalse);
  }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="register_namespaces-instance_method">
  <h3 class='signature '>
    #<strong>register_namespaces</strong>([&quot;prefix:uri&quot;])  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Register the specified namespaces in this context.  There are three different forms that libxml accepts.  These include a string, an array of strings, or a hash table:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_register_namespaces'>register_namespaces</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xi:http://www.w3.org/2001/XInclude</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_register_namespaces'>register_namespaces</span>([<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xlink:http://www.w3.org/1999/xlink</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                             <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xi:http://www.w3.org/2001/XInclude</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_register_namespaces'>register_namespaces</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xlink</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.w3.org/1999/xlink</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                               <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xi</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://www.w3.org/2001/XInclude</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L196-L239'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='196' data-end='239'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 196</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_register_namespaces(VALUE self, VALUE nslist)
{
  char *cp;
  long i;
  VALUE rprefix, ruri;
  xmlXPathContextPtr xctxt;

  Data_Get_Struct(self, xmlXPathContext, xctxt);

  /* Need to loop through the 2nd argument and iterate through the
   * list of namespaces that we want to allow */
  switch (TYPE(nslist))
  {
  case T_STRING:
    cp = strchr(StringValuePtr(nslist), (int) &#39;:&#39;);
    if (cp == NULL)
    {
      rprefix = nslist;
      ruri = Qnil;
    }
    else
    {
      rprefix = rb_str_new(StringValuePtr(nslist), (long) ((intptr_t) cp - (intptr_t)StringValuePtr(nslist)));
      ruri = rxml_new_cstr((const xmlChar*)&amp;cp[1], xctxt-&gt;doc-&gt;encoding);
    }
    /* Should test the results of this */
    rxml_xpath_context_register_namespace(self, rprefix, ruri);
    break;
  case T_ARRAY:
    for (i = 0; i &lt; RARRAY_LEN(nslist); i++)
    {
      rxml_xpath_context_register_namespaces(self, RARRAY_PTR(nslist)[i]);
    }
    break;
  case T_HASH:
    rb_hash_foreach(nslist, iterate_ns_hash, self);
    break;
  default:
    rb_raise(
        rb_eArgError,
        &quot;Invalid argument type, only accept string, array of strings, or an array of arrays&quot;);
  }
  return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="register_namespaces_from_node-instance_method">
  <h3 class='signature '>
    #<strong>register_namespaces_from_node</strong>(node)  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Helper method to read in namespaces defined on a node.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span> <span class='op'>=</span> <span class='const'><a href="../../XML.html" title="LibXML::XML (module)">XML</a></span><span class='op'>::</span><span class='const'><a href="../Document.html" title="LibXML::XML::Document (class)">Document</a></span>.<span class='id identifier rubyid_string'><a href="../Document.html#string-class_method" title="LibXML::XML::Document.string (method)">string</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;header&gt;&lt;first&gt;hi&lt;/first&gt;&lt;/header&gt;</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='const'><a href="../XPath.html" title="LibXML::XML::XPath (module)">XPath</a></span><span class='op'>::</span><span class='const'>Context</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="LibXML::XML::XPath::Context.new (method)">new</a></span>(<span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>)
<span class='id identifier rubyid_context'>context</span>.<span class='id identifier rubyid_register_namespaces_from_node'>register_namespaces_from_node</span>(<span class='id identifier rubyid_doc'><a href="#doc-instance_method" title="LibXML::XML::XPath::Context#doc (method)">doc</a></span>.<span class='id identifier rubyid_root'><a href="../../../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/xml4r/libxml-ruby/blob/master/ext/libxml/ruby_xml_xpath_context.c#L128-L174'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='128' data-end='174'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/libxml/ruby_xml_xpath_context.c', line 128</span></pre>
<pre class='code cpp'>

static VALUE rxml_xpath_context_register_namespaces_from_node(VALUE self,
    VALUE node)
{
  xmlXPathContextPtr xctxt;
  xmlNodePtr xnode;
  xmlNsPtr *xnsArr;

  Data_Get_Struct(self, xmlXPathContext, xctxt);

  if (rb_obj_is_kind_of(node, cXMLDocument) == Qtrue)
  {
    xmlDocPtr xdoc;
    Data_Get_Struct(node, xmlDoc, xdoc);
    xnode = xmlDocGetRootElement(xdoc);
  }
  else if (rb_obj_is_kind_of(node, cXMLNode) == Qtrue)
  {
    Data_Get_Struct(node, xmlNode, xnode);
  }
  else
  {
    rb_raise(rb_eTypeError, &quot;The first argument must be a document or node.&quot;);
  }

  xnsArr = xmlGetNsList(xnode-&gt;doc, xnode);

  if (xnsArr)
  {
    xmlNsPtr xns = *xnsArr;

    while (xns)
    {
      /* If there is no prefix, then this is the default namespace.
       Skip it for now. */
      if (xns-&gt;prefix)
      {
        VALUE prefix = rxml_new_cstr(xns-&gt;prefix, xctxt-&gt;doc-&gt;encoding);
        VALUE uri = rxml_new_cstr(xns-&gt;href, xctxt-&gt;doc-&gt;encoding);
        rxml_xpath_context_register_namespace(self, prefix, uri);
      }
      xns = xns-&gt;next;
    }
    xmlFree(xnsArr);
  }

  return self;
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>