<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: README &mdash; SQLite3 main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "README",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>SQLite3 main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: README&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Ruby Interface for <a href="SQLite3.html" title="SQLite3 (module)"><code>SQLite3</code></a></h1>

<h2>Overview</h2>

<p>This library allows Ruby programs to use the <a href="SQLite3.html" title="SQLite3 (module)"><code>SQLite3</code></a> database engine (<a href="http://www.sqlite.org">http://www.sqlite.org</a>).</p>

<p>Note that this module is only compatible with SQLite 3.6.16 or newer.</p>

<ul>
<li>Source code: <a href="https://github.com/sparklemotion/sqlite3-ruby">https://github.com/sparklemotion/sqlite3-ruby</a></li>
<li>Mailing list: <a href="http://groups.google.com/group/sqlite3-ruby">http://groups.google.com/group/sqlite3-ruby</a></li>
<li>Download: <a href="http://rubygems.org/gems/sqlite3">http://rubygems.org/gems/sqlite3</a></li>
<li>Documentation: <a href="https://sparklemotion.github.io/sqlite3-ruby/">https://sparklemotion.github.io/sqlite3-ruby/</a></li>
</ul>

<p><a href="https://github.com/sparklemotion/sqlite3-ruby/actions/workflows/ci.yml"><img src="https://github.com/sparklemotion/sqlite3-ruby/actions/workflows/ci.yml/badge.svg" alt="Test suite"></a></p>

<h2>Quick start</h2>

<p>For help understanding the <a href="SQLite3.html" title="SQLite3 (module)"><code>SQLite3</code></a> Ruby API, please read the <a href="file.FAQ.html">FAQ</a> and the <a href="https://sparklemotion.github.io/sqlite3-ruby/">full API documentation</a>.</p>

<p>A few key classes whose APIs are often-used are:</p>

<ul>
<li><a href="SQLite3/Database.html" title="SQLite3::Database (class)"><code>::SQLite3::Database</code></a> (<a href="https://sparklemotion.github.io/sqlite3-ruby/SQLite3/Database.html">rdoc</a>)</li>
<li><a href="SQLite3/Statement.html" title="SQLite3::Statement (class)"><code>::SQLite3::Statement</code></a> (<a href="https://sparklemotion.github.io/sqlite3-ruby/SQLite3/Statement.html">rdoc</a>)</li>
<li><a href="SQLite3/ResultSet.html" title="SQLite3::ResultSet (class)"><code>::SQLite3::ResultSet</code></a> (<a href="https://sparklemotion.github.io/sqlite3-ruby/SQLite3/ResultSet.html">rdoc</a>)</li>
</ul>

<p>If you have any questions that you feel should be addressed in the FAQ, please send them to <a href="http://groups.google.com/group/sqlite3-ruby">the mailing list</a> or open a <a href="https://github.com/sparklemotion/sqlite3-ruby/discussions/categories/q-a">discussion thread</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sqlite3</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Open a database
</span><span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='const'><a href="SQLite3.html" title="SQLite3 (module)">SQLite3</a></span><span class='op'>::</span><span class='const'><a href="SQLite3/Database.html" title="SQLite3::Database (class)">Database</a></span>.<span class='id identifier rubyid_new'><a href="SQLite3/Database.html#new-class_method" title="SQLite3::Database.new (method)">new</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test.db</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Create a table
</span><span class='id identifier rubyid_rows'>rows</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span> <span class='heredoc_beg'>&lt;&lt;-SQL</span>
<span class='tstring_content'>  create table numbers (
    name varchar(30),
    val int
  );
</span><span class='heredoc_end'>SQL
</span>
<span class='comment'># Execute a few inserts
</span>{
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>one</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>two</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
}.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pair'>pair</span><span class='op'>|</span>
  <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>insert into numbers values ( ?, ? )</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_pair'>pair</span>
<span class='kw'>end</span>

<span class='comment'># Find a few rows
</span><span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span>( <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select * from numbers</span><span class='tstring_end'>&quot;</span></span> ) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_row'>row</span>
<span class='kw'>end</span>
<span class='comment'># =&gt; [&quot;one&quot;, 1]
</span><span class='comment'>#    [&quot;two&quot;, 2]
</span>
<span class='comment'># Create another table with multiple columns
</span><span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span> <span class='heredoc_beg'>&lt;&lt;-SQL</span>
<span class='tstring_content'>  create table students (
    name varchar(50),
    email varchar(50),
    grade varchar(5),
    blog varchar(50)
  );
</span><span class='heredoc_end'>SQL
</span>
<span class='comment'># Execute inserts with parameter markers
</span><span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO students (name, email, grade, blog)
            VALUES (?, ?, ?, ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jane</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>me@janedoe.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://blog.janedoe.com</span><span class='tstring_end'>&quot;</span></span>])

<span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span>( <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select * from students</span><span class='tstring_end'>&quot;</span></span> ) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_row'>row</span>
<span class='kw'>end</span>
<span class='comment'># =&gt; [&quot;Jane&quot;, &quot;me@janedoe.com&quot;, &quot;A&quot;, &quot;http://blog.janedoe.com&quot;]</span></code></pre>

<h2>Thread Safety</h2>

<p>When <a href="SQLite3.html#threadsafe%3F-class_method" title="SQLite3.threadsafe? (method)">SQLite3.threadsafe?</a> returns <code>true</code>, then SQLite3 has been compiled to
support running in a multithreaded environment.  However, this doesn&#39;t mean
that all classes in the SQLite3 gem can be considered &quot;thread safe&quot;.</p>

<p>When <a href="SQLite3.html#threadsafe%3F-class_method" title="SQLite3.threadsafe? (method)">SQLite3.threadsafe?</a> returns <code>true</code>, it is safe to share only
<a href="SQLite3/Database.html" title="SQLite3::Database (class)"><code>::SQLite3::Database</code></a> instances among threads without providing your own locking
mechanism.  For example, the following code is fine because only the database
instance is shared among threads:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sqlite3</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='const'><a href="SQLite3.html" title="SQLite3 (module)">SQLite3</a></span><span class='op'>::</span><span class='const'><a href="SQLite3/Database.html" title="SQLite3::Database (class)">Database</a></span>.<span class='id identifier rubyid_new'><a href="SQLite3/Database.html#new-class_method" title="SQLite3::Database.new (method)">new</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:memory:</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_latch'>latch</span> <span class='op'>=</span> <span class='const'>Queue</span>.<span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='int'>10</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> {
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> {
    <span class='id identifier rubyid_latch'>latch</span>.<span class='id identifier rubyid_pop'>pop</span>
    <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT &#39;</span><span class='embexpr_beg'>#{</span><span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
  }
}
<span class='int'>10</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_latch'>latch</span> <span class='op'>&lt;&lt;</span> <span class='kw'>nil</span> }

<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ts'>ts</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>)</code></pre>

<p>Other instances can be shared among threads, but they require that you provide
your own locking for thread safety.  For example, <a href="SQLite3/Statement.html" title="SQLite3::Statement (class)"><code>::SQLite3::Statement</code></a> objects
(prepared statements) are mutable, so applications must take care to add
appropriate locks to avoid data race conditions when sharing these objects
among threads.</p>

<p>Lets rewrite the above example but use a prepared statement and safely share
the prepared statement among threads:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='const'><a href="SQLite3.html" title="SQLite3 (module)">SQLite3</a></span><span class='op'>::</span><span class='const'><a href="SQLite3/Database.html" title="SQLite3::Database (class)">Database</a></span>.<span class='id identifier rubyid_new'><a href="SQLite3/Database.html#new-class_method" title="SQLite3::Database.new (method)">new</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:memory:</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Prepare a statement
</span><span class='id identifier rubyid_stmt'>stmt</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_prepare'>prepare</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT :inspect</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_stmt_lock'>stmt_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span>.<span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_latch'>latch</span> <span class='op'>=</span> <span class='const'>Queue</span>.<span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='int'>10</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> {
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> {
    <span class='id identifier rubyid_latch'>latch</span>.<span class='id identifier rubyid_pop'>pop</span>

    <span class='comment'># Add a lock when using the prepared statement.
</span>    <span class='comment'># Binding values, and walking over results will mutate the statement, so
</span>    <span class='comment'># in order to prevent other threads from &quot;seeing&quot; this thread&#39;s data, we
</span>    <span class='comment'># must lock when using the statement object
</span>    <span class='id identifier rubyid_stmt_lock'>stmt_lock</span>.<span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_stmt'>stmt</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>.<span class='id identifier rubyid_inspect'>inspect</span>).<span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>
  }
}

<span class='int'>10</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_latch'>latch</span> <span class='op'>&lt;&lt;</span> <span class='kw'>nil</span> }

<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ts'>ts</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>)

<span class='id identifier rubyid_stmt'>stmt</span>.<span class='id identifier rubyid_close'>close</span></code></pre>

<p>It is generally recommended that if applications want to share a database among
threads, they <em>only</em> share the database instance object.  Other objects are
fine to share, but may require manual locking for thread safety.</p>

<h2>Fork Safety</h2>

<p><a href="https://www.sqlite.org/howtocorrupt.html#_carrying_an_open_database_connection_across_a_fork_">Sqlite is not fork
safe</a>
and instructs users to not carry an open writable database connection across a <code>fork()</code>. Using an inherited
connection in the child may corrupt your database, leak memory, or cause other undefined behavior.</p>

<p>To help protect users of this gem from accidental corruption due to this lack of fork safety, the gem will immediately close any open writable databases in the child after a fork. Discarding writable
connections in the child will incur a small one-time memory leak per connection, but that&#39;s
preferable to potentially corrupting your database.</p>

<p>Whenever possible, close writable connections in the parent before forking. If absolutely necessary (and you know what you&#39;re doing), you may suppress the fork safety warnings by calling <a href="SQLite3/ForkSafety.html#suppress_warnings!-class_method" title="SQLite3::ForkSafety.suppress_warnings! (method)">SQLite3::ForkSafety.suppress_warnings!</a>.</p>

<p>See <a href="file.2024-09-fork-safety.html">./adr/2024-09-fork-safety.md</a> for more information and context.</p>

<h2>Support</h2>

<h3>Installation or database extensions</h3>

<p>If you&#39;re having trouble with installation, please first read <a href="file.INSTALLATION.html"><code>INSTALLATION.md</code></a>.</p>

<h3>General help requests</h3>

<p>You can ask for help or support:</p>

<ul>
<li>by emailing the <a href="http://groups.google.com/group/sqlite3-ruby">sqlite3-ruby mailing list</a></li>
<li>by opening a <a href="https://github.com/sparklemotion/sqlite3-ruby/discussions/categories/q-a">discussion thread</a> on Github</li>
</ul>

<h3>Bug reports</h3>

<p>You can file the bug at the <a href="https://github.com/sparklemotion/sqlite3-ruby/issues">github issues page</a>.</p>

<h2>Contributing</h2>

<p>See <a href="file.CONTRIBUTING.html"><code>CONTRIBUTING.md</code></a>.</p>

<h2>License</h2>

<p>This library is licensed under <code>BSD-3-Clause</code>, see <a href="./LICENSE"><code>LICENSE</code></a>.</p>

<h3>Dependencies</h3>

<p>The source code of <code>sqlite</code> is distributed in the &quot;ruby platform&quot; gem. This code is public domain,
see <a href="https://www.sqlite.org/copyright.html">https://www.sqlite.org/copyright.html</a> for details.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>