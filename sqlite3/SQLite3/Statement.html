<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: SQLite3::Statement &mdash; SQLite3 main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "SQLite3::Statement",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>SQLite3 main</a> &raquo; 
      <a href='../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../SQLite3.html" title="SQLite3 (module)">SQLite3</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Statement&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: SQLite3::Statement</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          Enumerable
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L14'>lib/sqlite3/statement.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/backup.c#L112'>ext/sqlite3/backup.c</a>,<br/> <a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/database.c#L126'>ext/sqlite3/database.c</a>,<br/> <a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L641'>ext/sqlite3/statement.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>A statement represents a prepared-but-unexecuted SQL query. It will rarely (if ever) be instantiated directly by a client, and is most often obtained via the <a href="Database.html#prepare-instance_method" title="SQLite3::Database#prepare (method)">Database#prepare</a> method.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(db, sql)  &#x21d2; Statement </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new statement attached to the given <a href="Database.html" title="SQLite3::Database (class)"><code>Database</code></a> instance, and which encapsulates the given SQL text.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#active%3F-instance_method" title="#active? (instance method)">#<strong>active?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if the statement is currently active, meaning it has an open result set.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#closed%3F-instance_method" title="#closed? (instance method)">#<strong>closed?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="Database.html#closed%3F-instance_method" title="SQLite3::Database#closed? (method)">Database#closed?</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#done%3F-instance_method" title="#done? (instance method)">#<strong>done?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>returns true if all rows have been returned.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#remainder-instance_method" title="#remainder (instance method)">#<strong>remainder</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>This is any text that followed the first valid SQL statement in the text with which the statement was initialized.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#bind_param-instance_method" title="#bind_param (instance method)">#<strong>bind_param</strong>(key, value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Binds value to the named (or positional) placeholder.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#bind_parameter_count-instance_method" title="#bind_parameter_count (instance method)">#<strong>bind_parameter_count</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the number of bind parameters.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#bind_params-instance_method" title="#bind_params (instance method)">#<strong>bind_params</strong>(*bind_vars)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Binds the given variables to the corresponding placeholders in the SQL text.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#clear_bindings!-instance_method" title="#clear_bindings! (instance method)">#<strong>clear_bindings!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Resets the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="Database.html#close-instance_method" title="SQLite3::Database#close (method)">Database#close</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#column_count-instance_method" title="#column_count (instance method)">#<strong>column_count</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the number of columns to be returned for this statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#column_decltype-instance_method" title="#column_decltype (instance method)">#<strong>column_decltype</strong>(index)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the column type at <code>index</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#column_name-instance_method" title="#column_name (instance method)">#<strong>column_name</strong>(index)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the column name at <code>index</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#columns-instance_method" title="#columns (instance method)">#<strong>columns</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return an array of the column names for this statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#database_name-instance_method" title="#database_name (instance method)">#<strong>database_name</strong>(column_index)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the database name for the column at <code>column_index</code></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#execute-instance_method" title="#execute (instance method)">#<strong>execute</strong>(*bind_vars) {|results| ... } </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#execute!-instance_method" title="#execute! (instance method)">#<strong>execute!</strong>(*bind_vars, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Execute the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#expanded_sql-instance_method" title="#expanded_sql (instance method)">#<strong>expanded_sql</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the SQL statement used to create this prepared statement, but with bind parameters substituted in to the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#memused-instance_method" title="#memory_used (instance method)">#<strong>memory_used</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the approximate number of bytes of heap memory used to store the prepared statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset!-instance_method" title="#reset! (instance method)">#<strong>reset!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Resets the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sql-instance_method" title="#sql (instance method)">#<strong>sql</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the SQL statement used to create this prepared statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stat-instance_method" title="#stat (instance method)">#<strong>stat</strong>(key = nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a Hash containing information about the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#step-instance_method" title="#step (instance method)">#<strong>step</strong>(nPage)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="Backup.html#step-instance_method" title="SQLite3::Backup#step (method)">Backup#step</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#types-instance_method" title="#types (instance method)">#<strong>types</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return an array of the data types for each column in this statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#get_metadata-instance_method" title="#get_metadata (instance method)">#<strong>get_metadata</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>A convenience method for obtaining the metadata about the query.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#prepare-instance_method" title="#prepare (instance method)">#<strong>prepare</strong>(db, sql)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#stat_for-instance_method" title="#stmt_stat (instance method)">#<strong>stmt_stat</strong>(hash_or_key)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a Hash containing information about the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#stats_as_hash-instance_method" title="#stats_as_hash (instance method)">#<strong>stats_as_hash</strong>(hash)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a Hash containing information about the statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#must_be_open!-instance_method" title="#must_be_open! (instance method)">#<strong>must_be_open!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Performs a sanity check to ensure that the statement is not closed.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(db, sql)  &#x21d2; <code>Statement</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new statement attached to the given <a href="Database.html" title="SQLite3::Database (class)"><code>Database</code></a> instance, and which encapsulates the given SQL text. If the text contains more than one statement (i.e., separated by semicolons), then the <a href="#remainder-instance_method" title="SQLite3::Statement#remainder (method)">#remainder</a> property will be set to the trailing text.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L28-L37'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='28' data-end='37'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 28</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_sql'><a href="#sql-instance_method" title="SQLite3::Statement#sql (method)">sql</a></span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prepare called on a closed database</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="SQLite3::Statement#closed? (method)">closed?</a></span>

  <span class='id identifier rubyid_sql'><a href="#sql-instance_method" title="SQLite3::Statement#sql (method)">sql</a></span> <span class='op'>=</span> <span class='id identifier rubyid_sql'><a href="#sql-instance_method" title="SQLite3::Statement#sql (method)">sql</a></span>.<span class='id identifier rubyid_encode'>encode</span>(<span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span>) <span class='kw'>if</span> <span class='id identifier rubyid_sql'><a href="#sql-instance_method" title="SQLite3::Statement#sql (method)">sql</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sql'><a href="#sql-instance_method" title="SQLite3::Statement#sql (method)">sql</a></span>.<span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>!=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span>

  <span class='ivar'>@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span>
  <span class='ivar'>@columns</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@types</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@remainder</span> <span class='op'>=</span> <span class='id identifier rubyid_prepare'><a href="#prepare-instance_method" title="SQLite3::Statement#prepare (method)">prepare</a></span> <span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_sql'><a href="#sql-instance_method" title="SQLite3::Statement#sql (method)">sql</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="active?-instance_method">
  <h3 class='signature ro first'>
    #<strong>active?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if the statement is currently active, meaning it has an open result set.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L111-L113'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='111' data-end='113'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_active?'>active?</span>
  <span class='op'>!</span><span class='id identifier rubyid_done?'><a href="#done%3F-instance_method" title="SQLite3::Statement#done? (method)">done?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="closed?-instance_method">
  <h3 class='signature ro'>
    #<strong>closed?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="Database.html#closed%3F-instance_method" title="SQLite3::Database#closed? (method)">Database#closed?</a>.</p>

  </div>
</div>

</section>

<section class='method_details' id="done?-instance_method">
  <h3 class='signature ro'>
    #<strong>done?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>returns true if all rows have been returned.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L344-L352'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='344' data-end='352'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 344</span></pre>
<pre class='code cpp'>

static VALUE
done_p(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);

    if (ctx-&gt;done_p) { return Qtrue; }
    return Qfalse;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remainder-instance_method">
  <h3 class='signature ro'>
    #<strong>remainder</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This is any text that followed the first valid SQL statement in the text with which the statement was initialized. If there was no trailing text, this will be the empty string.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L20-L20'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='20' data-end='20'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 20</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_remainder'>remainder</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="bind_param-instance_method">
  <h3 class='signature  first'>
    #<strong>bind_param</strong>(key, value)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Binds value to the named (or positional) placeholder. If <code>param</code> is a Fixnum, it is treated as an index for a positional placeholder. Otherwise it is used as the name of the placeholder to bind to.</p>

<p>See also <a href="#bind_params-instance_method" title="SQLite3::Statement#bind_params (method)">#bind_params</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L211-L298'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='211' data-end='298'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 211</span></pre>
<pre class='code cpp'>

static VALUE
bind_param(VALUE self, VALUE key, VALUE value)
{
    sqlite3StmtRubyPtr ctx;
    int status;
    int index;

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    switch (TYPE(key)) {
        case T_SYMBOL:
            key = rb_funcall(key, rb_intern(&quot;to_s&quot;), 0);
        case T_STRING:
            if (RSTRING_PTR(key)[0] != &#39;:&#39;) { key = rb_str_plus(rb_str_new2(&quot;:&quot;), key); }
            index = sqlite3_bind_parameter_index(ctx-&gt;st, StringValuePtr(key));
            break;
        default:
            index = (int)NUM2INT(key);
    }

    if (index == 0) {
        rb_raise(rb_path2class(&quot;SQLite3::Exception&quot;), &quot;no such bind parameter&quot;);
    }

    switch (TYPE(value)) {
        case T_STRING:
            if (CLASS_OF(value) == cSqlite3Blob
                    || rb_enc_get_index(value) == rb_ascii8bit_encindex()
               ) {
                status = sqlite3_bind_blob(
                             ctx-&gt;st,
                             index,
                             (const char *)StringValuePtr(value),
                             (int)RSTRING_LEN(value),
                             SQLITE_TRANSIENT
                         );
            } else {


                if (UTF16_LE_P(value) || UTF16_BE_P(value)) {
                    status = sqlite3_bind_text16(
                                 ctx-&gt;st,
                                 index,
                                 (const char *)StringValuePtr(value),
                                 (int)RSTRING_LEN(value),
                                 SQLITE_TRANSIENT
                             );
                } else {
                    if (!UTF8_P(value) || !USASCII_P(value)) {
                        value = rb_str_encode(value, rb_enc_from_encoding(rb_utf8_encoding()), 0, Qnil);
                    }
                    status = sqlite3_bind_text(
                                 ctx-&gt;st,
                                 index,
                                 (const char *)StringValuePtr(value),
                                 (int)RSTRING_LEN(value),
                                 SQLITE_TRANSIENT
                             );
                }
            }
            break;
        case T_BIGNUM: {
            sqlite3_int64 num64;
            if (bignum_to_int64(value, &amp;num64)) {
                status = sqlite3_bind_int64(ctx-&gt;st, index, num64);
                break;
            }
        }
        case T_FLOAT:
            status = sqlite3_bind_double(ctx-&gt;st, index, NUM2DBL(value));
            break;
        case T_FIXNUM:
            status = sqlite3_bind_int64(ctx-&gt;st, index, (sqlite3_int64)FIX2LONG(value));
            break;
        case T_NIL:
            status = sqlite3_bind_null(ctx-&gt;st, index);
            break;
        default:
            rb_raise(rb_eRuntimeError, &quot;can&#39;t prepare %s&quot;,
                     rb_class2name(CLASS_OF(value)));
            break;
    }

    CHECK(sqlite3_db_handle(ctx-&gt;st), status);

    return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="bind_parameter_count-instance_method">
  <h3 class='signature '>
    #<strong>bind_parameter_count</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the number of bind parameters</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L429-L437'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='429' data-end='437'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 429</span></pre>
<pre class='code cpp'>

static VALUE
bind_parameter_count(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    return INT2NUM(sqlite3_bind_parameter_count(ctx-&gt;st));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="bind_params-instance_method">
  <h3 class='signature '>
    #<strong>bind_params</strong>(*bind_vars)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Binds the given variables to the corresponding placeholders in the SQL text.</p>

<p>See <a href="Database.html#execute-instance_method" title="SQLite3::Database#execute (method)">Database#execute</a> for a description of the valid placeholder syntaxes.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stmt'>stmt</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_prepare'><a href="#prepare-instance_method" title="SQLite3::Statement#prepare (method)">prepare</a></span>( <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select * from table where a=? and b=?</span><span class='tstring_end'>&quot;</span></span> )
<span class='id identifier rubyid_stmt'>stmt</span>.<span class='id identifier rubyid_bind_params'>bind_params</span>( <span class='int'>15</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span> )</code></pre>

<p>See also <a href="#execute-instance_method" title="SQLite3::Statement#execute (method)">#execute</a>, <a href="#bind_param-instance_method" title="SQLite3::Statement#bind_param (method)">#bind_param</a>, <a href="#bind_param-instance_method" title="SQLite3::Statement#bind_param (method)">#bind_param</a>, and <code>#bind_params</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L52-L62'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='52' data-end='62'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 52</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_bind_params'>bind_params</span>(<span class='op'>*</span><span class='id identifier rubyid_bind_vars'>bind_vars</span>)
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_bind_vars'>bind_vars</span>.<span class='id identifier rubyid_flatten'>flatten</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="SQLite3::Statement#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_var'>var</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_var'>var</span>
      <span class='id identifier rubyid_var'>var</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="SQLite3::Statement#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_bind_param'><a href="#bind_param-instance_method" title="SQLite3::Statement#bind_param (method)">bind_param</a></span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> }
    <span class='kw'>else</span>
      <span class='id identifier rubyid_bind_param'><a href="#bind_param-instance_method" title="SQLite3::Statement#bind_param (method)">bind_param</a></span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_var'>var</span>
      <span class='id identifier rubyid_index'>index</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear_bindings!-instance_method">
  <h3 class='signature '>
    #<strong>clear_bindings!</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Resets the statement. This is typically done internally, though it might occasionally be necessary to manually reset the statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L325-L338'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='325' data-end='338'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 325</span></pre>
<pre class='code cpp'>

static VALUE
clear_bindings_bang(VALUE self)
{
    sqlite3StmtRubyPtr ctx;

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    sqlite3_clear_bindings(ctx-&gt;st);

    ctx-&gt;done_p = 0;

    return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature '>
    #<strong>close</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="Database.html#close-instance_method" title="SQLite3::Database#close (method)">Database#close</a>.</p>

  </div>
</div>

</section>

<section class='method_details' id="column_count-instance_method">
  <h3 class='signature '>
    #<strong>column_count</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the number of columns to be returned for this statement</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L358-L366'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='358' data-end='366'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 358</span></pre>
<pre class='code cpp'>

static VALUE
column_count(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    return INT2NUM(sqlite3_column_count(ctx-&gt;st));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="column_decltype-instance_method">
  <h3 class='signature '>
    #<strong>column_decltype</strong>(index)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the column type at <code>index</code>.  0 based.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L410-L423'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='410' data-end='423'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 410</span></pre>
<pre class='code cpp'>

static VALUE
column_decltype(VALUE self, VALUE index)
{
    sqlite3StmtRubyPtr ctx;
    const char *name;

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    name = sqlite3_column_decltype(ctx-&gt;st, (int)NUM2INT(index));

    if (name) { return rb_str_new2(name); }
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="column_name-instance_method">
  <h3 class='signature '>
    #<strong>column_name</strong>(index)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the column name at <code>index</code>.  0 based.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L387-L404'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='387' data-end='404'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 387</span></pre>
<pre class='code cpp'>

static VALUE
column_name(VALUE self, VALUE index)
{
    sqlite3StmtRubyPtr ctx;
    const char *name;

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    name = sqlite3_column_name(ctx-&gt;st, (int)NUM2INT(index));

    VALUE ret = Qnil;

    if (name) {
        ret = interned_utf8_cstr(name);
    }
    return ret;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="columns-instance_method">
  <h3 class='signature '>
    #<strong>columns</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return an array of the column names for this statement. Note that this may execute the statement in order to obtain the metadata; this makes it a (potentially) expensive operation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L118-L121'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='118' data-end='121'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_columns'>columns</span>
  <span class='id identifier rubyid_get_metadata'><a href="#get_metadata-instance_method" title="SQLite3::Statement#get_metadata (method)">get_metadata</a></span> <span class='kw'>unless</span> <span class='ivar'>@columns</span>
  <span class='ivar'>@columns</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="database_name-instance_method">
  <h3 class='signature '>
    #<strong>database_name</strong>(column_index)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the database name for the column at <code>column_index</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L589-L598'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='589' data-end='598'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 589</span></pre>
<pre class='code cpp'>

static VALUE
database_name(VALUE self, VALUE index)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    return SQLITE3_UTF8_STR_NEW2(
               sqlite3_column_database_name(ctx-&gt;st, NUM2INT(index)));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each-instance_method">
  <h3 class='signature '>
    #<strong>each</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L123-L129'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='123' data-end='129'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 123</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="SQLite3::Statement#step (method)">step</a></span>
    <span class='kw'>break</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='id identifier rubyid_done?'><a href="#done%3F-instance_method" title="SQLite3::Statement#done? (method)">done?</a></span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute-instance_method">
  <h3 class='signature '>
    #<strong>execute</strong>(*bind_vars) {|results| ... } 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute the statement. This creates a new <a href="ResultSet.html" title="SQLite3::ResultSet (class)"><code>ResultSet</code></a> object for the statement’s virtual machine. If a block was given, the new <a href="ResultSet.html" title="SQLite3::ResultSet (class)"><code>ResultSet</code></a> will be yielded to it; otherwise, the <a href="ResultSet.html" title="SQLite3::ResultSet (class)"><code>ResultSet</code></a> will be returned.</p>

<p>Any parameters will be bound to the statement using <a href="#bind_params-instance_method" title="SQLite3::Statement#bind_params (method)">#bind_params</a>.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stmt'>stmt</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_prepare'><a href="#prepare-instance_method" title="SQLite3::Statement#prepare (method)">prepare</a></span>( <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select * from table</span><span class='tstring_end'>&quot;</span></span> )
<span class='id identifier rubyid_stmt'>stmt</span>.<span class='id identifier rubyid_execute'>execute</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
  <span class='comment'>#...
</span><span class='kw'>end</span></code></pre>

<p>See also <a href="#bind_params-instance_method" title="SQLite3::Statement#bind_params (method)">#bind_params</a>, <a href="#execute!-instance_method" title="SQLite3::Statement#execute! (method)">#execute!</a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Yields:</p>
<ul class='yield'>
  <li>
    <span class='type'>(<code>results</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L78-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='78' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 78</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span>(<span class='op'>*</span><span class='id identifier rubyid_bind_vars'>bind_vars</span>)
  <span class='id identifier rubyid_reset!'><a href="#reset!-instance_method" title="SQLite3::Statement#reset! (method)">reset!</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_active?'><a href="#active%3F-instance_method" title="SQLite3::Statement#active? (method)">active?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_done?'><a href="#done%3F-instance_method" title="SQLite3::Statement#done? (method)">done?</a></span>

  <span class='id identifier rubyid_bind_params'><a href="#bind_params-instance_method" title="SQLite3::Statement#bind_params (method)">bind_params</a></span>(<span class='op'>*</span><span class='id identifier rubyid_bind_vars'>bind_vars</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_bind_vars'>bind_vars</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='ivar'>@connection</span>.<span class='id identifier rubyid_build_result_set'>build_result_set</span> <span class='kw'>self</span>

  <span class='id identifier rubyid_step'><a href="#step-instance_method" title="SQLite3::Statement#step (method)">step</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_column_count'><a href="#column_count-instance_method" title="SQLite3::Statement#column_count (method)">column_count</a></span> <span class='op'>==</span> <span class='int'>0</span>

  <span class='kw'>yield</span> <span class='id identifier rubyid_results'>results</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="execute!-instance_method">
  <h3 class='signature '>
    #<strong>execute!</strong>(*bind_vars, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Execute the statement. If no block was given, this returns an array of rows returned by executing the statement. Otherwise, each row will be yielded to the block.</p>

<p>Any parameters will be bound to the statement using <a href="#bind_params-instance_method" title="SQLite3::Statement#bind_params (method)">#bind_params</a>.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stmt'>stmt</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span>.<span class='id identifier rubyid_prepare'><a href="#prepare-instance_method" title="SQLite3::Statement#prepare (method)">prepare</a></span>( <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select * from table</span><span class='tstring_end'>&quot;</span></span> )
<span class='id identifier rubyid_stmt'>stmt</span>.<span class='id identifier rubyid_execute!'>execute!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='comment'>#...
</span><span class='kw'>end</span></code></pre>

<p>See also <a href="#bind_params-instance_method" title="SQLite3::Statement#bind_params (method)">#bind_params</a>, <a href="#execute-instance_method" title="SQLite3::Statement#execute (method)">#execute</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L104-L107'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='104' data-end='107'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 104</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_execute!'>execute!</span>(<span class='op'>*</span><span class='id identifier rubyid_bind_vars'>bind_vars</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_execute'><a href="#execute-instance_method" title="SQLite3::Statement#execute (method)">execute</a></span>(<span class='op'>*</span><span class='id identifier rubyid_bind_vars'>bind_vars</span>)
  <span class='id identifier rubyid_block'>block</span> <span class='op'>?</span> <span class='id identifier rubyid_each'><a href="#each-instance_method" title="SQLite3::Statement#each (method)">each</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='op'>:</span> <span class='id identifier rubyid_to_a'>to_a</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="expanded_sql-instance_method">
  <h3 class='signature '>
    #<strong>expanded_sql</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the SQL statement used to create this prepared statement, but with bind parameters substituted in to the statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L621-L636'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='621' data-end='636'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 621</span></pre>
<pre class='code cpp'>

static VALUE
get_expanded_sql(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    char *expanded_sql;
    VALUE rb_expanded_sql;

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    expanded_sql = sqlite3_expanded_sql(ctx-&gt;st);
    rb_expanded_sql = rb_obj_freeze(SQLITE3_UTF8_STR_NEW2(expanded_sql));
    sqlite3_free(expanded_sql);

    return rb_expanded_sql;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_metadata-instance_method">
  <h3 class='signature priv'>
    #<strong>get_metadata</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A convenience method for obtaining the metadata about the query. Note that this will actually execute the SQL, which means it can be a (potentially) expensive operation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L180-L188'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='180' data-end='188'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 180</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_metadata'>get_metadata</span>
  <span class='ivar'>@columns</span> <span class='op'>=</span> <span class='const'>Array</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="SQLite3::Statement.new (method)">new</a></span>(<span class='id identifier rubyid_column_count'><a href="#column_count-instance_method" title="SQLite3::Statement#column_count (method)">column_count</a></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span>
    <span class='id identifier rubyid_column_name'><a href="#column_name-instance_method" title="SQLite3::Statement#column_name (method)">column_name</a></span> <span class='id identifier rubyid_column'>column</span>
  <span class='kw'>end</span>
  <span class='ivar'>@types</span> <span class='op'>=</span> <span class='const'>Array</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="SQLite3::Statement.new (method)">new</a></span>(<span class='id identifier rubyid_column_count'><a href="#column_count-instance_method" title="SQLite3::Statement#column_count (method)">column_count</a></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='op'>|</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_column_decltype'><a href="#column_decltype-instance_method" title="SQLite3::Statement#column_decltype (method)">column_decltype</a></span>(<span class='id identifier rubyid_column'>column</span>)
    <span class='id identifier rubyid_val'>val</span><span class='op'>&amp;.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="memused-instance_method">
  <h3 class='signature '>
    #<strong>memory_used</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the approximate number of bytes of heap memory used to store the prepared statement</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L572-L580'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='572' data-end='580'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 572</span></pre>
<pre class='code cpp'>

static VALUE
memused(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    return INT2NUM(sqlite3_stmt_status(ctx-&gt;st, SQLITE_STMTSTATUS_MEMUSED, 0));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="must_be_open!-instance_method">
  <h3 class='signature nodoc'>
    #<strong>must_be_open!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Performs a sanity check to ensure that the statement is not closed. If it is, an exception is raised.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L142-L146'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='142' data-end='146'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 142</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_must_be_open!'>must_be_open!</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_closed?'><a href="#closed%3F-instance_method" title="SQLite3::Statement#closed? (method)">closed?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../SQLite3.html" title="SQLite3 (module)">SQLite3</a></span><span class='op'>::</span><span class='const'><a href="Exception.html" title="SQLite3::Exception (class)">Exception</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot use a closed statement</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="prepare-instance_method">
  <h3 class='signature priv'>
    #<strong>prepare</strong>(db, sql)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L48-L85'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='48' data-end='85'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 48</span></pre>
<pre class='code cpp'>

static VALUE
prepare(VALUE self, VALUE db, VALUE sql)
{
    sqlite3RubyPtr db_ctx = sqlite3_database_unwrap(db);
    sqlite3StmtRubyPtr ctx;
    const char *tail = NULL;
    int status;

    StringValue(sql);

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);

#ifdef HAVE_SQLITE3_PREPARE_V2
    status = sqlite3_prepare_v2(
#else
    status = sqlite3_prepare(
#endif
                 db_ctx-&gt;db,
                 (const char *)StringValuePtr(sql),
                 (int)RSTRING_LEN(sql),
                 &amp;ctx-&gt;st,
                 &amp;tail
             );

    CHECK(db_ctx-&gt;db, status);
    timespecclear(&amp;db_ctx-&gt;stmt_deadline);

    return rb_str_new2(tail);
}

/* call-seq: stmt.close
 *
 * Closes the statement by finalizing the underlying statement
 * handle. The statement must not be used after being closed.
 */
static VALUE
sqlite3_rb_close(VALUE self)
{
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset!-instance_method">
  <h3 class='signature '>
    #<strong>reset!</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Resets the statement. This is typically done internally, though it might occasionally be necessary to manually reset the statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L305-L318'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='305' data-end='318'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 305</span></pre>
<pre class='code cpp'>

static VALUE
reset_bang(VALUE self)
{
    sqlite3StmtRubyPtr ctx;

    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    sqlite3_reset(ctx-&gt;st);

    ctx-&gt;done_p = 0;

    return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sql-instance_method">
  <h3 class='signature '>
    #<strong>sql</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the SQL statement used to create this prepared statement</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L606-L614'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='606' data-end='614'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 606</span></pre>
<pre class='code cpp'>

static VALUE
get_sql(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    return rb_obj_freeze(SQLITE3_UTF8_STR_NEW2(sqlite3_sql(ctx-&gt;st)));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stat-instance_method">
  <h3 class='signature '>
    #<strong>stat</strong>(key = nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a Hash containing information about the statement. The contents of the hash are implementation specific and may change in the future without notice. The hash includes information about internal statistics about the statement such as:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span> <span class='id identifier rubyid_fullscan_steps'>fullscan_steps</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_times'>times</span> <span class='id identifier rubyid_that'>that</span> <span class='const'>SQLite</span> <span class='id identifier rubyid_has'>has</span> <span class='id identifier rubyid_stepped'>stepped</span> <span class='id identifier rubyid_forward'>forward</span></code></pre>

<p>in a table as part of a full table scan</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span> <span class='id identifier rubyid_sorts'>sorts</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_sort'>sort</span> <span class='id identifier rubyid_operations'>operations</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_have'>have</span> <span class='id identifier rubyid_occurred'>occurred</span>
<span class='op'>-</span> <span class='id identifier rubyid_autoindexes'>autoindexes</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_rows'>rows</span> <span class='id identifier rubyid_inserted'>inserted</span> <span class='id identifier rubyid_into'>into</span> <span class='id identifier rubyid_transient'>transient</span> <span class='id identifier rubyid_indices'>indices</span></code></pre>

<p>that were created automatically in order to help joins run faster</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span> <span class='id identifier rubyid_vm_steps'>vm_steps</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_virtual'>virtual</span> <span class='id identifier rubyid_machine'>machine</span> <span class='id identifier rubyid_operations'>operations</span> <span class='id identifier rubyid_executed'>executed</span> <span class='id identifier rubyid_by'>by</span> <span class='id identifier rubyid_the'>the</span></code></pre>

<p>prepared statement</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span> <span class='id identifier rubyid_reprepares'>reprepares</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_times'>times</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_prepare'><a href="#prepare-instance_method" title="SQLite3::Statement#prepare (method)">prepare</a></span> <span class='id identifier rubyid_statement'>statement</span> <span class='id identifier rubyid_has'>has</span> <span class='id identifier rubyid_been'>been</span></code></pre>

<p>automatically regenerated due to schema changes or changes to bound parameters that might affect the query plan</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span> <span class='id identifier rubyid_runs'>runs</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_times'>times</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_prepared'>prepared</span> <span class='id identifier rubyid_statement'>statement</span> <span class='id identifier rubyid_has'>has</span> <span class='id identifier rubyid_been'>been</span> <span class='id identifier rubyid_run'>run</span>
<span class='op'>-</span> <span class='id identifier rubyid_filter_misses'>filter_misses</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_times'>times</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_the'>the</span> <span class='const'>Bloom</span> <span class='id identifier rubyid_filter'>filter</span> <span class='id identifier rubyid_returned'>returned</span></code></pre>

<p>a find, and thus the join step had to be processed as normal</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span> <span class='id identifier rubyid_filter_hits'>filter_hits</span><span class='op'>:</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_number'>number</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_times'>times</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_join'>join</span> <span class='id identifier rubyid_step'><a href="#step-instance_method" title="SQLite3::Statement#step (method)">step</a></span> <span class='id identifier rubyid_was'>was</span> <span class='id identifier rubyid_bypassed'>bypassed</span></code></pre>

<p>because a Bloom filter returned not-found</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L167-L173'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='167' data-end='173'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 167</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stat'>stat</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>
    <span class='id identifier rubyid_stat_for'><a href="#stat_for-instance_method" title="SQLite3::Statement#stat_for (method)">stat_for</a></span>(<span class='id identifier rubyid_key'>key</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_stats_as_hash'><a href="#stats_as_hash-instance_method" title="SQLite3::Statement#stats_as_hash (method)">stats_as_hash</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stat_for-instance_method">
  <h3 class='signature priv'>
    #<strong>stmt_stat</strong>(hash_or_key)   <span class="extras">(<span class='priv'>private</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a Hash containing information about the statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L552-L565'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='552' data-end='565'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 552</span></pre>
<pre class='code cpp'>

static VALUE
stat_for(VALUE self, VALUE key)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);

    if (SYMBOL_P(key)) {
        size_t value = stmt_stat_internal(key, ctx-&gt;st);
        return SIZET2NUM(value);
    } else {
        rb_raise(rb_eTypeError, &quot;non-symbol given&quot;);
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stats_as_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>stats_as_hash</strong>(hash)   <span class="extras">(<span class='priv'>private</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a Hash containing information about the statement.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/ext/sqlite3/statement.c#L536-L546'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='536' data-end='546'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/sqlite3/statement.c', line 536</span></pre>
<pre class='code cpp'>

static VALUE
stats_as_hash(VALUE self)
{
    sqlite3StmtRubyPtr ctx;
    TypedData_Get_Struct(self, sqlite3StmtRuby, &amp;statement_type, ctx);
    REQUIRE_OPEN_STMT(ctx);
    VALUE arg = rb_hash_new();

    stmt_stat_internal(arg, ctx-&gt;st);
    return arg;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="step-instance_method">
  <h3 class='signature '>
    #<strong>step</strong>(nPage)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="Backup.html#step-instance_method" title="SQLite3::Backup#step (method)">Backup#step</a>.</p>

  </div>
</div>

</section>

<section class='method_details' id="types-instance_method">
  <h3 class='signature '>
    #<strong>types</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return an array of the data types for each column in this statement. Note that this may execute the statement in order to obtain the metadata; this makes it a (potentially) expensive operation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/sqlite3-ruby/blob/main/lib/sqlite3/statement.rb#L134-L138'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='134' data-end='138'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sqlite3/statement.rb', line 134</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_types'>types</span>
  <span class='id identifier rubyid_must_be_open!'><a href="#must_be_open!-instance_method" title="SQLite3::Statement#must_be_open! (method)">must_be_open!</a></span>
  <span class='id identifier rubyid_get_metadata'><a href="#get_metadata-instance_method" title="SQLite3::Statement#get_metadata (method)">get_metadata</a></span> <span class='kw'>unless</span> <span class='ivar'>@types</span>
  <span class='ivar'>@types</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>