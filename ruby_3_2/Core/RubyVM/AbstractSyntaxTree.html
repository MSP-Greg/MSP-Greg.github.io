<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: RubyVM::AbstractSyntaxTree &mdash; Core Ruby-3.2.3 pp157</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyVM::AbstractSyntaxTree",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.2.3</a> &raquo; 
      <a href='../'>Core</a> &raquo; 
      <a href='../_index.html#alpha_A'>Index (A)</a> &raquo; 
        <a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>AbstractSyntaxTree&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: RubyVM::AbstractSyntaxTree</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="AbstractSyntaxTree/Node.html" title="RubyVM::AbstractSyntaxTree::Node (class)"><code>Node</code></a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_3/ast.rb#L20'>ast.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_3/ast.c#L770'>ast.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><code>AbstractSyntaxTree</code> provides methods to parse Ruby code into abstract syntax trees. The nodes in the tree are instances of <a href="AbstractSyntaxTree/Node.html" title="RubyVM::AbstractSyntaxTree::Node (class)"><code>Node</code></a>.</p>

<p>This module is MRI specific as it exposes implementation details of the MRI abstract syntax tree.</p>

<p>This module is experimental and its API is not stable, therefore it might change without notice. As examples, the order of children nodes is not guaranteed, the number of children nodes might change, there is no way to access children nodes by name, etc.</p>

<p>If you are looking for a stable API or an API working under multiple Ruby implementations, consider using the <em>parser</em> gem or Ripper. If you would like to make <code>AbstractSyntaxTree</code> stable, please join the discussion at <a href="https://bugs.ruby-lang.org/issues/14844">bugs.ruby-lang.org/issues/14844</a>.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#node_id_for_backtrace_location-class_method" title="node_id_for_backtrace_location (class method)">.<strong>node_id_for_backtrace_location</strong>(backtrace_location)  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the node id for the given backtrace location.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#of-class_method" title="of (class method)">.<strong>of</strong>(proc, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; AbstractSyntaxTree </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns AST nodes of the given <em>proc</em> or <em>method</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#parse-class_method" title="parse (class method)">.<strong>parse</strong>(string, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; AbstractSyntaxTree </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Parses the given <em>string</em> into an abstract syntax tree, returning the root node of that tree.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#parse_file-class_method" title="parse_file (class method)">.<strong>parse_file</strong>(pathname, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; AbstractSyntaxTree </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Reads the file from <em>pathname</em>, then parses it like <a href="#parse-class_method" title="RubyVM::AbstractSyntaxTree.parse (method)">.parse</a>, returning the root node of the abstract syntax tree.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="node_id_for_backtrace_location-class_method">
  <h3 class='signature  first'>
    .<strong>node_id_for_backtrace_location</strong>(backtrace_location)  &#x21d2; <a href="../Integer.html" title="Integer (class)">Integer</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the node id for the given backtrace location.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>begin</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>rescue</span> <span class='op'>=&gt;</span>  <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_loc'>loc</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_backtrace_locations'>backtrace_locations</span>.<span class='id identifier rubyid_first'>first</span>
  <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_node_id_for_backtrace_location'>node_id_for_backtrace_location</span>(<span class='id identifier rubyid_loc'>loc</span>)
<span class='kw'>end</span> <span class='comment'># =&gt; 0</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_3/ast.rb#L111-L113'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='111' data-end='113'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ast.rb', line 111</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_node_id_for_backtrace_location'>node_id_for_backtrace_location</span> <span class='id identifier rubyid_backtrace_location'>backtrace_location</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_node_id_for_backtrace_location'>node_id_for_backtrace_location</span> <span class='id identifier rubyid_backtrace_location'>backtrace_location</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="of-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>of</strong>(proc, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; <code>AbstractSyntaxTree</code> </span>
      <span class='overload'>.<strong>of</strong>(method, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; <code>AbstractSyntaxTree</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns AST nodes of the given <em>proc</em> or <em>method</em>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_of'>of</span>(<span class='id identifier rubyid_proc'>proc</span> {<span class='int'>1</span> <span class='op'>+</span> <span class='int'>2</span>})
<span class='comment'># =&gt; #&lt;RubyVM::AbstractSyntaxTree::Node:SCOPE@1:35-1:42&gt;
</span>
<span class='kw'>def</span> <span class='id identifier rubyid_hello'>hello</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello, world</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_of'>of</span>(<span class='id identifier rubyid_method'>method</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_hello'>hello</span>))
<span class='comment'># =&gt; #&lt;RubyVM::AbstractSyntaxTree::Node:SCOPE@1:0-3:3&gt;</span></code></pre>

<p>See <a href="#parse-class_method" title="RubyVM::AbstractSyntaxTree.parse (method)">.parse</a> for explanation of keyword argument meaning and usage.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_3/ast.rb#L96-L98'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='96' data-end='98'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ast.rb', line 96</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='label'>keep_script_lines:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>error_tolerant:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>keep_tokens:</span> <span class='kw'>false</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ast_s_of'>ast_s_of</span> <span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_script_lines'><a href="../RubyVM.html#keep_script_lines-class_method" title="RubyVM.keep_script_lines (method)">keep_script_lines</a></span><span class='comma'>,</span> <span class='id identifier rubyid_error_tolerant'>error_tolerant</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_tokens'>keep_tokens</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="parse-class_method">
  <h3 class='signature '>
    .<strong>parse</strong>(string, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; <code>AbstractSyntaxTree</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Parses the given <em>string</em> into an abstract syntax tree, returning the root node of that tree.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x = 1 + 2</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; #&lt;RubyVM::AbstractSyntaxTree::Node:SCOPE@1:0-1:9&gt;</span></code></pre>

<p>If <code>keep_script_lines: true</code> option is provided, the text of the parsed source is associated with nodes and is available via <a href="AbstractSyntaxTree/Node.html#script_lines-instance_method" title="RubyVM::AbstractSyntaxTree::Node#script_lines (method)">Node#script_lines</a>.</p>

<p>If <code>keep_tokens: true</code> option is provided, <a href="AbstractSyntaxTree/Node.html#tokens-instance_method" title="RubyVM::AbstractSyntaxTree::Node#tokens (method)">Node#tokens</a> are populated.</p>

<p><a href="../SyntaxError.html" title="SyntaxError (class)"><code>::SyntaxError</code></a> is raised if the given <em>string</em> is invalid syntax. To overwrite this behavior, <code>error_tolerant: true</code> can be provided. In this case, the parser will produce a tree where expressions with syntax errors would be represented by <a href="AbstractSyntaxTree/Node.html" title="RubyVM::AbstractSyntaxTree::Node (class)"><code>AbstractSyntaxTree::Node</code></a> with <code>type=:ERROR</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_root'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span> <span class='op'>=</span> <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x = 1; p(x; y=2</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># &lt;internal:ast&gt;:33:in `parse&#39;: syntax error, unexpected &#39;;&#39;, expecting &#39;)&#39; (SyntaxError)
</span><span class='comment'># x = 1; p(x; y=2
</span><span class='comment'>#           ^
</span>
<span class='id identifier rubyid_root'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span> <span class='op'>=</span> <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x = 1; p(x; y=2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>error_tolerant:</span> <span class='kw'>true</span>)
<span class='comment'># (SCOPE@1:0-1:15
</span><span class='comment'>#  tbl: [:x, :y]
</span><span class='comment'>#  args: nil
</span><span class='comment'>#  body: (BLOCK@1:0-1:15 (LASGN@1:0-1:5 :x (LIT@1:4-1:5 1)) (ERROR@1:7-1:11) (LASGN@1:12-1:15 :y (LIT@1:14-1:15 2))))
</span><span class='id identifier rubyid_root'><a href="../top-level-namespace.html" title="Top Level Namespace (root)">root</a></span>.<span class='id identifier rubyid_children'>children</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_children'>children</span>
<span class='comment'># [(LASGN@1:0-1:5 :x (LIT@1:4-1:5 1)),
</span><span class='comment'>#  (ERROR@1:7-1:11),
</span><span class='comment'>#  (LASGN@1:12-1:15 :y (LIT@1:14-1:15 2))]</span></code></pre>

<p>Note that parsing continues even after the errored expresion.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_3/ast.rb#L58-L60'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='58' data-end='60'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ast.rb', line 58</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_parse'>parse</span> <span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='label'>keep_script_lines:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>error_tolerant:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>keep_tokens:</span> <span class='kw'>false</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ast_s_parse'>ast_s_parse</span> <span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_script_lines'><a href="../RubyVM.html#keep_script_lines-class_method" title="RubyVM.keep_script_lines (method)">keep_script_lines</a></span><span class='comma'>,</span> <span class='id identifier rubyid_error_tolerant'>error_tolerant</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_tokens'>keep_tokens</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="parse_file-class_method">
  <h3 class='signature '>
    .<strong>parse_file</strong>(pathname, keep_script_lines: false, error_tolerant: false, keep_tokens: false)  &#x21d2; <code>AbstractSyntaxTree</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reads the file from <em>pathname</em>, then parses it like <a href="#parse-class_method" title="RubyVM::AbstractSyntaxTree.parse (method)">.parse</a>, returning the root node of the abstract syntax tree.</p>

<p><a href="../SyntaxError.html" title="SyntaxError (class)"><code>::SyntaxError</code></a> is raised if <em>pathname</em>’s contents are not valid Ruby syntax.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>AbstractSyntaxTree</span>.<span class='id identifier rubyid_parse_file'>parse_file</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-app/app.rb</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; #&lt;RubyVM::AbstractSyntaxTree::Node:SCOPE@1:0-31:3&gt;</span></code></pre>

<p>See <a href="#parse-class_method" title="RubyVM::AbstractSyntaxTree.parse (method)">.parse</a> for explanation of keyword argument meaning and usage.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_3/ast.rb#L75-L77'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='75' data-end='77'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ast.rb', line 75</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_parse_file'>parse_file</span> <span class='id identifier rubyid_pathname'>pathname</span><span class='comma'>,</span> <span class='label'>keep_script_lines:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>error_tolerant:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>keep_tokens:</span> <span class='kw'>false</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ast_s_parse_file'>ast_s_parse_file</span> <span class='id identifier rubyid_pathname'>pathname</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_script_lines'><a href="../RubyVM.html#keep_script_lines-class_method" title="RubyVM.keep_script_lines (method)">keep_script_lines</a></span><span class='comma'>,</span> <span class='id identifier rubyid_error_tolerant'>error_tolerant</span><span class='comma'>,</span> <span class='id identifier rubyid_keep_tokens'>keep_tokens</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>