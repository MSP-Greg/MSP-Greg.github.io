<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: RubyVM::YJIT &mdash; Core  Ruby-3.2.9 p265</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyVM::YJIT",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.2.9</a> &raquo; 
      <a href='../'>Core</a> &raquo; 
      <a href='../_index.html#alpha_Y'>Index (Y)</a> &raquo; 
        <a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>YJIT&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: RubyVM::YJIT</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L11'>yjit.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This module allows for introspection of <code>YJIT</code>, CRuby’s in-process just-in-time compiler. This module exists only to help develop <code>YJIT</code>, as such, everything in the module is highly implementation specific and comes with no API stability guarantee whatsoever.</p>

<p>This module may not exist if <code>YJIT</code> does not support the particular platform for which CRuby is built. There is also no API stability guarantee as to in what situations this module is defined.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#enabled%3F-class_method" title=".enabled? (class method)">.<strong>enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if <code>YJIT</code> is enabled.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#stats_enabled%3F-class_method" title=".stats_enabled? (class method)">.<strong>stats_enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if –yjit-stats is used.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#trace_exit_locations_enabled%3F-class_method" title=".trace_exit_locations_enabled? (class method)">.<strong>trace_exit_locations_enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Check if rb_yjit_trace_exit_locations_enabled_p is enabled.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#code_gc-class_method" title=".code_gc (class method)">.<strong>code_gc</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Free and recompile all existing JIT code.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#disasm-class_method" title=".disasm (class method)">.<strong>disasm</strong>(iseq)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Produce disassembly for an iseq.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#dump_exit_locations-class_method" title=".dump_exit_locations (class method)">.<strong>dump_exit_locations</strong>(filename)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p><a href="../Marshal.html" title="Marshal (module)"><code>::Marshal</code></a> dumps exit locations to the given filename.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exit_locations-class_method" title=".exit_locations (class method)">.<strong>exit_locations</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>If –yjit-trace-exits is enabled parse the hashes from <code>Primitive.rb_yjit_get_exit_locations</code> into a format readable by Stackprof.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insns_compiled-class_method" title=".insns_compiled (class method)">.<strong>insns_compiled</strong>(iseq)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Produce a list of instructions compiled by <code>YJIT</code> for an iseq.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset_stats!-class_method" title=".reset_stats! (class method)">.<strong>reset_stats!</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Discard statistics collected for –yjit-stats.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#runtime_stats-class_method" title=".runtime_stats (class method)">.<strong>runtime_stats</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return a hash for statistics generated for the –yjit-stats command line option.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#simulate_oom!-class_method" title=".simulate_oom! (class method)">.<strong>simulate_oom!</strong>  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_dump_locations-class_method" title="._dump_locations (class method)">.<strong>_dump_locations</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_print_stats-class_method" title="._print_stats (class method)">.<strong>_print_stats</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>Format and print out counters.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#print_counters-class_method" title=".print_counters (class method)">.<strong>print_counters</strong>(counters, prefix:, prompt:)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#print_sorted_exit_counts-class_method" title=".print_sorted_exit_counts (class method)">.<strong>print_sorted_exit_counts</strong>(stats, prefix:, how_many: 20, left_pad: 4)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#total_exit_count-class_method" title=".total_exit_count (class method)">.<strong>total_exit_count</strong>(stats, prefix: &quot;exit_&quot;)  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="enabled?-class_method">
  <h3 class='signature ro first'>
    .<strong>enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if <code>YJIT</code> is enabled</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L13-L15'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='13' data-end='15'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 13</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_enabled?'>enabled?</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_cexpr!'>cexpr!</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RBOOL(rb_yjit_enabled_p())</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stats_enabled?-class_method">
  <h3 class='signature ro'>
    .<strong>stats_enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if –yjit-stats is used.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L18-L20'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='18' data-end='20'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 18</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stats_enabled?'>stats_enabled?</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_stats_enabled_p'>rb_yjit_stats_enabled_p</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="trace_exit_locations_enabled?-class_method">
  <h3 class='signature ro'>
    .<strong>trace_exit_locations_enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Check if rb_yjit_trace_exit_locations_enabled_p is enabled.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L23-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='23' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 23</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_trace_exit_locations_enabled?'>trace_exit_locations_enabled?</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_trace_exit_locations_enabled_p'>rb_yjit_trace_exit_locations_enabled_p</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="_dump_locations-class_method">
  <h3 class='signature priv  nodoc first'>
    .<strong>_dump_locations</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L228-L235'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='228' data-end='235'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 228</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__dump_locations'>_dump_locations</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'><a href="#trace_exit_locations_enabled%3F-class_method" title="RubyVM::YJIT.trace_exit_locations_enabled? (method)">trace_exit_locations_enabled?</a></span>

  <span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yjit_exit_locations.dump</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_dump_exit_locations'><a href="#dump_exit_locations-class_method" title="RubyVM::YJIT.dump_exit_locations (method)">dump_exit_locations</a></span>(<span class='id identifier rubyid_filename'>filename</span>)

  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>YJIT exit locations dumped to `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='embexpr_end'>}</span><span class='tstring_content'>`.</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_print_stats-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>_print_stats</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>Format and print out counters</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L238-L293'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='238' data-end='293'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 238</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__print_stats'>_print_stats</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime_stats'><a href="#runtime_stats-class_method" title="RubyVM::YJIT.runtime_stats (method)">runtime_stats</a></span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_stats'>stats</span>

  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>***YJIT: Printing YJIT statistics on exit***</span><span class='tstring_end'>&quot;</span></span>)

  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>send_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method call exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokeblock_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokeblock exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokesuper_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokesuper exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>leave_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>leave exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gbpp_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getblockparamproxy exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getivar_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getinstancevariable exit reasons:</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>setivar_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>setinstancevariable exit reasons:</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>oaref_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>opt_aref exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>expandarray_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>expandarray exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>opt_getinlinecache_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>opt_getinlinecache exit reasons: </span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::YJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalidate_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invalidation reasons: </span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># Number of failed compiler invocations
</span>  <span class='id identifier rubyid_compilation_failure'>compilation_failure</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_compilation_failure'>compilation_failure</span>]

  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bindings_allocations:  </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_binding_allocations'>binding_allocations</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bindings_set:          </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_binding_set'>binding_set</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compilation_failure:   </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_compilation_failure'>compilation_failure</span>) <span class='kw'>if</span> <span class='id identifier rubyid_compilation_failure'>compilation_failure</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compiled_iseq_count:   </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_compiled_iseq_count'>compiled_iseq_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compiled_block_count:  </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_compiled_block_count'>compiled_block_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compiled_branch_count: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_compiled_branch_count'>compiled_branch_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>block_next_count:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_block_next_count'>block_next_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>defer_count:           </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_defer_count'>defer_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>freed_iseq_count:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_freed_iseq_count'>freed_iseq_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalidation_count:    </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_invalidation_count'>invalidation_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>constant_state_bumps:  </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_constant_state_bumps'>constant_state_bumps</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>inline_code_size:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_inline_code_size'>inline_code_size</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>outlined_code_size:    </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_outlined_code_size'>outlined_code_size</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>freed_code_size:       </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_freed_code_size'>freed_code_size</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>code_region_size:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_code_region_size'>code_region_size</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yjit_alloc_size:       </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_yjit_alloc_size'>yjit_alloc_size</span>]) <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_yjit_alloc_size'>yjit_alloc_size</span>)
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>live_page_count:       </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_live_page_count'>live_page_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>freed_page_count:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_freed_page_count'>freed_page_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>code_gc_count:         </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_code_gc_count'>code_gc_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>num_gc_obj_refs:       </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_num_gc_obj_refs'>num_gc_obj_refs</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>object_shape_count:    </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_object_shape_count'>object_shape_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>side_exit_count:       </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_side_exit_count'>side_exit_count</span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_exit_count:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_exit_count'><a href="#total_exit_count-class_method" title="RubyVM::YJIT.total_exit_count (method)">total_exit_count</a></span>])
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_insns_count:     </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>]) <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>)
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vm_insns_count:        </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>])
  <span class='kw'>end</span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>yjit_insns_count:      </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_exec_instruction'>exec_instruction</span>])
  <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_yjit'>ratio_in_yjit</span>)
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ratio_in_yjit:         </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%9.1f</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_yjit'>ratio_in_yjit</span>]) <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>avg_len_in_yjit:       </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10.1f</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_avg_len_in_yjit'>avg_len_in_yjit</span>])

  <span class='id identifier rubyid_print_sorted_exit_counts'><a href="#print_sorted_exit_counts-class_method" title="RubyVM::YJIT.print_sorted_exit_counts (method)">print_sorted_exit_counts</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exit_</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="code_gc-class_method">
  <h3 class='signature '>
    .<strong>code_gc</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Free and recompile all existing JIT code</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L209-L211'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='209' data-end='211'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 209</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_code_gc'>code_gc</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_code_gc'>rb_yjit_code_gc</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disasm-class_method">
  <h3 class='signature '>
    .<strong>disasm</strong>(iseq)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Produce disassembly for an iseq</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L183-L194'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='183' data-end='194'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 183</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_disasm'>disasm</span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='comment'># If a method or proc is passed in, get its iseq
</span>  <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'><a href="InstructionSequence.html" title="RubyVM::InstructionSequence (class)">InstructionSequence</a></span>.<span class='id identifier rubyid_of'><a href="InstructionSequence.html#of-class_method" title="RubyVM::InstructionSequence.of (method)">of</a></span>(<span class='id identifier rubyid_iseq'>iseq</span>)

  <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_enabled?'><a href="#enabled%3F-class_method" title="RubyVM::YJIT.enabled? (method)">enabled?</a></span>
    <span class='comment'># Produce the disassembly string
</span>    <span class='comment'># Include the YARV iseq disasm in the string for additional context
</span>    <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_disasm'>disasm</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_disasm_iseq'>rb_yjit_disasm_iseq</span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_disasm'>disasm</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dump_exit_locations-class_method">
  <h3 class='signature '>
    .<strong>dump_exit_locations</strong>(filename)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../Marshal.html" title="Marshal (module)"><code>::Marshal</code></a> dumps exit locations to the given filename.</p>

<p>Usage:</p>

<p>If <code>–yjit-exit-locations</code> is passed, a file named “yjit_exit_locations.dump” will automatically be generated.</p>

<p>If you want to collect traces manually, call <code>dump_exit_locations</code> directly.</p>

<p>Note that calling this in a script will generate stats after the dump is created, so the stats data may include exits from the dump itself.</p>

<p>In a script call:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_at_exit'>at_exit</span> <span class='kw'>do</span>
  <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>YJIT</span>.<span class='id identifier rubyid_dump_exit_locations'>dump_exit_locations</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_file.dump</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span></code></pre>

<p>Then run the file with the following options:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_yjit'>yjit</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_yjit'>yjit</span><span class='op'>-</span><span class='id identifier rubyid_trace'>trace</span><span class='op'>-</span><span class='id identifier rubyid_exits'>exits</span> <span class='id identifier rubyid_test'>test</span>.<span class='id identifier rubyid_rb'>rb</span></code></pre>

<p>Once the code is done running, use Stackprof to read the dump file. See Stackprof documentation for options.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L138-L144'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='138' data-end='144'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 138</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_dump_exit_locations'>dump_exit_locations</span>(<span class='id identifier rubyid_filename'>filename</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'><a href="#trace_exit_locations_enabled%3F-class_method" title="RubyVM::YJIT.trace_exit_locations_enabled? (method)">trace_exit_locations_enabled?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--yjit-trace-exits must be enabled to use dump_exit_locations.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'><a href="../File.html" title="File (class)">File</a></span>.<span class='id identifier rubyid_binwrite'><a href="../IO.html#binwrite-class_method" title="IO.binwrite (method)">binwrite</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='const'><a href="../Marshal.html" title="Marshal (module)">Marshal</a></span>.<span class='id identifier rubyid_dump'><a href="../Marshal.html#dump-class_method" title="Marshal.dump (method)">dump</a></span>(<span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'>YJIT</span>.<span class='id identifier rubyid_exit_locations'><a href="#exit_locations-class_method" title="RubyVM::YJIT.exit_locations (method)">exit_locations</a></span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit_locations-class_method">
  <h3 class='signature '>
    .<strong>exit_locations</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If –yjit-trace-exits is enabled parse the hashes from <code>Primitive.rb_yjit_get_exit_locations</code> into a format readable by Stackprof. This will allow us to find the exact location of a side exit in <code>YJIT</code> based on the instruction that is exiting.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L36-L110'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='36' data-end='110'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 36</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_exit_locations'>exit_locations</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_trace_exit_locations_enabled?'><a href="#trace_exit_locations_enabled%3F-class_method" title="RubyVM::YJIT.trace_exit_locations_enabled? (method)">trace_exit_locations_enabled?</a></span>

  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_get_exit_locations'>rb_yjit_get_exit_locations</span>
  <span class='id identifier rubyid_raw_samples'>raw_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_raw'>raw</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_line_samples'>line_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_frames'>frames</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_frames'>frames</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_samples_count'>samples_count</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='comment'># Loop through the instructions and set the frame hash with the data.
</span>  <span class='comment'># We use nonexistent.def for the file name, otherwise insns.def will be displayed
</span>  <span class='comment'># and that information isn&#39;t useful in this context.
</span>  <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'><a href="../RubyVM.html#INSTRUCTION_NAMES-constant" title="RubyVM::INSTRUCTION_NAMES (constant)">INSTRUCTION_NAMES</a></span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_frame_id'>frame_id</span><span class='op'>|</span>
    <span class='id identifier rubyid_frame_hash'>frame_hash</span> <span class='op'>=</span> { <span class='label'>samples:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>total_samples:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>edges:</span> {}<span class='comma'>,</span> <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>file:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nonexistent.def</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>line:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>lines:</span> {} }
    <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_frames'>frames</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_frame_hash'>frame_hash</span>
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_frame_hash'>frame_hash</span>
  <span class='kw'>end</span>

  <span class='comment'># Loop through the raw_samples and build the hashes for StackProf.
</span>  <span class='comment'># The loop is based off an example in the StackProf documentation and therefore
</span>  <span class='comment'># this functionality can only work with that library.
</span>  <span class='comment'>#
</span>  <span class='comment'># Raw Samples:
</span>  <span class='comment'># [ length, frame1, frame2, frameN, ..., instruction, count
</span>  <span class='comment'>#
</span>  <span class='comment'># Line Samples
</span>  <span class='comment'># [ length, line_1, line_2, line_n, ..., dummy value, count
</span>  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>.<span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_stack_length'>stack_length</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_i'>i</span>] <span class='op'>+</span> <span class='int'>1</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='comment'># consume the stack length
</span>
    <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_stack_length'>stack_length</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>+=</span> <span class='id identifier rubyid_i'>i</span>
      <span class='id identifier rubyid_frame_id'>frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]

      <span class='kw'>if</span> <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>
        <span class='id identifier rubyid_prev_frame'>prev_frame</span> <span class='op'>=</span> <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>]
        <span class='id identifier rubyid_prev_frame'>prev_frame</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_edges'>edges</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>||=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_prev_frame'>prev_frame</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_edges'>edges</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_frame_info'>frame_info</span> <span class='op'>=</span> <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_frame_id'>frame_id</span>]
      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_samples'>total_samples</span>] <span class='op'>+=</span> <span class='int'>1</span>

      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_line_samples'>line_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]] <span class='op'>||=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>]
      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_line_samples'>line_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]][<span class='int'>0</span>] <span class='op'>+=</span> <span class='int'>1</span>

      <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_frame_id'>frame_id</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='id identifier rubyid_stack_length'>stack_length</span> <span class='comment'># consume the stack
</span>
    <span class='id identifier rubyid_top_frame_id'>top_frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>
    <span class='id identifier rubyid_top_frame_line'>top_frame_line</span> <span class='op'>=</span> <span class='int'>1</span>

    <span class='id identifier rubyid_sample_count'>sample_count</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_i'>i</span>]

    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_samples'>samples</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>] <span class='op'>||=</span> {}
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_top_frame_line'>top_frame_line</span>] <span class='op'>||=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>]
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_top_frame_line'>top_frame_line</span>][<span class='int'>1</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>

    <span class='id identifier rubyid_samples_count'>samples_count</span> <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_samples'>samples</span>] <span class='op'>=</span> <span class='id identifier rubyid_samples_count'>samples_count</span>
  <span class='comment'># Set missed_samples and gc_samples to 0 as their values
</span>  <span class='comment'># don&#39;t matter to us in this context.
</span>  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_missed_samples'>missed_samples</span>] <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_gc_samples'>gc_samples</span>] <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insns_compiled-class_method">
  <h3 class='signature '>
    .<strong>insns_compiled</strong>(iseq)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Produce a list of instructions compiled by <code>YJIT</code> for an iseq</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L197-L206'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='197' data-end='206'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 197</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_insns_compiled'>insns_compiled</span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='comment'># If a method or proc is passed in, get its iseq
</span>  <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='const'><a href="../RubyVM.html" title="RubyVM (class)">RubyVM</a></span><span class='op'>::</span><span class='const'><a href="InstructionSequence.html" title="RubyVM::InstructionSequence (class)">InstructionSequence</a></span>.<span class='id identifier rubyid_of'><a href="InstructionSequence.html#of-class_method" title="RubyVM::InstructionSequence.of (method)">of</a></span>(<span class='id identifier rubyid_iseq'>iseq</span>)

  <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_enabled?'><a href="#enabled%3F-class_method" title="RubyVM::YJIT.enabled? (method)">enabled?</a></span>
    <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_insns_compiled'>rb_yjit_insns_compiled</span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='kw'>else</span>
    <span class='const'>Qnil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_counters-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>print_counters</strong>(counters, prefix:, prompt:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L334-L354'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='334' data-end='354'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 334</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_counters'>print_counters</span>(<span class='id identifier rubyid_counters'>counters</span><span class='comma'>,</span> <span class='label'>prefix:</span><span class='comma'>,</span> <span class='label'>prompt:</span>) <span class='comment'># :nodoc:
</span>  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='id identifier rubyid_prompt'>prompt</span>)
  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_filter'>filter</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='id identifier rubyid_prefix'>prefix</span>) }
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_filter!'>filter!</span> { <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>!=</span> <span class='int'>0</span> }
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_transform_keys!'>transform_keys!</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_delete_prefix'>delete_prefix</span>(<span class='id identifier rubyid_prefix'>prefix</span>) }

  <span class='kw'>if</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    (all relevant counters are zero)</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_to_a'>to_a</span>
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_sort_by!'>sort_by!</span> { <span class='op'>|</span>(<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_value'>counter_value</span>)<span class='op'>|</span> <span class='id identifier rubyid_counter_value'>counter_value</span> }
  <span class='id identifier rubyid_longest_name_length'>longest_name_length</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_max_by'>max_by</span> { <span class='op'>|</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span>)<span class='op'>|</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_length'>length</span> }.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_sum'>sum</span> { <span class='op'>|</span>(<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_value'>counter_value</span>)<span class='op'>|</span> <span class='id identifier rubyid_counter_value'>counter_value</span> }

  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='kw'>do</span> <span class='op'>|</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)<span class='op'>|</span>
    <span class='id identifier rubyid_percentage'>percentage</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_fdiv'>fdiv</span>(<span class='id identifier rubyid_total'>total</span>) <span class='op'>*</span> <span class='int'>100</span>
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_printf'>printf</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    %*s %10d (%4.1f%%)\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_longest_name_length'>longest_name_length</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_percentage'>percentage</span>)<span class='semicolon'>;</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_sorted_exit_counts-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>print_sorted_exit_counts</strong>(stats, prefix:, how_many: 20, left_pad: 4)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L295-L324'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='295' data-end='324'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 295</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_sorted_exit_counts'>print_sorted_exit_counts</span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span><span class='comma'>,</span> <span class='label'>how_many:</span> <span class='int'>20</span><span class='comma'>,</span> <span class='label'>left_pad:</span> <span class='int'>4</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_exits'>exits</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='id identifier rubyid_prefix'>prefix</span>)
      <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_push'>push</span> [<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_delete_prefix'>delete_prefix</span>(<span class='id identifier rubyid_prefix'>prefix</span>)<span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span>]
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_exits'>exits</span> <span class='op'>=</span> <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_select'>select</span> { <span class='op'>|</span><span class='id identifier rubyid__name'>_name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>0</span> }.<span class='id identifier rubyid_sort_by'>sort_by</span> { <span class='op'>|</span><span class='id identifier rubyid__name'>_name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_count'>count</span> }.<span class='id identifier rubyid_first'>first</span>(<span class='id identifier rubyid_how_many'>how_many</span>)
  <span class='id identifier rubyid_total_exits'>total_exits</span> <span class='op'>=</span> <span class='id identifier rubyid_total_exit_count'><a href="#total_exit_count-class_method" title="RubyVM::YJIT.total_exit_count (method)">total_exit_count</a></span>(<span class='id identifier rubyid_stats'>stats</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_total_exits'>total_exits</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_top_n_total'>top_n_total</span> <span class='op'>=</span> <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_sum'>sum</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='id identifier rubyid_count'>count</span> }
    <span class='id identifier rubyid_top_n_exit_pct'>top_n_exit_pct</span> <span class='op'>=</span> <span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_top_n_total'>top_n_total</span> <span class='op'>/</span> <span class='id identifier rubyid_total_exits'>total_exits</span>

    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Top-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> most frequent exit ops (</span><span class='embexpr_beg'>#{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.1f</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_top_n_exit_pct'>top_n_exit_pct</span><span class='embexpr_end'>}</span><span class='tstring_content'>% of exits):</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_longest_insn_name_len'>longest_insn_name_len</span> <span class='op'>=</span> <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_length'>length</span> }.<span class='id identifier rubyid_max'>max</span>
    <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span>
      <span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='id identifier rubyid_longest_insn_name_len'>longest_insn_name_len</span> <span class='op'>+</span> <span class='id identifier rubyid_left_pad'>left_pad</span>
      <span class='id identifier rubyid_padded_name'>padded_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_padding'>padding</span><span class='embexpr_end'>}</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_name'>name</span>
      <span class='id identifier rubyid_padded_count'>padded_count</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_count'>count</span>
      <span class='id identifier rubyid_percent'>percent</span> <span class='op'>=</span> <span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>/</span> <span class='id identifier rubyid_total_exits'>total_exits</span>
      <span class='id identifier rubyid_formatted_percent'>formatted_percent</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.1f</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_percent'>percent</span>
      <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_padded_name'>padded_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_padded_count'>padded_count</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_formatted_percent'>formatted_percent</span><span class='embexpr_end'>}</span><span class='tstring_content'>%)</span><span class='tstring_end'>&quot;</span></span> )
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_exits:           </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> (<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%10d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_total_exits'>total_exits</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset_stats!-class_method">
  <h3 class='signature '>
    .<strong>reset_stats!</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Discard statistics collected for –yjit-stats.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L28-L30'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='28' data-end='30'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 28</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_reset_stats!'>reset_stats!</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_reset_stats_bang'>rb_yjit_reset_stats_bang</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="runtime_stats-class_method">
  <h3 class='signature '>
    .<strong>runtime_stats</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return a hash for statistics generated for the –yjit-stats command line option. Return nil when option is not passed or unavailable.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L148-L180'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='148' data-end='180'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 148</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_runtime_stats'>runtime_stats</span>
  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_get_stats'>rb_yjit_get_stats</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_stats'>stats</span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_object_shape_count'>object_shape_count</span>] <span class='op'>=</span> <span class='const'>Primitive</span>.<span class='id identifier rubyid_object_shape_count'>object_shape_count</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_stats'>stats</span> <span class='kw'>unless</span> <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_stats_enabled_p'>rb_yjit_stats_enabled_p</span>

  <span class='id identifier rubyid_side_exits'>side_exits</span> <span class='op'>=</span> <span class='id identifier rubyid_total_exit_count'><a href="#total_exit_count-class_method" title="RubyVM::YJIT.total_exit_count (method)">total_exit_count</a></span>(<span class='id identifier rubyid_stats'>stats</span>)
  <span class='id identifier rubyid_total_exits'>total_exits</span> <span class='op'>=</span> <span class='id identifier rubyid_side_exits'>side_exits</span> <span class='op'>+</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_leave_interp_return'>leave_interp_return</span>]

  <span class='comment'># Number of instructions that finish executing in YJIT.
</span>  <span class='comment'># See :count-placement: about the subtraction.
</span>  <span class='id identifier rubyid_retired_in_yjit'>retired_in_yjit</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_exec_instruction'>exec_instruction</span>] <span class='op'>-</span> <span class='id identifier rubyid_side_exits'>side_exits</span>

  <span class='comment'># Average length of instruction sequences executed by YJIT
</span>  <span class='id identifier rubyid_avg_len_in_yjit'>avg_len_in_yjit</span> <span class='op'>=</span> <span class='id identifier rubyid_retired_in_yjit'>retired_in_yjit</span>.<span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_total_exits'>total_exits</span>

  <span class='comment'># This only available on yjit stats builds
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>)
    <span class='comment'># Proportion of instructions that retire in YJIT
</span>    <span class='id identifier rubyid_total_insns_count'>total_insns_count</span> <span class='op'>=</span> <span class='id identifier rubyid_retired_in_yjit'>retired_in_yjit</span> <span class='op'>+</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>]
    <span class='id identifier rubyid_yjit_ratio_pct'>yjit_ratio_pct</span> <span class='op'>=</span> <span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_retired_in_yjit'>retired_in_yjit</span>.<span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_total_insns_count'>total_insns_count</span>
    <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>] <span class='op'>=</span> <span class='id identifier rubyid_total_insns_count'>total_insns_count</span>
    <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_yjit'>ratio_in_yjit</span>] <span class='op'>=</span> <span class='id identifier rubyid_yjit_ratio_pct'>yjit_ratio_pct</span>
  <span class='kw'>end</span>

  <span class='comment'># Make those stats available in RubyVM::YJIT.runtime_stats as well
</span>  <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_side_exit_count'>side_exit_count</span>]  <span class='op'>=</span> <span class='id identifier rubyid_side_exits'>side_exits</span>
  <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_exit_count'><a href="#total_exit_count-class_method" title="RubyVM::YJIT.total_exit_count (method)">total_exit_count</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_total_exits'>total_exits</span>
  <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_avg_len_in_yjit'>avg_len_in_yjit</span>]  <span class='op'>=</span> <span class='id identifier rubyid_avg_len_in_yjit'>avg_len_in_yjit</span>

  <span class='id identifier rubyid_stats'>stats</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="simulate_oom!-class_method">
  <h3 class='signature nodoc'>
    .<strong>simulate_oom!</strong>  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L213-L215'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='213' data-end='215'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 213</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_simulate_oom!'>simulate_oom!</span> <span class='comment'># :nodoc:
</span>  <span class='const'>Primitive</span>.<span class='id identifier rubyid_rb_yjit_simulate_oom_bang'>rb_yjit_simulate_oom_bang</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="total_exit_count-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>total_exit_count</strong>(stats, prefix: &quot;exit_&quot;)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_9/yjit.rb#L326-L332'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='326' data-end='332'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'yjit.rb', line 326</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_total_exit_count'>total_exit_count</span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exit_</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_v'>v</span> <span class='kw'>if</span> <span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='id identifier rubyid_prefix'>prefix</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_total'>total</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>