<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Thread &mdash; Core Ruby-3.2.4 p170</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Thread",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.2.4</a> &raquo; 
      <a href='.'>Core</a> &raquo; 
      <a href='_index.html#alpha_T'>Index (T)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Thread&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Thread</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Thread/Backtrace.html" title="Thread::Backtrace (class)"><code>Backtrace</code></a>,
        <a href="Thread/ConditionVariable.html" title="Thread::ConditionVariable (class)"><code>ConditionVariable</code></a>,
        <a href="Thread/Mutex.html" title="Thread::Mutex (class)"><code>Mutex</code></a>,
        <a href="Thread/Queue.html" title="Thread::Queue (class)"><code>Queue</code></a>,
        <a href="Thread/SizedQueue.html" title="Thread::SizedQueue (class)"><code>SizedQueue</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <a class='nodoc' href="Process/Waiter.html" title="Process::Waiter (class)">Process::Waiter</a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/vm.c#L3842'>vm.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L895'>thread.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread_sync.rb#L1'>thread_sync.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/vm_backtrace.c#L1272'>vm_backtrace.c</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/vm_trace.c#L611'>vm_trace.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Threads are the Ruby implementation for a concurrent programming model.</p>

<p>Programs that require multiple threads of execution are a perfect candidate for Ruby’s <code>Thread</code> class.</p>

<p>For example, we can create a new thread separate from the main thread’s execution using <a href="#new-class_method" title="Thread.new (method)">.new</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>What&#39;s the big deal</span><span class='tstring_end'>&quot;</span></span> }</code></pre>

<p>Then we are able to pause the execution of the main thread and allow our new thread to finish, using <a href="#join-instance_method" title="Thread#join (method)">#join</a>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span> <span class='comment'>#=&gt; &quot;What&#39;s the big deal&quot;</span></code></pre>

<p>If we don’t call <code>thr.join</code> before the main thread terminates, then all other threads including <code>thr</code> will be killed.</p>

<p>Alternatively, you can use an array for handling multiple threads at once, like in the following example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_threads'>threads</span> <span class='op'>=</span> []
<span class='id identifier rubyid_threads'>threads</span> <span class='op'>&lt;&lt;</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>What&#39;s the big deal</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_threads'>threads</span> <span class='op'>&lt;&lt;</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='int'>3</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Threads are fun!</span><span class='tstring_end'>&quot;</span></span> } }</code></pre>

<p>After creating a few threads we wait for them all to finish consecutively.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_threads'>threads</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_thr'>thr</span><span class='op'>|</span> <span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span> }</code></pre>

<p>To retrieve the last value of a thread, use <a href="#value-instance_method" title="Thread#value (method)">#value</a></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span><span class='semicolon'>;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Useful value</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Thread#value (method)">value</a></span> <span class='comment'>#=&gt; &quot;Useful value&quot;</span></code></pre>

<h3 id="label-Thread+initialization">Thread initialization</h3>

<p>In order to create new threads, Ruby provides <a href="#new-class_method" title="Thread.new (method)">.new</a>, <a href="#start-class_method" title="Thread.start (method)">.start</a>, and <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>. A block must be provided with each of these methods, otherwise a <a href="ThreadError.html" title="ThreadError (class)"><code>::ThreadError</code></a> will be raised.</p>

<p>When subclassing the <code>Thread</code> class, the <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method of your subclass will be ignored by <a href="#start-class_method" title="Thread.start (method)">.start</a> and <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>. Otherwise, be sure to call super in your <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method.</p>

<h3 id="label-Thread+termination">Thread termination</h3>

<p>For terminating threads, Ruby provides a variety of ways to do this.</p>

<p>The class method <a href="#kill-class_method" title="Thread.kill (method)">.kill</a>, is meant to exit a given thread:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_sleep'>sleep</span> }
<span class='const'>Thread</span>.<span class='id identifier rubyid_kill'><a href="#kill-class_method" title="Thread.kill (method)">kill</a></span>(<span class='id identifier rubyid_thr'>thr</span>) <span class='comment'># sends exit() to thr</span></code></pre>

<p>Alternatively, you can use the instance method <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>, or any of its aliases <a href="#kill-instance_method" title="Thread#kill (method)">#kill</a> or <a href="#terminate-instance_method" title="Thread#terminate (method)">#terminate</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_exit'><a href="#exit-class_method" title="Thread.exit (method)">exit</a></span></code></pre>

<h3 id="label-Thread+status">Thread status</h3>

<p>Ruby provides a few instance methods for querying the state of a given thread. To get a string with the current thread’s state use <a href="#status-instance_method" title="Thread#status (method)">#status</a></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_sleep'>sleep</span> }
<span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_status'><a href="#status-instance_method" title="Thread#status (method)">status</a></span> <span class='comment'># =&gt; &quot;sleep&quot;
</span><span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_exit'><a href="#exit-class_method" title="Thread.exit (method)">exit</a></span>
<span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_status'><a href="#status-instance_method" title="Thread#status (method)">status</a></span> <span class='comment'># =&gt; false</span></code></pre>

<p>You can also use <a href="#alive%3F-instance_method" title="Thread#alive? (method)">#alive?</a> to tell if the thread is running or sleeping, and <a href="#stop%3F-instance_method" title="Thread#stop? (method)">#stop?</a> if the thread is dead or sleeping.</p>

<h3 id="label-Thread+variables+and+scope">Thread variables and scope</h3>

<p>Since threads are created with blocks, the same rules apply to other Ruby blocks for variable scope. Any local variables created within this block are accessible to only this thread.</p>

<h4 id="label-Fiber-local+vs.+Thread-local">Fiber-local vs. Thread-local</h4>

<p>Each fiber has its own bucket for <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> storage. When you set a new fiber-local it is only accessible within this <a href="Fiber.html" title="Fiber (class)"><code>::Fiber</code></a>. To illustrate:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> {
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span>.<span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span> {
    <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>] <span class='comment'># =&gt; nil
</span>  }.<span class='id identifier rubyid_resume'>resume</span>
}.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span></code></pre>

<p>This example uses <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> for getting and <a href="#[]=-instance_method" title="Thread#[]= (method)">#[]=</a> for setting fiber-locals, you can also use <a href="#keys-instance_method" title="Thread#keys (method)">#keys</a> to list the fiber-locals for a given thread and <a href="#key%3F-instance_method" title="Thread#key? (method)">#key?</a> to check if a fiber-local exists.</p>

<p>When it comes to thread-locals, they are accessible within the entire scope of the thread. Given the following example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span>{
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_get'><a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">thread_variable_get</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>) <span class='comment'># =&gt; 1
</span>  <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span>.<span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span>{
    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span><span class='comma'>,</span> <span class='int'>2</span>)
    <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_get'><a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">thread_variable_get</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>) <span class='comment'># =&gt; 2
</span>  }.<span class='id identifier rubyid_resume'>resume</span>
  <span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_get'><a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">thread_variable_get</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>)   <span class='comment'># =&gt; 2
</span>}.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span></code></pre>

<p>You can see that the thread-local <code>:foo</code> carried over into the fiber and was changed to <code>2</code> by the end of the thread.</p>

<p>This example makes use of <a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">#thread_variable_set</a> to create new thread-locals, and <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> to reference them.</p>

<p>There is also <a href="#thread_variables-instance_method" title="Thread#thread_variables (method)">#thread_variables</a> to list all thread-locals, and <a href="#thread_variable%3F-instance_method" title="Thread#thread_variable? (method)">#thread_variable?</a> to check if a given thread-local exists.</p>

<h3 id="label-Exception+handling">Exception handling</h3>

<p>When an unhandled exception is raised inside a thread, it will terminate. By default, this exception will not propagate to other threads. The exception is stored and when another thread calls <a href="#value-instance_method" title="Thread#value (method)">#value</a> or <a href="#join-instance_method" title="Thread#join (method)">#join</a>, the exception will be re-raised in that thread.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span>{ <span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>something went wrong</span><span class='tstring_end'>&#39;</span></span> }
<span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Thread#value (method)">value</a></span> <span class='comment'>#=&gt; RuntimeError: something went wrong</span></code></pre>

<p>An exception can be raised from outside the thread using the <a href="#raise-instance_method" title="Thread#raise (method)">#raise</a> instance method, which takes the same parameters as <a href="Kernel.html#raise-class_method" title="Kernel.raise (method)">Kernel.raise</a>.</p>

<p>Setting <a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a> = true, <a href="#abort_on_exception-instance_method" title="Thread#abort_on_exception (method)">#abort_on_exception</a> = true, or $DEBUG = true will cause a subsequent unhandled exception raised in a thread to be automatically re-raised in the main thread.</p>

<p>With the addition of the class method <a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">.handle_interrupt</a>, you can now handle exceptions asynchronously with threads.</p>

<h3 id="label-Scheduling">Scheduling</h3>

<p>Ruby provides a few ways to support scheduling threads in your program.</p>

<p>The first way is by using the class method <a href="#stop-class_method" title="Thread.stop (method)">.stop</a>, to put the current running thread to sleep and schedule the execution of another thread.</p>

<p>Once a thread is asleep, you can use the instance method <a href="#wakeup-instance_method" title="Thread#wakeup (method)">#wakeup</a> to mark your thread as eligible for scheduling.</p>

<p>You can also try <a href="#pass-class_method" title="Thread.pass (method)">.pass</a>, which attempts to pass execution to another thread but is dependent on the OS whether a running thread will switch or not. The same goes for <a href="#priority-instance_method" title="Thread#priority (method)">#priority</a>, which lets you hint to the thread scheduler which threads you want to take precedence when passing execution. This method is also dependent on the OS and may be ignored on some platforms.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception-class_method" title="abort_on_exception (class method)">.<strong>abort_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the global “abort on exception” condition.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception=-class_method" title="abort_on_exception= (class method)">.<strong>abort_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, if any thread is aborted by an exception, the raised exception will be re-raised in the main thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#ignore_deadlock-class_method" title="ignore_deadlock (class method)">.<strong>ignore_deadlock</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the global “ignore deadlock” condition.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#ignore_deadlock=-class_method" title="ignore_deadlock= (class method)">.<strong>ignore_deadlock=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the new state.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception-class_method" title="report_on_exception (class method)">.<strong>report_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the global “report on exception” condition.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception=-class_method" title="report_on_exception= (class method)">.<strong>report_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the new state.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#current-class_method" title="current (class method)">.<strong>current</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the currently executing thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#each_caller_location-class_method" title="each_caller_location (class method)">.<strong>each_caller_location</strong> {|loc| ... } &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Yields each frame of the current execution stack as a backtrace location object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exit-class_method" title="exit (class method)">.<strong>exit</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Terminates the currently running thread and schedules another thread to be run.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fork-class_method" title="fork (class method)">.<strong>fork</strong>([args]*) {|args| ... } &#x21d2; Thread </a>
      (also: .start)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically the same as <a href="#new-class_method" title="Thread.new (method)">.new</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#handle_interrupt-class_method" title="handle_interrupt (class method)">.<strong>handle_interrupt</strong>(hash)  &#x21d2; result of the block </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Changes asynchronous interrupt timing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#kill-class_method" title="kill (class method)">.<strong>kill</strong>(thread)  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Causes the given <code>thread</code> to exit, see also <a href="#exit-class_method" title="Thread.exit (method)">.exit</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#list-class_method" title="list (class method)">.<strong>list</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of <code>Thread</code> objects for all threads that are either runnable or stopped.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#main-class_method" title="main (class method)">.<strong>main</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the main thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>  &#x21d2; Thread </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new thread executing the given block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pass-class_method" title="pass (class method)">.<strong>pass</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Give the thread scheduler a hint to pass execution to another thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pending_interrupt%3F-class_method" title="pending_interrupt? (class method)">.<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not the asynchronous queue is empty.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#start-class_method" title="start (class method)">.<strong>start</strong>([args]*) {|args| ... } &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stop-class_method" title="stop (class method)">.<strong>stop</strong>  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Stops execution of the current thread, putting it into a “sleep” state, and schedules execution of another thread.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception-instance_method" title="#abort_on_exception (instance method)">#<strong>abort_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the thread-local “abort on exception” condition for this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#abort_on_exception=-instance_method" title="#abort_on_exception= (instance method)">#<strong>abort_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, if this <code>thr</code> is aborted by an exception, the raised exception will be re-raised in the main thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#alive%3F-instance_method" title="#alive? (instance method)">#<strong>alive?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if <code>thr</code> is running or sleeping.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>show the name of the thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#name=-instance_method" title="#name= (instance method)">#<strong>name=</strong>(name)  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>set given name to the ruby thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#priority-instance_method" title="#priority (instance method)">#<strong>priority</strong>  &#x21d2; Integer </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the priority of <em>thr</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#priority=-instance_method" title="#priority= (instance method)">#<strong>priority=</strong>(integer)  &#x21d2; Thread </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the priority of <em>thr</em> to <em>integer</em>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception-instance_method" title="#report_on_exception (instance method)">#<strong>report_on_exception</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of the thread-local “report on exception” condition for this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#report_on_exception=-instance_method" title="#report_on_exception= (instance method)">#<strong>report_on_exception=</strong>(boolean)  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>When set to <code>true</code>, a message is printed on $stderr if an exception kills this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#stop%3F-instance_method" title="#stop? (instance method)">#<strong>stop?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if <code>thr</code> is dead or sleeping.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(sym)  &#x21d2; Object<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Attribute Reference—Returns the value of a fiber-local variable (current thread’s root fiber if not explicitly inside a <a href="Fiber.html" title="Fiber (class)"><code>::Fiber</code></a>), using either a symbol or a string name.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(sym, obj)  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Attribute Assignment—Sets or creates the value of a fiber-local variable, using either a symbol or a string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#add_trace_func-instance_method" title="#add_trace_func (instance method)">#<strong>add_trace_func</strong>(proc)  &#x21d2; Proc </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Adds <em>proc</em> as a handler for tracing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#backtrace-instance_method" title="#backtrace (instance method)">#<strong>backtrace</strong>  &#x21d2; Array<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the current backtrace of the target thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#backtrace_locations-instance_method" title="#backtrace_locations (instance method)">#<strong>backtrace_locations</strong>(*args)  &#x21d2; Array<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the execution stack for the target thread—an array containing backtrace location objects.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#exit-instance_method" title="#exit (instance method)">#<strong>exit</strong>  &#x21d2; Thread </a>
      (also: #kill, #terminate)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Terminates <code>thr</code> and schedules another thread to be run, returning the terminated <code>Thread</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#fetch-instance_method" title="#fetch (instance method)">#<strong>fetch</strong>(sym)  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a fiber-local for the given key.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#group-instance_method" title="#group (instance method)">#<strong>group</strong>  &#x21d2; thgrp<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the <a href="ThreadGroup.html" title="ThreadGroup (class)"><code>::ThreadGroup</code></a> which contains the given thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#to_s-instance_method" title="Thread#to_s (method)">#to_s</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#join-instance_method" title="#join (instance method)">#<strong>join</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The calling thread will suspend execution and run this <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#key%3F-instance_method" title="#key? (instance method)">#<strong>key?</strong>(sym)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if the given string (or symbol) exists as a fiber-local variable.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#keys-instance_method" title="#keys (instance method)">#<strong>keys</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of the names of the fiber-local variables (as Symbols).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#kill-instance_method" title="#kill (instance method)">#<strong>kill</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#native_thread_id-instance_method" title="#native_thread_id (instance method)">#<strong>native_thread_id</strong>  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return the native thread ID which is used by the Ruby thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pending_interrupt%3F-instance_method" title="#pending_interrupt? (instance method)">#<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns whether or not the asynchronous queue is empty for the target thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#raise-instance_method" title="#raise (instance method)">#<strong>raise</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Raises an exception from the given thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wakes up <code>thr</code>, making it eligible for scheduling.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set_trace_func-instance_method" title="#set_trace_func (instance method)">#<strong>set_trace_func</strong>(proc)  &#x21d2; Proc </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Establishes <em>proc</em> on <em>thr</em> as the handler for tracing, or disables tracing if the parameter is <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#status-instance_method" title="#status (instance method)">#<strong>status</strong>  &#x21d2; String, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the status of <code>thr</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#terminate-instance_method" title="#terminate (instance method)">#<strong>terminate</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variable%3F-instance_method" title="#thread_variable? (instance method)">#<strong>thread_variable?</strong>(key)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if the given string (or symbol) exists as a thread-local variable.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variable_get-instance_method" title="#thread_variable_get (instance method)">#<strong>thread_variable_get</strong>(key)  &#x21d2; Object<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the value of a thread local variable that has been set.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variable_set-instance_method" title="#thread_variable_set (instance method)">#<strong>thread_variable_set</strong>(key, value)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets a thread local with <code>key</code> to <a href="#value-instance_method" title="Thread#value (method)">#value</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#thread_variables-instance_method" title="#thread_variables (instance method)">#<strong>thread_variables</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an array of the names of the thread-local variables (as Symbols).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
      (also: #inspect)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Dump the name, id, and status of <em>thr</em> to a string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Waits for <code>thr</code> to complete, using <a href="#join-instance_method" title="Thread#join (method)">#join</a>, and returns its value or raises the exception which terminated the thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#wakeup-instance_method" title="#wakeup (instance method)">#<strong>wakeup</strong>  &#x21d2; Thread </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Marks a given thread as eligible for scheduling, however it may still remain blocked on I/O.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(args)  </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>new</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>new</strong>(*args, &amp;proc)  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>new</strong>(*args) {|args| ... } &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new thread executing the given block.</p>

<p>Any <code>args</code> given to <code>.new</code> will be passed to the block:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> []
<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span>
<span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='comma'>,</span><span class='id identifier rubyid_c'>c</span>) { <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='comma'>,</span><span class='id identifier rubyid_e'>e</span><span class='comma'>,</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_arr'>arr</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_f'>f</span> }.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>
<span class='id identifier rubyid_arr'>arr</span> <span class='comment'>#=&gt; [1, 2, 3]</span></code></pre>

<p>A ThreadError exception is raised if <code>.new</code> is called without a block.</p>

<p>If you’re going to subclass <code>Thread</code>, be sure to call super in your <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method, otherwise a <a href="ThreadError.html" title="ThreadError (class)"><code>::ThreadError</code></a> will be raised.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L895-L912'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='895' data-end='912'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 895</span></pre>
<pre class='code cpp'>

static VALUE
thread_s_new(int argc, VALUE *argv, VALUE klass)
{
    rb_thread_t *th;
    VALUE thread = rb_thread_alloc(klass);

    if (GET_RACTOR()-&gt;threads.main-&gt;status == THREAD_KILLED) {
        rb_raise(rb_eThreadError, &quot;can&#39;t alloc thread&quot;);
    }

    rb_obj_call_init_kw(thread, argc, argv, RB_PASS_CALLED_KEYWORDS);
    th = rb_thread_ptr(thread);
    if (!threadptr_initialized(th)) {
        rb_raise(rb_eThreadError, &quot;uninitialized thread - check `%&quot;PRIsVALUE&quot;#initialize&#39;&quot;,
                 klass);
    }
    return thread;
}
</pre>
  </div>
</div>
</section>

  <section class='method_details' id="initialize-instance_method">
  <h3 class='signature nodoc'>
    #<strong>initialize</strong>(args)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L947-L974'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='947' data-end='974'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 947</span></pre>
<pre class='code cpp'>

static VALUE
thread_initialize(VALUE thread, VALUE args)
{
    rb_thread_t *th = rb_thread_ptr(thread);

    if (!rb_block_given_p()) {
        rb_raise(rb_eThreadError, &quot;must be called with a block&quot;);
    }
    else if (th-&gt;invoke_type != thread_invoke_type_none) {
        VALUE loc = threadptr_invoke_proc_location(th);
        if (!NIL_P(loc)) {
            rb_raise(rb_eThreadError,
                     &quot;already initialized thread - %&quot;PRIsVALUE&quot;:%&quot;PRIsVALUE,
                     RARRAY_AREF(loc, 0), RARRAY_AREF(loc, 1));
        }
        else {
            rb_raise(rb_eThreadError, &quot;already initialized thread&quot;);
        }
    }
    else {
        struct thread_create_params params = {
            .type = thread_invoke_type_proc,
            .args = args,
            .proc = rb_block_proc(),
        };
        return thread_create_core(thread, &amp;params);
    }
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="abort_on_exception-class_method">
  <h3 class='signature rw first'>
    .<strong>abort_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the global “abort on exception” condition.</p>

<p>The default is <code>false</code>.</p>

<p>When set to <code>true</code>, if any thread is aborted by an exception, the raised exception will be re-raised in the main thread.</p>

<p>Can also be specified by the global $DEBUG flag or command line option <code>-d</code>.</p>

<p>See also <a href="#abort_on_exception=-class_method" title="Thread.abort_on_exception= (method)">.abort_on_exception=</a>.</p>

<p>There is also an instance level method to set this for a specific thread, see <a href="#abort_on_exception-instance_method" title="Thread#abort_on_exception (method)">#abort_on_exception</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2853-L2857'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2853' data-end='2857'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2853</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_abort_exc(VALUE _)
{
    return RBOOL(GET_THREAD()-&gt;vm-&gt;thread_abort_on_exception);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="abort_on_exception=-class_method">
  <h3 class='signature rw'>
    .<strong>abort_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, if any thread is aborted by an exception, the raised exception will be re-raised in the main thread. Returns the new state.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_abort_on_exception'><a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">abort_on_exception</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_t1'>t1</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In new thread</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Exception from thread</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not reached</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>In</span> <span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='id identifier rubyid_thread'>thread</span>
<span class='id identifier rubyid_prog'>prog</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>4</span><span class='op'>:</span> <span class='const'><a href="Exception.html" title="Exception (class)">Exception</a></span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_thread'>thread</span> (<span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span>)
 <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_prog'>prog</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>2</span><span class='symbeg'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>initialize&#39;
 from prog.rb:2:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
 from prog.rb:2</span></code></pre>

<p>See also <a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a>.</p>

<p>There is also an instance level method to set this for a specific thread, see <a href="#abort_on_exception=-instance_method" title="Thread#abort_on_exception= (method)">#abort_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2890-L2895'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2890' data-end='2895'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2890</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_abort_exc_set(VALUE self, VALUE val)
{
    GET_THREAD()-&gt;vm-&gt;thread_abort_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ignore_deadlock-class_method">
  <h3 class='signature rw'>
    .<strong>ignore_deadlock</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the global “ignore deadlock” condition. The default is <code>false</code>, so that deadlock conditions are not ignored.</p>

<p>See also <a href="#ignore_deadlock=-class_method" title="Thread.ignore_deadlock= (method)">.ignore_deadlock=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3039-L3043'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3039' data-end='3043'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3039</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_ignore_deadlock(VALUE _)
{
    return RBOOL(GET_THREAD()-&gt;vm-&gt;thread_ignore_deadlock);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ignore_deadlock=-class_method">
  <h3 class='signature rw'>
    .<strong>ignore_deadlock=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the new state. When set to <code>true</code>, the VM will not check for deadlock conditions. It is only useful to set this if your application can break a deadlock condition via some other means, such as a signal.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_ignore_deadlock'><a href="#ignore_deadlock-class_method" title="Thread.ignore_deadlock (method)">ignore_deadlock</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_queue'>queue</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='op'>::</span><span class='const'><a href="Thread/Queue.html" title="Thread::Queue (class)">Queue</a></span>.<span class='id identifier rubyid_new'><a href="Thread/Queue.html#new-class_method" title="Thread::Queue.new (method)">new</a></span>

<span class='id identifier rubyid_trap'>trap</span>(<span class='symbeg'>:</span><span class='const'>SIGUSR1</span>){<span class='id identifier rubyid_queue'>queue</span>.<span class='id identifier rubyid_push'>push</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received signal</span><span class='tstring_end'>&quot;</span></span>}

<span class='comment'># raises fatal error unless ignoring deadlock
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_queue'>queue</span>.<span class='id identifier rubyid_pop'>pop</span></code></pre>

<p>See also <a href="#ignore_deadlock-class_method" title="Thread.ignore_deadlock (method)">.ignore_deadlock</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3066-L3071'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3066' data-end='3071'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3066</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_ignore_deadlock_set(VALUE self, VALUE val)
{
    GET_THREAD()-&gt;vm-&gt;thread_ignore_deadlock = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception-class_method">
  <h3 class='signature rw'>
    .<strong>report_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the global “report on exception” condition.</p>

<p>The default is <code>true</code> since Ruby 2.5.</p>

<p>All threads created when this flag is true will report a message on $stderr if an exception kills the thread.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='int'>1</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> } }</code></pre>

<p>will produce this output on $stderr:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Thread:...&gt; terminated with exception (report_on_exception is true):
</span><span class='const'>Traceback</span> (<span class='id identifier rubyid_most'>most</span> <span class='id identifier rubyid_recent'>recent</span> <span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_last'>last</span>)<span class='op'>:</span>
        <span class='int'>2</span><span class='op'>:</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>-</span><span class='id identifier rubyid_e'>e</span><span class='symbeg'>:</span><span class='int'>1</span><span class='op'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>block in &lt;main&gt;&#39;
        1: from -e:1:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_times'>times</span><span class='tstring'><span class='tstring_beg'>&#39;</span></code></pre>

<p>This is done to catch errors in threads early. In some cases, you might not want this output. There are multiple ways to avoid the extra output:</p>
<ul><li>
<p>If the exception is not intended, the best is to fix the cause of the exception so it does not happen anymore.</p>
</li><li>
<p>If the exception is intended, it might be better to rescue it closer to where it is raised rather then let it kill the Thread.</p>
</li><li>
<p>If it is guaranteed the <code>Thread</code> will be joined with <a href="#join-instance_method" title="Thread#join (method)">#join</a> or Thread#value, then it is safe to disable this report with <code>Thread.current.report_on_exception = false</code> when starting the Thread. However, this might handle the exception much later, or not at all if the Thread is never joined due to the parent thread being blocked, etc.</p>
</li></ul>

<p>See also <a href="#report_on_exception=-class_method" title="Thread.report_on_exception= (method)">.report_on_exception=</a>.</p>

<p>There is also an instance level method to set this for a specific thread, see <a href="#report_on_exception=-instance_method" title="Thread#report_on_exception= (method)">#report_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2983-L2987'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2983' data-end='2987'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2983</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_report_exc(VALUE _)
{
    return RBOOL(GET_THREAD()-&gt;vm-&gt;thread_report_on_exception);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception=-class_method">
  <h3 class='signature rw'>
    .<strong>report_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the new state. When set to <code>true</code>, all threads created afterwards will inherit the condition and report a message on $stderr if an exception kills a thread:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_report_on_exception'><a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">report_on_exception</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_t1'>t1</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In new thread</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Exception from thread</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>1</span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In the main thread</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>In</span> <span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='id identifier rubyid_thread'>thread</span>
<span class='comment'>#&lt;Thread:...prog.rb:2&gt; terminated with exception (report_on_exception is true):
</span><span class='const'>Traceback</span> (<span class='id identifier rubyid_most'>most</span> <span class='id identifier rubyid_recent'>recent</span> <span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_last'>last</span>)<span class='op'>:</span>
<span class='id identifier rubyid_prog'>prog</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>4</span><span class='symbeg'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>block in &lt;main&gt;&#39;: Exception from thread (RuntimeError)
In the main thread</span></code></pre>

<p>See also <a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">.report_on_exception</a>.</p>

<p>There is also an instance level method to set this for a specific thread, see <a href="#report_on_exception=-instance_method" title="Thread#report_on_exception= (method)">#report_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3020-L3025'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3020' data-end='3025'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3020</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_report_exc_set(VALUE self, VALUE val)
{
    GET_THREAD()-&gt;vm-&gt;thread_report_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="current-class_method">
  <h3 class='signature  first'>
    .<strong>current</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the currently executing thread.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_current'>current</span>   <span class='comment'>#=&gt; #&lt;Thread:0x401bdf4c run&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2807-L2811'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2807' data-end='2811'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2807</span></pre>
<pre class='code cpp'>

static VALUE
thread_s_current(VALUE klass)
{
    return rb_thread_current();
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each_caller_location-class_method">
  <h3 class='signature '>
    .<strong>each_caller_location</strong> {|loc| ... } &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Yields each frame of the current execution stack as a backtrace location object.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/vm_backtrace.c#L1272-L1277'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1272' data-end='1277'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'vm_backtrace.c', line 1272</span></pre>
<pre class='code cpp'>

static VALUE
each_caller_location(VALUE unused)
{
    rb_ec_partial_backtrace_object(GET_EC(), 2, ALL_BACKTRACE_LINES, NULL, FALSE, TRUE);
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit-class_method">
  <h3 class='signature '>
    .<strong>exit</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Terminates the currently running thread and schedules another thread to be run.</p>

<p>If this thread is already marked to be killed, <code>.exit</code> returns the <code>Thread</code>.</p>

<p>If this is the main thread, or the last  thread, exit the process.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2645-L2650'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2645' data-end='2650'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2645</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_exit(VALUE _)
{
    rb_thread_t *th = GET_THREAD();
    return rb_thread_kill(th-&gt;self);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fork-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>start</strong>([args]*) {|args| ... } &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>fork</strong>([args]*) {|args| ... } &#x21d2; <code>Thread</code> </span>
    </div>
    <span class='aliases'>Also known as: <span class='names'>.start</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically the same as <a href="#new-class_method" title="Thread.new (method)">.new</a>. However, if class <code>Thread</code> is subclassed, then calling <a href="#start-class_method" title="Thread.start (method)">.start</a> in that subclass will not invoke the subclass’s <a href="#initialize-instance_method" title="Thread#initialize (method)">#initialize</a> method.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L924-L933'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='924' data-end='933'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 924</span></pre>
<pre class='code cpp'>

static VALUE
thread_start(VALUE klass, VALUE args)
{
    struct thread_create_params params = {
        .type = thread_invoke_type_proc,
        .args = args,
        .proc = rb_block_proc(),
    };
    return thread_create_core(rb_thread_alloc(klass), &amp;params);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_interrupt-class_method">
  <h3 class='signature '>
    .<strong>handle_interrupt</strong>(hash)  &#x21d2; <code>result</code> <code>of</code> <code>the</code> <code>block</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Changes asynchronous interrupt timing.</p>

<p><em>interrupt</em> means asynchronous event and corresponding procedure by <a href="#raise-instance_method" title="Thread#raise (method)">#raise</a>, <a href="#kill-instance_method" title="Thread#kill (method)">#kill</a>, signal trap (not supported yet) and main thread termination (if main thread terminates, then all other thread will be killed).</p>

<p>The given <code>hash</code> has pairs like <code>ExceptionClass =&gt; :TimingSymbol</code>. Where the ExceptionClass is the interrupt handled by the given block. The TimingSymbol can be one of the following symbols:</p>
<dl class="rdoc-list label-list"><dt><code>:immediate</code>
<dd>
<p>Invoke interrupts immediately.</p>
</dd><dt><code>:on_blocking</code>
<dd>
<p>Invoke interrupts while <em>BlockingOperation</em>.</p>
</dd><dt><code>:never</code>
<dd>
<p>Never invoke all interrupts.</p>
</dd></dl>

<p><em>BlockingOperation</em> means that the operation will block the calling thread, such as read and write.  On CRuby implementation, <em>BlockingOperation</em> is any operation executed without GVL.</p>

<p>Masked asynchronous interrupts are delayed until they are enabled. This method is similar to sigprocmask(3).</p>

<h4 id="label-NOTE">NOTE</h4>

<p>Asynchronous interrupts are difficult to use.</p>

<p>If you need to communicate between threads, please consider to use another way such as <a href="Thread/Queue.html" title="Thread::Queue (class)"><code>::Thread::Queue</code></a>.</p>

<p>Or use them with deep understanding about this method.</p>

<h4 id="label-Usage">Usage</h4>

<p>In this example, we can guard from <a href="#raise-instance_method" title="Thread#raise (method)">#raise</a> exceptions.</p>

<p>Using the <code>:never</code> TimingSymbol the <a href="RuntimeError.html" title="RuntimeError (class)"><code>::RuntimeError</code></a> exception will always be ignored in the first block of the main thread. In the second <code>.handle_interrupt</code> block we can purposefully handle <a href="RuntimeError.html" title="RuntimeError (class)"><code>::RuntimeError</code></a> exceptions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span>) {
    <span class='kw'>begin</span>
      <span class='comment'># You can write resource allocation code safely.
</span>      <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span>) {
        <span class='comment'># ...
</span>      }
    <span class='kw'>ensure</span>
      <span class='comment'># You can write resource deallocation code safely.
</span>    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
<span class='const'>Thread</span>.<span class='id identifier rubyid_pass'><a href="#pass-class_method" title="Thread.pass (method)">pass</a></span>
<span class='comment'># ...
</span><span class='id identifier rubyid_th'>th</span>.<span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stop</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>While we are ignoring the <a href="RuntimeError.html" title="RuntimeError (class)"><code>::RuntimeError</code></a> exception, it’s safe to write our resource allocation code. Then, the ensure block is where we can safely deallocate your resources.</p>

<h5 id="label-Guarding+from+-7BTimeout-3A-3AError-7D">Guarding from <code>Timeout::Error</code></h5>

<p>In the next example, we will guard from the <code>Timeout::Error</code> exception. This will help prevent from leaking resources when <code>Timeout::Error</code> exceptions occur during normal ensure clause. For this example we use the help of the standard library Timeout, from lib/timeout.rb</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span>) {
  <span class='id identifier rubyid_timeout'>timeout</span>(<span class='int'>10</span>){
    <span class='comment'># Timeout::Error doesn&#39;t occur here
</span>    <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_blocking'>on_blocking</span>) {
      <span class='comment'># possible to be killed by Timeout::Error
</span>      <span class='comment'># while blocking operation
</span>    }
    <span class='comment'># Timeout::Error doesn&#39;t occur here
</span>  }
}</code></pre>

<p>In the first part of the <code>timeout</code> block, we can rely on <code>Timeout::Error</code> being ignored. Then in the <code>Timeout::Error =&gt; :on_blocking</code> block, any operation that will block the calling thread is susceptible to a <code>Timeout::Error</code> exception being raised.</p>

<h5 id="label-Stack+control+settings">Stack control settings</h5>

<p>It’s possible to stack multiple levels of <code>.handle_interrupt</code> blocks in order to control more than one ExceptionClass and TimingSymbol at a time.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'>FooError</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span>) {
  <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'>BarError</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span>) {
     <span class='comment'># FooError and BarError are prohibited.
</span>  }
}</code></pre>

<h5 id="label-Inheritance+with+ExceptionClass">Inheritance with ExceptionClass</h5>

<p>All exceptions inherited from the ExceptionClass parameter will be considered.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'>handle_interrupt</span>(<span class='const'><a href="Exception.html" title="Exception (class)">Exception</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_never'>never</span>) {
  <span class='comment'># all exceptions inherited from Exception are prohibited.
</span>}</code></pre>

<p>For handling all interrupts, use <a href="Object.html" title="Object (class)"><code>::Object</code></a> and not <a href="Exception.html" title="Exception (class)"><code>::Exception</code></a> as the ExceptionClass, as kill/terminate interrupts are not handled by <a href="Exception.html" title="Exception (class)"><code>::Exception</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2120-L2165'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2120' data-end='2165'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2120</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_handle_interrupt(VALUE self, VALUE mask_arg)
{
    VALUE mask;
    rb_execution_context_t * volatile ec = GET_EC();
    rb_thread_t * volatile th = rb_ec_thread_ptr(ec);
    volatile VALUE r = Qnil;
    enum ruby_tag_type state;

    if (!rb_block_given_p()) {
        rb_raise(rb_eArgError, &quot;block is needed.&quot;);
    }

    mask = 0;
    mask_arg = rb_to_hash_type(mask_arg);
    rb_hash_foreach(mask_arg, handle_interrupt_arg_check_i, (VALUE)&amp;mask);
    if (!mask) {
        return rb_yield(Qnil);
    }
    OBJ_FREEZE_RAW(mask);
    rb_ary_push(th-&gt;pending_interrupt_mask_stack, mask);
    if (!rb_threadptr_pending_interrupt_empty_p(th)) {
        th-&gt;pending_interrupt_queue_checked = 0;
        RUBY_VM_SET_INTERRUPT(th-&gt;ec);
    }

    EC_PUSH_TAG(th-&gt;ec);
    if ((state = EC_EXEC_TAG()) == TAG_NONE) {
        r = rb_yield(Qnil);
    }
    EC_POP_TAG();

    rb_ary_pop(th-&gt;pending_interrupt_mask_stack);
    if (!rb_threadptr_pending_interrupt_empty_p(th)) {
        th-&gt;pending_interrupt_queue_checked = 0;
        RUBY_VM_SET_INTERRUPT(th-&gt;ec);
    }

    RUBY_VM_CHECK_INTS(th-&gt;ec);

    if (state) {
        EC_JUMP_TAG(th-&gt;ec, state);
    }

    return r;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill-class_method">
  <h3 class='signature '>
    .<strong>kill</strong>(thread)  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Causes the given <code>thread</code> to exit, see also <a href="#exit-class_method" title="Thread.exit (method)">.exit</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_loop'>loop</span> { <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span> } }
<span class='id identifier rubyid_sleep'>sleep</span>(<span class='float'>0.1</span>)       <span class='comment'>#=&gt; 0
</span><span class='const'>Thread</span>.<span class='id identifier rubyid_kill'>kill</span>(<span class='id identifier rubyid_a'>a</span>)   <span class='comment'>#=&gt; #&lt;Thread:0x401b3d30 dead&gt;
</span><span class='id identifier rubyid_count'>count</span>            <span class='comment'>#=&gt; 93947
</span><span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_alive?'><a href="#alive%3F-instance_method" title="Thread#alive? (method)">alive?</a></span>         <span class='comment'>#=&gt; false</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2626-L2630'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2626' data-end='2630'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2626</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_kill(VALUE obj, VALUE th)
{
    return rb_thread_kill(th);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="list-class_method">
  <h3 class='signature '>
    .<strong>list</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of <code>Thread</code> objects for all threads that are either runnable or stopped.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>200</span>) }
<span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='int'>1000000</span>.<span class='id identifier rubyid_times'>times</span> {<span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='op'>*</span><span class='id identifier rubyid_i'>i</span> } }
<span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span> }
<span class='const'>Thread</span>.<span class='id identifier rubyid_list'>list</span>.<span class='id identifier rubyid_each'><a href="Array.html#each-instance_method" title="Array#each (method)">each</a></span> {<span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_t'>t</span>}</code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Thread:0x401b3e84 sleep&gt;
</span><span class='comment'>#&lt;Thread:0x401b3f38 run&gt;
</span><span class='comment'>#&lt;Thread:0x401b3fb0 sleep&gt;
</span><span class='comment'>#&lt;Thread:0x401bdf4c run&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2786-L2790'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2786' data-end='2790'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2786</span></pre>
<pre class='code cpp'>

static VALUE
thread_list(VALUE _)
{
    return rb_thread_list();
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="main-class_method">
  <h3 class='signature '>
    .<strong>main</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the main thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2826-L2830'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2826' data-end='2830'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2826</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_main(VALUE klass)
{
    return rb_thread_main();
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pass-class_method">
  <h3 class='signature '>
    .<strong>pass</strong>  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Give the thread scheduler a hint to pass execution to another thread. A running thread may or may not switch, it depends on OS and processor.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L1824-L1829'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1824' data-end='1829'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1824</span></pre>
<pre class='code cpp'>

static VALUE
thread_s_pass(VALUE klass)
{
    rb_thread_schedule();
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pending_interrupt?-class_method">
  <h3 class='signature '>
    .<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not the asynchronous queue is empty.</p>

<p>Since <a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">.handle_interrupt</a> can be used to defer asynchronous events, this method can be used to determine if there are any deferred events.</p>

<p>If you find this method returns true, then you may finish <code>:never</code> blocks.</p>

<p>For example, the following method processes deferred asynchronous events immediately.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_kick_interrupt_immediately'>kick_interrupt_immediately</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span>(<span class='const'><a href="Object.html" title="Object (class)">Object</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span>) {
    <span class='const'>Thread</span>.<span class='id identifier rubyid_pass'><a href="#pass-class_method" title="Thread.pass (method)">pass</a></span>
  }
<span class='kw'>end</span></code></pre>

<p>If <code>error</code> is given, then check only for <code>error</code> type deferred events.</p>

<h4 id="label-Usage">Usage</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span>{
  <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span>(<span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_blocking'>on_blocking</span>){
    <span class='kw'>while</span> <span class='kw'>true</span>
      <span class='comment'>#...
</span>      <span class='comment'># reach safe point to invoke interrupt
</span>      <span class='kw'>if</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_pending_interrupt?'>pending_interrupt?</span>
        <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span>(<span class='const'><a href="Object.html" title="Object (class)">Object</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span>){}
      <span class='kw'>end</span>
      <span class='comment'>#...
</span>    <span class='kw'>end</span>
  }
}
<span class='comment'>#...
</span><span class='id identifier rubyid_th'>th</span>.<span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> <span class='comment'># stop thread</span></code></pre>

<p>This example can also be written as the following, which you should use to avoid asynchronous interrupts.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_th'>th</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span>{
  <span class='const'>Thread</span>.<span class='id identifier rubyid_handle_interrupt'><a href="#handle_interrupt-class_method" title="Thread.handle_interrupt (method)">handle_interrupt</a></span>(<span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_blocking'>on_blocking</span>){
    <span class='kw'>while</span> <span class='kw'>true</span>
      <span class='comment'>#...
</span>      <span class='comment'># reach safe point to invoke interrupt
</span>      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>==</span> <span class='kw'>false</span>
      <span class='comment'>#...
</span>    <span class='kw'>end</span>
  }
}
<span class='comment'>#...
</span><span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='comment'># stop thread</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2257-L2261'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2257' data-end='2261'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2257</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_s_pending_interrupt_p(int argc, VALUE *argv, VALUE self)
{
    return rb_thread_pending_interrupt_p(argc, argv, GET_THREAD()-&gt;self);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="start-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>start</strong>([args]*) {|args| ... } &#x21d2; <code>Thread</code> </span>
      <span class='overload'>.<strong>fork</strong>([args]*) {|args| ... } &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#fork-class_method" title="Thread.fork (method)">.fork</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>

</section>

<section class='method_details' id="stop-class_method">
  <h3 class='signature '>
    .<strong>stop</strong>  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Stops execution of the current thread, putting it into a “sleep” state, and schedules execution of another thread.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_stop'>stop</span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span> <span class='kw'>while</span> <span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_status'><a href="#status-instance_method" title="Thread#status (method)">status</a></span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_run'><a href="#run-instance_method" title="Thread#run (method)">run</a></span>
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>
<span class='comment'>#=&gt; &quot;abc&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2751-L2755'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2751' data-end='2755'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2751</span></pre>
<pre class='code cpp'>

static VALUE
thread_stop(VALUE _)
{
    return rb_thread_stop();
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="abort_on_exception-instance_method">
  <h3 class='signature rw first'>
    #<strong>abort_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the thread-local “abort on exception” condition for this <code>thr</code>.</p>

<p>The default is <code>false</code>.</p>

<p>See also <a href="#abort_on_exception=-instance_method" title="Thread#abort_on_exception= (method)">#abort_on_exception=</a>.</p>

<p>There is also a class level method to set this for all threads, see <a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2913-L2917'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2913' data-end='2917'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2913</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_abort_exc(VALUE thread)
{
    return RBOOL(rb_thread_ptr(thread)-&gt;abort_on_exception);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="abort_on_exception=-instance_method">
  <h3 class='signature rw'>
    #<strong>abort_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, if this <code>thr</code> is aborted by an exception, the raised exception will be re-raised in the main thread.</p>

<p>See also <a href="#abort_on_exception-instance_method" title="Thread#abort_on_exception (method)">#abort_on_exception</a>.</p>

<p>There is also a class level method to set this for all threads, see <a href="#abort_on_exception=-class_method" title="Thread.abort_on_exception= (method)">.abort_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2933-L2938'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2933' data-end='2938'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2933</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_abort_exc_set(VALUE thread, VALUE val)
{
    rb_thread_ptr(thread)-&gt;abort_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="alive?-instance_method">
  <h3 class='signature ro'>
    #<strong>alive?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if <code>thr</code> is running or sleeping.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { }
<span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>                <span class='comment'>#=&gt; #&lt;Thread:0x401b3fb0 dead&gt;
</span><span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_alive?'>alive?</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_alive?'>alive?</span>              <span class='comment'>#=&gt; false</span></code></pre>

<p>See also <a href="#stop%3F-instance_method" title="Thread#stop? (method)">#stop?</a> and <a href="#status-instance_method" title="Thread#status (method)">#status</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3222-L3226'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3222' data-end='3226'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3222</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_alive_p(VALUE thread)
{
    return RBOOL(!thread_finished(rb_thread_ptr(thread)));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="name-instance_method">
  <h3 class='signature rw'>
    #<strong>name</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>show the name of the thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3260-L3264'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3260' data-end='3264'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3260</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_getname(VALUE thread)
{
    return rb_thread_ptr(thread)-&gt;name;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="name=-instance_method">
  <h3 class='signature rw'>
    #<strong>name=</strong>(name)  &#x21d2; <a href="String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>set given name to the ruby thread. On some platform, it may set the name to pthread and/or kernel.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3274-L3294'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3274' data-end='3294'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3274</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_setname(VALUE thread, VALUE name)
{
    rb_thread_t *target_th = rb_thread_ptr(thread);

    if (!NIL_P(name)) {
        rb_encoding *enc;
        StringValueCStr(name);
        enc = rb_enc_get(name);
        if (!rb_enc_asciicompat(enc)) {
            rb_raise(rb_eArgError, &quot;ASCII incompatible encoding (%s)&quot;,
                     rb_enc_name(enc));
        }
        name = rb_str_new_frozen(name);
    }
    target_th-&gt;name = name;
    if (threadptr_initialized(target_th)) {
        native_set_another_thread_name(target_th-&gt;nt-&gt;thread_id, name);
    }
    return name;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="priority-instance_method">
  <h3 class='signature rw'>
    #<strong>priority</strong>  &#x21d2; <a href="Integer.html" title="Integer (class)">Integer</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the priority of <em>thr</em>. Default is inherited from the current thread which creating the new thread, or zero for the initial main thread; higher-priority thread will run more frequently than lower-priority threads (but lower-priority threads can also run).</p>

<p>This is just hint for Ruby thread scheduler.  It may be ignored on some platform.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_priority'>priority</span>   <span class='comment'>#=&gt; 0</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3770-L3774'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3770' data-end='3774'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3770</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_priority(VALUE thread)
{
    return INT2NUM(rb_thread_ptr(thread)-&gt;priority);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="priority=-instance_method">
  <h3 class='signature rw'>
    #<strong>priority=</strong>(integer)  &#x21d2; <code>Thread</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the priority of <em>thr</em> to <em>integer</em>. Higher-priority threads will run more frequently than lower-priority threads (but lower-priority threads can also run).</p>

<p>This is just hint for Ruby thread scheduler.  It may be ignored on some platform.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_count1'>count1</span> <span class='op'>=</span> <span class='id identifier rubyid_count2'>count2</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_loop'>loop</span> { <span class='id identifier rubyid_count1'>count1</span> <span class='op'>+=</span> <span class='int'>1</span> }
    <span class='kw'>end</span>
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_priority'><a href="#priority-instance_method" title="Thread#priority (method)">priority</a></span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>

<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
      <span class='id identifier rubyid_loop'>loop</span> { <span class='id identifier rubyid_count2'>count2</span> <span class='op'>+=</span> <span class='int'>1</span> }
    <span class='kw'>end</span>
<span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_priority'><a href="#priority-instance_method" title="Thread#priority (method)">priority</a></span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>2</span>
<span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>1</span>   <span class='comment'>#=&gt; 1
</span><span class='id identifier rubyid_count1'>count1</span>    <span class='comment'>#=&gt; 622504
</span><span class='id identifier rubyid_count2'>count2</span>    <span class='comment'>#=&gt; 5832</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3803-L3823'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3803' data-end='3823'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3803</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_priority_set(VALUE thread, VALUE prio)
{
    rb_thread_t *target_th = rb_thread_ptr(thread);
    int priority;

#if USE_NATIVE_THREAD_PRIORITY
    target_th-&gt;priority = NUM2INT(prio);
    native_thread_apply_priority(th);
#else
    priority = NUM2INT(prio);
    if (priority &gt; RUBY_THREAD_PRIORITY_MAX) {
        priority = RUBY_THREAD_PRIORITY_MAX;
    }
    else if (priority &lt; RUBY_THREAD_PRIORITY_MIN) {
        priority = RUBY_THREAD_PRIORITY_MIN;
    }
    target_th-&gt;priority = (int8_t)priority;
#endif
    return INT2NUM(target_th-&gt;priority);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception-instance_method">
  <h3 class='signature rw'>
    #<strong>report_on_exception</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of the thread-local “report on exception” condition for this <code>thr</code>.</p>

<p>The default value when creating a <code>Thread</code> is the value of the global flag <a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">.report_on_exception</a>.</p>

<p>See also <a href="#report_on_exception=-instance_method" title="Thread#report_on_exception= (method)">#report_on_exception=</a>.</p>

<p>There is also a class level method to set this for all new threads, see <a href="#report_on_exception=-class_method" title="Thread.report_on_exception= (method)">.report_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3090-L3094'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3090' data-end='3094'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3090</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_report_exc(VALUE thread)
{
    return RBOOL(rb_thread_ptr(thread)-&gt;report_on_exception);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="report_on_exception=-instance_method">
  <h3 class='signature rw'>
    #<strong>report_on_exception=</strong>(boolean)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>When set to <code>true</code>, a message is printed on $stderr if an exception kills this <code>thr</code>.  See <a href="#report_on_exception-class_method" title="Thread.report_on_exception (method)">.report_on_exception</a> for details.</p>

<p>See also <a href="#report_on_exception-instance_method" title="Thread#report_on_exception (method)">#report_on_exception</a>.</p>

<p>There is also a class level method to set this for all new threads, see <a href="#report_on_exception=-class_method" title="Thread.report_on_exception= (method)">.report_on_exception=</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3110-L3115'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3110' data-end='3115'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3110</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_report_exc_set(VALUE thread, VALUE val)
{
    rb_thread_ptr(thread)-&gt;report_on_exception = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stop?-instance_method">
  <h3 class='signature ro'>
    #<strong>stop?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if <code>thr</code> is dead or sleeping.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span> }
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_stop?'>stop?</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_stop?'>stop?</span>   <span class='comment'>#=&gt; false</span></code></pre>

<p>See also <a href="#alive%3F-instance_method" title="Thread#alive? (method)">#alive?</a> and <a href="#status-instance_method" title="Thread#status (method)">#status</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3242-L3251'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3242' data-end='3251'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3242</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_stop_p(VALUE thread)
{
    rb_thread_t *th = rb_thread_ptr(thread);

    if (rb_threadptr_dead(th)) {
        return Qtrue;
    }
    return RBOOL(th-&gt;status == THREAD_STOPPED || th-&gt;status == THREAD_STOPPED_FOREVER);
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
    #<strong>[]</strong>(sym)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attribute Reference—Returns the value of a fiber-local variable (current thread’s root fiber if not explicitly inside a <a href="Fiber.html" title="Fiber (class)"><code>::Fiber</code></a>), using either a symbol or a string name. If the specified variable does not exist, returns <code>nil</code>.</p>

<pre class="code ruby"><code class="ruby">[
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Thread#name (method)">name</a></span>]  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C</span><span class='tstring_end'>&quot;</span></span> }
].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_th'>th</span><span class='op'>|</span>
  <span class='id identifier rubyid_th'>th</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_th'>th</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Thread#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_th'>th</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Thread#name (method)">name</a></span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;Thread:0x00000002a54220 dead&gt;: A
</span><span class='comment'>#&lt;Thread:0x00000002a541a8 dead&gt;: B
</span><span class='comment'>#&lt;Thread:0x00000002a54130 dead&gt;: C</span></code></pre>

<p><code>[]</code> and <a href="#[]=-instance_method" title="Thread#[]= (method)">#[]=</a> are not thread-local but fiber-local. This confusion did not exist in Ruby 1.8 because fibers are only available since Ruby 1.9. Ruby 1.9 chooses that the methods behaves fiber-local to save following idiom for dynamic scope.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_meth'>meth</span>(<span class='id identifier rubyid_newvalue'>newvalue</span>)
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_oldvalue'>oldvalue</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Thread#name (method)">name</a></span>]
    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Thread#name (method)">name</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_newvalue'>newvalue</span>
    <span class='kw'>yield</span>
  <span class='kw'>ensure</span>
    <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Thread#name (method)">name</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_oldvalue'>oldvalue</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>The idiom may not work as dynamic scope if the methods are thread-local and a given block switches fiber.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span>.<span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span> {
  <span class='id identifier rubyid_meth'>meth</span>(<span class='int'>1</span>) {
    <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span>.<span class='id identifier rubyid_yield'><a href="Fiber.html#yield-class_method" title="Fiber.yield (method)">yield</a></span>
  }
}
<span class='id identifier rubyid_meth'>meth</span>(<span class='int'>2</span>) {
  <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_resume'>resume</span>
}
<span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_resume'>resume</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Thread#name (method)">name</a></span>]
<span class='comment'>#=&gt; nil if fiber-local
</span><span class='comment'>#=&gt; 2 if thread-local (The value 2 is leaked to outside of meth method.)</span></code></pre>

<p>For thread-local variables, please see <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> and <a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">#thread_variable_set</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3447-L3453'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3447' data-end='3453'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3447</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_aref(VALUE thread, VALUE key)
{
    ID id = rb_check_id(&amp;key);
    if (!id) return Qnil;
    return rb_thread_local_aref(thread, id);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-instance_method">
  <h3 class='signature '>
    #<strong>[]=</strong>(sym, obj)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attribute Assignment—Sets or creates the value of a fiber-local variable, using either a symbol or a string.</p>

<p>See also <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a>.</p>

<p>For thread-local variables, please see <a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">#thread_variable_set</a> and <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3552-L3556'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3552' data-end='3556'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3552</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_aset(VALUE self, VALUE id, VALUE val)
{
    return rb_thread_local_aset(self, rb_to_id(id), val);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="add_trace_func-instance_method">
  <h3 class='signature '>
    #<strong>add_trace_func</strong>(proc)  &#x21d2; <a href="Proc.html" title="Proc (class)">Proc</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Adds <em>proc</em> as a handler for tracing.</p>

<p>See <a href="#set_trace_func-instance_method" title="Thread#set_trace_func (method)">#set_trace_func</a> and <a href="Kernel.html#set_trace_func-class_method" title="Kernel.set_trace_func (method)">Kernel.set_trace_func</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/vm_trace.c#L593-L598'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='593' data-end='598'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'vm_trace.c', line 593</span></pre>
<pre class='code cpp'>

static VALUE
thread_add_trace_func_m(VALUE obj, VALUE trace)
{
    thread_add_trace_func(GET_EC(), rb_thread_ptr(obj), trace);
    return trace;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="backtrace-instance_method">
  <h3 class='signature '>
    #<strong>backtrace</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the current backtrace of the target thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L5275-L5279'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5275' data-end='5279'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 5275</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_backtrace_m(int argc, VALUE *argv, VALUE thval)
{
    return rb_vm_thread_backtrace(argc, argv, thval);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="backtrace_locations-instance_method">
  <h3 class='signature '>
    #<strong>backtrace_locations</strong>(*args)  &#x21d2; <a href="Array.html" title="Array (class)">Array</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the execution stack for the target thread—an array containing backtrace location objects.</p>

<p>See <a href="Thread/Backtrace/Location.html" title="Thread::Backtrace::Location (class)"><code>::Thread::Backtrace::Location</code></a> for more information.</p>

<p>This method behaves similarly to <a href="Kernel.html#caller_locations-class_method" title="Kernel.caller_locations (method)">Kernel.caller_locations</a> except it applies to a specific thread.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L5292-L5296'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5292' data-end='5296'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 5292</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_backtrace_locations_m(int argc, VALUE *argv, VALUE thval)
{
    return rb_vm_thread_backtrace_locations(argc, argv, thval);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>exit</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>kill</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>terminate</strong>  &#x21d2; <code>Thread</code> </span>
    </div>
    <span class='aliases'>Also known as: <span class='names'>#kill, #terminate</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Terminates <code>thr</code> and schedules another thread to be run, returning the terminated <code>Thread</code>.  If this is the main thread, or the last thread, exits the process.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2574-L2599'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2574' data-end='2599'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2574</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_kill(VALUE thread)
{
    rb_thread_t *target_th = rb_thread_ptr(thread);

    if (target_th-&gt;to_kill || target_th-&gt;status == THREAD_KILLED) {
        return thread;
    }
    if (target_th == target_th-&gt;vm-&gt;ractor.main_thread) {
        rb_exit(EXIT_SUCCESS);
    }

    RUBY_DEBUG_LOG(&quot;target_th:%u&quot;, rb_th_serial(target_th));

    if (target_th == GET_THREAD()) {
        /* kill myself immediately */
        rb_threadptr_to_kill(target_th);
    }
    else {
        threadptr_check_pending_interrupt_queue(target_th);
        rb_threadptr_pending_interrupt_enque(target_th, eKillSignal);
        rb_threadptr_interrupt(target_th);
    }

    return thread;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fetch-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>fetch</strong>(sym)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a> </span>
      <span class='overload'>#<strong>fetch</strong>(sym)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a> </span>
      <span class='overload'>#<strong>fetch</strong>(sym, default)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a fiber-local for the given key. If the key can’t be found, there are several options: With no other arguments, it will raise a <a href="KeyError.html" title="KeyError (class)"><code>::KeyError</code></a> exception; if <em>default</em> is given, then that will be returned; if the optional code block is specified, then that will be run and its result returned.  See <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and <a href="Hash.html#fetch-instance_method" title="Hash#fetch (method)">Hash#fetch</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3468-L3502'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3468' data-end='3502'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3468</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_fetch(int argc, VALUE *argv, VALUE self)
{
    VALUE key, val;
    ID id;
    rb_thread_t *target_th = rb_thread_ptr(self);
    int block_given;

    rb_check_arity(argc, 1, 2);
    key = argv[0];

    block_given = rb_block_given_p();
    if (block_given &amp;&amp; argc == 2) {
        rb_warn(&quot;block supersedes default value argument&quot;);
    }

    id = rb_check_id(&amp;key);

    if (id == recursive_key) {
        return target_th-&gt;ec-&gt;local_storage_recursive_hash;
    }
    else if (id &amp;&amp; target_th-&gt;ec-&gt;local_storage &amp;&amp;
             rb_id_table_lookup(target_th-&gt;ec-&gt;local_storage, id, &amp;val)) {
        return val;
    }
    else if (block_given) {
        return rb_yield(key);
    }
    else if (argc == 1) {
        rb_key_err_raise(rb_sprintf(&quot;key not found: %+&quot;PRIsVALUE, key), self, key);
    }
    else {
        return argv[1];
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="group-instance_method">
  <h3 class='signature '>
    #<strong>group</strong>  &#x21d2; <code>thgrp</code><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the <a href="ThreadGroup.html" title="ThreadGroup (class)"><code>::ThreadGroup</code></a> which contains the given thread.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_main'><a href="#main-class_method" title="Thread.main (method)">main</a></span>.<span class='id identifier rubyid_group'>group</span>   <span class='comment'>#=&gt; #&lt;ThreadGroup:0x4029d914&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3127-L3131'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3127' data-end='3131'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3127</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_group(VALUE thread)
{
    return rb_thread_ptr(thread)-&gt;thgroup;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>to_s</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a> </span>
      <span class='overload'>#<strong>inspect</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#to_s-instance_method" title="Thread#to_s (method)">#to_s</a>.</p>

  </div>
</div>

</section>

<section class='method_details' id="join-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>join</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>join</strong>(limit)  &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>The calling thread will suspend execution and run this <code>thr</code>.</p>

<p>Does not return until <code>thr</code> exits or until the given <code>limit</code> seconds have passed.</p>

<p>If the time limit expires, <code>nil</code> will be returned, otherwise <code>thr</code> is returned.</p>

<p>Any threads not joined will be killed when the main program exits.</p>

<p>If <code>thr</code> had previously raised an exception and the <a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">.abort_on_exception</a> or $DEBUG flags are not set, (so the exception has not yet been processed), it will be processed at this time.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>10</span>)<span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_pass'><a href="#pass-class_method" title="Thread.pass (method)">pass</a></span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>y</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>z</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_join'>join</span> <span class='comment'># Let thread x finish, thread a will be killed on exit.
</span><span class='comment'>#=&gt; &quot;axyz&quot;</span></code></pre>

<p>The following example illustrates the <code>limit</code> parameter.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='int'>4</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span><span class='semicolon'>;</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tick... </span><span class='tstring_end'>&#39;</span></span> }}
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Waiting</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>until</span> <span class='id identifier rubyid_y'>y</span>.<span class='id identifier rubyid_join'>join</span>(<span class='float'>0.15</span>)</code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_tick'>tick</span><span class='op'>...</span>
<span class='const'>Waiting</span>
<span class='id identifier rubyid_tick'>tick</span><span class='op'>...</span>
<span class='const'>Waiting</span>
<span class='id identifier rubyid_tick'>tick</span><span class='op'>...</span>
<span class='id identifier rubyid_tick'>tick</span><span class='op'>...</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L1181-L1208'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1181' data-end='1208'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1181</span></pre>
<pre class='code cpp'>

static VALUE
thread_join_m(int argc, VALUE *argv, VALUE self)
{
    VALUE timeout = Qnil;
    rb_hrtime_t rel = 0, *limit = 0;

    if (rb_check_arity(argc, 0, 1)) {
        timeout = argv[0];
    }

    // Convert the timeout eagerly, so it&#39;s always converted and deterministic
    /*
     * This supports INFINITY and negative values, so we can&#39;t use
     * rb_time_interval right now...
     */
    if (NIL_P(timeout)) {
        /* unlimited */
    }
    else if (FIXNUM_P(timeout)) {
        rel = rb_sec2hrtime(NUM2TIMET(timeout));
        limit = &amp;rel;
    }
    else {
        limit = double2hrtime(&amp;rel, rb_num2dbl(timeout));
    }

    return thread_join(rb_thread_ptr(self), timeout, limit);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="key?-instance_method">
  <h3 class='signature '>
    #<strong>key?</strong>(sym)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if the given string (or symbol) exists as a fiber-local variable.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_me'>me</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>
<span class='id identifier rubyid_me'>me</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span>)    <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stanley'>stanley</span>)   <span class='comment'>#=&gt; false</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3633-L3644'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3633' data-end='3644'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3633</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_key_p(VALUE self, VALUE key)
{
    VALUE val;
    ID id = rb_check_id(&amp;key);
    struct rb_id_table *local_storage = rb_thread_ptr(self)-&gt;ec-&gt;local_storage;

    if (!id || local_storage == NULL) {
        return Qfalse;
    }
    return RBOOL(rb_id_table_lookup(local_storage, id, &amp;val));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="keys-instance_method">
  <h3 class='signature '>
    #<strong>keys</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of the names of the fiber-local variables (as Symbols).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_cat'>cat</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>meow</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dog</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>woof</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>   <span class='comment'>#=&gt; #&lt;Thread:0x401b3f10 dead&gt;
</span><span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_keys'>keys</span>   <span class='comment'>#=&gt; [:dog, :cat]</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3674-L3684'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3674' data-end='3684'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3674</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_keys(VALUE self)
{
    struct rb_id_table *local_storage = rb_thread_ptr(self)-&gt;ec-&gt;local_storage;
    VALUE ary = rb_ary_new();

    if (local_storage) {
        rb_id_table_foreach(local_storage, thread_keys_i, (void *)ary);
    }
    return ary;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="kill-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>exit</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>kill</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>terminate</strong>  &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>

</section>

<section class='method_details' id="native_thread_id-instance_method">
  <h3 class='signature '>
    #<strong>native_thread_id</strong>  &#x21d2; <a href="Integer.html" title="Integer (class)">Integer</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return the native thread ID which is used by the Ruby thread.</p>

<p>The ID depends on the OS. (not POSIX thread ID returned by pthread_self(3))</p>
<ul><li>
<p>On Linux it is TID returned by gettid(2).</p>
</li><li>
<p>On macOS it is the system-wide unique integral ID of thread returned by pthread_threadid_np(3).</p>
</li><li>
<p>On FreeBSD it is the unique integral ID of the thread returned by pthread_getthreadid_np(3).</p>
</li><li>
<p>On Windows it is the thread identifier returned by GetThreadId().</p>
</li><li>
<p>On other platforms, it raises <a href="NotImplementedError.html" title="NotImplementedError (class)"><code>::NotImplementedError</code></a>.</p>
</li></ul>

<p>NOTE: If the thread is not associated yet or already deassociated with a native thread, it returns <em>nil</em>. If the Ruby implementation uses M:N thread model, the ID may change depending on the timing.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3319-L3325'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3319' data-end='3325'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3319</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_native_thread_id(VALUE thread)
{
    rb_thread_t *target_th = rb_thread_ptr(thread);
    if (rb_threadptr_dead(target_th)) return Qnil;
    return native_thread_native_thread_id(target_th);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pending_interrupt?-instance_method">
  <h3 class='signature '>
    #<strong>pending_interrupt?</strong>(error = nil)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns whether or not the asynchronous queue is empty for the target thread.</p>

<p>If <code>error</code> is given, then check only for <code>error</code> type deferred events.</p>

<p>See <a href="#pending_interrupt%3F-class_method" title="Thread.pending_interrupt? (method)">.pending_interrupt?</a> for more information.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2177-L2198'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2177' data-end='2198'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2177</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_pending_interrupt_p(int argc, VALUE *argv, VALUE target_thread)
{
    rb_thread_t *target_th = rb_thread_ptr(target_thread);

    if (!target_th-&gt;pending_interrupt_queue) {
        return Qfalse;
    }
    if (rb_threadptr_pending_interrupt_empty_p(target_th)) {
        return Qfalse;
    }
    if (rb_check_arity(argc, 0, 1)) {
        VALUE err = argv[0];
        if (!rb_obj_is_kind_of(err, rb_cModule)) {
            rb_raise(rb_eTypeError, &quot;class or module required for rescue clause&quot;);
        }
        return RBOOL(rb_threadptr_pending_interrupt_include_p(target_th, err));
    }
    else {
        return Qtrue;
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="raise-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>raise</strong>  </span>
      <span class='overload'>#<strong>raise</strong>(string)  </span>
      <span class='overload'>#<strong>raise</strong>(exception [, string [, array]])  </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Raises an exception from the given thread. The caller does not have to be <code>thr</code>. See <a href="Kernel.html#raise-class_method" title="Kernel.raise (method)">Kernel.raise</a> for more information.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_abort_on_exception'><a href="#abort_on_exception-class_method" title="Thread.abort_on_exception (method)">abort_on_exception</a></span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_sleep'>sleep</span>(<span class='int'>200</span>) }
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_raise'>raise</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gotcha</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_prog'>prog</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>3</span><span class='op'>:</span> <span class='const'>Gotcha</span> (<span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span>)
 <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_prog'>prog</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>2</span><span class='symbeg'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>initialize&#39;
 from prog.rb:2:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>
 from prog.rb:2</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2546-L2560'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2546' data-end='2560'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2546</span></pre>
<pre class='code cpp'>

static VALUE
thread_raise_m(int argc, VALUE *argv, VALUE self)
{
    rb_thread_t *target_th = rb_thread_ptr(self);
    const rb_thread_t *current_th = GET_THREAD();

    threadptr_check_pending_interrupt_queue(target_th);
    rb_threadptr_raise(target_th, argc, argv);

    /* To perform Thread.current.raise as Kernel.raise */
    if (current_th == target_th) {
        RUBY_VM_CHECK_INTS(target_th-&gt;ec);
    }
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="run-instance_method">
  <h3 class='signature '>
    #<strong>run</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wakes up <code>thr</code>, making it eligible for scheduling.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span><span class='semicolon'>;</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span> <span class='kw'>while</span> <span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_status'><a href="#status-instance_method" title="Thread#status (method)">status</a></span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got here</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_run'>run</span>
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span></code></pre>

<p>This will produce:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span>
<span class='const'>Got</span> <span class='id identifier rubyid_here'>here</span>
<span class='id identifier rubyid_c'>c</span></code></pre>

<p>See also the instance method <a href="#wakeup-instance_method" title="Thread#wakeup (method)">#wakeup</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2716-L2722'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2716' data-end='2722'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2716</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_run(VALUE thread)
{
    rb_thread_wakeup(thread);
    rb_thread_schedule();
    return thread;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_trace_func-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>set_trace_func</strong>(proc)  &#x21d2; <a href="Proc.html" title="Proc (class)">Proc</a> </span>
      <span class='overload'>#<strong>set_trace_func</strong>(nil)  &#x21d2; <code>nil</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Establishes <em>proc</em> on <em>thr</em> as the handler for tracing, or disables tracing if the parameter is <code>nil</code>.</p>

<p>See <a href="Kernel.html#set_trace_func-class_method" title="Kernel.set_trace_func (method)">Kernel.set_trace_func</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/vm_trace.c#L611-L626'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='611' data-end='626'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'vm_trace.c', line 611</span></pre>
<pre class='code cpp'>

static VALUE
thread_set_trace_func_m(VALUE target_thread, VALUE trace)
{
    rb_execution_context_t *ec = GET_EC();
    rb_thread_t *target_th = rb_thread_ptr(target_thread);

    rb_threadptr_remove_event_hook(ec, target_th, call_trace_func, Qundef);

    if (NIL_P(trace)) {
        return Qnil;
    }
    else {
        thread_add_trace_func(ec, target_th, trace);
        return trace;
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="status-instance_method">
  <h3 class='signature '>
    #<strong>status</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a>, ...   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the status of <code>thr</code>.</p>
<dl class="rdoc-list label-list"><dt><code>&quot;sleep&quot;</code>
<dd>
<p>Returned if this thread is sleeping or waiting on I/O</p>
</dd><dt><code>&quot;run&quot;</code>
<dd>
<p>When this thread is executing</p>
</dd><dt><code>&quot;aborting&quot;</code>
<dd>
<p>If this thread is aborting</p>
</dd><dt><code>false</code>
<dd>
<p>When this thread is terminated normally</p>
</dd><dt><code>nil</code>
<dd>
<p>If terminated with an exception.</p>
</dd></dl>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>die now</span><span class='tstring_end'>&quot;</span></span>) }
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span> }
<span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_exit'><a href="#exit-class_method" title="Thread.exit (method)">exit</a></span> }
<span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_sleep'>sleep</span> }
<span class='id identifier rubyid_d'>d</span>.<span class='id identifier rubyid_kill'><a href="#kill-class_method" title="Thread.kill (method)">kill</a></span>                  <span class='comment'>#=&gt; #&lt;Thread:0x401b3678 aborting&gt;
</span><span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; nil
</span><span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; &quot;sleep&quot;
</span><span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_d'>d</span>.<span class='id identifier rubyid_status'>status</span>                <span class='comment'>#=&gt; &quot;aborting&quot;
</span><span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_status'>status</span>   <span class='comment'>#=&gt; &quot;run&quot;</span></code></pre>

<p>See also the instance methods <a href="#alive%3F-instance_method" title="Thread#alive? (method)">#alive?</a> and <a href="#stop%3F-instance_method" title="Thread#stop? (method)">#stop?</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3188-L3205'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3188' data-end='3205'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3188</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_status(VALUE thread)
{
    rb_thread_t *target_th = rb_thread_ptr(thread);

    if (rb_threadptr_dead(target_th)) {
        if (!NIL_P(target_th-&gt;ec-&gt;errinfo) &amp;&amp;
            !FIXNUM_P(target_th-&gt;ec-&gt;errinfo)) {
            return Qnil;
        }
        else {
            return Qfalse;
        }
    }
    else {
        return rb_str_new2(thread_status_name(target_th, FALSE));
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="terminate-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>exit</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>kill</strong>  &#x21d2; <code>Thread</code> </span>
      <span class='overload'>#<strong>terminate</strong>  &#x21d2; <code>Thread</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#exit-instance_method" title="Thread#exit (method)">#exit</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>

</section>

<section class='method_details' id="thread_variable?-instance_method">
  <h3 class='signature '>
    #<strong>thread_variable?</strong>(key)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if the given string (or symbol) exists as a thread-local variable.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_me'>me</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>
<span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_thread_variable?'>thread_variable?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_oliver'>oliver</span>)    <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_thread_variable?'>thread_variable?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stanley'>stanley</span>)   <span class='comment'>#=&gt; false</span></code></pre>

<p>Note that these are not fiber local variables.  Please see <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> for more details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3742-L3753'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3742' data-end='3753'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3742</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variable_p(VALUE thread, VALUE key)
{
    VALUE locals;

    if (LIKELY(!THREAD_LOCAL_STORAGE_INITIALISED_P(thread))) {
        return Qfalse;
    }
    locals = rb_thread_local_storage(thread);

    return RBOOL(rb_hash_lookup(locals, rb_to_symbol(key)) != Qnil);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variable_get-instance_method">
  <h3 class='signature '>
    #<strong>thread_variable_get</strong>(key)  &#x21d2; <a href="Object.html" title="Object (class)">Object</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the value of a thread local variable that has been set.  Note that these are different than fiber local values.  For fiber local values, please see <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and <a href="#[]=-instance_method" title="Thread#[]= (method)">#[]=</a>.</p>

<p><code>Thread</code> local values are carried along with threads, and do not respect fibers.  For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> {
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># set a thread local
</span>  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>                    <span class='comment'># set a fiber local
</span>
  <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span>.<span class='id identifier rubyid_new'><a href="Fiber.html#new-class_method" title="Fiber.new (method)">new</a></span> {
    <span class='const'><a href="Fiber.html" title="Fiber (class)">Fiber</a></span>.<span class='id identifier rubyid_yield'><a href="Fiber.html#yield-class_method" title="Fiber.yield (method)">yield</a></span> [
      <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_get'>thread_variable_get</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>)<span class='comma'>,</span> <span class='comment'># get the thread local
</span>      <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span>                     <span class='comment'># get the fiber local
</span>    ]
  }.<span class='id identifier rubyid_resume'>resume</span>
}.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Thread#value (method)">value</a></span> <span class='comment'># =&gt; [&#39;bar&#39;, nil]</span></code></pre>

<p>The value “bar” is returned for the thread local, where nil is returned for the fiber local.  The fiber is executed in the same thread, so the thread local values are available.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3586-L3596'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3586' data-end='3596'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3586</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variable_get(VALUE thread, VALUE key)
{
    VALUE locals;

    if (LIKELY(!THREAD_LOCAL_STORAGE_INITIALISED_P(thread))) {
        return Qnil;
    }
    locals = rb_thread_local_storage(thread);
    return rb_hash_aref(locals, rb_to_symbol(key));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variable_set-instance_method">
  <h3 class='signature '>
    #<strong>thread_variable_set</strong>(key, value)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets a thread local with <code>key</code> to <a href="#value-instance_method" title="Thread#value (method)">#value</a>.  Note that these are local to threads, and not to fibers.  Please see <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> and <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> for more information.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3607-L3618'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3607' data-end='3618'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3607</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variable_set(VALUE thread, VALUE key, VALUE val)
{
    VALUE locals;

    if (OBJ_FROZEN(thread)) {
        rb_frozen_error_raise(thread, &quot;can&#39;t modify frozen thread locals&quot;);
    }

    locals = rb_thread_local_storage(thread);
    return rb_hash_aset(locals, rb_to_symbol(key), val);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="thread_variables-instance_method">
  <h3 class='signature '>
    #<strong>thread_variables</strong>  &#x21d2; <a href="Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an array of the names of the thread-local variables (as Symbols).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_thr'>thr</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_cat'>cat</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>meow</span><span class='tstring_end'>&#39;</span></span>)
  <span class='const'>Thread</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Thread.current (method)">current</a></span>.<span class='id identifier rubyid_thread_variable_set'><a href="#thread_variable_set-instance_method" title="Thread#thread_variable_set (method)">thread_variable_set</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dog</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>woof</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
<span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>               <span class='comment'>#=&gt; #&lt;Thread:0x401b3f10 dead&gt;
</span><span class='id identifier rubyid_thr'>thr</span>.<span class='id identifier rubyid_thread_variables'>thread_variables</span>   <span class='comment'>#=&gt; [:dog, :cat]</span></code></pre>

<p>Note that these are not fiber local variables.  Please see <a href="#[]-instance_method" title="Thread#[] (method)">#[]</a> and <a href="#thread_variable_get-instance_method" title="Thread#thread_variable_get (method)">#thread_variable_get</a> for more details.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3710-L3724'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3710' data-end='3724'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3710</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_variables(VALUE thread)
{
    VALUE locals;
    VALUE ary;

    ary = rb_ary_new();
    if (LIKELY(!THREAD_LOCAL_STORAGE_INITIALISED_P(thread))) {
        return ary;
    }
    locals = rb_thread_local_storage(thread);
    rb_hash_foreach(locals, keys_i, ary);

    return ary;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    #<strong>to_s</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a>     <span class='aliases'>Also known as: <span class='names'>#inspect</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Dump the name, id, and status of <em>thr</em> to a string.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L3337-L3357'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3337' data-end='3357'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 3337</span></pre>
<pre class='code cpp'>

static VALUE
rb_thread_to_s(VALUE thread)
{
    VALUE cname = rb_class_path(rb_obj_class(thread));
    rb_thread_t *target_th = rb_thread_ptr(thread);
    const char *status;
    VALUE str, loc;

    status = thread_status_name(target_th, TRUE);
    str = rb_sprintf(&quot;#&lt;%&quot;PRIsVALUE&quot;:%p&quot;, cname, (void *)thread);
    if (!NIL_P(target_th-&gt;name)) {
        rb_str_catf(str, &quot;@%&quot;PRIsVALUE, target_th-&gt;name);
    }
    if ((loc = threadptr_invoke_proc_location(target_th)) != Qnil) {
        rb_str_catf(str, &quot; %&quot;PRIsVALUE&quot;:%&quot;PRIsVALUE,
                    RARRAY_AREF(loc, 0), RARRAY_AREF(loc, 1));
    }
    rb_str_catf(str, &quot; %s&gt;&quot;, status);

    return str;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="value-instance_method">
  <h3 class='signature '>
    #<strong>value</strong>  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Waits for <code>thr</code> to complete, using <a href="#join-instance_method" title="Thread#join (method)">#join</a>, and returns its value or raises the exception which terminated the thread.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='int'>2</span> <span class='op'>+</span> <span class='int'>2</span> }
<span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_value'>value</span>   <span class='comment'>#=&gt; 4
</span>
<span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='id identifier rubyid_raise'><a href="#raise-instance_method" title="Thread#raise (method)">raise</a></span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>something went wrong</span><span class='tstring_end'>&#39;</span></span> }
<span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_value'>value</span>   <span class='comment'>#=&gt; RuntimeError: something went wrong</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L1224-L1234'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1224' data-end='1234'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 1224</span></pre>
<pre class='code cpp'>

static VALUE
thread_value(VALUE self)
{
    rb_thread_t *th = rb_thread_ptr(self);
    thread_join(th, Qnil, 0);
    if (UNDEF_P(th-&gt;value)) {
        // If the thread is dead because we forked th-&gt;value is still Qundef.
        return Qnil;
    }
    return th-&gt;value;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="wakeup-instance_method">
  <h3 class='signature '>
    #<strong>wakeup</strong>  &#x21d2; <code>Thread</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Marks a given thread as eligible for scheduling, however it may still remain blocked on I/O.</p>

<p><strong>Note:</strong> This does not invoke the scheduler, see <a href="#run-instance_method" title="Thread#run (method)">#run</a> for more information.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Thread.new (method)">new</a></span> { <span class='const'>Thread</span>.<span class='id identifier rubyid_stop'><a href="#stop-class_method" title="Thread.stop (method)">stop</a></span><span class='semicolon'>;</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hey!</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_sleep'>sleep</span> <span class='float'>0.1</span> <span class='kw'>while</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_status'><a href="#status-instance_method" title="Thread#status (method)">status</a></span><span class='op'>!=</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sleep</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_wakeup'>wakeup</span>
<span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Thread#join (method)">join</a></span>
<span class='comment'>#=&gt; &quot;hey!&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_2_4/thread.c#L2669-L2676'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2669' data-end='2676'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'thread.c', line 2669</span></pre>
<pre class='code cpp'>

VALUE
rb_thread_wakeup(VALUE thread)
{
    if (!RTEST(rb_thread_wakeup_alive(thread))) {
        rb_raise(rb_eThreadError, &quot;killed thread&quot;);
    }
    return thread;
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>