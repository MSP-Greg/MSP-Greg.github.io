<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: README &mdash; PG master</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "README",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>PG master</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: README&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>pg</h1>

<ul>
<li>home :: <a href="https://github.com/ged/ruby-pg">https://github.com/ged/ruby-pg</a></li>
<li>docs :: <a href="http://deveiate.org/code/pg">http://deveiate.org/code/pg</a> (English) ,
      <a href="https://deveiate.org/code/pg/README_ja_md.html">https://deveiate.org/code/pg/README_ja_md.html</a> (Japanese)</li>
<li>clog :: link:/CHANGELOG.md</li>
</ul>

<p><a href="https://gitter.im/ged/ruby-pg?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Join the chat at https://gitter.im/ged/ruby-pg"></a></p>

<h2>Description</h2>

<p>Pg is the Ruby interface to the <a href="http://www.postgresql.org/">PostgreSQL RDBMS</a>.
It works with <a href="http://www.postgresql.org/support/versioning/">PostgreSQL 10 and later</a>.</p>

<p>A small example usage:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#!/usr/bin/env ruby
</span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pg</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Output a table of current connections to the DB
</span><span class='id identifier rubyid_conn'>conn</span> <span class='op'>=</span> <span class='const'><a href="PG.html" title="PG (module)">PG</a></span>.<span class='id identifier rubyid_connect'><a href="PG.html#connect-class_method" title="PG.connect (method)">connect</a></span>( <span class='label'>dbname:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sales</span><span class='tstring_end'>&#39;</span></span> )
<span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_exec'>exec</span>( <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM pg_stat_activity</span><span class='tstring_end'>&quot;</span></span> ) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>     PID | User             | Query</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> %7d | %-16s | %s </span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
      <span class='id identifier rubyid_row'>row</span>.<span class='id identifier rubyid_values_at'>values_at</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pid</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>usename</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>query</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<h2>Build Status</h2>

<p><a href="https://github.com/ged/ruby-pg/actions/workflows/source-gem.yml"><img src="https://github.com/ged/ruby-pg/actions/workflows/source-gem.yml/badge.svg?branch=master" alt="Build Status Github Actions"></a>
<a href="https://github.com/ged/ruby-pg/actions/workflows/binary-gems.yml"><img src="https://github.com/ged/ruby-pg/actions/workflows/binary-gems.yml/badge.svg?branch=master" alt="Binary gems"></a>
<a href="https://ci.appveyor.com/project/ged/ruby-pg-9j8l3"><img src="https://ci.appveyor.com/api/projects/status/gjx5axouf3b1wicp?svg=true" alt="Build Status Appveyor"></a></p>

<h2>Requirements</h2>

<ul>
<li>Ruby 2.7 or newer</li>
<li>PostgreSQL 10.x or later</li>
<li>When installing the source gem: libpq with headers, -dev packages, etc.</li>
</ul>

<h2>How To Install</h2>

<p>Install via RubyGems:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_pg'>pg</span></code></pre>

<p>This installs the binary gem, specific to the running platform by default.</p>

<h3>Binary gem</h3>

<p>The binary gems don&#39;t depend on the libpq package on the running system.
They have libpq builtin.</p>

<p>The gems for platform <code>x86_64-linux</code> and <code>aarch64-linux</code> run on Alpine Linux, but require the package <code>gcompat</code>, while the native gems for platform <code>*-linux-musl</code> work without that dependency.</p>

<p>There is one use case the binary gems don&#39;t support: Retrieval of connection <a href="https://www.postgresql.org/docs/current/libpq-ldap.html">options from LDAP</a>. To support this <code>libldap</code> would be necessary, but it has a lot of dependencies. It doesn&#39;t seem to be a widely used feature and that it&#39;s worth to support it. If it&#39;s necessary, the source gem can be forced.</p>

<h3>Source gem</h3>

<p>The source gem can be forced by:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_uninstall'>uninstall</span> <span class='id identifier rubyid_pg'>pg</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_all'>all</span>
<span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_pg'>pg</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_platform'>platform</span> <span class='id identifier rubyid_ruby'>ruby</span></code></pre>

<p>You may need to specify the path to the &#39;pg_config&#39; program installed with
Postgres:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_pg'>pg</span> <span class='op'>-</span><span class='op'>-</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_with'>with</span><span class='op'>-</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>-</span><span class='id identifier rubyid_config'>config</span><span class='op'>=</span><span class='op'>&lt;</span><span class='id identifier rubyid_path'>path</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_pg_config'>pg_config</span><span class='op'>&gt;</span></code></pre>

<p>If you&#39;re installing via Bundler, you can provide compile hints like so:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_config'>config</span> <span class='id identifier rubyid_build'>build</span>.<span class='id identifier rubyid_pg'>pg</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_with'>with</span><span class='op'>-</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>-</span><span class='id identifier rubyid_config'>config</span><span class='op'>=</span><span class='op'>&lt;</span><span class='id identifier rubyid_path'>path</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_pg_config'>pg_config</span><span class='op'>&gt;</span></code></pre>

<h3>Bundler</h3>

<p>To make sure, the necessary platforms and the source gem are fetched by bundler, they can be added like so</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_lock'>lock</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_add'>add</span><span class='op'>-</span><span class='id identifier rubyid_platform'>platform</span> <span class='id identifier rubyid_x86_64'>x86_64</span><span class='op'>-</span><span class='id identifier rubyid_linux'>linux</span>
<span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_lock'>lock</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_add'>add</span><span class='op'>-</span><span class='id identifier rubyid_platform'>platform</span> <span class='id identifier rubyid_arm64'>arm64</span><span class='op'>-</span><span class='id identifier rubyid_darwin'>darwin</span>
<span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_lock'>lock</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_add'>add</span><span class='op'>-</span><span class='id identifier rubyid_platform'>platform</span> <span class='id identifier rubyid_x64'>x64</span><span class='op'>-</span><span class='id identifier rubyid_mingw'>mingw</span><span class='op'>-</span><span class='id identifier rubyid_ucrt'>ucrt</span>
<span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_lock'>lock</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_add'>add</span><span class='op'>-</span><span class='id identifier rubyid_platform'>platform</span> <span class='id identifier rubyid_ruby'>ruby</span>
<span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_package'>package</span> <span class='op'>-</span><span class='op'>-</span><span class='id identifier rubyid_all'>all</span><span class='op'>-</span><span class='id identifier rubyid_platforms'>platforms</span></code></pre>

<p>A re-run of <code>bundle package</code> is also necessary after <code>bundle update</code>, in order to retrieve the new specific gems of all platforms.</p>

<p>If the binary gems don&#39;t work for some reason, it&#39;s easy to force the usage of the source gem in the Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>force_ruby_platform:</span> <span class='kw'>true</span></code></pre>

<h3>More</h3>

<p>See README-OS_X.rdoc for more information about installing under MacOS X, and
README-Windows.rdoc for Windows build/installation instructions.</p>

<p>There&#39;s also <a href="http://goo.gl/TFy1U">a Google+ group</a> and a
<a href="http://groups.google.com/group/ruby-pg">mailing list</a> if you get stuck, or just
want to chat about something.</p>

<p>If you want to install as a signed gem, the public certs of the gem signers
can be found in <a href="https://github.com/ged/ruby-pg/tree/master/certs">the <code>certs</code> directory</a>
of the repository.</p>

<h2>Versioning</h2>

<p>We tag and release gems according to the <a href="http://semver.org/">Semantic Versioning</a> principle.</p>

<p>As a result of this policy, you can (and should) specify a dependency on this gem using the <a href="http://guides.rubygems.org/patterns/#pessimistic-version-constraint">Pessimistic Version Constraint</a> with two digits of precision.</p>

<p>For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_add_dependency'>add_dependency</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pg</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>~&gt; 1.0</span><span class='tstring_end'>&#39;</span></span></code></pre>

<h2>Type Casts</h2>

<p>Pg can optionally type cast result values and query parameters in Ruby or
native C code. This can speed up data transfers to and from the database,
because String allocations are reduced and conversions in (slower) Ruby code
can be omitted.</p>

<p>Very basic type casting can be enabled by:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_type_map_for_results'>type_map_for_results</span> <span class='op'>=</span> <span class='const'><a href="PG.html" title="PG (module)">PG</a></span><span class='op'>::</span><span class='const'><a href="PG/BasicTypeMapForResults.html" title="PG::BasicTypeMapForResults (class)">BasicTypeMapForResults</a></span>.<span class='id identifier rubyid_new'><a href="PG/BasicTypeMapForResults.html#new-class_method" title="PG::BasicTypeMapForResults.new (method)">new</a></span> <span class='id identifier rubyid_conn'>conn</span>
<span class='comment'># ... this works for result value mapping:
</span><span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_exec'>exec</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>select 1, now(), &#39;{2,3}&#39;::int[]</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_values'>values</span>
    <span class='comment'># =&gt; [[1, 2014-09-21 20:51:56 +0200, [2, 3]]]
</span>
<span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_type_map_for_queries'>type_map_for_queries</span> <span class='op'>=</span> <span class='const'><a href="PG.html" title="PG (module)">PG</a></span><span class='op'>::</span><span class='const'><a href="PG/BasicTypeMapForQueries.html" title="PG::BasicTypeMapForQueries (class)">BasicTypeMapForQueries</a></span>.<span class='id identifier rubyid_new'><a href="PG/BasicTypeMapForQueries.html#new-class_method" title="PG::BasicTypeMapForQueries.new (method)">new</a></span> <span class='id identifier rubyid_conn'>conn</span>
<span class='comment'># ... and this for param value mapping:
</span><span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_exec_params'>exec_params</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT $1::text, $2::text, $3::text</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> [<span class='int'>1</span><span class='comma'>,</span> <span class='float'>1.23</span><span class='comma'>,</span> [<span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span>]]).<span class='id identifier rubyid_values'>values</span>
    <span class='comment'># =&gt; [[&quot;1&quot;, &quot;1.2300000000000000E+00&quot;, &quot;{2,3}&quot;]]</span></code></pre>

<p>But Pg&#39;s type casting is highly customizable. That&#39;s why it&#39;s divided into
2 layers:</p>

<h3>Encoders / Decoders (ext/pg_*coder.c, lib/pg/*coder.rb)</h3>

<p>This is the lower layer, containing encoding classes that convert Ruby
objects for transmission to the DBMS and decoding classes to convert
received data back to Ruby objects. The classes are namespaced according
to their format and direction in PG::TextEncoder, PG::TextDecoder,
PG::BinaryEncoder and PG::BinaryDecoder.</p>

<p>It is possible to assign a type OID, format code (text or binary) and
optionally a name to an encoder or decoder object. It&#39;s also possible
to build composite types by assigning an element encoder/decoder.
PG::Coder objects can be used to set up a PG::TypeMap or alternatively
to convert single values to/from their string representation.</p>

<p>The following PostgreSQL column types are supported by ruby-pg (TE = Text Encoder, TD = Text Decoder, BE = Binary Encoder, BD = Binary Decoder):</p>

<ul>
<li>Integer: <a href="file.Integer.html">TE</a>, <a href="file.Integer.html">TD</a>, <a href="file.Integer.html">BD</a> 💡 No links? Switch to <a href="https://deveiate.org/code/pg/README_md.html#label-Type+Casts">here</a> 💡

<ul>
<li>BE: <a href="file.Int2.html">Int2</a>, <a href="file.Int4.html">Int4</a>, <a href="file.Int8.html">Int8</a></li>
</ul></li>
<li>Float: <a href="file.Float.html">TE</a>, <a href="file.Float.html">TD</a>, <a href="file.Float.html">BD</a>

<ul>
<li>BE: <a href="file.Float4.html">Float4</a>, <a href="file.Float8.html">Float8</a></li>
</ul></li>
<li>Numeric: <a href="file.Numeric.html">TE</a>, <a href="file.Numeric.html">TD</a></li>
<li>Boolean: <a href="file.Boolean.html">TE</a>, <a href="file.Boolean.html">TD</a>, <a href="file.Boolean.html">BE</a>, <a href="file.Boolean.html">BD</a></li>
<li>String: <a href="file.String.html">TE</a>, <a href="file.String.html">TD</a>, <a href="file.String.html">BE</a>, <a href="file.String.html">BD</a></li>
<li>Bytea: <a href="file.Bytea.html">TE</a>, <a href="file.Bytea.html">TD</a>, <a href="file.Bytea.html">BE</a>, <a href="file.Bytea.html">BD</a></li>
<li>Base64: <a href="file.ToBase64.html">TE</a>, <a href="file.FromBase64.html">TD</a>, <a href="file.FromBase64.html">BE</a>, <a href="file.ToBase64.html">BD</a></li>
<li>Timestamp:

<ul>
<li>TE: <a href="file.TimestampWithoutTimeZone.html">local</a>, <a href="file.TimestampUtc.html">UTC</a>, <a href="file.TimestampWithTimeZone.html">with-TZ</a></li>
<li>TD: <a href="file.TimestampLocal.html">local</a>, <a href="file.TimestampUtc.html">UTC</a>, <a href="file.TimestampUtcToLocal.html">UTC-to-local</a></li>
<li>BE: <a href="file.TimestampLocal.html">local</a>, <a href="file.TimestampUtc.html">UTC</a></li>
<li>BD: <a href="file.TimestampLocal.html">local</a>, <a href="file.TimestampUtc.html">UTC</a>, <a href="file.TimestampUtcToLocal.html">UTC-to-local</a></li>
</ul></li>
<li>Date: <a href="file.Date.html">TE</a>, <a href="file.Date.html">TD</a>, <a href="file.Date.html">BE</a>, <a href="file.Date.html">BD</a></li>
<li>JSON and JSONB: <a href="file.JSON.html">TE</a>, <a href="file.JSON.html">TD</a></li>
<li>Inet: <a href="file.Inet.html">TE</a>, <a href="file.Inet.html">TD</a></li>
<li>Array: <a href="file.Array.html">TE</a>, <a href="file.Array.html">TD</a>, <a href="file.Array.html">BE</a>, <a href="file.Array.html">BD</a></li>
<li>Composite Type (also called &quot;Row&quot; or &quot;Record&quot;): <a href="file.Record.html">TE</a>, <a href="file.Record.html">TD</a></li>
</ul>

<p>The following text and binary formats can also be encoded although they are not used as column type:</p>

<ul>
<li>COPY input and output data: <a href="file.CopyRow.html">TE</a>, <a href="file.CopyRow.html">TD</a>, <a href="file.CopyRow.html">BE</a>, <a href="file.CopyRow.html">BD</a></li>
<li>Literal for insertion into SQL string: <a href="file.QuotedLiteral.html">TE</a></li>
<li>SQL-Identifier: <a href="file.Identifier.html">TE</a>, <a href="file.Identifier.html">TD</a></li>
</ul>

<h3>TypeMap and derivations (ext/pg_type_map*.c, lib/pg/type_map*.rb)</h3>

<p>A PG::TypeMap defines which value will be converted by which encoder/decoder.
There are different type map strategies, implemented by several derivations
of this class. They can be chosen and configured according to the particular
needs for type casting. The default type map is PG::TypeMapAllStrings.</p>

<p>A type map can be assigned per connection or per query respectively per
result set. Type maps can also be used for COPY in and out data streaming.
See PG::Connection#copy_data .</p>

<p>The following base type maps are available:</p>

<ul>
<li>PG::TypeMapAllStrings - encodes and decodes all values to and from strings (default)</li>
<li>PG::TypeMapByClass - selects encoder based on the class of the value to be sent</li>
<li>PG::TypeMapByColumn - selects encoder and decoder by column order</li>
<li>PG::TypeMapByOid - selects decoder by PostgreSQL type OID</li>
<li>PG::TypeMapInRuby - define a custom type map in ruby</li>
</ul>

<p>The following type maps are prefilled with type mappings from the PG::BasicTypeRegistry :</p>

<ul>
<li>PG::BasicTypeMapForResults - a PG::TypeMapByOid prefilled with decoders for common PostgreSQL column types</li>
<li>PG::BasicTypeMapBasedOnResult - a PG::TypeMapByOid prefilled with encoders for common PostgreSQL column types</li>
<li>PG::BasicTypeMapForQueries - a PG::TypeMapByClass prefilled with encoders for common Ruby value classes</li>
</ul>

<p>Several type maps can be chained by setting PG::TypeMap::DefaultTypeMappable#default_type_map .</p>

<h2>Thread support</h2>

<p>PG is thread safe in such a way that different threads can use different PG::Connection objects concurrently.
However it is not safe to access any Pg objects simultaneously from more than one thread.
So make sure to open a new database server connection for every new thread or use a wrapper library like ActiveRecord that manages connections in a thread safe way.</p>

<p>If messages like the following are printed to stderr, you&#39;re probably using one connection from several threads:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_message'>message</span> <span class='id identifier rubyid_type'>type</span> <span class='int'>0x31</span> <span class='id identifier rubyid_arrived'>arrived</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_server'>server</span> <span class='kw'>while</span> <span class='id identifier rubyid_idle'>idle</span>
<span class='id identifier rubyid_message'>message</span> <span class='id identifier rubyid_type'>type</span> <span class='int'>0x32</span> <span class='id identifier rubyid_arrived'>arrived</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_server'>server</span> <span class='kw'>while</span> <span class='id identifier rubyid_idle'>idle</span>
<span class='id identifier rubyid_message'>message</span> <span class='id identifier rubyid_type'>type</span> <span class='int'>0x54</span> <span class='id identifier rubyid_arrived'>arrived</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_server'>server</span> <span class='kw'>while</span> <span class='id identifier rubyid_idle'>idle</span>
<span class='id identifier rubyid_message'>message</span> <span class='id identifier rubyid_type'>type</span> <span class='int'>0x43</span> <span class='id identifier rubyid_arrived'>arrived</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_server'>server</span> <span class='kw'>while</span> <span class='id identifier rubyid_idle'>idle</span>
<span class='id identifier rubyid_message'>message</span> <span class='id identifier rubyid_type'>type</span> <span class='int'>0x5a</span> <span class='id identifier rubyid_arrived'>arrived</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_server'>server</span> <span class='kw'>while</span> <span class='id identifier rubyid_idle'>idle</span></code></pre>

<h2>Fiber IO scheduler support</h2>

<p>Pg is fully compatible with <code>Fiber.scheduler</code> introduced in Ruby-3.0 since pg-1.3.0.
On Windows support for <code>Fiber.scheduler</code> is available on Ruby-3.1 or newer.
All possibly blocking IO operations are routed through the <code>Fiber.scheduler</code> if one is registered for the running thread.
That is why pg internally uses the asynchronous libpq interface even for synchronous/blocking method calls.
It also uses Ruby&#39;s DNS resolution instead of libpq&#39;s builtin functions.</p>

<p>Internally Pg always uses the nonblocking connection mode of libpq.
It then behaves like running in blocking mode but ensures, that all blocking IO is handled in Ruby through a possibly registered <code>Fiber.scheduler</code>.
When <code>PG::Connection.setnonblocking(true)</code> is called then the nonblocking state stays enabled, but the additional handling of blocking states is disabled, so that the calling program has to handle blocking states on its own.</p>

<p>An exception to this rule are the methods for large objects like <a href="PG/Connection.html#lo_create-instance_method" title="PG::Connection#lo_create (method)">PG::Connection#lo_create</a> and authentication methods using external libraries (like GSSAPI authentication).
They are not compatible with <code>Fiber.scheduler</code>, so that blocking states are not passed to the registered IO scheduler.
That means the operation will work properly, but IO waiting states can not be used to switch to another Fiber doing IO.</p>

<h2>Ractor support</h2>

<p>Pg is fully compatible with Ractor introduced in Ruby-3.0 since pg-1.5.0.
All type en/decoders and type maps are shareable between ractors if they are made frozen by <code>Ractor.make_shareable</code>.
Also frozen PG::Result and PG::Tuple objects can be shared.
All frozen objects (except PG::Connection) can still be used to do communication with the PostgreSQL server or to read retrieved data.</p>

<p>PG::Connection is not shareable and must be created within each Ractor to establish a dedicated connection.</p>

<h2>Contributing</h2>

<p>To report bugs, suggest features, or check out the source with Git,
<a href="https://github.com/ged/ruby-pg">check out the project page</a>.</p>

<p>After checking out the source, install all dependencies:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_install'>install</span></code></pre>

<p>Cleanup extension files, packaging files, test databases.
Run this to change between PostgreSQL versions:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_clean'>clean</span></code></pre>

<p>Compile extension:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_compile'>compile</span></code></pre>

<p>Run tests/specs on the PostgreSQL version that <code>pg_config --bindir</code> points to:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_test'>test</span></code></pre>

<p>Or run a specific test per file and line number on a specific PostgreSQL version:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='const'>PATH</span><span class='op'>=</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>usr</span><span class='regexp_end'>/lib</span></span><span class='op'>/</span><span class='id identifier rubyid_postgresql'>postgresql</span><span class='op'>/</span><span class='int'>14</span><span class='op'>/</span><span class='id identifier rubyid_bin'>bin</span><span class='symbeg'>:</span><span class='gvar'>$PATH</span> <span class='id identifier rubyid_rspec'>rspec</span> <span class='op'>-</span><span class='const'>Ilib</span> <span class='op'>-</span><span class='id identifier rubyid_fd'>fd</span> <span class='id identifier rubyid_spec'>spec</span><span class='op'>/</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>/</span><span class='id identifier rubyid_connection_spec'>connection_spec</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>455</span></code></pre>

<p>Generate the API documentation:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$ </span><span class='id identifier rubyid_rake'>rake</span> <span class='id identifier rubyid_docs'>docs</span></code></pre>

<p>Make sure, that all bugs and new features are verified by tests.</p>

<p>The current maintainers are Michael Granger <a href="mailto:ged@FaerieMUD.org">ged@FaerieMUD.org</a> and
Lars Kanis <a href="mailto:lars@greiz-reinsdorf.de">lars@greiz-reinsdorf.de</a>.</p>

<h2>Copying</h2>

<p>Copyright (c) 1997-2022 by the authors.</p>

<ul>
<li>Jeff Davis <a href="mailto:ruby-pg@j-davis.com">ruby-pg@j-davis.com</a></li>
<li>Guy Decoux (ts) <a href="mailto:decoux@moulon.inra.fr">decoux@moulon.inra.fr</a></li>
<li>Michael Granger <a href="mailto:ged@FaerieMUD.org">ged@FaerieMUD.org</a></li>
<li>Lars Kanis <a href="mailto:lars@greiz-reinsdorf.de">lars@greiz-reinsdorf.de</a></li>
<li>Dave Lee</li>
<li>Eiji Matsumoto <a href="mailto:usagi@ruby.club.or.jp">usagi@ruby.club.or.jp</a></li>
<li>Yukihiro Matsumoto <a href="mailto:matz@ruby-lang.org">matz@ruby-lang.org</a></li>
<li>Noboru Saitou <a href="mailto:noborus@netlab.jp">noborus@netlab.jp</a></li>
</ul>

<p>You may redistribute this software under the same terms as Ruby itself; see
<a href="https://www.ruby-lang.org/en/about/license.txt">https://www.ruby-lang.org/en/about/license.txt</a> or the BSDL file in the source
for details.</p>

<p>Portions of the code are from the PostgreSQL project, and are distributed
under the terms of the PostgreSQL license, included in the file POSTGRES.</p>

<p>Portions copyright LAIKA, Inc.</p>

<h2>Acknowledgments</h2>

<p>See Contributors.rdoc for the many additional fine people that have contributed
to this library over the years.</p>

<p>We are thankful to the people at the ruby-list and ruby-dev mailing lists.
And to the people who developed PostgreSQL.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>