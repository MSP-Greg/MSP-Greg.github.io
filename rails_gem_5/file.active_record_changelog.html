<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Active Record CHANGELOG &mdash; Rails 5.2.8.1</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "active_record_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 5.2.8.1</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Active Record CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h2>Rails 5.2.8.1 (July 12, 2022)</h2>
<ul>
<li>
<p>Change ActiveRecord::Coders::YAMLColumn default to safe_load</p>
<p>This adds two new configuration options The configuration options are as
follows:</p>
<ul>
<li><code>config.active_storage.use_yaml_unsafe_load</code></li>
</ul>
<p>When set to true, this configuration option tells Rails to use the old
&quot;unsafe&quot; YAML loading strategy, maintaining the existing behavior but leaving
the possible escalation vulnerability in place.  Setting this option to true
is <em>not</em> recommended, but can aid in upgrading.</p>
<ul>
<li><code>config.active_record.yaml_column_permitted_classes</code></li>
</ul>
<p>The &quot;safe YAML&quot; loading method does not allow all classes to be deserialized
by default.  This option allows you to specify classes deemed &quot;safe&quot; in your
application.  For example, if your application uses Symbol and Time in
serialized data, you can add Symbol and Time to the allowed list as follows:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_active_record'>active_record</span>.<span class='id identifier rubyid_yaml_column_permitted_classes'>yaml_column_permitted_classes</span> <span class='op'>=</span> [<span class='const'><a href="Symbol.html" title="Symbol (class)">Symbol</a></span><span class='comma'>,</span> <span class='const'><a href="Date.html" title="Date (class)">Date</a></span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>]</code></pre>
<p>[CVE-2022-32224]</p>
</li>
</ul>
<h2>Rails 5.2.8 (May 09, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.7.1 (April 26, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.7 (March 10, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.3 (March 08, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.2 (February 11, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.1 (February 11, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6 (May 05, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.5 (March 26, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.6 (May 05, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.5 (February 10, 2021)</h2>
<ul>
<li>
<p>Fix possible DoS vector in PostgreSQL money type</p>
<p>Carefully crafted input can cause a DoS via the regular expressions used
for validating the money format in the PostgreSQL adapter.  This patch
fixes the regexp.</p>
<p>Thanks to @dee-see from Hackerone for this patch!</p>
<p>[CVE-2021-22880]</p>
<p><em>Aaron Patterson</em></p>
</li>
</ul>
<h2>Rails 5.2.4.4 (September 09, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.3 (May 18, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.2 (March 19, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.1 (December 18, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4 (November 27, 2019)</h2>
<ul>
<li>
<p>Fix circular <code>autosave: true</code> causes invalid records to be saved.</p>
<p>Prior to the fix, when there was a circular series of <code>autosave: true</code>
associations, the callback for a <code>has_many</code> association was run while
another instance of the same callback on the same association hadn't
finished running. When control returned to the first instance of the
callback, the instance variable had changed, and subsequent associated
records weren't saved correctly. Specifically, the ID field for the
<code>belongs_to</code> corresponding to the <code>has_many</code> was <code>nil</code>.</p>
<p>Fixes #28080.</p>
<p><em>Larry Reid</em></p>
</li>
<li>
<p>PostgreSQL: Fix GROUP BY with ORDER BY virtual count attribute.</p>
<p>Fixes #36022.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix sqlite3 collation parsing when using decimal columns.</p>
<p><em>Martin R. Schuster</em></p>
</li>
<li>
<p>Make ActiveRecord <code>ConnectionPool.connections</code> method thread-safe.</p>
<p>Fixes #36465.</p>
<p><em>Jeff Doering</em></p>
</li>
<li>
<p>Assign all attributes before calling <code>build</code> to ensure the child record is visible in
<code>before_add</code> and <code>after_add</code> callbacks for <code>has_many :through</code> associations.</p>
<p>Fixes #33249.</p>
<p><em>Ryan H. Kerr</em></p>
</li>
</ul>
<h2>Rails 5.2.3 (March 27, 2019)</h2>
<ul>
<li>
<p>Fix different <code>count</code> calculation when using <code>size</code> with manual <code>select</code> with DISTINCT.</p>
<p>Fixes #35214.</p>
<p><em>Juani Villarejo</em></p>
</li>
<li>
<p>Fix prepared statements caching to be enabled even when query caching is enabled.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Don't allow <code>where</code> with invalid value matches to nil values.</p>
<p>Fixes #33624.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Restore an ability that class level <code>update</code> without giving ids.</p>
<p>Fixes #34743.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix join table column quoting with SQLite.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Ensure that <code>delete_all</code> on collection proxy returns affected count.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Reset scope after delete on collection association to clear stale offsets of removed records.</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul>
<h2>Rails 5.2.2.1 (March 11, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.2 (December 04, 2018)</h2>
<ul>
<li>
<p>Do not ignore the scoping with query methods in the scope block.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Allow aliased attributes to be used in <code>#update_columns</code> and <code>#update</code>.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Allow spaces in postgres table names.</p>
<p>Fixes issue where &quot;user post&quot; is misinterpreted as &quot;&quot;user&quot;.&quot;post&quot;&quot; when quoting table names with the postgres
adapter.</p>
<p><em>Gannon McGibbon</em></p>
</li>
<li>
<p>Cached columns_hash fields should be excluded from ResultSet#column_types</p>
<p>PR #34528 addresses the inconsistent behaviour when attribute is defined for an ignored column. The following test
was passing for SQLite and MySQL, but failed for PostgreSQL:</p>
<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>DeveloperName</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Type.html" title="ActiveRecord::Type (module)">Type</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Type.html#String-constant" title="ActiveRecord::Type::String (constant)">String</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_deserialize'>deserialize</span>(<span class='id identifier rubyid_value'>value</span>)
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Developer: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>AttributedDeveloper</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_table_name'>table_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>developers</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_attribute'>attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='const'>DeveloperName</span>.<span class='id identifier rubyid_new'>new</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_ignored_columns'>ignored_columns</span> <span class='op'>+=</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>]
<span class='kw'>end</span>

<span class='id identifier rubyid_developer'>developer</span> <span class='op'>=</span> <span class='const'>AttributedDeveloper</span>.<span class='id identifier rubyid_create'>create</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_update_column'>update_column</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_loaded_developer'>loaded_developer</span> <span class='op'>=</span> <span class='const'>AttributedDeveloper</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>id:</span> <span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_select'>select</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_first'>first</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_loaded_developer'>loaded_developer</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># should be &quot;Developer: name&quot; but it&#39;s just &quot;name&quot;</span></code></pre>
<p><em>Dmitry Tsepelev</em></p>
</li>
<li>
<p>Values of enum are frozen, raising an error when attempting to modify them.</p>
<p><em>Emmanuel Byrd</em></p>
</li>
<li>
<p><code>update_columns</code> now correctly raises <a href="ActiveModel/MissingAttributeError.html" title="ActiveModel::MissingAttributeError (class)"><code>::ActiveModel::MissingAttributeError</code></a>
if the attribute does not exist.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Do not use prepared statement in queries that have a large number of binds.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix query cache to load before first request.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Fix collection cache key with limit and custom select to avoid ambiguous timestamp column error.</p>
<p>Fixes #33056.</p>
<p><em>Federico Martinez</em></p>
</li>
<li>
<p>Fix duplicated record creation when using nested attributes with <code>create_with</code>.</p>
<p><em>Darwin Wu</em></p>
</li>
<li>
<p>Fix regression setting children record in parent <code>before_save</code> callback.</p>
<p><em>Guo Xiang Tan</em></p>
</li>
<li>
<p>Prevent leaking of user's DB credentials on <code>rails db:create</code> failure.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Clear mutation tracker before continuing the around callbacks.</p>
<p><em>Yuya Tanaka</em></p>
</li>
<li>
<p>Prevent deadlocks when waiting for connection from pool.</p>
<p><em>Brent Wheeldon</em></p>
</li>
<li>
<p>Avoid extra scoping when using <code>Relation#update</code> that was causing this method to change the current scope.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix numericality validator not to be affected by custom getter.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix bulk change table ignores comment option on PostgreSQL.</p>
<p><em>Yoshiyuki Kinjo</em></p>
</li>
</ul>
<h2>Rails 5.2.1.1 (November 27, 2018)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.1 (August 07, 2018)</h2>
<ul>
<li>
<p>PostgreSQL: Support new relkind for partitioned tables.</p>
<p>Fixes #33008.</p>
<p><em>Yannick Schutz</em></p>
</li>
<li>
<p>Rollback parent transaction when children fails to update.</p>
<p><em>Guillaume Malette</em></p>
</li>
<li>
<p>Fix default value for MySQL time types with specified precision.</p>
<p><em>Nikolay Kondratyev</em></p>
</li>
<li>
<p>Fix <code>touch</code> option to behave consistently with <code>Persistence#touch</code> method.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix <code>save</code> in <code>after_create_commit</code> won't invoke extra <code>after_create_commit</code>.</p>
<p>Fixes #32831.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix logic on disabling commit callbacks so they are not called unexpectedly when errors occur.</p>
<p><em>Brian Durand</em></p>
</li>
<li>
<p>Fix parent record should not get saved with duplicate children records.</p>
<p>Fixes #32940.</p>
<p><em>Santosh Wadghule</em></p>
</li>
<li>
<p>Fix that association's after_touch is not called with counter cache.</p>
<p>Fixes #31559.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p><code>becomes</code> should clear the mutation tracker which is created in <code>after_initialize</code>.</p>
<p>Fixes #32867.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Allow a belonging to parent object to be created from a new record.</p>
<p><em>Jolyon Pawlyn</em></p>
</li>
<li>
<p>Fix that building record with assigning multiple has_one associations
wrongly persists through record.</p>
<p>Fixes #32511.</p>
<p><em>Sam DeCesare</em></p>
</li>
<li>
<p>Fix relation merging when one of the relations is going to skip the
query cache.</p>
<p><em>James Williams</em></p>
</li>
</ul>
<h2>Rails 5.2.0 (April 09, 2018)</h2>
<ul>
<li>
<p>MySQL: Support mysql2 0.5.x.</p>
<p><em>Aaron Stone</em></p>
</li>
<li>
<p>Apply time column precision on assignment.</p>
<p>PR #20317 changed the behavior of datetime columns so that when they
have a specified precision then on assignment the value is rounded to
that precision. This behavior is now applied to time columns as well.</p>
<p>Fixes #30301.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Normalize time column values for SQLite database.</p>
<p>For legacy reasons, time columns in SQLite are stored as full datetimes
because until #24542 the quoting for time columns didn't remove the date
component. To ensure that values are consistent we now normalize the
date component to 2001-01-01 on reading and writing.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Ensure that the date component is removed when quoting times.</p>
<p>PR #24542 altered the quoting for time columns so that the date component
was removed however it only removed it when it was 2001-01-01. Now the
date component is removed irrespective of what the date is.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Fix <code>dependent: :destroy</code> issue for has_one/belongs_to relationship where
the parent class was getting deleted when the child was not.</p>
<p>Fixes #32022.</p>
<p><em>Fernando Gorodscy</em></p>
</li>
<li>
<p>Whitelist <code>NULLS FIRST</code> and <code>NULLS LAST</code> in order clauses too.</p>
<p><em>Xavier Noria</em></p>
</li>
<li>
<p>Fix that after commit callbacks on update does not triggered when optimistic locking is enabled.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix <code>#columns_for_distinct</code> of MySQL and PostgreSQL to make
ActiveRecord::FinderMethods#limited_ids_for use correct primary key values
even if <code>ORDER BY</code> columns include other table's primary key.</p>
<p>Fixes #28364.</p>
<p><em>Takumi Kagiyama</em></p>
</li>
<li>
<p>Make <code>reflection.klass</code> raise if <code>polymorphic?</code> not to be misused.</p>
<p>Fixes #31876.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>PostgreSQL: Allow pg-1.0 gem to be used with Active Record.</p>
<p><em>Lars Kanis</em></p>
</li>
<li>
<p>Deprecate <code>expand_hash_conditions_for_aggregates</code> without replacement.
Using a <code>Relation</code> for performing queries is the prefered API.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix not expanded problem when passing an <a href="Array.html" title="Array (class)"><code>Array</code></a> object as argument to the where method using <code>composed_of</code> column.</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_david_balance'>david_balance</span> <span class='op'>=</span> <span class='id identifier rubyid_customers'>customers</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_david'>david</span>).<span class='id identifier rubyid_balance'>balance</span>
<span class='const'>Customer</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>balance:</span> [<span class='id identifier rubyid_david_balance'>david_balance</span>]).<span class='id identifier rubyid_to_sql'>to_sql</span>

<span class='comment'># Before: WHERE `customers`.`balance` = NULL
</span><span class='comment'># After : WHERE `customers`.`balance` = 50</span></code></pre>
<p>Fixes #31723.</p>
<p><em>Yutaro Kanagawa</em></p>
</li>
<li>
<p>Fix <code>count(:all)</code> with eager loading and having an order other than the driving table.</p>
<p>Fixes #31783.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Clear the transaction state when an Active Record object is duped.</p>
<p>Fixes #31670.</p>
<p><em>Yuriy Ustushenko</em></p>
</li>
<li>
<p>Support for PostgreSQL foreign tables.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Fix relation merger issue with <code>left_outer_joins</code>.</p>
<p><em>Mehmet Emin İNAÇ</em></p>
</li>
<li>
<p>Don't allow destroyed object mutation after <code>save</code> or <code>save!</code> is called.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Take into account association conditions when deleting through records.</p>
<p>Fixes #18424.</p>
<p><em>Piotr Jakubowski</em></p>
</li>
<li>
<p>Fix nested <code>has_many :through</code> associations on unpersisted parent instances.</p>
<p>For example, if you have</p>
<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_books'>books</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_books'>books</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Author</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_one'>has_one</span> <span class='symbeg'>:</span><span class='id identifier rubyid_post'>post</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_books'>books</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='comma'>,</span> <span class='label'>through:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_books'>books</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Book</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_author'>author</span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_subscriptions'>subscriptions</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Subscription</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="ActiveRecord/Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_book'>book</span>
<span class='kw'>end</span></code></pre>
<p>Before:</p>
<p>If <code>post</code> is not persisted, then <code>post.subscriptions</code> will be empty.</p>
<p>After:</p>
<p>If <code>post</code> is not persisted, then <code>post.subscriptions</code> can be set and used
just like it would if <code>post</code> were persisted.</p>
<p>Fixes #16313.</p>
<p><em>Zoltan Kiss</em></p>
</li>
<li>
<p>Fixed inconsistency with <code>first(n)</code> when used with <code>limit()</code>.
The <code>first(n)</code> finder now respects the <code>limit()</code>, making it consistent
with <code>relation.to_a.first(n)</code>, and also with the behavior of <code>last(n)</code>.</p>
<p>Fixes #23979.</p>
<p><em>Brian Christian</em></p>
</li>
<li>
<p>Use <code>count(:all)</code> in <code>HasManyAssociation#count_records</code> to prevent invalid
SQL queries for association counting.</p>
<p><em>Klas Eskilson</em></p>
</li>
<li>
<p>Fix to invoke callbacks when using <code>update_attribute</code>.</p>
<p><em>Mike Busch</em></p>
</li>
<li>
<p>Fix <code>count(:all)</code> to correctly work <code>distinct</code> with custom SELECT list.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Using subselect for <code>delete_all</code> with <code>limit</code> or <code>offset</code>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Undefine attribute methods on descendants when resetting column
information.</p>
<p><em>Chris Salzberg</em></p>
</li>
<li>
<p>Log database query callers.</p>
<p>Add <code>verbose_query_logs</code> configuration option to display the caller
of database queries in the log to facilitate N+1 query resolution
and other debugging.</p>
<p>Enabled in development only for new and upgraded applications. Not
recommended for use in the production environment since it relies
on Ruby's <code>Kernel#caller_locations</code> which is fairly slow.</p>
<p><em>Olivier Lacan</em></p>
</li>
<li>
<p>Fix conflicts <code>counter_cache</code> with <code>touch: true</code> by optimistic locking.</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># create_table :posts do |t|
</span><span class='comment'>#   t.integer :comments_count, default: 0
</span><span class='comment'>#   t.integer :lock_version
</span><span class='comment'>#   t.timestamps
</span><span class='comment'># end
</span><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
<span class='kw'>end</span>

<span class='comment'># create_table :comments do |t|
</span><span class='comment'>#   t.belongs_to :post
</span><span class='comment'># end
</span><span class='kw'>class</span> <span class='const'>Comment</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_post'>post</span><span class='comma'>,</span> <span class='label'>touch:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>counter_cache:</span> <span class='kw'>true</span>
<span class='kw'>end</span></code></pre>
<p>Before:</p>
<pre class="code ruby"><code class="ruby">post = Post.create!
# =&gt; begin transaction
     INSERT INTO &quot;posts&quot; (&quot;created_at&quot;, &quot;updated_at&quot;, &quot;lock_version&quot;)
     VALUES (&quot;2017-12-11 21:27:11.387397&quot;, &quot;2017-12-11 21:27:11.387397&quot;, 0)
     commit transaction

comment = Comment.create!(post: post)
# =&gt; begin transaction
     INSERT INTO &quot;comments&quot; (&quot;post_id&quot;) VALUES (1)

     UPDATE &quot;posts&quot; SET &quot;comments_count&quot; = COALESCE(&quot;comments_count&quot;, 0) + 1,
     &quot;lock_version&quot; = COALESCE(&quot;lock_version&quot;, 0) + 1 WHERE &quot;posts&quot;.&quot;id&quot; = 1

     UPDATE &quot;posts&quot; SET &quot;updated_at&quot; = &#39;2017-12-11 21:27:11.398330&#39;,
     &quot;lock_version&quot; = 1 WHERE &quot;posts&quot;.&quot;id&quot; = 1 AND &quot;posts&quot;.&quot;lock_version&quot; = 0
     rollback transaction
# =&gt; ActiveRecord::StaleObjectError: Attempted to touch a stale object: Post.

Comment.take.destroy!
# =&gt; begin transaction
     DELETE FROM &quot;comments&quot; WHERE &quot;comments&quot;.&quot;id&quot; = 1

     UPDATE &quot;posts&quot; SET &quot;comments_count&quot; = COALESCE(&quot;comments_count&quot;, 0) - 1,
     &quot;lock_version&quot; = COALESCE(&quot;lock_version&quot;, 0) + 1 WHERE &quot;posts&quot;.&quot;id&quot; = 1

     UPDATE &quot;posts&quot; SET &quot;updated_at&quot; = &#39;2017-12-11 21:42:47.785901&#39;,
     &quot;lock_version&quot; = 1 WHERE &quot;posts&quot;.&quot;id&quot; = 1 AND &quot;posts&quot;.&quot;lock_version&quot; = 0
     rollback transaction
# =&gt; ActiveRecord::StaleObjectError: Attempted to touch a stale object: Post.</code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby">post = Post.create!
# =&gt; begin transaction
     INSERT INTO &quot;posts&quot; (&quot;created_at&quot;, &quot;updated_at&quot;, &quot;lock_version&quot;)
     VALUES (&quot;2017-12-11 21:27:11.387397&quot;, &quot;2017-12-11 21:27:11.387397&quot;, 0)
     commit transaction

comment = Comment.create!(post: post)
# =&gt; begin transaction
     INSERT INTO &quot;comments&quot; (&quot;post_id&quot;) VALUES (1)

     UPDATE &quot;posts&quot; SET &quot;comments_count&quot; = COALESCE(&quot;comments_count&quot;, 0) + 1,
     &quot;lock_version&quot; = COALESCE(&quot;lock_version&quot;, 0) + 1,
     &quot;updated_at&quot; = &#39;2017-12-11 21:37:09.802642&#39; WHERE &quot;posts&quot;.&quot;id&quot; = 1
     commit transaction

comment.destroy!
# =&gt; begin transaction
     DELETE FROM &quot;comments&quot; WHERE &quot;comments&quot;.&quot;id&quot; = 1

     UPDATE &quot;posts&quot; SET &quot;comments_count&quot; = COALESCE(&quot;comments_count&quot;, 0) - 1,
     &quot;lock_version&quot; = COALESCE(&quot;lock_version&quot;, 0) + 1,
     &quot;updated_at&quot; = &#39;2017-12-11 21:39:02.685520&#39; WHERE &quot;posts&quot;.&quot;id&quot; = 1
     commit transaction</code></pre>
<p>Fixes #31199.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Add support for PostgreSQL operator classes to <code>add_index</code>.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_add_index'>add_index</span> <span class='symbeg'>:</span><span class='id identifier rubyid_users'>users</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>using:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_gist'>gist</span><span class='comma'>,</span> <span class='label'>opclass:</span> { <span class='label'>name:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_gist_trgm_ops'>gist_trgm_ops</span> }</code></pre>
<p><em>Greg Navis</em></p>
</li>
<li>
<p>Don't allow scopes to be defined which conflict with instance methods on <code>Relation</code>.</p>
<p>Fixes #31120.</p>
<p><em>kinnrot</em></p>
</li>
<li>
<p>Add new error class <code>QueryCanceled</code> which will be raised
when canceling statement due to user request.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Add <code>#up_only</code> to database migrations for code that is only relevant when
migrating up, e.g. populating a new column.</p>
<p><em>Rich Daley</em></p>
</li>
<li>
<p>Require raw SQL fragments to be explicitly marked when used in
relation query methods.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LENGTH(title)</span><span class='tstring_end'>&quot;</span></span>)</code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_order'>order</span>(<span class='const'>Arel</span>.<span class='id identifier rubyid_sql'>sql</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LENGTH(title)</span><span class='tstring_end'>&quot;</span></span>))</code></pre>
<p>This prevents SQL injection if applications use the [strongly
discouraged] form <code>Article.order(params[:my_order])</code>, under the
mistaken belief that only column names will be accepted.</p>
<p>Raw SQL strings will now cause a deprecation warning, which will
become an UnknownAttributeReference error in Rails 6.0. Applications
can opt in to the future behavior by setting <code>allow_unsafe_raw_sql</code>
to <code>:disabled</code>.</p>
<p>Common and judged-safe string values (such as simple column
references) are unaffected:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_order'>order</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title DESC</span><span class='tstring_end'>&quot;</span></span>)</code></pre>
<p><em>Ben Toews</em></p>
</li>
<li>
<p><code>update_all</code> will now pass its values to <code>Type#cast</code> before passing them to
<code>Type#serialize</code>. This means that <code>update_all(foo: 'true')</code> will properly
persist a boolean.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Add new error class <code>StatementTimeout</code> which will be raised
when statement timeout exceeded.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix <code>bin/rails db:migrate</code> with specified <code>VERSION</code>.
<code>bin/rails db:migrate</code> with empty VERSION behaves as without <code>VERSION</code>.
Check a format of <code>VERSION</code>: Allow a migration version number
or name of a migration file. Raise error if format of <code>VERSION</code> is invalid.
Raise error if target migration doesn't exist.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Fixed a bug where column orders for an index weren't written to
<code>db/schema.rb</code> when using the sqlite adapter.</p>
<p>Fixes #30902.</p>
<p><em>Paul Kuruvilla</em></p>
</li>
<li>
<p>Remove deprecated method <code>#sanitize_conditions</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated method <code>#scope_chain</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated configuration <code>.error_on_ignored_order_or_limit</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated arguments from <code>#verify!</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated argument <code>name</code> from <code>#indexes</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated method <code>ActiveRecord::Migrator.schema_migrations_table_name</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated method <code>supports_primary_key?</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated method <code>supports_migrations?</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated methods <code>initialize_schema_migrations_table</code> and <code>initialize_internal_metadata_table</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Raises when calling <code>lock!</code> in a dirty record.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated support to passing a class to <code>:class_name</code> on associations.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated argument <code>default</code> from <code>index_name_exists?</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated support to <code>quoted_id</code> when typecasting an Active Record object.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Fix <code>bin/rails db:setup</code> and <code>bin/rails db:test:prepare</code> create wrong
ar_internal_metadata's data for a test database.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby">$ RAILS_ENV=test rails dbconsole
&gt; SELECT * FROM ar_internal_metadata;
key|value|created_at|updated_at
environment|development|2017-09-11 23:14:10.815679|2017-09-11 23:14:10.815679</code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby">$ RAILS_ENV=test rails dbconsole
&gt; SELECT * FROM ar_internal_metadata;
key|value|created_at|updated_at
environment|test|2017-09-11 23:14:10.815679|2017-09-11 23:14:10.815679</code></pre>
<p>Fixes #26731.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Fix longer sequence name detection for serial columns.</p>
<p>Fixes #28332.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>MySQL: Don't lose <code>auto_increment: true</code> in the <code>db/schema.rb</code>.</p>
<p>Fixes #30894.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix <code>COUNT(DISTINCT ...)</code> for <code>GROUP BY</code> with <code>ORDER BY</code> and <code>LIMIT</code>.</p>
<p>Fixes #30886.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>PostgreSQL <code>tsrange</code> now preserves subsecond precision.</p>
<p>PostgreSQL 9.1+ introduced range types, and Rails added support for using
this datatype in Active Record. However, the serialization of
<code>PostgreSQL::OID::Range</code> was incomplete, because it did not properly
cast the bounds that make up the range. This led to subseconds being
dropped in SQL commands:</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_type_cast'>type_cast</span>(<span class='id identifier rubyid_tsrange'>tsrange</span>.<span class='id identifier rubyid_serialize'>serialize</span>(<span class='id identifier rubyid_range_value'>range_value</span>))
<span class='comment'># =&gt; &quot;[2010-01-01 13:30:00 UTC,2011-02-02 19:30:00 UTC)&quot;</span></code></pre>
<p>Now:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_type_cast'>type_cast</span>(<span class='id identifier rubyid_tsrange'>tsrange</span>.<span class='id identifier rubyid_serialize'>serialize</span>(<span class='id identifier rubyid_range_value'>range_value</span>))
<span class='comment'># =&gt; &quot;[2010-01-01 13:30:00.670277,2011-02-02 19:30:00.745125)&quot;</span></code></pre>
<p><em>Thomas Cannon</em></p>
</li>
<li>
<p>Passing a <code>Set</code> to <code>Relation#where</code> now behaves the same as passing an
array.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Use given algorithm while removing index from database.</p>
<p>Fixes #24190.</p>
<p><em>Mehmet Emin İNAÇ</em></p>
</li>
<li>
<p>Update payload names for <code>sql.active_record</code> instrumentation to be
more descriptive.</p>
<p>Fixes #30586.</p>
<p><em>Jeremy Green</em></p>
</li>
<li>
<p>Add new error class <code>LockWaitTimeout</code> which will be raised
when lock wait timeout exceeded.</p>
<p><em>Gabriel Courtemanche</em></p>
</li>
<li>
<p>Remove deprecated <code>#migration_keys</code>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Automatically guess the inverse associations for STI.</p>
<p><em>Yuichiro Kaneko</em></p>
</li>
<li>
<p>Ensure <code>sum</code> honors <code>distinct</code> on <code>has_many :through</code> associations.</p>
<p>Fixes #16791.</p>
<p><em>Aaron Wortham</em></p>
</li>
<li>
<p>Add <code>binary</code> fixture helper method.</p>
<p><em>Atsushi Yoshida</em></p>
</li>
<li>
<p>When using <code>Relation#or</code>, extract the common conditions and put them before the OR condition.</p>
<p><em>Maxime Handfield Lapointe</em></p>
</li>
<li>
<p><code>Relation#or</code> now accepts two relations who have different values for
<code>references</code> only, as <code>references</code> can be implicitly called by <code>where</code>.</p>
<p>Fixes #29411.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>ApplicationRecord</code> is no longer generated when generating models. If you
need to generate it, it can be created with <code>rails g application_record</code>.</p>
<p><em>Lisa Ugray</em></p>
</li>
<li>
<p>Fix <code>COUNT(DISTINCT ...)</code> with <code>ORDER BY</code> and <code>LIMIT</code> to keep the existing select list.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>When a <code>has_one</code> association is destroyed by <code>dependent: destroy</code>,
<code>destroyed_by_association</code> will now be set to the reflection, matching the
behaviour of <code>has_many</code> associations.</p>
<p><em>Lisa Ugray</em></p>
</li>
<li>
<p>Fix <code>unscoped(where: [columns])</code> removing the wrong bind values.</p>
<p>When the <code>where</code> is called on a relation after a <code>or</code>, unscoping the column of that later <code>where</code> removed
bind values used by the <code>or</code> instead. (possibly other cases too)</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>id:</span> <span class='int'>1</span>).<span class='id identifier rubyid_or'>or</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>id:</span> <span class='int'>2</span>)).<span class='id identifier rubyid_where'>where</span>(<span class='label'>foo:</span> <span class='int'>3</span>).<span class='id identifier rubyid_unscope'>unscope</span>(<span class='label'>where:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_foo'>foo</span>).<span class='id identifier rubyid_to_sql'>to_sql</span>
<span class='comment'># Currently:
</span><span class='comment'>#     SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE (&quot;posts&quot;.&quot;id&quot; = 2 OR &quot;posts&quot;.&quot;id&quot; = 3)
</span><span class='comment'># With fix:
</span><span class='comment'>#     SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE (&quot;posts&quot;.&quot;id&quot; = 1 OR &quot;posts&quot;.&quot;id&quot; = 2)</span></code></pre>
<p><em>Maxime Handfield Lapointe</em></p>
</li>
<li>
<p>Values constructed using multi-parameter assignment will now use the
post-type-cast value for rendering in single-field form inputs.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p><code>Relation#joins</code> is no longer affected by the target model's
<code>current_scope</code>, with the exception of <code>unscoped</code>.</p>
<p>Fixes #29338.</p>
<p><em>Sean Griffin</em></p>
</li>
<li>
<p>Change sqlite3 boolean serialization to use 1 and 0.</p>
<p>SQLite natively recognizes 1 and 0 as true and false, but does not natively
recognize 't' and 'f' as was previously serialized.</p>
<p>This change in serialization requires a migration of stored boolean data
for SQLite databases, so it's implemented behind a configuration flag
whose default false value is deprecated.</p>
<p><em>Lisa Ugray</em></p>
</li>
<li>
<p>Skip query caching when working with batches of records (<code>find_each</code>, <code>find_in_batches</code>,
<code>in_batches</code>).</p>
<p>Previously, records would be fetched in batches, but all records would be retained in memory
until the end of the request or job.</p>
<p><em>Eugene Kenny</em></p>
</li>
<li>
<p>Prevent errors raised by <code>sql.active_record</code> notification subscribers from being converted into
<a href="ActiveRecord/StatementInvalid.html" title="ActiveRecord::StatementInvalid (class)"><code>::ActiveRecord::StatementInvalid</code></a> exceptions.</p>
<p><em>Dennis Taylor</em></p>
</li>
<li>
<p>Fix eager loading/preloading association with scope including joins.</p>
<p>Fixes #28324.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix transactions to apply state to child transactions.</p>
<p>Previously, if you had a nested transaction and the outer transaction was rolledback, the record from the
inner transaction would still be marked as persisted.</p>
<p>This change fixes that by applying the state of the parent transaction to the child transaction when the
parent transaction is rolledback. This will correctly mark records from the inner transaction as not persisted.</p>
<p><em>Eileen M. Uchitelle</em>, <em>Aaron Patterson</em></p>
</li>
<li>
<p>Deprecate <code>set_state</code> method in <code>TransactionState</code>.</p>
<p>Deprecated the <code>set_state</code> method in favor of setting the state via specific methods. If you need to mark the
state of the transaction you can now use <code>rollback!</code>, <code>commit!</code> or <code>nullify!</code> instead of
<code>set_state(:rolledback)</code>, <code>set_state(:committed)</code>, or <code>set_state(nil)</code>.</p>
<p><em>Eileen M. Uchitelle</em>, <em>Aaron Patterson</em></p>
</li>
<li>
<p>Deprecate delegating to <code>arel</code> in <code>Relation</code>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Query cache was unavailable when entering the <code>ActiveRecord::Base.cache</code> block
without being connected.</p>
<p><em>Tsukasa Oishi</em></p>
</li>
<li>
<p>Previously, when building records using a <code>has_many :through</code> association,
if the child records were deleted before the parent was saved, they would
still be persisted. Now, if child records are deleted before the parent is saved
on a <code>has_many :through</code> association, the child records will not be persisted.</p>
<p><em>Tobias Kraze</em></p>
</li>
<li>
<p>Merging two relations representing nested joins no longer transforms the joins of
the merged relation into LEFT OUTER JOIN.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Author</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>).<span class='id identifier rubyid_merge'>merge</span>(<span class='const'>Post</span>.<span class='id identifier rubyid_joins'>joins</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_comments'>comments</span>))
<span class='comment'># Before the change:
</span><span class='comment'>#=&gt; SELECT ... FROM authors INNER JOIN posts ON ... LEFT OUTER JOIN comments ON...
</span>
<span class='comment'># After the change:
</span><span class='comment'>#=&gt; SELECT ... FROM authors INNER JOIN posts ON ... INNER JOIN comments ON...</span></code></pre>
<p><em>Maxime Handfield Lapointe</em></p>
</li>
<li>
<p><a href="ActiveRecord/Persistence.html#touch-instance_method" title="ActiveRecord::Persistence#touch (method)">ActiveRecord::Persistence#touch</a> does not work well when optimistic locking enabled and
<code>locking_column</code>, without default value, is null in the database.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Fix destroying existing object does not work well when optimistic locking enabled and
<code>locking_column</code> is null in the database.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Use bulk INSERT to insert fixtures for better performance.</p>
<p><em>Kir Shatrov</em></p>
</li>
<li>
<p>Prevent creation of bind param if casted value is nil.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Deprecate passing arguments and block at the same time to <code>count</code> and <code>sum</code> in <a href="ActiveRecord/Calculations.html" title="ActiveRecord::Calculations (module)"><code>::ActiveRecord::Calculations</code></a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Loading model schema from database is now thread-safe.</p>
<p>Fixes #28589.</p>
<p><em>Vikrant Chaudhary</em>, <em>David Abdemoulaie</em></p>
</li>
<li>
<p>Add <code>ActiveRecord::Base#cache_version</code> to support recyclable cache keys via the new versioned entries
in <a href="ActiveSupport/Cache.html" title="ActiveSupport::Cache (module)"><code>::ActiveSupport::Cache</code></a>. This also means that <code>ActiveRecord::Base#cache_key</code> will now return a stable key
that does not include a timestamp any more.</p>
<p>NOTE: This feature is turned off by default, and <code>#cache_key</code> will still return cache keys with timestamps
until you set <code>ActiveRecord::Base.cache_versioning = true</code>. That's the setting for all new apps on Rails 5.2+</p>
<p><em>DHH</em></p>
</li>
<li>
<p>Respect <code>SchemaDumper.ignore_tables</code> in rake tasks for databases structure dump.</p>
<p><em>Rusty Geldmacher</em>, <em>Guillermo Iguaran</em></p>
</li>
<li>
<p>Add type caster to <code>RuntimeReflection#alias_name</code>.</p>
<p>Fixes #28959.</p>
<p><em>Jon Moss</em></p>
</li>
<li>
<p>Deprecate <code>supports_statement_cache?</code>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Raise error <code>UnknownMigrationVersionError</code> on the movement of migrations
when the current migration does not exist.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Fix <code>bin/rails db:forward</code> first migration.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Support Descending Indexes for MySQL.</p>
<p>MySQL 8.0.1 and higher supports descending indexes: <code>DESC</code> in an index definition is no longer ignored.
See <a href="https://dev.mysql.com/doc/refman/8.0/en/descending-indexes.html">https://dev.mysql.com/doc/refman/8.0/en/descending-indexes.html</a>.</p>
<p><em>Ryuta Kamizono</em></p>
</li>
<li>
<p>Fix inconsistency with changed attributes when overriding Active Record attribute reader.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>When calling the dynamic fixture accessor method with no arguments, it now returns all fixtures of this type.
Previously this method always returned an empty array.</p>
<p><em>Kevin McPhillips</em></p>
</li>
</ul>
<p>Please check <a href="https://github.com/rails/rails/blob/5-1-stable/activerecord/CHANGELOG.md" target="_parent" title="5-1-stable">5-1-stable</a> for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>