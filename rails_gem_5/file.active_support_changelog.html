<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Active Support CHANGELOG &mdash; Rails 5.2.8.1</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "active_support_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 5.2.8.1</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Active Support CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h2>Rails 5.2.8.1 (July 12, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.8 (May 09, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.7.1 (April 26, 2022)</h2>
<ul>
<li>
<p>Fix and add protections for XSS in <a href="ActionView/Helpers.html" title="ActionView::Helpers (module)"><code>::ActionView::Helpers</code></a> and <a href="ERB/Util.html" title="ERB::Util (module)"><code>::ERB::Util</code></a>.</p>
<p>Add the method <a href="ERB/Util.html#xml_name_escape-class_method" title="ERB::Util.xml_name_escape (method)">ERB::Util.xml_name_escape</a> to escape dangerous characters
in names of tags and names of attributes, following the specification of XML.</p>
<p><em>Álvaro Martín Fraguas</em></p>
</li>
</ul>
<h2>Rails 5.2.7 (March 10, 2022)</h2>
<ul>
<li>
<p>Restore support to Ruby 2.2.</p>
<p><em>ojab</em></p>
</li>
</ul>
<h2>Rails 5.2.6.3 (March 08, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.2 (February 11, 2022)</h2>
<ul>
<li>Fix Reloader method signature to work with the new Executor signature</li>
</ul>
<h2>Rails 5.2.6.1 (February 11, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6 (May 05, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.5 (March 26, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.6 (May 05, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.5 (February 10, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.4 (September 09, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.3 (May 18, 2020)</h2>
<ul>
<li>
<p>[CVE-2020-8165] Deprecate Marshal.load on raw cache read in RedisCacheStore</p>
</li>
<li>
<p>[CVE-2020-8165] Avoid Marshal.load on raw cache value in MemCacheStore</p>
</li>
</ul>
<h2>Rails 5.2.4.2 (March 19, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.1 (December 18, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4 (November 27, 2019)</h2>
<ul>
<li>
<p>Make ActiveSupport::Logger Fiber-safe. Fixes #36752.</p>
<p>Use <code>Fiber.current.<strong>id</strong></code> in <code>ActiveSupport::Logger#local_level=</code> in order
to make log level local to Ruby Fibers in addition to Threads.</p>
<p>Example:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Logger.html" title="ActiveSupport::Logger (class)">Logger</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/Logger.html#new-class_method" title="ActiveSupport::Logger.new (method)">new</a></span>(<span class='const'>STDOUT</span>)
<span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_p'>p</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Main is debug? </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_debug?'>debug?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

<span class='const'>Fiber</span>.<span class='id identifier rubyid_new'>new</span> {
  <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_local_level'>local_level</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_p'>p</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thread is debug? </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_debug?'>debug?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
}.<span class='id identifier rubyid_resume'>resume</span>

<span class='id identifier rubyid_p'>p</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Main is debug? </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_debug?'>debug?</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span></code></pre>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Main</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_debug?'>debug?</span> <span class='kw'>false</span>
<span class='const'>Thread</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_debug?'>debug?</span> <span class='kw'>true</span>
<span class='const'>Main</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_debug?'>debug?</span> <span class='kw'>true</span></code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>Main</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_debug?'>debug?</span> <span class='kw'>false</span>
<span class='const'>Thread</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_debug?'>debug?</span> <span class='kw'>true</span>
<span class='const'>Main</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_debug?'>debug?</span> <span class='kw'>false</span></code></pre>
<p><em>Alexander Varnin</em></p>
</li>
</ul>
<h2>Rails 5.2.3 (March 27, 2019)</h2>
<ul>
<li>
<p>Add <a href="ActiveSupport/HashWithIndifferentAccess.html#assoc-instance_method" title="ActiveSupport::HashWithIndifferentAccess#assoc (method)">ActiveSupport::HashWithIndifferentAccess#assoc</a>.</p>
<p><code>assoc</code> can now be called with either a string or a symbol.</p>
<p><em>Stefan Schüßler</em></p>
</li>
<li>
<p>Fix <a href="String.html#safe_constantize-instance_method" title="String#safe_constantize (method)">String#safe_constantize</a> throwing a <a href="LoadError.html" title="LoadError (class)"><code>LoadError</code></a> for incorrectly cased constant references.</p>
<p><em>Keenan Brock</em></p>
</li>
<li>
<p>Allow Range#=== and Range#cover? on <a href="Range.html" title="Range (class)"><code>Range</code></a></p>
<p><code>Range#cover?</code> can now accept a range argument like <code>Range#include?</code> and
<code>Range#===</code>. <code>Range#===</code> works correctly on Ruby 2.6. <code>Range#include?</code> is moved
into a new file, with these two methods.</p>
<p><em>utilum</em></p>
</li>
<li>
<p>If the same block is <code>included</code> multiple times for a Concern, an exception is no longer raised.</p>
<p><em>Mark J. Titorenko</em>, <em>Vlad Bokov</em></p>
</li>
</ul>
<h2>Rails 5.2.2.1 (March 11, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.2 (December 04, 2018)</h2>
<ul>
<li>
<p>Fix bug where <code>#to_options</code> for <a href="ActiveSupport/HashWithIndifferentAccess.html" title="ActiveSupport::HashWithIndifferentAccess (class)"><code>::ActiveSupport::HashWithIndifferentAccess</code></a>
would not act as alias for <code>#symbolize_keys</code>.</p>
<p><em>Nick Weiland</em></p>
</li>
<li>
<p>Improve the logic that detects non-autoloaded constants.</p>
<p><em>Jan Habermann</em>, <em>Xavier Noria</em></p>
</li>
<li>
<p>Fix bug where <code>URI.unescape</code> would fail with mixed Unicode/escaped character input:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="URI.html" title="URI (module)">URI</a></span>.<span class='id identifier rubyid_unescape'>unescape</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xe3\x83\x90</span><span class='tstring_end'>&quot;</span></span>)  <span class='comment'># =&gt; &quot;バ&quot;
</span><span class='const'><a href="URI.html" title="URI (module)">URI</a></span>.<span class='id identifier rubyid_unescape'>unescape</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%E3%83%90</span><span class='tstring_end'>&quot;</span></span>)  <span class='comment'># =&gt; &quot;バ&quot;
</span><span class='const'><a href="URI.html" title="URI (module)">URI</a></span>.<span class='id identifier rubyid_unescape'>unescape</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xe3\x83\x90%E3%83%90</span><span class='tstring_end'>&quot;</span></span>)  <span class='comment'># =&gt; Encoding::CompatibilityError</span></code></pre>
<p><em>Ashe Connor</em>, <em>Aaron Patterson</em></p>
</li>
</ul>
<h2>Rails 5.2.1.1 (November 27, 2018)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.1 (August 07, 2018)</h2>
<ul>
<li>
<p>Redis cache store: <code>delete_matched</code> no longer blocks the Redis server.
(Switches from evaled Lua to a batched SCAN + DEL loop.)</p>
<p><em>Gleb Mazovetskiy</em></p>
</li>
<li>
<p>Fix bug where <code>ActiveSupport::Timezone.all</code> would fail when tzinfo data for
any timezone defined in <a href="ActiveSupport/TimeZone.html#MAPPING-constant" title="ActiveSupport::TimeZone::MAPPING (constant)">ActiveSupport::TimeZone::MAPPING</a> is missing.</p>
<p><em>Dominik Sander</em></p>
</li>
<li>
<p>Fix bug where <a href="ActiveSupport/Cache.html" title="ActiveSupport::Cache (module)"><code>::ActiveSupport::Cache</code></a> will massively inflate the storage
size when compression is enabled (which is true by default). This patch
does not attempt to repair existing data: please manually flush the cache
to clear out the problematic entries.</p>
<p><em>Godfrey Chan</em></p>
</li>
<li>
<p>Fix <code>ActiveSupport::Cache#read_multi</code> bug with local cache enabled that was
returning instances of <a href="ActiveSupport/Cache/Entry.html" title="ActiveSupport::Cache::Entry (class)"><code>::ActiveSupport::Cache::Entry</code></a> instead of the raw values.</p>
<p><em>Jason Lee</em></p>
</li>
</ul>
<h2>Rails 5.2.0 (April 09, 2018)</h2>
<ul>
<li>
<p>Caching: MemCache and Redis <code>read_multi</code> and <code>fetch_multi</code> speedup.
Read from the local in-memory cache before consulting the backend.</p>
<p><em>Gabriel Sobrinho</em></p>
</li>
<li>
<p>Return all mappings for a timezone identifier in <code>country_zones</code>.</p>
<p>Some timezones like <code>Europe/London</code> have multiple mappings in
<a href="ActiveSupport/TimeZone.html#MAPPING-constant" title="ActiveSupport::TimeZone::MAPPING (constant)">ActiveSupport::TimeZone::MAPPING</a> so return all of them instead
of the first one found by using <code>Hash#value</code>. e.g:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TimeZone.html" title="ActiveSupport::TimeZone (class)">TimeZone</a></span>.<span class='id identifier rubyid_country_zones'><a href="ActiveSupport/TimeZone.html#country_zones-class_method" title="ActiveSupport::TimeZone.country_zones (method)">country_zones</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GB</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; [&quot;Edinburgh&quot;]
</span>
<span class='comment'># After
</span><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/TimeZone.html" title="ActiveSupport::TimeZone (class)">TimeZone</a></span>.<span class='id identifier rubyid_country_zones'><a href="ActiveSupport/TimeZone.html#country_zones-class_method" title="ActiveSupport::TimeZone.country_zones (method)">country_zones</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GB</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; [&quot;Edinburgh&quot;, &quot;London&quot;]</span></code></pre>
<p>Fixes #31668.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add support for connection pooling on RedisCacheStore.</p>
<p><em>fatkodima</em></p>
</li>
<li>
<p>Support hash as first argument in <code>assert_difference</code>. This allows to specify multiple
numeric differences in the same assertion.</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert_difference'>assert_difference</span> <span class='tlambda'>-&gt;</span><span class='tlambeg'>{</span> <span class='const'>Article</span>.<span class='id identifier rubyid_count'>count</span> } <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span><span class='tlambeg'>{</span> <span class='const'>Post</span>.<span class='id identifier rubyid_count'>count</span> } <span class='op'>=&gt;</span> <span class='int'>2</span></code></pre>
<p><em>Julien Meichelbeck</em></p>
</li>
<li>
<p>Add missing instrumentation for <code>read_multi</code> in <a href="ActiveSupport/Cache/Store.html" title="ActiveSupport::Cache::Store (class)"><code>::ActiveSupport::Cache::Store</code></a>.</p>
<p><em>Ignatius Reza Lesmana</em></p>
</li>
<li>
<p><code>assert_changes</code> will always assert that the expression changes,
regardless of <code>from:</code> and <code>to:</code> argument combinations.</p>
<p><em>Daniel Ma</em></p>
</li>
<li>
<p>Use SHA-1 to generate non-sensitive digests, such as the ETag header.</p>
<p>Enabled by default for new apps; upgrading apps can opt in by setting
<code>config.active_support.use_sha1_digests = true</code>.</p>
<p><em>Dmitri Dolguikh</em>, <em>Eugene Kenny</em></p>
</li>
<li>
<p>Changed default behaviour of <a href="ActiveSupport/SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">ActiveSupport::SecurityUtils.secure_compare</a>,
to make it not leak length information even for variable length string.</p>
<p>Renamed old <a href="ActiveSupport/SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">ActiveSupport::SecurityUtils.secure_compare</a> to <code>fixed_length_secure_compare</code>,
and started raising <code>ArgumentError</code> in case of length mismatch of passed strings.</p>
<p><em>Vipul A M</em></p>
</li>
<li>
<p>Make <a href="ActiveSupport/TimeZone.html#all-class_method" title="ActiveSupport::TimeZone.all (method)">ActiveSupport::TimeZone.all</a> return only time zones that are in
<a href="ActiveSupport/TimeZone.html#MAPPING-constant" title="ActiveSupport::TimeZone::MAPPING (constant)">ActiveSupport::TimeZone::MAPPING</a>.</p>
<p>Fixes #7245.</p>
<p><em>Chris LaRose</em></p>
</li>
<li>
<p>MemCacheStore: Support expiring counters.</p>
<p>Pass <code>expires_in: [seconds]</code> to <code>#increment</code> and <code>#decrement</code> options
to set the Memcached TTL (time-to-live) if the counter doesn't exist.
If the counter exists, Memcached doesn't extend its expiry when it's
incremented or decremented.</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_increment'>increment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_counter</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='int'>2</span>.<span class='id identifier rubyid_minutes'>minutes</span>)</code></pre>
<p><em>Takumasa Ochi</em></p>
</li>
<li>
<p>Handle <code>TZInfo::AmbiguousTime</code> errors.</p>
<p>Make <a href="ActiveSupport/TimeWithZone.html" title="ActiveSupport::TimeWithZone (class)"><code>::ActiveSupport::TimeWithZone</code></a> match Ruby's handling of ambiguous
times by choosing the later period, e.g.</p>
<p>Ruby:</p>
<pre class="code ruby"><code class="ruby"><span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TZ</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Europe/Moscow</span><span class='tstring_end'>&quot;</span></span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_local'>local</span>(<span class='int'>2014</span><span class='comma'>,</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>26</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>)   <span class='comment'># =&gt; 2014-10-26 01:00:00 +0300</span></code></pre>
<p>Before:</p>
<pre class="code ruby"><code class="ruby">&gt;&gt; &quot;2014-10-26 01:00:00&quot;.in_time_zone(&quot;Moscow&quot;)
TZInfo::AmbiguousTime: 26/10/2014 01:00 is an ambiguous local time.</code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby">&gt;&gt; &quot;2014-10-26 01:00:00&quot;.in_time_zone(&quot;Moscow&quot;)
#=&gt; Sun, 26 Oct 2014 01:00:00 MSK +03:00</code></pre>
<p>Fixes #17395.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Redis cache store.</p>
<pre class="code ruby"><code class="ruby"># Defaults to `redis://localhost:6379/0`. Only use for dev/test.
config.cache_store = :redis_cache_store

# Supports all common cache store options (:namespace, :compress,
# :compress_threshold, :expires_in, :race_condition_ttl) and all
# Redis options.
cache_password = Rails.application.secrets.redis_cache_password
config.cache_store = :redis_cache_store, driver: :hiredis,
  namespace: &#39;myapp-cache&#39;, compress: true, timeout: 1,
  url: &quot;redis://:#{cache_password}@myapp-cache-1:6379/0&quot;

# Supports Redis::Distributed with multiple hosts
config.cache_store = :redis_cache_store, driver: :hiredis
  namespace: &#39;myapp-cache&#39;, compress: true,
  url: %w[
    redis://myapp-cache-1:6379/0
    redis://myapp-cache-1:6380/0
    redis://myapp-cache-2:6379/0
    redis://myapp-cache-2:6380/0
    redis://myapp-cache-3:6379/0
    redis://myapp-cache-3:6380/0
  ]

# Or pass a builder block
config.cache_store = :redis_cache_store,
  namespace: &#39;myapp-cache&#39;, compress: true,
  redis: -&gt; { Redis.new … }</code></pre>
<p>Deployment note: Take care to use a <em>dedicated Redis cache</em> rather
than pointing this at your existing Redis server. It won't cope well
with mixed usage patterns and it won't expire cache entries by default.</p>
<p>Redis cache server setup guide: <a href="https://redis.io/topics/lru-cache">https://redis.io/topics/lru-cache</a></p>
<p><em>Jeremy Daer</em></p>
</li>
<li>
<p>Cache: Enable compression by default for values &gt; 1kB.</p>
<p>Compression has long been available, but opt-in and at a 16kB threshold.
It wasn't enabled by default due to CPU cost. Today it's cheap and typical
cache data is eminently compressible, such as HTML or JSON fragments.
Compression dramatically reduces Memcached/Redis mem usage, which means
the same cache servers can store more data, which means higher hit rates.</p>
<p>To disable compression, pass <code>compress: false</code> to the initializer.</p>
<p><em>Jeremy Daer</em></p>
</li>
<li>
<p>Allow <code>Range#include?</code> on TWZ ranges.</p>
<p>In #11474 we prevented TWZ ranges being iterated over which matched
Ruby's handling of Time ranges and as a consequence <code>include?</code>
stopped working with both Time ranges and TWZ ranges. However in
ruby/ruby@b061634 support was added for <code>include?</code> to use <code>cover?</code>
for 'linear' objects. Since we have no way of making Ruby consider
TWZ instances as 'linear' we have to override <code>Range#include?</code>.</p>
<p>Fixes #30799.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Fix acronym support in <code>humanize</code>.</p>
<p>Acronym inflections are stored with lowercase keys in the hash but
the match wasn't being lowercased before being looked up in the hash.
This shouldn't have any performance impact because before it would
fail to find the acronym and perform the <code>downcase</code> operation anyway.</p>
<p>Fixes #31052.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add same method signature for <code>Time#prev_year</code> and <code>Time#next_year</code>
in accordance with <code>Date#prev_year</code>, <code>Date#next_year</code>.</p>
<p>Allows pass argument for <code>Time#prev_year</code> and <code>Time#next_year</code>.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_year'><a href="DateAndTime/Calculations.html#prev_year-instance_method" title="DateAndTime::Calculations#prev_year (method)">prev_year</a></span>    <span class='comment'># =&gt; 2016-09-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_year'><a href="DateAndTime/Calculations.html#prev_year-instance_method" title="DateAndTime::Calculations#prev_year (method)">prev_year</a></span>(<span class='int'>1</span>)
<span class='comment'># =&gt; ArgumentError: wrong number of arguments (given 1, expected 0)
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_year'><a href="DateAndTime/Calculations.html#next_year-instance_method" title="DateAndTime::Calculations#next_year (method)">next_year</a></span>    <span class='comment'># =&gt; 2018-09-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_year'><a href="DateAndTime/Calculations.html#next_year-instance_method" title="DateAndTime::Calculations#next_year (method)">next_year</a></span>(<span class='int'>1</span>)
<span class='comment'># =&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</span></code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_year'><a href="DateAndTime/Calculations.html#prev_year-instance_method" title="DateAndTime::Calculations#prev_year (method)">prev_year</a></span>    <span class='comment'># =&gt; 2016-09-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_year'><a href="DateAndTime/Calculations.html#prev_year-instance_method" title="DateAndTime::Calculations#prev_year (method)">prev_year</a></span>(<span class='int'>1</span>) <span class='comment'># =&gt; 2016-09-16 17:00:00 +0300
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_year'><a href="DateAndTime/Calculations.html#next_year-instance_method" title="DateAndTime::Calculations#next_year (method)">next_year</a></span>    <span class='comment'># =&gt; 2018-09-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_year'><a href="DateAndTime/Calculations.html#next_year-instance_method" title="DateAndTime::Calculations#next_year (method)">next_year</a></span>(<span class='int'>1</span>) <span class='comment'># =&gt; 2018-09-16 17:00:00 +0300</span></code></pre>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Add same method signature for <code>Time#prev_month</code> and <code>Time#next_month</code>
in accordance with <code>Date#prev_month</code>, <code>Date#next_month</code>.</p>
<p>Allows pass argument for <code>Time#prev_month</code> and <code>Time#next_month</code>.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_month'><a href="DateAndTime/Calculations.html#prev_month-instance_method" title="DateAndTime::Calculations#prev_month (method)">prev_month</a></span>    <span class='comment'># =&gt; 2017-08-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_month'><a href="DateAndTime/Calculations.html#prev_month-instance_method" title="DateAndTime::Calculations#prev_month (method)">prev_month</a></span>(<span class='int'>1</span>)
<span class='comment'># =&gt; ArgumentError: wrong number of arguments (given 1, expected 0)
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_month'><a href="DateAndTime/Calculations.html#next_month-instance_method" title="DateAndTime::Calculations#next_month (method)">next_month</a></span>    <span class='comment'># =&gt; 2017-10-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_month'><a href="DateAndTime/Calculations.html#next_month-instance_method" title="DateAndTime::Calculations#next_month (method)">next_month</a></span>(<span class='int'>1</span>)
<span class='comment'># =&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</span></code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_month'><a href="DateAndTime/Calculations.html#prev_month-instance_method" title="DateAndTime::Calculations#prev_month (method)">prev_month</a></span>    <span class='comment'># =&gt; 2017-08-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_month'><a href="DateAndTime/Calculations.html#prev_month-instance_method" title="DateAndTime::Calculations#prev_month (method)">prev_month</a></span>(<span class='int'>1</span>) <span class='comment'># =&gt; 2017-08-16 17:00:00 +0300
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_month'><a href="DateAndTime/Calculations.html#next_month-instance_method" title="DateAndTime::Calculations#next_month (method)">next_month</a></span>    <span class='comment'># =&gt; 2017-10-16 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_month'><a href="DateAndTime/Calculations.html#next_month-instance_method" title="DateAndTime::Calculations#next_month (method)">next_month</a></span>(<span class='int'>1</span>) <span class='comment'># =&gt; 2017-10-16 17:00:00 +0300</span></code></pre>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Add same method signature for <code>Time#prev_day</code> and <code>Time#next_day</code>
in accordance with <code>Date#prev_day</code>, <code>Date#next_day</code>.</p>
<p>Allows pass argument for <code>Time#prev_day</code> and <code>Time#next_day</code>.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_day'><a href="DateAndTime/Calculations.html#prev_day-instance_method" title="DateAndTime::Calculations#prev_day (method)">prev_day</a></span>    <span class='comment'># =&gt; 2017-09-15 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_day'><a href="DateAndTime/Calculations.html#prev_day-instance_method" title="DateAndTime::Calculations#prev_day (method)">prev_day</a></span>(<span class='int'>1</span>)
<span class='comment'># =&gt; ArgumentError: wrong number of arguments (given 1, expected 0)
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_day'><a href="DateAndTime/Calculations.html#next_day-instance_method" title="DateAndTime::Calculations#next_day (method)">next_day</a></span>    <span class='comment'># =&gt; 2017-09-17 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_day'><a href="DateAndTime/Calculations.html#next_day-instance_method" title="DateAndTime::Calculations#next_day (method)">next_day</a></span>(<span class='int'>1</span>)
<span class='comment'># =&gt; ArgumentError: wrong number of arguments (given 1, expected 0)</span></code></pre>
<p>After:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_day'><a href="DateAndTime/Calculations.html#prev_day-instance_method" title="DateAndTime::Calculations#prev_day (method)">prev_day</a></span>    <span class='comment'># =&gt; 2017-09-15 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_prev_day'><a href="DateAndTime/Calculations.html#prev_day-instance_method" title="DateAndTime::Calculations#prev_day (method)">prev_day</a></span>(<span class='int'>1</span>) <span class='comment'># =&gt; 2017-09-15 17:00:00 +0300
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_day'><a href="DateAndTime/Calculations.html#next_day-instance_method" title="DateAndTime::Calculations#next_day (method)">next_day</a></span>    <span class='comment'># =&gt; 2017-09-17 17:00:00 +0300
</span><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>17</span><span class='comma'>,</span> <span class='int'>0</span>).<span class='id identifier rubyid_next_day'><a href="DateAndTime/Calculations.html#next_day-instance_method" title="DateAndTime::Calculations#next_day (method)">next_day</a></span>(<span class='int'>1</span>) <span class='comment'># =&gt; 2017-09-17 17:00:00 +0300</span></code></pre>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p><code>IO#to_json</code> now returns the <code>to_s</code> representation, rather than
attempting to convert to an array. This fixes a bug where <code>IO#to_json</code>
would raise an <code>IOError</code> when called on an unreadable object.</p>
<p>Fixes #26132.</p>
<p><em>Paul Kuruvilla</em></p>
</li>
<li>
<p>Remove deprecated <code>halt_callback_chains_on_return_false</code> option.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Remove deprecated <code>:if</code> and <code>:unless</code> string filter for callbacks.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p><a href="Hash.html#slice-instance_method" title="Hash#slice (method)">Hash#slice</a> now falls back to Ruby 2.5+'s built-in definition if defined.</p>
<p><em>Akira Matsuda</em></p>
</li>
<li>
<p>Deprecate <code>secrets.secret_token</code>.</p>
<p>The architecture for secrets had a big upgrade between Rails 3 and Rails 4,
when the default changed from using <code>secret_token</code> to <code>secret_key_base</code>.</p>
<p><code>secret_token</code> has been soft deprecated in documentation for four years
but is still in place to support apps created before Rails 4.
Deprecation warnings have been added to help developers upgrade their
applications to <code>secret_key_base</code>.</p>
<p><em>claudiob</em>, <em>Kasper Timm Hansen</em></p>
</li>
<li>
<p>Return an instance of <a href="#HashWithIndifferentAccess-constant" title="HashWithIndifferentAccess (constant)">HashWithIndifferentAccess</a> from <code>HashWithIndifferentAccess#transform_keys</code>.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>Add key rotation support to <code>MessageEncryptor</code> and <code>MessageVerifier</code>.</p>
<p>This change introduces a <code>rotate</code> method to both the <code>MessageEncryptor</code> and
<code>MessageVerifier</code> classes. This method accepts the same arguments and
options as the given classes' constructor. The <code>encrypt_and_verify</code> method
for <code>MessageEncryptor</code> and the <code>verified</code> method for <code>MessageVerifier</code> also
accept an optional keyword argument <code>:on_rotation</code> block which is called
when a rotated instance is used to decrypt or verify the message.</p>
<p><em>Michael J Coyne</em></p>
</li>
<li>
<p>Deprecate <a href="Module.html#reachable%3F-instance_method" title="Module#reachable? (method)">Module#reachable?</a> method.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Add <code>config/credentials.yml.enc</code> to store production app secrets.</p>
<p>Allows saving any authentication credentials for third party services
directly in repo encrypted with <code>config/master.key</code> or <code>ENV["RAILS_MASTER_KEY"]</code>.</p>
<p>This will eventually replace <code>Rails.application.secrets</code> and the encrypted
secrets introduced in Rails 5.1.</p>
<p><em>DHH</em>, <em>Kasper Timm Hansen</em></p>
</li>
<li>
<p>Add <a href="ActiveSupport/EncryptedFile.html" title="ActiveSupport::EncryptedFile (class)"><code>::ActiveSupport::EncryptedFile</code></a> and <a href="ActiveSupport/EncryptedConfiguration.html" title="ActiveSupport::EncryptedConfiguration (class)"><code>::ActiveSupport::EncryptedConfiguration</code></a>.</p>
<p>Allows for stashing encrypted files or configuration directly in repo by
encrypting it with a key.</p>
<p>Backs the new credentials setup above, but can also be used independently.</p>
<p><em>DHH</em>, <em>Kasper Timm Hansen</em></p>
</li>
<li>
<p><a href="Module.html#delegate_missing_to-instance_method" title="Module#delegate_missing_to (method)">Module#delegate_missing_to</a> now raises <code>DelegationError</code> if target is nil,
similar to <a href="Module.html#delegate-instance_method" title="Module#delegate (method)">Module#delegate</a>.</p>
<p><em>Anton Khamets</em></p>
</li>
<li>
<p>Update <a href="String.html#camelize-instance_method" title="String#camelize (method)">String#camelize</a> to provide feedback when wrong option is passed.</p>
<p><a href="String.html#camelize-instance_method" title="String#camelize (method)">String#camelize</a> was returning nil without any feedback when an
invalid option was passed as a parameter.</p>
<p>Previously:</p>
<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>one_two</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_camelize'>camelize</span>(<span class='kw'>true</span>)
<span class='comment'># =&gt; nil</span></code></pre>
<p>Now:</p>
<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>one_two</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_camelize'>camelize</span>(<span class='kw'>true</span>)
<span class='comment'># =&gt; ArgumentError: Invalid option, use either :upper or :lower.</span></code></pre>
<p><em>Ricardo Díaz</em></p>
</li>
<li>
<p>Fix modulo operations involving durations.</p>
<p>Rails 5.1 introduced <a href="ActiveSupport/Duration/Scalar.html" title="ActiveSupport::Duration::Scalar (class)"><code>::ActiveSupport::Duration::Scalar</code></a> as a wrapper
around numeric values as a way of ensuring a duration was the outcome of
an expression. However, the implementation was missing support for modulo
operations. This support has now been added and should result in a duration
being returned from expressions involving modulo operations.</p>
<p>Prior to Rails 5.1:</p>
<pre class="code ruby"><code class="ruby"><span class='int'>5</span>.<span class='id identifier rubyid_minutes'>minutes</span> <span class='op'>%</span> <span class='int'>2</span>.<span class='id identifier rubyid_minutes'>minutes</span>
<span class='comment'># =&gt; 60</span></code></pre>
<p>Now:</p>
<pre class="code ruby"><code class="ruby"><span class='int'>5</span>.<span class='id identifier rubyid_minutes'>minutes</span> <span class='op'>%</span> <span class='int'>2</span>.<span class='id identifier rubyid_minutes'>minutes</span>
<span class='comment'># =&gt; 1 minute</span></code></pre>
<p>Fixes #29603 and #29743.</p>
<p><em>Sayan Chakraborty</em>, <em>Andrew White</em></p>
</li>
<li>
<p>Fix division where a duration is the denominator.</p>
<p>PR #29163 introduced a change in behavior when a duration was the denominator
in a calculation - this was incorrect as dividing by a duration should always
return a <a href="Numeric.html" title="Numeric (class)"><code>Numeric</code></a>. The behavior of previous versions of Rails has been restored.</p>
<p>Fixes #29592.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add purpose and expiry support to <a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a> and
<a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)"><code>::ActiveSupport::MessageEncryptor</code></a>.</p>
<p>For instance, to ensure a message is only usable for one intended purpose:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_shipping'>shipping</span>)

<span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='label'>purpose:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_shipping'>shipping</span>) <span class='comment'># =&gt; &quot;x&quot;
</span><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_token'>token</span>)                     <span class='comment'># =&gt; nil</span></code></pre>
<p>Or make it expire after a set time:</p>
<pre class="code ruby"><code class="ruby"><span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires_in:</span> <span class='int'>1</span>.<span class='id identifier rubyid_month'>month</span>)
<span class='ivar'>@verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>y</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires_at:</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>.<span class='id identifier rubyid_end_of_year'>end_of_year</span>)</code></pre>
<p>Showcased with <a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a>, but works the same for
<a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)"><code>::ActiveSupport::MessageEncryptor</code></a>'s <code>encrypt_and_sign</code> and <code>decrypt_and_verify</code>.</p>
<p>Pull requests: #29599, #29854</p>
<p><em>Assain Jaleel</em></p>
</li>
<li>
<p>Make the order of <a href="Hash.html#reverse_merge!-instance_method" title="Hash#reverse_merge! (method)">Hash#reverse_merge!</a> consistent with <a href="#HashWithIndifferentAccess-constant" title="HashWithIndifferentAccess (constant)">HashWithIndifferentAccess</a>.</p>
<p><em>Erol Fornoles</em></p>
</li>
<li>
<p>Add <code>freeze_time</code> helper which freezes time to <code>Time.now</code> in tests.</p>
<p><em>Prathamesh Sonpatki</em></p>
</li>
<li>
<p>Default <a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)"><code>::ActiveSupport::MessageEncryptor</code></a> to use AES 256 GCM encryption.</p>
<p>On for new Rails 5.2 apps. Upgrading apps can find the config as a new
framework default.</p>
<p><em>Assain Jaleel</em></p>
</li>
<li>
<p>Cache: <code>write_multi</code>.</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_write_multi'>write_multi</span> <span class='label'>foo:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>baz:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>qux</span><span class='tstring_end'>&#39;</span></span></code></pre>
<p>Plus faster fetch_multi with stores that implement <code>write_multi_entries</code>.
Keys that aren't found may be written to the cache store in one shot
instead of separate writes.</p>
<p>The default implementation simply calls <code>write_entry</code> for each entry.
Stores may override if they're capable of one-shot bulk writes, like
Redis <code>MSET</code>.</p>
<p><em>Jeremy Daer</em></p>
</li>
<li>
<p>Add default option to module and class attribute accessors.</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mattr_accessor'>mattr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_settings'>settings</span><span class='comma'>,</span> <span class='label'>default:</span> {}</code></pre>
<p>Works for <code>mattr_reader</code>, <code>mattr_writer</code>, <code>cattr_accessor</code>, <code>cattr_reader</code>,
and <code>cattr_writer</code> as well.</p>
<p><em>Genadi Samokovarov</em></p>
</li>
<li>
<p>Add <code>Date#prev_occurring</code> and <code>Date#next_occurring</code> to return specified next/previous occurring day of week.</p>
<p><em>Shota Iguchi</em></p>
</li>
<li>
<p>Add default option to <code>class_attribute</code>.</p>
<p>Before:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_settings'>settings</span>
<span class='kw'>self</span>.<span class='id identifier rubyid_settings'>settings</span> <span class='op'>=</span> {}</code></pre>
<p>Now:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid_settings'>settings</span><span class='comma'>,</span> <span class='label'>default:</span> {}</code></pre>
<p><em>DHH</em></p>
</li>
<li>
<p><code>#singularize</code> and <code>#pluralize</code> now respect uncountables for the specified locale.</p>
<p><em>Eilis Hamilton</em></p>
</li>
<li>
<p>Add <a href="ActiveSupport/CurrentAttributes.html" title="ActiveSupport::CurrentAttributes (class)"><code>::ActiveSupport::CurrentAttributes</code></a> to provide a thread-isolated attributes singleton.
Primary use case is keeping all the per-request attributes easily available to the whole system.</p>
<p><em>DHH</em></p>
</li>
<li>
<p>Fix implicit coercion calculations with scalars and durations.</p>
<p>Previously, calculations where the scalar is first would be converted to a duration
of seconds, but this causes issues with dates being converted to times, e.g:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Beijing</span><span class='tstring_end'>&quot;</span></span>           <span class='comment'># =&gt; Asia/Shanghai
</span><span class='id identifier rubyid_date'>date</span> <span class='op'>=</span> <span class='const'><a href="Date.html" title="Date (class)">Date</a></span>.<span class='id identifier rubyid_civil'>civil</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>5</span><span class='comma'>,</span> <span class='int'>20</span>)  <span class='comment'># =&gt; Mon, 20 May 2017
</span><span class='int'>2</span> <span class='op'>*</span> <span class='int'>1</span>.<span class='id identifier rubyid_day'>day</span>                       <span class='comment'># =&gt; 172800 seconds
</span><span class='id identifier rubyid_date'>date</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='int'>1</span>.<span class='id identifier rubyid_day'>day</span>                <span class='comment'># =&gt; Mon, 22 May 2017 00:00:00 CST +08:00</span></code></pre>
<p>Now, the <a href="ActiveSupport/Duration/Scalar.html" title="ActiveSupport::Duration::Scalar (class)"><code>::ActiveSupport::Duration::Scalar</code></a> calculation methods will try to maintain
the part structure of the duration where possible, e.g:</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Beijing</span><span class='tstring_end'>&quot;</span></span>           <span class='comment'># =&gt; Asia/Shanghai
</span><span class='id identifier rubyid_date'>date</span> <span class='op'>=</span> <span class='const'><a href="Date.html" title="Date (class)">Date</a></span>.<span class='id identifier rubyid_civil'>civil</span>(<span class='int'>2017</span><span class='comma'>,</span> <span class='int'>5</span><span class='comma'>,</span> <span class='int'>20</span>)  <span class='comment'># =&gt; Mon, 20 May 2017
</span><span class='int'>2</span> <span class='op'>*</span> <span class='int'>1</span>.<span class='id identifier rubyid_day'>day</span>                       <span class='comment'># =&gt; 2 days
</span><span class='id identifier rubyid_date'>date</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='int'>1</span>.<span class='id identifier rubyid_day'>day</span>                <span class='comment'># =&gt; Mon, 22 May 2017</span></code></pre>
<p>Fixes #29160, #28970.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add support for versioned cache entries. This enables the cache stores to recycle cache keys, greatly saving
on storage in cases with frequent churn. Works together with the separation of <code>#cache_key</code> and <code>#cache_version</code>
in Active Record and its use in Action Pack's fragment caching.</p>
<p><em>DHH</em></p>
</li>
<li>
<p>Pass gem name and deprecation horizon to deprecation notifications.</p>
<p><em>Willem van Bergen</em></p>
</li>
<li>
<p>Add support for <code>:offset</code> and <code>:zone</code> to <a href="ActiveSupport/TimeWithZone.html#change-instance_method" title="ActiveSupport::TimeWithZone#change (method)">ActiveSupport::TimeWithZone#change</a>.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add support for <code>:offset</code> to <a href="Time.html#change-instance_method" title="Time#change (method)">Time#change</a>.</p>
<p>Fixes #28723.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add <code>fetch_values</code> for <a href="#HashWithIndifferentAccess-constant" title="HashWithIndifferentAccess (constant)">HashWithIndifferentAccess</a>.</p>
<p>The method was originally added to <a href="Hash.html" title="Hash (class)"><code>Hash</code></a> in Ruby 2.3.0.</p>
<p><em>Josh Pencheon</em></p>
</li>
</ul>
<p>Please check <a href="https://github.com/rails/rails/blob/5-1-stable/activesupport/CHANGELOG.md" target="_parent" title="5-1-stable">5-1-stable</a> for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>