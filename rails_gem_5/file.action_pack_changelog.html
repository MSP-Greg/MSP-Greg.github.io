<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Action Pack CHANGELOG &mdash; Rails 5.2.8.1</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "action_pack_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 5.2.8.1</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Action Pack CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h2>Rails 5.2.8.1 (July 12, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.8 (May 09, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.7.1 (April 26, 2022)</h2>
<ul>
<li>
<p>Allow Content Security Policy DSL to generate for API responses.</p>
<p><em>Tim Wade</em></p>
</li>
</ul>
<h2>Rails 5.2.7 (March 10, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.3 (March 08, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.2 (February 11, 2022)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.6.1 (February 11, 2022)</h2>
<ul>
<li>
<p>Under certain circumstances, the middleware isn't informed that the
response body has been fully closed which result in request state not
being fully reset before the next request</p>
<p>[CVE-2022-23633]</p>
</li>
</ul>
<h2>Rails 5.2.6 (May 05, 2021)</h2>
<ul>
<li>
<p>Accept base64_urlsafe CSRF tokens to make forward compatible.</p>
<p>Base64 strict-encoded CSRF tokens are not inherently websafe, which makes
them difficult to deal with. For example, the common practice of sending
the CSRF token to a browser in a client-readable cookie does not work properly
out of the box: the value has to be url-encoded and decoded to survive transport.</p>
<p>In this version, we generate Base64 urlsafe-encoded CSRF tokens, which are inherently
safe to transport. Validation accepts both urlsafe tokens, and strict-encoded
tokens for backwards compatibility.</p>
<p>How the tokes are encoded is controllr by the <code>action_controller.urlsafe_csrf_tokens</code>
config.</p>
<p>In Rails 5.2.5, the CSRF token format was accidentally changed to urlsafe-encoded.</p>
<p><strong>Atention</strong>: If you already upgraded your application to 5.2.5, set the config
<code>urlsafe_csrf_tokens</code> to <code>true</code>, otherwise your form submission will start to fail
during the deploy of this new version.</p>
<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_action_controller'>action_controller</span>.<span class='id identifier rubyid_urlsafe_csrf_tokens'>urlsafe_csrf_tokens</span> <span class='op'>=</span> <span class='kw'>true</span></code></pre>
<p>If you are upgrading from 5.2.4.x, you don't need to change this configuration.</p>
<p><em>Scott Blum</em>, <em>Étienne Barrié</em></p>
</li>
</ul>
<h2>Rails 5.2.5 (March 26, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.6 (May 05, 2021)</h2>
<ul>
<li>
<p>Prevent regex DoS in HTTP token authentication
CVE-2021-22904</p>
</li>
<li>
<p>Prevent string polymorphic route arguments.</p>
<p><code>url_for</code> supports building polymorphic URLs via an array
of arguments (usually symbols and records). If a developer passes a
user input array, strings can result in unwanted route helper calls.</p>
<p>CVE-2021-22885</p>
<p><em>Gannon McGibbon</em></p>
</li>
</ul>
<h2>Rails 5.2.4.5 (February 10, 2021)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.4 (September 09, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.3 (May 18, 2020)</h2>
<ul>
<li>
<p>[CVE-2020-8166] HMAC raw CSRF token before masking it, so it cannot be used to reconstruct a per-form token</p>
</li>
<li>
<p>[CVE-2020-8164] Return self when calling #each, #each_pair, and #each_value instead of the raw @parameters hash</p>
</li>
</ul>
<h2>Rails 5.2.4.2 (March 19, 2020)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.4.1 (December 18, 2019)</h2>
<ul>
<li>
<p>Fix possible information leak / session hijacking vulnerability.</p>
<p>The <code>ActionDispatch::Session::MemcacheStore</code> is still vulnerable given it requires the
gem dalli to be updated as well.</p>
<p><em>Breaking changes:</em></p>
<ul>
<li><code>session.id</code> now returns an instance of <code>Rack::Session::SessionId</code> and not a String (use <code>session.id.public_id</code> to restore the old behaviour, see #38063)</li>
<li>Accessing the session id using <code>session[:session_id]</code>/<code>session['session_id']</code> no longer works with
ruby 2.2 (see <a href="https://github.com/rails/rails/commit/2a52a38cb51b65d71cf91fc960777213cf96f962#commitcomment-37929811">https://github.com/rails/rails/commit/2a52a38cb51b65d71cf91fc960777213cf96f962#commitcomment-37929811</a>)</li>
</ul>
<p>CVE-2019-16782.</p>
</li>
</ul>
<h2>Rails 5.2.4 (November 27, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.3 (March 27, 2019)</h2>
<ul>
<li>
<p>Allow using <code>public</code> and <code>no-cache</code> together in the the Cache Control header.</p>
<p>Before this change, even if <code>public</code> was specified in the Cache Control header,
it was excluded when <code>no-cache</code> was included. This change preserves the
<code>public</code> value as is.</p>
<p>Fixes #34780.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>Allow <code>nil</code> params for <a href="ActionController/TestCase.html" title="ActionController::TestCase (class)"><code>::ActionController::TestCase</code></a>.</p>
<p><em>Ryo Nakamura</em></p>
</li>
</ul>
<h2>Rails 5.2.2.1 (March 11, 2019)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.2 (December 04, 2018)</h2>
<ul>
<li>
<p>Reset Capybara sessions if failed system test screenshot raising an exception.</p>
<p>Reset Capybara sessions if <code>take_failed_screenshot</code> raise exception
in system test <code>after_teardown</code>.</p>
<p><em>Maxim Perepelitsa</em></p>
</li>
<li>
<p>Use request object for context if there's no controller</p>
<p>There is no controller instance when using a redirect route or a
mounted rack application so pass the request object as the context
when resolving dynamic CSP sources in this scenario.</p>
<p>Fixes #34200.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Apply mapping to symbols returned from dynamic CSP sources</p>
<p>Previously if a dynamic source returned a symbol such as :self it
would be converted to a string implicity, e.g:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_policy'>policy</span>.<span class='id identifier rubyid_default_src'>default_src</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='symbeg'>:</span><span class='kw'>self</span> }</code></pre>
<p>would generate the header:</p>
<pre class="code ruby"><code class="ruby">Content-Security-Policy: default-src self</code></pre>
<p>and now it generates:</p>
<pre class="code ruby"><code class="ruby">Content-Security-Policy: default-src &#39;self&#39;</code></pre>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Fix <code>rails routes -c</code> for controller name consists of multiple word.</p>
<p><em>Yoshiyuki Kinjo</em></p>
</li>
<li>
<p>Call the <code>#redirect_to</code> block in controller context.</p>
<p><em>Steven Peckins</em></p>
</li>
</ul>
<h2>Rails 5.2.1.1 (November 27, 2018)</h2>
<ul>
<li>No changes.</li>
</ul>
<h2>Rails 5.2.1 (August 07, 2018)</h2>
<ul>
<li>
<p>Prevent <code>?null=</code> being passed on JSON encoded test requests.</p>
<p><code>RequestEncoder#encode_params</code> won't attempt to parse params if
there are none.</p>
<p>So call like this will no longer append a <code>?null=</code> query param.</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='id identifier rubyid_foos_url'>foos_url</span><span class='comma'>,</span> <span class='label'>as:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_json'>json</span></code></pre>
<p><em>Alireza Bashiri</em></p>
</li>
<li>
<p>Ensure <a href="ActionController/Parameters.html#transform_values-instance_method" title="ActionController::Parameters#transform_values (method)">ActionController::Parameters#transform_values</a> and
<a href="ActionController/Parameters.html#transform_values!-instance_method" title="ActionController::Parameters#transform_values! (method)">ActionController::Parameters#transform_values!</a> converts hashes into
parameters.</p>
<p><em>Kevin Sjöberg</em></p>
</li>
<li>
<p>Fix strong parameters <code>permit!</code> with nested arrays.</p>
<p>Given:</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='const'><a href="ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="ActionController/Parameters.html" title="ActionController::Parameters (class)">Parameters</a></span>.<span class='id identifier rubyid_new'><a href="ActionController/Parameters.html#new-class_method" title="ActionController::Parameters.new (method)">new</a></span>(<span class='label'>nested_arrays:</span> [[{ <span class='label'>x:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>y:</span> <span class='int'>3</span> }<span class='comma'>,</span> { <span class='label'>x:</span> <span class='int'>21</span><span class='comma'>,</span> <span class='label'>y:</span> <span class='int'>42</span> }]])
<span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_permit!'>permit!</span></code></pre>
<p><code>params[:nested_arrays][0][0].permitted?</code> will now return <code>true</code> instead of <code>false</code>.</p>
<p><em>Steve Hull</em></p>
</li>
<li>
<p>Reset <code>RAW_POST_DATA</code> and <code>CONTENT_LENGTH</code> request environment between test requests in
<a href="ActionController/TestCase.html" title="ActionController::TestCase (class)"><code>::ActionController::TestCase</code></a> subclasses.</p>
<p><em>Eugene Kenny</em></p>
</li>
<li>
<p>Output only one Content-Security-Policy nonce header value per request.</p>
<p>Fixes #32597.</p>
<p><em>Andrey Novikov</em>, <em>Andrew White</em></p>
</li>
<li>
<p>Only disable GPUs for headless Chrome on Windows.</p>
<p>It is not necessary anymore for Linux and macOS machines.</p>
<p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=737678#c1">https://bugs.chromium.org/p/chromium/issues/detail?id=737678#c1</a></p>
<p><em>Stefan Wrobel</em></p>
</li>
<li>
<p>Fix system tests transactions not closed between examples.</p>
<p><em>Sergey Tarasov</em></p>
</li>
</ul>
<h2>Rails 5.2.0 (April 09, 2018)</h2>
<ul>
<li>
<p>Check exclude before flagging cookies as secure.</p>
<p><em>Catherine Khuu</em></p>
</li>
<li>
<p>Always yield a CSP policy instance from <code>content_security_policy</code></p>
<p>This allows a controller action to enable the policy individually
for a controller and/or specific actions.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add the ability to disable the global CSP in a controller, e.g:</p>
<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>LegacyPagesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>only:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add alias method <code>to_hash</code> to <code>to_h</code> for <code>cookies</code>.
Add alias method <code>to_h</code> to <code>to_hash</code> for <code>session</code>.</p>
<p><em>Igor Kasyanchuk</em></p>
</li>
<li>
<p>Update the default HSTS max-age value to 31536000 seconds (1 year)
to meet the minimum max-age requirement for <a href="https://hstspreload.org/">https://hstspreload.org/</a>.</p>
<p><em>Grant Bourque</em></p>
</li>
<li>
<p>Add support for automatic nonce generation for <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> UJS.</p>
<p>Because the UJS library creates a script tag to process responses it
normally requires the script-src attribute of the content security
policy to include 'unsafe-inline'.</p>
<p>To work around this we generate a per-request nonce value that is
embedded in a meta tag in a similar fashion to how CSRF protection
embeds its token in a meta tag. The UJS library can then read the
nonce value and set it on the dynamically generated script tag to
enable it to execute without needing 'unsafe-inline' enabled.</p>
<p>Nonce generation isn't 100% safe - if your script tag is including
user generated content in someway then it may be possible to exploit
an XSS vulnerability which can take advantage of the nonce. It is
however an improvement on a blanket permission for inline scripts.</p>
<p>It is also possible to use the nonce within your own script tags by
using <code>nonce: true</code> to set the nonce value on the tag, e.g</p>
<pre class="code xml"><code class="xml">&lt;%= javascript_tag nonce: true do %&gt;
  alert(&#39;Hello, World!&#39;);
&lt;% end %&gt;
</code></pre>
<p>Fixes #31689.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Matches behavior of <code>Hash#each</code> in <a href="ActionController/Parameters.html#each-instance_method" title="ActionController::Parameters#each (method)">ActionController::Parameters#each</a>.</p>
<p>Rails 5.0 introduced a bug when looping through controller params using <code>each</code>. Only the keys of params hash were passed to the block, e.g.</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># Parameters: {&quot;param&quot;=&gt;&quot;1&quot;, &quot;param_two&quot;=&gt;&quot;2&quot;}
</span><span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Prints
</span><span class='comment'># param
</span><span class='comment'># param_two</span></code></pre>
<p>In Rails 5.2 the bug has been fixed and name will be an array (which was the behavior for all versions prior to 5.0), instead of a string.</p>
<p>To fix the code above simply change as per example below:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># Parameters: {&quot;param&quot;=&gt;&quot;1&quot;, &quot;param_two&quot;=&gt;&quot;2&quot;}
</span><span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_params'>params</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Prints
</span><span class='comment'># param
</span><span class='comment'># param_two</span></code></pre>
<p><em>Dominic Cleal</em></p>
</li>
<li>
<p>Add <code>Referrer-Policy</code> header to default headers set.</p>
<p><em>Guillermo Iguaran</em></p>
</li>
<li>
<p>Changed the system tests to set Puma as default server only when the
user haven't specified manually another server.</p>
<p><em>Guillermo Iguaran</em></p>
</li>
<li>
<p>Add secure <code>X-Download-Options</code> and <code>X-Permitted-Cross-Domain-Policies</code> to
default headers set.</p>
<p><em>Guillermo Iguaran</em></p>
</li>
<li>
<p>Add headless firefox support to System Tests.</p>
<p><em>bogdanvlviv</em></p>
</li>
<li>
<p>Changed the default system test screenshot output from <code>inline</code> to <code>simple</code>.</p>
<p><code>inline</code> works well for iTerm2 but not everyone uses iTerm2. Some terminals like
Terminal.app ignore the <code>inline</code> and output the path to the file since it can't
render the image. Other terminals, like those on Ubuntu, cannot handle the image
inline, but also don't handle it gracefully and instead of outputting the file
path, it dumps binary into the terminal.</p>
<p>Commit 9d6e28 fixes this by changing the default for screenshot to be <code>simple</code>.</p>
<p><em>Eileen M. Uchitelle</em></p>
</li>
<li>
<p>Register most popular audio/video/font mime types supported by modern browsers.</p>
<p><em>Guillermo Iguaran</em></p>
</li>
<li>
<p>Fix optimized url helpers when using relative url root.</p>
<p>Fixes #31220.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Add DSL for configuring Content-Security-Policy header.</p>
<p>The DSL allows you to configure a global Content-Security-Policy
header and then override within a controller. For more information
about the Content-Security-Policy header see MDN:</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</a></p>
<p>Example global policy:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># config/initializers/content_security_policy.rb
</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_default_src'>default_src</span> <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_https'>https</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_font_src'>font_src</span>    <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_https'>https</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_data'>data</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_img_src'>img_src</span>     <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_https'>https</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_data'>data</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_object_src'>object_src</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_none'>none</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_script_src'>script_src</span>  <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_https'>https</span>
  <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_style_src'>style_src</span>   <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_https'>https</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unsafe_inline'>unsafe_inline</span>
<span class='kw'>end</span></code></pre>
<p>Example controller overrides:</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># Override policy inline
</span><span class='kw'>class</span> <span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
    <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_upgrade_insecure_requests'>upgrade_insecure_requests</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Using literal values
</span><span class='kw'>class</span> <span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
    <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_base_uri'>base_uri</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://www.example.com</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># Using mixed static and dynamic values
</span><span class='kw'>class</span> <span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_content_security_policy'>content_security_policy</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span>
    <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_base_uri'>base_uri</span> <span class='symbeg'>:</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_current_user'>current_user</span>.<span class='id identifier rubyid_domain'>domain</span><span class='embexpr_end'>}</span><span class='tstring_content'>.example.com</span><span class='tstring_end'>&quot;</span></span> }
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
<p>Allows you to also only report content violations for migrating
legacy content using the <code>content_security_policy_report_only</code>
configuration attribute, e.g;</p>
<pre class="code ruby"><code class="ruby"><span class='comment'># config/initializers/content_security_policy.rb
</span><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_content_security_policy_report_only'>content_security_policy_report_only</span> <span class='op'>=</span> <span class='kw'>true</span>

<span class='comment'># controller override
</span><span class='kw'>class</span> <span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_content_security_policy_report_only'>content_security_policy_report_only</span> <span class='label'>only:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>
<p>Note that this feature does not validate the header for performance
reasons since the header is calculated at runtime.</p>
<p><em>Andrew White</em></p>
</li>
<li>
<p>Make <code>assert_recognizes</code> to traverse mounted engines.</p>
<p><em>Yuichiro Kaneko</em></p>
</li>
<li>
<p>Remove deprecated <code>ActionController::ParamsParser::ParseError</code>.</p>
<p><em>Rafael Mendonça França</em></p>
</li>
<li>
<p>Add <code>:allow_other_host</code> option to <code>redirect_back</code> method.</p>
<p>When <code>allow_other_host</code> is set to <code>false</code>, the <code>redirect_back</code> will not allow redirecting from a
different host. <code>allow_other_host</code> is <code>true</code> by default.</p>
<p><em>Tim Masliuchenko</em></p>
</li>
<li>
<p>Add headless chrome support to System Tests.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>Add ability to enable Early Hints for HTTP/2</p>
<p>If supported by the server, and enabled in Puma this allows H2 Early Hints to be used.</p>
<p>The <code>javascript_include_tag</code> and the <code>stylesheet_link_tag</code> automatically add Early Hints if requested.</p>
<p><em>Eileen M. Uchitelle</em>, <em>Aaron Patterson</em></p>
</li>
<li>
<p>Simplify cookies middleware with key rotation support</p>
<p>Use the <code>rotate</code> method for both <code>MessageEncryptor</code> and
<code>MessageVerifier</code> to add key rotation support for encrypted and
signed cookies. This also helps simplify support for legacy cookie
security.</p>
<p><em>Michael J Coyne</em></p>
</li>
<li>
<p>Use Capybara registered <code>:puma</code> server config.</p>
<p>The Capybara registered <code>:puma</code> server ensures the puma server is run in process so
connection sharing and open request detection work correctly by default.</p>
<p><em>Thomas Walpole</em></p>
</li>
<li>
<p>Cookies <code>:expires</code> option supports <a href="ActiveSupport/Duration.html" title="ActiveSupport::Duration (class)"><code>::ActiveSupport::Duration</code></a> object.</p>
<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_cookies'>cookies</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_user_name'>user_name</span>] <span class='op'>=</span> { <span class='label'>value:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>assain</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires:</span> <span class='int'>1</span>.<span class='id identifier rubyid_hour'>hour</span> }
<span class='id identifier rubyid_cookies'>cookies</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> { <span class='label'>value:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a yummy cookie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>expires:</span> <span class='int'>6</span>.<span class='id identifier rubyid_months'>months</span> }</code></pre>
<p>Pull Request: #30121</p>
<p><em>Assain Jaleel</em></p>
</li>
<li>
<p>Enforce signed/encrypted cookie expiry server side.</p>
<p>Rails can thwart attacks by malicious clients that don't honor a cookie's expiry.</p>
<p>It does so by stashing the expiry within the written cookie and relying on the
signing/encrypting to vouch that it hasn't been tampered with. Then on a
server-side read, the expiry is verified and any expired cookie is discarded.</p>
<p>Pull Request: #30121</p>
<p><em>Assain Jaleel</em></p>
</li>
<li>
<p>Make <code>take_failed_screenshot</code> work within engine.</p>
<p>Fixes #30405.</p>
<p><em>Yuji Yaginuma</em></p>
</li>
<li>
<p>Deprecate <a href="ActionDispatch/TestResponse.html" title="ActionDispatch::TestResponse (class)"><code>::ActionDispatch::TestResponse</code></a> response aliases.</p>
<p><code>#success?</code>, <code>#missing?</code> &amp; <code>#error?</code> are not supported by the actual
<a href="ActionDispatch/Response.html" title="ActionDispatch::Response (class)"><code>::ActionDispatch::Response</code></a> object and can produce false-positives. Instead,
use the response helpers provided by <code>Rack::Response</code>.</p>
<p><em>Trevor Wistaff</em></p>
</li>
<li>
<p>Protect from forgery by default</p>
<p>Rather than protecting from forgery in the generated <code>ApplicationController</code>,
add it to <a href="ActionController/Base.html" title="ActionController::Base (class)"><code>::ActionController::Base</code></a> depending on
<code>config.action_controller.default_protect_from_forgery</code>. This configuration
defaults to false to support older versions which have removed it from their
<code>ApplicationController</code>, but is set to true for Rails 5.2.</p>
<p><em>Lisa Ugray</em></p>
</li>
<li>
<p>Fallback <a href="ActionController/Parameters.html#to_s-instance_method" title="ActionController::Parameters#to_s (method)">ActionController::Parameters#to_s</a> to <code>Hash#to_s</code>.</p>
<p><em>Kir Shatrov</em></p>
</li>
<li>
<p><code>driven_by</code> now registers poltergeist and capybara-webkit.</p>
<p>If poltergeist or capybara-webkit are set as drivers is set for System Tests,
<code>driven_by</code> will register the driver and set additional options passed via
the <code>:options</code> parameter.</p>
<p>Refer to the respective driver's documentation to see what options can be passed.</p>
<p><em>Mario Chavez</em></p>
</li>
<li>
<p>AEAD encrypted cookies and sessions with GCM.</p>
<p>Encrypted cookies now use AES-GCM which couples authentication and
encryption in one faster step and produces shorter ciphertexts. Cookies
encrypted using AES in CBC HMAC mode will be seamlessly upgraded when
this new mode is enabled via the
<code>action_dispatch.use_authenticated_cookie_encryption</code> configuration value.</p>
<p><em>Michael J Coyne</em></p>
</li>
<li>
<p>Change the cache key format for fragments to make it easier to debug key churn. The new format is:</p>
<pre class="code ruby"><code class="ruby">views/template/action.html.erb:7a1156131a6928cb0026877f8b749ac9/projects/123
      ^template path           ^template tree digest            ^class   ^id</code></pre>
<p><em>DHH</em></p>
</li>
<li>
<p>Add support for recyclable cache keys with fragment caching. This uses the new versioned entries in the
<a href="ActiveSupport/Cache.html" title="ActiveSupport::Cache (module)"><code>::ActiveSupport::Cache</code></a> stores and relies on the fact that Active Record has split <code>#cache_key</code> and <code>#cache_version</code>
to support it.</p>
<p><em>DHH</em></p>
</li>
<li>
<p>Add <code>action_controller_api</code> and <code>action_controller_base</code> load hooks to be called in <code>ActiveSupport.on_load</code></p>
<p><a href="ActionController/Base.html" title="ActionController::Base (class)"><code>::ActionController::Base</code></a> and <a href="ActionController/API.html" title="ActionController::API (class)"><code>::ActionController::API</code></a> have differing implementations. This means that
the one umbrella hook <code>action_controller</code> is not able to address certain situations where a method
may not exist in a certain implementation.</p>
<p>This is fixed by adding two new hooks so you can target <a href="ActionController/Base.html" title="ActionController::Base (class)"><code>::ActionController::Base</code></a> vs <a href="ActionController/API.html" title="ActionController::API (class)"><code>::ActionController::API</code></a></p>
<p>Fixes #27013.</p>
<p><em>Julian Nadeau</em></p>
</li>
</ul>
<p>Please check <a href="https://github.com/rails/rails/blob/5-1-stable/actionpack/CHANGELOG.md" target="_parent" title="5-1-stable">5-1-stable</a> for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>