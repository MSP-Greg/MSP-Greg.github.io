<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Sprockets::SourceMapUtils &mdash; Sprockets main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Sprockets::SourceMapUtils",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Sprockets main</a> &raquo; 
      <a href='../_index.html#alpha_S'>Index (S)</a> &raquo; 
        <a href="../Sprockets.html" title="Sprockets (module)">Sprockets</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>SourceMapUtils&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Sprockets::SourceMapUtils</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Included In:</div>
      <div class='box_11'>
        <a href="Base.html" title="Sprockets::Base (class)"><code>Base</code></a>,
          <a href="CachedEnvironment.html" title="Sprockets::CachedEnvironment (class)"><code>CachedEnvironment</code></a>,
          <a href="Environment.html" title="Sprockets::Environment (class)"><code>Environment</code></a>
      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L6'>lib/sprockets/source_map_utils.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='BASE64_DIGITS-constant' class='summary_signature'>BASE64_DIGITS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L400-L400'># File 'lib/sprockets/source_map_utils.rb', line 400</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>)</pre>
  </li>
  <li>
    <span id='BASE64_VALUES-constant' class='summary_signature'>BASE64_VALUES =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L401-L401'># File 'lib/sprockets/source_map_utils.rb', line 401</a>    <pre class='code ruby'>(<span class='int'>0</span><span class='op'>...</span><span class='int'>64</span>).<span class='id identifier rubyid_inject'>inject</span>({}) { <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span>[<span class='const'><a href="#BASE64_DIGITS-constant" title="Sprockets::SourceMapUtils::BASE64_DIGITS (constant)">BASE64_DIGITS</a></span>[<span class='id identifier rubyid_i'>i</span>]] <span class='op'>=</span> <span class='id identifier rubyid_i'>i</span><span class='semicolon'>;</span> <span class='id identifier rubyid_h'>h</span> }</pre>
  </li>
  <li>
    <span id='VLQ_BASE-constant' class='summary_signature'>VLQ_BASE =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L396-L396'># File 'lib/sprockets/source_map_utils.rb', line 396</a>    <pre class='code ruby'><span class='int'>1</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="#VLQ_BASE_SHIFT-constant" title="Sprockets::SourceMapUtils::VLQ_BASE_SHIFT (constant)">VLQ_BASE_SHIFT</a></span></pre>
  </li>
  <li>
    <span id='VLQ_BASE_MASK-constant' class='summary_signature'>VLQ_BASE_MASK =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L397-L397'># File 'lib/sprockets/source_map_utils.rb', line 397</a>    <pre class='code ruby'><span class='const'><a href="#VLQ_BASE-constant" title="Sprockets::SourceMapUtils::VLQ_BASE (constant)">VLQ_BASE</a></span> <span class='op'>-</span> <span class='int'>1</span></pre>
  </li>
  <li>
    <span id='VLQ_BASE_SHIFT-constant' class='summary_signature'>VLQ_BASE_SHIFT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Public: Base64 VLQ encoding</p>

<p>Adopted from ConradIrwin/ruby-source_map <a href="https://github.com/ConradIrwin/ruby-source_map/blob/master/lib/source_map/vlq.rb">github.com/ConradIrwin/ruby-source_map/blob/master/lib/source_map/vlq.rb</a></p>

<p>Resources</p>

<p><a href="http://en.wikipedia.org/wiki/Variable-length_quantity">en.wikipedia.org/wiki/Variable-length_quantity</a> <a href="https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit">docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit</a> <a href="https://github.com/mozilla/source-map/blob/master/lib/source-map/base64-vlq.js">github.com/mozilla/source-map/blob/master/lib/source-map/base64-vlq.js</a></p>

  </div>
</div>
    <a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L395-L395'># File 'lib/sprockets/source_map_utils.rb', line 395</a>    <pre class='code ruby'><span class='int'>5</span></pre>
  </li>
  <li>
    <span id='VLQ_CONTINUATION_BIT-constant' class='summary_signature'>VLQ_CONTINUATION_BIT =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L398-L398'># File 'lib/sprockets/source_map_utils.rb', line 398</a>    <pre class='code ruby'><span class='const'><a href="#VLQ_BASE-constant" title="Sprockets::SourceMapUtils::VLQ_BASE (constant)">VLQ_BASE</a></span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#bsearch_mappings-instance_method" title="#bsearch_mappings (instance method)">#<strong>bsearch_mappings</strong>(mappings, offset, from = 0, to = mappings.size - 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Search Array of mappings for closest offset.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#combine_source_maps-instance_method" title="#combine_source_maps (instance method)">#<strong>combine_source_maps</strong>(first, second)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Combine two separate source map transformations into a single mapping.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#compare_source_offsets-instance_method" title="#compare_source_offsets (instance method)">#<strong>compare_source_offsets</strong>(a, b)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Compare two source map offsets.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#concat_source_maps-instance_method" title="#concat_source_maps (instance method)">#<strong>concat_source_maps</strong>(a, b)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Concatenate two source maps.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#decode_source_map-instance_method" title="#decode_source_map (instance method)">#<strong>decode_source_map</strong>(map)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Decompress source map.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#decode_vlq_mappings-instance_method" title="#decode_vlq_mappings (instance method)">#<strong>decode_vlq_mappings</strong>(str, sources: [], names: [])  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Decode VLQ mappings and match up sources and symbol names.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#encode_source_map-instance_method" title="#encode_source_map (instance method)">#<strong>encode_source_map</strong>(map)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Compress source map.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#encode_vlq_mappings-instance_method" title="#encode_vlq_mappings (instance method)">#<strong>encode_vlq_mappings</strong>(mappings, sources: nil, names: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Encode mappings Hash into a VLQ encoded String.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#format_source_map-instance_method" title="#format_source_map (instance method)">#<strong>format_source_map</strong>(map, input)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Transpose source maps into a standard format.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#make_index_map-instance_method" title="#make_index_map (instance method)">#<strong>make_index_map</strong>(map)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Converts source map to index map.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#vlq_decode-instance_method" title="#vlq_decode (instance method)">#<strong>vlq_decode</strong>(str)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Decode a VLQ string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#vlq_decode_mappings-instance_method" title="#vlq_decode_mappings (instance method)">#<strong>vlq_decode_mappings</strong>(str)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Decode a VLQ string into mapping numbers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#vlq_encode-instance_method" title="#vlq_encode (instance method)">#<strong>vlq_encode</strong>(ary)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Encode a list of numbers into a compact VLQ string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#vlq_encode_mappings-instance_method" title="#vlq_encode_mappings (instance method)">#<strong>vlq_encode_mappings</strong>(ary)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Encode a mapping array into a compact VLQ string.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="bsearch_mappings-instance_method">
  <h3 class='signature  first'>
    #<strong>bsearch_mappings</strong>(mappings, offset, from = 0, to = mappings.size - 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Search Array of mappings for closest offset.</p>

<p>mappings - Array of mapping Hash objects offset  - Array [line, column]</p>

<p>Returns mapping Hash object.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L273-L288'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='273' data-end='288'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 273</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_bsearch_mappings'>bsearch_mappings</span>(<span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span> <span class='op'>=</span> <span class='id identifier rubyid_mappings'>mappings</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>-</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> (<span class='id identifier rubyid_from'>from</span> <span class='op'>+</span> <span class='id identifier rubyid_to'>to</span>) <span class='op'>/</span> <span class='int'>2</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_to'>to</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>&lt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_mappings'>mappings</span>[<span class='id identifier rubyid_from'>from</span><span class='op'>-</span><span class='int'>1</span>]
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_compare_source_offsets'><a href="#compare_source_offsets-instance_method" title="Sprockets::SourceMapUtils#compare_source_offsets (method)">compare_source_offsets</a></span>(<span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_mappings'>mappings</span>[<span class='id identifier rubyid_mid'>mid</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>])
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='id identifier rubyid_mappings'>mappings</span>[<span class='id identifier rubyid_mid'>mid</span>]
  <span class='kw'>when</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='id identifier rubyid_bsearch_mappings'>bsearch_mappings</span>(<span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span> <span class='op'>-</span> <span class='int'>1</span>)
  <span class='kw'>when</span> <span class='int'>1</span>
    <span class='id identifier rubyid_bsearch_mappings'>bsearch_mappings</span>(<span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="combine_source_maps-instance_method">
  <h3 class='signature '>
    #<strong>combine_source_maps</strong>(first, second)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Combine two separate source map transformations into a single mapping.</p>

<p>Source transformations may happen in discrete steps producing separate source maps. These steps can be combined into a single mapping back to the source.</p>

<p>For an example, CoffeeScript may transform a file producing a map. Then Uglifier processes the result and produces another map. The CoffeeScript map can be combined with the Uglifier map so the source lines of the minified output can be traced back to the original CoffeeScript file.</p>

<p>Returns a source map hash.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L156-L172'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='156' data-end='172'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 156</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_combine_source_maps'>combine_source_maps</span>(<span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_second'>second</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_second'>second</span> <span class='kw'>unless</span> <span class='id identifier rubyid_first'>first</span>

  <span class='id identifier rubyid__first'>_first</span>  <span class='op'>=</span> <span class='id identifier rubyid_decode_source_map'><a href="#decode_source_map-instance_method" title="Sprockets::SourceMapUtils#decode_source_map (method)">decode_source_map</a></span>(<span class='id identifier rubyid_first'>first</span>)
  <span class='id identifier rubyid__second'>_second</span> <span class='op'>=</span> <span class='id identifier rubyid_decode_source_map'><a href="#decode_source_map-instance_method" title="Sprockets::SourceMapUtils#decode_source_map (method)">decode_source_map</a></span>(<span class='id identifier rubyid_second'>second</span>)

  <span class='id identifier rubyid_new_mappings'>new_mappings</span> <span class='op'>=</span> []

  <span class='id identifier rubyid__second'>_second</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_mappings'>mappings</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
    <span class='id identifier rubyid_first_line'>first_line</span> <span class='op'>=</span> <span class='id identifier rubyid_bsearch_mappings'><a href="#bsearch_mappings-instance_method" title="Sprockets::SourceMapUtils#bsearch_mappings (method)">bsearch_mappings</a></span>(<span class='id identifier rubyid__first'>_first</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_mappings'>mappings</span>]<span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_original'>original</span>])
    <span class='id identifier rubyid_new_mappings'>new_mappings</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_first_line'>first_line</span>.<span class='id identifier rubyid_merge'>merge</span>(<span class='label'>generated:</span> <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>]) <span class='kw'>if</span> <span class='id identifier rubyid_first_line'>first_line</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid__first'>_first</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_mappings'>mappings</span>] <span class='op'>=</span> <span class='id identifier rubyid_new_mappings'>new_mappings</span>

  <span class='id identifier rubyid_encode_source_map'><a href="#encode_source_map-instance_method" title="Sprockets::SourceMapUtils#encode_source_map (method)">encode_source_map</a></span>(<span class='id identifier rubyid__first'>_first</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compare_source_offsets-instance_method">
  <h3 class='signature '>
    #<strong>compare_source_offsets</strong>(a, b)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Compare two source map offsets.</p>

<p>Compatible with <code>Array#sort</code>.</p>

<p>a - Array [line, column] b - Array [line, column]</p>

<p>Returns -1 if a &lt; b, 0 if a == b and 1 if a &gt; b.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L254-L265'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='254' data-end='265'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 254</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compare_source_offsets'>compare_source_offsets</span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span>)
  <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>[<span class='int'>0</span>] <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span>[<span class='int'>0</span>]
  <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>[<span class='int'>1</span>] <span class='op'>-</span> <span class='id identifier rubyid_b'>b</span>[<span class='int'>1</span>] <span class='kw'>if</span> <span class='id identifier rubyid_diff'>diff</span> <span class='op'>==</span> <span class='int'>0</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_diff'>diff</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_diff'>diff</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='int'>0</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="concat_source_maps-instance_method">
  <h3 class='signature '>
    #<strong>concat_source_maps</strong>(a, b)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Concatenate two source maps.</p>

<p>For an example, if two js scripts are concatenated, the individual source maps for those files can be concatenated to map back to the originals.</p>

<p>Examples</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_script3'>script3</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script1'>script1</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_script2'>script2</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_map3'>map3</span>    <span class='op'>=</span> <span class='id identifier rubyid_concat_source_maps'>concat_source_maps</span>(<span class='id identifier rubyid_map1'>map1</span><span class='comma'>,</span> <span class='id identifier rubyid_map2'>map2</span>)</code></pre>

<p>a - Source map hash b - Source map hash</p>

<p>Returns a new source map hash.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L73-L98'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='73' data-end='98'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 73</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_concat_source_maps'>concat_source_maps</span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>||</span> <span class='id identifier rubyid_b'>b</span> <span class='kw'>unless</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_make_index_map'><a href="#make_index_map-instance_method" title="Sprockets::SourceMapUtils#make_index_map (method)">make_index_map</a></span>(<span class='id identifier rubyid_a'>a</span>)
  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_make_index_map'><a href="#make_index_map-instance_method" title="Sprockets::SourceMapUtils#make_index_map (method)">make_index_map</a></span>(<span class='id identifier rubyid_b'>b</span>)

  <span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_a'>a</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_count'>count</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_a'>a</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_last'>last</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mappings</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_last_line_count'>last_line_count</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_last'>last</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_delete'>delete</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x_sprockets_linecount</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_offset'>offset</span> <span class='op'>+=</span> <span class='id identifier rubyid_last_line_count'>last_line_count</span> <span class='op'>||</span> <span class='int'>1</span>

    <span class='id identifier rubyid_last_offset'>last_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_last'>last</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line</span><span class='tstring_end'>&quot;</span></span>]
    <span class='id identifier rubyid_offset'>offset</span> <span class='op'>+=</span> <span class='id identifier rubyid_last_offset'>last_offset</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_a'>a</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>+=</span> <span class='id identifier rubyid_b'>b</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='op'>|</span>
    {
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_section'>section</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_merge'>merge</span>({ <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_section'>section</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>+</span> <span class='id identifier rubyid_offset'>offset</span> })<span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>    <span class='op'>=&gt;</span> <span class='id identifier rubyid_section'>section</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_merge'>merge</span>({
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_section'>section</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source'>source</span><span class='op'>|</span>
          <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_relative_path_from'><a href="PathUtils.html#relative_path_from-instance_method" title="Sprockets::PathUtils#relative_path_from (method)">relative_path_from</a></span>(<span class='id identifier rubyid_a'>a</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_join'><a href="PathUtils.html#join-instance_method" title="Sprockets::PathUtils#join (method)">join</a></span>(<span class='const'>File</span>.<span class='id identifier rubyid_dirname'>dirname</span>(<span class='id identifier rubyid_b'>b</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>])<span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span>))
        <span class='kw'>end</span>
      })
    }
  <span class='kw'>end</span>
  <span class='id identifier rubyid_a'>a</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decode_source_map-instance_method">
  <h3 class='signature '>
    #<strong>decode_source_map</strong>(map)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Decompress source map</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">decode_source_map(map)
# =&gt; {
  version:  3,
  file:     &quot;..&quot;,
  mappings: [
    { source: &quot;..&quot;, generated: [0, 0], original: [0, 0], name: &quot;..&quot;}, ..
  ],
  sources:  [..],
  names:    [..]
}</code></pre>

<p>map - Source map hash (v3 spec)</p>

<p>Returns an uncompressed source map hash</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L192-L217'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='192' data-end='217'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 192</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decode_source_map'>decode_source_map</span>(<span class='id identifier rubyid_map'>map</span>)
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_map'>map</span>

  <span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span> <span class='id identifier rubyid_sources'>sources</span><span class='comma'>,</span> <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> []<span class='comma'>,</span> []<span class='comma'>,</span> []
  <span class='kw'>if</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>]
    <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
      <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>+=</span> <span class='id identifier rubyid_decode_source_map'>decode_source_map</span>(<span class='id identifier rubyid_s'>s</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>])[<span class='symbeg'>:</span><span class='id identifier rubyid_mappings'>mappings</span>].<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
        <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>][<span class='int'>0</span>] <span class='op'>+=</span> <span class='id identifier rubyid_s'>s</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line</span><span class='tstring_end'>&quot;</span></span>]
        <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>][<span class='int'>1</span>] <span class='op'>+=</span> <span class='id identifier rubyid_s'>s</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>column</span><span class='tstring_end'>&quot;</span></span>]
      <span class='kw'>end</span>
      <span class='id identifier rubyid_sources'>sources</span> <span class='op'>|=</span> <span class='id identifier rubyid_s'>s</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>]
      <span class='id identifier rubyid_names'>names</span>   <span class='op'>|=</span> <span class='id identifier rubyid_s'>s</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>][<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>]
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>=</span> <span class='id identifier rubyid_decode_vlq_mappings'><a href="#decode_vlq_mappings-instance_method" title="Sprockets::SourceMapUtils#decode_vlq_mappings (method)">decode_vlq_mappings</a></span>(<span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mappings</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='label'>sources:</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> <span class='label'>names:</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>])
    <span class='id identifier rubyid_sources'>sources</span>  <span class='op'>=</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>]
    <span class='id identifier rubyid_names'>names</span>    <span class='op'>=</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>]
  <span class='kw'>end</span>
  {
    <span class='label'>version:</span>  <span class='int'>3</span><span class='comma'>,</span>
    <span class='label'>file:</span>     <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span>
    <span class='label'>mappings:</span> <span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span>
    <span class='label'>sources:</span>  <span class='id identifier rubyid_sources'>sources</span><span class='comma'>,</span>
    <span class='label'>names:</span>    <span class='id identifier rubyid_names'>names</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="decode_vlq_mappings-instance_method">
  <h3 class='signature '>
    #<strong>decode_vlq_mappings</strong>(str, sources: [], names: [])  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Decode VLQ mappings and match up sources and symbol names.</p>

<p>str     - VLQ string from ‘mappings’ attribute sources - Array of Strings from ‘sources’ attribute names   - Array of Strings from ‘names’ attribute</p>

<p>Returns an Array of Mappings.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L297-L337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='297' data-end='337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 297</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decode_vlq_mappings'>decode_vlq_mappings</span>(<span class='id identifier rubyid_str'>str</span><span class='comma'>,</span> <span class='label'>sources:</span> []<span class='comma'>,</span> <span class='label'>names:</span> [])
  <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>=</span> []

  <span class='id identifier rubyid_source_id'>source_id</span>       <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_original_line'>original_line</span>   <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_original_column'>original_column</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_name_id'>name_id</span>         <span class='op'>=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_vlq_decode_mappings'><a href="#vlq_decode_mappings-instance_method" title="Sprockets::SourceMapUtils#vlq_decode_mappings (method)">vlq_decode_mappings</a></span>(<span class='id identifier rubyid_str'>str</span>).<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='id identifier rubyid_generated_column'>generated_column</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_generated_line'>generated_line</span>   <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>+</span> <span class='int'>1</span>

    <span class='id identifier rubyid_group'>group</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_segment'>segment</span><span class='op'>|</span>
      <span class='id identifier rubyid_generated_column'>generated_column</span> <span class='op'>+=</span> <span class='id identifier rubyid_segment'>segment</span>[<span class='int'>0</span>]
      <span class='id identifier rubyid_generated'>generated</span> <span class='op'>=</span> [<span class='id identifier rubyid_generated_line'>generated_line</span><span class='comma'>,</span> <span class='id identifier rubyid_generated_column'>generated_column</span>]

      <span class='kw'>if</span> <span class='id identifier rubyid_segment'>segment</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;=</span> <span class='int'>4</span>
        <span class='id identifier rubyid_source_id'>source_id</span>        <span class='op'>+=</span> <span class='id identifier rubyid_segment'>segment</span>[<span class='int'>1</span>]
        <span class='id identifier rubyid_original_line'>original_line</span>    <span class='op'>+=</span> <span class='id identifier rubyid_segment'>segment</span>[<span class='int'>2</span>]
        <span class='id identifier rubyid_original_column'>original_column</span>  <span class='op'>+=</span> <span class='id identifier rubyid_segment'>segment</span>[<span class='int'>3</span>]

        <span class='id identifier rubyid_source'>source</span>   <span class='op'>=</span> <span class='id identifier rubyid_sources'>sources</span>[<span class='id identifier rubyid_source_id'>source_id</span>]
        <span class='id identifier rubyid_original'>original</span> <span class='op'>=</span> [<span class='id identifier rubyid_original_line'>original_line</span><span class='comma'>,</span> <span class='id identifier rubyid_original_column'>original_column</span>]
      <span class='kw'>else</span>
        <span class='comment'># TODO: Research this case
</span>        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_segment'>segment</span>[<span class='int'>4</span>]
        <span class='id identifier rubyid_name_id'>name_id</span> <span class='op'>+=</span> <span class='id identifier rubyid_segment'>segment</span>[<span class='int'>4</span>]
        <span class='id identifier rubyid_name'>name</span>     <span class='op'>=</span> <span class='id identifier rubyid_names'>names</span>[<span class='id identifier rubyid_name_id'>name_id</span>]
      <span class='kw'>end</span>

      <span class='id identifier rubyid_mapping'>mapping</span> <span class='op'>=</span> {<span class='label'>source:</span> <span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='label'>generated:</span> <span class='id identifier rubyid_generated'>generated</span><span class='comma'>,</span> <span class='label'>original:</span> <span class='id identifier rubyid_original'>original</span>}
      <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>] <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span> <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>
      <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_mapping'>mapping</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mappings'>mappings</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encode_source_map-instance_method">
  <h3 class='signature '>
    #<strong>encode_source_map</strong>(map)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Compress source map</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">encode_source_map(map)
# =&gt; {
  &quot;version&quot;  =&gt; 3,
  &quot;file&quot;     =&gt; &quot;..&quot;,
  &quot;mappings&quot; =&gt; &quot;AAAA;AACA;..;AACA&quot;,
  &quot;sources&quot;  =&gt; [..],
  &quot;names&quot;    =&gt; [..]
}</code></pre>

<p>map - Source map hash (uncompressed)</p>

<p>Returns a compressed source map hash according to source map spec v3</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L235-L244'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='235' data-end='244'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 235</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_source_map'>encode_source_map</span>(<span class='id identifier rubyid_map'>map</span>)
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_map'>map</span>
  {
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_version'>version</span>]<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>     <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_file'>file</span>]<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mappings</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_encode_vlq_mappings'><a href="#encode_vlq_mappings-instance_method" title="Sprockets::SourceMapUtils#encode_vlq_mappings (method)">encode_vlq_mappings</a></span>(<span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_mappings'>mappings</span>]<span class='comma'>,</span> <span class='label'>sources:</span> <span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_sources'>sources</span>]<span class='comma'>,</span> <span class='label'>names:</span> <span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_names'>names</span>])<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_sources'>sources</span>]<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>    <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_names'>names</span>]
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encode_vlq_mappings-instance_method">
  <h3 class='signature '>
    #<strong>encode_vlq_mappings</strong>(mappings, sources: nil, names: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Encode mappings Hash into a VLQ encoded String.</p>

<p>mappings - Array of Hash mapping objects sources  - Array of String sources (default: mappings source order) names    - Array of String names (default: mappings name order)</p>

<p>Returns a VLQ encoded String.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L346-L382'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='346' data-end='382'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 346</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_vlq_mappings'>encode_vlq_mappings</span>(<span class='id identifier rubyid_mappings'>mappings</span><span class='comma'>,</span> <span class='label'>sources:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>names:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_sources'>sources</span> <span class='op'>||=</span> <span class='id identifier rubyid_mappings'>mappings</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_source'>source</span>] }.<span class='id identifier rubyid_uniq'>uniq</span>.<span class='id identifier rubyid_compact'>compact</span>
  <span class='id identifier rubyid_names'>names</span>   <span class='op'>||=</span> <span class='id identifier rubyid_mappings'>mappings</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>] }.<span class='id identifier rubyid_uniq'>uniq</span>.<span class='id identifier rubyid_compact'>compact</span>

  <span class='id identifier rubyid_sources_index'>sources_index</span> <span class='op'>=</span> <span class='const'>Hash</span>[<span class='id identifier rubyid_sources'>sources</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span>.<span class='id identifier rubyid_to_a'>to_a</span>]
  <span class='id identifier rubyid_names_index'>names_index</span>   <span class='op'>=</span> <span class='const'>Hash</span>[<span class='id identifier rubyid_names'>names</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span>.<span class='id identifier rubyid_to_a'>to_a</span>]

  <span class='id identifier rubyid_source_id'>source_id</span>     <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_source_line'>source_line</span>   <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_source_column'>source_column</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_name_id'>name_id</span>       <span class='op'>=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_by_lines'>by_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_mappings'>mappings</span>.<span class='id identifier rubyid_group_by'>group_by</span> { <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span> <span class='id identifier rubyid_m'>m</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>][<span class='int'>0</span>] }

  <span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> (<span class='int'>1</span><span class='op'>..</span>(<span class='id identifier rubyid_by_lines'>by_lines</span>.<span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_max'>max</span> <span class='op'>||</span> <span class='int'>1</span>)).<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='id identifier rubyid_generated_column'>generated_column</span> <span class='op'>=</span> <span class='int'>0</span>

    (<span class='id identifier rubyid_by_lines'>by_lines</span>[<span class='id identifier rubyid_line'>line</span>] <span class='op'>||</span> []).<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mapping'>mapping</span><span class='op'>|</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> []
      <span class='id identifier rubyid_group'>group</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>][<span class='int'>1</span>] <span class='op'>-</span> <span class='id identifier rubyid_generated_column'>generated_column</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_sources_index'>sources_index</span>[<span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_source'>source</span>]] <span class='op'>-</span> <span class='id identifier rubyid_source_id'>source_id</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_original'>original</span>][<span class='int'>0</span>] <span class='op'>-</span> <span class='id identifier rubyid_source_line'>source_line</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_original'>original</span>][<span class='int'>1</span>] <span class='op'>-</span> <span class='id identifier rubyid_source_column'>source_column</span>
      <span class='id identifier rubyid_group'>group</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_names_index'>names_index</span>[<span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]] <span class='op'>-</span> <span class='id identifier rubyid_name_id'>name_id</span> <span class='kw'>if</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]

      <span class='id identifier rubyid_generated_column'>generated_column</span> <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_generated'>generated</span>][<span class='int'>1</span>]
      <span class='id identifier rubyid_source_id'>source_id</span>        <span class='op'>=</span> <span class='id identifier rubyid_sources_index'>sources_index</span>[<span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_source'>source</span>]]
      <span class='id identifier rubyid_source_line'>source_line</span>      <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_original'>original</span>][<span class='int'>0</span>]
      <span class='id identifier rubyid_source_column'>source_column</span>    <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_original'>original</span>][<span class='int'>1</span>]
      <span class='id identifier rubyid_name_id'>name_id</span>          <span class='op'>=</span> <span class='id identifier rubyid_names_index'>names_index</span>[<span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]] <span class='kw'>if</span> <span class='id identifier rubyid_mapping'>mapping</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_name'>name</span>]

      <span class='id identifier rubyid_group'>group</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_vlq_encode_mappings'><a href="#vlq_encode_mappings-instance_method" title="Sprockets::SourceMapUtils#vlq_encode_mappings (method)">vlq_encode_mappings</a></span>(<span class='id identifier rubyid_ary'>ary</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="format_source_map-instance_method">
  <h3 class='signature '>
    #<strong>format_source_map</strong>(map, input)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Transpose source maps into a standard format</p>

<p>NOTE: Does not support index maps</p>

<p>version =&gt; 3 file    =&gt; logical path sources =&gt; relative from filename</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Unnecessary</span> <span class='id identifier rubyid_attributes'>attributes</span> <span class='id identifier rubyid_are'>are</span> <span class='id identifier rubyid_removed'>removed</span></code></pre>

<p>Example</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_map'>map</span>
<span class='comment'>#=&gt; {
</span><span class='comment'>#  &quot;version&quot;        =&gt; 3,
</span><span class='comment'>#  &quot;file&quot;           =&gt; &quot;stdin&quot;,
</span><span class='comment'>#  &quot;sourceRoot&quot;     =&gt; &quot;&quot;,
</span><span class='comment'>#  &quot;sourceContents&quot; =&gt; &quot;blah blah blah&quot;,
</span><span class='comment'>#  &quot;sources&quot;        =&gt; [/root/logical/path.js],
</span><span class='comment'>#  &quot;names&quot;          =&gt; [..],
</span><span class='comment'>#}
</span><span class='id identifier rubyid_format_source_map'>format_source_map</span>(<span class='id identifier rubyid_map'>map</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span>)
<span class='comment'>#=&gt; {
</span><span class='comment'>#  &quot;version&quot;        =&gt; 3,
</span><span class='comment'>#  &quot;file&quot;           =&gt; &quot;logical/path.js&quot;,
</span><span class='comment'>#  &quot;sources&quot;        =&gt; [&quot;path.js&quot;],
</span><span class='comment'>#  &quot;names&quot;          =&gt; [..],
</span><span class='comment'>#}</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L37-L57'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='37' data-end='57'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 37</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_format_source_map'>format_source_map</span>(<span class='id identifier rubyid_map'>map</span><span class='comma'>,</span> <span class='id identifier rubyid_input'>input</span>)
  <span class='id identifier rubyid_filename'>filename</span>      <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_filename'>filename</span>]
  <span class='id identifier rubyid_load_path'>load_path</span>     <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_load_path'>load_path</span>]
  <span class='id identifier rubyid_load_paths'>load_paths</span>    <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_environment'>environment</span>].<span class='id identifier rubyid_config'>config</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_paths'>paths</span>]
  <span class='id identifier rubyid_mime_exts'>mime_exts</span>     <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_environment'>environment</span>].<span class='id identifier rubyid_config'>config</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_mime_exts'>mime_exts</span>]
  <span class='id identifier rubyid_pipeline_exts'>pipeline_exts</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_environment'>environment</span>].<span class='id identifier rubyid_config'>config</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_pipeline_exts'>pipeline_exts</span>]
  <span class='id identifier rubyid_file'>file</span>          <span class='op'>=</span> <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_split_subpath'><a href="PathUtils.html#split_subpath-instance_method" title="Sprockets::PathUtils#split_subpath (method)">split_subpath</a></span>(<span class='id identifier rubyid_load_path'>load_path</span><span class='comma'>,</span> <span class='id identifier rubyid_filename'>filename</span>)
  {
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>     <span class='op'>=&gt;</span> <span class='id identifier rubyid_file'>file</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mappings</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mappings</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sources</span><span class='tstring_end'>&quot;</span></span>].<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_source'>source</span><span class='op'>|</span>
      <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='const'><a href="URIUtils.html" title="Sprockets::URIUtils (module)">URIUtils</a></span>.<span class='id identifier rubyid_split_file_uri'><a href="URIUtils.html#split_file_uri-instance_method" title="Sprockets::URIUtils#split_file_uri (method)">split_file_uri</a></span>(<span class='id identifier rubyid_source'>source</span>)[<span class='int'>2</span>] <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_start_with?'>start_with?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file://</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_join'><a href="PathUtils.html#join-instance_method" title="Sprockets::PathUtils#join (method)">join</a></span>(<span class='const'>File</span>.<span class='id identifier rubyid_dirname'>dirname</span>(<span class='id identifier rubyid_filename'>filename</span>)<span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span>) <span class='kw'>unless</span> <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_absolute_path?'><a href="PathUtils.html#absolute_path%3F-instance_method" title="Sprockets::PathUtils#absolute_path? (method)">absolute_path?</a></span>(<span class='id identifier rubyid_source'>source</span>)
      <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_paths_split'><a href="PathUtils.html#paths_split-instance_method" title="Sprockets::PathUtils#paths_split (method)">paths_split</a></span>(<span class='id identifier rubyid_load_paths'>load_paths</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span>)
      <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_relative_path_from'><a href="PathUtils.html#relative_path_from-instance_method" title="Sprockets::PathUtils#relative_path_from (method)">relative_path_from</a></span>(<span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span>)
      <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_set_pipeline'><a href="PathUtils.html#set_pipeline-instance_method" title="Sprockets::PathUtils#set_pipeline (method)">set_pipeline</a></span>(<span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='id identifier rubyid_mime_exts'>mime_exts</span><span class='comma'>,</span> <span class='id identifier rubyid_pipeline_exts'>pipeline_exts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_source'>source</span>)
    <span class='kw'>end</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>    <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names</span><span class='tstring_end'>&quot;</span></span>]
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="make_index_map-instance_method">
  <h3 class='signature '>
    #<strong>make_index_map</strong>(map)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Converts source map to index map</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby">map
# =&gt; {
  &quot;version&quot;  =&gt; 3,
  &quot;file&quot;     =&gt; &quot;..&quot;,
  &quot;mappings&quot; =&gt; &quot;AAAA;AACA;..;AACA&quot;,
  &quot;sources&quot;  =&gt; [..],
  &quot;names&quot;    =&gt; [..]
}
make_index_map(map)
# =&gt; {
  &quot;version&quot;  =&gt; 3,
  &quot;file&quot;     =&gt; &quot;..&quot;,
  &quot;sections&quot; =&gt; [
    {
      &quot;offset&quot; =&gt; { &quot;line&quot; =&gt; 0, &quot;column&quot; =&gt; 0 },
      &quot;map&quot;    =&gt; {
        &quot;version&quot;  =&gt; 3,
        &quot;file&quot;     =&gt; &quot;..&quot;,
        &quot;mappings&quot; =&gt; &quot;AAAA;AACA;..;AACA&quot;,
        &quot;sources&quot;  =&gt; [..],
        &quot;names&quot;    =&gt; [..]
      }
    }
  ]
}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L129-L141'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='129' data-end='141'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 129</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_make_index_map'>make_index_map</span>(<span class='id identifier rubyid_map'>map</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_map'>map</span> <span class='kw'>if</span> <span class='id identifier rubyid_map'>map</span>.<span class='id identifier rubyid_key?'>key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span>
  {
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='tstring_end'>&quot;</span></span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>     <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>file</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sections</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> [
      {
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>offset</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>line</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>column</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>0</span> }<span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>map</span><span class='tstring_end'>&quot;</span></span>    <span class='op'>=&gt;</span> <span class='id identifier rubyid_map'>map</span>
      }
    ]
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="vlq_decode-instance_method">
  <h3 class='signature '>
    #<strong>vlq_decode</strong>(str)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Decode a VLQ string.</p>

<p>str - VLQ encoded String</p>

<p>Returns an Array of Integers.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L429-L450'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='429' data-end='450'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 429</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_vlq_decode'>vlq_decode</span>(<span class='id identifier rubyid_str'>str</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_shift'>shift</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_str'>str</span>.<span class='id identifier rubyid_size'>size</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_digit'>digit</span> <span class='op'>=</span> <span class='const'><a href="#BASE64_VALUES-constant" title="Sprockets::SourceMapUtils::BASE64_VALUES (constant)">BASE64_VALUES</a></span>[<span class='id identifier rubyid_str'>str</span>[<span class='id identifier rubyid_i'>i</span>]]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="Sprockets::ArgumentError (class)">ArgumentError</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_digit'>digit</span>
    <span class='id identifier rubyid_continuation'>continuation</span> <span class='op'>=</span> (<span class='id identifier rubyid_digit'>digit</span> <span class='op'>&amp;</span> <span class='const'><a href="#VLQ_CONTINUATION_BIT-constant" title="Sprockets::SourceMapUtils::VLQ_CONTINUATION_BIT (constant)">VLQ_CONTINUATION_BIT</a></span>) <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_digit'>digit</span> <span class='op'>&amp;=</span> <span class='const'><a href="#VLQ_BASE_MASK-constant" title="Sprockets::SourceMapUtils::VLQ_BASE_MASK (constant)">VLQ_BASE_MASK</a></span>
      <span class='id identifier rubyid_value'>value</span> <span class='op'>+=</span> <span class='id identifier rubyid_digit'>digit</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_shift'>shift</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_continuation'>continuation</span>
      <span class='id identifier rubyid_shift'>shift</span> <span class='op'>+=</span> <span class='const'><a href="#VLQ_BASE_SHIFT-constant" title="Sprockets::SourceMapUtils::VLQ_BASE_SHIFT (constant)">VLQ_BASE_SHIFT</a></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> ((<span class='id identifier rubyid_value'>value</span> <span class='op'>&amp;</span> <span class='int'>1</span>) <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='op'>-</span>(<span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span>) <span class='op'>:</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span>)
      <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_shift'>shift</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="vlq_decode_mappings-instance_method">
  <h3 class='signature '>
    #<strong>vlq_decode_mappings</strong>(str)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Decode a VLQ string into mapping numbers.</p>

<p>str - VLQ encoded String</p>

<p>Returns an two dimensional Array of Integers.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L470-L481'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='470' data-end='481'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 470</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_vlq_decode_mappings'>vlq_decode_mappings</span>(<span class='id identifier rubyid_str'>str</span>)
  <span class='id identifier rubyid_mappings'>mappings</span> <span class='op'>=</span> []

  <span class='id identifier rubyid_str'>str</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>;</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
    <span class='id identifier rubyid_mappings'>mappings</span>[<span class='id identifier rubyid_index'>index</span>] <span class='op'>=</span> []
    <span class='id identifier rubyid_group'>group</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_segment'>segment</span><span class='op'>|</span>
      <span class='id identifier rubyid_mappings'>mappings</span>[<span class='id identifier rubyid_index'>index</span>] <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_vlq_decode'><a href="#vlq_decode-instance_method" title="Sprockets::SourceMapUtils#vlq_decode (method)">vlq_decode</a></span>(<span class='id identifier rubyid_segment'>segment</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mappings'>mappings</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="vlq_encode-instance_method">
  <h3 class='signature '>
    #<strong>vlq_encode</strong>(ary)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Encode a list of numbers into a compact VLQ string.</p>

<p>ary - An Array of Integers</p>

<p>Returns a VLQ String.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L408-L422'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='408' data-end='422'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 408</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_vlq_encode'>vlq_encode</span>(<span class='id identifier rubyid_ary'>ary</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
    <span class='id identifier rubyid_vlq'>vlq</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>?</span> ((<span class='op'>-</span><span class='id identifier rubyid_n'>n</span>) <span class='op'>&lt;&lt;</span> <span class='int'>1</span>) <span class='op'>+</span> <span class='int'>1</span> <span class='op'>:</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_digit'>digit</span>  <span class='op'>=</span> <span class='id identifier rubyid_vlq'>vlq</span> <span class='op'>&amp;</span> <span class='const'><a href="#VLQ_BASE_MASK-constant" title="Sprockets::SourceMapUtils::VLQ_BASE_MASK (constant)">VLQ_BASE_MASK</a></span>
      <span class='id identifier rubyid_vlq'>vlq</span>  <span class='op'>&gt;&gt;=</span> <span class='const'><a href="#VLQ_BASE_SHIFT-constant" title="Sprockets::SourceMapUtils::VLQ_BASE_SHIFT (constant)">VLQ_BASE_SHIFT</a></span>
      <span class='id identifier rubyid_digit'>digit</span> <span class='op'>|=</span> <span class='const'><a href="#VLQ_CONTINUATION_BIT-constant" title="Sprockets::SourceMapUtils::VLQ_CONTINUATION_BIT (constant)">VLQ_CONTINUATION_BIT</a></span> <span class='kw'>if</span> <span class='id identifier rubyid_vlq'>vlq</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="#BASE64_DIGITS-constant" title="Sprockets::SourceMapUtils::BASE64_DIGITS (constant)">BASE64_DIGITS</a></span>[<span class='id identifier rubyid_digit'>digit</span>]

      <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_vlq'>vlq</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="vlq_encode_mappings-instance_method">
  <h3 class='signature '>
    #<strong>vlq_encode_mappings</strong>(ary)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Encode a mapping array into a compact VLQ string.</p>

<p>ary - Two dimensional Array of Integers.</p>

<p>Returns a VLQ encoded String separated by , and ;.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/source_map_utils.rb#L457-L463'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='457' data-end='463'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/source_map_utils.rb', line 457</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_vlq_encode_mappings'>vlq_encode_mappings</span>(<span class='id identifier rubyid_ary'>ary</span>)
  <span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_group'>group</span><span class='op'>|</span>
    <span class='id identifier rubyid_group'>group</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_segment'>segment</span><span class='op'>|</span>
      <span class='id identifier rubyid_vlq_encode'><a href="#vlq_encode-instance_method" title="Sprockets::SourceMapUtils#vlq_encode (method)">vlq_encode</a></span>(<span class='id identifier rubyid_segment'>segment</span>)
    }.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>)
  }.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>;</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>