<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Sprockets::Manifest &mdash; Sprockets main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Sprockets::Manifest",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Sprockets main</a> &raquo; 
      <a href='../_index.html#alpha_M'>Index (M)</a> &raquo; 
        <a href="../Sprockets.html" title="Sprockets (module)">Sprockets</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Manifest&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Sprockets::Manifest</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="ManifestUtils.html" title="Sprockets::ManifestUtils (module)"><code>ManifestUtils</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L19'>lib/sprockets/manifest.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The Manifest logs the contents of assets compiled to a single directory. It records basic attributes about the asset for fast lookup without having to compile. A pointer from each logical path indicates which fingerprinted asset is the current one.</p>

<p>The JSON is part of the public API and should be considered stable. This should make it easy to read from other programming languages and processes that don’t have sprockets loaded. See <a href="#assets-instance_method" title="Sprockets::Manifest#assets (method)">#assets</a> and <a href="#files-instance_method" title="Sprockets::Manifest#files (method)">#files</a> for more information about the structure.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
  <h3 class='inherited'><a href="ManifestUtils.html" title="Sprockets::ManifestUtils (module)"><code>ManifestUtils</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="ManifestUtils.html#MANIFEST_RE-constant" title="Sprockets::ManifestUtils::MANIFEST_RE (constant)">MANIFEST_RE</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(*args)  &#x21d2; Manifest </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create new <code>Manifest</code> associated with an <a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">#environment</a>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#dir-instance_method" title="#dir (instance method)">#<strong>dir</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#directory-instance_method" title="Sprockets::Manifest#directory (method)">#directory</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#directory-instance_method" title="#directory (instance method)">#<strong>directory</strong>  </a>
      (also: #dir)
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#environment-instance_method" title="#environment (instance method)">#<strong>environment</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#filename-instance_method" title="#filename (instance method)">#<strong>filename</strong>  </a>
      (also: #path)
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns String path to manifest.json file.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#path-instance_method" title="#path (instance method)">#<strong>path</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">#filename</a>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#assets-instance_method" title="#assets (instance method)">#<strong>assets</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns internal assets mapping.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#clean-instance_method" title="#clean (instance method)">#<strong>clean</strong>(count = 2, age = 3600)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Cleanup old assets in the compile directory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#clobber-instance_method" title="#clobber (instance method)">#<strong>clobber</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Wipe directive.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#compile-instance_method" title="#compile (instance method)">#<strong>compile</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Compile asset to directory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#files-instance_method" title="#files (instance method)">#<strong>files</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns internal file directory listing.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find-instance_method" title="#find (instance method)">#<strong>find</strong>(*args, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Find all assets matching pattern set in environment.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_sources-instance_method" title="#find_sources (instance method)">#<strong>find_sources</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Public: Find the source of assets by paths.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#remove-instance_method" title="#remove (instance method)">#<strong>remove</strong>(filename)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes file from directory and from manifest.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#save-instance_method" title="#save (instance method)">#<strong>save</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Persist manifest back to FS.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#executor-instance_method" title="#executor (instance method)">#<strong>executor</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#exporters_for_asset-instance_method" title="#exporters_for_asset (instance method)">#<strong>exporters_for_asset</strong>(asset)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Given an asset, finds all exporters that match its mime-type.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#json_decode-instance_method" title="#json_decode (instance method)">#<strong>json_decode</strong>(obj)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#json_encode-instance_method" title="#json_encode (instance method)">#<strong>json_encode</strong>(obj)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#logger-instance_method" title="#logger (instance method)">#<strong>logger</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>

<h3 class='inherited'><a href="ManifestUtils.html" title="Sprockets::ManifestUtils (module)"><code>ManifestUtils</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="ManifestUtils.html#find_directory_manifest-instance_method" title="Sprockets::ManifestUtils#find_directory_manifest (method)">#find_directory_manifest</a></td>
      <td><div class='inline'><p>Public: Find or pick a new manifest filename for target build directory.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="ManifestUtils.html#generate_manifest_path-instance_method" title="Sprockets::ManifestUtils#generate_manifest_path (method)">#generate_manifest_path</a></td>
      <td><div class='inline'><p>Public: Generate a new random manifest path.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(*args)  &#x21d2; <code>Manifest</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create new <code>Manifest</code> associated with an <a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">#environment</a>. <a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">#filename</a> is a full path to the manifest json file. The file may or may not already exist. The dirname of the <a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">#filename</a> will be used to write compiled assets to. Otherwise, if the path is a directory, the filename will default a random “.sprockets-manifest-*.json” file in that directory.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Manifest</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>./public/assets/manifest.json</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L32-L74'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='32' data-end='74'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 32</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="Base.html" title="Sprockets::Base (class)">Base</a></span>) <span class='op'>||</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@environment</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_shift'>shift</span>
  <span class='kw'>end</span>

  <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='ivar'>@filename</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span>[<span class='int'>1</span>]

  <span class='comment'># Whether the manifest file is using the old manifest-*.json naming convention
</span>  <span class='ivar'>@legacy_manifest</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># Expand paths
</span>  <span class='ivar'>@directory</span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span>(<span class='ivar'>@directory</span>) <span class='kw'>if</span> <span class='ivar'>@directory</span>
  <span class='ivar'>@filename</span>  <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_expand_path'>expand_path</span>(<span class='ivar'>@filename</span>) <span class='kw'>if</span> <span class='ivar'>@filename</span>

  <span class='comment'># If filename is given as the second arg
</span>  <span class='kw'>if</span> <span class='ivar'>@directory</span> <span class='op'>&amp;&amp;</span> <span class='const'>File</span>.<span class='id identifier rubyid_extname'>extname</span>(<span class='ivar'>@directory</span>) <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@directory</span><span class='comma'>,</span> <span class='ivar'>@filename</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='ivar'>@directory</span>
  <span class='kw'>end</span>

  <span class='comment'># Default dir to the directory of the filename
</span>  <span class='ivar'>@directory</span> <span class='op'>||=</span> <span class='const'>File</span>.<span class='id identifier rubyid_dirname'>dirname</span>(<span class='ivar'>@filename</span>) <span class='kw'>if</span> <span class='ivar'>@filename</span>

  <span class='comment'># If directory is given w/o filename, pick a random manifest location
</span>  <span class='kw'>if</span> <span class='ivar'>@directory</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@filename</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='ivar'>@filename</span> <span class='op'>=</span> <span class='id identifier rubyid_find_directory_manifest'>find_directory_manifest</span>(<span class='ivar'>@directory</span><span class='comma'>,</span> <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Sprockets::Manifest#logger (method)">logger</a></span>)
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='ivar'>@directory</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@filename</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="Sprockets::ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>manifest requires output filename</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> {}

  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='ivar'>@filename</span>)
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_json_decode'><a href="#json_decode-instance_method" title="Sprockets::Manifest#json_decode (method)">json_decode</a></span>(<span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='ivar'>@filename</span>))
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>JSON</span><span class='op'>::</span><span class='const'>ParserError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Sprockets::Manifest#logger (method)">logger</a></span>.<span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@filename</span><span class='embexpr_end'>}</span><span class='tstring_content'> is invalid: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="dir-instance_method">
  <h3 class='signature ro first'>
    #<strong>dir</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#directory-instance_method" title="Sprockets::Manifest#directory (method)">#directory</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L81-L81'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='81' data-end='81'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 81</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_directory'><a href="#directory-instance_method" title="Sprockets::Manifest#directory (method)">directory</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="directory-instance_method">
  <h3 class='signature ro'>
    #<strong>directory</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#dir</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L80-L80'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='80' data-end='80'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 80</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_directory'>directory</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="environment-instance_method">
  <h3 class='signature ro'>
    #<strong>environment</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L22-L22'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='22' data-end='22'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 22</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_environment'>environment</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="filename-instance_method">
  <h3 class='signature ro'>
    #<strong>filename</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#path</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns String path to manifest.json file.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L77-L77'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='77' data-end='77'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 77</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_filename'>filename</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="path-instance_method">
  <h3 class='signature ro'>
    #<strong>path</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">#filename</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L78-L78'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='78' data-end='78'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 78</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="assets-instance_method">
  <h3 class='signature  first'>
    #<strong>assets</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns internal assets mapping. Keys are logical paths which map to the latest fingerprinted filename.</p>

<pre class="code ruby"><code class="ruby">Logical path (String): Fingerprint path (String)

{ &quot;application.js&quot; =&gt; &quot;application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js&quot;,
  &quot;jquery.js&quot;      =&gt; &quot;jquery-ae0908555a245f8266f77df5a8edca2e.js&quot; }</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L91-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='91' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 91</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assets'>assets</span>
  <span class='ivar'>@data</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>assets</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> {}
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clean-instance_method">
  <h3 class='signature '>
    #<strong>clean</strong>(count = 2, age = 3600)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Cleanup old assets in the compile directory. By default it will keep the latest version, 2 backups and any created within the past hour.</p>

<p>Examples</p>

<pre class="code ruby"><code class="ruby">To force only 1 backup to be kept, set count=1 and age=0.

To only keep files created within the last 10 minutes, set count=0 and
age=600.</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L246-L266'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='246' data-end='266'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 246</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clean'>clean</span>(<span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>=</span> <span class='int'>3600</span>)
  <span class='id identifier rubyid_asset_versions'>asset_versions</span> <span class='op'>=</span> <span class='id identifier rubyid_files'><a href="#files-instance_method" title="Sprockets::Manifest#files (method)">files</a></span>.<span class='id identifier rubyid_group_by'>group_by</span> { <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='op'>|</span> <span class='id identifier rubyid_attrs'>attrs</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>logical_path</span><span class='tstring_end'>&#39;</span></span>] }

  <span class='id identifier rubyid_asset_versions'>asset_versions</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_logical_path'>logical_path</span><span class='comma'>,</span> <span class='id identifier rubyid_versions'>versions</span><span class='op'>|</span>
    <span class='id identifier rubyid_current'>current</span> <span class='op'>=</span> <span class='id identifier rubyid_assets'><a href="#assets-instance_method" title="Sprockets::Manifest#assets (method)">assets</a></span>[<span class='id identifier rubyid_logical_path'>logical_path</span>]

    <span class='id identifier rubyid_versions'>versions</span>.<span class='id identifier rubyid_reject'>reject</span> { <span class='op'>|</span><span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span>
      <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span> <span class='op'>==</span> <span class='id identifier rubyid_current'>current</span>
    }.<span class='id identifier rubyid_sort_by'>sort_by</span> { <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='op'>|</span>
      <span class='comment'># Sort by timestamp
</span>      <span class='const'>Time</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_attrs'>attrs</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mtime</span><span class='tstring_end'>&#39;</span></span>])
    }.<span class='id identifier rubyid_reverse'>reverse</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span>.<span class='id identifier rubyid_drop_while'>drop_while</span> { <span class='op'>|</span>(<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_attrs'>attrs</span>)<span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
      <span class='id identifier rubyid__age'>_age</span> <span class='op'>=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='const'>Time</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_attrs'>attrs</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mtime</span><span class='tstring_end'>&#39;</span></span>])].<span class='id identifier rubyid_max'>max</span>
      <span class='comment'># Keep if under age or within the count limit
</span>      <span class='id identifier rubyid__age'>_age</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_age'>age</span> <span class='op'>||</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_count'>count</span>
    }.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span>)<span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span>
       <span class='comment'># Remove old assets
</span>      <span class='id identifier rubyid_remove'><a href="#remove-instance_method" title="Sprockets::Manifest#remove (method)">remove</a></span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span>)
    }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clobber-instance_method">
  <h3 class='signature '>
    #<strong>clobber</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Wipe directive</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L269-L275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='269' data-end='275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 269</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clobber'>clobber</span>
  <span class='const'>FileUtils</span>.<span class='id identifier rubyid_rm_r'>rm_r</span>(<span class='id identifier rubyid_directory'><a href="#directory-instance_method" title="Sprockets::Manifest#directory (method)">directory</a></span>) <span class='kw'>if</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_directory'><a href="#directory-instance_method" title="Sprockets::Manifest#directory (method)">directory</a></span>)
  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Sprockets::Manifest#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Removed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_directory'><a href="#directory-instance_method" title="Sprockets::Manifest#directory (method)">directory</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># if we have an environment clear the cache too
</span>  <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_cache'>cache</span>.<span class='id identifier rubyid_clear'>clear</span> <span class='kw'>if</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>
  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile-instance_method">
  <h3 class='signature '>
    #<strong>compile</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Compile asset to directory. The asset is written to a fingerprinted filename like <code>application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js</code>. An entry is also inserted into the manifest file.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_compile'>compile</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application.js</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L161-L209'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='161' data-end='209'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 161</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile'>compile</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Sprockets::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>manifest requires environment for compilation</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_filenames'>filenames</span>            <span class='op'>=</span> []
  <span class='id identifier rubyid_concurrent_exporters'>concurrent_exporters</span> <span class='op'>=</span> []

  <span class='id identifier rubyid_assets_to_export'>assets_to_export</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Array</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Sprockets::Manifest.new (method)">new</a></span>
  <span class='id identifier rubyid_find'><a href="#find-instance_method" title="Sprockets::Manifest#find (method)">find</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_asset'>asset</span><span class='op'>|</span>
    <span class='id identifier rubyid_assets_to_export'>assets_to_export</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_asset'>asset</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_assets_to_export'>assets_to_export</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_asset'>asset</span><span class='op'>|</span>
    <span class='id identifier rubyid_mtime'>mtime</span> <span class='op'>=</span> <span class='const'>Time</span>.<span class='id identifier rubyid_now'>now</span>.<span class='id identifier rubyid_iso8601'>iso8601</span>
    <span class='id identifier rubyid_files'><a href="#files-instance_method" title="Sprockets::Manifest#files (method)">files</a></span>[<span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_digest_path'>digest_path</span>] <span class='op'>=</span> {
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>logical_path</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_logical_path'>logical_path</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mtime</span><span class='tstring_end'>&#39;</span></span>        <span class='op'>=&gt;</span> <span class='id identifier rubyid_mtime'>mtime</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>size</span><span class='tstring_end'>&#39;</span></span>         <span class='op'>=&gt;</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_bytesize'>bytesize</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>digest</span><span class='tstring_end'>&#39;</span></span>       <span class='op'>=&gt;</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='comma'>,</span>

      <span class='comment'># Deprecated: Remove beta integrity attribute in next release.
</span>      <span class='comment'># Callers should DigestUtils.hexdigest_integrity_uri to compute the
</span>      <span class='comment'># digest themselves.
</span>      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>integrity</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='const'><a href="DigestUtils.html" title="Sprockets::DigestUtils (module)">DigestUtils</a></span>.<span class='id identifier rubyid_hexdigest_integrity_uri'><a href="DigestUtils.html#hexdigest_integrity_uri-instance_method" title="Sprockets::DigestUtils#hexdigest_integrity_uri (method)">hexdigest_integrity_uri</a></span>(<span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_hexdigest'>hexdigest</span>)
    }
    <span class='id identifier rubyid_assets'><a href="#assets-instance_method" title="Sprockets::Manifest#assets (method)">assets</a></span>[<span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_logical_path'>logical_path</span>] <span class='op'>=</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_digest_path'>digest_path</span>

    <span class='id identifier rubyid_filenames'>filenames</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>

    <span class='id identifier rubyid_promise'>promise</span>      <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_exporters_for_asset'><a href="#exporters_for_asset-instance_method" title="Sprockets::Manifest#exporters_for_asset (method)">exporters_for_asset</a></span>(<span class='id identifier rubyid_asset'>asset</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_exporter'>exporter</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_exporter'>exporter</span>.<span class='id identifier rubyid_skip?'>skip?</span>(<span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Sprockets::Manifest#logger (method)">logger</a></span>)

      <span class='kw'>if</span> <span class='id identifier rubyid_promise'>promise</span>.<span class='id identifier rubyid_nil?'>nil?</span>
        <span class='id identifier rubyid_promise'>promise</span> <span class='op'>=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Promise</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Sprockets::Manifest.new (method)">new</a></span>(<span class='label'>executor:</span> <span class='id identifier rubyid_executor'><a href="#executor-instance_method" title="Sprockets::Manifest#executor (method)">executor</a></span>) { <span class='id identifier rubyid_exporter'>exporter</span>.<span class='id identifier rubyid_call'>call</span> }
        <span class='id identifier rubyid_concurrent_exporters'>concurrent_exporters</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_promise'>promise</span>.<span class='id identifier rubyid_execute'>execute</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_concurrent_exporters'>concurrent_exporters</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_promise'>promise</span>.<span class='id identifier rubyid_then'>then</span> { <span class='id identifier rubyid_exporter'>exporter</span>.<span class='id identifier rubyid_call'>call</span> }
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># make sure all exporters have finished before returning the main thread
</span>  <span class='id identifier rubyid_concurrent_exporters'>concurrent_exporters</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_wait!'>wait!</span>)
  <span class='id identifier rubyid_save'><a href="#save-instance_method" title="Sprockets::Manifest#save (method)">save</a></span>

  <span class='id identifier rubyid_filenames'>filenames</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="executor-instance_method">
  <h3 class='signature priv'>
    #<strong>executor</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L335-L337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='335' data-end='337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 335</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_executor'>executor</span>
  <span class='ivar'>@executor</span> <span class='op'>||=</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_export_concurrent'>export_concurrent</span> <span class='op'>?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_fast'>fast</span> <span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_immediate'>immediate</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exporters_for_asset-instance_method">
  <h3 class='signature priv'>
    #<strong>exporters_for_asset</strong>(asset)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given an asset, finds all exporters that match its mime-type.</p>

<p>Will yield each expoter to the passed in block.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> []
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_content_type'>content_type</span> <span class='comment'># =&gt; &quot;application/javascript&quot;
</span><span class='id identifier rubyid_exporters_for_asset'>exporters_for_asset</span>(<span class='id identifier rubyid_asset'>asset</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_exporter'>exporter</span><span class='op'>|</span>
  <span class='id identifier rubyid_array'>array</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_exporter'>exporter</span>
<span class='kw'>end</span>
<span class='comment'># puts array =&gt; [Exporters::FileExporter, Exporters::ZlibExporter]</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L299-L315'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='299' data-end='315'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 299</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exporters_for_asset'>exporters_for_asset</span>(<span class='id identifier rubyid_asset'>asset</span>)
  <span class='id identifier rubyid_exporters'>exporters</span> <span class='op'>=</span> [<span class='const'><a href="Exporters.html" title="Sprockets::Exporters (module)">Exporters</a></span><span class='op'>::</span><span class='const'><a href="Exporters/FileExporter.html" title="Sprockets::Exporters::FileExporter (class)">FileExporter</a></span>]

  <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_exporters'>exporters</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_mime_type'>mime_type</span><span class='comma'>,</span> <span class='id identifier rubyid_exporter_list'>exporter_list</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_content_type'>content_type</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_match_mime_type?'>match_mime_type?</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_content_type'>content_type</span><span class='comma'>,</span> <span class='id identifier rubyid_mime_type'>mime_type</span>
    <span class='id identifier rubyid_exporter_list'>exporter_list</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_exporter'>exporter</span><span class='op'>|</span>
      <span class='id identifier rubyid_exporters'>exporters</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_exporter'>exporter</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_exporters'>exporters</span>.<span class='id identifier rubyid_uniq!'>uniq!</span>

  <span class='id identifier rubyid_exporters'>exporters</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_exporter'>exporter</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_exporter'>exporter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Sprockets::Manifest.new (method)">new</a></span>(<span class='label'>asset:</span> <span class='id identifier rubyid_asset'>asset</span><span class='comma'>,</span> <span class='label'>environment:</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span><span class='comma'>,</span> <span class='label'>directory:</span> <span class='id identifier rubyid_dir'><a href="#dir-instance_method" title="Sprockets::Manifest#dir (method)">dir</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="files-instance_method">
  <h3 class='signature '>
    #<strong>files</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns internal file directory listing. Keys are filenames which map to an attributes array.</p>

<pre class="code ruby"><code class="ruby"> Fingerprint path (String):
   logical_path: Logical path (String)
   mtime: ISO8601 mtime (String)
   digest: Base64 hex digest (String)

{ &quot;application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js&quot; =&gt;
    { &#39;logical_path&#39; =&gt; &quot;application.js&quot;,
      &#39;mtime&#39; =&gt; &quot;2011-12-13T21:47:08-06:00&quot;,
      &#39;digest&#39; =&gt; &quot;2e8e9a7c6b0aafa0c9bdeec90ea30213&quot; } }</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L108-L110'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='108' data-end='110'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 108</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_files'>files</span>
  <span class='ivar'>@data</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>files</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> {}
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find-instance_method">
  <h3 class='signature '>
    #<strong>find</strong>(*args, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Find all assets matching pattern set in environment.</p>

<p>Returns Enumerator of Assets.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L115-L134'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='115' data-end='134'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 115</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find'>find</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="Error.html" title="Sprockets::Error (class)">Error</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>manifest requires environment for compilation</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_to_enum'>to_enum</span>(<span class='id identifier rubyid___method__'>__method__</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_cached'>cached</span>
  <span class='id identifier rubyid_promises'>promises</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_flatten'>flatten</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span><span class='op'>|</span>
    <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>Promise</span>.<span class='id identifier rubyid_execute'>execute</span>(<span class='label'>executor:</span> <span class='id identifier rubyid_executor'><a href="#executor-instance_method" title="Sprockets::Manifest#executor (method)">executor</a></span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_find_all_linked_assets'>find_all_linked_assets</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span>).<span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_promises'>promises</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_promise'>promise</span><span class='op'>|</span>
    <span class='id identifier rubyid_promise'>promise</span>.<span class='id identifier rubyid_value!'>value!</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_sources-instance_method">
  <h3 class='signature '>
    #<strong>find_sources</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Public: Find the source of assets by paths.</p>

<p>Returns Enumerator of assets file content.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L139-L152'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='139' data-end='152'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 139</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_sources'>find_sources</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_to_enum'>to_enum</span>(<span class='id identifier rubyid___method__'>__method__</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>
    <span class='id identifier rubyid_find'><a href="#find-instance_method" title="Sprockets::Manifest#find (method)">find</a></span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_asset'>asset</span><span class='op'>|</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_asset'>asset</span>.<span class='id identifier rubyid_source'>source</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span><span class='op'>|</span>
      <span class='id identifier rubyid_asset'>asset</span> <span class='op'>=</span> <span class='id identifier rubyid_assets'><a href="#assets-instance_method" title="Sprockets::Manifest#assets (method)">assets</a></span>[<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span>]
      <span class='kw'>yield</span> <span class='const'>File</span>.<span class='id identifier rubyid_binread'>binread</span>(<span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='id identifier rubyid_dir'><a href="#dir-instance_method" title="Sprockets::Manifest#dir (method)">dir</a></span><span class='comma'>,</span> <span class='id identifier rubyid_asset'>asset</span>)) <span class='kw'>if</span> <span class='id identifier rubyid_asset'>asset</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="json_decode-instance_method">
  <h3 class='signature priv'>
    #<strong>json_decode</strong>(obj)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L317-L319'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='317' data-end='319'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 317</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_json_decode'>json_decode</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='const'>JSON</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='label'>create_additions:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="json_encode-instance_method">
  <h3 class='signature priv'>
    #<strong>json_encode</strong>(obj)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L321-L323'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='321' data-end='323'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 321</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_json_encode'>json_encode</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='const'>JSON</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='id identifier rubyid_obj'>obj</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="logger-instance_method">
  <h3 class='signature priv'>
    #<strong>logger</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L325-L333'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='325' data-end='333'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 325</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>
    <span class='id identifier rubyid_environment'><a href="#environment-instance_method" title="Sprockets::Manifest#environment (method)">environment</a></span>.<span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='const'>Logger</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Sprockets::Manifest.new (method)">new</a></span>(<span class='gvar'>$stderr</span>)
    <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='const'>Logger</span><span class='op'>::</span><span class='const'>FATAL</span>
    <span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="remove-instance_method">
  <h3 class='signature '>
    #<strong>remove</strong>(filename)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes file from directory and from manifest. <a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">#filename</a> must be the name with any directory path.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_manifest'>manifest</span>.<span class='id identifier rubyid_remove'>remove</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application-2e8e9a7c6b0aafa0c9bdeec90ea30213.js</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L216-L234'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='216' data-end='234'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 216</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_remove'>remove</span>(<span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>)
  <span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span> <span class='op'>=</span> <span class='const'>File</span>.<span class='id identifier rubyid_join'>join</span>(<span class='id identifier rubyid_dir'><a href="#dir-instance_method" title="Sprockets::Manifest#dir (method)">dir</a></span><span class='comma'>,</span> <span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>)
  <span class='id identifier rubyid_gzip'>gzip</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>.gz</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_logical_path'>logical_path</span> <span class='op'>=</span> <span class='id identifier rubyid_files'><a href="#files-instance_method" title="Sprockets::Manifest#files (method)">files</a></span>[<span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>][<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>logical_path</span><span class='tstring_end'>&#39;</span></span>]

  <span class='kw'>if</span> <span class='id identifier rubyid_assets'><a href="#assets-instance_method" title="Sprockets::Manifest#assets (method)">assets</a></span>[<span class='id identifier rubyid_logical_path'>logical_path</span>] <span class='op'>==</span> <span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>
    <span class='id identifier rubyid_assets'><a href="#assets-instance_method" title="Sprockets::Manifest#assets (method)">assets</a></span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_logical_path'>logical_path</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_files'><a href="#files-instance_method" title="Sprockets::Manifest#files (method)">files</a></span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span>)
  <span class='const'>FileUtils</span>.<span class='id identifier rubyid_rm'>rm</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span>) <span class='kw'>if</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_path'><a href="#path-instance_method" title="Sprockets::Manifest#path (method)">path</a></span>)
  <span class='const'>FileUtils</span>.<span class='id identifier rubyid_rm'>rm</span>(<span class='id identifier rubyid_gzip'>gzip</span>) <span class='kw'>if</span> <span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_gzip'>gzip</span>)

  <span class='id identifier rubyid_save'><a href="#save-instance_method" title="Sprockets::Manifest#save (method)">save</a></span>

  <span class='id identifier rubyid_logger'><a href="#logger-instance_method" title="Sprockets::Manifest#logger (method)">logger</a></span>.<span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Removed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'><a href="#filename-instance_method" title="Sprockets::Manifest#filename (method)">filename</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="save-instance_method">
  <h3 class='signature '>
    #<strong>save</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Persist manifest back to FS</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/sprockets/blob/main/lib/sprockets/manifest.rb#L278-L284'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='278' data-end='284'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/sprockets/manifest.rb', line 278</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save'>save</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_json_encode'><a href="#json_encode-instance_method" title="Sprockets::Manifest#json_encode (method)">json_encode</a></span>(<span class='ivar'>@data</span>)
  <span class='const'>FileUtils</span>.<span class='id identifier rubyid_mkdir_p'>mkdir_p</span> <span class='const'>File</span>.<span class='id identifier rubyid_dirname'>dirname</span>(<span class='ivar'>@filename</span>)
  <span class='const'><a href="PathUtils.html" title="Sprockets::PathUtils (module)">PathUtils</a></span>.<span class='id identifier rubyid_atomic_write'><a href="PathUtils.html#atomic_write-instance_method" title="Sprockets::PathUtils#atomic_write (method)">atomic_write</a></span>(<span class='ivar'>@filename</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
    <span class='id identifier rubyid_f'>f</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_data'>data</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>