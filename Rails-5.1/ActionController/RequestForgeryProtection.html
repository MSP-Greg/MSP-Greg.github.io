<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::RequestForgeryProtection &mdash; Rails-5.1.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActionController::RequestForgeryProtection",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.1.0</a> &raquo; 
          <a href='../_index.html'>Index (R)</a> &raquo; 
          <a href="../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
          <span class='title'>RequestForgeryProtection</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActionController::RequestForgeryProtection</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <div class='box_max'>
        <a href="RequestForgeryProtection/ClassMethods.html" title="ActionController::RequestForgeryProtection::ClassMethods (module)">ClassMethods</a>,
    <a href="RequestForgeryProtection/ProtectionMethods.html" title="ActionController::RequestForgeryProtection::ProtectionMethods (module)">ProtectionMethods</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Extended by:</td>
    <td>
      <div class='box_max'>
        <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Includes:</td>
    <td>
      <div class='box_max'>
        <a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)">AbstractController::Callbacks</a>, <a href="../AbstractController/Helpers.html" title="AbstractController::Helpers (module)">AbstractController::Helpers</a>
      </div>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L56'>actionpack/lib/action_controller/metal/request_forgery_protection.rb</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Controller actions are protected from Cross-Site Request Forgery (CSRF)
attacks by including a token in the rendered HTML for your application.
This token is stored as a random string in the session, to which an
attacker does not have access. When a request reaches your application,
Rails verifies the received token with the token in the session. All
requests are checked except GET requests as these should be idempotent.
Keep in mind that all session-oriented requests should be CSRF protected,
including JavaScript and HTML requests.</p>

<p>Since HTML and JavaScript requests are typically made from the browser, we
need to ensure to verify request authenticity for the web browser. We can
use session-oriented authentication for these types of requests, by using
the <code>protect_from_forgery</code> method in our controllers.</p>

<p>GET requests are not protected since they don&#39;t have side effects like
writing to the database and don&#39;t leak sensitive information.
JavaScript requests are an exception: a third-party site can use a
&lt;script&gt; tag to reference a JavaScript URL on your site. When your
JavaScript response loads on their site, it executes. With carefully
crafted JavaScript on their end, sensitive data in your JavaScript response
may be extracted. To prevent this, only XmlHttpRequest (known as XHR or
Ajax) requests are allowed to make GET requests for JavaScript responses.</p>

<p>It&#39;s important to remember that XML or JSON requests are also affected
and if you&#39;re building an API you should change forgery protection
method in <code>ApplicationController</code> (by default:
<code>:exception</code>):</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>unless:</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json?'>json?</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>CSRF protection is turned on with the <code>protect_from_forgery</code>
method. By default <code>protect_from_forgery</code> protects your session
with <code>:null_session</code> method, which provides an empty session
during request.</p>

<p>We may want to disable CSRF protection for APIs since they are typically
designed to be state-less. That is, the request API client will handle the
session for you instead of Rails.</p>

<p>The token parameter is named <code>authenticity_token</code> by default.
The name and value of this token must be added to every layout that renders
forms by including <code>csrf_meta_tags</code> in the HTML
<code>head</code>.</p>

<p>Learn more about CSRF attacks and securing your application in the <code>Ruby</code>[<a
href="http://guides.rubyonrails.org/security.html">guides.rubyonrails.org/security.html</a>].</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='AUTHENTICITY_TOKEN_LENGTH-constant'>
      AUTHENTICITY_TOKEN_LENGTH =
    </dt>
    <dd>
            <pre class='code ruby'><span class='int'>32</span></pre>
    </dd>
    <dt id='CROSS_ORIGIN_JAVASCRIPT_WARNING-constant'>
      CROSS_ORIGIN_JAVASCRIPT_WARNING =
    </dt>
    <dd>
            <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Security warning: an embedded </span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;script&gt; tag on another site requested protected JavaScript. </span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>If you know what you&#39;re doing, go ahead and disable forgery </span><span class='tstring_end'>&quot;</span></span> \
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>protection on this action to permit cross-origin JavaScript embedding.</span><span class='tstring_end'>&quot;</span></span></pre>
    </dd>
  </dl>



  
  
  <h3 class="inherited">Constants included
     from <a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)">ActiveSupport::Callbacks</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Callbacks.html#CALLBACK_FILTER_TYPES-constant" title="ActiveSupport::Callbacks::CALLBACK_FILTER_TYPES (constant)">ActiveSupport::Callbacks::CALLBACK_FILTER_TYPES</a></p>



<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#any_authenticity_token_valid%3F-instance_method" title="#any_authenticity_token_valid? (instance method)">#<strong>any_authenticity_token_valid?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Checks if any of the authenticity tokens from the request are valid.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#compare_with_real_token-instance_method" title="#compare_with_real_token (instance method)">#<strong>compare_with_real_token</strong>(token, session)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#form_authenticity_param-instance_method" title="#form_authenticity_param (instance method)">#<strong>form_authenticity_param</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The form&#39;s authenticity parameter.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#form_authenticity_token-instance_method" title="#form_authenticity_token (instance method)">#<strong>form_authenticity_token</strong>(form_options: {})  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Sets the token value for the current session.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#handle_unverified_request-instance_method" title="#handle_unverified_request (instance method)">#<strong>handle_unverified_request</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#mark_for_same_origin_verification%21-instance_method" title="#mark_for_same_origin_verification! (instance method)">#<strong>mark_for_same_origin_verification!</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>GET requests are checked for cross-origin JavaScript after rendering.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#marked_for_same_origin_verification%3F-instance_method" title="#marked_for_same_origin_verification? (instance method)">#<strong>marked_for_same_origin_verification?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>If the <code>verify_authenticity_token</code> before_action ran, verify
that JavaScript responses are only served to same-origin GET requests.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#masked_authenticity_token-instance_method" title="#masked_authenticity_token (instance method)">#<strong>masked_authenticity_token</strong>(session, form_options: {})  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a masked version of the authenticity token that varies on each
request.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#non_xhr_javascript_response%3F-instance_method" title="#non_xhr_javascript_response? (instance method)">#<strong>non_xhr_javascript_response?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Check for cross-origin JavaScript responses.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#normalize_action_path-instance_method" title="#normalize_action_path (instance method)">#<strong>normalize_action_path</strong>(action_path)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#per_form_csrf_token-instance_method" title="#per_form_csrf_token (instance method)">#<strong>per_form_csrf_token</strong>(session, action_path, method)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#protect_against_forgery%3F-instance_method" title="#protect_against_forgery? (instance method)">#<strong>protect_against_forgery?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Checks if the controller allows forgery protection.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#real_csrf_token-instance_method" title="#real_csrf_token (instance method)">#<strong>real_csrf_token</strong>(session)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#request_authenticity_tokens-instance_method" title="#request_authenticity_tokens (instance method)">#<strong>request_authenticity_tokens</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Possible authenticity tokens sent in the request.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#unmask_token-instance_method" title="#unmask_token (instance method)">#<strong>unmask_token</strong>(masked_token)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#valid_authenticity_token%3F-instance_method" title="#valid_authenticity_token? (instance method)">#<strong>valid_authenticity_token?</strong>(session, encoded_masked_token)  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Checks the client&#39;s masked token to see if it matches the session
token.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#valid_per_form_csrf_token%3F-instance_method" title="#valid_per_form_csrf_token? (instance method)">#<strong>valid_per_form_csrf_token?</strong>(token, session)  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#valid_request_origin%3F-instance_method" title="#valid_request_origin? (instance method)">#<strong>valid_request_origin?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Checks if the request originated from the same origin by looking at the
Origin header.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verified_request%3F-instance_method" title="#verified_request? (instance method)">#<strong>verified_request?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns true or false if a request is verified.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify_authenticity_token-instance_method" title="#verify_authenticity_token (instance method)">#<strong>verify_authenticity_token</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>The actual before_action that is used to verify the CSRF token.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#verify_same_origin_request-instance_method" title="#verify_same_origin_request (instance method)">#<strong>verify_same_origin_request</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>If <code>verify_authenticity_token</code> was run (indicating that we have
forgery protection enabled for this request) then also verify that we
aren&#39;t serving an unauthorized cross-origin response.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#xor_byte_strings-instance_method" title="#xor_byte_strings (instance method)">#<strong>xor_byte_strings</strong>(s1, s2)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>, <a href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>, <a href="../ActiveSupport/Concern.html#extended-class_method" title="ActiveSupport::Concern.extended (method)">.extended</a>, <a href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../AbstractController/Callbacks.html" title="AbstractController::Callbacks (module)">AbstractController::Callbacks</a></h3>
  <p class="inherited"><a href="../AbstractController/Callbacks.html#process_action-instance_method" title="AbstractController::Callbacks#process_action (method)">#process_action</a></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../ActiveSupport/Callbacks.html" title="ActiveSupport::Callbacks (module)">ActiveSupport::Callbacks</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Callbacks.html#__run_callbacks__-instance_method" title="ActiveSupport::Callbacks#__run_callbacks__ (method)">#__run_callbacks__</a>, <a href="../ActiveSupport/Callbacks.html#halted_callback_hook-instance_method" title="ActiveSupport::Callbacks#halted_callback_hook (method)">#halted_callback_hook</a>, <a href="../ActiveSupport/Callbacks.html#run_callbacks-instance_method" title="ActiveSupport::Callbacks#run_callbacks (method)">#run_callbacks</a></p>

  
  
  
  
  
  <h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="any_authenticity_token_valid?-instance_method">
  <h3 class='signature first'>
  #<strong>any_authenticity_token_valid?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Checks if any of the authenticity tokens from the request are valid.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L274'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


274
275
276
277
278</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 274</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_any_authenticity_token_valid?'>any_authenticity_token_valid?</span>
  <span class='id identifier rubyid_request_authenticity_tokens'>request_authenticity_tokens</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token'>token</span><span class='op'>|</span>
    <span class='id identifier rubyid_valid_authenticity_token?'>valid_authenticity_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="compare_with_real_token-instance_method">
  <h3 class='signature'>
  #<strong>compare_with_real_token</strong>(token, session)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L351'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


351
352
353</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 351</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span><span class='period'>.</span><span class='id identifier rubyid_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">secure_compare</a></span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="form_authenticity_param-instance_method">
  <h3 class='signature'>
  #<strong>form_authenticity_param</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The form&#39;s authenticity parameter. Override to provide your own.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L389'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


389
390
391</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_form_authenticity_param'>form_authenticity_param</span>
  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="form_authenticity_token-instance_method">
  <h3 class='signature'>
  #<strong>form_authenticity_token</strong>(form_options: {})   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Sets the token value for the current session.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L286'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


286
287
288</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 286</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_form_authenticity_token'>form_authenticity_token</span><span class='lparen'>(</span><span class='label'>form_options:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_masked_authenticity_token'>masked_authenticity_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='label'>form_options:</span> <span class='id identifier rubyid_form_options'>form_options</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="handle_unverified_request-instance_method">
  <h3 class='signature'>
  #<strong>handle_unverified_request</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L222'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


222
223
224</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 222</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
  <span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="mark_for_same_origin_verification!-instance_method">
  <h3 class='signature'>
  #<strong>mark_for_same_origin_verification!</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>GET requests are checked for cross-origin JavaScript after rendering.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L246'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


246
247
248</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 246</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_mark_for_same_origin_verification!'>mark_for_same_origin_verification!</span>
  <span class='ivar'>@marked_for_same_origin_verification</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get?'>get?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="marked_for_same_origin_verification?-instance_method">
  <h3 class='signature'>
  #<strong>marked_for_same_origin_verification?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>If the <code>verify_authenticity_token</code> before_action ran, verify
that JavaScript responses are only served to same-origin GET requests.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L252'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


252
253
254</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 252</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_marked_for_same_origin_verification?'>marked_for_same_origin_verification?</span>
  <span class='ivar'>@marked_for_same_origin_verification</span> <span class='op'>||=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="masked_authenticity_token-instance_method">
  <h3 class='signature'>
  #<strong>masked_authenticity_token</strong>(session, form_options: {})   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a masked version of the authenticity token that varies on each
request. The masking is used to mitigate SSL attacks like BREACH.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L293'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


293
294
295
296
297
298
299
300
301
302
303
304
305
306
307</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 293</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_masked_authenticity_token'>masked_authenticity_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='label'>form_options:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_form_options'>form_options</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raw_token'>raw_token</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_method'>method</span>
    <span class='id identifier rubyid_action_path'>action_path</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span><span class='lparen'>(</span><span class='id identifier rubyid_action'>action</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>=</span> <span class='const'><a href="../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span><span class='period'>.</span><span class='id identifier rubyid_random_bytes'>random_bytes</span><span class='lparen'>(</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span><span class='lparen'>(</span><span class='id identifier rubyid_one_time_pad'>one_time_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_token'>raw_token</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_masked_token'>masked_token</span> <span class='op'>=</span> <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>+</span> <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span>
  <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_encode64'>strict_encode64</span><span class='lparen'>(</span><span class='id identifier rubyid_masked_token'>masked_token</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="non_xhr_javascript_response?-instance_method">
  <h3 class='signature'>
  #<strong>non_xhr_javascript_response?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Check for cross-origin JavaScript responses.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L257'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


257
258
259</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 257</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_non_xhr_javascript_response?'>non_xhr_javascript_response?</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>%r(</span><span class='tstring_content'>\Atext/javascript</span><span class='regexp_end'>)</span></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_xhr?'>xhr?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="normalize_action_path-instance_method">
  <h3 class='signature'>
  #<strong>normalize_action_path</strong>(action_path)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L409'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


409
410
411
412</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 409</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span><span class='lparen'>(</span><span class='id identifier rubyid_action_path'>action_path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='const'><a href="../URI.html" title="URI (module)">URI</a></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_action_path'>action_path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_uri'>uri</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="per_form_csrf_token-instance_method">
  <h3 class='signature'>
  #<strong>per_form_csrf_token</strong>(session, action_path, method)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L374'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


374
375
376
377
378
379
380</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 374</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span>
    <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span>
    <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_action_path'>action_path</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="protect_against_forgery?-instance_method">
  <h3 class='signature'>
  #<strong>protect_against_forgery?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Checks if the controller allows forgery protection.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L394'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


394
395
396</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 394</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_protect_against_forgery?'>protect_against_forgery?</span>
  <span class='id identifier rubyid_allow_forgery_protection'>allow_forgery_protection</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="real_csrf_token-instance_method">
  <h3 class='signature'>
  #<strong>real_csrf_token</strong>(session)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L369'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


369
370
371
372</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 369</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_real_csrf_token'>real_csrf_token</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid__csrf_token'>_csrf_token</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'><a href="../SecureRandom.html" title="SecureRandom (module)">SecureRandom</a></span><span class='period'>.</span><span class='id identifier rubyid_base64'>base64</span><span class='lparen'>(</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='rparen'>)</span>
  <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_decode64'>strict_decode64</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid__csrf_token'>_csrf_token</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="request_authenticity_tokens-instance_method">
  <h3 class='signature'>
  #<strong>request_authenticity_tokens</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Possible authenticity tokens sent in the request.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L281'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


281
282
283</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 281</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_request_authenticity_tokens'>request_authenticity_tokens</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_form_authenticity_param'>form_authenticity_param</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_x_csrf_token'>x_csrf_token</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="unmask_token-instance_method">
  <h3 class='signature'>
  #<strong>unmask_token</strong>(masked_token)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L343'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


343
344
345
346
347
348
349</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 343</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unmask_token'>unmask_token</span><span class='lparen'>(</span><span class='id identifier rubyid_masked_token'>masked_token</span><span class='rparen'>)</span>
  <span class='comment'># Split the token into the one-time pad and the encrypted
</span>  <span class='comment'># value and decrypt it
</span>  <span class='id identifier rubyid_one_time_pad'>one_time_pad</span> <span class='op'>=</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>...</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='lbracket'>[</span><span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span><span class='lparen'>(</span><span class='id identifier rubyid_one_time_pad'>one_time_pad</span><span class='comma'>,</span> <span class='id identifier rubyid_encrypted_csrf_token'>encrypted_csrf_token</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="valid_authenticity_token?-instance_method">
  <h3 class='signature'>
  #<strong>valid_authenticity_token?</strong>(session, encoded_masked_token)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Checks the client&#39;s masked token to see if it matches the session
token. Essentially the inverse of <code>masked_authenticity_token</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L312'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 312</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_authenticity_token?'>valid_authenticity_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../String.html" title="String (class)">String</a></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_masked_token'>masked_token</span> <span class='op'>=</span> <span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_decode64'>strict_decode64</span><span class='lparen'>(</span><span class='id identifier rubyid_encoded_masked_token'>encoded_masked_token</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='comment'># encoded_masked_token is invalid Base64
</span>    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># See if it&#39;s actually a masked token or not. In order to
</span>  <span class='comment'># deploy this code, we should be able to handle any unmasked
</span>  <span class='comment'># tokens that we&#39;ve issued without error.
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span>
    <span class='comment'># This is actually an unmasked token. This is expected if
</span>    <span class='comment'># you have just upgraded to masked tokens, but should stop
</span>    <span class='comment'># happening shortly after installing this gem
</span>    <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span>

  <span class='kw'>elsif</span> <span class='id identifier rubyid_masked_token'>masked_token</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'><a href="#AUTHENTICITY_TOKEN_LENGTH-constant" title="ActionController::RequestForgeryProtection::AUTHENTICITY_TOKEN_LENGTH (constant)">AUTHENTICITY_TOKEN_LENGTH</a></span> <span class='op'>*</span> <span class='int'>2</span>
    <span class='id identifier rubyid_csrf_token'>csrf_token</span> <span class='op'>=</span> <span class='id identifier rubyid_unmask_token'>unmask_token</span><span class='lparen'>(</span><span class='id identifier rubyid_masked_token'>masked_token</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_compare_with_real_token'>compare_with_real_token</span><span class='lparen'>(</span><span class='id identifier rubyid_csrf_token'>csrf_token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span> <span class='op'>||</span>
      <span class='id identifier rubyid_valid_per_form_csrf_token?'>valid_per_form_csrf_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_csrf_token'>csrf_token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span> <span class='comment'># Token is malformed
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="valid_per_form_csrf_token?-instance_method">
  <h3 class='signature'>
  #<strong>valid_per_form_csrf_token?</strong>(token, session)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L355'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


355
356
357
358
359
360
361
362
363
364
365
366
367</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 355</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_per_form_csrf_token?'>valid_per_form_csrf_token?</span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_per_form_csrf_tokens'>per_form_csrf_tokens</span>
    <span class='id identifier rubyid_correct_token'>correct_token</span> <span class='op'>=</span> <span class='id identifier rubyid_per_form_csrf_token'>per_form_csrf_token</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_session'>session</span><span class='comma'>,</span>
      <span class='id identifier rubyid_normalize_action_path'>normalize_action_path</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fullpath'>fullpath</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_request_method'>request_method</span>
    <span class='rparen'>)</span>

    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/SecurityUtils.html" title="ActiveSupport::SecurityUtils (module)">SecurityUtils</a></span><span class='period'>.</span><span class='id identifier rubyid_secure_compare'><a href="../ActiveSupport/SecurityUtils.html#secure_compare-class_method" title="ActiveSupport::SecurityUtils.secure_compare (method)">secure_compare</a></span><span class='lparen'>(</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_correct_token'>correct_token</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="valid_request_origin?-instance_method">
  <h3 class='signature'>
  #<strong>valid_request_origin?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Checks if the request originated from the same origin by looking at the
Origin header.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L400'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


400
401
402
403
404
405
406
407</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 400</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_valid_request_origin?'>valid_request_origin?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_forgery_protection_origin_check'>forgery_protection_origin_check</span>
    <span class='comment'># We accept blank origin headers because some user agents don&#39;t send it.
</span>    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_origin'>origin</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_origin'>origin</span> <span class='op'>==</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_base_url'>base_url</span>
  <span class='kw'>else</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verified_request?-instance_method">
  <h3 class='signature'>
  #<strong>verified_request?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns true or false if a request is verified. Checks:</p>
<ul><li>
<p>Is it a GET or HEAD request?  Gets should be safe and idempotent</p>
</li><li>
<p>Does the form_authenticity_token match the given token value from the
params?</p>
</li><li>
<p>Does the X-CSRF-Token header match the form_authenticity_token</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L268'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


268
269
270
271</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 268</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verified_request?'>verified_request?</span>
  <span class='op'>!</span><span class='id identifier rubyid_protect_against_forgery?'>protect_against_forgery?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get?'>get?</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_head?'>head?</span> <span class='op'>||</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_valid_request_origin?'>valid_request_origin?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_any_authenticity_token_valid?'>any_authenticity_token_valid?</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify_authenticity_token-instance_method">
  <h3 class='signature'>
  #<strong>verify_authenticity_token</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The actual before_action that is used to verify the CSRF token. Don&#39;t
override this directly. Provide your own forgery protection strategy
instead. If you override, you&#39;ll disable same-origin
<code>&lt;script&gt;</code> verification.</p>

<p>Lean on the protect_from_forgery declaration to mark which actions are due
for same-origin request verification. If protect_from_forgery is enabled on
an action, this before_action flags its after_action to verify that
JavaScript responses are for XHR requests, ensuring they follow the
browser&#39;s same-origin policy.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L211'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


211
212
213
214
215
216
217
218
219
220</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_authenticity_token'>verify_authenticity_token</span>
  <span class='id identifier rubyid_mark_for_same_origin_verification!'>mark_for_same_origin_verification!</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_verified_request?'>verified_request?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t verify CSRF token authenticity.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_handle_unverified_request'>handle_unverified_request</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="verify_same_origin_request-instance_method">
  <h3 class='signature'>
  #<strong>verify_same_origin_request</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>If <code>verify_authenticity_token</code> was run (indicating that we have
forgery protection enabled for this request) then also verify that we
aren&#39;t serving an unauthorized cross-origin response.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L236'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


236
237
238
239
240
241
242
243</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 236</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_same_origin_request'>verify_same_origin_request</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_marked_for_same_origin_verification?'>marked_for_same_origin_verification?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_non_xhr_javascript_response?'>non_xhr_javascript_response?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_log_warning_on_csrf_failure'>log_warning_on_csrf_failure</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='const'><a href="#CROSS_ORIGIN_JAVASCRIPT_WARNING-constant" title="ActionController::RequestForgeryProtection::CROSS_ORIGIN_JAVASCRIPT_WARNING (constant)">CROSS_ORIGIN_JAVASCRIPT_WARNING</a></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="InvalidCrossOriginRequest.html" title="ActionController::InvalidCrossOriginRequest (class)">InvalidCrossOriginRequest</a></span><span class='comma'>,</span> <span class='const'><a href="#CROSS_ORIGIN_JAVASCRIPT_WARNING-constant" title="ActionController::RequestForgeryProtection::CROSS_ORIGIN_JAVASCRIPT_WARNING (constant)">CROSS_ORIGIN_JAVASCRIPT_WARNING</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="xor_byte_strings-instance_method">
  <h3 class='signature'>
  #<strong>xor_byte_strings</strong>(s1, s2)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L382'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


382
383
384
385
386</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 382</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_xor_byte_strings'>xor_byte_strings</span><span class='lparen'>(</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_s2'>s2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s2_bytes'>s2_bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_s2'>s2</span><span class='period'>.</span><span class='id identifier rubyid_bytes'>bytes</span>
  <span class='id identifier rubyid_s1'>s1</span><span class='period'>.</span><span class='id identifier rubyid_each_byte'>each_byte</span><span class='period'>.</span><span class='id identifier rubyid_with_index'>with_index</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c1'>c1</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_s2_bytes'>s2_bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>^=</span> <span class='id identifier rubyid_c1'>c1</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_s2_bytes'>s2_bytes</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>