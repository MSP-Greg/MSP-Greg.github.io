<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::HttpAuthentication::Digest &mdash; Rails-5.1.0</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActionController::HttpAuthentication::Digest",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Rails-5.1.0</a> &raquo; 
          <a href='../../_index.html'>Index (D)</a> &raquo; 
          <a href="../../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
          <a href="../HttpAuthentication.html" title="ActionController::HttpAuthentication (module)">HttpAuthentication</a> &raquo; 
          <span class='title'>Digest</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActionController::HttpAuthentication::Digest</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <div class='box_max'>
        <a href="Digest/ControllerMethods.html" title="ActionController::HttpAuthentication::Digest::ControllerMethods (module)">ControllerMethods</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Extended by:</td>
    <td>
      <div class='box_max'>
        <a href="" title="ActionController::HttpAuthentication::Digest (module)">Digest</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Included in:</td>
    <td>
      <div class='box_max'>
        <a href="" title="ActionController::HttpAuthentication::Digest (module)">Digest</a>
      </div>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L175'>actionpack/lib/action_controller/metal/http_authentication.rb</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Makes it dead easy to do HTTP Digest authentication.</p>

<h4 id="label-Simple+Digest+example">Simple Digest example</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>digest/md5</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>class</span> <span class='const'>PostsController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='const'>REALM</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SuperSecret</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>USERS</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dhh</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='comment'>#plain text password
</span>           <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dap</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dap</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='const'>REALM</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span>  <span class='comment'>#ha1 digest password
</span>
  <span class='id identifier rubyid_before_action'>before_action</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authenticate'>authenticate</span><span class='comma'>,</span> <span class='label'>except:</span> <span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Everyone can see me!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I&#39;m only accessible if you know the password</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_authenticate'>authenticate</span>
      <span class='id identifier rubyid_authenticate_or_request_with_http_digest'>authenticate_or_request_with_http_digest</span><span class='lparen'>(</span><span class='const'>REALM</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_username'>username</span><span class='op'>|</span>
        <span class='const'>USERS</span><span class='lbracket'>[</span><span class='id identifier rubyid_username'>username</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h4 id="label-Notes">Notes</h4>

<p>The <code>authenticate_or_request_with_http_digest</code> block must return
the user&#39;s password or the ha1 digest hash so the framework can
appropriately hash to check the user&#39;s credentials. Returning
<code>nil</code> will cause authentication to fail.</p>

<p>Storing the ha1 hash: MD5(username:realm:password), is better than storing
a plain password. If the password file or database is compromised, the
attacker would be able to use the ha1 hash to authenticate as the user at
this <code>realm</code>, but would not have the user&#39;s password to try
using at other sites.</p>

<p>In rare instances, web servers or front proxies strip authorization headers
before they reach your application. You can debug this situation by logging
all environment variables, and check for HTTP_AUTHORIZATION, amongst
others.</p>


  </div>
</div>
<div class="tags">
  
</div>




<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#authenticate-instance_method" title="#authenticate (instance method)">#<strong>authenticate</strong>(request, realm, &amp;password_procedure)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns false on a valid response, true otherwise</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#authentication_header-instance_method" title="#authentication_header (instance method)">#<strong>authentication_header</strong>(controller, realm)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#authentication_request-instance_method" title="#authentication_request (instance method)">#<strong>authentication_request</strong>(controller, realm, message = nil)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#decode_credentials-instance_method" title="#decode_credentials (instance method)">#<strong>decode_credentials</strong>(header)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#decode_credentials_header-instance_method" title="#decode_credentials_header (instance method)">#<strong>decode_credentials_header</strong>(request)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#encode_credentials-instance_method" title="#encode_credentials (instance method)">#<strong>encode_credentials</strong>(http_method, credentials, password, password_is_ha1)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#expected_response-instance_method" title="#expected_response (instance method)">#<strong>expected_response</strong>(http_method, uri, credentials, password, password_is_ha1 = true)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns the expected response for a request of <code>http_method</code> to
<code>uri</code> with the decoded <code>credentials</code> and the expected
<code>password</code> Optional parameter <code>password_is_ha1</code> is
set to <code>true</code> by default, since best practice is to store ha1
digest instead of a plain-text password.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#ha1-instance_method" title="#ha1 (instance method)">#<strong>ha1</strong>(credentials, password)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#nonce-instance_method" title="#nonce (instance method)">#<strong>nonce</strong>(secret_key, time = Time.now)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Uses an MD5 digest based on time to generate a value to be used only once.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#opaque-instance_method" title="#opaque (instance method)">#<strong>opaque</strong>(secret_key)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Opaque based on digest of secret key</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#secret_token-instance_method" title="#secret_token (instance method)">#<strong>secret_token</strong>(request)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#validate_digest_response-instance_method" title="#validate_digest_response (instance method)">#<strong>validate_digest_response</strong>(request, realm, &amp;password_procedure)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns false unless the request credentials response value matches the
expected value.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#validate_nonce-instance_method" title="#validate_nonce (instance method)">#<strong>validate_nonce</strong>(secret_key, request, value, seconds_to_timeout = 5*60)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Might want a shorter timeout depending on whether the request is a PATCH,
PUT, or POST, and if the client is a browser or web service.</p>
</div>
      </span>
    </li>
  </ul>


<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="authenticate-instance_method">
  <h3 class='signature first'>
  #<strong>authenticate</strong>(request, realm, &amp;password_procedure)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns false on a valid response, true otherwise</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L195'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


195
196
197</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 195</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_authenticate'>authenticate</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_realm'>realm</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_password_procedure'>password_procedure</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_authorization'>authorization</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_validate_digest_response'>validate_digest_response</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_realm'>realm</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_password_procedure'>password_procedure</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="authentication_header-instance_method">
  <h3 class='signature'>
  #<strong>authentication_header</strong>(controller, realm)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L253'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


253
254
255
256
257
258</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 253</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_authentication_header'>authentication_header</span><span class='lparen'>(</span><span class='id identifier rubyid_controller'>controller</span><span class='comma'>,</span> <span class='id identifier rubyid_realm'>realm</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_secret_key'>secret_key</span> <span class='op'>=</span> <span class='id identifier rubyid_secret_token'>secret_token</span><span class='lparen'>(</span><span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_nonce'>nonce</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_nonce'>nonce</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opaque'>opaque</span> <span class='op'>=</span> <span class='id identifier rubyid_opaque'>opaque</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WWW-Authenticate</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'>Digest realm=&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_realm'>realm</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;, qop=&quot;auth&quot;, algorithm=MD5, nonce=&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nonce'>nonce</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;, opaque=&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opaque'>opaque</span><span class='embexpr_end'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>)</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="authentication_request-instance_method">
  <h3 class='signature'>
  #<strong>authentication_request</strong>(controller, realm, message = nil)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L260'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


260
261
262
263
264
265</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_authentication_request'>authentication_request</span><span class='lparen'>(</span><span class='id identifier rubyid_controller'>controller</span><span class='comma'>,</span> <span class='id identifier rubyid_realm'>realm</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP Digest: Access denied.\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_authentication_header'>authentication_header</span><span class='lparen'>(</span><span class='id identifier rubyid_controller'>controller</span><span class='comma'>,</span> <span class='id identifier rubyid_realm'>realm</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='int'>401</span>
  <span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_response_body'>response_body</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="decode_credentials-instance_method">
  <h3 class='signature'>
  #<strong>decode_credentials</strong>(header)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L246'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


246
247
248
249
250
251</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 246</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decode_credentials'>decode_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_header'>header</span><span class='rparen'>)</span>
  <span class='const'><a href="../../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../../ActiveSupport/HashWithIndifferentAccess.html" title="ActiveSupport::HashWithIndifferentAccess (class)">HashWithIndifferentAccess</a></span><span class='lbracket'>[</span><span class='id identifier rubyid_header'>header</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^Digest\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pair'>pair</span><span class='op'>|</span>
    <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_pair'>pair</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&quot;|&quot;$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>end</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="decode_credentials_header-instance_method">
  <h3 class='signature'>
  #<strong>decode_credentials_header</strong>(request)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L242'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


242
243
244</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 242</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_decode_credentials_header'>decode_credentials_header</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_decode_credentials'>decode_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_authorization'>authorization</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="encode_credentials-instance_method">
  <h3 class='signature'>
  #<strong>encode_credentials</strong>(http_method, credentials, password, password_is_ha1)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L237'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


237
238
239
240</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 237</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_credentials'>encode_credentials</span><span class='lparen'>(</span><span class='id identifier rubyid_http_method'>http_method</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_password_is_ha1'>password_is_ha1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_response'>response</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_expected_response'>expected_response</span><span class='lparen'>(</span><span class='id identifier rubyid_http_method'>http_method</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_uri'>uri</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_password_is_ha1'>password_is_ha1</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Digest </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>=&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="expected_response-instance_method">
  <h3 class='signature'>
  #<strong>expected_response</strong>(http_method, uri, credentials, password, password_is_ha1 = true)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns the expected response for a request of <code>http_method</code> to
<code>uri</code> with the decoded <code>credentials</code> and the expected
<code>password</code> Optional parameter <code>password_is_ha1</code> is
set to <code>true</code> by default, since best practice is to store ha1
digest instead of a plain-text password.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L227'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


227
228
229
230
231</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 227</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expected_response'>expected_response</span><span class='lparen'>(</span><span class='id identifier rubyid_http_method'>http_method</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_password_is_ha1'>password_is_ha1</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ha1'>ha1</span> <span class='op'>=</span> <span class='id identifier rubyid_password_is_ha1'>password_is_ha1</span> <span class='op'>?</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>:</span> <span class='id identifier rubyid_ha1'>ha1</span><span class='lparen'>(</span><span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ha2'>ha2</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><a href="../../Digest.html" title="Digest (module)">Digest</a></span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_http_method'>http_method</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='comma'>,</span> <span class='id identifier rubyid_uri'>uri</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'><a href="../../Digest.html" title="Digest (module)">Digest</a></span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_ha1'>ha1</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_nonce'>nonce</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_nc'>nc</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_cnonce'>cnonce</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_qop'>qop</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_ha2'>ha2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="ha1-instance_method">
  <h3 class='signature'>
  #<strong>ha1</strong>(credentials, password)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L233'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


233
234
235</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 233</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ha1'>ha1</span><span class='lparen'>(</span><span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'><a href="../../Digest.html" title="Digest (module)">Digest</a></span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_username'>username</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_realm'>realm</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="nonce-instance_method">
  <h3 class='signature'>
  #<strong>nonce</strong>(secret_key, time = Time.now)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Uses an MD5 digest based on time to generate a value to be used only once.</p>

<p>A server-specified data string which should be uniquely generated each time
a 401 response is made. It is recommended that this string be base64 or
hexadecimal data. Specifically, since the string is passed in the header
lines as a quoted string, the double-quote character is not allowed.</p>

<p>The contents of the nonce are implementation dependent. The quality of the
implementation depends on a good choice. A nonce might, for example, be
constructed as the base 64 encoding of</p>

<pre class="code ruby"><code class="ruby">time-stamp H(time-stamp &quot;:&quot; ETag &quot;:&quot; private-key)</code></pre>

<p>where time-stamp is a server-generated time or other non-repeating value,
ETag is the value of the HTTP ETag header associated with the requested
entity, and private-key is data known only to the server. With a nonce of
this form a server would recalculate the hash portion after receiving the
client authentication header and reject the request if it did not match the
nonce from that header or if the time-stamp value is not recent enough. In
this way the server can limit the time of the nonce&#39;s validity. The
inclusion of the ETag prevents a replay request for an updated version of
the resource. (Note: including the IP address of the client in the nonce
would appear to offer the server the ability to limit the reuse of the
nonce to the same client that originally got it. However, that would break
proxy farms, where requests from a single user often go through different
proxies in the farm. Also, IP address spoofing is not that hard.)</p>

<p>An implementation might choose not to accept a previously used nonce or a
previously used digest, in order to protect against a replay attack. Or, an
implementation might choose to use one-time nonces or digests for POST,
PUT, or PATCH requests and a time-stamp for GET requests. For more details
on the issues involved see Section 4 of this document.</p>

<p>The nonce is opaque to the client. Composed of Time, and hash of Time with
secret key from the Rails session secret generated upon creation of
project. Ensures the time cannot be modified by client.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L305'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


305
306
307
308
309
310</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 305</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_nonce'>nonce</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='comma'>,</span> <span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="../../Time.html" title="Time (class)">Time</a></span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_time'>time</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_hashed'>hashed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_secret_key'>secret_key</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_digest'>digest</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><a href="../../Digest.html" title="Digest (module)">Digest</a></span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_hashed'>hashed</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_strict_encode64'>strict_encode64</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_digest'>digest</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="opaque-instance_method">
  <h3 class='signature'>
  #<strong>opaque</strong>(secret_key)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Opaque based on digest of secret key</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L324'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


324
325
326</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 324</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opaque'>opaque</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'><a href="../../Digest.html" title="Digest (module)">Digest</a></span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="secret_token-instance_method">
  <h3 class='signature'>
  #<strong>secret_token</strong>(request)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L267'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


267
268
269
270
271</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 267</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_secret_token'>secret_token</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key_generator'>key_generator</span>  <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_key_generator'>key_generator</span>
  <span class='id identifier rubyid_http_auth_salt'>http_auth_salt</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_http_auth_salt'>http_auth_salt</span>
  <span class='id identifier rubyid_key_generator'>key_generator</span><span class='period'>.</span><span class='id identifier rubyid_generate_key'>generate_key</span><span class='lparen'>(</span><span class='id identifier rubyid_http_auth_salt'>http_auth_salt</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="validate_digest_response-instance_method">
  <h3 class='signature'>
  #<strong>validate_digest_response</strong>(request, realm, &amp;password_procedure)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns false unless the request credentials response value matches the
expected value. First try the password as a ha1 digest password. If this
fails, then try it as a plain text password.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L202'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 202</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_digest_response'>validate_digest_response</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_realm'>realm</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_password_procedure'>password_procedure</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_secret_key'>secret_key</span>  <span class='op'>=</span> <span class='id identifier rubyid_secret_token'>secret_token</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>=</span> <span class='id identifier rubyid_decode_credentials_header'>decode_credentials_header</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_valid_nonce'>valid_nonce</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_nonce'>validate_nonce</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_nonce'>nonce</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_valid_nonce'>valid_nonce</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_realm'>realm</span> <span class='op'>==</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_realm'>realm</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opaque'>opaque</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_opaque'>opaque</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_password'>password</span> <span class='op'>=</span> <span class='id identifier rubyid_password_procedure'>password_procedure</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_username'>username</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_password'>password</span>

    <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get_header'>get_header</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.methodoverride.original_method</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get_header'>get_header</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>REQUEST_METHOD</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_uri'>uri</span>    <span class='op'>=</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_uri'>uri</span><span class='rbracket'>]</span>

    <span class='lbracket'>[</span><span class='kw'>true</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_trailing_question_mark'>trailing_question_mark</span><span class='op'>|</span>
      <span class='lbracket'>[</span><span class='kw'>true</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_password_is_ha1'>password_is_ha1</span><span class='op'>|</span>
        <span class='id identifier rubyid__uri'>_uri</span> <span class='op'>=</span> <span class='id identifier rubyid_trailing_question_mark'>trailing_question_mark</span> <span class='op'>?</span> <span class='id identifier rubyid_uri'>uri</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_uri'>uri</span>
        <span class='id identifier rubyid_expected'>expected</span> <span class='op'>=</span> <span class='id identifier rubyid_expected_response'>expected_response</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='id identifier rubyid__uri'>_uri</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_password_is_ha1'>password_is_ha1</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_expected'>expected</span> <span class='op'>==</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_response'>response</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="validate_nonce-instance_method">
  <h3 class='signature'>
  #<strong>validate_nonce</strong>(secret_key, request, value, seconds_to_timeout = 5*60)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Might want a shorter timeout depending on whether the request is a PATCH,
PUT, or POST, and if the client is a browser or web service. Can be much
shorter if the Stale directive is implemented. This would allow a user to
use new nonce without prompting the user again for their username and
password.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/http_authentication.rb#L317'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


317
318
319
320
321</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 317</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_nonce'>validate_nonce</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_seconds_to_timeout'>seconds_to_timeout</span><span class='op'>=</span><span class='int'>5</span><span class='op'>*</span><span class='int'>60</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Base64</span><span class='period'>.</span><span class='id identifier rubyid_decode64'>decode64</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_nonce'>nonce</span><span class='lparen'>(</span><span class='id identifier rubyid_secret_key'>secret_key</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_t'>t</span> <span class='op'>-</span> <span class='const'><a href="../../Time.html" title="Time (class)">Time</a></span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_seconds_to_timeout'>seconds_to_timeout</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>