<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Callbacks &mdash; Rails-5.1.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Callbacks",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.1.0</a> &raquo; 
          <a href='../_index.html'>Index (C)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>Callbacks</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActiveRecord::Callbacks</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <div class='box_max'>
        <a href="Callbacks/ClassMethods.html" title="ActiveRecord::Callbacks::ClassMethods (module)">ClassMethods</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Extended by:</td>
    <td>
      <div class='box_max'>
        <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Included in:</td>
    <td>
      <div class='box_max'>
        <a href="Base.html" title="ActiveRecord::Base (class)">Base</a>
      </div>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/callbacks.rb#L258'>activerecord/lib/active_record/callbacks.rb</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h2 id="label-Active+Record+Callbacks">Active Record Callbacks</h2>

<p>Callbacks are hooks into the life cycle of an Active Record object that
allow you to trigger logic before or after an alteration of the object
state. This can be used to make sure that associated and dependent objects
are deleted when Base#destroy[Persistence#destroy] is
called (by overwriting <code>before_destroy</code>) or to massage
attributes before they&#39;re validated (by overwriting
<code>before_validation</code>). As an example of the callbacks initiated,
consider the Base#save[Persistence#save] call for a new
record:</p>
<ul><li>
<p>(-) <code>save</code></p>
</li><li>
<p>(-) <code>valid</code></p>
</li><li>
<p>(1) <code>before_validation</code></p>
</li><li>
<p>(-) <code>validate</code></p>
</li><li>
<p>(2) <code>after_validation</code></p>
</li><li>
<p>(3) <code>before_save</code></p>
</li><li>
<p>(4) <code>before_create</code></p>
</li><li>
<p>(-) <code>create</code></p>
</li><li>
<p>(5) <code>after_create</code></p>
</li><li>
<p>(6) <code>after_save</code></p>
</li><li>
<p>(7) <code>after_commit</code></p>
</li></ul>

<p>Also, an <code>after_rollback</code> callback can be configured to be
triggered whenever a rollback is issued. Check out
<a href="Transactions.html" title="ActiveRecord::Transactions (module)">Transactions</a> for more details about
<code>after_commit</code> and <code>after_rollback</code>.</p>

<p>Additionally, an <code>after_touch</code> callback is triggered whenever an
object is touched.</p>

<p>Lastly an <code>after_find</code> and <code>after_initialize</code>
callback is triggered for each object that is found and instantiated by a
finder, with <code>after_initialize</code> being triggered after new
objects are instantiated as well.</p>

<p>There are nineteen callbacks in total, which give you immense power to
react and prepare for each state in the Active Record life cycle. The
sequence for calling Base#save[Persistence#save] for an
existing record is similar, except that each <code>_create</code> callback
is replaced by the corresponding <code>_update</code> callback.</p>

<p>Examples:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CreditCard</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='comment'># Strip everything but digits, so the user can specify &quot;555 234 34&quot; or
</span>  <span class='comment'># &quot;5552-3434&quot; and both will mean &quot;55523434&quot;
</span>  <span class='id identifier rubyid_before_validation'>before_validation</span><span class='lparen'>(</span><span class='label'>on:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^0-9]</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_attribute_present?'>attribute_present?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Subscription</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_before_create'>before_create</span> <span class='symbeg'>:</span><span class='id identifier rubyid_record_signup'>record_signup</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_record_signup'>record_signup</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_signed_up_on'>signed_up_on</span> <span class='op'>=</span> <span class='const'><a href="../Date.html" title="Date (class)">Date</a></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span>
    <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Firm</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='comment'># Disables access to the system, for associated clients and people when the firm is destroyed
</span>  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='const'>Person</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>firm_id:</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update_all'>update_all</span><span class='lparen'>(</span><span class='label'>access:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>disabled</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>   <span class='rbrace'>}</span>
  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>client_of:</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update_all'>update_all</span><span class='lparen'>(</span><span class='label'>access:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>disabled</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="label-Inheritable+callback+queues">Inheritable callback queues</h3>

<p>Besides the overwritable callback methods, it&#39;s also possible to
register callbacks through the use of the callback macros. Their main
advantage is that the macros add behavior into a callback queue that is
kept intact down through an inheritance hierarchy.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Topic</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy_author'>destroy_author</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Reply</span> <span class='op'>&lt;</span> <span class='const'>Topic</span>
  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy_readers'>destroy_readers</span>
<span class='kw'>end</span>
</code></pre>

<p>Now, when <code>Topic#destroy</code> is run only
<code>destroy_author</code> is called. When <code>Reply#destroy</code> is
run, both <code>destroy_author</code> and <code>destroy_readers</code> are
called. Contrast this to the following situation where the
<code>before_destroy</code> method is overridden:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Topic</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_before_destroy'>before_destroy</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='id identifier rubyid_destroy_author'>destroy_author</span> <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Reply</span> <span class='op'>&lt;</span> <span class='const'>Topic</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_before_destroy'>before_destroy</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='id identifier rubyid_destroy_readers'>destroy_readers</span> <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>In that case, <code>Reply#destroy</code> would only run
<code>destroy_readers</code> and <em>not</em> <code>destroy_author</code>.
So, use the callback macros when you want to ensure that a certain callback
is called for the entire hierarchy, and use the regular overwritable
methods when you want to leave it up to each descendant to decide whether
they want to call <code>super</code> and trigger the inherited callbacks.</p>

<p><strong>IMPORTANT:</strong> In order for inheritance to work for the
callback queues, you must specify the callbacks before specifying the
associations. Otherwise, you might trigger the loading of a child before
the parent has registered the callbacks and they won&#39;t be inherited.</p>

<h3 id="label-Types+of+callbacks">Types of callbacks</h3>

<p>There are four types of callbacks accepted by the callback macros: Method
references (symbol), callback objects, inline methods (using a proc), and
inline eval methods (using a string). Method references and callback
objects are the recommended approaches, inline methods using a proc are
sometimes appropriate (such as for creating mix-ins), and inline eval
methods are deprecated.</p>

<p>The method reference callbacks work by specifying a protected or private
method available in the object, like this:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Topic</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='symbeg'>:</span><span class='id identifier rubyid_delete_parents'>delete_parents</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_delete_parents'>delete_parents</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_delete_all'>delete_all</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>parent_id = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>The callback objects have methods named after the callback called with the
record as the only parameter, such as:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>BankAccount</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_before_save'>before_save</span>      <span class='const'>EncryptionWrapper</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_after_save'>after_save</span>       <span class='const'>EncryptionWrapper</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_after_initialize'>after_initialize</span> <span class='const'>EncryptionWrapper</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>EncryptionWrapper</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_before_save'>before_save</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_credit_card_number'>credit_card_number</span> <span class='op'>=</span> <span class='id identifier rubyid_encrypt'>encrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_credit_card_number'>credit_card_number</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_after_save'>after_save</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_credit_card_number'>credit_card_number</span> <span class='op'>=</span> <span class='id identifier rubyid_decrypt'>decrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_credit_card_number'>credit_card_number</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_initialize'>after_initialize</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_save'>after_save</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_encrypt'>encrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='comment'># Secrecy is committed
</span>    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_decrypt'>decrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='comment'># Secrecy is unveiled
</span>    <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>So you specify the object you want messaged on a given callback. When that
callback is triggered, the object has a method by the name of the callback
messaged. You can make these callbacks more flexible by passing in other
initialization data such as the name of the attribute to work with:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>BankAccount</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_before_save'>before_save</span>      <span class='const'>EncryptionWrapper</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>credit_card_number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_after_save'>after_save</span>       <span class='const'>EncryptionWrapper</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>credit_card_number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_after_initialize'>after_initialize</span> <span class='const'>EncryptionWrapper</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>credit_card_number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>EncryptionWrapper</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='rparen'>)</span>
    <span class='ivar'>@attribute</span> <span class='op'>=</span> <span class='id identifier rubyid_attribute'>attribute</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_before_save'>before_save</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@attribute</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_encrypt'>encrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@attribute</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_after_save'>after_save</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@attribute</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_decrypt'>decrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@attribute</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_initialize'>after_initialize</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_save'>after_save</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_encrypt'>encrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='comment'># Secrecy is committed
</span>    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_decrypt'>decrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='comment'># Secrecy is unveiled
</span>    <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="label-before_validation-2A+returning+statements"><code>before_validation*</code> returning statements</h3>

<p>If the <code>before_validation</code> callback throws <code>:abort</code>,
the process will be aborted and Base#save[Persistence#save]
will return <code>false</code>. If
Base#save![Persistence#save!] is called it will raise an
<a href="RecordInvalid.html" title="ActiveRecord::RecordInvalid (class)">RecordInvalid</a> exception. Nothing will be appended to the
errors object.</p>

<h3 id="label-Canceling+callbacks">Canceling callbacks</h3>

<p>If a <code>before_*</code> callback throws <code>:abort</code>, all the
later callbacks and the associated action are cancelled. Callbacks are
generally run in the order they are defined, with the exception of
callbacks defined as methods on the model, which are called last.</p>

<h3 id="label-Ordering+callbacks">Ordering callbacks</h3>

<p>Sometimes the code needs that the callbacks execute in a specific order.
For example, a <code>before_destroy</code> callback
(<code>log_children</code> in this case) should be executed before the
children get destroyed by the <code>dependent: :destroy</code> option.</p>

<p>Let&#39;s look at the code below:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Topic</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_children'>children</span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>

  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='symbeg'>:</span><span class='id identifier rubyid_log_children'>log_children</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_log_children'>log_children</span>
      <span class='comment'># Child processing
</span>    <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>In this case, the problem is that when the <code>before_destroy</code>
callback is executed, the children are not available because the
Base#destroy[Persistence#destroy] callback gets executed
first. You can use the <code>prepend</code> option on the
<code>before_destroy</code> callback to avoid this.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Topic</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_children'>children</span><span class='comma'>,</span> <span class='label'>dependent:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>

  <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='symbeg'>:</span><span class='id identifier rubyid_log_children'>log_children</span><span class='comma'>,</span> <span class='label'>prepend:</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_log_children'>log_children</span>
      <span class='comment'># Child processing
</span>    <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>This way, the <code>before_destroy</code> gets executed before the
<code>dependent: :destroy</code> is called, and the data is still
available.</p>

<h3 id="label-Transactions">Transactions</h3>

<p>The entire callback chain of a <code>#save</code>[Persistence#save],
<code>#save!</code>[Persistence#save!], or <a href="#destroy-instance_method" title="ActiveRecord::Callbacks#destroy (method)">#destroy</a>[Persistence#destroy] call runs
within a transaction. That includes <code>after_*</code> hooks. If
everything goes fine a COMMIT is executed once the chain has been
completed.</p>

<p>If a <code>before_*</code> callback cancels the action a ROLLBACK is
issued. You can also trigger a ROLLBACK raising an exception in any of the
callbacks, including <code>after_*</code> hooks. Note, however, that in
that case the client needs to be aware of it because an ordinary
<code>#save</code>[Persistence#save] will raise such exception instead of quietly
returning <code>false</code>.</p>

<h3 id="label-Debugging+callbacks">Debugging callbacks</h3>

<p>The callback chain is accessible via the <code>_*_callbacks</code> method
on an object. Active Model Callbacks support <code>:before</code>,
<code>:after</code> and <code>:around</code> as values for the
<code>kind</code> property. The <code>kind</code> property defines what
part of the chain the callback runs in.</p>

<p>To find all callbacks in the before_save callback chain:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span><span class='period'>.</span><span class='id identifier rubyid__save_callbacks'>_save_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cb'>cb</span><span class='op'>|</span> <span class='id identifier rubyid_cb'>cb</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span><span class='period'>.</span><span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_before'>before</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
</code></pre>

<p>Returns an array of callback objects that form the before_save chain.</p>

<p>To further check if the before_save chain contains a proc defined as
<code>rest_when_dead</code> use the <code>filter</code> property of the
callback object:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Topic</span><span class='period'>.</span><span class='id identifier rubyid__save_callbacks'>_save_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cb'>cb</span><span class='op'>|</span> <span class='id identifier rubyid_cb'>cb</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span><span class='period'>.</span><span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_before'>before</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_filter'>filter</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_rest_when_dead'>rest_when_dead</span><span class='rparen'>)</span>
</code></pre>

<p>Returns true or false depending on whether the proc is contained in the
before_save callback chain on a Topic model.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='CALLBACKS-constant'>
      CALLBACKS =
    </dt>
    <dd>
            <pre class='code ruby'><span class='lbracket'>[</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_after_initialize'>after_initialize</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_find'>after_find</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_touch'>after_touch</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_validation'>before_validation</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_validation'>after_validation</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_before_save'>before_save</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_around_save'>around_save</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_save'>after_save</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_create'>before_create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_around_create'>around_create</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_after_create'>after_create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before_update'>before_update</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_around_update'>around_update</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_update'>after_update</span><span class='comma'>,</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_before_destroy'>before_destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_around_destroy'>around_destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_destroy'>after_destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_commit'>after_commit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_rollback'>after_rollback</span>
<span class='rbracket'>]</span></pre>
    </dd>
  </dl>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#_create_record-instance_method" title="#_create_record (instance method)">#<strong>_create_record</strong>  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#_update_record-instance_method" title="#_update_record (instance method)">#<strong>_update_record</strong>  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#create_or_update-instance_method" title="#create_or_update (instance method)">#<strong>create_or_update</strong>  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#touch-instance_method" title="#touch (instance method)">#<strong>touch</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>, <a href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>, <a href="../ActiveSupport/Concern.html#extended-class_method" title="ActiveSupport::Concern.extended (method)">.extended</a>, <a href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></p>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="_create_record-instance_method">
  <h3 class='signature first'>
  #<strong>_create_record</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/callbacks.rb#L301'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


301
302
303</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/callbacks.rb', line 301</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__create_record'>_create_record</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid__run_create_callbacks'>_run_create_callbacks</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="_update_record-instance_method">
  <h3 class='signature'>
  #<strong>_update_record</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/callbacks.rb#L305'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


305
306
307</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/callbacks.rb', line 305</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__update_record'>_update_record</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid__run_update_callbacks'>_run_update_callbacks</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="create_or_update-instance_method">
  <h3 class='signature'>
  #<strong>create_or_update</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/callbacks.rb#L297'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


297
298
299</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/callbacks.rb', line 297</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_or_update'>create_or_update</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid__run_save_callbacks'>_run_save_callbacks</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="destroy-instance_method">
  <h3 class='signature'>
  #<strong>destroy</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/callbacks.rb#L279'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


279
280
281
282
283
284
285
286
287
288
289</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/callbacks.rb', line 279</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@_destroy_callback_already_called</span> <span class='op'>||=</span> <span class='kw'>false</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@_destroy_callback_already_called</span>
  <span class='ivar'>@_destroy_callback_already_called</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid__run_destroy_callbacks'>_run_destroy_callbacks</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>rescue</span> <span class='const'><a href="RecordNotDestroyed.html" title="ActiveRecord::RecordNotDestroyed (class)">RecordNotDestroyed</a></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='ivar'>@_association_destroy_exception</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>false</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@_destroy_callback_already_called</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="touch-instance_method">
  <h3 class='signature'>
  #<strong>touch</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/callbacks.rb#L291'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


291
292
293</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/callbacks.rb', line 291</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid__run_touch_callbacks'>_run_touch_callbacks</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>