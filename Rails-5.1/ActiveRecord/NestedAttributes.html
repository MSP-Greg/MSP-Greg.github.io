<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::NestedAttributes &mdash; Rails-5.1.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::NestedAttributes",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.1.0</a> &raquo; 
          <a href='../_index.html'>Index (N)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>NestedAttributes</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActiveRecord::NestedAttributes</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <div class='box_max'>
        <a href="NestedAttributes/ClassMethods.html" title="ActiveRecord::NestedAttributes::ClassMethods (module)">ClassMethods</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Child Exceptions:</td>
    <td>
      <div class='box_max'>
        <a href="NestedAttributes/TooManyRecords.html" title="ActiveRecord::NestedAttributes::TooManyRecords (class)">TooManyRecords</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Extended by:</td>
    <td>
      <div class='box_max'>
        <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Included in:</td>
    <td>
      <div class='box_max'>
        <a href="Base.html" title="ActiveRecord::Base (class)">Base</a>
      </div>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L6'>activerecord/lib/active_record/nested_attributes.rb</a></div>  </td>
  </tr>
</table>

<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='UNASSIGNABLE_KEYS-constant'>
      UNASSIGNABLE_KEYS =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Attribute hash keys that should not be assigned as normal attributes. These
hash keys are nested attributes implementation details.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code ruby'><span class='qwords'><span class='qwords_beg'>%w( </span><span class='tstring_content'>id</span><span class='words_sep'> </span></span><span class='tstring_content'>_destroy</span><span class='words_sep'> )</span></pre>
    </dd>
  </dl>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#_destroy-instance_method" title="#_destroy (instance method)">#<strong>_destroy</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Returns <a href="AutosaveAssociation.html" title="ActiveRecord::AutosaveAssociation (module)">AutosaveAssociation</a>::marked_for_destruction?
It&#39;s used in conjunction with fields_for to build a form element for
the destruction of this association.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#allow_destroy%3F-instance_method" title="#allow_destroy? (instance method)">#<strong>allow_destroy?</strong>(association_name)  &#x21d2; Boolean </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#assign_nested_attributes_for_collection_association-instance_method" title="#assign_nested_attributes_for_collection_association (instance method)">#<strong>assign_nested_attributes_for_collection_association</strong>(association_name, attributes_collection)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Assigns the given attributes to the collection association.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#assign_nested_attributes_for_one_to_one_association-instance_method" title="#assign_nested_attributes_for_one_to_one_association (instance method)">#<strong>assign_nested_attributes_for_one_to_one_association</strong>(association_name, attributes)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Assigns the given attributes to the association.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#assign_to_or_mark_for_destruction-instance_method" title="#assign_to_or_mark_for_destruction (instance method)">#<strong>assign_to_or_mark_for_destruction</strong>(record, attributes, allow_destroy)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Updates a record with the <code>attributes</code> or marks it for
destruction if <code>allow_destroy</code> is <code>true</code> and
has_destroy_flag? returns <code>true</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#call_reject_if-instance_method" title="#call_reject_if (instance method)">#<strong>call_reject_if</strong>(association_name, attributes)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Determines if a record with the particular <code>attributes</code> should
be rejected by calling the reject_if Symbol or Proc (if defined).</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#check_record_limit%21-instance_method" title="#check_record_limit! (instance method)">#<strong>check_record_limit!</strong>(limit, attributes_collection)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Takes in a limit and checks if the attributes_collection has too many
records.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#has_destroy_flag%3F-instance_method" title="#has_destroy_flag? (instance method)">#<strong>has_destroy_flag?</strong>(hash)  &#x21d2; Boolean </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Determines if a hash contains a truthy _destroy key.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#raise_nested_attributes_record_not_found%21-instance_method" title="#raise_nested_attributes_record_not_found! (instance method)">#<strong>raise_nested_attributes_record_not_found!</strong>(association_name, record_id)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reject_new_record%3F-instance_method" title="#reject_new_record? (instance method)">#<strong>reject_new_record?</strong>(association_name, attributes)  &#x21d2; Boolean </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Determines if a new record should be rejected by checking has_destroy_flag?
or if a <code>:reject_if</code> proc exists for this association and
evaluates to <code>true</code>.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#will_be_destroyed%3F-instance_method" title="#will_be_destroyed? (instance method)">#<strong>will_be_destroyed?</strong>(association_name, attributes)  &#x21d2; Boolean </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Only take into account the destroy flag if <code>:allow_destroy</code> is
true</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>, <a href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>, <a href="../ActiveSupport/Concern.html#extended-class_method" title="ActiveSupport::Concern.extended (method)">.extended</a>, <a href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></p>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="_destroy-instance_method">
  <h3 class='signature first'>
  #<strong>_destroy</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns <a href="AutosaveAssociation.html" title="ActiveRecord::AutosaveAssociation (module)">AutosaveAssociation</a>::marked_for_destruction?
It&#39;s used in conjunction with fields_for to build a form element for
the destruction of this association.</p>

<p>See <a href="../ActionView/Helpers/FormHelper.html" title="ActionView::Helpers::FormHelper (module)">ActionView::Helpers::FormHelper</a>::fields_for for more info.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L372'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


372
373
374</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 372</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__destroy'>_destroy</span>
  <span class='id identifier rubyid_marked_for_destruction?'>marked_for_destruction?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="allow_destroy?-instance_method">
  <h3 class='signature'>
  #<strong>allow_destroy?</strong>(association_name)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L577'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


577
578
579</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 577</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_allow_destroy?'>allow_destroy?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_nested_attributes_options'>nested_attributes_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_allow_destroy'>allow_destroy</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="assign_nested_attributes_for_collection_association-instance_method">
  <h3 class='signature'>
  #<strong>assign_nested_attributes_for_collection_association</strong>(association_name, attributes_collection)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Assigns the given attributes to the collection association.</p>

<p>Hashes with an <code>:id</code> value matching an existing associated
record will update that record. Hashes without an <code>:id</code> value
will build a new record for the association. Hashes with a matching
<code>:id</code> value and a <code>:_destroy</code> key set to a truthy
value will mark the matched record for destruction.</p>

<p>For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assign_nested_attributes_for_collection_association'>assign_nested_attributes_for_collection_association</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_people'>people</span><span class='comma'>,</span> <span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Peter</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>John</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>3</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>_destroy:</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
<span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<p>Will update the name of the Person with ID 1, build a new associated person
with the name &#39;John&#39;, and mark the associated Person with ID 2 for
destruction.</p>

<p>Also accepts an Array of attribute hashes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assign_nested_attributes_for_collection_association'>assign_nested_attributes_for_collection_association</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_people'>people</span><span class='comma'>,</span> <span class='lbracket'>[</span>
  <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Peter</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>John</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>_destroy:</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
<span class='rbracket'>]</span><span class='rparen'>)</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L454'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 454</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assign_nested_attributes_for_collection_association'>assign_nested_attributes_for_collection_association</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_nested_attributes_options'>nested_attributes_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_permitted?'>permitted?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_attributes_collection'>attributes_collection</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><a href="../Array.html" title="Array (class)">Array</a></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hash or Array expected, got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_check_record_limit!'>check_record_limit!</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_limit'>limit</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>
    <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
    <span class='id identifier rubyid_attributes_collection'>attributes_collection</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_association'>association</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_existing_records'>existing_records</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_loaded?'>loaded?</span>
    <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_attribute_ids'>attribute_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
    <span class='id identifier rubyid_attribute_ids'>attribute_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attribute_ids'>attribute_ids</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attributes'>attributes</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_permitted?'>permitted?</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_with_indifferent_access'>with_indifferent_access</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_reject_new_record?'>reject_new_record?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'><a href="#UNASSIGNABLE_KEYS-constant" title="ActiveRecord::NestedAttributes::UNASSIGNABLE_KEYS (constant)">UNASSIGNABLE_KEYS</a></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_existing_record'>existing_record</span> <span class='op'>=</span> <span class='id identifier rubyid_existing_records'>existing_records</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_call_reject_if'>call_reject_if</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
        <span class='comment'># Make sure we are operating on the actual object which is in the association&#39;s
</span>        <span class='comment'># proxy_target array (either by finding it, or adding it if not found)
</span>        <span class='comment'># Take into account that the proxy_target may have changed due to callbacks
</span>        <span class='id identifier rubyid_target_record'>target_record</span> <span class='op'>=</span> <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_target_record'>target_record</span>
          <span class='id identifier rubyid_existing_record'>existing_record</span> <span class='op'>=</span> <span class='id identifier rubyid_target_record'>target_record</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_association'>association</span><span class='period'>.</span><span class='id identifier rubyid_add_to_target'>add_to_target</span><span class='lparen'>(</span><span class='id identifier rubyid_existing_record'>existing_record</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_skip_callbacks'>skip_callbacks</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_assign_to_or_mark_for_destruction'>assign_to_or_mark_for_destruction</span><span class='lparen'>(</span><span class='id identifier rubyid_existing_record'>existing_record</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_allow_destroy'>allow_destroy</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise_nested_attributes_record_not_found!'>raise_nested_attributes_record_not_found!</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="assign_nested_attributes_for_one_to_one_association-instance_method">
  <h3 class='signature'>
  #<strong>assign_nested_attributes_for_one_to_one_association</strong>(association_name, attributes)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Assigns the given attributes to the association.</p>

<p>If an associated record does not yet exist, one will be instantiated. If an
associated record already exists, the method&#39;s behavior depends on the
value of the update_only option. If update_only is <code>false</code> and
the given attributes include an <code>:id</code> that matches the existing
record&#39;s id, then the existing record will be modified. If no
<code>:id</code> is provided it will be replaced with a new record. If
update_only is <code>true</code> the existing record will be modified
regardless of whether an <code>:id</code> is provided.</p>

<p>If the given attributes include a matching <code>:id</code> attribute, or
update_only is true, and a <code>:_destroy</code> key set to a truthy
value, then the existing record will be marked for destruction.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L395'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 395</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assign_nested_attributes_for_one_to_one_association'>assign_nested_attributes_for_one_to_one_association</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_nested_attributes_options'>nested_attributes_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_permitted?'>permitted?</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_with_indifferent_access'>with_indifferent_access</span>
  <span class='id identifier rubyid_existing_record'>existing_record</span> <span class='op'>=</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_update_only'>update_only</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_existing_record'>existing_record</span> <span class='op'>&amp;&amp;</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_update_only'>update_only</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_existing_record'>existing_record</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_assign_to_or_mark_for_destruction'>assign_to_or_mark_for_destruction</span><span class='lparen'>(</span><span class='id identifier rubyid_existing_record'>existing_record</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_allow_destroy'>allow_destroy</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_call_reject_if'>call_reject_if</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>

  <span class='kw'>elsif</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_raise_nested_attributes_record_not_found!'>raise_nested_attributes_record_not_found!</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_reject_new_record?'>reject_new_record?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_assignable_attributes'>assignable_attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'><a href="#UNASSIGNABLE_KEYS-constant" title="ActiveRecord::NestedAttributes::UNASSIGNABLE_KEYS (constant)">UNASSIGNABLE_KEYS</a></span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_existing_record'>existing_record</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_existing_record'>existing_record</span><span class='period'>.</span><span class='id identifier rubyid_new_record?'>new_record?</span>
      <span class='id identifier rubyid_existing_record'>existing_record</span><span class='period'>.</span><span class='id identifier rubyid_assign_attributes'>assign_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_assignable_attributes'>assignable_attributes</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_association'>association</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_initialize_attributes'>initialize_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_existing_record'>existing_record</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>build_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_association_name'>association_name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='id identifier rubyid_assignable_attributes'>assignable_attributes</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot build association `</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_association_name'>association_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;. Are you trying to build a polymorphic one-to-one association?</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="assign_to_or_mark_for_destruction-instance_method">
  <h3 class='signature'>
  #<strong>assign_to_or_mark_for_destruction</strong>(record, attributes, allow_destroy)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Updates a record with the <code>attributes</code> or marks it for
destruction if <code>allow_destroy</code> is <code>true</code> and
has_destroy_flag? returns <code>true</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L539'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


539
540
541
542</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 539</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assign_to_or_mark_for_destruction'>assign_to_or_mark_for_destruction</span><span class='lparen'>(</span><span class='id identifier rubyid_record'>record</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_allow_destroy'>allow_destroy</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_assign_attributes'>assign_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'><a href="#UNASSIGNABLE_KEYS-constant" title="ActiveRecord::NestedAttributes::UNASSIGNABLE_KEYS (constant)">UNASSIGNABLE_KEYS</a></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_record'>record</span><span class='period'>.</span><span class='id identifier rubyid_mark_for_destruction'>mark_for_destruction</span> <span class='kw'>if</span> <span class='id identifier rubyid_has_destroy_flag?'>has_destroy_flag?</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_allow_destroy'>allow_destroy</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="call_reject_if-instance_method">
  <h3 class='signature'>
  #<strong>call_reject_if</strong>(association_name, attributes)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Determines if a record with the particular <code>attributes</code> should
be rejected by calling the reject_if Symbol or Proc (if defined). The
reject_if option is defined by <code>accepts_nested_attributes_for</code>.</p>

<p>Returns false if there is a <code>destroy_flag</code> on the attributes.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L561'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


561
562
563
564
565
566
567
568
569
570</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 561</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call_reject_if'>call_reject_if</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_will_be_destroyed?'>will_be_destroyed?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_callback'>callback</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_nested_attributes_options'>nested_attributes_options</span><span class='lbracket'>[</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_reject_if'>reject_if</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
    <span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_arity'>arity</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Proc</span>
    <span class='id identifier rubyid_callback'>callback</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="check_record_limit!-instance_method">
  <h3 class='signature'>
  #<strong>check_record_limit!</strong>(limit, attributes_collection)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Takes in a limit and checks if the attributes_collection has too many
records. It accepts limit in the form of symbol, proc, or number-like
object (anything that can be compared with an integer).</p>

<p>Raises TooManyRecords error if the attributes_collection is larger than the
limit.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L520'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 520</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_record_limit!'>check_record_limit!</span><span class='lparen'>(</span><span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_limit'>limit</span>
    <span class='id identifier rubyid_limit'>limit</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_limit'>limit</span>
            <span class='kw'>when</span> <span class='const'><a href="../Symbol.html" title="Symbol (class)">Symbol</a></span>
              <span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_limit'>limit</span><span class='rparen'>)</span>
            <span class='kw'>when</span> <span class='const'>Proc</span>
              <span class='id identifier rubyid_limit'>limit</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>
    <span class='kw'>else</span>
              <span class='id identifier rubyid_limit'>limit</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_limit'>limit</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_limit'>limit</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="NestedAttributes/TooManyRecords.html" title="ActiveRecord::NestedAttributes::TooManyRecords (class)">TooManyRecords</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Maximum </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_limit'>limit</span><span class='embexpr_end'>}</span><span class='tstring_content'> records are allowed. Got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attributes_collection'>attributes_collection</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> records instead.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="has_destroy_flag?-instance_method">
  <h3 class='signature'>
  #<strong>has_destroy_flag?</strong>(hash)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Determines if a hash contains a truthy _destroy key.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L545'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


545
546
547</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 545</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_destroy_flag?'>has_destroy_flag?</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='const'><a href="Type.html" title="ActiveRecord::Type (module)">Type</a></span><span class='op'>::</span><span class='const'><a href="Type.html#Boolean-constant" title="ActiveRecord::Type::Boolean (constant)">Boolean</a></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_destroy</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="raise_nested_attributes_record_not_found!-instance_method">
  <h3 class='signature'>
  #<strong>raise_nested_attributes_record_not_found!</strong>(association_name, record_id)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<tt><a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)">RecordNotFound</a></tt>)</span>
  </li>
</ul>

</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L581'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


581
582
583
584
585</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 581</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_raise_nested_attributes_record_not_found!'>raise_nested_attributes_record_not_found!</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_record_id'>record_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_model'>model</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid__reflect_on_association'>_reflect_on_association</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)">RecordNotFound</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="RecordNotFound.html#new-class_method" title="ActiveRecord::RecordNotFound.new (method)">new</a></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Couldn&#39;t find </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_model'>model</span><span class='embexpr_end'>}</span><span class='tstring_content'> with ID=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_record_id'>record_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> for </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> with ID=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                           <span class='id identifier rubyid_model'>model</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_record_id'>record_id</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="reject_new_record?-instance_method">
  <h3 class='signature'>
  #<strong>reject_new_record?</strong>(association_name, attributes)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Determines if a new record should be rejected by checking has_destroy_flag?
or if a <code>:reject_if</code> proc exists for this association and
evaluates to <code>true</code>.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L552'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


552
553
554</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 552</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reject_new_record?'>reject_new_record?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_will_be_destroyed?'>will_be_destroyed?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_call_reject_if'>call_reject_if</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="will_be_destroyed?-instance_method">
  <h3 class='signature'>
  #<strong>will_be_destroyed?</strong>(association_name, attributes)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Only take into account the destroy flag if <code>:allow_destroy</code> is
true</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/nested_attributes.rb#L573'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


573
574
575</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/nested_attributes.rb', line 573</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_will_be_destroyed?'>will_be_destroyed?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_allow_destroy?'>allow_destroy?</span><span class='lparen'>(</span><span class='id identifier rubyid_association_name'>association_name</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_has_destroy_flag?'>has_destroy_flag?</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>