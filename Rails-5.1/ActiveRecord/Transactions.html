<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Transactions &mdash; Rails-5.1.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Transactions",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.1.0</a> &raquo; 
          <a href='../_index.html'>Index (T)</a> &raquo; 
          <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
          <span class='title'>Transactions</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='module'>

<h1>Module: ActiveRecord::Transactions</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Child Modules:</td>
    <td>
      <div class='box_max'>
        <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Extended by:</td>
    <td>
      <div class='box_max'>
        <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a>
      </div>
    </td>
  </tr>
  <tr>
    <td class='box_1'>Included in:</td>
    <td>
      <div class='box_max'>
        <a href="Base.html" title="ActiveRecord::Base (class)">Base</a>
      </div>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L3'>activerecord/lib/active_record/transactions.rb</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>See <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a> for documentation.</p>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='ACTIONS-constant'>
      ACTIONS =
    </dt>
    <dd>
            <pre class='code ruby'><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'>update</span><span class='rbracket'>]</span></pre>
    </dd>
  </dl>





<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#add_to_transaction-instance_method" title="#add_to_transaction (instance method)">#<strong>add_to_transaction</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Add the record to the current transaction so that the <code>#after_rollback</code> and
<code>#after_commit</code> callbacks can be called.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#before_committed%21-instance_method" title="#before_committed! (instance method)">#<strong>before_committed!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#clear_transaction_record_state-instance_method" title="#clear_transaction_record_state (instance method)">#<strong>clear_transaction_record_state</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Clear the new record state and id of a record.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#committed%21-instance_method" title="#committed! (instance method)">#<strong>committed!</strong>(should_run_callbacks: true)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Call the <code>#after_commit</code> callbacks.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#force_clear_transaction_record_state-instance_method" title="#force_clear_transaction_record_state (instance method)">#<strong>force_clear_transaction_record_state</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Force to clear the transaction record state.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#has_transactional_callbacks%3F-instance_method" title="#has_transactional_callbacks? (instance method)">#<strong>has_transactional_callbacks?</strong>  &#x21d2; Boolean </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#remember_transaction_record_state-instance_method" title="#remember_transaction_record_state (instance method)">#<strong>remember_transaction_record_state</strong>  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Save the new record state and id of a record so it can be restored later if
a transaction fails.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#restore_transaction_record_state-instance_method" title="#restore_transaction_record_state (instance method)">#<strong>restore_transaction_record_state</strong>(force = false)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Restore the new record state and id of a record that was previously saved
by a call to save_record_state.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#rollback_active_record_state%21-instance_method" title="#rollback_active_record_state! (instance method)">#<strong>rollback_active_record_state!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Reset id and @new_record if the transaction rolls back.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#rolledback%21-instance_method" title="#rolledback! (instance method)">#<strong>rolledback!</strong>(force_restore_state: false, should_run_callbacks: true)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Call the <code>#after_rollback</code> callbacks.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#save-instance_method" title="#save (instance method)">#<strong>save</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#save%21-instance_method" title="#save! (instance method)">#<strong>save!</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#set_transaction_state-instance_method" title="#set_transaction_state (instance method)">#<strong>set_transaction_state</strong>(state)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#sync_with_transaction_state-instance_method" title="#sync_with_transaction_state (instance method)">#<strong>sync_with_transaction_state</strong>  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Updates the attributes on this particular Active Record object so that if
it&#39;s associated with a transaction, then the state of the Active Record
object will be updated to reflect the current state of the transaction.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#touch-instance_method" title="#touch (instance method)">#<strong>touch</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#transaction-instance_method" title="#transaction (instance method)">#<strong>transaction</strong>(options = {}, &amp;block)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>See <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a> for detailed documentation.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#transaction_include_any_action%3F-instance_method" title="#transaction_include_any_action? (instance method)">#<strong>transaction_include_any_action?</strong>(actions)  &#x21d2; Boolean </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Determine if a transaction included an action for :create, :update, or
:destroy.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#transaction_record_state-instance_method" title="#transaction_record_state (instance method)">#<strong>transaction_record_state</strong>(state)  </a>
      </span>
      <span class='note title protected'>protected</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Determine if a record was created or destroyed in a transaction.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#update_attributes_from_transaction_state-instance_method" title="#update_attributes_from_transaction_state (instance method)">#<strong>update_attributes_from_transaction_state</strong>(transaction_state)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#with_transaction_returning_status-instance_method" title="#with_transaction_returning_status (instance method)">#<strong>with_transaction_returning_status</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'>
<p>Executes <code>method</code> within a transaction and captures its return
value as a status flag.</p>
</div>
      </span>
    </li>
  </ul>



  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></h3>
  <p class="inherited"><a href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a>, <a href="../ActiveSupport/Concern.html#class_methods-instance_method" title="ActiveSupport::Concern#class_methods (method)">class_methods</a>, <a href="../ActiveSupport/Concern.html#extended-class_method" title="ActiveSupport::Concern.extended (method)">.extended</a>, <a href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></p>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="add_to_transaction-instance_method">
  <h3 class='signature first'>
  #<strong>add_to_transaction</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Add the record to the current transaction so that the <code>#after_rollback</code> and
<code>#after_commit</code> callbacks can be called.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L374'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


374
375
376
377
378
379
380
381
382</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 374</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_add_to_transaction'>add_to_transaction</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_has_transactional_callbacks?'>has_transactional_callbacks?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_add_transaction_record'>add_transaction_record</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sync_with_transaction_state'>sync_with_transaction_state</span>
    <span class='id identifier rubyid_set_transaction_state'>set_transaction_state</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_remember_transaction_record_state'>remember_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="before_committed!-instance_method">
  <h3 class='signature'>
  #<strong>before_committed!</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L342'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


342
343
344
345</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 342</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_before_committed!'>before_committed!</span> <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid__run_before_commit_without_transaction_enrollment_callbacks'>_run_before_commit_without_transaction_enrollment_callbacks</span>
  <span class='id identifier rubyid__run_before_commit_callbacks'>_run_before_commit_callbacks</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="clear_transaction_record_state-instance_method">
  <h3 class='signature'>
  #<strong>clear_transaction_record_state</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Clear the new record state and id of a record.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L424'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


424
425
426
427</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 424</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_force_clear_transaction_record_state'>force_clear_transaction_record_state</span> <span class='kw'>if</span> <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="committed!-instance_method">
  <h3 class='signature'>
  #<strong>committed!</strong>(should_run_callbacks: true)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Call the <code>#after_commit</code> callbacks.</p>

<p>Ensure that it is not called if the object was never persisted (failed
create), but call it after the commit of a destroyed object.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L351'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


351
352
353
354
355
356
357
358</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 351</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_committed!'>committed!</span><span class='lparen'>(</span><span class='label'>should_run_callbacks:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_should_run_callbacks'>should_run_callbacks</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_destroyed?'>destroyed?</span> <span class='op'>||</span> <span class='id identifier rubyid_persisted?'>persisted?</span>
    <span class='id identifier rubyid__run_commit_without_transaction_enrollment_callbacks'>_run_commit_without_transaction_enrollment_callbacks</span>
    <span class='id identifier rubyid__run_commit_callbacks'>_run_commit_callbacks</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_force_clear_transaction_record_state'>force_clear_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="destroy-instance_method">
  <h3 class='signature'>
  #<strong>destroy</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L313'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


313
314
315</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 313</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="force_clear_transaction_record_state-instance_method">
  <h3 class='signature'>
  #<strong>force_clear_transaction_record_state</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Force to clear the transaction record state.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L430'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


430
431
432</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 430</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_force_clear_transaction_record_state'>force_clear_transaction_record_state</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@_start_transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="has_transactional_callbacks?-instance_method">
  <h3 class='signature'>
  #<strong>has_transactional_callbacks?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L477'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


477
478
479</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 477</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_has_transactional_callbacks?'>has_transactional_callbacks?</span> <span class='comment'># :nodoc:
</span>  <span class='op'>!</span><span class='id identifier rubyid__rollback_callbacks'>_rollback_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid__commit_callbacks'>_commit_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid__before_commit_callbacks'>_before_commit_callbacks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="remember_transaction_record_state-instance_method">
  <h3 class='signature'>
  #<strong>remember_transaction_record_state</strong>   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Save the new record state and id of a record so it can be restored later if
a transaction fails.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L413'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


413
414
415
416
417
418
419
420
421</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 413</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_remember_transaction_record_state'>remember_transaction_record_state</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_id'>id</span>
  <span class='ivar'>@_start_transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_reverse_merge!'>reverse_merge!</span><span class='lparen'>(</span>
    <span class='label'>new_record:</span> <span class='ivar'>@new_record</span><span class='comma'>,</span>
    <span class='label'>destroyed:</span> <span class='ivar'>@destroyed</span><span class='comma'>,</span>
    <span class='label'>frozen?:</span> <span class='id identifier rubyid_frozen?'>frozen?</span><span class='comma'>,</span>
  <span class='rparen'>)</span>
  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="restore_transaction_record_state-instance_method">
  <h3 class='signature'>
  #<strong>restore_transaction_record_state</strong>(force = false)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Restore the new record state and id of a record that was previously saved
by a call to save_record_state.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L435'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 435</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span><span class='lparen'>(</span><span class='id identifier rubyid_force'>force</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='kw'>unless</span> <span class='ivar'>@_start_transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_transaction_level'>transaction_level</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_transaction_level'>transaction_level</span> <span class='op'>&lt;</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_force'>force</span>
      <span class='id identifier rubyid_restore_state'>restore_state</span> <span class='op'>=</span> <span class='ivar'>@_start_transaction_state</span>
      <span class='id identifier rubyid_thaw'>thaw</span>
      <span class='ivar'>@new_record</span> <span class='op'>=</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record'>new_record</span><span class='rbracket'>]</span>
      <span class='ivar'>@destroyed</span>  <span class='op'>=</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_destroyed'>destroyed</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_pk'>pk</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_primary_key'>primary_key</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_pk'>pk</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_read_attribute'>read_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_pk'>pk</span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_write_attribute'>write_attribute</span><span class='lparen'>(</span><span class='id identifier rubyid_pk'>pk</span><span class='comma'>,</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_freeze'>freeze</span> <span class='kw'>if</span> <span class='id identifier rubyid_restore_state'>restore_state</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_frozen?'>frozen?</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="rollback_active_record_state!-instance_method">
  <h3 class='signature'>
  #<strong>rollback_active_record_state!</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Reset id and @new_record if the transaction rolls back.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L332'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


332
333
334
335
336
337
338
339
340</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 332</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rollback_active_record_state!'>rollback_active_record_state!</span>
  <span class='id identifier rubyid_remember_transaction_record_state'>remember_transaction_record_state</span>
  <span class='kw'>yield</span>
<span class='kw'>rescue</span> <span class='const'><a href="../Exception.html" title="Exception (class)">Exception</a></span>
  <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span>
  <span class='id identifier rubyid_raise'>raise</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="rolledback!-instance_method">
  <h3 class='signature'>
  #<strong>rolledback!</strong>(force_restore_state: false, should_run_callbacks: true)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Call the <code>#after_rollback</code> callbacks. The <code>force_restore_state</code>
argument indicates if the record state should be rolled back to the
beginning or just to the last savepoint.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L362'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


362
363
364
365
366
367
368
369
370</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 362</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_rolledback!'>rolledback!</span><span class='lparen'>(</span><span class='label'>force_restore_state:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>should_run_callbacks:</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_should_run_callbacks'>should_run_callbacks</span>
    <span class='id identifier rubyid__run_rollback_callbacks'>_run_rollback_callbacks</span>
    <span class='id identifier rubyid__run_rollback_without_transaction_enrollment_callbacks'>_run_rollback_without_transaction_enrollment_callbacks</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span><span class='lparen'>(</span><span class='id identifier rubyid_force_restore_state'>force_restore_state</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="save-instance_method">
  <h3 class='signature'>
  #<strong>save</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L317'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


317
318
319
320
321</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 317</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save'>save</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_rollback_active_record_state!'>rollback_active_record_state!</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="save!-instance_method">
  <h3 class='signature'>
  #<strong>save!</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L323'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


323
324
325</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 323</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_save!'>save!</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="set_transaction_state-instance_method">
  <h3 class='signature'>
  #<strong>set_transaction_state</strong>(state)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L473'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


473
474
475</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 473</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_transaction_state'>set_transaction_state</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='ivar'>@transaction_state</span> <span class='op'>=</span> <span class='id identifier rubyid_state'>state</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="sync_with_transaction_state-instance_method">
  <h3 class='signature'>
  #<strong>sync_with_transaction_state</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Updates the attributes on this particular Active Record object so that if
it&#39;s associated with a transaction, then the state of the Active Record
object will be updated to reflect the current state of the transaction.</p>

<p>The <code>@transaction_state</code> variable stores the states of the
associated transaction. This relies on the fact that a transaction can only
be in one rollback or commit (otherwise a list of states would be
required). Each Active Record object inside of a transaction carries that
transaction&#39;s TransactionState.</p>

<p>This method checks to see if the ActiveRecord object&#39;s state reflects
the TransactionState, and rolls back or commits the Active Record object as
appropriate.</p>

<p>Since Active Record objects can be inside multiple transactions, this
method recursively goes through the parent of the TransactionState and
checks if the Active Record object reflects the state of the object.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L498'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


498
499
500</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 498</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sync_with_transaction_state'>sync_with_transaction_state</span>
  <span class='id identifier rubyid_update_attributes_from_transaction_state'>update_attributes_from_transaction_state</span><span class='lparen'>(</span><span class='ivar'>@transaction_state</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="touch-instance_method">
  <h3 class='signature'>
  #<strong>touch</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L327'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


327
328
329</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 327</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='op'>*</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span> <span class='lbrace'>{</span> <span class='kw'>super</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="transaction-instance_method">
  <h3 class='signature'>
  #<strong>transaction</strong>(options = {}, &amp;block)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>See <a href="Transactions/ClassMethods.html" title="ActiveRecord::Transactions::ClassMethods (module)">ClassMethods</a> for detailed documentation.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L309'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


309
310
311</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 309</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="transaction_include_any_action?-instance_method">
  <h3 class='signature'>
  #<strong>transaction_include_any_action?</strong>(actions)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Determine if a transaction included an action for :create, :update, or
:destroy. Used in filtering callbacks.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L458'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


458
459
460
461
462
463
464
465
466
467
468
469</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 458</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction_include_any_action?'>transaction_include_any_action?</span><span class='lparen'>(</span><span class='id identifier rubyid_actions'>actions</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id identifier rubyid_actions'>actions</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_action'>action</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_action'>action</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create'>create</span>
      <span class='id identifier rubyid_transaction_record_state'>transaction_record_state</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record'>new_record</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>
      <span class='id identifier rubyid_destroyed?'>destroyed?</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'>update</span>
      <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_transaction_record_state'>transaction_record_state</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_new_record'>new_record</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_destroyed?'>destroyed?</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="transaction_record_state-instance_method">
  <h3 class='signature'>
  #<strong>transaction_record_state</strong>(state)   <span class="extras">(<span class='prot'>protected</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Determine if a record was created or destroyed in a transaction. State
should be one of :new_record or :destroyed.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L453'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


453
454
455</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 453</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction_record_state'>transaction_record_state</span><span class='lparen'>(</span><span class='id identifier rubyid_state'>state</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@_start_transaction_state</span><span class='lbracket'>[</span><span class='id identifier rubyid_state'>state</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="update_attributes_from_transaction_state-instance_method">
  <h3 class='signature'>
  #<strong>update_attributes_from_transaction_state</strong>(transaction_state)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L502'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


502
503
504
505
506
507</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 502</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_attributes_from_transaction_state'>update_attributes_from_transaction_state</span><span class='lparen'>(</span><span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_transaction_state'>transaction_state</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_finalized?'>finalized?</span>
    <span class='id identifier rubyid_restore_transaction_record_state'>restore_transaction_record_state</span> <span class='kw'>if</span> <span class='id identifier rubyid_transaction_state'>transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_rolledback?'>rolledback?</span>
    <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="with_transaction_returning_status-instance_method">
  <h3 class='signature'>
  #<strong>with_transaction_returning_status</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Executes <code>method</code> within a transaction and captures its return
value as a status flag. If the status is true the transaction is committed,
otherwise a ROLLBACK is issued. In any case the status flag is returned.</p>

<p>This method is available within the context of an <a href="Base.html" title="ActiveRecord::Base (class)">Base</a>
instance.</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/activerecord/lib/active_record/transactions.rb#L390'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/transactions.rb', line 390</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_transaction_returning_status'>with_transaction_returning_status</span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_add_to_transaction'>add_to_transaction</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>yield</span>
    <span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span>
      <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span> <span class='kw'>unless</span> <span class='id identifier rubyid_status'>status</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_status'>status</span>
<span class='kw'>ensure</span>
  <span class='kw'>if</span> <span class='ivar'>@transaction_state</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@transaction_state</span><span class='period'>.</span><span class='id identifier rubyid_committed?'>committed?</span>
    <span class='id identifier rubyid_clear_transaction_record_state'>clear_transaction_record_state</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>