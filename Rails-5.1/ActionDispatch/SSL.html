<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActionDispatch::SSL &mdash; Rails-5.1.0</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../css/common.css' />

<script type='text/javascript'>
  var pathId = "ActionDispatch::SSL",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../index.html'>Home</a> &raquo; 
          <a href='../index.html'>Rails-5.1.0</a> &raquo; 
          <a href='../_index.html'>Index (S)</a> &raquo; 
          <a href="../ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a> &raquo; 
          <span class='title'>SSL</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: ActionDispatch::SSL</h1>

<table class='y_box'>
<colgroup>
  <col class='box_1' />
  <col class='box_2' />
</colgroup>
  <tr>
    <td class='box_1'>Inherits:</td>
    <td class='box_rel'>
      <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      <ul class='fullTree'>
        <li><a href="../Object.html" title="Object (class)">Object</a></li>
        <li class='next'>ActionDispatch::SSL</li>
      </ul>
      <a href='#' class='inheritanceTree'>show all</a>
    </td>
  </tr>
  <tr>
  <td class='box_1'>Defined in:</td>
  <td class='box_rel'><div class='box_max'>
<a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L42'>actionpack/lib/action_dispatch/middleware/ssl.rb</a></div>  </td>
  </tr>
</table>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This middleware is added to the stack when `config.force_ssl = true`, and
is passed the options set in <code>config.ssl_options</code>. It does three
jobs to enforce secure HTTP requests:</p>

<pre class="code ruby"><code class="ruby">1. TLS redirect: Permanently redirects http:// requests to https://
   with the same URL host, path, etc. Enabled by default. Set `config.ssl_options`
   to modify the destination URL
   (e.g. `redirect: { host: &quot;secure.widgets.com&quot;, port: 8080 }`), or set
   `redirect: false` to disable this feature.

2. Secure cookies: Sets the `secure` flag on cookies to tell browsers they
   mustn&#39;t be sent along with http:// requests. Enabled by default. Set
   `config.ssl_options` with `secure_cookies: false` to disable this feature.

3. HTTP Strict Transport Security (HSTS): Tells the browser to remember
   this site as TLS-only and automatically redirect non-TLS requests.
   Enabled by default. Configure `config.ssl_options` with `hsts: false` to disable.</code></pre>

<p>Set <code>config.ssl_options</code> with `hsts: { … }` to configure HSTS:</p>

<pre class="code ruby"><code class="ruby">* `expires`: How long, in seconds, these settings will stick. The minimum
  required to qualify for browser preload lists is `18.weeks`. Defaults to
  `180.days` (recommended).
* `subdomains`: Set to `true` to tell the browser to apply these settings
  to all subdomains. This protects your cookies from interception by a
  vulnerable site on a subdomain. Defaults to `false`.
* `preload`: Advertise that this site may be included in browsers&#39;
  preloaded HSTS lists. HSTS protects your site on every visit *except the
  first visit* since it hasn&#39;t seen your HSTS header yet. To close this
  gap, browser vendors include a baked-in list of HSTS-enabled sites.
  Go to https://hstspreload.appspot.com to submit your site for inclusion.
  Defaults to `false`.</code></pre>

<p>To turn off HSTS, omitting the header is not enough. Browsers will remember
the original HSTS directive until it expires. Instead, use the header to
tell browsers to expire HSTS immediately. Setting <tt>hsts: false</tt> is a
shortcut for `hsts: { expires: 0 }`.</p>

<p>Requests can opt-out of redirection with <code>exclude</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_ssl_options'>ssl_options</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>redirect:</span> <span class='lbrace'>{</span> <span class='label'>exclude:</span> <span class='tlambda'>-&gt;</span> <span class='id identifier rubyid_request'>request</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>healthcheck</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span> <span class='rbrace'>}</span> <span class='rbrace'>}</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>
<h2 id='t2_cnst'>Constant Summary<small><a href="#" class="summary_toggle">collapse</a></small></h2>

  <dl class="constants summary full">
    <dt id='HSTS_EXPIRES_IN-constant'>
      HSTS_EXPIRES_IN =
    </dt>
    <dd>
      <div class="docstring">
  <div class="discussion">
    
<p>Default to 180 days, the low end for <a
href="https://www.ssllabs.com/ssltest">www.ssllabs.com/ssltest</a>/ and
greater than the 18-week requirement for browser preload lists.</p>


  </div>
</div>
<div class="tags">
  
</div>      <pre class='code ruby'><span class='int'>15552000</span></pre>
    </dd>
  </dl>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#default_hsts_options-class_method" title=".default_hsts_options (class method)">.<strong>default_hsts_options</strong>  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(app, redirect: {}, hsts: {}, secure_cookies: true, **options)  &#x21d2; SSL </a>
      </span>
      <span class='note title constructor'>constructor</span>
      <span class='summary_desc'>
        <div class='inline'>
<p>a new instance of SSL</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#build_hsts_header-instance_method" title="#build_hsts_header (instance method)">#<strong>build_hsts_header</strong>(hsts)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'>
<p><a
href="http://tools.ietf.org/html/rfc6797#section-6.1">tools.ietf.org/html/rfc6797#section-6.1</a></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(env)  </a>
      </span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#flag_cookies_as_secure%21-instance_method" title="#flag_cookies_as_secure! (instance method)">#<strong>flag_cookies_as_secure!</strong>(headers)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#https_location_for-instance_method" title="#https_location_for (instance method)">#<strong>https_location_for</strong>(request)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#normalize_hsts_options-instance_method" title="#normalize_hsts_options (instance method)">#<strong>normalize_hsts_options</strong>(options)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#redirect_to_https-instance_method" title="#redirect_to_https (instance method)">#<strong>redirect_to_https</strong>(request)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#set_hsts_header%21-instance_method" title="#set_hsts_header! (instance method)">#<strong>set_hsts_header!</strong>(headers)  </a>
      </span>
      <span class='note title private'>private</span>
      <span class='summary_desc'>
        <div class='inline'></div>
      </span>
    </li>
  </ul>


<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(app, redirect: {}, hsts: {}, secure_cookies: true, **options)  &#x21d2; <tt><a href="" title="ActionDispatch::SSL (class)">SSL</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>a new instance of SSL</p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L51'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 51</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='label'>redirect:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>hsts:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>secure_cookies:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'>app</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span><span class='rbracket'>]</span>
    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span><span class='period'>.</span><span class='id identifier rubyid_warn'><a href="../ActiveSupport/Deprecation/Reporting.html#warn-instance_method" title="ActiveSupport::Deprecation::Reporting#warn (method)">warn</a></span> <span class='heredoc_beg'>&lt;&lt;-end_warning</span><span class='period'>.</span><span class='id identifier rubyid_strip_heredoc'>strip_heredoc</span>
<span class='tstring_content'>      The `:host` and `:port` options are moving within `:redirect`:
      `config.ssl_options = { redirect: { host: …, port: … } }`.
</span><span class='heredoc_end'>    end_warning
</span>    <span class='ivar'>@redirect</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='ivar'>@redirect</span> <span class='op'>=</span> <span class='id identifier rubyid_redirect'>redirect</span>
  <span class='kw'>end</span>

  <span class='ivar'>@exclude</span> <span class='op'>=</span> <span class='ivar'>@redirect</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@redirect</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_exclude'>exclude</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_proc'>proc</span> <span class='lbrace'>{</span> <span class='op'>!</span><span class='ivar'>@redirect</span> <span class='rbrace'>}</span>
  <span class='ivar'>@secure_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_secure_cookies'>secure_cookies</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_hsts'>hsts</span> <span class='op'>!=</span> <span class='kw'>true</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hsts'>hsts</span> <span class='op'>!=</span> <span class='kw'>false</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hsts'>hsts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_subdomains'>subdomains</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_hsts'>hsts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_subdomains'>subdomains</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>

    <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="../ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span><span class='period'>.</span><span class='id identifier rubyid_warn'><a href="../ActiveSupport/Deprecation/Reporting.html#warn-instance_method" title="ActiveSupport::Deprecation::Reporting#warn (method)">warn</a></span> <span class='heredoc_beg'>&lt;&lt;-end_warning</span><span class='period'>.</span><span class='id identifier rubyid_strip_heredoc'>strip_heredoc</span>
<span class='tstring_content'>      In Rails 5.1, The `:subdomains` option of HSTS config will be treated as true if
      unspecified. Set `config.ssl_options = { hsts: { subdomains: false } }` to opt out
      of this behavior.
</span><span class='heredoc_end'>    end_warning
</span>  <span class='kw'>end</span>

  <span class='ivar'>@hsts_header</span> <span class='op'>=</span> <span class='id identifier rubyid_build_hsts_header'>build_hsts_header</span><span class='lparen'>(</span><span class='id identifier rubyid_normalize_hsts_options'>normalize_hsts_options</span><span class='lparen'>(</span><span class='id identifier rubyid_hsts'>hsts</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Class Method Details</h2>
  <section class='method_details first' id="default_hsts_options-class_method">
  <h3 class='signature first'>
  .<strong>default_hsts_options</strong>  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L47'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


47
48
49</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 47</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default_hsts_options'>default_hsts_options</span>
  <span class='lbrace'>{</span> <span class='label'>expires:</span> <span class='const'><a href="#HSTS_EXPIRES_IN-constant" title="ActionDispatch::SSL::HSTS_EXPIRES_IN (constant)">HSTS_EXPIRES_IN</a></span><span class='comma'>,</span> <span class='label'>subdomains:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>preload:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
<h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="build_hsts_header-instance_method">
  <h3 class='signature first'>
  #<strong>build_hsts_header</strong>(hsts)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
<div class="docstring">
  <div class="discussion">
    
<p><a
href="http://tools.ietf.org/html/rfc6797#section-6.1">tools.ietf.org/html/rfc6797#section-6.1</a></p>


  </div>
</div>
<div class="tags">
  
</div>  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L114'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


114
115
116
117
118
119</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 114</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_hsts_header'>build_hsts_header</span><span class='lparen'>(</span><span class='id identifier rubyid_hsts'>hsts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>max-age=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hsts'>hsts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_expires'>expires</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>; includeSubDomains</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_hsts'>hsts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_subdomains'>subdomains</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>; preload</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_hsts'>hsts</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_preload'>preload</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="call-instance_method">
  <h3 class='signature'>
  #<strong>call</strong>(env)  
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L80'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 80</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'><a href="Request.html" title="ActionDispatch::Request (class)">Request</a></span><span class='period'>.</span><span class='id identifier rubyid_new'><a href="Request.html#new-class_method" title="ActionDispatch::Request.new (method)">new</a></span> <span class='id identifier rubyid_env'>env</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_ssl?'>ssl?</span>
    <span class='ivar'>@app</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_body'>body</span><span class='op'>|</span>
      <span class='id identifier rubyid_set_hsts_header!'>set_hsts_header!</span> <span class='id identifier rubyid_headers'>headers</span>
      <span class='id identifier rubyid_flag_cookies_as_secure!'>flag_cookies_as_secure!</span> <span class='id identifier rubyid_headers'>headers</span> <span class='kw'>if</span> <span class='ivar'>@secure_cookies</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_redirect_to_https'>redirect_to_https</span> <span class='id identifier rubyid_request'>request</span> <span class='kw'>unless</span> <span class='ivar'>@exclude</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='ivar'>@app</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_env'>env</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="flag_cookies_as_secure!-instance_method">
  <h3 class='signature'>
  #<strong>flag_cookies_as_secure!</strong>(headers)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L121'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


121
122
123
124
125
126
127
128
129
130
131
132
133</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 121</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_flag_cookies_as_secure!'>flag_cookies_as_secure!</span><span class='lparen'>(</span><span class='id identifier rubyid_headers'>headers</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cookies'>cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Set-Cookie</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_cookies'>cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_cookies'>cookies</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Set-Cookie</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_cookies'>cookies</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cookie'>cookie</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cookie'>cookie</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>;\s*secure\s*(;|$)</span><span class='regexp_end'>/i</span></span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cookie'>cookie</span><span class='embexpr_end'>}</span><span class='tstring_content'>; secure</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_cookie'>cookie</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="https_location_for-instance_method">
  <h3 class='signature'>
  #<strong>https_location_for</strong>(request)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L142'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


142
143
144
145
146
147
148
149
150</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 142</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_https_location_for'>https_location_for</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='ivar'>@redirect</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_host'>host</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span>
  <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='ivar'>@redirect</span><span class='lbracket'>[</span><span class='symbeg'>:</span><span class='id identifier rubyid_port'>port</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span>

  <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_host'>host</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_location'>location</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_port'>port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>!=</span> <span class='int'>80</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>!=</span> <span class='int'>443</span>
  <span class='id identifier rubyid_location'>location</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_fullpath'>fullpath</span>
  <span class='id identifier rubyid_location'>location</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="normalize_hsts_options-instance_method">
  <h3 class='signature'>
  #<strong>normalize_hsts_options</strong>(options)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L99'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 99</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_hsts_options'>normalize_hsts_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_options'>options</span>
  <span class='comment'># Explicitly disabling HSTS clears the existing setting from browsers
</span>  <span class='comment'># by setting expiry to 0.
</span>  <span class='kw'>when</span> <span class='kw'>false</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_default_hsts_options'>default_hsts_options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>expires:</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='comment'># Default to enabled, with default options.
</span>  <span class='kw'>when</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>true</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_default_hsts_options'>default_hsts_options</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_default_hsts_options'>default_hsts_options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="redirect_to_https-instance_method">
  <h3 class='signature'>
  #<strong>redirect_to_https</strong>(request)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L135'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


135
136
137
138
139
140</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 135</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_redirect_to_https'>redirect_to_https</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span> <span class='ivar'>@redirect</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='int'>301</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/html</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_https_location_for'>https_location_for</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='ivar'>@redirect</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rbracket'>]</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>
  <section class='method_details' id="set_hsts_header!-instance_method">
  <h3 class='signature'>
  #<strong>set_hsts_header!</strong>(headers)   <span class="extras">(<span class='priv'>private</span>)</span>
</h3>
  <span class='link_repo'>[ <a href='https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/ssl.rb#L95'>GitHub</a> ]</span>
<div class='source_code h'>
  <pre class='lines_num'>


95
96
97</pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_dispatch/middleware/ssl.rb', line 95</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_hsts_header!'>set_hsts_header!</span><span class='lparen'>(</span><span class='id identifier rubyid_headers'>headers</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Strict-Transport-Security</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='ivar'>@hsts_header</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.9.5 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>