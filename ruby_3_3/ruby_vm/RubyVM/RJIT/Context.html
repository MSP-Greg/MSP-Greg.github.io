<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: RubyVM::RJIT::Context &mdash; ruby_vm  Ruby-3.3.1 p55</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyVM::RJIT::Context",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Ruby-3.3.1</a> &raquo; 
      <a href='../../'>ruby_vm</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        RubyVM &raquo; 
        <a href="../RJIT.html" title="RubyVM::RJIT (module)">RJIT</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Context&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: RubyVM::RJIT::Context</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          Struct
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          Struct
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2 o'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Struct</span>
        <ul class='fullTree'>
          <li>Object</li>
          <li class='next'>Struct</li>
          <li class='next'>RubyVM::RJIT::Context</li>
        </ul>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17'>lib/ruby_vm/rjit/context.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(stack_size: 0, sp_offset: 0, chain_depth: 0, local_types: [Type::Unknown] * MAX_LOCAL_TYPES, temp_types: [Type::Unknown] * MAX_TEMP_TYPES, self_type: Type::Unknown, temp_mapping: [MapToStack] * MAX_TEMP_TYPES)  &#x21d2; Context </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#chain_depth-instance_method" title="#chain_depth (instance method)">#<strong>chain_depth</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#local_types-instance_method" title="#local_types (instance method)">#<strong>local_types</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#self_type-instance_method" title="#self_type (instance method)">#<strong>self_type</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#sp_offset-instance_method" title="#sp_offset (instance method)">#<strong>sp_offset</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#stack_size-instance_method" title="#stack_size (instance method)">#<strong>stack_size</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#temp_mapping-instance_method" title="#temp_mapping (instance method)">#<strong>temp_mapping</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#temp_types-instance_method" title="#temp_types (instance method)">#<strong>temp_types</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#clear_local_types-instance_method" title="#clear_local_types (instance method)">#<strong>clear_local_types</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Erase local variable type information eg: because of a call we can’t track.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#diff-instance_method" title="#diff (instance method)">#<strong>diff</strong>(dst)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Compute a difference score for two context objects.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#dup-instance_method" title="#dup (instance method)">#<strong>dup</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deep dup by default for safety.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#get_local_type-instance_method" title="#get_local_type (instance method)">#<strong>get_local_type</strong>(idx)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the currently tracked type for a local variable.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#get_opnd_mapping-instance_method" title="#get_opnd_mapping (instance method)">#<strong>get_opnd_mapping</strong>(opnd)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get both the type and mapping (where the value originates) of an operand.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#get_opnd_type-instance_method" title="#get_opnd_type (instance method)">#<strong>get_opnd_type</strong>(opnd)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the type of an instruction operand.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set_local_type-instance_method" title="#set_local_type (instance method)">#<strong>set_local_type</strong>(local_idx, local_type)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Set the type of a local variable.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#set_opnd_mapping-instance_method" title="#set_opnd_mapping (instance method)">#<strong>set_opnd_mapping</strong>(opnd, mapping_opnd_type)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Overwrite both the type and mapping of a stack operand.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shift_stack-instance_method" title="#shift_stack (instance method)">#<strong>shift_stack</strong>(argc)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sp_opnd-instance_method" title="#sp_opnd (instance method)">#<strong>sp_opnd</strong>(offset_bytes = 0)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stack_opnd-instance_method" title="#stack_opnd (instance method)">#<strong>stack_opnd</strong>(depth_from_top)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stack_pop-instance_method" title="#stack_pop (instance method)">#<strong>stack_pop</strong>(n = 1)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Pop N values off the stack Return a pointer to the stack top before the pop operation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stack_push-instance_method" title="#stack_push (instance method)">#<strong>stack_push</strong>(val_type)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Push one new value on the temp stack Return a pointer to the new stack top.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stack_push_local-instance_method" title="#stack_push_local (instance method)">#<strong>stack_push_local</strong>(local_idx)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Push a local variable on the stack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stack_push_mapping-instance_method" title="#stack_push_mapping (instance method)">#<strong>stack_push_mapping</strong>(mapping_temp_type)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Push one new value on the temp stack with an explicit mapping Return a pointer to the new stack top.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#stack_push_self-instance_method" title="#stack_push_self (instance method)">#<strong>stack_push_self</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Push the self value on the stack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#upgrade_opnd_type-instance_method" title="#upgrade_opnd_type (instance method)">#<strong>upgrade_opnd_type</strong>(opnd, opnd_type)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Upgrade (or “learn”) the type of an instruction operand This value must be compatible and at least as specific as the previously known type.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with_stack_size-instance_method" title="#with_stack_size (instance method)">#<strong>with_stack_size</strong>(stack_size)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new <code>Context</code> instance with a given stack_size and sp_offset adjusted accordingly.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#assert-instance_method" title="#assert (instance method)">#<strong>assert</strong>(cond)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(stack_size: 0, sp_offset: 0, chain_depth: 0, local_types: [Type::Unknown] * MAX_LOCAL_TYPES, temp_types: [Type::Unknown] * MAX_TEMP_TYPES, self_type: Type::Unknown, temp_mapping: [MapToStack] * MAX_TEMP_TYPES)  &#x21d2; <code>Context</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L26-L34'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='26' data-end='34'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 26</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(
  <span class='label'>stack_size:</span>   <span class='int'>0</span><span class='comma'>,</span>
  <span class='label'>sp_offset:</span>    <span class='int'>0</span><span class='comma'>,</span>
  <span class='label'>chain_depth:</span>  <span class='int'>0</span><span class='comma'>,</span>
  <span class='label'>local_types:</span>  [<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>] <span class='op'>*</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span><span class='comma'>,</span>
  <span class='label'>temp_types:</span>   [<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>] <span class='op'>*</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span><span class='comma'>,</span>
  <span class='label'>self_type:</span>    <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span><span class='comma'>,</span>
  <span class='label'>temp_mapping:</span> [<span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>] <span class='op'>*</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
) <span class='op'>=</span> <span class='kw'>super</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="chain_depth-instance_method">
  <h3 class='signature rw first'>
    #<strong>chain_depth</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'>chain_depth</span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<section class='method_details' id="local_types-instance_method">
  <h3 class='signature rw'>
    #<strong>local_types</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'>local_types</span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<section class='method_details' id="self_type-instance_method">
  <h3 class='signature rw'>
    #<strong>self_type</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'>self_type</span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sp_offset-instance_method">
  <h3 class='signature rw'>
    #<strong>sp_offset</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'>sp_offset</span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_size-instance_method">
  <h3 class='signature rw'>
    #<strong>stack_size</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'>stack_size</span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<section class='method_details' id="temp_mapping-instance_method">
  <h3 class='signature rw'>
    #<strong>temp_mapping</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'>temp_mapping</span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<section class='method_details' id="temp_types-instance_method">
  <h3 class='signature rw'>
    #<strong>temp_types</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L17-L25'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='17' data-end='25'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 17</span></pre>
<pre class='code ruby'>

<span class='kw'>class</span> <span class='const'>Context</span> <span class='op'>&lt;</span> <span class='const'>Struct</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>(
  <span class='symbeg'>:</span><span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span><span class='comma'>,</span>   <span class='comment'># @param [Integer] The number of values on the stack
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span><span class='comma'>,</span>    <span class='comment'># @param [Integer] JIT sp offset relative to the interpreter&#39;s sp
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span><span class='comma'>,</span>  <span class='comment'># @param [Integer] jit_chain_guard depth
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span><span class='comma'>,</span>  <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Local variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_types'>temp_types</span><span class='comma'>,</span>   <span class='comment'># @param [Array&lt;RubyVM::RJIT::Type&gt;] Temporary variable types we keep track of
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span><span class='comma'>,</span>    <span class='comment'># @param [RubyVM::RJIT::Type] Type we track for self
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span><span class='comma'>,</span> <span class='comment'># @param [Array&lt;Symbol&gt;] Mapping of temp stack entries to types we track
</span>)
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="assert-instance_method">
  <h3 class='signature priv first'>
    #<strong>assert</strong>(cond)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L371-L375'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='371' data-end='375'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 371</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assert'>assert</span>(<span class='id identifier rubyid_cond'>cond</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_cond'>cond</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cond'>cond</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; was not true</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear_local_types-instance_method">
  <h3 class='signature '>
    #<strong>clear_local_types</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Erase local variable type information eg: because of a call we can’t track</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L282-L299'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='282' data-end='299'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 282</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_local_types'>clear_local_types</span>
  <span class='comment'># When clearing local types we must detach any stack mappings to those
</span>  <span class='comment'># locals. Even if local values may have changed, stack values will not.
</span>  <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stack_idx'>stack_idx</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>]
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
      <span class='comment'># noop
</span>    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToSelf-constant" title="RubyVM::RJIT::MapToSelf (constant)">MapToSelf</a></span>
      <span class='comment'># noop
</span>    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToLocal-constant" title="RubyVM::RJIT::MapToLocal (constant)">MapToLocal</a></span>[<span class='id identifier rubyid_local_idx'>local_idx</span>]
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_local_idx'>local_idx</span>]
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Clear the local types
</span>  <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span> <span class='op'>=</span> [<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>] <span class='op'>*</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="diff-instance_method">
  <h3 class='signature '>
    #<strong>diff</strong>(dst)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Compute a difference score for two context objects</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L302-L367'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='302' data-end='367'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 302</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_diff'>diff</span>(<span class='id identifier rubyid_dst'>dst</span>)
  <span class='comment'># Self is the source context (at the end of the predecessor)
</span>  <span class='id identifier rubyid_src'>src</span> <span class='op'>=</span> <span class='kw'>self</span>

  <span class='comment'># Can only lookup the first version in the chain
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Blocks with depth &gt; 0 always produce new versions
</span>  <span class='comment'># Sidechains cannot overlap
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_chain_depth'><a href="#chain_depth-instance_method" title="RubyVM::RJIT::Context#chain_depth (method)">chain_depth</a></span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>!=</span> <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>
    <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span> <span class='op'>!=</span> <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span>
    <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Difference sum
</span>  <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='comment'># Check the type of self
</span>  <span class='id identifier rubyid_diff'>diff</span> <span class='op'>+=</span> <span class='kw'>case</span> <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span>)
  <span class='kw'>in</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='id identifier rubyid_diff'>diff</span>] <span class='kw'>then</span> <span class='id identifier rubyid_diff'>diff</span>
  <span class='kw'>in</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span> <span class='kw'>then</span> <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
  <span class='kw'>end</span>

  <span class='comment'># For each local type we track
</span>  <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>.<span class='id identifier rubyid_size'>size</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_t_src'>t_src</span> <span class='op'>=</span> <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_i'>i</span>]
    <span class='id identifier rubyid_t_dst'>t_dst</span> <span class='op'>=</span> <span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_i'>i</span>]
    <span class='id identifier rubyid_diff'>diff</span> <span class='op'>+=</span> <span class='kw'>case</span> <span class='id identifier rubyid_t_src'>t_src</span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='id identifier rubyid_t_dst'>t_dst</span>)
    <span class='kw'>in</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='id identifier rubyid_diff'>diff</span>] <span class='kw'>then</span> <span class='id identifier rubyid_diff'>diff</span>
    <span class='kw'>in</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span> <span class='kw'>then</span> <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># For each value on the temp stack
</span>  <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_src_mapping'>src_mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_src_type'>src_type</span> <span class='op'>=</span> <span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_get_opnd_mapping'><a href="#get_opnd_mapping-instance_method" title="RubyVM::RJIT::Context#get_opnd_mapping (method)">get_opnd_mapping</a></span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_i'>i</span>])
    <span class='id identifier rubyid_dst_mapping'>dst_mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_dst_type'>dst_type</span> <span class='op'>=</span> <span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_get_opnd_mapping'><a href="#get_opnd_mapping-instance_method" title="RubyVM::RJIT::Context#get_opnd_mapping (method)">get_opnd_mapping</a></span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_i'>i</span>])

    <span class='comment'># If the two mappings aren&#39;t the same
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_src_mapping'>src_mapping</span> <span class='op'>!=</span> <span class='id identifier rubyid_dst_mapping'>dst_mapping</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_dst_mapping'>dst_mapping</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
        <span class='comment'># We can safely drop information about the source of the temp
</span>        <span class='comment'># stack operand.
</span>        <span class='id identifier rubyid_diff'>diff</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_diff'>diff</span> <span class='op'>+=</span> <span class='kw'>case</span> <span class='id identifier rubyid_src_type'>src_type</span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='id identifier rubyid_dst_type'>dst_type</span>)
    <span class='kw'>in</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='id identifier rubyid_diff'>diff</span>] <span class='kw'>then</span> <span class='id identifier rubyid_diff'>diff</span>
    <span class='kw'>in</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span> <span class='kw'>then</span> <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='id identifier rubyid_diff'>diff</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dup-instance_method">
  <h3 class='signature '>
    #<strong>dup</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deep dup by default for safety</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L37-L43'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='37' data-end='43'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 37</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='kw'>super</span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_ctx'>ctx</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_local_type-instance_method">
  <h3 class='signature '>
    #<strong>get_local_type</strong>(idx)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the currently tracked type for a local variable</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L173-L175'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='173' data-end='175'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 173</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_local_type'>get_local_type</span>(<span class='id identifier rubyid_idx'>idx</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>||</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_opnd_mapping-instance_method">
  <h3 class='signature '>
    #<strong>get_opnd_mapping</strong>(opnd)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get both the type and mapping (where the value originates) of an operand. This is can be used with stack_push_mapping or set_opnd_mapping to copy a stack value’s type while maintaining the mapping.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L211-L230'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='211' data-end='230'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='id identifier rubyid_opnd'>opnd</span>)
  <span class='id identifier rubyid_opnd_type'>opnd_type</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_get_opnd_type'><a href="#get_opnd_type-instance_method" title="RubyVM::RJIT::Context#get_opnd_type (method)">get_opnd_type</a></span>(<span class='id identifier rubyid_opnd'>opnd</span>)

  <span class='kw'>case</span> <span class='id identifier rubyid_opnd'>opnd</span>
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span>
    <span class='kw'>return</span> [<span class='const'><a href="../RJIT.html#MapToSelf-constant" title="RubyVM::RJIT::MapToSelf (constant)">MapToSelf</a></span><span class='comma'>,</span> <span class='id identifier rubyid_opnd_type'>opnd_type</span>]
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)
    <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_idx'>idx</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
      <span class='kw'>return</span> [<span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>]<span class='comma'>,</span> <span class='id identifier rubyid_opnd_type'>opnd_type</span>]
    <span class='kw'>else</span>
      <span class='comment'># We can&#39;t know the source of this stack operand, so we assume it is
</span>      <span class='comment'># a stack-only temporary. type will be UNKNOWN
</span>      <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_opnd_type'>opnd_type</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
      <span class='kw'>return</span> [<span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span><span class='comma'>,</span> <span class='id identifier rubyid_opnd_type'>opnd_type</span>]
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_opnd_type-instance_method">
  <h3 class='signature '>
    #<strong>get_opnd_type</strong>(opnd)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the type of an instruction operand</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L145-L170'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='145' data-end='170'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 145</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='id identifier rubyid_opnd'>opnd</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_opnd'>opnd</span>
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span>
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)
    <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_idx'>idx</span>

    <span class='comment'># If outside of tracked range, do nothing
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_mapping'>mapping</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>]

    <span class='kw'>case</span> <span class='id identifier rubyid_mapping'>mapping</span>
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToSelf-constant" title="RubyVM::RJIT::MapToSelf (constant)">MapToSelf</a></span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span>
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_idx'>idx</span>]
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToLocal-constant" title="RubyVM::RJIT::MapToLocal (constant)">MapToLocal</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
      <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span>)
      <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_local_type-instance_method">
  <h3 class='signature '>
    #<strong>set_local_type</strong>(local_idx, local_type)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Set the type of a local variable</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L255-L278'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='255' data-end='278'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 255</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_local_type'>set_local_type</span>(<span class='id identifier rubyid_local_idx'>local_idx</span><span class='comma'>,</span> <span class='id identifier rubyid_local_type'>local_type</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># If any values on the stack map to this local we must detach them
</span>  <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stack_idx'>stack_idx</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>]
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
      <span class='comment'># noop
</span>    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToSelf-constant" title="RubyVM::RJIT::MapToSelf (constant)">MapToSelf</a></span>
      <span class='comment'># noop
</span>    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToLocal-constant" title="RubyVM::RJIT::MapToLocal (constant)">MapToLocal</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
      <span class='kw'>if</span> <span class='id identifier rubyid_idx'>idx</span> <span class='op'>==</span> <span class='id identifier rubyid_local_idx'>local_idx</span>
        <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
        <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
      <span class='kw'>else</span>
        <span class='comment'># noop
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_local_idx'>local_idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_local_type'>local_type</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set_opnd_mapping-instance_method">
  <h3 class='signature '>
    #<strong>set_opnd_mapping</strong>(opnd, mapping_opnd_type)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Overwrite both the type and mapping of a stack operand.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L233-L252'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='233' data-end='252'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 233</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_set_opnd_mapping'>set_opnd_mapping</span>(<span class='id identifier rubyid_opnd'>opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_mapping_opnd_type'>mapping_opnd_type</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_opnd'>opnd</span>
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>self always maps to self</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)
    <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_idx'>idx</span>

    <span class='comment'># If outside of tracked range, do nothing
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_mapping'>mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_opnd_type'>opnd_type</span> <span class='op'>=</span> <span class='id identifier rubyid_mapping_opnd_type'>mapping_opnd_type</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span>

    <span class='comment'># Only used when mapping == MAP_STACK
</span>    <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_opnd_type'>opnd_type</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shift_stack-instance_method">
  <h3 class='signature '>
    #<strong>shift_stack</strong>(argc)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L130-L142'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='130' data-end='142'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 130</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_shift_stack'>shift_stack</span>(<span class='id identifier rubyid_argc'>argc</span>)
  <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>&lt;</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)

  <span class='id identifier rubyid_method_name_index'>method_name_index</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span>

  (<span class='id identifier rubyid_method_name_index'>method_name_index</span><span class='op'>...</span>(<span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='int'>1</span>)).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_i'>i</span>] <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span>]
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_i'>i</span>] <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span>]
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_stack_pop'><a href="#stack_pop-instance_method" title="RubyVM::RJIT::Context#stack_pop (method)">stack_pop</a></span>(<span class='int'>1</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sp_opnd-instance_method">
  <h3 class='signature '>
    #<strong>sp_opnd</strong>(offset_bytes = 0)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L59-L61'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='59' data-end='61'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 59</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='id identifier rubyid_offset_bytes'>offset_bytes</span> <span class='op'>=</span> <span class='int'>0</span>)
  [<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> (<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='kw'>self</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span>) <span class='op'>+</span> <span class='id identifier rubyid_offset_bytes'>offset_bytes</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_opnd-instance_method">
  <h3 class='signature '>
    #<strong>stack_opnd</strong>(depth_from_top)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L55-L57'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='55' data-end='57'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 55</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_depth_from_top'>depth_from_top</span>)
  [<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='kw'>self</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_depth_from_top'>depth_from_top</span>)]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_pop-instance_method">
  <h3 class='signature '>
    #<strong>stack_pop</strong>(n = 1)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pop N values off the stack Return a pointer to the stack top before the pop operation</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L109-L128'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='109' data-end='128'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 109</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_n'>n</span> <span class='op'>&lt;=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)

  <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_opnd'><a href="#stack_opnd-instance_method" title="RubyVM::RJIT::Context#stack_opnd (method)">stack_opnd</a></span>(<span class='int'>0</span>)

  <span class='comment'># Clear the types of the popped values
</span>  <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>-</span> <span class='int'>1</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-=</span> <span class='id identifier rubyid_n'>n</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span> <span class='op'>-=</span> <span class='id identifier rubyid_n'>n</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_top'>top</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_push-instance_method">
  <h3 class='signature '>
    #<strong>stack_push</strong>(val_type)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Push one new value on the temp stack Return a pointer to the new stack top</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L89-L91'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='89' data-end='91'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 89</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='id identifier rubyid_val_type'>val_type</span>)
  <span class='kw'>return</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_push_mapping'><a href="#stack_push_mapping-instance_method" title="RubyVM::RJIT::Context#stack_push_mapping (method)">stack_push_mapping</a></span>([<span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span><span class='comma'>,</span> <span class='id identifier rubyid_val_type'>val_type</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_push_local-instance_method">
  <h3 class='signature '>
    #<strong>stack_push_local</strong>(local_idx)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Push a local variable on the stack</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L99-L105'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='99' data-end='105'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 99</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_push_local'>stack_push_local</span>(<span class='id identifier rubyid_local_idx'>local_idx</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span>
    <span class='kw'>return</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_push'><a href="#stack_push-instance_method" title="RubyVM::RJIT::Context#stack_push (method)">stack_push</a></span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_push_mapping'><a href="#stack_push_mapping-instance_method" title="RubyVM::RJIT::Context#stack_push_mapping (method)">stack_push_mapping</a></span>([<span class='const'><a href="../RJIT.html#MapToLocal-constant" title="RubyVM::RJIT::MapToLocal (constant)">MapToLocal</a></span>[<span class='id identifier rubyid_local_idx'>local_idx</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_push_mapping-instance_method">
  <h3 class='signature '>
    #<strong>stack_push_mapping</strong>(mapping_temp_type)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Push one new value on the temp stack with an explicit mapping Return a pointer to the new stack top</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L65-L85'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='65' data-end='85'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 65</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_push_mapping'>stack_push_mapping</span>(<span class='id identifier rubyid_mapping_temp_type'>mapping_temp_type</span>)
  <span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>

  <span class='comment'># Keep track of the type and mapping of the value
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
    <span class='id identifier rubyid_mapping'>mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_temp_type'>temp_type</span> <span class='op'>=</span> <span class='id identifier rubyid_mapping_temp_type'>mapping_temp_type</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_mapping'>mapping</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_temp_type'>temp_type</span>

    <span class='kw'>case</span> <span class='id identifier rubyid_mapping'>mapping</span>
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToLocal-constant" title="RubyVM::RJIT::MapToLocal (constant)">MapToLocal</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
      <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span>)
    <span class='kw'>else</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span> <span class='op'>+=</span> <span class='int'>1</span>

  <span class='kw'>return</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_opnd'><a href="#stack_opnd-instance_method" title="RubyVM::RJIT::Context#stack_opnd (method)">stack_opnd</a></span>(<span class='int'>0</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_push_self-instance_method">
  <h3 class='signature '>
    #<strong>stack_push_self</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Push the self value on the stack</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L94-L96'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='94' data-end='96'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 94</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_push_self'>stack_push_self</span>
  <span class='kw'>return</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_push_mapping'><a href="#stack_push_mapping-instance_method" title="RubyVM::RJIT::Context#stack_push_mapping (method)">stack_push_mapping</a></span>([<span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="upgrade_opnd_type-instance_method">
  <h3 class='signature '>
    #<strong>upgrade_opnd_type</strong>(opnd, opnd_type)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Upgrade (or “learn”) the type of an instruction operand This value must be compatible and at least as specific as the previously known type. If this value originated from self, or an lvar, the learned type will be propagated back to its source.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L181-L206'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='181' data-end='206'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 181</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_opnd'>opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_opnd_type'>opnd_type</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_opnd'>opnd</span>
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span>.<span class='id identifier rubyid_upgrade'>upgrade</span>(<span class='id identifier rubyid_opnd_type'>opnd_type</span>)
  <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)
    <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_idx'>idx</span>

    <span class='comment'># If outside of tracked range, do nothing
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#MAX_TEMP_TYPES-constant" title="RubyVM::RJIT::MAX_TEMP_TYPES (constant)">MAX_TEMP_TYPES</a></span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_mapping'>mapping</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_mapping'><a href="#temp_mapping-instance_method" title="RubyVM::RJIT::Context#temp_mapping (method)">temp_mapping</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>]

    <span class='kw'>case</span> <span class='id identifier rubyid_mapping'>mapping</span>
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToSelf-constant" title="RubyVM::RJIT::MapToSelf (constant)">MapToSelf</a></span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_self_type'><a href="#self_type-instance_method" title="RubyVM::RJIT::Context#self_type (method)">self_type</a></span>.<span class='id identifier rubyid_upgrade'>upgrade</span>(<span class='id identifier rubyid_opnd_type'>opnd_type</span>)
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span>
      <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>] <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_temp_types'><a href="#temp_types-instance_method" title="RubyVM::RJIT::Context#temp_types (method)">temp_types</a></span>[<span class='id identifier rubyid_stack_idx'>stack_idx</span>].<span class='id identifier rubyid_upgrade'>upgrade</span>(<span class='id identifier rubyid_opnd_type'>opnd_type</span>)
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#MapToLocal-constant" title="RubyVM::RJIT::MapToLocal (constant)">MapToLocal</a></span>[<span class='id identifier rubyid_idx'>idx</span>]
      <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::Context#assert (method)">assert</a></span>(<span class='id identifier rubyid_idx'>idx</span> <span class='op'>&lt;</span> <span class='const'><a href="../RJIT.html#MAX_LOCAL_TYPES-constant" title="RubyVM::RJIT::MAX_LOCAL_TYPES (constant)">MAX_LOCAL_TYPES</a></span>)
      <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_local_types'><a href="#local_types-instance_method" title="RubyVM::RJIT::Context#local_types (method)">local_types</a></span>[<span class='id identifier rubyid_idx'>idx</span>].<span class='id identifier rubyid_upgrade'>upgrade</span>(<span class='id identifier rubyid_opnd_type'>opnd_type</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with_stack_size-instance_method">
  <h3 class='signature '>
    #<strong>with_stack_size</strong>(stack_size)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new <code>Context</code> instance with a given stack_size and sp_offset adjusted accordingly. This is useful when you want to virtually rewind a stack_size for generating a side exit while considering past sp_offset changes on gen_save_sp.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/ruby_vm/rjit/context.rb#L48-L53'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='48' data-end='53'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/context.rb', line 48</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_with_stack_size'>with_stack_size</span>(<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>)
  <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='kw'>self</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::Context#dup (method)">dup</a></span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'><a href="#sp_offset-instance_method" title="RubyVM::RJIT::Context#sp_offset (method)">sp_offset</a></span> <span class='op'>-=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>-</span> <span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span> <span class='op'>=</span> <span class='id identifier rubyid_stack_size'><a href="#stack_size-instance_method" title="RubyVM::RJIT::Context#stack_size (method)">stack_size</a></span>
  <span class='id identifier rubyid_ctx'>ctx</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>