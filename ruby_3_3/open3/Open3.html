<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Open3 &mdash; open3  Ruby-3.3.1 p55</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Open3",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.3.1</a> &raquo; 
      <a href='.'>open3</a> &raquo; 
      <a href='_index.html#alpha_O'>Index (O)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Open3&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Open3</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L81'>lib/open3.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3/version.rb#L1'>lib/open3/version.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Module Open3 supports creating child processes with access to their $stdin, $stdout, and $stderr streams.</p>

<h3 id="label-What-27s+Here">What’s Here</h3>

<p>Each of these methods executes a given command in a new process or subshell, or multiple commands in new processes and/or subshells:</p>
<ul><li>
<p>Each of these methods executes a single command in a process or subshell, accepts a string for input to $stdin, and returns string output from $stdout, $stderr, or both:</p>
<ul><li>
<p>Open3.capture2: Executes the command; returns the string from $stdout.</p>
</li><li>
<p>Open3.capture2e: Executes the command; returns the string from merged $stdout and $stderr.</p>
</li><li>
<p>Open3.capture3: Executes the command; returns strings from $stdout and $stderr.</p>
</li></ul>
</li><li>
<p>Each of these methods executes a single command in a process or subshell, and returns pipes for $stdin, $stdout, and/or $stderr:</p>
<ul><li>
<p>Open3.popen2: Executes the command; returns pipes for $stdin and $stdout.</p>
</li><li>
<p>Open3.popen2e: Executes the command; returns pipes for $stdin and merged $stdout and $stderr.</p>
</li><li>
<p>Open3.popen3: Executes the command; returns pipes for $stdin, $stdout, and $stderr.</p>
</li></ul>
</li><li>
<p>Each of these methods executes one or more commands in processes and/or subshells, returns pipes for the first $stdin, the last $stdout, or both:</p>
<ul><li>
<p>Open3.pipeline_r: Returns a pipe for the last $stdout.</p>
</li><li>
<p>Open3.pipeline_rw: Returns pipes for the first $stdin and the last $stdout.</p>
</li><li>
<p>Open3.pipeline_w: Returns a pipe for the first $stdin.</p>
</li><li>
<p>Open3.pipeline_start: Does not wait for processes to complete.</p>
</li><li>
<p>Open3.pipeline: Waits for processes to complete.</p>
</li></ul>
</li></ul>

<p>Each of the methods above accepts:</p>
<ul><li>
<p>An optional hash of environment variable names and values; see <code>Execution Environment</code>.</p>
</li><li>
<p>A required string argument that is a <code>command_line</code> or <code>exe_path</code>; see <code>Argument command_line or exe_path</code>.</p>
</li><li>
<p>An optional hash of execution options; see <code>Execution Options</code>.</p>
</li></ul>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='VERSION-constant' class='summary_signature'>VERSION =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3/version.rb#L2-L2'># File 'lib/open3/version.rb', line 2</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.2.1</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature mf'>
      <a href="#capture2-class_method" title="capture2 (class method)">.<strong>capture2</strong>([env, ] command_line, options = {})  &#x21d2; Array, status </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#capture2e-class_method" title="capture2e (class method)">.<strong>capture2e</strong>([env, ] command_line, options = {})  &#x21d2; Array, status </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#capture3-class_method" title="capture3 (class method)">.<strong>capture3</strong>([env, ] command_line, options = {})  &#x21d2; Array, ... </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#pipeline-class_method" title="pipeline (class method)">.<strong>pipeline</strong>([env, ] *cmds, options = {})  &#x21d2; array_of_statuses </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#pipeline_r-class_method" title="pipeline_r (class method)">.<strong>pipeline_r</strong>([env, ] *cmds, options = {})  &#x21d2; Array, wait_threads </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#pipeline_rw-class_method" title="pipeline_rw (class method)">.<strong>pipeline_rw</strong>([env, ] *cmds, options = {})  &#x21d2; Array, ... </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#pipeline_start-class_method" title="pipeline_start (class method)">.<strong>pipeline_start</strong>([env, ] *cmds, options = {})  &#x21d2; Array </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#pipeline_w-class_method" title="pipeline_w (class method)">.<strong>pipeline_w</strong>([env, ] *cmds, options = {})  &#x21d2; Array, wait_threads </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#popen2-class_method" title="popen2 (class method)">.<strong>popen2</strong>([env, ] command_line, options = {})  &#x21d2; Array, ... </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#popen2e-class_method" title="popen2e (class method)">.<strong>popen2e</strong>([env, ] command_line, options = {})  &#x21d2; Array, ... </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#popen3-class_method" title="popen3 (class method)">.<strong>popen3</strong>([env, ] command_line, options = {})  &#x21d2; Array, ... </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Basically a wrapper for <code>{Process.spawn</code>} that:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf nodoc'>
      <a href="#pipeline_run-class_method" title=".pipeline_run (class method)">.<strong>pipeline_run</strong>(cmds, pipeline_opts, child_io, parent_io)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
  <li>
    <span class='summary_signature mf nodoc'>
      <a href="#popen_run-class_method" title=".popen_run (class method)">.<strong>popen_run</strong>(cmd, opts, child_io, parent_io)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="capture2-class_method">
  <h3 class='signature private first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>capture2</strong>([env, ] command_line, options = {})  &#x21d2; <code>Array</code>, <code>status</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>capture2</strong>([env, ] exe_path, *args, options = {})  &#x21d2; <code>Array</code>, <code>status</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> with the given arguments (except for certain entries in hash <code>options</code>; see below).</p>
</li><li>
<p>Returns as string <code>stdout_s</code> the standard output of the child process.</p>
</li><li>
<p>Returns as <code>status</code> a <code>Process::Status</code> object that represents the exit status of the child process.</p>
</li></ul>

<p>Returns the array <code>[stdout_s, status]</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdout_s'>stdout_s</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326047 exit 0&gt;]</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>Unlike <code>Process.spawn</code>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <code>Open3.popen3;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <code>Open3.popen3;</code> see <code>Execution Options</code>.</p>

<p>The hash <code>options</code> is given; two options have local effect in method <code>capture2</code>:</p>
<ul><li>
<p>If entry <code>options[:stdin_data]</code> exists, the entry is removed and its string value is sent to the command’s standard input:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tee</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>stdin_data:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Foo</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># =&gt; [&quot;Foo&quot;, #&lt;Process::Status: pid 2326087 exit 0&gt;]</span></code></pre>
</li><li>
<p>If entry <code>options[:binmode]</code> exists, the entry is removed and the internal streams are set to binary mode.</p>
</li></ul>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>if true; then echo &quot;Foo&quot;; fi</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># Shell reserved word.
</span><span class='comment'># =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326131 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>)                         <span class='comment'># Built-in.
</span><span class='comment'># =&gt; [&quot;\n&quot;, #&lt;Process::Status: pid 2326139 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date &gt; date.tmp</span><span class='tstring_end'>&#39;</span></span>)              <span class='comment'># Contains meta character.
</span><span class='comment'># =&gt; [&quot;&quot;, #&lt;Process::Status: pid 2326174 exit 0&gt;]</span></code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326183 exit 0&gt;]</span></code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/date</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Fri Sep 29 01:00:39 PM CDT 2023\n&quot;, #&lt;Process::Status: pid 2326222 exit 0&gt;]</span></code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doesnt_exist</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># Raises Errno::ENOENT</span></code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C #</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;C #\n&quot;, #&lt;Process::Status: pid 2326267 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2'>capture2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;hello world\n&quot;, #&lt;Process::Status: pid 2326299 exit 0&gt;]</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L775-L804'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='775' data-end='804'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 775</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_capture2'>capture2</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_stdin_data'>stdin_data</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stdin_data'>stdin_data</span>)
  <span class='id identifier rubyid_binmode'>binmode</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_binmode'>binmode</span>)

  <span class='id identifier rubyid_popen2'><a href="#popen2-class_method" title="Open3.popen2 (method)">popen2</a></span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>) {<span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out_reader'>out_reader</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_read'>read</span> }
    <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_readpartial'>readpartial</span>
          <span class='const'>IO</span>.<span class='id identifier rubyid_copy_stream'>copy_stream</span>(<span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span>)
        <span class='kw'>else</span>
          <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_close'>close</span>
    [<span class='id identifier rubyid_out_reader'>out_reader</span>.<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_value'>value</span>]
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="capture2e-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>capture2e</strong>([env, ] command_line, options = {})  &#x21d2; <code>Array</code>, <code>status</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>capture2e</strong>([env, ] exe_path, *args, options = {})  &#x21d2; <code>Array</code>, <code>status</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> with the given arguments (except for certain entries in hash <code>options</code>; see below).</p>
</li><li>
<p>Returns as string <code>stdout_and_stderr_s</code> the merged standard output and standard error of the child process.</p>
</li><li>
<p>Returns as <code>status</code> a <code>Process::Status</code> object that represents the exit status of the child process.</p>
</li></ul>

<p>Returns the array <code>[stdout_and_stderr_s, status]</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdout_and_stderr_s'>stdout_and_stderr_s</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2371692 exit 0&gt;]</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>Unlike <code>Process.spawn</code>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <code>Open3.popen3;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <code>Open3.popen3;</code> see <code>Execution Options</code>.</p>

<p>The hash <code>options</code> is given; two options have local effect in method <code>capture2e</code>:</p>
<ul><li>
<p>If entry <code>options[:stdin_data]</code> exists, the entry is removed and its string value is sent to the command’s standard input:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tee</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>stdin_data:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Foo</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo&quot;, #&lt;Process::Status: pid 2371732 exit 0&gt;]</span></code></pre>
</li><li>
<p>If entry <code>options[:binmode]</code> exists, the entry is removed and the internal streams are set to binary mode.</p>
</li></ul>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>if true; then echo &quot;Foo&quot;; fi</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># Shell reserved word.
</span><span class='comment'># =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2371740 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>)                         <span class='comment'># Built-in.
</span><span class='comment'># =&gt; [&quot;\n&quot;, #&lt;Process::Status: pid 2371774 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date &gt; date.tmp</span><span class='tstring_end'>&#39;</span></span>)              <span class='comment'># Contains meta character.
</span><span class='comment'># =&gt; [&quot;&quot;, #&lt;Process::Status: pid 2371812 exit 0&gt;]</span></code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo\n&quot;, #&lt;Process::Status: pid 2326183 exit 0&gt;]</span></code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/date</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Sat Sep 30 09:01:46 AM CDT 2023\n&quot;, #&lt;Process::Status: pid 2371820 exit 0&gt;]</span></code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doesnt_exist</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># Raises Errno::ENOENT</span></code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C #</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;C #\n&quot;, #&lt;Process::Status: pid 2371856 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;hello world\n&quot;, #&lt;Process::Status: pid 2371894 exit 0&gt;]</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L902-L931'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='902' data-end='931'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 902</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_capture2e'>capture2e</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_stdin_data'>stdin_data</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stdin_data'>stdin_data</span>)
  <span class='id identifier rubyid_binmode'>binmode</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_binmode'>binmode</span>)

  <span class='id identifier rubyid_popen2e'><a href="#popen2e-class_method" title="Open3.popen2e (method)">popen2e</a></span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>) {<span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_oe'>oe</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_oe'>oe</span>.<span class='id identifier rubyid_binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_outerr_reader'>outerr_reader</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_oe'>oe</span>.<span class='id identifier rubyid_read'>read</span> }
    <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_readpartial'>readpartial</span>
          <span class='const'>IO</span>.<span class='id identifier rubyid_copy_stream'>copy_stream</span>(<span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span>)
        <span class='kw'>else</span>
          <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_close'>close</span>
    [<span class='id identifier rubyid_outerr_reader'>outerr_reader</span>.<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_value'>value</span>]
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="capture3-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>capture3</strong>([env, ] command_line, options = {})  &#x21d2; <code>Array</code>, ...  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>capture3</strong>([env, ] exe_path, *args, options = {})  &#x21d2; <code>Array</code>, ... </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> that:</p>
<ul><li>
<p>Creates a child process, by calling <a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a> with the given arguments (except for certain entries in hash <code>options</code>; see below).</p>
</li><li>
<p>Returns as strings <code>stdout_s</code> and <code>stderr_s</code> the standard output and standard error of the child process.</p>
</li><li>
<p>Returns as <code>status</code> a <code>Process::Status</code> object that represents the exit status of the child process.</p>
</li></ul>

<p>Returns the array <code>[stdout_s, stderr_s, status]</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdout_s'>stdout_s</span><span class='comma'>,</span> <span class='id identifier rubyid_stderr_s'>stderr_s</span><span class='comma'>,</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2281954 exit 0&gt;]</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>Unlike <code>Process.spawn</code>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <code>Open3.popen3;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <code>Open3.popen3;</code> see <code>Execution Options</code>.</p>

<p>The hash <code>options</code> is given; two options have local effect in method <code>capture3</code>:</p>
<ul><li>
<p>If entry <code>options[:stdin_data]</code> exists, the entry is removed and its string value is sent to the command’s standard input:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tee</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>stdin_data:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Foo</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo&quot;, &quot;&quot;, #&lt;Process::Status: pid 2319575 exit 0&gt;]</span></code></pre>
</li><li>
<p>If entry <code>options[:binmode]</code> exists, the entry is removed and the internal streams are set to binary mode.</p>
</li></ul>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>if true; then echo &quot;Foo&quot;; fi</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># Shell reserved word.
</span><span class='comment'># =&gt; [&quot;Foo\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282025 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>)                         <span class='comment'># Built-in.
</span><span class='comment'># =&gt; [&quot;\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282092 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date &gt; date.tmp</span><span class='tstring_end'>&#39;</span></span>)              <span class='comment'># Contains meta character.
</span><span class='comment'># =&gt; [&quot;&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282110 exit 0&gt;]</span></code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Foo\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282092 exit 0&gt;]</span></code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/date</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;Thu Sep 28 05:03:51 PM CDT 2023\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282300 exit 0&gt;]</span></code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doesnt_exist</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># Raises Errno::ENOENT</span></code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C #</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;C #\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282368 exit 0&gt;]
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_capture3'>capture3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [&quot;hello world\n&quot;, &quot;&quot;, #&lt;Process::Status: pid 2282372 exit 0&gt;]</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L648-L677'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='648' data-end='677'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 648</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_capture3'>capture3</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_stdin_data'>stdin_data</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_stdin_data'>stdin_data</span>) <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_binmode'>binmode</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_binmode'>binmode</span>)

  <span class='id identifier rubyid_popen3'><a href="#popen3-class_method" title="Open3.popen3 (method)">popen3</a></span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>) {<span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_binmode'>binmode</span>
      <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_out_reader'>out_reader</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_read'>read</span> }
    <span class='id identifier rubyid_err_reader'>err_reader</span> <span class='op'>=</span> <span class='const'>Thread</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_e'>e</span>.<span class='id identifier rubyid_read'>read</span> }
    <span class='kw'>begin</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_readpartial'>readpartial</span>
        <span class='const'>IO</span>.<span class='id identifier rubyid_copy_stream'>copy_stream</span>(<span class='id identifier rubyid_stdin_data'>stdin_data</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span>)
      <span class='kw'>else</span>
        <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_write'>write</span> <span class='id identifier rubyid_stdin_data'>stdin_data</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_close'>close</span>
    [<span class='id identifier rubyid_out_reader'>out_reader</span>.<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_err_reader'>err_reader</span>.<span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_value'>value</span>]
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipeline-class_method">
  <h3 class='signature private'>
    .<strong>pipeline</strong>([env, ] *cmds, options = {})  &#x21d2; <code>array_of_statuses</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling Process.spawn.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the last child, to the caller’s <code>stdout</code>.</p>
</li><li>
<p>Waits for the child processes to exit.</p>
</li><li>
<p>Returns an array of <code>Process::Status</code> objects (one for each child).</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_wait_threads'>wait_threads</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline'>pipeline</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ls</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>grep R</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;Process::Status: pid 2139200 exit 0&gt;, #&lt;Process::Status: pid 2139202 exit 0&gt;]</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rakefile</span>
<span class='const'>README</span>.<span class='id identifier rubyid_md'>md</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <code>Process.spawn’</code> see <code>Execution Options</code>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <code>Argument command_line or exe_path</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L1334-L1344'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1334' data-end='1344'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 1334</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline'>pipeline</span>(<span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_pipeline_run'><a href="#pipeline_run-class_method" title="Open3.pipeline_run (method)">pipeline_run</a></span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> []<span class='comma'>,</span> []) {<span class='op'>|</span><span class='id identifier rubyid_ts'>ts</span><span class='op'>|</span>
    <span class='id identifier rubyid_ts'>ts</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>)
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipeline_r-class_method">
  <h3 class='signature private'>
    .<strong>pipeline_r</strong>([env, ] *cmds, options = {})  &#x21d2; <code>Array</code>, <code>wait_threads</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling Process.spawn.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the last child, to the caller’s <code>stdout</code>.</p>
</li></ul>

<p>The method does not wait for child processes to exit, so the caller must do so.</p>

<p>With no block given, returns a 2-element array containing:</p>
<ul><li>
<p>The <code>stdout</code> stream of the last child process.</p>
</li><li>
<p>An array of the wait threads for all of the child processes.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_last_stdout'>last_stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_threads'>wait_threads</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_r'>pipeline_r</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ls</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>grep R</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;IO:fd 5&gt;, [#&lt;Process::Waiter:0x000055e8de2f9898 dead&gt;, #&lt;Process::Waiter:0x000055e8de2f94b0 sleep&gt;]]
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_last_stdout'>last_stdout</span>.<span class='id identifier rubyid_read'>read</span>
<span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rakefile</span>
<span class='const'>README</span>.<span class='id identifier rubyid_md'>md</span></code></pre>

<p>With a block given, calls the block with the <code>stdout</code> stream of the last child process, and an array of the wait processes:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_r'>pipeline_r</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ls</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>grep R</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_last_stdout'>last_stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_threads'>wait_threads</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_last_stdout'>last_stdout</span>.<span class='id identifier rubyid_read'>read</span>
  <span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
    <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rakefile</span>
<span class='const'>README</span>.<span class='id identifier rubyid_md'>md</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <code>Argument command_line or exe_path</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L1104-L1115'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1104' data-end='1115'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 1104</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_r'>pipeline_r</span>(<span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>] <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_pipeline_run'><a href="#pipeline_run-class_method" title="Open3.pipeline_run (method)">pipeline_run</a></span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> [<span class='id identifier rubyid_out_w'>out_w</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_out_r'>out_r</span>]<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipeline_run-class_method">
  <h3 class='signature private nodoc'>
    .<strong>pipeline_run</strong>(cmds, pipeline_opts, child_io, parent_io)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L1347-L1401'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1347' data-end='1401'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 1347</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_run'>pipeline_run</span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span><span class='comma'>,</span> <span class='id identifier rubyid_child_io'>child_io</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_io'>parent_io</span>) <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no commands</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_opts_base'>opts_base</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_opts_base'>opts_base</span>.<span class='id identifier rubyid_delete'>delete</span> <span class='symbeg'>:</span><span class='kw'>in</span>
  <span class='id identifier rubyid_opts_base'>opts_base</span>.<span class='id identifier rubyid_delete'>delete</span> <span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>

  <span class='id identifier rubyid_wait_thrs'>wait_thrs</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> {<span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_cmd_opts'>cmd_opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts_base'>opts_base</span>.<span class='id identifier rubyid_dup'>dup</span>
    <span class='kw'>if</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> [<span class='id identifier rubyid_cmd'>cmd</span>]
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cmd_opts'>cmd_opts</span>.<span class='id identifier rubyid_update'>update</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span> <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cmd_opts'>cmd_opts</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='symbeg'>:</span><span class='kw'>in</span>)
        <span class='kw'>if</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='symbeg'>:</span><span class='kw'>in</span>)
          <span class='id identifier rubyid_cmd_opts'>cmd_opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>]
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_cmd_opts'>cmd_opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>!=</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='id identifier rubyid_r2'>r2</span><span class='comma'>,</span> <span class='id identifier rubyid_w2'>w2</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
      <span class='id identifier rubyid_cmd_opts'>cmd_opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>] <span class='op'>=</span> <span class='id identifier rubyid_w2'>w2</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_cmd_opts'>cmd_opts</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>)
        <span class='kw'>if</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>)
          <span class='id identifier rubyid_cmd_opts'>cmd_opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>] <span class='op'>=</span> <span class='id identifier rubyid_pipeline_opts'>pipeline_opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>]
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_cmd_opts'>cmd_opts</span>)
    <span class='id identifier rubyid_wait_thrs'>wait_thrs</span> <span class='op'>&lt;&lt;</span> <span class='const'>Process</span>.<span class='id identifier rubyid_detach'>detach</span>(<span class='id identifier rubyid_pid'>pid</span>)
    <span class='id identifier rubyid_r'>r</span><span class='op'>&amp;.</span><span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_w2'>w2</span><span class='op'>&amp;.</span><span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_r2'>r2</span>
  }
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_io'>parent_io</span> <span class='op'>+</span> [<span class='id identifier rubyid_wait_thrs'>wait_thrs</span>]
  <span class='id identifier rubyid_child_io'>child_io</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>)
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>yield</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='kw'>yield</span>(<span class='op'>*</span><span class='id identifier rubyid_result'>result</span>)
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_parent_io'>parent_io</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>)
      <span class='id identifier rubyid_wait_thrs'>wait_thrs</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_join'>join</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipeline_rw-class_method">
  <h3 class='signature private'>
    .<strong>pipeline_rw</strong>([env, ] *cmds, options = {})  &#x21d2; <code>Array</code>, ...  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling Process.spawn.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the first child, from the caller’s <code>stdin</code>, or, for the last child, to the caller’s <code>stdout</code>.</p>
</li></ul>

<p>The method does not wait for child processes to exit, so the caller must do so.</p>

<p>With no block given, returns a 3-element array containing:</p>
<ul><li>
<p>The <code>stdin</code> stream of the first child process.</p>
</li><li>
<p>The <code>stdout</code> stream of the last child process.</p>
</li><li>
<p>An array of the wait threads for all of the child processes.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_first_stdin'>first_stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_last_stdout'>last_stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_threads'>wait_threads</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_rw'>pipeline_rw</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cat -n</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;IO:fd 20&gt;, #&lt;IO:fd 21&gt;, [#&lt;Process::Waiter:0x000055e8de29ab40 sleep&gt;, #&lt;Process::Waiter:0x000055e8de29a690 sleep&gt;]]
</span><span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo\nbar\nbaz</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_close'>close</span> <span class='comment'># Send EOF to sort.
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_last_stdout'>last_stdout</span>.<span class='id identifier rubyid_read'>read</span>
<span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='int'>1</span>	<span class='id identifier rubyid_bar'>bar</span>
<span class='int'>2</span>	<span class='id identifier rubyid_baz'>baz</span>
<span class='int'>3</span>	<span class='id identifier rubyid_foo'>foo</span></code></pre>

<p>With a block given, calls the block with the <code>stdin</code> stream of the first child, the <code>stdout</code> stream  of the last child, and an array of the wait processes:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_rw'>pipeline_rw</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cat -n</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_first_stdin'>first_stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_last_stdout'>last_stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_threads'>wait_threads</span><span class='op'>|</span>
  <span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo\nbar\nbaz</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_close'>close</span> <span class='comment'># send EOF to sort.
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_last_stdout'>last_stdout</span>.<span class='id identifier rubyid_read'>read</span>
  <span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
    <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='int'>1</span>	<span class='id identifier rubyid_bar'>bar</span>
<span class='int'>2</span>	<span class='id identifier rubyid_baz'>baz</span>
<span class='int'>3</span>	<span class='id identifier rubyid_foo'>foo</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <code>Argument command_line or exe_path</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L1014-L1029'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1014' data-end='1029'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 1014</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_rw'>pipeline_rw</span>(<span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>] <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_pipeline_run'><a href="#pipeline_run-class_method" title="Open3.pipeline_run (method)">pipeline_run</a></span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> [<span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span>]<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipeline_start-class_method">
  <h3 class='signature private'>
    .<strong>pipeline_start</strong>([env, ] *cmds, options = {})  &#x21d2; <code>Array</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling Process.spawn.</p>
</li><li>
<p>Does not wait for child processes to exit.</p>
</li></ul>

<p>With no block given, returns an array of the wait threads for all of the child processes.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_wait_threads'>wait_threads</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_start'>pipeline_start</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ls</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>grep R</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;Process::Waiter:0x000055e8de9d2bb0 run&gt;, #&lt;Process::Waiter:0x000055e8de9d2890 run&gt;]
</span><span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rakefile</span>
<span class='const'>README</span>.<span class='id identifier rubyid_md'>md</span></code></pre>

<p>With a block given, calls the block with an array of the wait processes:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_start'>pipeline_start</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ls</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>grep R</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_threads'>wait_threads</span><span class='op'>|</span>
  <span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
    <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rakefile</span>
<span class='const'>README</span>.<span class='id identifier rubyid_md'>md</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <code>Argument command_line or exe_path</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L1272-L1285'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1272' data-end='1285'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 1272</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_start'>pipeline_start</span>(<span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
    <span class='id identifier rubyid_pipeline_run'><a href="#pipeline_run-class_method" title="Open3.pipeline_run (method)">pipeline_run</a></span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> []<span class='comma'>,</span> []<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ts'>ts</span><span class='comma'>,</span> <span class='op'>=</span> <span class='id identifier rubyid_pipeline_run'><a href="#pipeline_run-class_method" title="Open3.pipeline_run (method)">pipeline_run</a></span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> []<span class='comma'>,</span> [])
    <span class='id identifier rubyid_ts'>ts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pipeline_w-class_method">
  <h3 class='signature private'>
    .<strong>pipeline_w</strong>([env, ] *cmds, options = {})  &#x21d2; <code>Array</code>, <code>wait_threads</code>  <span class="extras">(<span class='mod_func'>mod_func</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process for each of the given <code>cmds</code> by calling Process.spawn.</p>
</li><li>
<p>Pipes the <code>stdout</code> from each child to the <code>stdin</code> of the next child, or, for the first child, pipes the caller’s <code>stdout</code> to the child’s <code>stdin</code>.</p>
</li></ul>

<p>The method does not wait for child processes to exit, so the caller must do so.</p>

<p>With no block given, returns a 2-element array containing:</p>
<ul><li>
<p>The <code>stdin</code> stream of the first child process.</p>
</li><li>
<p>An array of the wait threads for all of the child processes.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_first_stdin'>first_stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_threads'>wait_threads</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_w'>pipeline_w</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cat -n</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;IO:fd 7&gt;, [#&lt;Process::Waiter:0x000055e8de928278 run&gt;, #&lt;Process::Waiter:0x000055e8de923e80 run&gt;]]
</span><span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo\nbar\nbaz</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_close'>close</span> <span class='comment'># Send EOF to sort.
</span><span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='int'>1</span>	<span class='id identifier rubyid_bar'>bar</span>
<span class='int'>2</span>	<span class='id identifier rubyid_baz'>baz</span>
<span class='int'>3</span>	<span class='id identifier rubyid_foo'>foo</span></code></pre>

<p>With a block given, calls the block with the <code>stdin</code> stream of the first child process, and an array of the wait processes:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_pipeline_w'>pipeline_w</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cat -n</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_first_stdin'>first_stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_threads'>wait_threads</span><span class='op'>|</span>
  <span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo\nbar\nbaz</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_first_stdin'>first_stdin</span>.<span class='id identifier rubyid_close'>close</span> <span class='comment'># Send EOF to sort.
</span>  <span class='id identifier rubyid_wait_threads'>wait_threads</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
    <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_join'>join</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='int'>1</span>	<span class='id identifier rubyid_bar'>bar</span>
<span class='int'>2</span>	<span class='id identifier rubyid_baz'>baz</span>
<span class='int'>3</span>	<span class='id identifier rubyid_foo'>foo</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in each call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in each call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>Each remaining argument in <code>cmds</code> is one of:</p>
<ul><li>
<p>A <code>command_line</code>: a string that begins with a shell reserved word or special built-in, or contains one or more metacharacters.</p>
</li><li>
<p>An <code>exe_path</code>: the string path to an executable to be called.</p>
</li><li>
<p>An array containing a <code>command_line</code> or an <code>exe_path</code>, along with zero or more string arguments for the command.</p>
</li></ul>

<p>See <code>Argument command_line or exe_path</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L1195-L1207'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1195' data-end='1207'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 1195</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pipeline_w'>pipeline_w</span>(<span class='op'>*</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmds'>cmds</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_pipeline_run'><a href="#pipeline_run-class_method" title="Open3.pipeline_run (method)">pipeline_run</a></span>(<span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> [<span class='id identifier rubyid_in_r'>in_r</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_in_w'>in_w</span>]<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="popen2-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>popen2</strong>([env, ] command_line, options = {})  &#x21d2; <code>Array</code>, ...  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>popen2</strong>([env, ] exe_path, *args, options = {})  &#x21d2; <code>Array</code>, ... </span>
      <span class='overload'>.<strong>popen2</strong>([env, ] command_line, options =)  &#x21d2; <code>Object</code> </span>
      <span class='overload'>.<strong>popen2</strong>([env, ] exe_path, *args, options =)  &#x21d2; <code>Object</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process, by calling <code>Process.spawn</code> with the given arguments.</p>
</li><li>
<p>Creates streams <code>stdin</code> and <code>stdout</code>, which are the standard input and standard output streams in the child process.</p>
</li><li>
<p>Creates thread <code>wait_thread</code> that waits for the child process to exit; the thread has method <code>pid</code>, which returns the process ID of the child process.</p>
</li></ul>

<p>With no block given, returns the array <code>[stdin, stdout, wait_thread]</code>. The caller should close each of the two returned streams.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;IO:fd 6&gt;, #&lt;IO:fd 7&gt;, #&lt;Process::Waiter:0x00007f58d52dbe98 run&gt;]
</span><span class='id identifier rubyid_stdin'>stdin</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_stdout'>stdout</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_pid'>pid</span>   <span class='comment'># =&gt; 2263572
</span><span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'># =&gt; #&lt;Process::Status: pid 2263572 exit 0&gt;</span></code></pre>

<p>With a block given, calls the block with the three variables (two streams and the wait thread) and returns the block’s return value. The caller need not close the streams:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdin'>stdin</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdout'>stdout</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_pid'>pid</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;IO:fd 6&gt;
</span><span class='comment'>#&lt;IO:fd 7&gt;
</span><span class='comment'>#&lt;Process::Waiter:0x00007f58d59a34b0 sleep&gt;
</span><span class='int'>2263636</span>
<span class='comment'>#&lt;Process::Status: pid 2263636 exit 0&gt;</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>Unlike <code>Process.spawn</code>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>if true; then echo &quot;Foo&quot;; fi</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> } <span class='comment'># Shell reserved word.
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> }                         <span class='comment'># Built-in.
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date &gt; date.tmp</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> }              <span class='comment'># Contains meta character.</span></code></pre>

<p>Output (similar for each call above):</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># =&gt; [#&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;Process::Waiter:0x00007f7577dfe410 dead&gt;]</span></code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Foo\n</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/date</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;Thu Sep 28 09:41:06 AM CDT 2023\n&quot;</span></code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doesnt_exist</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> } <span class='comment'># Raises Errno::ENOENT</span></code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C #</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;C #\n&quot;
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2'>popen2</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;hello world\n&quot;</span></code></pre>

<p>Related:</p>
<ul><li>
<p><a href="#popen2e-class_method" title="Open3.popen2e (method)">.popen2e</a>: Makes the standard input and the merge of the standard output and standard error streams of the child process available as separate streams.</p>
</li><li>
<p><a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a>: Makes the standard input, standard output, and standard error streams of the child process available as separate streams.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L365-L380'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='365' data-end='380'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 365</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_popen2'>popen2</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>] <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_popen_run'><a href="#popen_run-class_method" title="Open3.popen_run (method)">popen_run</a></span>(<span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> [<span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span>]<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="popen2e-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>popen2e</strong>([env, ] command_line, options = {})  &#x21d2; <code>Array</code>, ...  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>popen2e</strong>([env, ] exe_path, *args, options = {})  &#x21d2; <code>Array</code>, ... </span>
      <span class='overload'>.<strong>popen2e</strong>([env, ] command_line, options =)  &#x21d2; <code>Object</code> </span>
      <span class='overload'>.<strong>popen2e</strong>([env, ] exe_path, *args, options =)  &#x21d2; <code>Object</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process, by calling <code>Process.spawn</code> with the given arguments.</p>
</li><li>
<p>Creates streams <code>stdin</code>, <code>stdout_and_stderr</code>, which are the standard input and the merge of the standard output and standard error streams in the child process.</p>
</li><li>
<p>Creates thread <code>wait_thread</code> that waits for the child process to exit; the thread has method <code>pid</code>, which returns the process ID of the child process.</p>
</li></ul>

<p>With no block given, returns the array <code>[stdin, stdout_and_stderr, wait_thread]</code>. The caller should close each of the two returned streams.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout_and_stderr'>stdout_and_stderr</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;IO:fd 6&gt;, #&lt;IO:fd 7&gt;, #&lt;Process::Waiter:0x00007f7577da4398 run&gt;]
</span><span class='id identifier rubyid_stdin'>stdin</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_stdout_and_stderr'>stdout_and_stderr</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_pid'>pid</span>   <span class='comment'># =&gt; 2274600
</span><span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'># =&gt; #&lt;Process::Status: pid 2274600 exit 0&gt;</span></code></pre>

<p>With a block given, calls the block with the three variables (two streams and the wait thread) and returns the block’s return value. The caller need not close the streams:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout_and_stderr'>stdout_and_stderr</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdin'>stdin</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdout_and_stderr'>stdout_and_stderr</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_pid'>pid</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;IO:fd 6&gt;
</span><span class='comment'>#&lt;IO:fd 7&gt;
</span><span class='comment'>#&lt;Process::Waiter:0x00007f75777578c8 sleep&gt;
</span><span class='int'>2274763</span>
<span class='comment'>#&lt;Process::Status: pid 2274763 exit 0&gt;</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>Unlike <code>Process.spawn</code>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>if true; then echo &quot;Foo&quot;; fi</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> } <span class='comment'># Shell reserved word.
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> }                         <span class='comment'># Built-in.
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date &gt; date.tmp</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> }              <span class='comment'># Contains meta character.</span></code></pre>

<p>Output (similar for each call above):</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># =&gt; [#&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;Process::Waiter:0x00007f7577d8a1f0 dead&gt;]</span></code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Foo\n</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/date</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;Thu Sep 28 01:58:45 PM CDT 2023\n&quot;</span></code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doesnt_exist</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span>.<span class='id identifier rubyid_gets'>gets</span> } <span class='comment'># Raises Errno::ENOENT</span></code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C #</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;C #\n&quot;
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o_and_e'>o_and_e</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;hello world\n&quot;</span></code></pre>

<p>Related:</p>
<ul><li>
<p><a href="#popen2-class_method" title="Open3.popen2 (method)">.popen2</a>: Makes the standard input and standard output streams of the child process available as separate streams, with no access to the standard error stream.</p>
</li><li>
<p><a href="#popen3-class_method" title="Open3.popen3 (method)">.popen3</a>: Makes the standard input, standard output, and standard error streams of the child process available as separate streams.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L508-L530'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='508' data-end='530'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 508</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_popen2e'>popen2e</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_err'>err</span>]] <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_popen_run'><a href="#popen_run-class_method" title="Open3.popen_run (method)">popen_run</a></span>(<span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> [<span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span>]<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>ensure</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
    <span class='id identifier rubyid_in_r'>in_r</span>.<span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_in_w'>in_w</span>.<span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_out_r'>out_r</span>.<span class='id identifier rubyid_close'>close</span>
    <span class='id identifier rubyid_out_w'>out_w</span>.<span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="popen3-class_method">
  <h3 class='signature private'>
    <div class='inline-block'>
      <span class='overload'>.<strong>popen3</strong>([env, ] command_line, options = {})  &#x21d2; <code>Array</code>, ...  <span class="extras">(<span class='mod_func'>mod_func</span>)</span></span>
      <span class='overload'>.<strong>popen3</strong>([env, ] exe_path, *args, options = {})  &#x21d2; <code>Array</code>, ... </span>
      <span class='overload'>.<strong>popen3</strong>([env, ] command_line, options =)  &#x21d2; <code>Object</code> </span>
      <span class='overload'>.<strong>popen3</strong>([env, ] exe_path, *args, options =)  &#x21d2; <code>Object</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Basically a wrapper for <code>{Process.spawn</code>} that:</p>
<ul><li>
<p>Creates a child process, by calling <code>Process.spawn</code> with the given arguments.</p>
</li><li>
<p>Creates streams <code>stdin</code>, <code>stdout</code>, and <code>stderr</code>, which are the standard input, standard output, and standard error streams in the child process.</p>
</li><li>
<p>Creates thread <code>wait_thread</code> that waits for the child process to exit; the thread has method <code>pid</code>, which returns the process ID of the child process.</p>
</li></ul>

<p>With no block given, returns the array <code>[stdin, stdout, stderr, wait_thread]</code>. The caller should close each of the three returned streams.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_stderr'>stderr</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span> <span class='op'>=</span> <span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; [#&lt;IO:fd 8&gt;, #&lt;IO:fd 10&gt;, #&lt;IO:fd 12&gt;, #&lt;Process::Waiter:0x00007f58d5428f58 run&gt;]
</span><span class='id identifier rubyid_stdin'>stdin</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_stdout'>stdout</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_stderr'>stderr</span>.<span class='id identifier rubyid_close'>close</span>
<span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_pid'>pid</span>   <span class='comment'># =&gt; 2210481
</span><span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'># =&gt; #&lt;Process::Status: pid 2210481 exit 0&gt;</span></code></pre>

<p>With a block given, calls the block with the four variables (three streams and the wait thread) and returns the block’s return value. The caller need not close the streams:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stdin'>stdin</span><span class='comma'>,</span> <span class='id identifier rubyid_stdout'>stdout</span><span class='comma'>,</span> <span class='id identifier rubyid_stderr'>stderr</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span><span class='op'>|</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdin'>stdin</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stdout'>stdout</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_stderr'>stderr</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_pid'>pid</span>
  <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_wait_thread'>wait_thread</span>.<span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;IO:fd 6&gt;
</span><span class='comment'>#&lt;IO:fd 7&gt;
</span><span class='comment'>#&lt;IO:fd 9&gt;
</span><span class='comment'>#&lt;Process::Waiter:0x00007f58d53606e8 sleep&gt;
</span><span class='int'>2211047</span>
<span class='comment'>#&lt;Process::Status: pid 2211047 exit 0&gt;</span></code></pre>

<p>Like <code>Process.spawn</code>, this method has potential security vulnerabilities if called with untrusted input; see <code>Command Injection</code>.</p>

<p>Unlike <code>Process.spawn</code>, this method waits for the child process to exit before returning, so the caller need not do so.</p>

<p>If the first argument is a hash, it becomes leading argument <code>env</code> in the call to <code>Process.spawn;</code> see <code>Execution Environment</code>.</p>

<p>If the last argument is a hash, it becomes trailing argument <code>options</code> in the call to <code>Process.spawn;</code> see <code>Execution Options</code>.</p>

<p>The single required argument is one of the following:</p>
<ul><li>
<p><code>command_line</code> if it is a string, and if it begins with a shell reserved word or special built-in, or if it contains one or more metacharacters.</p>
</li><li>
<p><code>exe_path</code> otherwise.</p>
</li></ul>

<p><strong>Argument <code>command_line</code></strong></p>

<p>String argument <code>command_line</code> is a command line to be passed to a shell; it must begin with a shell reserved word, begin with a special built-in, or contain meta characters:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>if true; then echo &quot;Foo&quot;; fi</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> } <span class='comment'># Shell reserved word.
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> }                         <span class='comment'># Built-in.
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date &gt; date.tmp</span><span class='tstring_end'>&#39;</span></span>) {<span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span> <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_args'>args</span> }              <span class='comment'># Contains meta character.</span></code></pre>

<p>Output (similar for each call above):</p>

<pre class="code ruby"><code class="ruby">[<span class='comment'>#&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;IO:(closed)&gt;, #&lt;Process::Waiter:0x00007f58d52f28c8 dead&gt;]</span></code></pre>

<p>The command line may also contain arguments and options for the command:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo &quot;Foo&quot;</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Foo\n</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><strong>Argument <code>exe_path</code></strong></p>

<p>Argument <code>exe_path</code> is one of the following:</p>
<ul><li>
<p>The string path to an executable to be called.</p>
</li><li>
<p>A 2-element array containing the path to an executable and the string to be used as the name of the executing process.</p>
</li></ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/usr/bin/date</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;Wed Sep 27 02:56:44 PM CDT 2023\n&quot;</span></code></pre>

<p>Ruby invokes the executable directly, with no shell and no shell expansion:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>doesnt_exist</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> } <span class='comment'># Raises Errno::ENOENT</span></code></pre>

<p>If one or more <code>args</code> is given, each is an argument or option to be passed to the executable:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C #</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;C #\n&quot;
</span><span class='const'>Open3</span>.<span class='id identifier rubyid_popen3'>popen3</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>echo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_o'>o</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_o'>o</span>.<span class='id identifier rubyid_gets'>gets</span> }
<span class='comment'># =&gt; &quot;hello world\n&quot;</span></code></pre>

<p>Take care to avoid deadlocks. Output streams <code>stdout</code> and <code>stderr</code> have fixed-size buffers, so reading extensively from one but not the other can cause a deadlock when the unread buffer fills. To avoid that, <code>stdout</code> and <code>stderr</code> should be read simultaneously (using threads or <code>IO.select</code>).</p>

<p>Related:</p>
<ul><li>
<p><a href="#popen2-class_method" title="Open3.popen2 (method)">.popen2</a>: Makes the standard input and standard output streams of the child process available as separate streams, with no access to the standard error stream.</p>
</li><li>
<p><a href="#popen2e-class_method" title="Open3.popen2e (method)">.popen2e</a>: Makes the standard input and the merge of the standard output and standard error streams of the child process available as separate streams.</p>
</li></ul>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L218-L236'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='218' data-end='236'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 218</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_popen3'>popen3</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_cmd'>cmd</span>.<span class='id identifier rubyid_pop'>pop</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> {}
  <span class='kw'>end</span>

  <span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='kw'>in</span>] <span class='op'>=</span> <span class='id identifier rubyid_in_r'>in_r</span>
  <span class='id identifier rubyid_in_w'>in_w</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_out'>out</span>] <span class='op'>=</span> <span class='id identifier rubyid_out_w'>out_w</span>

  <span class='id identifier rubyid_err_r'>err_r</span><span class='comma'>,</span> <span class='id identifier rubyid_err_w'>err_w</span> <span class='op'>=</span> <span class='const'>IO</span>.<span class='id identifier rubyid_pipe'>pipe</span>
  <span class='id identifier rubyid_opts'>opts</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_err'>err</span>] <span class='op'>=</span> <span class='id identifier rubyid_err_w'>err_w</span>

  <span class='id identifier rubyid_popen_run'><a href="#popen_run-class_method" title="Open3.popen_run (method)">popen_run</a></span>(<span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> [<span class='id identifier rubyid_in_r'>in_r</span><span class='comma'>,</span> <span class='id identifier rubyid_out_w'>out_w</span><span class='comma'>,</span> <span class='id identifier rubyid_err_w'>err_w</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_in_w'>in_w</span><span class='comma'>,</span> <span class='id identifier rubyid_out_r'>out_r</span><span class='comma'>,</span> <span class='id identifier rubyid_err_r'>err_r</span>]<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="popen_run-class_method">
  <h3 class='signature private nodoc'>
    .<strong>popen_run</strong>(cmd, opts, child_io, parent_io)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_1/lib/open3.rb#L533-L547'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='533' data-end='547'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/open3.rb', line 533</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_popen_run'>popen_run</span>(<span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='id identifier rubyid_child_io'>child_io</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_io'>parent_io</span>) <span class='comment'># :nodoc:
</span>  <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_spawn'>spawn</span>(<span class='op'>*</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span>)
  <span class='id identifier rubyid_wait_thr'>wait_thr</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_detach'>detach</span>(<span class='id identifier rubyid_pid'>pid</span>)
  <span class='id identifier rubyid_child_io'>child_io</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>)
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> [<span class='op'>*</span><span class='id identifier rubyid_parent_io'>parent_io</span><span class='comma'>,</span> <span class='id identifier rubyid_wait_thr'>wait_thr</span>]
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>yield</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='kw'>yield</span>(<span class='op'>*</span><span class='id identifier rubyid_result'>result</span>)
    <span class='kw'>ensure</span>
      <span class='id identifier rubyid_parent_io'>parent_io</span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>)
      <span class='id identifier rubyid_wait_thr'>wait_thr</span>.<span class='id identifier rubyid_join'>join</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>