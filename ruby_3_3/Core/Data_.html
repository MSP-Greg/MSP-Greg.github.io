<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Data &mdash; Core  Ruby-3.3.9 p170</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Data",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.3.9</a> &raquo; 
      <a href='.'>Core</a> &raquo; 
      <a href='_index.html#alpha_D'>Index (D)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Data&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Data</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2214'>struct.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L1623'>struct.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Class Data provides a convenient way to define simple classes for value-alike objects.</p>

<p>The simplest example of usage:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>)

<span class='comment'># Positional arguments constructor is provided
</span><span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='const'>Measure</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Data.new (method)">new</a></span>(<span class='int'>100</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; #&lt;data Measure amount=100, unit=&quot;km&quot;&gt;
</span>
<span class='comment'># Keyword arguments constructor is provided
</span><span class='id identifier rubyid_weight'>weight</span> <span class='op'>=</span> <span class='const'>Measure</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Data.new (method)">new</a></span>(<span class='label'>amount:</span> <span class='int'>50</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>kg</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; #&lt;data Measure amount=50, unit=&quot;kg&quot;&gt;
</span>
<span class='comment'># Alternative form to construct an object:
</span><span class='id identifier rubyid_speed'>speed</span> <span class='op'>=</span> <span class='const'>Measure</span>[<span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mPh</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'>#=&gt; #&lt;data Measure amount=10, unit=&quot;mPh&quot;&gt;
</span>
<span class='comment'># Works with keyword arguments, too:
</span><span class='id identifier rubyid_area'>area</span> <span class='op'>=</span> <span class='const'>Measure</span>[<span class='label'>amount:</span> <span class='float'>1.5</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m^2</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'>#=&gt; #&lt;data Measure amount=1.5, unit=&quot;m^2&quot;&gt;
</span>
<span class='comment'># Argument accessors are provided:
</span><span class='id identifier rubyid_distance'>distance</span>.<span class='id identifier rubyid_amount'>amount</span> <span class='comment'>#=&gt; 100
</span><span class='id identifier rubyid_distance'>distance</span>.<span class='id identifier rubyid_unit'>unit</span> <span class='comment'>#=&gt; &quot;km&quot;</span></code></pre>

<p>Constructed object also has a reasonable definitions of <a href="#==-instance_method" title="Data#== (method)">#==</a> operator, <a href="#to_h-instance_method" title="Data#to_h (method)">#to_h</a> hash conversion, and <a href="#deconstruct-instance_method" title="Data#deconstruct (method)">#deconstruct</a> / <a href="#deconstruct_keys-instance_method" title="Data#deconstruct_keys (method)">#deconstruct_keys</a> to be used in pattern matching.</p>

<p><a href="#define-class_method" title="Data.define (method)">.define</a> method accepts an optional block and evaluates it in the context of the newly defined class. That allows to define additional methods:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>) <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='op'>&lt;=&gt;</span>(<span class='id identifier rubyid_other'>other</span>)
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_unit'>unit</span> <span class='op'>==</span> <span class='id identifier rubyid_unit'>unit</span>
    <span class='id identifier rubyid_amount'>amount</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_amount'>amount</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_include'>include</span> <span class='const'><a href="Comparable.html" title="Comparable (module)">Comparable</a></span>
<span class='kw'>end</span>

<span class='const'>Measure</span>[<span class='int'>3</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>&lt;</span> <span class='const'>Measure</span>[<span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m</span><span class='tstring_end'>&#39;</span></span>] <span class='comment'>#=&gt; true
</span><span class='const'>Measure</span>[<span class='int'>3</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>&lt;</span> <span class='const'>Measure</span>[<span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>kg</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'># comparison of Measure with Measure failed (ArgumentError)</span></code></pre>

<p><code>Data</code> provides no member writers, or enumerators: it is meant to be a storage for immutable atomic values. But note that if some of data members is of a mutable class, <code>Data</code> does no additional immutability enforcement:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Event</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_time'>time</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_weekdays'>weekdays</span>)
<span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='const'>Event</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Data.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>18:00</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>Tue</span><span class='words_sep'> </span><span class='tstring_content'>Wed</span><span class='words_sep'> </span><span class='tstring_content'>Fri</span><span class='tstring_end'>]</span></span>)
<span class='comment'>#=&gt; #&lt;data Event time=&quot;18:00&quot;, weekdays=[&quot;Tue&quot;, &quot;Wed&quot;, &quot;Fri&quot;]&gt;
</span>
<span class='comment'># There is no #time= or #weekdays= accessors, but changes are
</span><span class='comment'># still possible:
</span><span class='id identifier rubyid_event'>event</span>.<span class='id identifier rubyid_weekdays'>weekdays</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sat</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_event'>event</span>
<span class='comment'>#=&gt; #&lt;data Event time=&quot;18:00&quot;, weekdays=[&quot;Tue&quot;, &quot;Wed&quot;, &quot;Fri&quot;, &quot;Sat&quot;]&gt;</span></code></pre>

<p>See also <a href="Struct.html" title="Struct (class)"><code>::Struct</code></a>, which is a similar concept, but has more container-alike API, allowing to change contents of the object and enumerate it.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#define-class_method" title="define (class method)">.<strong>define</strong>(*symbols)  &#x21d2; class </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Defines a new Data class.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#members-class_method" title=".members (class method)">.<strong>members</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(*args)  &#x21d2; instance </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Constructors for classes defined with <a href="#define-class_method" title="Data.define (method)">.define</a> accept both positional and keyword arguments.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#deconstruct-instance_method" title="#deconstruct (instance method)">#<strong>deconstruct</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#deconstruct_keys-instance_method" title="#deconstruct_keys (instance method)">#<strong>deconstruct_keys</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#eql%3F-instance_method" title="#eql? (instance method)">#<strong>eql?</strong>  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#hash-instance_method" title="#hash (instance method)">#<strong>hash</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#to_s-instance_method" title="Data#to_s (method)">#to_s</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#members-instance_method" title="#members (instance method)">#<strong>members</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_h-instance_method" title="#to_h (instance method)">#<strong>to_h</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; String </a>
      (also: #inspect)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a string representation of <code>self</code>:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#with-instance_method" title="#with (instance method)">#<strong>with</strong>(**kwargs)  &#x21d2; instance </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a shallow copy of <code>self</code> — the instance variables of <code>self</code> are copied, but not the objects they reference.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#initialize_copy-instance_method" title="#initialize_copy (instance method)">#<strong>initialize_copy</strong>(s)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>new</strong>(*args)  &#x21d2; <code>instance</code> </span>
      <span class='overload'>.<strong>new</strong>(**kwargs)  &#x21d2; <code>instance</code> </span>
      <span class='overload'>.<strong>[]</strong>(*args)  &#x21d2; <code>instance</code> </span>
      <span class='overload'>.<strong>[]</strong>(**kwargs)  &#x21d2; <code>instance</code> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Constructors for classes defined with <a href="#define-class_method" title="Data.define (method)">.define</a> accept both positional and keyword arguments.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>)

<span class='const'>Measure</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; #&lt;data Measure amount=1, unit=&quot;km&quot;&gt;
</span><span class='const'>Measure</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>amount:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; #&lt;data Measure amount=1, unit=&quot;km&quot;&gt;
</span>
<span class='comment'># Alternative shorter initialization with []
</span><span class='const'>Measure</span>[<span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'>#=&gt; #&lt;data Measure amount=1, unit=&quot;km&quot;&gt;
</span><span class='const'>Measure</span>[<span class='label'>amount:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'>#=&gt; #&lt;data Measure amount=1, unit=&quot;km&quot;&gt;</span></code></pre>

<p>All arguments are mandatory (unlike <a href="Struct.html" title="Struct (class)"><code>::Struct</code></a>), and converted to keyword arguments:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Measure</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>amount:</span> <span class='int'>1</span>)
<span class='comment'># in `initialize&#39;: missing keyword: :unit (ArgumentError)
</span>
<span class='const'>Measure</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>1</span>)
<span class='comment'># in `initialize&#39;: missing keyword: :unit (ArgumentError)</span></code></pre>

<p>Note that <code>Measure#initialize</code> always receives keyword arguments, and that mandatory arguments are checked in <code>initialize</code>, not in <code>new</code>. This can be important for redefining initialize in order to convert arguments or provide defaults:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>) <span class='kw'>do</span>
  <span class='const'>NONE</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='label'>amount:</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='const'>NONE</span>.<span class='id identifier rubyid_new'>new</span>)
    <span class='kw'>super</span>(<span class='label'>amount:</span> <span class='const'><a href="Float.html" title="Float (class)">Float</a></span>(<span class='id identifier rubyid_amount'>amount</span>)<span class='comma'>,</span> <span class='label'>unit:</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>Measure</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>10</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>) <span class='comment'># =&gt; #&lt;data Measure amount=10.0, unit=&quot;km&quot;&gt;
</span><span class='const'>Measure</span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>10_000</span>)     <span class='comment'># =&gt; #&lt;data Measure amount=10000.0, unit=#&lt;data NONE&gt;&gt;</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L1776-L1811'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1776' data-end='1811'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'struct.c', line 1776</span></pre>
<pre class='code cpp'>

static VALUE
rb_data_initialize_m(int argc, const VALUE *argv, VALUE self)
{
    VALUE klass = rb_obj_class(self);
    rb_struct_modify(self);
    VALUE members = struct_ivar_get(klass, id_members);
    size_t num_members = RARRAY_LEN(members);

    if (argc == 0) {
        if (num_members &gt; 0) {
            rb_exc_raise(rb_keyword_error_new(&quot;missing&quot;, members));
        }
        return Qnil;
    }
    if (argc &gt; 1 || !RB_TYPE_P(argv[0], T_HASH)) {
        rb_error_arity(argc, 0, 0);
    }

    if (RHASH_SIZE(argv[0]) &lt; num_members) {
        VALUE missing = rb_ary_diff(members, rb_hash_keys(argv[0]));
        rb_exc_raise(rb_keyword_error_new(&quot;missing&quot;, missing));
    }

    struct struct_hash_set_arg arg;
    rb_mem_clear((VALUE *)RSTRUCT_CONST_PTR(self), num_members);
    arg.self = self;
    arg.unknown_keywords = Qnil;
    rb_hash_foreach(argv[0], struct_hash_set_i, (VALUE)&amp;arg);
    // Freeze early before potentially raising, so that we don&#39;t leave an
    // unfrozen copy on the heap, which could get exposed via ObjectSpace.
    OBJ_FREEZE_RAW(self);
    if (arg.unknown_keywords != Qnil) {
        rb_exc_raise(rb_keyword_error_new(&quot;unknown&quot;, arg.unknown_keywords));
    }
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="define-class_method">
  <h3 class='signature  first'>
    .<strong>define</strong>(*symbols)  &#x21d2; <code>class</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Defines a new Data class.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_measure'>measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>)
<span class='comment'>#=&gt; #&lt;Class:0x00007f70c6868498&gt;
</span><span class='id identifier rubyid_measure'>measure</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Data.new (method)">new</a></span>(<span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; #&lt;data amount=1, unit=&quot;km&quot;&gt;
</span>
<span class='comment'># It you store the new class in the constant, it will
</span><span class='comment'># affect #inspect and will be more natural to use:
</span><span class='const'>Measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>)
<span class='comment'>#=&gt; Measure
</span><span class='const'>Measure</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Data.new (method)">new</a></span>(<span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; #&lt;data Measure amount=1, unit=&quot;km&quot;&gt;</span></code></pre>

<p>Note that member-less Data is acceptable and might be a useful technique for defining several homogenous data classes, like</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>HTTPFetcher</span>
  <span class='const'>Response</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_body'>body</span>)
  <span class='const'>NotFound</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>
  <span class='comment'># ... implementation
</span><span class='kw'>end</span></code></pre>

<p>Now, different kinds of responses from <code>HTTPFetcher</code> would have consistent representation:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#&lt;data HTTPFetcher::Response body=&quot;&lt;html...&quot;&gt;
</span><span class='comment'>#&lt;data HTTPFetcher::NotFound&gt;</span></code></pre>

<p>And are convenient to use in pattern matching:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>case</span> <span class='id identifier rubyid_fetcher'>fetcher</span>.<span class='id identifier rubyid_get'>get</span>(<span class='id identifier rubyid_url'>url</span>)
<span class='kw'>in</span> <span class='const'>HTTPFetcher</span><span class='op'>::</span><span class='const'>Response</span>(<span class='id identifier rubyid_body'>body</span>)
  <span class='comment'># process body variable
</span><span class='kw'>in</span> <span class='const'>HTTPFetcher</span><span class='op'>::</span><span class='const'>NotFound</span>
  <span class='comment'># handle not found case
</span><span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L1668-L1697'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1668' data-end='1697'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'struct.c', line 1668</span></pre>
<pre class='code cpp'>

static VALUE
rb_data_s_def(int argc, VALUE *argv, VALUE klass)
{
    VALUE rest;
    long i;
    VALUE data_class;

    rest = rb_ident_hash_new();
    RBASIC_CLEAR_CLASS(rest);
    for (i=0; i&lt;argc; i++) {
        VALUE mem = rb_to_symbol(argv[i]);
        if (rb_is_attrset_sym(mem)) {
            rb_raise(rb_eArgError, &quot;invalid data member: %&quot;PRIsVALUE, mem);
        }
        if (RTEST(rb_hash_has_key(rest, mem))) {
            rb_raise(rb_eArgError, &quot;duplicate member: %&quot;PRIsVALUE, mem);
        }
        rb_hash_aset(rest, mem, Qtrue);
    }
    rest = rb_hash_keys(rest);
    RBASIC_CLEAR_CLASS(rest);
    OBJ_FREEZE_RAW(rest);
    data_class = anonymous_struct(klass);
    setup_data(data_class, rest);
    if (rb_block_given_p()) {
        rb_mod_module_eval(0, 0, data_class);
    }

    return data_class;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="members-class_method">
  <h3 class='signature '>
    .<strong>members</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2221'>GitHub</a> ]</span>

</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="==-instance_method">
  <h3 class='signature  first'>
    #<strong>==</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2227'>GitHub</a> ]</span>

</section>

<section class='method_details' id="deconstruct-instance_method">
  <h3 class='signature '>
    #<strong>deconstruct</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2237'>GitHub</a> ]</span>

</section>

<section class='method_details' id="deconstruct_keys-instance_method">
  <h3 class='signature '>
    #<strong>deconstruct_keys</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2238'>GitHub</a> ]</span>

</section>

<section class='method_details' id="eql?-instance_method">
  <h3 class='signature '>
    #<strong>eql?</strong>  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2228'>GitHub</a> ]</span>

</section>

<section class='method_details' id="hash-instance_method">
  <h3 class='signature '>
    #<strong>hash</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2229'>GitHub</a> ]</span>

</section>

<section class='method_details' id="initialize_copy-instance_method">
  <h3 class='signature nodoc'>
    #<strong>initialize_copy</strong>(s)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L1814-L1820'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1814' data-end='1820'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'struct.c', line 1814</span></pre>
<pre class='code cpp'>

static VALUE
rb_data_init_copy(VALUE copy, VALUE s)
{
    copy = rb_struct_init_copy(copy, s);
    RB_OBJ_FREEZE_RAW(copy);
    return copy;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>inspect</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a> </span>
      <span class='overload'>#<strong>to_s</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#to_s-instance_method" title="Data#to_s (method)">#to_s</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>

</section>

<section class='method_details' id="members-instance_method">
  <h3 class='signature '>
    #<strong>members</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2235'>GitHub</a> ]</span>

</section>

<section class='method_details' id="to_h-instance_method">
  <h3 class='signature '>
    #<strong>to_h</strong>  
  </h3>
  <span class='link_repo'>[ <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L2233'>GitHub</a> ]</span>

</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>inspect</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a> </span>
      <span class='overload'>#<strong>to_s</strong>  &#x21d2; <a href="String.html" title="String (class)">String</a> </span>
    </div>
    <span class='aliases'>Also known as: <span class='names'>#inspect</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a string representation of <code>self</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Measure</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unit'>unit</span>)

<span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='const'>Measure</span>[<span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>km</span><span class='tstring_end'>&#39;</span></span>]

<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_distance'>distance</span>  <span class='comment'># uses #inspect underneath
</span><span class='comment'>#&lt;data Measure amount=10, unit=&quot;km&quot;&gt;
</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_distance'>distance</span>  <span class='comment'># uses #to_s underneath, same representation
</span><span class='comment'>#&lt;data Measure amount=10, unit=&quot;km&quot;&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L1885-L1889'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1885' data-end='1889'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'struct.c', line 1885</span></pre>
<pre class='code cpp'>

static VALUE
rb_data_inspect(VALUE s)
{
    return rb_exec_recursive(inspect_struct, s, rb_str_new2(&quot;#&lt;data &quot;));
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="with-instance_method">
  <h3 class='signature '>
    #<strong>with</strong>(**kwargs)  &#x21d2; <code>instance</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a shallow copy of <code>self</code> — the instance variables of <code>self</code> are copied, but not the objects they reference.</p>

<p>If the method is supplied any keyword arguments, the copy will be created with the respective field values updated to use the supplied keyword argument values. Note that it is an error to supply a keyword that the <code>Data</code> class does not have as a member.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Point</span> <span class='op'>=</span> <span class='const'>Data</span>.<span class='id identifier rubyid_define'><a href="#define-class_method" title="Data.define (method)">define</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_y'>y</span>)

<span class='id identifier rubyid_origin'>origin</span> <span class='op'>=</span> <span class='const'>Point</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Data.new (method)">new</a></span>(<span class='label'>x:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>y:</span> <span class='int'>0</span>)

<span class='id identifier rubyid_up'>up</span> <span class='op'>=</span> <span class='id identifier rubyid_origin'>origin</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>x:</span> <span class='int'>1</span>)
<span class='id identifier rubyid_right'>right</span> <span class='op'>=</span> <span class='id identifier rubyid_origin'>origin</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>y:</span> <span class='int'>1</span>)
<span class='id identifier rubyid_up_and_right'>up_and_right</span> <span class='op'>=</span> <span class='id identifier rubyid_up'>up</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>y:</span> <span class='int'>1</span>)

<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_origin'>origin</span>       <span class='comment'># #&lt;data Point x=0, y=0&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_up'>up</span>           <span class='comment'># #&lt;data Point x=1, y=0&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_right'>right</span>        <span class='comment'># #&lt;data Point x=0, y=1&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_up_and_right'>up_and_right</span> <span class='comment'># #&lt;data Point x=1, y=1&gt;
</span>
<span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='id identifier rubyid_origin'>origin</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>z:</span> <span class='int'>1</span>) <span class='comment'># ArgumentError: unknown keyword: :z
</span><span class='id identifier rubyid_some_point'>some_point</span> <span class='op'>=</span> <span class='id identifier rubyid_origin'>origin</span>.<span class='id identifier rubyid_with'>with</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span>) <span class='comment'># ArgumentError: expected keyword arguments, got positional arguments</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_9/struct.c#L1852-L1864'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1852' data-end='1864'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'struct.c', line 1852</span></pre>
<pre class='code cpp'>

static VALUE
rb_data_with(int argc, const VALUE *argv, VALUE self)
{
    VALUE kwargs;
    rb_scan_args(argc, argv, &quot;0:&quot;, &amp;kwargs);
    if (NIL_P(kwargs)) {
        return self;
    }

    VALUE h = rb_struct_to_h(self);
    rb_hash_update_by(h, kwargs, 0);
    return rb_class_new_instance_kw(1, &amp;h, rb_obj_class(self), TRUE);
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>