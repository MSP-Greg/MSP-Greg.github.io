<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ObjectSpace::WeakKeyMap &mdash; Core Ruby-3.3.0 pp0</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ObjectSpace::WeakKeyMap",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.3.0</a> &raquo; 
      <a href='../'>Core</a> &raquo; 
      <a href='../_index.html#alpha_W'>Index (W)</a> &raquo; 
        <a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>WeakKeyMap&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ObjectSpace::WeakKeyMap</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L1104'>weakmap.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L1079'>weakmap.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>An <code>WeakKeyMap</code> is a key-value map that holds weak references to its keys, so they can be garbage collected when there is no more references.</p>

<p>Unlike <a href="WeakMap.html" title="ObjectSpace::WeakMap (class)"><code>WeakMap</code></a>:</p>
<ul><li>
<p>references to values are <em>strong</em>, so they aren’t garbage collected while they are in the map;</p>
</li><li>
<p>keys are compared by value (using <a href="../Object.html#eql%3F-instance_method" title="Object#eql? (method)">Object#eql?</a>), not by identity;</p>
</li><li>
<p>only garbage-collectable objects can be used as keys.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_map'>map</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>.<span class='id identifier rubyid_new'><a href="../BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>
<span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'><a href="../Time.html#new-class_method" title="Time.new (method)">new</a></span>(<span class='int'>2023</span><span class='comma'>,</span> <span class='int'>12</span><span class='comma'>,</span> <span class='int'>7</span>)
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_map'>map</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span>

<span class='comment'># Value is fetched by equality: the instance of string &quot;name&quot; is
</span><span class='comment'># different here, but it is equal to the key
</span><span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>] <span class='comment'>#=&gt; 2023-12-07 00:00:00 +0200
</span>
<span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='const'><a href="../GC.html" title="GC (module)">GC</a></span>.<span class='id identifier rubyid_start'><a href="../GC.html#start-class_method" title="GC.start (method)">start</a></span>
<span class='comment'># There is no more references to `val`, yet the pair isn&#39;t
</span><span class='comment'># garbage-collected.
</span><span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>] <span class='comment'>#=&gt; 2023-12-07 00:00:00 +0200
</span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='const'><a href="../GC.html" title="GC (module)">GC</a></span>.<span class='id identifier rubyid_start'><a href="../GC.html#start-class_method" title="GC.start (method)">start</a></span>
<span class='comment'># There is no more references to `key`, key and value are
</span><span class='comment'># garbage-collected.
</span><span class='id identifier rubyid_map'>map</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span>] <span class='comment'>#=&gt; nil</span></code></pre>
</li></ul>

<p>(Note that <a href="../GC.html#start-class_method" title="GC.start (method)">GC.start</a> is used here only for demonstrational purposes and might not always lead to demonstrated results.)</p>

<p>The collection is especially useful for implementing caches of lightweight value objects, so that only one copy of each value representation would be stored in memory, but the copies that aren’t used would be garbage-collected.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>CACHE</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>

<span class='kw'>def</span> <span class='id identifier rubyid_make_value'>make_value</span>(<span class='op'>**</span>)
   <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='const'>ValueObject</span>.<span class='id identifier rubyid_new'>new</span>(<span class='op'>**</span>)
   <span class='kw'>if</span> (<span class='id identifier rubyid_existing'>existing</span> <span class='op'>=</span> <span class='ivar'>@cache</span>.<span class='id identifier rubyid_getkey'><a href="#getkey-instance_method" title="ObjectSpace::WeakKeyMap#getkey (method)">getkey</a></span>(<span class='id identifier rubyid_val'>val</span>))
      <span class='comment'># if the object with this value exists, we return it
</span>      <span class='id identifier rubyid_existing'>existing</span>
   <span class='kw'>else</span>
      <span class='comment'># otherwise, put it in the cache
</span>      <span class='ivar'>@cache</span>[<span class='id identifier rubyid_val'>val</span>] <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_val'>val</span>
   <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>This will result in <code>make_value</code> returning the same object for same set of attributes always, but the values that aren’t needed anymore woudn’t be sitting in the cache forever.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(key)  &#x21d2; value </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the value associated with the given <code>key</code> if found.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(key, value)  &#x21d2; value </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Associates the given <code>value</code> with the given <code>key</code></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#clear-instance_method" title="#clear (instance method)">#<strong>clear</strong>  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Removes all map entries; returns <code>self</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(key)  &#x21d2; value<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the entry for the given <code>key</code> and returns its associated value.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#getkey-instance_method" title="#getkey (instance method)">#<strong>getkey</strong>(key)  &#x21d2; existing_key<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the existing equal key if it exists, otherwise returns <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a new <a href="../String.html" title="String (class)"><code>::String</code></a> containing informations about the map:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#key%3F-instance_method" title="#key? (instance method)">#<strong>key?</strong>(key)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if <code>key</code> is a key in <code>self</code>, otherwise <code>false</code>.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
    #<strong>[]</strong>(key)  &#x21d2; <code>value</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the value associated with the given <code>key</code> if found.</p>

<p>If <code>key</code> is not found, returns <code>nil</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L771-L776'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='771' data-end='776'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 771</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_aref(VALUE self, VALUE key)
{
    VALUE obj = wkmap_lookup(self, key);
    return obj != Qundef ? obj : Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-instance_method">
  <h3 class='signature '>
    #<strong>[]=</strong>(key, value)  &#x21d2; <code>value</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Associates the given <code>value</code> with the given <code>key</code></p>

<p>The reference to <code>key</code> is weak, so when there is no other reference to <code>key</code> it may be garbage collected.</p>

<p>If the given <code>key</code> exists, replaces its value with the given <code>value</code>; the ordering is not affected</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L810-L832'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='810' data-end='832'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 810</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_aset(VALUE self, VALUE key, VALUE val)
{
    struct weakkeymap *w;
    TypedData_Get_Struct(self, struct weakkeymap, &amp;weakkeymap_type, w);

    if (!FL_ABLE(key) || SYMBOL_P(key) || RB_BIGNUM_TYPE_P(key) || RB_TYPE_P(key, T_FLOAT)) {
        rb_raise(rb_eArgError, &quot;WeakKeyMap must be garbage collectable&quot;);
        UNREACHABLE_RETURN(Qnil);
    }

    struct wkmap_aset_args args = {
        .new_key = key,
        .new_val = val,
    };

    st_update(w-&gt;table, (st_data_t)&amp;key, wkmap_aset_replace, (st_data_t)&amp;args);

    RB_OBJ_WRITTEN(self, Qundef, key);
    RB_OBJ_WRITTEN(self, Qundef, val);

    return val;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="clear-instance_method">
  <h3 class='signature '>
    #<strong>clear</strong>  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Removes all map entries; returns <code>self</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L939-L949'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='939' data-end='949'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 939</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_clear(VALUE self)
{
    struct weakkeymap *w;
    TypedData_Get_Struct(self, struct weakkeymap, &amp;weakkeymap_type, w);

    st_foreach(w-&gt;table, wkmap_free_table_i, 0);
    st_clear(w-&gt;table);

    return self;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>delete</strong>(key)  &#x21d2; <code>value</code><sup>?</sup> </span>
      <span class='overload'>#<strong>delete</strong>(key) {|key| ... } &#x21d2; <a href="../Object.html" title="Object (class)">Object</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the entry for the given <code>key</code> and returns its associated value.</p>

<p>If no block is given and <code>key</code> is found, deletes the entry and returns the associated value:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>.<span class='id identifier rubyid_new'><a href="../BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># to hold reference to the key
</span><span class='id identifier rubyid_m'>m</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_m'>m</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; 1
</span><span class='id identifier rubyid_m'>m</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>] <span class='comment'># =&gt; nil</span></code></pre>

<p>If no block given and <code>key</code> is not found, returns <code>nil</code>.</p>

<p>If a block is given and <code>key</code> is found, ignores the block, deletes the entry, and returns the associated value:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>.<span class='id identifier rubyid_new'><a href="../BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>
<span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># to hold reference to the key
</span><span class='id identifier rubyid_m'>m</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='int'>2</span>
<span class='id identifier rubyid_m'>m</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Will never happen</span><span class='tstring_end'>&#39;</span></span>} <span class='comment'># =&gt; 2</span></code></pre>

<p>If a block is given and <code>key</code> is not found, yields the <code>key</code> to the block and returns the block’s return value:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>.<span class='id identifier rubyid_new'><a href="../BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>
<span class='id identifier rubyid_m'>m</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nosuch</span><span class='tstring_end'>&quot;</span></span>) { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Key </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> not found</span><span class='tstring_end'>&quot;</span></span> } <span class='comment'># =&gt; &quot;Key nosuch not found&quot;</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L863-L888'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='863' data-end='888'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 863</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_delete(VALUE self, VALUE key)
{
    struct weakkeymap *w;
    TypedData_Get_Struct(self, struct weakkeymap, &amp;weakkeymap_type, w);

    VALUE orig_key = key;
    st_data_t orig_key_data = (st_data_t)&amp;orig_key;
    st_data_t orig_val_data;
    if (st_delete(w-&gt;table, &amp;orig_key_data, &amp;orig_val_data)) {
        VALUE orig_val = (VALUE)orig_val_data;

        rb_gc_remove_weak(self, (VALUE *)orig_key_data);

        ruby_sized_xfree((VALUE *)orig_key_data, sizeof(VALUE));

        return orig_val;
    }

    if (rb_block_given_p()) {
        return rb_yield(key);
    }
    else {
        return Qnil;
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getkey-instance_method">
  <h3 class='signature '>
    #<strong>getkey</strong>(key)  &#x21d2; <code>existing_key</code><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the existing equal key if it exists, otherwise returns <code>nil</code>.</p>

<p>This might be useful for implementing caches, so that only one copy of some object would be used everywhere in the program:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> {<span class='label'>amount:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>currency:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>USD</span><span class='tstring_end'>&#39;</span></span>}

<span class='comment'># Now if we put this object in a cache:
</span><span class='id identifier rubyid_cache'>cache</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>.<span class='id identifier rubyid_new'><a href="../BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>
<span class='id identifier rubyid_cache'>cache</span>[<span class='id identifier rubyid_value'>value</span>] <span class='op'>=</span> <span class='kw'>true</span>

<span class='comment'># ...we can always extract from there and use the same object:
</span><span class='id identifier rubyid_copy'>copy</span> <span class='op'>=</span> <span class='id identifier rubyid_cache'>cache</span>.<span class='id identifier rubyid_getkey'>getkey</span>({<span class='label'>amount:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>currency:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>USD</span><span class='tstring_end'>&#39;</span></span>})
<span class='id identifier rubyid_copy'>copy</span>.<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_object_id'>object_id</span> <span class='comment'>#=&gt; true</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L909-L919'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='909' data-end='919'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 909</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_getkey(VALUE self, VALUE key)
{
    struct weakkeymap *w;
    TypedData_Get_Struct(self, struct weakkeymap, &amp;weakkeymap_type, w);

    st_data_t orig_key;
    if (!st_get_key(w-&gt;table, (st_data_t)&amp;key, &amp;orig_key)) return Qnil;

    return *(VALUE *)orig_key;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  &#x21d2; <a href="../String.html" title="String (class)">String</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a new <a href="../String.html" title="String (class)"><code>::String</code></a> containing informations about the map:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'><a href="../ObjectSpace.html" title="ObjectSpace (module)">ObjectSpace</a></span><span class='op'>::</span><span class='const'>WeakKeyMap</span>.<span class='id identifier rubyid_new'><a href="../BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>
<span class='id identifier rubyid_m'>m</span>[<span class='id identifier rubyid_key'>key</span>] <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='id identifier rubyid_m'>m</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'># =&gt; &quot;#&lt;ObjectSpace::WeakKeyMap:0x00000001028dcba8 size=1&gt;&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L962-L978'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='962' data-end='978'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 962</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_inspect(VALUE self)
{
    struct weakkeymap *w;
    TypedData_Get_Struct(self, struct weakkeymap, &amp;weakkeymap_type, w);

    st_index_t n = st_table_size(w-&gt;table);

#if SIZEOF_ST_INDEX_T &lt;= SIZEOF_LONG
    const char * format = &quot;#&lt;%&quot;PRIsVALUE&quot;:%p size=%lu&gt;&quot;;
#else
    const char * format = &quot;#&lt;%&quot;PRIsVALUE&quot;:%p size=%llu&gt;&quot;;
#endif

    VALUE str = rb_sprintf(format, rb_class_name(CLASS_OF(self)), (void *)self, n);
    return str;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="key?-instance_method">
  <h3 class='signature '>
    #<strong>key?</strong>(key)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if <code>key</code> is a key in <code>self</code>, otherwise <code>false</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/weakmap.c#L927-L931'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='927' data-end='931'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'weakmap.c', line 927</span></pre>
<pre class='code cpp'>

static VALUE
wkmap_has_key(VALUE self, VALUE key)
{
    return RBOOL(wkmap_lookup(self, key) != Qundef);
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>