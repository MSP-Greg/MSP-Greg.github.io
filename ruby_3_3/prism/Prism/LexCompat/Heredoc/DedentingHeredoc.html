<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Prism::LexCompat::Heredoc::DedentingHeredoc &mdash; prism  Ruby-3.3.0 pp0</title>

<link rel='stylesheet'  type='text/css' href='../../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Prism::LexCompat::Heredoc::DedentingHeredoc",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../../'>Ruby-3.3.0</a> &raquo; 
      <a href='../../../'>prism</a> &raquo; 
      <a href='../../../_index.html#alpha_D'>Index (D)</a> &raquo; 
        <a href="../../../Prism.html" title="Prism (module)">Prism</a> &raquo; 
        <a class='nodoc' href="../../LexCompat.html" title="Prism::LexCompat (class)">LexCompat</a> &raquo; 
        <a class='nodoc' href="../Heredoc.html" title="Prism::LexCompat::Heredoc (module)">Heredoc</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>DedentingHeredoc&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Prism::LexCompat::Heredoc::DedentingHeredoc</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L354'>lib/prism/lex_compat.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>Heredocs that are dedenting heredocs are a little more complicated. Ripper outputs on_ignored_sp tokens for the whitespace that is being removed from the output. prism only modifies the node itself and keeps the token the same. This simplifies prism, but makes comparing against Ripper much harder because there is a length mismatch.</p>

<p>Fortunately, we already have to pull out the heredoc tokens in order to insert them into the stream in the correct order. As such, we can do some extra manipulation on the tokens to make them match Ripperâ€™s output by mirroring the dedent logic that Ripper uses.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='TAB_WIDTH-constant' class='summary_signature nodoc'>TAB_WIDTH =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L355-L355'># File 'lib/prism/lex_compat.rb', line 355</a>    <pre class='code ruby'><span class='int'>8</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>  &#x21d2; DedentingHeredoc </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#dedent-instance_method" title="#dedent (instance method)">#<strong>dedent</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#dedent_next-instance_method" title="#dedent_next (instance method)">#<strong>dedent_next</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#embexpr_balance-instance_method" title="#embexpr_balance (instance method)">#<strong>embexpr_balance</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro nodoc'>
      <a href="#tokens-instance_method" title="#tokens (instance method)">#<strong>tokens</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#<<-instance_method" title="#&lt;&lt; (instance method)">#<strong>&lt;&lt;</strong>(token)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>As tokens are coming in, we track the minimum amount of common leading whitespace on plain string content tokens.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_a-instance_method" title="#to_a (instance method)">#<strong>to_a</strong>  </a>
    </span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature nodoc first'>
    .<strong>new</strong>  &#x21d2; <code>DedentingHeredoc</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L359-L365'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='359' data-end='365'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 359</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@tokens</span> <span class='op'>=</span> []
  <span class='ivar'>@dedent_next</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@dedent</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@embexpr_balance</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@ended_on_newline</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="dedent-instance_method">
  <h3 class='signature ro  nodoc first'>
    #<strong>dedent</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L357-L357'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='357' data-end='357'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 357</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent'>dedent</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dedent_next-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>dedent_next</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L357-L357'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='357' data-end='357'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 357</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent_next'>dedent_next</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="embexpr_balance-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>embexpr_balance</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L357-L357'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='357' data-end='357'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 357</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_embexpr_balance'>embexpr_balance</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="tokens-instance_method">
  <h3 class='signature ro  nodoc'>
    #<strong>tokens</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L357-L357'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='357' data-end='357'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 357</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tokens'>tokens</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="<<-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>&lt;&lt;</strong>(token)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>As tokens are coming in, we track the minimum amount of common leading whitespace on plain string content tokens. This allows us to later remove that amount of whitespace from the beginning of each line.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L370-L405'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='370' data-end='405'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 370</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span>(<span class='id identifier rubyid_token'>token</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_beg'>on_embexpr_beg</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_beg'>on_heredoc_beg</span>
    <span class='ivar'>@embexpr_balance</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='ivar'>@dedent</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='ivar'>@dedent_next</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@ended_on_newline</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_end'>on_embexpr_end</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_end'>on_heredoc_end</span>
    <span class='ivar'>@embexpr_balance</span> <span class='op'>-=</span> <span class='int'>1</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_value'>value</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span>(<span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_strip'>strip</span>.<span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_end_with?'>end_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>))
        <span class='id identifier rubyid_leading'>leading</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span>[<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(\s*)\n?</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='int'>1</span>]
        <span class='id identifier rubyid_next_dedent'>next_dedent</span> <span class='op'>=</span> <span class='int'>0</span>

        <span class='id identifier rubyid_leading'>leading</span>.<span class='id identifier rubyid_each_char'>each_char</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_char'>char</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_char'>char</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_next_dedent'>next_dedent</span> <span class='op'>=</span> <span class='id identifier rubyid_next_dedent'>next_dedent</span> <span class='op'>-</span> (<span class='id identifier rubyid_next_dedent'>next_dedent</span> <span class='op'>%</span> <span class='const'><a href="#TAB_WIDTH-constant" title="Prism::LexCompat::Heredoc::DedentingHeredoc::TAB_WIDTH (constant)">TAB_WIDTH</a></span>) <span class='op'>+</span> <span class='const'><a href="#TAB_WIDTH-constant" title="Prism::LexCompat::Heredoc::DedentingHeredoc::TAB_WIDTH (constant)">TAB_WIDTH</a></span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_next_dedent'>next_dedent</span> <span class='op'>+=</span> <span class='int'>1</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='ivar'>@dedent</span> <span class='op'>=</span> [<span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span><span class='comma'>,</span> <span class='id identifier rubyid_next_dedent'>next_dedent</span>].<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_min'>min</span>
        <span class='ivar'>@dedent_next</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='ivar'>@ended_on_newline</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_end_with?'>end_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>)
        <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
        <span class='kw'>return</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@dedent_next</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='ivar'>@ended_on_newline</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_a-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_a</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_3_0/lib/prism/lex_compat.rb#L407-L578'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='407' data-end='578'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/prism/lex_compat.rb', line 407</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
  <span class='comment'># If every line in the heredoc is blank, we still need to split up the
</span>  <span class='comment'># string content token into multiple tokens.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> []
    <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token'>token</span><span class='op'>|</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_beg'>on_embexpr_beg</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_beg'>on_heredoc_beg</span>
        <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_end'>on_embexpr_end</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_end'>on_heredoc_end</span>
        <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>-=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>0</span>][<span class='int'>0</span>]
          <span class='id identifier rubyid_column'>column</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>0</span>][<span class='int'>1</span>]

          <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?&lt;=\n)</span><span class='regexp_end'>/</span></span>).<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>|</span>
            <span class='id identifier rubyid_column'>column</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&gt;</span> <span class='int'>0</span>
            <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="../Token.html" title="Prism::LexCompat::Token (class)">Token</a></span>.<span class='id identifier rubyid_new'><a href="../../LexCompat.html#new-class_method" title="Prism::LexCompat.new (method)">new</a></span>([[<span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_state'>state</span>])
            <span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>+=</span> <span class='int'>1</span>
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_results'>results</span>
  <span class='kw'>end</span>

  <span class='comment'># If the minimum common whitespace is 0, then we need to concatenate
</span>  <span class='comment'># string nodes together that are immediately adjacent.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> []
    <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_max_index'>max_index</span> <span class='op'>=</span> <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span>.<span class='id identifier rubyid_length'>length</span>

    <span class='kw'>while</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_max_index'>max_index</span>
      <span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span>[<span class='id identifier rubyid_index'>index</span>]
      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
      <span class='id identifier rubyid_index'>index</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>case</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_beg'>on_embexpr_beg</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_beg'>on_heredoc_beg</span>
        <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_end'>on_embexpr_end</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_end'>on_heredoc_end</span>
        <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>-=</span> <span class='int'>1</span>
      <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='kw'>while</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_max_index'>max_index</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span>[<span class='id identifier rubyid_index'>index</span>].<span class='id identifier rubyid_event'>event</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span>
            <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span>[<span class='id identifier rubyid_index'>index</span>].<span class='id identifier rubyid_value'>value</span>
            <span class='id identifier rubyid_index'>index</span> <span class='op'>+=</span> <span class='int'>1</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_results'>results</span>
  <span class='kw'>end</span>

  <span class='comment'># Otherwise, we&#39;re going to run through each token in the list and
</span>  <span class='comment'># insert on_ignored_sp tokens for the amount of dedent that we need to
</span>  <span class='comment'># perform. We also need to remove the dedent from the beginning of
</span>  <span class='comment'># each line of plain string content tokens.
</span>  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> []
  <span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_tokens'><a href="#tokens-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#tokens (method)">tokens</a></span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_token'>token</span><span class='op'>|</span>
    <span class='comment'># Notice that the structure of this conditional largely matches the
</span>    <span class='comment'># whitespace calculation we performed above. This is because
</span>    <span class='comment'># checking if the subsequent token needs to be dedented is common to
</span>    <span class='comment'># both the dedent calculation and the ignored_sp insertion.
</span>    <span class='kw'>case</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_beg'>on_embexpr_beg</span>
      <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_embexpr_end'>on_embexpr_end</span>
      <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>-=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
    <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='comment'># Here we&#39;re going to split the string on newlines, but maintain
</span>        <span class='comment'># the newlines in the resulting array. We&#39;ll do that with a look
</span>        <span class='comment'># behind assertion.
</span>        <span class='id identifier rubyid_splits'>splits</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?&lt;=\n)</span><span class='regexp_end'>/</span></span>)
        <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='int'>0</span>

        <span class='kw'>while</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_splits'>splits</span>.<span class='id identifier rubyid_length'>length</span>
          <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_splits'>splits</span>[<span class='id identifier rubyid_index'>index</span>]
          <span class='id identifier rubyid_lineno'>lineno</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>0</span>][<span class='int'>0</span>] <span class='op'>+</span> <span class='id identifier rubyid_index'>index</span>
          <span class='id identifier rubyid_column'>column</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>0</span>][<span class='int'>1</span>]

          <span class='comment'># Blank lines do not count toward common leading whitespace
</span>          <span class='comment'># calculation and do not need to be dedented.
</span>          <span class='kw'>if</span> <span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span> <span class='op'>||</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&gt;</span> <span class='int'>0</span>
            <span class='id identifier rubyid_column'>column</span> <span class='op'>=</span> <span class='int'>0</span>
          <span class='kw'>end</span>

          <span class='comment'># If the dedent is 0 and we&#39;re not supposed to dedent the next
</span>          <span class='comment'># line or this line doesn&#39;t start with whitespace, then we
</span>          <span class='comment'># should concatenate the rest of the string to match ripper.
</span>          <span class='kw'>if</span> <span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> (<span class='op'>!</span><span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s</span><span class='regexp_end'>/</span></span>))
            <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_splits'>splits</span>[<span class='id identifier rubyid_index'>index</span><span class='op'>..</span>].<span class='id identifier rubyid_join'>join</span>
            <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_splits'>splits</span>.<span class='id identifier rubyid_length'>length</span>
          <span class='kw'>end</span>

          <span class='comment'># If we are supposed to dedent this line or if this is not the
</span>          <span class='comment'># first line of the string and this line isn&#39;t entirely blank,
</span>          <span class='comment'># then we need to insert an on_ignored_sp token and remove the
</span>          <span class='comment'># dedent from the beginning of the line.
</span>          <span class='kw'>if</span> (<span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span> <span class='op'>&gt;</span> <span class='int'>0</span>) <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span> <span class='op'>||</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&gt;</span> <span class='int'>0</span>)
            <span class='id identifier rubyid_deleting'>deleting</span> <span class='op'>=</span> <span class='int'>0</span>
            <span class='id identifier rubyid_deleted_chars'>deleted_chars</span> <span class='op'>=</span> []

            <span class='comment'># Gather up all of the characters that we&#39;re going to
</span>            <span class='comment'># delete, stopping when you hit a character that would put
</span>            <span class='comment'># you over the dedent amount.
</span>            <span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_each_char'>each_char</span>.<span class='id identifier rubyid_with_index'>with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_char'>char</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
              <span class='kw'>case</span> <span class='id identifier rubyid_char'>char</span>
              <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\r</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span>[<span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span>] <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
                  <span class='kw'>break</span>
                <span class='kw'>end</span>
              <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>break</span>
              <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_deleting'>deleting</span> <span class='op'>=</span> <span class='id identifier rubyid_deleting'>deleting</span> <span class='op'>-</span> (<span class='id identifier rubyid_deleting'>deleting</span> <span class='op'>%</span> <span class='const'><a href="#TAB_WIDTH-constant" title="Prism::LexCompat::Heredoc::DedentingHeredoc::TAB_WIDTH (constant)">TAB_WIDTH</a></span>) <span class='op'>+</span> <span class='const'><a href="#TAB_WIDTH-constant" title="Prism::LexCompat::Heredoc::DedentingHeredoc::TAB_WIDTH (constant)">TAB_WIDTH</a></span>
              <span class='kw'>else</span>
                <span class='id identifier rubyid_deleting'>deleting</span> <span class='op'>+=</span> <span class='int'>1</span>
              <span class='kw'>end</span>

              <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_deleting'>deleting</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_dedent'><a href="#dedent-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent (method)">dedent</a></span>
              <span class='id identifier rubyid_deleted_chars'>deleted_chars</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_char'>char</span>
            <span class='kw'>end</span>

            <span class='comment'># If we have something to delete, then delete it from the
</span>            <span class='comment'># string and insert an on_ignored_sp token.
</span>            <span class='kw'>if</span> <span class='id identifier rubyid_deleted_chars'>deleted_chars</span>.<span class='id identifier rubyid_any?'>any?</span>
              <span class='id identifier rubyid_ignored'>ignored</span> <span class='op'>=</span> <span class='id identifier rubyid_deleted_chars'>deleted_chars</span>.<span class='id identifier rubyid_join'>join</span>
              <span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_delete_prefix!'>delete_prefix!</span>(<span class='id identifier rubyid_ignored'>ignored</span>)

              <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="../Token.html" title="Prism::LexCompat::Token (class)">Token</a></span>.<span class='id identifier rubyid_new'><a href="../../LexCompat.html#new-class_method" title="Prism::LexCompat.new (method)">new</a></span>([[<span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span> <span class='int'>0</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_ignored_sp'>on_ignored_sp</span><span class='comma'>,</span> <span class='id identifier rubyid_ignored'>ignored</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>3</span>]])
              <span class='id identifier rubyid_column'>column</span> <span class='op'>=</span> <span class='id identifier rubyid_ignored'>ignored</span>.<span class='id identifier rubyid_length'>length</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>

          <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='const'><a href="../Token.html" title="Prism::LexCompat::Token (class)">Token</a></span>.<span class='id identifier rubyid_new'><a href="../../LexCompat.html#new-class_method" title="Prism::LexCompat.new (method)">new</a></span>([[<span class='id identifier rubyid_lineno'>lineno</span><span class='comma'>,</span> <span class='id identifier rubyid_column'>column</span>]<span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_token'>token</span>[<span class='int'>3</span>]]) <span class='kw'>unless</span> <span class='id identifier rubyid_line'>line</span>.<span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_index'>index</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_token'>token</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_dedent_next'><a href="#dedent_next-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#dedent_next (method)">dedent_next</a></span> <span class='op'>=</span>
      ((<span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_tstring_content'>on_tstring_content</span>) <span class='op'>||</span> (<span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_event'>event</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_on_heredoc_end'>on_heredoc_end</span>)) <span class='op'>&amp;&amp;</span>
      <span class='id identifier rubyid_embexpr_balance'><a href="#embexpr_balance-instance_method" title="Prism::LexCompat::Heredoc::DedentingHeredoc#embexpr_balance (method)">embexpr_balance</a></span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>