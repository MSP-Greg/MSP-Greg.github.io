<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Active Support CHANGELOG &mdash; Rails 7.1.3.2</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "active_support_CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Rails 7.1.3.2</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Active Support CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<ul>
<li><p>Workaround a Ruby bug that can cause a VM crash.</p>

<p>This would happen if using <code>TaggerLogger</code> with a Proc
formatter on which you called <code>object_id</code>.</p>

<pre class="code ruby"><code class="ruby">[<span class='const'>BUG</span>] <span class='const'><a href="Object.html" title="Object (class)">Object</a></span> <span class='const'>ID</span> <span class='id identifier rubyid_seen'>seen</span><span class='comma'>,</span> <span class='id identifier rubyid_but'>but</span> <span class='kw'>not</span> <span class='kw'>in</span> <span class='id identifier rubyid_mapping'>mapping</span> <span class='label'>table:</span> <span class='id identifier rubyid_proc'>proc</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Fix <a href="ActiveSupport/Notifications.html#publish_event-class_method" title="ActiveSupport::Notifications.publish_event (method)">ActiveSupport::Notifications.publish_event</a> to preserve units.</p>

<p>This solves the incorrect reporting of time spent running Active Record
asynchronous queries (by a factor <code>1000</code>).</p>

<p><em>Jean Boussier</em></p></li>
</ul>

<h2>Rails 7.1.3.2 (February 21, 2024)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 7.1.3.1 (February 21, 2024)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 7.1.3 (January 16, 2024)</h2>

<ul>
<li><p>Handle nil <code>backtrace_locations</code> in <a href="ActiveSupport/SyntaxErrorProxy.html" title="ActiveSupport::SyntaxErrorProxy (class)"><code>::ActiveSupport::SyntaxErrorProxy</code></a>.</p>

<p><em>Eugene Kenny</em></p></li>
<li><p>Fix <a href="ActiveSupport/JSON.html#encode-class_method" title="ActiveSupport::JSON.encode (method)">ActiveSupport::JSON.encode</a> to prevent duplicate keys.</p>

<p>If the same key exist in both String and Symbol form it could
lead to the same key being emitted twice.</p>

<p><em>Manish Sharma</em></p></li>
<li><p>Fix <a href="ActiveSupport/Cache/Store.html#read_multi-instance_method" title="ActiveSupport::Cache::Store#read_multi (method)">ActiveSupport::Cache::Store#read_multi</a> when using a cache namespace
and local cache strategy.</p>

<p><em>Mark Oleson</em></p></li>
<li><p>Fix <code>Time.now/DateTime.now/Date.today</code> to return results in a system timezone after <code>#travel_to</code>.</p>

<p>There is a bug in the current implementation of #travel_to:
it remembers a timezone of its argument, and all stubbed methods start
returning results in that remembered timezone. However, the expected
behaviour is to return results in a system timezone.</p>

<p><em>Aleksei Chernenkov</em></p></li>
<li><p>Fix <code>:unless_exist</code> option for <code>MemoryStore#write</code> (et al) when using a
cache namespace.</p>

<p><em>S. Brent Faulkner</em></p></li>
<li><p>Fix ActiveSupport::Deprecation to handle blaming generated code.</p>

<p><em>Jean Boussier</em>, <em>fatkodima</em></p></li>
</ul>

<h2>Rails 7.1.2 (November 10, 2023)</h2>

<ul>
<li><p>Fix <code>:expires_in</code> option for <code>RedisCacheStore#write_multi</code>.</p>

<p><em>fatkodima</em></p></li>
<li><p>Fix deserialization of non-string &quot;purpose&quot; field in Message serializer</p>

<p><em>Jacopo Beschi</em></p></li>
<li><p>Prevent global cache options being overwritten when setting dynamic options
inside a <a href="ActiveSupport/Cache/Store.html#fetch-instance_method" title="ActiveSupport::Cache::Store#fetch (method)">ActiveSupport::Cache::Store#fetch</a> block.</p>

<p><em>Yasha Krasnou</em></p></li>
<li><p>Fix missing <code>require</code> resulting in <code>NoMethodError</code> when running
<code>bin/rails secrets:show</code> or <code>bin/rails secrets:edit</code>.</p>

<p><em>Stephen Ierodiaconou</em></p></li>
<li><p>Ensure <code>{down,up}case_first</code> returns non-frozen string.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Fix <code>#to_fs(:human_size)</code> to correctly work with negative numbers.</p>

<p><em>Earlopain</em></p></li>
<li><p>Fix <code>BroadcastLogger#dup</code> so that it duplicates the logger&#39;s <code>broadcasts</code>.</p>

<p><em>Andrew Novoselac</em></p></li>
<li><p>Fix issue where <code>bootstrap.rb</code> overwrites the <code>level</code> of a <code>BroadcastLogger</code>&#39;s <code>broadcasts</code>.</p>

<p><em>Andrew Novoselac</em></p></li>
<li><p>Fix <a href="ActiveSupport/Cache.html" title="ActiveSupport::Cache (module)"><code>::ActiveSupport::Cache</code></a> to handle outdated Marshal payload from <a href="Rails.html" title="Rails (module)"><code>Rails</code></a> 6.1 format.</p>

<p>Active Support&#39;s Cache is supposed to treat a Marshal payload that can no longer be
deserialized as a cache miss. It fail to do so for compressed payload in the Rails 6.1
legacy format.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Fix <code>OrderedOptions#dig</code> for array indexes.</p>

<p><em>fatkodima</em></p></li>
<li><p>Fix time travel helpers to work when nested using with separate classes.</p>

<p><em>fatkodima</em></p></li>
<li><p>Fix <code>delete_matched</code> for file cache store to work with keys longer than the
max filename size.</p>

<p><em>fatkodima</em> and <em>Jonathan Hefner</em></p></li>
<li><p>Fix compatibility with the <code>semantic_logger</code> gem.</p>

<p>The <code>semantic_logger</code> gem doesn&#39;t behave exactly like stdlib logger in that
<code>SemanticLogger#level</code> returns a Symbol while stdlib <code>Logger#level</code> returns an Integer.</p>

<p>This caused the various <code>LogSubscriber</code> classes in Rails to break when assigned a
<code>SemanticLogger</code> instance.</p>

<p><em>Jean Boussier</em>, <em>ojab</em></p></li>
</ul>

<h2>Rails 7.1.1 (October 11, 2023)</h2>

<ul>
<li><p>Add support for keyword arguments when delegating calls to custom loggers from <a href="ActiveSupport/BroadcastLogger.html" title="ActiveSupport::BroadcastLogger (class)"><code>::ActiveSupport::BroadcastLogger</code></a>.</p>

<p><em>Edouard Chin</em></p></li>
<li><p><code>NumberHelper</code>: handle objects responding <code>to_d</code>.</p>

<p><em>fatkodima</em></p></li>
<li><p>Fix RedisCacheStore to properly set the TTL when incrementing or decrementing.</p>

<p>This bug was only impacting Redis server older than 7.0.</p>

<p><em>Thomas Countz</em></p></li>
<li><p>Fix MemoryStore to prevent race conditions when incrementing or decrementing.</p>

<p><em>Pierre Jambet</em></p></li>
</ul>

<h2>Rails 7.1.0 (October 05, 2023)</h2>

<ul>
<li>  No changes.</li>
</ul>

<h2>Rails 7.1.0.rc2 (October 01, 2023)</h2>

<ul>
<li><p>Fix <code>AS::MessagePack</code> with <code>ENV["RAILS_MAX_THREADS"]</code>.</p>

<p><em>Jonathan Hefner</em></p></li>
</ul>

<h2>Rails 7.1.0.rc1 (September 27, 2023)</h2>

<ul>
<li><p>Add a new public API for broadcasting logs</p>

<p>This feature existed for a while but was until now a private API.
Broadcasting log allows to send log message to difference sinks (STDOUT, a file ...) and
is used by default in the development environment to write logs both on STDOUT and in the
&quot;development.log&quot; file.</p>

<p>Basic usage:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdout_logger'>stdout_logger</span> <span class='op'>=</span> <span class='const'>Logger</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>STDOUT</span>)
<span class='id identifier rubyid_file_logger'>file_logger</span> <span class='op'>=</span> <span class='const'>Logger</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>development.log</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_broadcast'>broadcast</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/BroadcastLogger.html" title="ActiveSupport::BroadcastLogger (class)">BroadcastLogger</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/BroadcastLogger.html#new-class_method" title="ActiveSupport::BroadcastLogger.new (method)">new</a></span>(<span class='id identifier rubyid_stdout_logger'>stdout_logger</span><span class='comma'>,</span> <span class='id identifier rubyid_file_logger'>file_logger</span>)

<span class='id identifier rubyid_broadcast'>broadcast</span>.<span class='id identifier rubyid_info'>info</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello!</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># The &quot;Hello!&quot; message is written on STDOUT and in the log file.</span></code></pre>

<p>Adding other sink(s) to the broadcast:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_broadcast'>broadcast</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/BroadcastLogger.html" title="ActiveSupport::BroadcastLogger (class)">BroadcastLogger</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/BroadcastLogger.html#new-class_method" title="ActiveSupport::BroadcastLogger.new (method)">new</a></span>
<span class='id identifier rubyid_broadcast'>broadcast</span>.<span class='id identifier rubyid_broadcast_to'>broadcast_to</span>(<span class='const'>Logger</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>STDERR</span>))</code></pre>

<p>Remove a sink from the broadcast:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_stdout_logger'>stdout_logger</span> <span class='op'>=</span> <span class='const'>Logger</span>.<span class='id identifier rubyid_new'>new</span>(<span class='const'>STDOUT</span>)
<span class='id identifier rubyid_broadcast'>broadcast</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/BroadcastLogger.html" title="ActiveSupport::BroadcastLogger (class)">BroadcastLogger</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/BroadcastLogger.html#new-class_method" title="ActiveSupport::BroadcastLogger.new (method)">new</a></span>(<span class='id identifier rubyid_stdout_logger'>stdout_logger</span>)

<span class='id identifier rubyid_broadcast'>broadcast</span>.<span class='id identifier rubyid_stop_broadcasting_to'>stop_broadcasting_to</span>(<span class='id identifier rubyid_stdout_logger'>stdout_logger</span>)</code></pre>

<p><em>Edouard Chin</em></p></li>
<li><p>Fix Range#overlap? not taking empty ranges into account on Ruby &lt; 3.3</p>

<p><em>Nobuyoshi Nakada</em>, <em>Shouichi Kamiya</em>, <em>Hartley McGuire</em></p></li>
<li><p>Use Ruby 3.3 Range#overlap? if available</p>

<p><em>Yasuo Honda</em></p></li>
</ul>

<h2>Rails 7.1.0.beta1 (September 13, 2023)</h2>

<ul>
<li><p>Add <code>bigdecimal</code> as Active Support dependency that is a bundled gem candidate for Ruby 3.4.</p>

<p><code>bigdecimal</code> 3.1.4 or higher version will be installed.
Ruby 2.7 and 3.0 users who want <code>bigdecimal</code> version 2.0.0 or 3.0.0 behavior as a default gem,
pin the <code>bigdecimal</code> version in your application Gemfile.</p>

<p><em>Koichi ITO</em></p></li>
<li><p>Add <code>drb</code>, <code>mutex_m</code> and <code>base64</code> that are bundled gem candidates for Ruby 3.4</p>

<p><em>Yasuo Honda</em></p></li>
<li><p>When using cache format version &gt;= 7.1 or a custom serializer, expired and
version-mismatched cache entries can now be detected without deserializing
their values.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Make all cache stores return a boolean for <code>#delete</code></p>

<p>Previously the <code>RedisCacheStore#delete</code> would return <code>1</code> if the entry
exists and <code>0</code> otherwise. Now it returns true if the entry exists and false
otherwise, just like the other stores.</p>

<p>The <code>FileStore</code> would return <code>nil</code> if the entry doesn&#39;t exists and returns
<code>false</code> now as well.</p>

<p><em>Petrik de Heus</em></p></li>
<li><p>Active Support cache stores now support replacing the default compressor via
a <code>:compressor</code> option. The specified compressor must respond to <code>deflate</code>
and <code>inflate</code>. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>module</span> <span class='const'>MyCompressor</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_deflate'>deflate</span>(<span class='id identifier rubyid_string'>string</span>)
    <span class='comment'># compression logic...
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_inflate'>inflate</span>(<span class='id identifier rubyid_compressed'>compressed</span>)
    <span class='comment'># decompression logic...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_cache_store'>cache_store</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redis_cache_store'>redis_cache_store</span><span class='comma'>,</span> { <span class='label'>compressor:</span> <span class='const'>MyCompressor</span> }</code></pre>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Active Support cache stores now support a <code>:serializer</code> option. Similar to
the <code>:coder</code> option, serializers must respond to <code>dump</code> and <code>load</code>. However,
serializers are only responsible for serializing a cached value, whereas
coders are responsible for serializing the entire <a href="ActiveSupport/Cache/Entry.html" title="ActiveSupport::Cache::Entry (class)"><code>::ActiveSupport::Cache::Entry</code></a>
instance.  Additionally, the output from serializers can be automatically
compressed, whereas coders are responsible for their own compression.</p>

<p>Specifying a serializer instead of a coder also enables performance
optimizations, including the bare string optimization introduced by cache
format version 7.1.</p>

<p>The <code>:serializer</code> and <code>:coder</code> options are mutually exclusive. Specifying
both will raise an <code>ArgumentError</code>.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Fix <code>ActiveSupport::Inflector.humanize(nil)</code> raising <code>NoMethodError: undefined method `end_with?&#39; for nil:NilClass</code>.</p>

<p><em>James Robinson</em></p></li>
<li><p>Don&#39;t show secrets for <a href="ActiveSupport/KeyGenerator.html#inspect-instance_method" title="ActiveSupport::KeyGenerator#inspect (method)">ActiveSupport::KeyGenerator#inspect</a>.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/KeyGenerator.html" title="ActiveSupport::KeyGenerator (class)">KeyGenerator</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/KeyGenerator.html#new-class_method" title="ActiveSupport::KeyGenerator.new (method)">new</a></span>(<span class='id identifier rubyid_secret'>secret</span>).<span class='id identifier rubyid_inspect'><a href="ActiveSupport/KeyGenerator.html#inspect-instance_method" title="ActiveSupport::KeyGenerator#inspect (method)">inspect</a></span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ActiveSupport::KeyGenerator:0x0000000104888038 ... @secret=\&quot;\\xAF\\bFh]LV}q\\nl\\xB2U\\xB3 ... &gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/KeyGenerator.html" title="ActiveSupport::KeyGenerator (class)">KeyGenerator</a></span><span class='op'>::</span><span class='const'>Aes256Gcm</span>(<span class='id identifier rubyid_secret'>secret</span>).<span class='id identifier rubyid_inspect'>inspect</span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ActiveSupport::KeyGenerator:0x0000000104888038&gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><em>Petrik de Heus</em></p></li>
<li><p>Improve error message when EventedFileUpdateChecker is used without a
compatible version of the Listen gem</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Add <code>:report</code> behavior for Deprecation</p>

<p>Setting <code>config.active_support.deprecation = :report</code> uses the error
reporter to report deprecation warnings to <a href="ActiveSupport/ErrorReporter.html" title="ActiveSupport::ErrorReporter (class)"><code>::ActiveSupport::ErrorReporter</code></a>.</p>

<p>Deprecations are reported as handled errors, with a severity of <code>:warning</code>.</p>

<p>Useful to report deprecations happening in production to your bug tracker.</p>

<p><em>Étienne Barrié</em></p></li>
<li><p>Rename <a href="Range.html#overlaps%3F-instance_method" title="Range#overlaps? (method)">Range#overlaps?</a> to <code>#overlap?</code> and add alias for backwards compatibility</p>

<p><em>Christian Schmidt</em></p></li>
<li><p>Fix <code>EncryptedConfiguration</code> returning incorrect values for some <a href="Hash.html" title="Hash (class)"><code>Hash</code></a>
methods</p>

<p><em>Hartley McGuire</em></p></li>
<li><p>Don&#39;t show secrets for <code>MessageEncryptor#inspect</code>.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)">MessageEncryptor</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageEncryptor.html#new-class_method" title="ActiveSupport::MessageEncryptor.new (method)">new</a></span>(<span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='label'>cipher:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-256-gcm</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_inspect'><a href="ActiveSupport/MessageEncryptor.html#inspect-instance_method" title="ActiveSupport::MessageEncryptor#inspect (method)">inspect</a></span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ActiveSupport::MessageEncryptor:0x0000000104888038 ... @secret=\&quot;\\xAF\\bFh]LV}q\\nl\\xB2U\\xB3 ... &gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)">MessageEncryptor</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageEncryptor.html#new-class_method" title="ActiveSupport::MessageEncryptor.new (method)">new</a></span>(<span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='label'>cipher:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-256-gcm</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_inspect'><a href="ActiveSupport/MessageEncryptor.html#inspect-instance_method" title="ActiveSupport::MessageEncryptor#inspect (method)">inspect</a></span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ActiveSupport::MessageEncryptor:0x0000000104888038&gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><em>Petrik de Heus</em></p></li>
<li><p>Don&#39;t show contents for <code>EncryptedConfiguration#inspect</code>.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_credentials'>credentials</span>.<span class='id identifier rubyid_inspect'>inspect</span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8 ... @config={:secret=&gt;\&quot;something secret\&quot;} ... @key_file_contents=\&quot;915e4ea054e011022398dc242\&quot; ...&gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_credentials'>credentials</span>.<span class='id identifier rubyid_inspect'>inspect</span>
<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ActiveSupport::EncryptedConfiguration:0x000000010d2b38e8&gt;</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p><em>Petrik de Heus</em></p></li>
<li><p><a href="ERB/Util.html#html_escape_once-class_method" title="ERB::Util.html_escape_once (method)">ERB::Util.html_escape_once</a> always returns an <code>html_safe</code> string.</p>

<p>This method previously maintained the <code>html_safe?</code> property of a string on the return
value. Because this string has been escaped, however, not marking it as <code>html_safe</code> causes
entities to be double-escaped.</p>

<p>As an example, take this view snippet:</p>

<pre class="code html"><code class="html">  &lt;p&gt;&lt;%= html_escape_once(&quot;this &amp; that &amp;amp; the other&quot;) %&gt;&lt;/p&gt;
</code></pre>

<p>Before this change, that would be double-escaped and render as:</p>

<pre class="code html"><code class="html">  &lt;p&gt;this &amp;amp;amp; that &amp;amp;amp; the other&lt;/p&gt;
</code></pre>

<p>After this change, it renders correctly as:</p>

<pre class="code html"><code class="html">  &lt;p&gt;this &amp;amp; that &amp;amp; the other&lt;/p&gt;
</code></pre>

<p>Fixes #48256</p>

<p><em>Mike Dalessio</em></p></li>
<li><p>Deprecate <code>SafeBuffer#clone_empty</code>.</p>

<p>This method has not been used internally since Rails 4.2.0.</p>

<p><em>Mike Dalessio</em></p></li>
<li><p><code>MessageEncryptor</code>, <code>MessageVerifier</code>, and <code>config.active_support.message_serializer</code>
now accept <code>:message_pack</code> and <code>:message_pack_allow_marshal</code> as serializers.
These serializers require the <a href="https://rubygems.org/gems/msgpack"><code>msgpack</code> gem</a>
(&gt;= 1.7.0).</p>

<p>The Message Pack format can provide improved performance and smaller payload
sizes. It also supports round-tripping some Ruby types that are not supported
by JSON. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)">MessageVerifier</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageVerifier.html#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> [{ <span class='label'>a:</span> <span class='int'>1</span> }<span class='comma'>,</span> { <span class='label'>b:</span> <span class='int'>2</span> }.<span class='id identifier rubyid_with_indifferent_access'>with_indifferent_access</span><span class='comma'>,</span> <span class='int'>1</span>.<span class='id identifier rubyid_to_d'>to_d</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_at'>at</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='int'>123</span>)]
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='id identifier rubyid_data'>data</span>)

<span class='comment'># BEFORE with config.active_support.message_serializer = :json
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>)
<span class='comment'># =&gt; [{&quot;a&quot;=&gt;1}, {&quot;b&quot;=&gt;2}, &quot;1.0&quot;, &quot;1969-12-31T18:00:00.000-06:00&quot;]
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='kw'>class</span>)
<span class='comment'># =&gt; [Hash, Hash, String, String]
</span>
<span class='comment'># AFTER with config.active_support.message_serializer = :message_pack
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>)
<span class='comment'># =&gt; [{:a=&gt;1}, {&quot;b&quot;=&gt;2}, 0.1e1, 1969-12-31 18:00:00.000123 -0600]
</span><span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>).<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='kw'>class</span>)
<span class='comment'># =&gt; [Hash, ActiveSupport::HashWithIndifferentAccess, BigDecimal, Time]</span></code></pre>

<p>The <code>:message_pack</code> serializer can fall back to deserializing with
<a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a> when necessary, and the <code>:message_pack_allow_marshal</code>
serializer can fall back to deserializing with <code>Marshal</code> as well as
<a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a>. Additionally, the <code>:marshal</code>, <code>:json</code>, and
<code>:json_allow_marshal</code> serializers can now fall back to deserializing with
<a href="ActiveSupport/MessagePack.html" title="ActiveSupport::MessagePack (module)"><code>::ActiveSupport::MessagePack</code></a> when necessary. These behaviors ensure old
messages can still be read so that migration is easier.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>A new <code>7.1</code> cache format is available which includes an optimization for
bare string values such as view fragments.</p>

<p>The <code>7.1</code> cache format is used by default for new apps, and existing apps
can enable the format by setting <code>config.load_defaults 7.1</code> or by setting
<code>config.active_support.cache_format_version = 7.1</code> in <code>config/application.rb</code>
or a <code>config/environments/*.rb</code> file.</p>

<p>Cache entries written using the <code>6.1</code> or <code>7.0</code> cache formats can be read
when using the <code>7.1</code> format. To perform a rolling deploy of a Rails 7.1
upgrade, wherein servers that have not yet been upgraded must be able to
read caches from upgraded servers, leave the cache format unchanged on the
first deploy, then enable the <code>7.1</code> cache format on a subsequent deploy.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Active Support cache stores can now use a preconfigured serializer based on
<a href="ActiveSupport/MessagePack.html" title="ActiveSupport::MessagePack (module)"><code>::ActiveSupport::MessagePack</code></a> via the <code>:serializer</code> option:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_cache_store'>cache_store</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redis_cache_store'>redis_cache_store</span><span class='comma'>,</span> { <span class='label'>serializer:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_message_pack'>message_pack</span> }</code></pre>

<p>The <code>:message_pack</code> serializer can reduce cache entry sizes and improve
performance, but requires the <a href="https://rubygems.org/gems/msgpack"><code>msgpack</code> gem</a>
(&gt;= 1.7.0).</p>

<p>The <code>:message_pack</code> serializer can read cache entries written by the default
serializer, and the default serializer can now read entries written by the
<code>:message_pack</code> serializer. These behaviors make it easy to migrate between
serializer without invalidating the entire cache.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p><a href="Object.html#deep_dup-instance_method" title="Object#deep_dup (method)">Object#deep_dup</a> no longer duplicate named classes and modules.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> { <span class='label'>class:</span> <span class='const'><a href="Object.html" title="Object (class)">Object</a></span><span class='comma'>,</span> <span class='label'>module:</span> <span class='const'><a href="Kernel.html" title="Kernel (module)">Kernel</a></span> }
<span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_deep_dup'>deep_dup</span> <span class='comment'># =&gt; {:class=&gt;#&lt;Class:0x00000001063ffc80&gt;, :module=&gt;#&lt;Module:0x00000001063ffa00&gt;}</span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> { <span class='label'>class:</span> <span class='const'><a href="Object.html" title="Object (class)">Object</a></span><span class='comma'>,</span> <span class='label'>module:</span> <span class='const'><a href="Kernel.html" title="Kernel (module)">Kernel</a></span> }
<span class='id identifier rubyid_hash'>hash</span>.<span class='id identifier rubyid_deep_dup'>deep_dup</span> <span class='comment'># =&gt; {:class=&gt;Object, :module=&gt;Kernel}</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Consistently raise an <code>ArgumentError</code> if the <a href="ActiveSupport/Cache.html" title="ActiveSupport::Cache (module)"><code>::ActiveSupport::Cache</code></a> key is blank.</p>

<p><em>Joshua Young</em></p></li>
<li><p>Deprecate usage of the singleton <a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a>.</p>

<p>All usage of <a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a> as a singleton is deprecated, the most common one being
<code>ActiveSupport::Deprecation.warn</code>. Gem authors should now create their own deprecator (<a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a>
object), and use it to emit deprecation warnings.</p>

<p>Calling any of the following without specifying a deprecator argument is also deprecated:</p>

<ul>
<li>Module.deprecate</li>
<li>deprecate_constant</li>
<li>DeprecatedObjectProxy</li>
<li>DeprecatedInstanceVariableProxy</li>
<li>DeprecatedConstantProxy</li>
<li>deprecation-related test assertions</li>
</ul>

<p>Use of <code>ActiveSupport::Deprecation.silence</code> and configuration methods like <code>behavior=</code>, <code>disallowed_behavior=</code>,
<code>disallowed_warnings=</code> should now be aimed at the <a href="https://api.rubyonrails.org/classes/Rails/Application.html#method-i-deprecators">application&#39;s deprecators</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_application'><a href="Rails.html#application-class_method" title="Rails.application (method)">application</a></span>.<span class='id identifier rubyid_deprecators'>deprecators</span>.<span class='id identifier rubyid_silence'>silence</span> <span class='kw'>do</span>
  <span class='comment'># code that emits deprecation warnings
</span><span class='kw'>end</span></code></pre>

<p>If your gem has a Railtie or Engine, it&#39;s encouraged to add your deprecator to the application&#39;s deprecators, that
way the deprecation related configuration options will apply to it as well, e.g.
<code>config.active_support.report_deprecations</code> set to <code>false</code> in the production environment will also disable your
deprecator.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_initializer'>initializer</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_gem.deprecator</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_app'>app</span><span class='op'>|</span>
  <span class='id identifier rubyid_app'>app</span>.<span class='id identifier rubyid_deprecators'>deprecators</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_my_gem'>my_gem</span>] <span class='op'>=</span> <span class='const'>MyGem</span>.<span class='id identifier rubyid_deprecator'>deprecator</span>
<span class='kw'>end</span></code></pre>

<p><em>Étienne Barrié</em></p></li>
<li><p>Add <a href="Object.html#with-instance_method" title="Object#with (method)">Object#with</a> to set and restore public attributes around a block</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_timeout'>timeout</span> <span class='comment'># =&gt; 5
</span><span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_with'>with</span>(<span class='label'>timeout:</span> <span class='int'>1</span>) <span class='kw'>do</span>
  <span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_timeout'>timeout</span> <span class='comment'># =&gt; 1
</span><span class='kw'>end</span>
<span class='id identifier rubyid_client'>client</span>.<span class='id identifier rubyid_timeout'>timeout</span> <span class='comment'># =&gt; 5</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p>Remove deprecated support to generate incorrect RFC 4122 UUIDs when providing a namespace ID that is not one of the
constants defined on <a href="Digest/UUID.html" title="Digest::UUID (module)"><code>::Digest::UUID</code></a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>config.active_support.use_rfc4122_namespaced_uuids</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove implicit conversion of objects into <a href="String.html" title="String (class)"><code>String</code></a> by <a href="ActiveSupport/SafeBuffer.html" title="ActiveSupport::SafeBuffer (class)"><code>::ActiveSupport::SafeBuffer</code></a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>active_support/core_ext/range/include_time_with_zone</code> file.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>config.active_support.remove_deprecated_time_with_zone_name</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated override of <code>ActiveSupport::TimeWithZone.name</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecate <code>config.active_support.disable_to_s_conversion</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated option to passing a format to <code>#to_s</code> in <a href="Array.html" title="Array (class)"><code>Array</code></a>, <a href="Range.html" title="Range (class)"><code>Range</code></a>, <a href="Date.html" title="Date (class)"><code>Date</code></a>, <a href="DateTime.html" title="DateTime (class)"><code>DateTime</code></a>, <a href="Time.html" title="Time (class)"><code>Time</code></a>,
<a href="BigDecimal.html" title="BigDecimal (class)"><code>BigDecimal</code></a>, <a href="Float.html" title="Float (class)"><code>Float</code></a> and, <a href="Integer.html" title="Integer (class)"><code>Integer</code></a>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated <code>ActiveSupport::PerThreadRegistry</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Remove deprecated override of <code>Enumerable#sum</code>.</p>

<p><em>Rafael Mendonça França</em></p></li>
<li><p>Deprecated initializing a <a href="ActiveSupport/Cache/MemCacheStore.html" title="ActiveSupport::Cache::MemCacheStore (class)"><code>::ActiveSupport::Cache::MemCacheStore</code></a> with an instance of <code>Dalli::Client</code>.</p>

<p>Deprecate the undocumented option of providing an already-initialized instance of <code>Dalli::Client</code> to <a href="ActiveSupport/Cache/MemCacheStore.html" title="ActiveSupport::Cache::MemCacheStore (class)"><code>::ActiveSupport::Cache::MemCacheStore</code></a>. Such clients could be configured with unrecognized options, which could lead to unexpected behavior. Instead, provide addresses as documented.</p>

<p><em>aledustet</em></p></li>
<li><p>Stub <code>Time.new()</code> in <code>TimeHelpers#travel_to</code></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_travel_to'>travel_to</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2004</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>24</span>) <span class='kw'>do</span>
  <span class='comment'># Inside the `travel_to` block {Time.new} is stubbed
</span>  <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='int'>2004</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_year'>year</span>
<span class='kw'>end</span></code></pre>

<p><em>fatkodima</em></p></li>
<li><p>Raise <a href="ActiveSupport/MessageEncryptor/InvalidMessage.html" title="ActiveSupport::MessageEncryptor::InvalidMessage (class)"><code>::ActiveSupport::MessageEncryptor::InvalidMessage</code></a> from
<a href="ActiveSupport/MessageEncryptor.html#decrypt_and_verify-instance_method" title="ActiveSupport::MessageEncryptor#decrypt_and_verify (method)">ActiveSupport::MessageEncryptor#decrypt_and_verify</a> regardless of cipher.
Previously, when a <code>MessageEncryptor</code> was using a non-AEAD cipher such as
AES-256-CBC, a corrupt or tampered message would raise
<a href="ActiveSupport/MessageVerifier/InvalidSignature.html" title="ActiveSupport::MessageVerifier::InvalidSignature (class)"><code>::ActiveSupport::MessageVerifier::InvalidSignature</code></a>.  Now, all ciphers raise
the same error:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_encryptor'>encryptor</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)">MessageEncryptor</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageEncryptor.html#new-class_method" title="ActiveSupport::MessageEncryptor.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>32</span><span class='comma'>,</span> <span class='label'>cipher:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-256-gcm</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_encryptor'>encryptor</span>.<span class='id identifier rubyid_encrypt_and_sign'>encrypt_and_sign</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_encryptor'>encryptor</span>.<span class='id identifier rubyid_decrypt_and_verify'>decrypt_and_verify</span>(<span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_next'>next</span>)
<span class='comment'># =&gt; raises ActiveSupport::MessageEncryptor::InvalidMessage
</span>
<span class='id identifier rubyid_encryptor'>encryptor</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)">MessageEncryptor</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageEncryptor.html#new-class_method" title="ActiveSupport::MessageEncryptor.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>32</span><span class='comma'>,</span> <span class='label'>cipher:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-256-cbc</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_encryptor'>encryptor</span>.<span class='id identifier rubyid_encrypt_and_sign'>encrypt_and_sign</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_encryptor'>encryptor</span>.<span class='id identifier rubyid_decrypt_and_verify'>decrypt_and_verify</span>(<span class='id identifier rubyid_message'>message</span>.<span class='id identifier rubyid_next'>next</span>)
<span class='comment'># BEFORE:
</span><span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature
</span><span class='comment'># AFTER:
</span><span class='comment'># =&gt; raises ActiveSupport::MessageEncryptor::InvalidMessage</span></code></pre>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Support <code>nil</code> original values when using <a href="ActiveSupport/MessageVerifier.html#verify-instance_method" title="ActiveSupport::MessageVerifier#verify (method)">ActiveSupport::MessageVerifier#verify</a>.
Previously, <code>MessageVerifier#verify</code> did not work with <code>nil</code> original
values, though both <code>MessageVerifier#verified</code> and
<code>MessageEncryptor#decrypt_and_verify</code> do:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_encryptor'>encryptor</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)">MessageEncryptor</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageEncryptor.html#new-class_method" title="ActiveSupport::MessageEncryptor.new (method)">new</a></span>(<span class='id identifier rubyid_secret'>secret</span>)
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_encryptor'>encryptor</span>.<span class='id identifier rubyid_encrypt_and_sign'>encrypt_and_sign</span>(<span class='kw'>nil</span>)

<span class='id identifier rubyid_encryptor'>encryptor</span>.<span class='id identifier rubyid_decrypt_and_verify'>decrypt_and_verify</span>(<span class='id identifier rubyid_message'>message</span>)
<span class='comment'># =&gt; nil
</span>
<span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)">MessageVerifier</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageVerifier.html#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='id identifier rubyid_secret'>secret</span>)
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='kw'>nil</span>)

<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verified'>verified</span>(<span class='id identifier rubyid_message'>message</span>)
<span class='comment'># =&gt; nil
</span>
<span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_verify'>verify</span>(<span class='id identifier rubyid_message'>message</span>)
<span class='comment'># BEFORE:
</span><span class='comment'># =&gt; raises ActiveSupport::MessageVerifier::InvalidSignature
</span><span class='comment'># AFTER:
</span><span class='comment'># =&gt; nil</span></code></pre>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Maintain <code>html_safe?</code> on html_safe strings when sliced with <code>slice</code>, <code>slice!</code>, or <code>chr</code> method.</p>

<p>Previously, <code>html_safe?</code> was only maintained when the html_safe strings were sliced
with <code>[]</code> method. Now, <code>slice</code>, <code>slice!</code>, and <code>chr</code> methods will maintain <code>html_safe?</code> like <code>[]</code> method.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;div&gt;test&lt;/div&gt;</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_html_safe'>html_safe</span>
<span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_slice'>slice</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_html_safe?'>html_safe?</span> <span class='comment'># =&gt; true
</span><span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_slice!'>slice!</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_html_safe?'>html_safe?</span> <span class='comment'># =&gt; true
</span><span class='comment'># maintain html_safe? after the slice!
</span><span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_html_safe?'>html_safe?</span> <span class='comment'># =&gt; true
</span><span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_chr'>chr</span>.<span class='id identifier rubyid_html_safe?'>html_safe?</span> <span class='comment'># =&gt; true</span></code></pre>

<p><em>Michael Go</em></p></li>
<li><p>Add <a href="Object.html#in%3F-instance_method" title="Object#in? (method)">Object#in?</a> support for open ranges.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert'>assert</span> <span class='const'><a href="Date.html" title="Date (class)">Date</a></span>.<span class='id identifier rubyid_today'>today</span>.<span class='id identifier rubyid_in?'>in?</span>(<span class='op'>..</span><span class='const'><a href="Date.html" title="Date (class)">Date</a></span>.<span class='id identifier rubyid_tomorrow'><a href="Date.html#tomorrow-class_method" title="Date.tomorrow (method)">tomorrow</a></span>)
<span class='id identifier rubyid_assert_not'>assert_not</span> <span class='const'><a href="Date.html" title="Date (class)">Date</a></span>.<span class='id identifier rubyid_today'>today</span>.<span class='id identifier rubyid_in?'>in?</span>(<span class='const'><a href="Date.html" title="Date (class)">Date</a></span>.<span class='id identifier rubyid_tomorrow'><a href="Date.html#tomorrow-class_method" title="Date.tomorrow (method)">tomorrow</a></span><span class='op'>..</span>)</code></pre>

<p><em>Ignacio Galindo</em></p></li>
<li><p><code>config.i18n.raise_on_missing_translations = true</code> now raises on any missing translation.</p>

<p>Previously it would only raise when called in a view or controller. Now it will raise
anytime <code>I18n.t</code> is provided an unrecognised key.</p>

<p>If you do not want this behaviour, you can customise the i18n exception handler. See the
upgrading guide or i18n guide for more information.</p>

<p><em>Alex Ghiculescu</em></p></li>
<li><p><a href="ActiveSupport/CurrentAttributes.html" title="ActiveSupport::CurrentAttributes (class)"><code>::ActiveSupport::CurrentAttributes</code></a> now raises if a restricted attribute name is used.</p>

<p>Attributes such as <code>set</code> and <code>reset</code> cannot be used as they clash with the
<code>CurrentAttributes</code> public API.</p>

<p><em>Alex Ghiculescu</em></p></li>
<li><p><code>HashWithIndifferentAccess#transform_keys</code> now takes a <a href="Hash.html" title="Hash (class)"><code>Hash</code></a> argument, just
as Ruby&#39;s <code>Hash#transform_keys</code> does.</p>

<p><em>Akira Matsuda</em></p></li>
<li><p><code>delegate</code> now defines method with proper arity when delegating to a <a href="Class.html" title="Class (class)"><code>Class</code></a>.
With this change, it defines faster method (3.5x faster with no argument).
However, in order to gain this benefit, the delegation target method has to
be defined before declaring the delegation.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># This defines 3.5 times faster method than before
</span><span class='kw'>class</span> <span class='const'>C</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_x'>x</span>() <span class='kw'>end</span>
  <span class='id identifier rubyid_delegate'>delegate</span> <span class='symbeg'>:</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='symbeg'>:</span><span class='kw'>class</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>C</span>
  <span class='comment'># This works but silently falls back to old behavior because
</span>  <span class='comment'># `delegate` cannot find the definition of `x`
</span>  <span class='id identifier rubyid_delegate'>delegate</span> <span class='symbeg'>:</span><span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='symbeg'>:</span><span class='kw'>class</span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_x'>x</span>() <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p><em>Akira Matsuda</em></p></li>
<li><p><code>assert_difference</code> message now includes what changed.</p>

<p>This makes it easier to debug non-obvious failures.</p>

<p>Before:</p>

<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User.count</span><span class='tstring_end'>&quot;</span></span> <span class='id identifier rubyid_didn'>didn</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>t change by 32.
Expected: 1611
  Actual: 1579</span></code></pre>

<p>After:</p>

<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User.count</span><span class='tstring_end'>&quot;</span></span> <span class='id identifier rubyid_didn'>didn</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>t change by 32, but by 0.
Expected: 1611
  Actual: 1579</span></code></pre>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Add ability to match exception messages to <code>assert_raises</code> assertion</p>

<p>Instead of this</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_raises'>assert_raises</span>(<span class='const'>ArgumentError</span>) <span class='kw'>do</span>
  <span class='id identifier rubyid_perform_service'>perform_service</span>(<span class='label'>param:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exception</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
<span class='id identifier rubyid_assert_match'>assert_match</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>incorrect param</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_message'>message</span>)</code></pre>

<p>you can now write this</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_assert_raises'>assert_raises</span>(<span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='label'>match:</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>incorrect param</span><span class='regexp_end'>/i</span></span>) <span class='kw'>do</span>
  <span class='id identifier rubyid_perform_service'>perform_service</span>(<span class='label'>param:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exception</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span></code></pre>

<p><em>fatkodima</em></p></li>
<li><p>Add <code>Rails.env.local?</code> shorthand for <code>Rails.env.development? || {Rails}.env.test?</code>.</p>

<p><em>DHH</em></p></li>
<li><p><a href="ActiveSupport/Testing/TimeHelpers.html" title="ActiveSupport::Testing::TimeHelpers (module)"><code>::ActiveSupport::Testing::TimeHelpers</code></a> now accepts named <code>with_usec</code> argument
to <code>freeze_time</code>, <code>travel</code>, and <code>travel_to</code> methods. Passing true prevents
truncating the destination time with <code>change(usec: 0)</code>.</p>

<p><em>KevSlashNull</em>, and <em>serprex</em></p></li>
<li><p><a href="ActiveSupport/CurrentAttributes.html#resets-class_method" title="ActiveSupport::CurrentAttributes.resets (method)">ActiveSupport::CurrentAttributes.resets</a> now accepts a method name</p>

<p>The block API is still the recommended approach, but now both APIs are supported:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Current</span> <span class='op'>&lt;</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/CurrentAttributes.html" title="ActiveSupport::CurrentAttributes (class)">CurrentAttributes</a></span>
  <span class='id identifier rubyid_resets'>resets</span> { <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span> <span class='op'>=</span> <span class='kw'>nil</span> }
  <span class='id identifier rubyid_resets'>resets</span> <span class='symbeg'>:</span><span class='id identifier rubyid_clear_time_zone'>clear_time_zone</span>
<span class='kw'>end</span></code></pre>

<p><em>Alex Ghiculescu</em></p></li>
<li><p>Ensure <a href="ActiveSupport/Testing/Isolation/Forking.html" title="ActiveSupport::Testing::Isolation::Forking (module)"><code>::ActiveSupport::Testing::Isolation::Forking</code></a> closes pipes</p>

<p>Previously, <code>Forking.run_in_isolation</code> opened two ends of a pipe. The fork
process closed the read end, wrote to it, and then terminated (which
presumably closed the file descriptors on its end). The parent process
closed the write end, read from it, and returned, never closing the read
end.</p>

<p>This resulted in an accumulation of open file descriptors, which could
cause errors if the limit is reached.</p>

<p><em>Sam Bostock</em></p></li>
<li><p>Fix <a href="Time.html#change-instance_method" title="Time#change (method)">Time#change</a> and <a href="Time.html#advance-instance_method" title="Time#advance (method)">Time#advance</a> for times around the end of Daylight
Saving Time.</p>

<p>Previously, when <a href="Time.html#change-instance_method" title="Time#change (method)">Time#change</a> or <a href="Time.html#advance-instance_method" title="Time#advance (method)">Time#advance</a> constructed a time inside
the final stretch of Daylight Saving Time (DST), the non-DST offset would
always be chosen for local times:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># DST ended just before 2021-11-07 2:00:00 AM in US/Eastern.
</span><span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TZ</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>US/Eastern</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_local'>local</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>07</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>59</span><span class='comma'>,</span> <span class='int'>59</span>) <span class='op'>+</span> <span class='int'>1</span>
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>seconds:</span> <span class='int'>0</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span>
<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_local'>local</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>06</span><span class='comma'>,</span> <span class='int'>01</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>00</span>)
<span class='comment'># =&gt; 2021-11-06 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>days:</span> <span class='int'>1</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500</span></code></pre>

<p>And the DST offset would always be chosen for times with a <code>TimeZone</code>
object:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>US/Eastern</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>07</span><span class='comma'>,</span> <span class='int'>02</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span>) <span class='op'>-</span> <span class='int'>3600</span>
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>seconds:</span> <span class='int'>0</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span>
<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>01</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span>)
<span class='comment'># =&gt; 2021-11-08 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>days:</span> <span class='op'>-</span><span class='int'>1</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400</span></code></pre>

<p>Now, <a href="Time.html#change-instance_method" title="Time#change (method)">Time#change</a> and <a href="Time.html#advance-instance_method" title="Time#advance (method)">Time#advance</a> will choose the offset that matches
the original time&#39;s offset when possible:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>ENV</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TZ</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>US/Eastern</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_local'>local</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>07</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>59</span><span class='comma'>,</span> <span class='int'>59</span>) <span class='op'>+</span> <span class='int'>1</span>
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>seconds:</span> <span class='int'>0</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span>
<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_local'>local</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>06</span><span class='comma'>,</span> <span class='int'>01</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>00</span>)
<span class='comment'># =&gt; 2021-11-06 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>days:</span> <span class='int'>1</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0400
</span>
<span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>US/Eastern</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>07</span><span class='comma'>,</span> <span class='int'>02</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span>) <span class='op'>-</span> <span class='int'>3600</span>
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>seconds:</span> <span class='int'>0</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span>
<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'>new</span>(<span class='int'>2021</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>01</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='int'>00</span><span class='comma'>,</span> <span class='const'><a href="Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="Time.html#zone-class_method" title="Time.zone (method)">zone</a></span>)
<span class='comment'># =&gt; 2021-11-08 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_change'>change</span>(<span class='label'>day:</span> <span class='int'>07</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500
</span><span class='id identifier rubyid_time'>time</span>.<span class='id identifier rubyid_advance'>advance</span>(<span class='label'>days:</span> <span class='op'>-</span><span class='int'>1</span>)
<span class='comment'># =&gt; 2021-11-07 01:00:00 -0500</span></code></pre>

<p><em>Kevin Hall</em>, <em>Takayoshi Nishida</em>, and <em>Jonathan Hefner</em></p></li>
<li><p>Fix MemoryStore to preserve entries TTL when incrementing or decrementing</p>

<p>This is to be more consistent with how MemCachedStore and RedisCacheStore behaves.</p>

<p><em>Jean Boussier</em></p></li>
<li><p><code>Rails.error.handle</code> and <code>Rails.error.record</code> filter now by multiple error classes.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_error'><a href="Rails.html#error-class_method" title="Rails.error (method)">error</a></span>.<span class='id identifier rubyid_handle'>handle</span>(<span class='const'>IOError</span><span class='comma'>,</span> <span class='const'>ArgumentError</span>) <span class='kw'>do</span>
  <span class='int'>1</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># raises TypeError
</span><span class='kw'>end</span>
<span class='int'>1</span> <span class='op'>+</span> <span class='int'>1</span> <span class='comment'># TypeErrors are not IOErrors or ArgumentError, so this will *not* be handled</span></code></pre>

<p><em>Martin Spickermann</em></p></li>
<li><p><a href="Class.html#subclasses-instance_method" title="Class#subclasses (method)">Class#subclasses</a> and <a href="Class.html#descendants-instance_method" title="Class#descendants (method)">Class#descendants</a> now automatically filter reloaded classes.</p>

<p>Previously they could return old implementations of reloadable classes that have been
dereferenced but not yet garbage collected.</p>

<p>They now automatically filter such classes like <code>DescendantTracker#subclasses</code> and
<code>DescendantTracker#descendants</code>.</p>

<p><em>Jean Boussier</em></p></li>
<li><p><code>Rails.error.report</code> now marks errors as reported to avoid reporting them twice.</p>

<p>In some cases, users might want to report errors explicitly with some extra context
before letting it bubble up.</p>

<p>This also allows to safely catch and report errors outside of the execution context.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Add <code>assert_error_reported</code> and <code>assert_no_error_reported</code></p>

<p>Allows to easily asserts an error happened but was handled</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_error_reported'>assert_error_reported</span>(<span class='const'>IOError</span>) <span class='kw'>do</span>
  <span class='comment'># ...
</span><span class='kw'>end</span>
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Oops</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_message'>message</span>
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_context'>context</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_section'>section</span>]
<span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='symbeg'>:</span><span class='id identifier rubyid_warning'>warning</span><span class='comma'>,</span> <span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_severity'>severity</span>
<span class='id identifier rubyid_assert_predicate'>assert_predicate</span> <span class='id identifier rubyid_report'>report</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_handled?'>handled?</span></code></pre>

<p><em>Jean Boussier</em></p></li>
<li><p><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a> behavior callbacks can now receive the
deprecator instance as an argument.  This makes it easier for such callbacks
to change their behavior based on the deprecator&#39;s state.  For example,
based on the deprecator&#39;s <code>debug</code> flag.</p>

<p>3-arity and splat-args callbacks such as the following will now be passed
the deprecator instance as their third argument:</p>

<ul>
<li><code>-&gt;(message, callstack, deprecator) { ... }</code></li>
<li><code>-&gt;(*args) { ... }</code></li>
<li><code>-&gt;(message, *other_args) { ... }</code></li>
</ul>

<p>2-arity and 4-arity callbacks such as the following will continue to behave
the same as before:</p>

<ul>
<li><code>-&gt;(message, callstack) { ... }</code></li>
<li><code>-&gt;(message, callstack, deprecation_horizon, gem_name) { ... }</code></li>
<li><code>-&gt;(message, callstack, *deprecation_details) { ... }</code></li>
</ul>

<p><em>Jonathan Hefner</em></p></li>
<li><p><code>ActiveSupport::Deprecation#disallowed_warnings</code> now affects the instance on
which it is configured.</p>

<p>This means that individual <a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a> instances can be
configured with their own disallowed warnings, and the global
<code>ActiveSupport::Deprecation.disallowed_warnings</code> now only affects the global
<code>ActiveSupport::Deprecation.warn</code>.</p>

<p><strong>Before</strong></p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_disallowed_warnings'><a href="ActiveSupport/Deprecation/Disallowed.html#disallowed_warnings-instance_method" title="ActiveSupport::Deprecation::Disallowed#disallowed_warnings (method)">disallowed_warnings</a></span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>]
<span class='id identifier rubyid_deprecator'>deprecator</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/Deprecation.html#new-class_method" title="ActiveSupport::Deprecation.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2.0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MyCoolGem</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_deprecator'>deprecator</span>.<span class='id identifier rubyid_disallowed_warnings'>disallowed_warnings</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>]

<span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_warn'><a href="ActiveSupport/Deprecation/Reporting.html#warn-instance_method" title="ActiveSupport::Deprecation::Reporting#warn (method)">warn</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; raise ActiveSupport::DeprecationException
</span><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_warn'><a href="ActiveSupport/Deprecation/Reporting.html#warn-instance_method" title="ActiveSupport::Deprecation::Reporting#warn (method)">warn</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; print &quot;DEPRECATION WARNING: bar&quot;
</span><span class='id identifier rubyid_deprecator'>deprecator</span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>)                 <span class='comment'># =&gt; raise ActiveSupport::DeprecationException
</span><span class='id identifier rubyid_deprecator'>deprecator</span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>)                 <span class='comment'># =&gt; print &quot;DEPRECATION WARNING: bar&quot;</span></code></pre>

<p><strong>After</strong></p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_disallowed_warnings'><a href="ActiveSupport/Deprecation/Disallowed.html#disallowed_warnings-instance_method" title="ActiveSupport::Deprecation::Disallowed#disallowed_warnings (method)">disallowed_warnings</a></span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>]
<span class='id identifier rubyid_deprecator'>deprecator</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/Deprecation.html#new-class_method" title="ActiveSupport::Deprecation.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2.0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MyCoolGem</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_deprecator'>deprecator</span>.<span class='id identifier rubyid_disallowed_warnings'>disallowed_warnings</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>]

<span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_warn'><a href="ActiveSupport/Deprecation/Reporting.html#warn-instance_method" title="ActiveSupport::Deprecation::Reporting#warn (method)">warn</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; raise ActiveSupport::DeprecationException
</span><span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)">Deprecation</a></span>.<span class='id identifier rubyid_warn'><a href="ActiveSupport/Deprecation/Reporting.html#warn-instance_method" title="ActiveSupport::Deprecation::Reporting#warn (method)">warn</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># =&gt; print &quot;DEPRECATION WARNING: bar&quot;
</span><span class='id identifier rubyid_deprecator'>deprecator</span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>)                 <span class='comment'># =&gt; print &quot;DEPRECATION WARNING: foo&quot;
</span><span class='id identifier rubyid_deprecator'>deprecator</span>.<span class='id identifier rubyid_warn'>warn</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>)                 <span class='comment'># =&gt; raise ActiveSupport::DeprecationException</span></code></pre>

<p>Note that global <a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a> methods such as <code>ActiveSupport::Deprecation.warn</code>
and <code>ActiveSupport::Deprecation.disallowed_warnings</code> have been deprecated.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Add italic and underline support to <a href="ActiveSupport/LogSubscriber.html#color-instance_method" title="ActiveSupport::LogSubscriber#color (method)">ActiveSupport::LogSubscriber#color</a></p>

<p>Previously, only bold text was supported via a positional argument.
This allows for bold, italic, and underline options to be specified
for colored logs.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_info'>info</span> <span class='id identifier rubyid_color'>color</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello world!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_red'>red</span><span class='comma'>,</span> <span class='label'>bold:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>underline:</span> <span class='kw'>true</span>)</code></pre>

<p><em>Gannon McGibbon</em></p></li>
<li><p>Add <a href="String.html#downcase_first-instance_method" title="String#downcase_first (method)">String#downcase_first</a> method.</p>

<p>This method is the corollary of <a href="String.html#upcase_first-instance_method" title="String#upcase_first (method)">String#upcase_first</a>.</p>

<p><em>Mark Schneider</em></p></li>
<li><p><code>thread_mattr_accessor</code> will call <code>.dup.freeze</code> on non-frozen default values.</p>

<p>This provides a basic level of protection against different threads trying
to mutate a shared default object.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Add <code>raise_on_invalid_cache_expiration_time</code> config to <a href="ActiveSupport/Cache/Store.html" title="ActiveSupport::Cache::Store (class)"><code>::ActiveSupport::Cache::Store</code></a></p>

<p>Specifies if an <code>ArgumentError</code> should be raised if <a href="Rails.html#cache-class_method" title="Rails.cache (method)">Rails.cache</a> <code>fetch</code> or
<code>write</code> are given an invalid <code>expires_at</code> or <code>expires_in</code> time.</p>

<p>Options are <code>true</code>, and <code>false</code>. If <code>false</code>, the exception will be reported
as <code>handled</code> and logged instead. Defaults to <code>true</code> if <code>config.load_defaults &gt;= 7.1</code>.</p>

<p><em>Trevor Turk</em></p></li>
<li><p><a href="ActiveSupport/Cache/Store.html#fetch-instance_method" title="ActiveSupport::Cache::Store#fetch (method)">ActiveSupport::Cache::Store#fetch</a> now passes an options accessor to the block.</p>

<p>It makes possible to override cache options:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="Rails.html" title="Rails (module)">Rails</a></span>.<span class='id identifier rubyid_cache'><a href="Rails.html#cache-class_method" title="Rails.cache (method)">cache</a></span>.<span class='id identifier rubyid_fetch'>fetch</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>3rd-party-token</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>|</span>
  <span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_token_from_remote'>fetch_token_from_remote</span>
  <span class='comment'># set cache&#39;s TTL to match token&#39;s TTL
</span>  <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_expires_in'>expires_in</span> <span class='op'>=</span> <span class='id identifier rubyid_token'>token</span>.<span class='id identifier rubyid_expires_in'>expires_in</span>
  <span class='id identifier rubyid_token'>token</span>
<span class='kw'>end</span></code></pre>

<p><em>Andrii Gladkyi</em>, <em>Jean Boussier</em></p></li>
<li><p><code>default</code> option of <code>thread_mattr_accessor</code> now applies through inheritance and
also across new threads.</p>

<p>Previously, the <code>default</code> value provided was set only at the moment of defining
the attribute writer, which would cause the attribute to be uninitialized in
descendants and in other threads.</p>

<p>Fixes #43312.</p>

<p><em>Thierry Deo</em></p></li>
<li><p>Redis cache store is now compatible with redis-rb 5.0.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Add <code>skip_nil:</code> support to <a href="ActiveSupport/Cache/Store.html#fetch_multi-instance_method" title="ActiveSupport::Cache::Store#fetch_multi (method)">ActiveSupport::Cache::Store#fetch_multi</a>.</p>

<p><em>Daniel Alfaro</em></p></li>
<li><p>Add <code>quarter</code> method to date/time</p>

<p><em>Matt Swanson</em></p></li>
<li><p>Fix <code>NoMethodError</code> on custom <a href="ActiveSupport/Deprecation.html" title="ActiveSupport::Deprecation (class)"><code>::ActiveSupport::Deprecation</code></a> behavior.</p>

<p><code>ActiveSupport::Deprecation.behavior=</code> was supposed to accept any object
that responds to <code>call</code>, but in fact its internal implementation assumed that
this object could respond to <code>arity</code>, so it was restricted to only <code>Proc</code> objects.</p>

<p>This change removes this <code>arity</code> restriction of custom behaviors.</p>

<p><em>Ryo Nakamura</em></p></li>
<li><p>Support <code>:url_safe</code> option for <code>MessageEncryptor</code>.</p>

<p>The <code>MessageEncryptor</code> constructor now accepts a <code>:url_safe</code> option, similar
to the <code>MessageVerifier</code> constructor.  When enabled, this option ensures
that messages use a URL-safe encoding.</p>

<p><em>Jonathan Hefner</em></p></li>
<li><p>Add <code>url_safe</code> option to <a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a> initializer</p>

<p><a href="ActiveSupport/MessageVerifier.html#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">ActiveSupport::MessageVerifier.new</a> now takes optional <code>url_safe</code> argument.
It can generate URL-safe strings by passing <code>url_safe: true</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_verifier'>verifier</span> <span class='op'>=</span> <span class='const'><a href="ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)">MessageVerifier</a></span>.<span class='id identifier rubyid_new'><a href="ActiveSupport/MessageVerifier.html#new-class_method" title="ActiveSupport::MessageVerifier.new (method)">new</a></span>(<span class='label'>url_safe:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_verifier'>verifier</span>.<span class='id identifier rubyid_generate'>generate</span>(<span class='id identifier rubyid_data'>data</span>) <span class='comment'># =&gt; URL-safe string</span></code></pre>

<p>This option is <code>false</code> by default to be backwards compatible.</p>

<p><em>Shouichi Kamiya</em></p></li>
<li><p>Enable connection pooling by default for <code>MemCacheStore</code> and <code>RedisCacheStore</code>.</p>

<p>If you want to disable connection pooling, set <code>:pool</code> option to <code>false</code> when configuring the cache store:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_cache_store'>cache_store</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_mem_cache_store'>mem_cache_store</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cache.example.com</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>pool:</span> <span class='kw'>false</span></code></pre>

<p><em>fatkodima</em></p></li>
<li><p>Add <code>force:</code> support to <a href="ActiveSupport/Cache/Store.html#fetch_multi-instance_method" title="ActiveSupport::Cache::Store#fetch_multi (method)">ActiveSupport::Cache::Store#fetch_multi</a>.</p>

<p><em>fatkodima</em></p></li>
<li><p>Deprecated <code>:pool_size</code> and <code>:pool_timeout</code> options for configuring connection pooling in cache stores.</p>

<p>Use <code>pool: true</code> to enable pooling with default settings:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_cache_store'>cache_store</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redis_cache_store'>redis_cache_store</span><span class='comma'>,</span> <span class='label'>pool:</span> <span class='kw'>true</span></code></pre>

<p>Or pass individual options via <code>:pool</code> option:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span>.<span class='id identifier rubyid_cache_store'>cache_store</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_redis_cache_store'>redis_cache_store</span><span class='comma'>,</span> <span class='label'>pool:</span> { <span class='label'>size:</span> <span class='int'>10</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='int'>2</span> }</code></pre>

<p><em>fatkodima</em></p></li>
<li><p>Allow #increment and #decrement methods of <a href="ActiveSupport/Cache/Store.html" title="ActiveSupport::Cache::Store (class)"><code>::ActiveSupport::Cache::Store</code></a>
subclasses to set new values.</p>

<p>Previously incrementing or decrementing an unset key would fail and return
nil. A default will now be assumed and the key will be created.</p>

<p><em>Andrej Blagojević</em>, <em>Eugene Kenny</em></p></li>
<li><p>Add <code>skip_nil:</code> support to <code>RedisCacheStore</code></p>

<p><em>Joey Paris</em></p></li>
<li><p><code>ActiveSupport::Cache::MemoryStore#write(name, val, unless_exist:true)</code> now
correctly writes expired keys.</p>

<p><em>Alan Savage</em></p></li>
<li><p><a href="ActiveSupport/ErrorReporter.html" title="ActiveSupport::ErrorReporter (class)"><code>::ActiveSupport::ErrorReporter</code></a> now accepts and forward a <code>source:</code> parameter.</p>

<p>This allow libraries to signal the origin of the errors, and reporters
to easily ignore some sources.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Fix and add protections for XSS in <a href="ActionView/Helpers.html" title="ActionView::Helpers (module)"><code>::ActionView::Helpers</code></a> and <a href="ERB/Util.html" title="ERB::Util (module)"><code>::ERB::Util</code></a>.</p>

<p>Add the method <a href="ERB/Util.html#xml_name_escape-class_method" title="ERB::Util.xml_name_escape (method)">ERB::Util.xml_name_escape</a> to escape dangerous characters
in names of tags and names of attributes, following the specification of XML.</p>

<p><em>Álvaro Martín Fraguas</em></p></li>
<li><p>Respect <a href="ActiveSupport/Logger.html#new-class_method" title="ActiveSupport::Logger.new (method)">ActiveSupport::Logger.new</a>&#39;s <code>:formatter</code> keyword argument</p>

<p>The stdlib <code>Logger::new</code> allows passing a <code>:formatter</code> keyword argument to
set the logger&#39;s formatter. Previously <a href="ActiveSupport/Logger.html#new-class_method" title="ActiveSupport::Logger.new (method)">ActiveSupport::Logger.new</a> ignored
that argument by always setting the formatter to an instance of
<a href="ActiveSupport/Logger/SimpleFormatter.html" title="ActiveSupport::Logger::SimpleFormatter (class)"><code>::ActiveSupport::Logger::SimpleFormatter</code></a>.</p>

<p><em>Steven Harman</em></p></li>
<li><p>Deprecate preserving the pre-Ruby 2.4 behavior of <code>to_time</code></p>

<p>With Ruby 2.4+ the default for <code>to_time</code> changed from converting to the
local system time to preserving the offset of the receiver. At the time Rails
supported older versions of Ruby so a compatibility layer was added to assist
in the migration process. From Rails 5.0 new applications have defaulted to
the Ruby 2.4+ behavior and since Rails 7.0 now only supports Ruby 2.7+
this compatibility layer can be safely removed.</p>

<p>To minimize any noise generated the deprecation warning only appears when the
setting is configured to <code>false</code> as that is the only scenario where the
removal of the compatibility layer has any effect.</p>

<p><em>Andrew White</em></p></li>
<li><p><a href="Pathname.html#blank%3F-instance_method" title="Pathname#blank? (method)">Pathname#blank?</a> only returns true for <code>Pathname.new("")</code></p>

<p>Previously it would end up calling <code>Pathname#empty?</code> which returned true
if the path existed and was an empty directory or file.</p>

<p>That behavior was unlikely to be expected.</p>

<p><em>Jean Boussier</em></p></li>
<li><p>Deprecate <code>Notification::Event</code>&#39;s <code>#children</code> and <code>#parent_of?</code></p>

<p><em>John Hawthorn</em></p></li>
<li><p>Change the default serializer of <a href="ActiveSupport/MessageVerifier.html" title="ActiveSupport::MessageVerifier (class)"><code>::ActiveSupport::MessageVerifier</code></a> from
<code>Marshal</code> to <a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a> when using <code>config.load_defaults 7.1</code>.</p>

<p>Messages serialized with <code>Marshal</code> can still be read, but new messages will
be serialized with <a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a>. For more information, see
<a href="https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer">https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer</a>.</p>

<p><em>Saba Kiaei</em>, <em>David Buckley</em>, and <em>Jonathan Hefner</em></p></li>
<li><p>Change the default serializer of <a href="ActiveSupport/MessageEncryptor.html" title="ActiveSupport::MessageEncryptor (class)"><code>::ActiveSupport::MessageEncryptor</code></a> from
<code>Marshal</code> to <a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a> when using <code>config.load_defaults 7.1</code>.</p>

<p>Messages serialized with <code>Marshal</code> can still be read, but new messages will
be serialized with <a href="ActiveSupport/JSON.html" title="ActiveSupport::JSON (module)"><code>::ActiveSupport::JSON</code></a>. For more information, see
<a href="https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer">https://guides.rubyonrails.org/v7.1/configuring.html#config-active-support-message-serializer</a>.</p>

<p><em>Zack Deveau</em>, <em>Martin Gingras</em>, and <em>Jonathan Hefner</em></p></li>
<li><p>Add <code>ActiveSupport::TestCase#stub_const</code> to stub a constant for the duration of a yield.</p>

<p><em>DHH</em></p></li>
<li><p>Fix <a href="ActiveSupport/EncryptedConfiguration.html" title="ActiveSupport::EncryptedConfiguration (class)"><code>::ActiveSupport::EncryptedConfiguration</code></a> to be compatible with Psych 4</p>

<p><em>Stephen Sugden</em></p></li>
<li><p>Improve <a href="File.html#atomic_write-class_method" title="File.atomic_write (method)">File.atomic_write</a> error handling</p>

<p><em>Daniel Pepper</em></p></li>
<li><p>Fix <a href="Class.html#descendants-instance_method" title="Class#descendants (method)">Class#descendants</a> and <code>DescendantsTracker#descendants</code> compatibility with Ruby 3.1.</p>

<p><a href="https://bugs.ruby-lang.org/issues/14394#note-33">The native <a href="Class.html#descendants-instance_method" title="Class#descendants (method)">Class#descendants</a> was reverted prior to Ruby 3.1 release</a>,
but <a href="Class.html#subclasses-instance_method" title="Class#subclasses (method)">Class#subclasses</a> was kept, breaking the feature detection.</p>

<p><em>Jean Boussier</em></p></li>
</ul>

<p>Please check [7-0-stable]) for previous changes.</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>