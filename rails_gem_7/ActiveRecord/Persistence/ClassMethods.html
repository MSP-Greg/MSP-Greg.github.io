<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Persistence::ClassMethods &mdash; Rails 7.2.2.2</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Persistence::ClassMethods",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 7.2.2.2</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../Persistence.html" title="ActiveRecord::Persistence (module)">Persistence</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::Persistence::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L10'>activerecord/lib/active_record/persistence.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#build-instance_method" title="#build (instance method)">#<strong>build</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Builds an object (or multiple objects) and returns either the built object or a list of built objects.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates an object (or multiple objects) and saves it to the database, if validations pass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create!-instance_method" title="#create! (instance method)">#<strong>create!</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates an object (or multiple objects) and saves it to the database, if validations pass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#instantiate-instance_method" title="#instantiate (instance method)">#<strong>instantiate</strong>(attributes, column_types = {}, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Given an attributes hash, <a href="#instantiate-instance_method" title="ActiveRecord::Persistence::ClassMethods#instantiate (method)">#instantiate</a> returns a new instance of the appropriate class.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#query_constraints-instance_method" title="#query_constraints (instance method)">#<strong>query_constraints</strong>(*columns_list)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Accepts a list of attribute names to be used in the WHERE clause of SELECT / UPDATE / DELETE queries and in the ORDER BY clause for <code>#first</code> and <code>#last</code> finder methods.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(id = :all, attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates an object (or multiple objects) and saves it to the database, if validations pass.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update!-instance_method" title="#update! (instance method)">#<strong>update!</strong>(id = :all, attributes)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the object (or multiple objects) just like <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a> but calls <a href="#update!-instance_method" title="ActiveRecord::Persistence::ClassMethods#update! (method)">#update!</a> instead of <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a>, so an exception is raised if the record is invalid and saving will fail.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="build-instance_method">
  <h3 class='signature  first'>
    #<strong>build</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Builds an object (or multiple objects) and returns either the built object or a list of built objects.</p>

<p>The <code>attributes</code> parameter can be either a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> or an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. These Hashes describe the attributes on the objects that are to be built.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Build a single new object
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Build an Array of new objects
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }])

<span class='comment'># Build a single object and pass it into a block to set other attributes.
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>

<span class='comment'># Building an Array of new objects using a block, where the block is executed for each object:
</span><span class='const'>User</span>.<span class='id identifier rubyid_build'>build</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L82-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='82' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 82</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build'>build</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_build'>build</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create-instance_method">
  <h3 class='signature '>
    #<strong>create</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was saved successfully to the database or not.</p>

<p>The <code>attributes</code> parameter can be either a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> or an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. These Hashes describe the attributes on the objects that are to be created.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Create a single new object
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Create an Array of new objects
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }])

<span class='comment'># Create a single object and pass it into a block to set other attributes.
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>

<span class='comment'># Creating an Array of new objects using a block, where the block is executed for each object:
</span><span class='const'>User</span>.<span class='id identifier rubyid_create'>create</span>([{ <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jamie</span><span class='tstring_end'>&#39;</span></span> }<span class='comma'>,</span> { <span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&#39;</span></span> }]) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
  <span class='id identifier rubyid_u'>u</span>.<span class='id identifier rubyid_is_admin'>is_admin</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L33-L41'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='33' data-end='41'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 33</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_save'><a href="../Persistence.html#save-instance_method" title="ActiveRecord::Persistence#save (method)">save</a></span>
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create!-instance_method">
  <h3 class='signature '>
    #<strong>create!</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates an object (or multiple objects) and saves it to the database, if validations pass. Raises a <a href="../RecordInvalid.html" title="ActiveRecord::RecordInvalid (class)"><code>::ActiveRecord::RecordInvalid</code></a> error if validations fail, unlike <code>Base#create</code>.</p>

<p>The <code>attributes</code> parameter can be either a <a href="../../Hash.html" title="Hash (class)"><code>::Hash</code></a> or an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. These describe which attributes to be created on the object, or multiple objects when given an <a href="../../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L50-L58'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='58'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create!'>create!</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_create!'>create!</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_save!'><a href="../Persistence.html#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">save!</a></span>
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instantiate-instance_method">
  <h3 class='signature '>
    #<strong>instantiate</strong>(attributes, column_types = {}, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given an attributes hash, <code>instantiate</code> returns a new instance of the appropriate class. Accepts only keys as strings.</p>

<p>For example, <code>Post.all</code> may return Comments, Messages, and Emails by storing the record’s subclass in a <code>type</code> attribute. By calling <code>instantiate</code> instead of <code>new</code>, finder methods ensure they get new instances of the appropriate class for each record.</p>

<p>See <code>ActiveRecord::Inheritance#discriminate_class_for_record</code> to see how this “single-table” inheritance mapping is implemented.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L100-L103'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='100' data-end='103'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 100</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instantiate'>instantiate</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span> <span class='op'>=</span> {}<span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='id identifier rubyid_discriminate_class_for_record'>discriminate_class_for_record</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='id identifier rubyid_instantiate_instance_of'>instantiate_instance_of</span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='id identifier rubyid_column_types'>column_types</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="query_constraints-instance_method">
  <h3 class='signature '>
    #<strong>query_constraints</strong>(*columns_list)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Accepts a list of attribute names to be used in the WHERE clause of SELECT / UPDATE / DELETE queries and in the ORDER BY clause for <code>#first</code> and <code>#last</code> finder methods.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Developer</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_query_constraints'>query_constraints</span> <span class='symbeg'>:</span><span class='id identifier rubyid_company_id'>company_id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_developer'>developer</span> <span class='op'>=</span> <span class='const'>Developer</span>.<span class='id identifier rubyid_first'>first</span>
<span class='comment'># SELECT &quot;developers&quot;.* FROM &quot;developers&quot; ORDER BY &quot;developers&quot;.&quot;company_id&quot; ASC, &quot;developers&quot;.&quot;id&quot; ASC LIMIT 1
</span><span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_inspect'>inspect</span> <span class='comment'># =&gt; #&lt;Developer id: 1, company_id: 1, ...&gt;
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_update!'><a href="#update!-instance_method" title="ActiveRecord::Persistence::ClassMethods#update! (method)">update!</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Nikita</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># UPDATE &quot;developers&quot; SET &quot;name&quot; = &#39;Nikita&#39; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='comment'># It is possible to update an attribute used in the query_constraints clause:
</span><span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_update!'><a href="#update!-instance_method" title="ActiveRecord::Persistence::ClassMethods#update! (method)">update!</a></span>(<span class='label'>company_id:</span> <span class='int'>2</span>)
<span class='comment'># UPDATE &quot;developers&quot; SET &quot;company_id&quot; = 2 WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_save!'><a href="../Persistence.html#save!-instance_method" title="ActiveRecord::Persistence#save! (method)">save!</a></span>
<span class='comment'># UPDATE &quot;developers&quot; SET &quot;name&quot; = &#39;Bob&#39; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_destroy!'><a href="../Persistence.html#destroy!-instance_method" title="ActiveRecord::Persistence#destroy! (method)">destroy!</a></span>
<span class='comment'># DELETE FROM &quot;developers&quot; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_delete'><a href="../Persistence.html#delete-instance_method" title="ActiveRecord::Persistence#delete (method)">delete</a></span>
<span class='comment'># DELETE FROM &quot;developers&quot; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1
</span>
<span class='id identifier rubyid_developer'>developer</span>.<span class='id identifier rubyid_reload'><a href="../Persistence.html#reload-instance_method" title="ActiveRecord::Persistence#reload (method)">reload</a></span>
<span class='comment'># SELECT &quot;developers&quot;.* FROM &quot;developers&quot; WHERE &quot;developers&quot;.&quot;company_id&quot; = 1 AND &quot;developers&quot;.&quot;id&quot; = 1 LIMIT 1</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L212-L217'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='212' data-end='217'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 212</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_query_constraints'>query_constraints</span>(<span class='op'>*</span><span class='id identifier rubyid_columns_list'>columns_list</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must specify at least one column to be used in querying</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_columns_list'>columns_list</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='ivar'>@query_constraints_list</span> <span class='op'>=</span> <span class='id identifier rubyid_columns_list'>columns_list</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span>)
  <span class='ivar'>@has_query_constraints</span> <span class='op'>=</span> <span class='ivar'>@query_constraints_list</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update-instance_method">
  <h3 class='signature '>
    #<strong>update</strong>(id = :all, attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates an object (or multiple objects) and saves it to the database, if validations pass. The resulting object is returned whether the object was saved successfully to the database or not.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>id</code> - This should be the id or an array of ids to be updated. Optional argument, defaults to all records in the relation.</p>
</li><li>
<p><code>attributes</code> - This should be a hash of attributes or an array of hashes.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Updates one record
</span><span class='const'>Person</span>.<span class='id identifier rubyid_update'>update</span>(<span class='int'>15</span><span class='comma'>,</span> <span class='label'>user_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Samuel</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expert</span><span class='tstring_end'>&quot;</span></span>)

<span class='comment'># Updates multiple records
</span><span class='id identifier rubyid_people'>people</span> <span class='op'>=</span> { <span class='int'>1</span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>first_name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span> <span class='int'>2</span> <span class='op'>=&gt;</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>first_name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Jeremy</span><span class='tstring_end'>&quot;</span></span> } }
<span class='const'>Person</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_people'>people</span>.<span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='id identifier rubyid_people'>people</span>.<span class='id identifier rubyid_values'>values</span>)

<span class='comment'># Updates multiple records from the result of a relation
</span><span class='id identifier rubyid_people'>people</span> <span class='op'>=</span> <span class='const'>Person</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expert</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_people'>people</span>.<span class='id identifier rubyid_update'>update</span>(<span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>masters</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<p>Note: Updating a large number of records will run an UPDATE query for each record, which may cause a performance issue. When running callbacks is not needed for each record update, it is preferred to use <a href="../Relation.html#update_all-instance_method" title="ActiveRecord::Relation#update_all (method)">update_all</a> for updating all records in a single query.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L132-L154'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='132' data-end='154'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 132</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_any?'>any?</span>(<span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an array of ActiveRecord::Base instances to `update`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the ids of the objects by calling `pluck(:id)` or `map(&amp;:id)`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_one_id'>one_id</span><span class='op'>|</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_one_id'>one_id</span>) }.<span class='id identifier rubyid_each_with_index'>each_with_index</span> { <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>[<span class='id identifier rubyid_idx'>idx</span>])
    }
  <span class='kw'>elsif</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>
    <span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>) }
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span> <span class='op'>===</span> <span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an instance of ActiveRecord::Base to `update`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the id of the object by calling `.id`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update'>update</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update!-instance_method">
  <h3 class='signature '>
    #<strong>update!</strong>(id = :all, attributes)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the object (or multiple objects) just like <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a> but calls <code>#update!</code> instead of <a href="#update-instance_method" title="ActiveRecord::Persistence::ClassMethods#update (method)">#update</a>, so an exception is raised if the record is invalid and saving will fail.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.2.2/activerecord/lib/active_record/persistence.rb#L158-L180'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='158' data-end='180'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/persistence.rb', line 158</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Array.html" title="Array (class)">Array</a></span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_any?'>any?</span>(<span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an array of ActiveRecord::Base instances to `update!`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the ids of the objects by calling `pluck(:id)` or `map(&amp;:id)`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_one_id'>one_id</span><span class='op'>|</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_one_id'>one_id</span>) }.<span class='id identifier rubyid_each_with_index'>each_with_index</span> { <span class='op'>|</span><span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>[<span class='id identifier rubyid_idx'>idx</span>])
    }
  <span class='kw'>elsif</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>
    <span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_record'>record</span><span class='op'>|</span> <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>) }
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='const'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActiveRecord::Base (class)">Base</a></span> <span class='op'>===</span> <span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You are passing an instance of ActiveRecord::Base to `update!`. </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please pass the id of the object by calling `.id`.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>)
    <span class='id identifier rubyid_object'>object</span>.<span class='id identifier rubyid_update!'>update!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='id identifier rubyid_object'>object</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>