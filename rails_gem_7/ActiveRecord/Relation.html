<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveRecord::Relation &mdash; Rails 7.2.3</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Relation",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails 7.2.3</a> &raquo; 
      <a href='../_index.html#alpha_R'>Index (R)</a> &raquo; 
        <a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Relation&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveRecord::Relation</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="Relation/RecordFetchWarning.html" title="ActiveRecord::Relation::RecordFetchWarning (module)"><code>RecordFetchWarning</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Extension / Inclusion / Inheritance Descendants</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Subclasses:</div>
        <div class='box_22'>
          <span class='nodoc_h'>ActiveRecord::AssociationRelation</span>, <span class='nodoc_h'>ActiveRecord::DisableJoinsAssociationRelation</span>, <a href="Associations/CollectionProxy.html" title="ActiveRecord::Associations::CollectionProxy (class)">Associations::CollectionProxy</a>
        </div>
      </td>
    </tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="TokenFor/RelationMethods.html" title="ActiveRecord::TokenFor::RelationMethods (module)"><code>TokenFor::RelationMethods</code></a>,
          <a href="FinderMethods.html" title="ActiveRecord::FinderMethods (module)"><code>FinderMethods</code></a>,
          <a href="Calculations.html" title="ActiveRecord::Calculations (module)"><code>Calculations</code></a>,
          <a href="SpawnMethods.html" title="ActiveRecord::SpawnMethods (module)"><code>SpawnMethods</code></a>,
          <a href="QueryMethods.html" title="ActiveRecord::QueryMethods (module)"><code>QueryMethods</code></a>,
          <a href="Batches.html" title="ActiveRecord::Batches (module)"><code>Batches</code></a>,
          <a href="Explain.html" title="ActiveRecord::Explain (module)"><code>Explain</code></a>,
          <a href="../Enumerable.html" title="Enumerable (module)"><code>::Enumerable</code></a>,
          <a href="../ActiveSupport/EnumerableCoreExt/Constants.html" title="ActiveSupport::EnumerableCoreExt::Constants (module)"><code>::ActiveSupport::EnumerableCoreExt::Constants</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L5'>activerecord/lib/active_record/relation.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation/from_clause.rb#L4'>activerecord/lib/active_record/relation/from_clause.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation/merger.rb#L6'>activerecord/lib/active_record/relation/merger.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation/query_attribute.rb#L6'>activerecord/lib/active_record/relation/query_attribute.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation/record_fetch_warning.rb#L4'>activerecord/lib/active_record/relation/record_fetch_warning.rb</a>,<br/> <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation/where_clause.rb#L6'>activerecord/lib/active_record/relation/where_clause.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='CLAUSE_METHODS-constant' class='summary_signature'>CLAUSE_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L62-L62'># File 'activerecord/lib/active_record/relation.rb', line 62</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_where'>where</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_having'>having</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_from'>from</span>]</pre>
  </li>
  <li>
    <span id='INVALID_METHODS_FOR_DELETE_ALL-constant' class='summary_signature'>INVALID_METHODS_FOR_DELETE_ALL =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L63-L63'># File 'activerecord/lib/active_record/relation.rb', line 63</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_distinct'>distinct</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_with'>with</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_with_recursive'>with_recursive</span>]</pre>
  </li>
  <li>
    <span id='MULTI_VALUE_METHODS-constant' class='summary_signature'>MULTI_VALUE_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L54-L57'># File 'activerecord/lib/active_record/relation.rb', line 54</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_includes'>includes</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_eager_load'>eager_load</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_preload'>preload</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_select'>select</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_group'>group</span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_order'>order</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_joins'>joins</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_left_outer_joins'>left_outer_joins</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_references'>references</span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_extending'>extending</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_unscope'>unscope</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optimizer_hints'>optimizer_hints</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_annotate'>annotate</span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_with'>with</span>]</pre>
  </li>
  <li>
    <span id='SINGLE_VALUE_METHODS-constant' class='summary_signature'>SINGLE_VALUE_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L59-L60'># File 'activerecord/lib/active_record/relation.rb', line 59</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_lock'>lock</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_readonly'>readonly</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reordering'>reordering</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_strict_loading'>strict_loading</span><span class='comma'>,</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_reverse_order'>reverse_order</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_distinct'>distinct</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_create_with'>create_with</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_skip_query_cache'>skip_query_cache</span>]</pre>
  </li>
  <li>
    <span id='VALUE_METHODS-constant' class='summary_signature'>VALUE_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L65-L65'># File 'activerecord/lib/active_record/relation.rb', line 65</a>    <pre class='code ruby'><span class='const'><a href="#MULTI_VALUE_METHODS-constant" title="ActiveRecord::Relation::MULTI_VALUE_METHODS (constant)">MULTI_VALUE_METHODS</a></span> <span class='op'>+</span> <span class='const'><a href="#SINGLE_VALUE_METHODS-constant" title="ActiveRecord::Relation::SINGLE_VALUE_METHODS (constant)">SINGLE_VALUE_METHODS</a></span> <span class='op'>+</span> <span class='const'><a href="#CLAUSE_METHODS-constant" title="ActiveRecord::Relation::CLAUSE_METHODS (constant)">CLAUSE_METHODS</a></span></pre>
  </li>
</ul>
  <h3 class='inherited'><a href="Batches.html" title="ActiveRecord::Batches (module)"><code>Batches</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="Batches.html#DEFAULT_ORDER-constant" title="ActiveRecord::Batches::DEFAULT_ORDER (constant)">DEFAULT_ORDER</a>, 
    <a href="Batches.html#ORDER_IGNORE_MESSAGE-constant" title="ActiveRecord::Batches::ORDER_IGNORE_MESSAGE (constant)">ORDER_IGNORE_MESSAGE</a>
  </p>
  <h3 class='inherited'><a href="QueryMethods.html" title="ActiveRecord::QueryMethods (module)"><code>QueryMethods</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="QueryMethods.html#FROZEN_EMPTY_ARRAY-constant" title="ActiveRecord::QueryMethods::FROZEN_EMPTY_ARRAY (constant)">FROZEN_EMPTY_ARRAY</a>, 
    <a href="QueryMethods.html#FROZEN_EMPTY_HASH-constant" title="ActiveRecord::QueryMethods::FROZEN_EMPTY_HASH (constant)">FROZEN_EMPTY_HASH</a>, 
    <a href="QueryMethods.html#VALID_UNSCOPING_VALUES-constant" title="ActiveRecord::QueryMethods::VALID_UNSCOPING_VALUES (constant)">VALID_UNSCOPING_VALUES</a>
  </p>
  <h3 class='inherited'><a href="FinderMethods.html" title="ActiveRecord::FinderMethods (module)"><code>FinderMethods</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="FinderMethods.html#ONE_AS_ONE-constant" title="ActiveRecord::FinderMethods::ONE_AS_ONE (constant)">ONE_AS_ONE</a>
  </p>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(klass, table: klass.arel_table, predicate_builder: klass.predicate_builder, values: {})  &#x21d2; Relation </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#blank%3F-instance_method" title="#blank? (instance method)">#<strong>blank?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if relation is blank.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#eager_loading%3F-instance_method" title="#eager_loading? (instance method)">#<strong>eager_loading?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if relation needs eager loading.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#empty%3F-instance_method" title="#empty? (instance method)">#<strong>empty?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if there are no records.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#klass-instance_method" title="#klass (instance method)">#<strong>klass</strong>  </a>
      (also: #model)
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#loaded%3F-instance_method" title="#loaded? (instance method)">#<strong>loaded?</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#loaded-instance_method" title="ActiveRecord::Relation#loaded (method)">#loaded</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#many%3F-instance_method" title="#many? (instance method)">#<strong>many?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if there is more than one record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#model-instance_method" title="#model (instance method)">#<strong>model</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">#klass</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#predicate_builder-instance_method" title="#predicate_builder (instance method)">#<strong>predicate_builder</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#scheduled%3F-instance_method" title="#scheduled? (instance method)">#<strong>scheduled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if the relation was scheduled on the background thread pool.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#skip_preloading_value-instance_method" title="#skip_preloading_value (instance method)">#<strong>skip_preloading_value</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#table-instance_method" title="#table (instance method)">#<strong>table</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>

<h3 class='inherited'><a href="../Enumerable.html" title="Enumerable (module)"><code>::Enumerable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ro' href="../Enumerable.html#many%3F-instance_method" title="Enumerable#many? (method)">#many?</a></td>
      <td><div class='inline'><p>Returns <code>true</code> if the enumerable has more than 1 element.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Compares two relations for equality.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#any%3F-instance_method" title="#any? (instance method)">#<strong>any?</strong>(*args)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if there are any records.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#build-instance_method" title="#build (instance method)">#<strong>build</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#new-instance_method" title="ActiveRecord::Relation#new (method)">#new</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_key-instance_method" title="#cache_key (instance method)">#<strong>cache_key</strong>(timestamp_column = &quot;updated_at&quot;)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a stable cache key that can be used to identify this query.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_key_with_version-instance_method" title="#cache_key_with_version (instance method)">#<strong>cache_key_with_version</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a cache key along with the version.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#cache_version-instance_method" title="#cache_version (instance method)">#<strong>cache_version</strong>(timestamp_column = :updated_at)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a cache version that can be used together with the cache key to form a recyclable caching scheme.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Tries to create a new record with the same scoped attributes defined in the relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create!-instance_method" title="#create! (instance method)">#<strong>create!</strong>(attributes = nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Similar to <a href="#create-instance_method" title="ActiveRecord::Relation#create (method)">#create</a>, but calls <a href="rdoc-ref:Persistence::ClassMethods#create!">create!</a> on the base class.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_or_find_by-instance_method" title="#create_or_find_by (instance method)">#<strong>create_or_find_by</strong>(attributes, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Attempts to create a record with the given attributes in a table that has a unique database constraint on one or several of its columns.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#create_or_find_by!-instance_method" title="#create_or_find_by! (instance method)">#<strong>create_or_find_by!</strong>(attributes, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#create_or_find_by-instance_method" title="ActiveRecord::Relation#create_or_find_by (method)">#create_or_find_by</a>, but calls <a href="rdoc-ref:Persistence::ClassMethods#create!">create!</a> so an exception is raised if the created record is invalid.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(id_or_array)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the row with a primary key matching the <code>id</code> argument, using an SQL <code>DELETE</code> statement, and returns the number of rows deleted.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete_all-instance_method" title="#delete_all (instance method)">#<strong>delete_all</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Deletes the records without instantiating the records first, and hence not calling the <a href="Persistence.html#destroy-instance_method" title="ActiveRecord::Persistence#destroy (method)">#destroy</a> method nor invoking callbacks.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#delete_by-instance_method" title="#delete_by (instance method)">#<strong>delete_by</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Finds and deletes all records matching the specified conditions.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>(id)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Destroy an object (or multiple objects) that has the given id.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy_all-instance_method" title="#destroy_all (instance method)">#<strong>destroy_all</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Destroys the records by instantiating each record and calling its <a href="Persistence.html#destroy-instance_method" title="ActiveRecord::Persistence#destroy (method)">#destroy</a> method.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destroy_by-instance_method" title="#destroy_by (instance method)">#<strong>destroy_by</strong>(*args)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Finds and destroys all records matching the specified conditions.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#encode_with-instance_method" title="#encode_with (instance method)">#<strong>encode_with</strong>(coder)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Serializes the relation objects <a href="../Array.html" title="Array (class)"><code>::Array</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#explain-instance_method" title="#explain (instance method)">#<strong>explain</strong>(*options)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Runs EXPLAIN on the query or queries triggered by this relation and returns the result as a string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_or_create_by-instance_method" title="#find_or_create_by (instance method)">#<strong>find_or_create_by</strong>(attributes, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Finds the first record with the given attributes, or creates a record with the attributes if one is not found:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_or_create_by!-instance_method" title="#find_or_create_by! (instance method)">#<strong>find_or_create_by!</strong>(attributes, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#find_or_create_by-instance_method" title="ActiveRecord::Relation#find_or_create_by (method)">#find_or_create_by</a>, but calls <a href="rdoc-ref:Persistence::ClassMethods#create!">create!</a> so an exception is raised if the created record is invalid.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#find_or_initialize_by-instance_method" title="#find_or_initialize_by (instance method)">#<strong>find_or_initialize_by</strong>(attributes, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Like <a href="#find_or_create_by-instance_method" title="ActiveRecord::Relation#find_or_create_by (method)">#find_or_create_by</a>, but calls <code>new</code> instead of <a href="Persistence/ClassMethods.html#create-instance_method" title="ActiveRecord::Persistence::ClassMethods#create (method)">create</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#initialize_copy-instance_method" title="#initialize_copy (instance method)">#<strong>initialize_copy</strong>(other)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert-instance_method" title="#insert (instance method)">#<strong>insert</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts a single record into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert!-instance_method" title="#insert! (instance method)">#<strong>insert!</strong>(attributes, returning: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts a single record into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert_all-instance_method" title="#insert_all (instance method)">#<strong>insert_all</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts multiple records into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert_all!-instance_method" title="#insert_all! (instance method)">#<strong>insert_all!</strong>(attributes, returning: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts multiple records into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#joined_includes_values-instance_method" title="#joined_includes_values (instance method)">#<strong>joined_includes_values</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Joins that are also marked for preloading.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#load-instance_method" title="#load (instance method)">#<strong>load</strong>(&amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Causes the records to be loaded from the database if they have not been loaded already.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#load_async-instance_method" title="#load_async (instance method)">#<strong>load_async</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Schedule the query to be performed from a background thread pool.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#loaded-instance_method" title="#loaded (instance method)">#<strong>loaded</strong>  </a>
      (also: #loaded?)
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#locked%3F-instance_method" title="#locked? (instance method)">#<strong>locked?</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-instance_method" title="#new (instance method)">#<strong>new</strong>(attributes = nil, &amp;block)  </a>
      (also: #build)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Initializes new record from relation while maintaining the current scope.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#none%3F-instance_method" title="#none? (instance method)">#<strong>none?</strong>(*args)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if there are no records.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#one%3F-instance_method" title="#one? (instance method)">#<strong>one?</strong>(*args)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if there is exactly one record.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#pretty_print-instance_method" title="#pretty_print (instance method)">#<strong>pretty_print</strong>(pp)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reload-instance_method" title="#reload (instance method)">#<strong>reload</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Forces reloading of relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#reset-instance_method" title="#reset (instance method)">#<strong>reset</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#scope_for_create-instance_method" title="#scope_for_create (instance method)">#<strong>scope_for_create</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#scoping-instance_method" title="#scoping (instance method)">#<strong>scoping</strong>(all_queries: nil, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Scope all queries to the current scope.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns size of the records.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_a-instance_method" title="#to_a (instance method)">#<strong>to_a</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#to_ary-instance_method" title="ActiveRecord::Relation#to_ary (method)">#to_ary</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_ary-instance_method" title="#to_ary (instance method)">#<strong>to_ary</strong>  </a>
      (also: #to_a)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Converts relation objects to <a href="../Array.html" title="Array (class)"><code>::Array</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_sql-instance_method" title="#to_sql (instance method)">#<strong>to_sql</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns sql statement for the relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#touch_all-instance_method" title="#touch_all (instance method)">#<strong>touch_all</strong>(*names, time: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Touches all records in the current relation, setting the <code>updated_at+/+updated_on</code> attributes to the current time or the time specified.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_all-instance_method" title="#update_all (instance method)">#<strong>update_all</strong>(updates)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates all records in the current relation with details given.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#update_counters-instance_method" title="#update_counters (instance method)">#<strong>update_counters</strong>(counters)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates the counters of the records in the current relation.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#upsert-instance_method" title="#upsert (instance method)">#<strong>upsert</strong>(attributes, **kwargs)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates or inserts (upserts) a single record into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#upsert_all-instance_method" title="#upsert_all (instance method)">#<strong>upsert_all</strong>(attributes, on_duplicate: :update, update_only: nil, returning: nil, unique_by: nil, record_timestamps: nil)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Updates or inserts (upserts) multiple records into the database in a single SQL INSERT statement.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#values-instance_method" title="#values (instance method)">#<strong>values</strong>  </a>
    </span>
  </li>
</ul>

<h3 class='inherited'><a href="TokenFor/RelationMethods.html" title="ActiveRecord::TokenFor::RelationMethods (module)"><code>TokenFor::RelationMethods</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="TokenFor/RelationMethods.html#find_by_token_for-instance_method" title="ActiveRecord::TokenFor::RelationMethods#find_by_token_for (method)">#find_by_token_for</a></td>
      <td><div class='inline'><p>Finds a record using a given <code>token</code> for a predefined <code>purpose</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="TokenFor/RelationMethods.html#find_by_token_for!-instance_method" title="ActiveRecord::TokenFor::RelationMethods#find_by_token_for! (method)">#find_by_token_for!</a></td>
      <td><div class='inline'><p>Finds a record using a given <code>token</code> for a predefined <code>purpose</code>.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="FinderMethods.html" title="ActiveRecord::FinderMethods (module)"><code>FinderMethods</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#exists%3F-instance_method" title="ActiveRecord::FinderMethods#exists? (method)">#exists?</a></td>
      <td><div class='inline'><p>Returns true if a record exists in the table that matches the <code>id</code> or conditions given, or false otherwise.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#fifth-instance_method" title="ActiveRecord::FinderMethods#fifth (method)">#fifth</a></td>
      <td><div class='inline'><p>Find the fifth record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#fifth!-instance_method" title="ActiveRecord::FinderMethods#fifth! (method)">#fifth!</a></td>
      <td><div class='inline'><p>Same as <code>#fifth</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#find-instance_method" title="ActiveRecord::FinderMethods#find (method)">#find</a></td>
      <td><div class='inline'><p>Find by id - This can either be a specific id (ID), a list of ids (ID, ID, ID), or an array of ids ([ID, ID, ID]).</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#find_by-instance_method" title="ActiveRecord::FinderMethods#find_by (method)">#find_by</a></td>
      <td><div class='inline'><p>Finds the first record matching the specified conditions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#find_by!-instance_method" title="ActiveRecord::FinderMethods#find_by! (method)">#find_by!</a></td>
      <td><div class='inline'><p>Like <code>#find_by</code>, except that if no record is found, raises an <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> error.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#find_sole_by-instance_method" title="ActiveRecord::FinderMethods#find_sole_by (method)">#find_sole_by</a></td>
      <td><div class='inline'><p>Finds the sole matching record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#first-instance_method" title="ActiveRecord::FinderMethods#first (method)">#first</a></td>
      <td><div class='inline'><p>Find the first record (or first N records if a parameter is supplied).</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#first!-instance_method" title="ActiveRecord::FinderMethods#first! (method)">#first!</a></td>
      <td><div class='inline'><p>Same as <code>#first</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#forty_two-instance_method" title="ActiveRecord::FinderMethods#forty_two (method)">#forty_two</a></td>
      <td><div class='inline'><p>Find the forty-second record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#forty_two!-instance_method" title="ActiveRecord::FinderMethods#forty_two! (method)">#forty_two!</a></td>
      <td><div class='inline'><p>Same as <code>#forty_two</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#fourth-instance_method" title="ActiveRecord::FinderMethods#fourth (method)">#fourth</a></td>
      <td><div class='inline'><p>Find the fourth record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#fourth!-instance_method" title="ActiveRecord::FinderMethods#fourth! (method)">#fourth!</a></td>
      <td><div class='inline'><p>Same as <code>#fourth</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#include%3F-instance_method" title="ActiveRecord::FinderMethods#include? (method)">#include?</a></td>
      <td><div class='inline'><p>Returns true if the relation contains the given record or false otherwise.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#last-instance_method" title="ActiveRecord::FinderMethods#last (method)">#last</a></td>
      <td><div class='inline'><p>Find the last record (or last N records if a parameter is supplied).</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#last!-instance_method" title="ActiveRecord::FinderMethods#last! (method)">#last!</a></td>
      <td><div class='inline'><p>Same as <code>#last</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#member%3F-instance_method" title="ActiveRecord::FinderMethods#member? (method)">#member?</a></td>
      <td><div class='inline'><p>Alias for <a href="FinderMethods.html#include%3F-instance_method" title="ActiveRecord::FinderMethods#include? (method)">FinderMethods#include?</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#second-instance_method" title="ActiveRecord::FinderMethods#second (method)">#second</a></td>
      <td><div class='inline'><p>Find the second record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#second!-instance_method" title="ActiveRecord::FinderMethods#second! (method)">#second!</a></td>
      <td><div class='inline'><p>Same as <code>#second</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#second_to_last-instance_method" title="ActiveRecord::FinderMethods#second_to_last (method)">#second_to_last</a></td>
      <td><div class='inline'><p>Find the second-to-last record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#second_to_last!-instance_method" title="ActiveRecord::FinderMethods#second_to_last! (method)">#second_to_last!</a></td>
      <td><div class='inline'><p>Same as <code>#second_to_last</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#sole-instance_method" title="ActiveRecord::FinderMethods#sole (method)">#sole</a></td>
      <td><div class='inline'><p>Finds the sole matching record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#take-instance_method" title="ActiveRecord::FinderMethods#take (method)">#take</a></td>
      <td><div class='inline'><p>Gives a record (or N records if a parameter is supplied) without any implied order.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#take!-instance_method" title="ActiveRecord::FinderMethods#take! (method)">#take!</a></td>
      <td><div class='inline'><p>Same as <code>#take</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#third-instance_method" title="ActiveRecord::FinderMethods#third (method)">#third</a></td>
      <td><div class='inline'><p>Find the third record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#third!-instance_method" title="ActiveRecord::FinderMethods#third! (method)">#third!</a></td>
      <td><div class='inline'><p>Same as <code>#third</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#third_to_last-instance_method" title="ActiveRecord::FinderMethods#third_to_last (method)">#third_to_last</a></td>
      <td><div class='inline'><p>Find the third-to-last record.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="FinderMethods.html#third_to_last!-instance_method" title="ActiveRecord::FinderMethods#third_to_last! (method)">#third_to_last!</a></td>
      <td><div class='inline'><p>Same as <code>#third_to_last</code> but raises <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> if no record is found.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Calculations.html" title="ActiveRecord::Calculations (module)"><code>Calculations</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_average-instance_method" title="ActiveRecord::Calculations#async_average (method)">#async_average</a></td>
      <td><div class='inline'><p>Same as <code>#average</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_count-instance_method" title="ActiveRecord::Calculations#async_count (method)">#async_count</a></td>
      <td><div class='inline'><p>Same as <code>#count</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_ids-instance_method" title="ActiveRecord::Calculations#async_ids (method)">#async_ids</a></td>
      <td><div class='inline'><p>Same as <code>#ids</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_maximum-instance_method" title="ActiveRecord::Calculations#async_maximum (method)">#async_maximum</a></td>
      <td><div class='inline'><p>Same as <code>#maximum</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_minimum-instance_method" title="ActiveRecord::Calculations#async_minimum (method)">#async_minimum</a></td>
      <td><div class='inline'><p>Same as <code>#minimum</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_pick-instance_method" title="ActiveRecord::Calculations#async_pick (method)">#async_pick</a></td>
      <td><div class='inline'><p>Same as <code>#pick</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_pluck-instance_method" title="ActiveRecord::Calculations#async_pluck (method)">#async_pluck</a></td>
      <td><div class='inline'><p>Same as <code>#pluck</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#async_sum-instance_method" title="ActiveRecord::Calculations#async_sum (method)">#async_sum</a></td>
      <td><div class='inline'><p>Same as <code>#sum</code>, but performs the query asynchronously and returns an <a href="Promise.html" title="ActiveRecord::Promise (class)"><code>Promise</code></a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#average-instance_method" title="ActiveRecord::Calculations#average (method)">#average</a></td>
      <td><div class='inline'><p>Calculates the average value on a given column.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#calculate-instance_method" title="ActiveRecord::Calculations#calculate (method)">#calculate</a></td>
      <td><div class='inline'><p>This calculates aggregate values in the given column.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#count-instance_method" title="ActiveRecord::Calculations#count (method)">#count</a></td>
      <td><div class='inline'><p>Count the records.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#ids-instance_method" title="ActiveRecord::Calculations#ids (method)">#ids</a></td>
      <td><div class='inline'><p>Returns the base model’s ID’s for the relation using the table’s primary key.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#maximum-instance_method" title="ActiveRecord::Calculations#maximum (method)">#maximum</a></td>
      <td><div class='inline'><p>Calculates the maximum value on a given column.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#minimum-instance_method" title="ActiveRecord::Calculations#minimum (method)">#minimum</a></td>
      <td><div class='inline'><p>Calculates the minimum value on a given column.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#pick-instance_method" title="ActiveRecord::Calculations#pick (method)">#pick</a></td>
      <td><div class='inline'><p>Pick the value(s) from the named column(s) in the current relation.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#pluck-instance_method" title="ActiveRecord::Calculations#pluck (method)">#pluck</a></td>
      <td><div class='inline'><p>Use <code>#pluck</code> as a shortcut to select one or more attributes without loading an entire record object per row.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Calculations.html#sum-instance_method" title="ActiveRecord::Calculations#sum (method)">#sum</a></td>
      <td><div class='inline'><p>Calculates the sum of values on a given column.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="SpawnMethods.html" title="ActiveRecord::SpawnMethods (module)"><code>SpawnMethods</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="SpawnMethods.html#except-instance_method" title="ActiveRecord::SpawnMethods#except (method)">#except</a></td>
      <td><div class='inline'><p>Removes from the query the condition(s) specified in <code>skips</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="SpawnMethods.html#merge-instance_method" title="ActiveRecord::SpawnMethods#merge (method)">#merge</a></td>
      <td><div class='inline'><p>Merges in the conditions from <code>other</code>, if <code>other</code> is an <code>Relation</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="SpawnMethods.html#only-instance_method" title="ActiveRecord::SpawnMethods#only (method)">#only</a></td>
      <td><div class='inline'><p>Removes any condition from the query other than the one(s) specified in <code>onlies</code>.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="QueryMethods.html" title="ActiveRecord::QueryMethods (module)"><code>QueryMethods</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#and-instance_method" title="ActiveRecord::QueryMethods#and (method)">#and</a></td>
      <td><div class='inline'><p>Returns a new relation, which is the logical intersection of this relation and the one passed as an argument.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#annotate-instance_method" title="ActiveRecord::QueryMethods#annotate (method)">#annotate</a></td>
      <td><div class='inline'><p>Adds an SQL comment to queries generated from this relation.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#create_with-instance_method" title="ActiveRecord::QueryMethods#create_with (method)">#create_with</a></td>
      <td><div class='inline'><p>Sets attributes to be used when creating new records from a relation object.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#distinct-instance_method" title="ActiveRecord::QueryMethods#distinct (method)">#distinct</a></td>
      <td><div class='inline'><p>Specifies whether the records should be unique or not.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#eager_load-instance_method" title="ActiveRecord::QueryMethods#eager_load (method)">#eager_load</a></td>
      <td><div class='inline'><p>Specify associations <code>args</code> to be eager loaded using a <code>LEFT OUTER JOIN</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#excluding-instance_method" title="ActiveRecord::QueryMethods#excluding (method)">#excluding</a></td>
      <td><div class='inline'><p>Excludes the specified record (or collection of records) from the resulting relation.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#extending-instance_method" title="ActiveRecord::QueryMethods#extending (method)">#extending</a></td>
      <td><div class='inline'><p>Used to extend a scope with additional methods, either through a module or through a block provided.</p></div></td>
    </tr>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="QueryMethods.html#extensions-instance_method" title="ActiveRecord::QueryMethods#extensions (method)">#extensions</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#extract_associated-instance_method" title="ActiveRecord::QueryMethods#extract_associated (method)">#extract_associated</a></td>
      <td><div class='inline'><p>Extracts a named <code>association</code> from the relation.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#from-instance_method" title="ActiveRecord::QueryMethods#from (method)">#from</a></td>
      <td><div class='inline'><p>Specifies the table from which the records will be fetched.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#group-instance_method" title="ActiveRecord::QueryMethods#group (method)">#group</a></td>
      <td><div class='inline'><p>Allows to specify a group attribute:</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#having-instance_method" title="ActiveRecord::QueryMethods#having (method)">#having</a></td>
      <td><div class='inline'><p>Allows to specify a HAVING clause.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#in_order_of-instance_method" title="ActiveRecord::QueryMethods#in_order_of (method)">#in_order_of</a></td>
      <td><div class='inline'><p>Applies an <code>ORDER BY</code> clause based on a given <code>column</code>, ordered and filtered by a specific set of <a href="#values-instance_method" title="ActiveRecord::Relation#values (method)">#values</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#includes-instance_method" title="ActiveRecord::QueryMethods#includes (method)">#includes</a></td>
      <td><div class='inline'><p>Specify associations <code>args</code> to be eager loaded to prevent N + 1 queries.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#invert_where-instance_method" title="ActiveRecord::QueryMethods#invert_where (method)">#invert_where</a></td>
      <td><div class='inline'><p>Allows you to invert an entire where clause instead of manually applying conditions.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#joins-instance_method" title="ActiveRecord::QueryMethods#joins (method)">#joins</a></td>
      <td><div class='inline'><p>Performs JOINs on <code>args</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#left_joins-instance_method" title="ActiveRecord::QueryMethods#left_joins (method)">#left_joins</a></td>
      <td><div class='inline'><p>Alias for <a href="QueryMethods.html#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">QueryMethods#left_outer_joins</a>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#left_outer_joins-instance_method" title="ActiveRecord::QueryMethods#left_outer_joins (method)">#left_outer_joins</a></td>
      <td><div class='inline'><p>Performs LEFT OUTER JOINs on <code>args</code>:</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#limit-instance_method" title="ActiveRecord::QueryMethods#limit (method)">#limit</a></td>
      <td><div class='inline'><p>Specifies a limit for the number of records to retrieve.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#lock-instance_method" title="ActiveRecord::QueryMethods#lock (method)">#lock</a></td>
      <td><div class='inline'><p>Specifies locking settings (default to <code>true</code>).</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#none-instance_method" title="ActiveRecord::QueryMethods#none (method)">#none</a></td>
      <td><div class='inline'><p>Returns a chainable relation with zero records.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#offset-instance_method" title="ActiveRecord::QueryMethods#offset (method)">#offset</a></td>
      <td><div class='inline'><p>Specifies the number of rows to skip before returning rows.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#optimizer_hints-instance_method" title="ActiveRecord::QueryMethods#optimizer_hints (method)">#optimizer_hints</a></td>
      <td><div class='inline'><p>Specify optimizer hints to be used in the SELECT statement.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#or-instance_method" title="ActiveRecord::QueryMethods#or (method)">#or</a></td>
      <td><div class='inline'><p>Returns a new relation, which is the logical union of this relation and the one passed as an argument.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#order-instance_method" title="ActiveRecord::QueryMethods#order (method)">#order</a></td>
      <td><div class='inline'><p>Applies an <code>ORDER BY</code> clause to a query.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#preload-instance_method" title="ActiveRecord::QueryMethods#preload (method)">#preload</a></td>
      <td><div class='inline'><p>Specify associations <code>args</code> to be eager loaded using separate queries.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#readonly-instance_method" title="ActiveRecord::QueryMethods#readonly (method)">#readonly</a></td>
      <td><div class='inline'><p>Mark a relation as readonly.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#references-instance_method" title="ActiveRecord::QueryMethods#references (method)">#references</a></td>
      <td><div class='inline'><p>Use to indicate that the given <code>table_names</code> are referenced by an SQL string, and should therefore be <code>JOIN</code>ed in any query rather than loaded separately.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#regroup-instance_method" title="ActiveRecord::QueryMethods#regroup (method)">#regroup</a></td>
      <td><div class='inline'><p>Allows you to change a previously set group statement.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#reorder-instance_method" title="ActiveRecord::QueryMethods#reorder (method)">#reorder</a></td>
      <td><div class='inline'><p>Replaces any existing order defined on the relation with the specified order.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#reselect-instance_method" title="ActiveRecord::QueryMethods#reselect (method)">#reselect</a></td>
      <td><div class='inline'><p>Allows you to change a previously set select statement.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#reverse_order-instance_method" title="ActiveRecord::QueryMethods#reverse_order (method)">#reverse_order</a></td>
      <td><div class='inline'><p>Reverse the existing order clause on the relation.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#rewhere-instance_method" title="ActiveRecord::QueryMethods#rewhere (method)">#rewhere</a></td>
      <td><div class='inline'><p>Allows you to change a previously set where condition for a given attribute, instead of appending to that condition.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">#select</a></td>
      <td><div class='inline'><p>Works in two unique ways.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#strict_loading-instance_method" title="ActiveRecord::QueryMethods#strict_loading (method)">#strict_loading</a></td>
      <td><div class='inline'><p>Sets the returned relation to strict_loading mode.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#structurally_compatible%3F-instance_method" title="ActiveRecord::QueryMethods#structurally_compatible? (method)">#structurally_compatible?</a></td>
      <td><div class='inline'><p>Checks whether the given relation is structurally compatible with this relation, to determine if it’s possible to use the <code>#and</code> and <code>#or</code> methods without raising an error.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#uniq!-instance_method" title="ActiveRecord::QueryMethods#uniq! (method)">#uniq!</a></td>
      <td><div class='inline'><p>Deduplicate multiple values.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#unscope-instance_method" title="ActiveRecord::QueryMethods#unscope (method)">#unscope</a></td>
      <td><div class='inline'><p>Removes an unwanted relation that is already defined on a chain of relations.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#where-instance_method" title="ActiveRecord::QueryMethods#where (method)">#where</a></td>
      <td><div class='inline'><p>Returns a new relation, which is the result of filtering the current relation according to the conditions in the arguments.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#with-instance_method" title="ActiveRecord::QueryMethods#with (method)">#with</a></td>
      <td><div class='inline'><p>Add a Common Table Expression (CTE) that you can then reference within another SELECT statement.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#with_recursive-instance_method" title="ActiveRecord::QueryMethods#with_recursive (method)">#with_recursive</a></td>
      <td><div class='inline'><p>Add a recursive Common Table Expression (CTE) that you can then reference within another SELECT statement.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="QueryMethods.html#without-instance_method" title="ActiveRecord::QueryMethods#without (method)">#without</a></td>
      <td><div class='inline'><p>Alias for <a href="QueryMethods.html#excluding-instance_method" title="ActiveRecord::QueryMethods#excluding (method)">QueryMethods#excluding</a>.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="Batches.html" title="ActiveRecord::Batches (module)"><code>Batches</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Batches.html#find_each-instance_method" title="ActiveRecord::Batches#find_each (method)">#find_each</a></td>
      <td><div class='inline'><p>Looping through a collection of records from the database (using the <a href="Scoping/Named/ClassMethods.html#all-instance_method" title="ActiveRecord::Scoping::Named::ClassMethods#all (method)">Scoping::Named::ClassMethods#all</a> method, for example) is very inefficient since it will try to instantiate all the objects at once.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Batches.html#find_in_batches-instance_method" title="ActiveRecord::Batches#find_in_batches (method)">#find_in_batches</a></td>
      <td><div class='inline'><p>Yields each batch of records that was found by the find options as an array.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Batches.html#in_batches-instance_method" title="ActiveRecord::Batches#in_batches (method)">#in_batches</a></td>
      <td><div class='inline'><p>Yields <code>Relation</code> objects to work with a batch of records.</p></div></td>
    </tr>
  </tbody>
</table></div>

<h3 class='inherited'><a href="../Enumerable.html" title="Enumerable (module)"><code>::Enumerable</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#compact_blank-instance_method" title="Enumerable#compact_blank (method)">#compact_blank</a></td>
      <td><div class='inline'><p>Returns a new <a href="../Array.html" title="Array (class)"><code>::Array</code></a> without the blank items.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#exclude%3F-instance_method" title="Enumerable#exclude? (method)">#exclude?</a></td>
      <td><div class='inline'><p>The negative of the <code>Enumerable#include?</code>.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#excluding-instance_method" title="Enumerable#excluding (method)">#excluding</a></td>
      <td><div class='inline'><p>Returns a copy of the enumerable excluding the specified elements.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#in_order_of-instance_method" title="Enumerable#in_order_of (method)">#in_order_of</a></td>
      <td><div class='inline'><p>Returns a new <a href="../Array.html" title="Array (class)"><code>::Array</code></a> where the order has been set to that provided in the <code>series</code>, based on the <code>key</code> of the objects in the original enumerable.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#including-instance_method" title="Enumerable#including (method)">#including</a></td>
      <td><div class='inline'><p>Returns a new array that includes the passed elements.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#index_by-instance_method" title="Enumerable#index_by (method)">#index_by</a></td>
      <td><div class='inline'><p>Convert an enumerable to a hash, using the block result as the key and the element as the value.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#index_with-instance_method" title="Enumerable#index_with (method)">#index_with</a></td>
      <td><div class='inline'><p>Convert an enumerable to a hash, using the element as the key and the block result as the value.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#maximum-instance_method" title="Enumerable#maximum (method)">#maximum</a></td>
      <td><div class='inline'><p>Calculates the maximum from the extracted elements.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#minimum-instance_method" title="Enumerable#minimum (method)">#minimum</a></td>
      <td><div class='inline'><p>Calculates the minimum from the extracted elements.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#pick-instance_method" title="Enumerable#pick (method)">#pick</a></td>
      <td><div class='inline'><p>Extract the given key from the first element in the enumerable.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#pluck-instance_method" title="Enumerable#pluck (method)">#pluck</a></td>
      <td><div class='inline'><p>Extract the given key from each element in the enumerable.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#sole-instance_method" title="Enumerable#sole (method)">#sole</a></td>
      <td><div class='inline'><p>Returns the sole item in the enumerable.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="../Enumerable.html#without-instance_method" title="Enumerable#without (method)">#without</a></td>
      <td><div class='inline'><p>Alias for <a href="../Enumerable.html#excluding-instance_method" title="Enumerable#excluding (method)">Enumerable#excluding</a>.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(klass, table: klass.arel_table, predicate_builder: klass.predicate_builder, values: {})  &#x21d2; <code>Relation</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L77-L88'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='77' data-end='88'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 77</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span><span class='comma'>,</span> <span class='label'>table:</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_arel_table'>arel_table</span><span class='comma'>,</span> <span class='label'>predicate_builder:</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_predicate_builder'><a href="#predicate_builder-instance_method" title="ActiveRecord::Relation#predicate_builder (method)">predicate_builder</a></span><span class='comma'>,</span> <span class='label'>values:</span> {})
  <span class='ivar'>@klass</span>  <span class='op'>=</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>
  <span class='ivar'>@table</span>  <span class='op'>=</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>
  <span class='ivar'>@values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'><a href="#values-instance_method" title="ActiveRecord::Relation#values (method)">values</a></span>
  <span class='ivar'>@loaded</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@predicate_builder</span> <span class='op'>=</span> <span class='id identifier rubyid_predicate_builder'><a href="#predicate_builder-instance_method" title="ActiveRecord::Relation#predicate_builder (method)">predicate_builder</a></span>
  <span class='ivar'>@delegate_to_klass</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@future_result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@records</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@async</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@none</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="blank?-instance_method">
  <h3 class='signature ro first'>
    #<strong>blank?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if relation is blank.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1270-L1272'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1270' data-end='1272'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1270</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_blank?'>blank?</span>
  <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_blank?'>blank?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="eager_loading?-instance_method">
  <h3 class='signature ro'>
    #<strong>eager_loading?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if relation needs eager loading.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1234-L1238'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1234' data-end='1238'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1234</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_eager_loading?'>eager_loading?</span>
  <span class='ivar'>@should_eager_load</span> <span class='op'>||=</span>
    <span class='id identifier rubyid_eager_load_values'>eager_load_values</span>.<span class='id identifier rubyid_any?'><a href="#any%3F-instance_method" title="ActiveRecord::Relation#any? (method)">any?</a></span> <span class='op'>||</span>
    <span class='id identifier rubyid_includes_values'>includes_values</span>.<span class='id identifier rubyid_any?'><a href="#any%3F-instance_method" title="ActiveRecord::Relation#any? (method)">any?</a></span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_joined_includes_values'><a href="#joined_includes_values-instance_method" title="ActiveRecord::Relation#joined_includes_values (method)">joined_includes_values</a></span>.<span class='id identifier rubyid_any?'><a href="#any%3F-instance_method" title="ActiveRecord::Relation#any? (method)">any?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_references_eager_loaded_tables?'>references_eager_loaded_tables?</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="empty?-instance_method">
  <h3 class='signature ro'>
    #<strong>empty?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if there are no records.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L365-L373'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='365' data-end='373'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 365</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span>
    <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>else</span>
    <span class='op'>!</span><span class='id identifier rubyid_exists?'>exists?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="klass-instance_method">
  <h3 class='signature ro'>
    #<strong>klass</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#model</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L71-L71'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='71'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_loaded'><a href="#loaded-instance_method" title="ActiveRecord::Relation#loaded (method)">loaded</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_predicate_builder'><a href="#predicate_builder-instance_method" title="ActiveRecord::Relation#predicate_builder (method)">predicate_builder</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="loaded?-instance_method">
  <h3 class='signature ro'>
    #<strong>loaded?</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#loaded-instance_method" title="ActiveRecord::Relation#loaded (method)">#loaded</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L74-L74'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='74' data-end='74'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 74</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_loaded?'>loaded?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_loaded'><a href="#loaded-instance_method" title="ActiveRecord::Relation#loaded (method)">loaded</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="many?-instance_method">
  <h3 class='signature ro'>
    #<strong>many?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if there is more than one record.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L416-L422'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='416' data-end='422'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 416</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_many?'>many?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_many?'>many?</span> <span class='kw'>if</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span>
  <span class='id identifier rubyid_limited_count'>limited_count</span> <span class='op'>&gt;</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="model-instance_method">
  <h3 class='signature ro'>
    #<strong>model</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">#klass</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L73-L73'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='73' data-end='73'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 73</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_model'>model</span> <span class='symbeg'>:</span><span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="predicate_builder-instance_method">
  <h3 class='signature ro'>
    #<strong>predicate_builder</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L71-L71'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='71'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_loaded'><a href="#loaded-instance_method" title="ActiveRecord::Relation#loaded (method)">loaded</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_predicate_builder'>predicate_builder</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scheduled?-instance_method">
  <h3 class='signature ro'>
    #<strong>scheduled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if the relation was scheduled on the background thread pool.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1165-L1167'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1165' data-end='1167'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1165</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_scheduled?'>scheduled?</span>
  <span class='op'>!</span><span class='op'>!</span><span class='ivar'>@future_result</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skip_preloading_value-instance_method">
  <h3 class='signature rw'>
    #<strong>skip_preloading_value</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L72-L72'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='72' data-end='72'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 72</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_skip_preloading_value'>skip_preloading_value</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="table-instance_method">
  <h3 class='signature ro'>
    #<strong>table</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L71-L71'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='71'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_loaded'><a href="#loaded-instance_method" title="ActiveRecord::Relation#loaded (method)">loaded</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_predicate_builder'><a href="#predicate_builder-instance_method" title="ActiveRecord::Relation#predicate_builder (method)">predicate_builder</a></span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="==-instance_method">
  <h3 class='signature  first'>
    #<strong>==</strong>(other)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Compares two relations for equality.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1249-L1258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1249' data-end='1258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1249</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>==</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_other'>other</span>
  <span class='kw'>when</span> <span class='const'><a href="Associations.html" title="ActiveRecord::Associations (module)">Associations</a></span><span class='op'>::</span><span class='const'><a href="Associations/CollectionProxy.html" title="ActiveRecord::Associations::CollectionProxy (class)">CollectionProxy</a></span><span class='comma'>,</span> <span class='const'><a href="AssociationRelation.html" title="ActiveRecord::AssociationRelation (class)">AssociationRelation</a></span>
    <span class='kw'>self</span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>
  <span class='kw'>when</span> <span class='const'>Relation</span>
    <span class='id identifier rubyid_other'>other</span>.<span class='id identifier rubyid_to_sql'><a href="#to_sql-instance_method" title="ActiveRecord::Relation#to_sql (method)">to_sql</a></span> <span class='op'>==</span> <span class='id identifier rubyid_to_sql'><a href="#to_sql-instance_method" title="ActiveRecord::Relation#to_sql (method)">to_sql</a></span>
  <span class='kw'>when</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>
    <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span> <span class='op'>==</span> <span class='id identifier rubyid_other'>other</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="any?-instance_method">
  <h3 class='signature '>
    #<strong>any?</strong>(*args)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if there are any records.</p>

<p>When a pattern argument is given, this method checks whether elements in the <a href="../Enumerable.html" title="Enumerable (module)"><code>::Enumerable</code></a> match the pattern via the case-equality operator (<code>===</code>).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_any?'>any?</span>(<span class='const'>Post</span>) <span class='comment'># =&gt; true or false</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L394-L399'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='394' data-end='399'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 394</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_any?'>any?</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='op'>!</span><span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build-instance_method">
  <h3 class='signature '>
    #<strong>build</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#new-instance_method" title="ActiveRecord::Relation#new (method)">#new</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L126-L126'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='126' data-end='126'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 126</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveRecord::Relation.new (method)">new</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_key-instance_method">
  <h3 class='signature '>
    #<strong>cache_key</strong>(timestamp_column = &quot;updated_at&quot;)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a stable cache key that can be used to identify this query. The cache key is built with a fingerprint of the SQL query.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Product</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name like ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Cosmic Encounter%</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_cache_key'>cache_key</span>
<span class='comment'># =&gt; &quot;products/query-1850ab3d302391b85b8693e941286659&quot;</span></code></pre>

<p>If <a href="Base.html#collection_cache_versioning-class_method" title="ActiveRecord::Base.collection_cache_versioning (method)">Base.collection_cache_versioning</a> is turned off, as it was in Rails 6.0 and earlier, the cache key will also include a version.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Base.html" title="ActiveRecord::Base (class)">Base</a></span>.<span class='id identifier rubyid_collection_cache_versioning'><a href="Base.html#collection_cache_versioning-class_method" title="ActiveRecord::Base.collection_cache_versioning (method)">collection_cache_versioning</a></span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='const'>Product</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name like ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Cosmic Encounter%</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_cache_key'>cache_key</span>
<span class='comment'># =&gt; &quot;products/query-1850ab3d302391b85b8693e941286659-1-20150714212553907087000&quot;</span></code></pre>

<p>You can also pass a custom timestamp column to fetch the timestamp of the last updated record.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Product</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name like ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Game%</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_cache_key'>cache_key</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_last_reviewed_at'>last_reviewed_at</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L441-L444'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='441' data-end='444'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 441</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_key'>cache_key</span>(<span class='id identifier rubyid_timestamp_column'>timestamp_column</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updated_at</span><span class='tstring_end'>&quot;</span></span>)
  <span class='ivar'>@cache_keys</span> <span class='op'>||=</span> {}
  <span class='ivar'>@cache_keys</span>[<span class='id identifier rubyid_timestamp_column'>timestamp_column</span>] <span class='op'>||=</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_collection_cache_key'>collection_cache_key</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_timestamp_column'>timestamp_column</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_key_with_version-instance_method">
  <h3 class='signature '>
    #<strong>cache_key_with_version</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a cache key along with the version.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L522-L528'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='522' data-end='528'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 522</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_key_with_version'>cache_key_with_version</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_version'><a href="../ActiveRecord.html#version-class_method" title="ActiveRecord.version (method)">version</a></span> <span class='op'>=</span> <span class='id identifier rubyid_cache_version'><a href="#cache_version-instance_method" title="ActiveRecord::Relation#cache_version (method)">cache_version</a></span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cache_key'><a href="#cache_key-instance_method" title="ActiveRecord::Relation#cache_key (method)">cache_key</a></span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'><a href="../ActiveRecord.html#version-class_method" title="ActiveRecord.version (method)">version</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cache_key'><a href="#cache_key-instance_method" title="ActiveRecord::Relation#cache_key (method)">cache_key</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="cache_version-instance_method">
  <h3 class='signature '>
    #<strong>cache_version</strong>(timestamp_column = :updated_at)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a cache version that can be used together with the cache key to form a recyclable caching scheme. The cache version is built with the number of records matching the query, and the timestamp of the last updated record. When a new record comes to match the query, or any of the existing records is updated or deleted, the cache version changes.</p>

<p>If the collection is loaded, the method will iterate through the records to generate the timestamp, otherwise it will trigger one SQL query like:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>SELECT</span> <span class='const'>COUNT</span>(<span class='op'>*</span>)<span class='comma'>,</span> <span class='const'>MAX</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>products</span><span class='tstring_end'>&quot;</span></span>.<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updated_at</span><span class='tstring_end'>&quot;</span></span>) <span class='const'>FROM</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>products</span><span class='tstring_end'>&quot;</span></span> <span class='const'>WHERE</span> (<span class='id identifier rubyid_name'>name</span> <span class='id identifier rubyid_like'>like</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Cosmic Encounter%</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L468-L473'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='468' data-end='473'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 468</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_version'>cache_version</span>(<span class='id identifier rubyid_timestamp_column'>timestamp_column</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_updated_at'>updated_at</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_collection_cache_versioning'>collection_cache_versioning</span>
    <span class='ivar'>@cache_versions</span> <span class='op'>||=</span> {}
    <span class='ivar'>@cache_versions</span>[<span class='id identifier rubyid_timestamp_column'>timestamp_column</span>] <span class='op'>||=</span> <span class='id identifier rubyid_compute_cache_version'>compute_cache_version</span>(<span class='id identifier rubyid_timestamp_column'>timestamp_column</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create-instance_method">
  <h3 class='signature '>
    #<strong>create</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Tries to create a new record with the same scoped attributes defined in the relation. Returns the initialized object if validation fails.</p>

<p>Expects arguments in the same format as <a href="Persistence/ClassMethods.html#create-instance_method" title="ActiveRecord::Persistence::ClassMethods#create (method)">{ActiveRecord::Base</a>.create}.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Oscar</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create'>create</span> <span class='comment'># =&gt; #&lt;User id: 3, name: &quot;Oscar&quot;, ...&gt;
</span>
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fxn</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create'>create</span> <span class='comment'># =&gt; #&lt;User id: 4, name: &quot;fxn&quot;, ...&gt;
</span>
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create'>create</span> { <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tenderlove</span><span class='tstring_end'>&#39;</span></span> }
<span class='comment'># =&gt; #&lt;User id: 5, name: &quot;tenderlove&quot;, ...&gt;
</span>
<span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>name:</span> <span class='kw'>nil</span>) <span class='comment'># validation on name
</span><span class='comment'># =&gt; #&lt;User id: nil, name: nil, ...&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L147-L154'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='147' data-end='154'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 147</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_current_scope_restoring_block'>current_scope_restoring_block</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_scoping'><a href="#scoping-instance_method" title="ActiveRecord::Relation#scoping (method)">scoping</a></span> { <span class='id identifier rubyid__create'>_create</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create!-instance_method">
  <h3 class='signature '>
    #<strong>create!</strong>(attributes = nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Similar to <a href="#create-instance_method" title="ActiveRecord::Relation#create (method)">#create</a>, but calls <a href="rdoc-ref:Persistence::ClassMethods#create!">create!</a> on the base class. Raises an exception if a validation error occurs.</p>

<p>Expects arguments in the same format as <a href="rdoc-ref:Persistence::ClassMethods#create!">ActiveRecord::Base.create!</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L162-L169'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='162' data-end='169'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 162</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create!'>create!</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_create!'>create!</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_current_scope_restoring_block'>current_scope_restoring_block</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_scoping'><a href="#scoping-instance_method" title="ActiveRecord::Relation#scoping (method)">scoping</a></span> { <span class='id identifier rubyid__create!'>_create!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_or_find_by-instance_method">
  <h3 class='signature '>
    #<strong>create_or_find_by</strong>(attributes, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Attempts to create a record with the given attributes in a table that has a unique database constraint on one or several of its columns. If a row already exists with one or several of these unique constraints, the exception such an insertion would normally raise is caught, and the existing record with those attributes is found using <code>#find_by!</code>.</p>

<p>This is similar to <a href="#find_or_create_by-instance_method" title="ActiveRecord::Relation#find_or_create_by (method)">#find_or_create_by</a>, but tries to create the record first. As such it is better suited for cases where the record is most likely not to exist yet.</p>

<p>There are several drawbacks to <code>#create_or_find_by</code>, though:</p>
<ul><li>
<p>The underlying table must have the relevant columns defined with unique database constraints.</p>
</li><li>
<p>A unique constraint violation may be triggered by only one, or at least less than all, of the given attributes. This means that the subsequent #find_by! may fail to find a matching record, which will then raise an ActiveRecord::RecordNotFound exception, rather than a record with the given attributes.</p>
</li><li>
<p>While we avoid the race condition between SELECT -&gt; INSERT from <a href="#find_or_create_by-instance_method" title="ActiveRecord::Relation#find_or_create_by (method)">#find_or_create_by</a>, we actually have another race condition between INSERT -&gt; SELECT, which can be triggered if a DELETE between those two statements is run by another client. But for most applications, that’s a significantly less likely condition to hit.</p>
</li><li>
<p>It relies on exception handling to handle control flow, which may be marginally slower.</p>
</li><li>
<p>The primary key may auto-increment on each create, even if it fails. This can accelerate the problem of running out of integers, if the underlying table is still stuck on a primary key of type int (note: All Rails apps since 5.1+ have defaulted to bigint, which is not liable to this problem).</p>
</li><li>
<p>Columns with unique database constraints should not have uniqueness validations defined, otherwise #create will fail due to validation errors and #find_by will never be called.</p>
</li></ul>

<p>This method will return a record if all given attributes are covered by unique constraints (unless the INSERT -&gt; DELETE -&gt; SELECT race condition is triggered), but if creation was attempted and failed due to validation errors it won’t be persisted, you get what <a href="#create-instance_method" title="ActiveRecord::Relation#create (method)">#create</a> returns in such situation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L266-L281'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='266' data-end='281'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 266</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_or_find_by'>create_or_find_by</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
    <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_transaction'>transaction</span>(<span class='label'>requires_new:</span> <span class='kw'>true</span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_create'><a href="#create-instance_method" title="ActiveRecord::Relation#create (method)">create</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
      <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__last_transaction_return_status'>_last_transaction_return_status</span> <span class='op'>||</span> <span class='id identifier rubyid_raise'>raise</span>(<span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="RecordNotUnique.html" title="ActiveRecord::RecordNotUnique (class)">RecordNotUnique</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_transaction_open?'>transaction_open?</span>
      <span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_attributes'>attributes</span>).<span class='id identifier rubyid_lock'>lock</span>.<span class='id identifier rubyid_find_by!'>find_by!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_find_by!'>find_by!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="create_or_find_by!-instance_method">
  <h3 class='signature '>
    #<strong>create_or_find_by!</strong>(attributes, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#create_or_find_by-instance_method" title="ActiveRecord::Relation#create_or_find_by (method)">#create_or_find_by</a>, but calls <a href="rdoc-ref:Persistence::ClassMethods#create!">create!</a> so an exception is raised if the created record is invalid.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L286-L301'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='286' data-end='301'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 286</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_create_or_find_by!'>create_or_find_by!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
    <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_transaction'>transaction</span>(<span class='label'>requires_new:</span> <span class='kw'>true</span>) <span class='kw'>do</span>
      <span class='id identifier rubyid_record'>record</span> <span class='op'>=</span> <span class='id identifier rubyid_create!'><a href="#create!-instance_method" title="ActiveRecord::Relation#create! (method)">create!</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
      <span class='id identifier rubyid_record'>record</span>.<span class='id identifier rubyid__last_transaction_return_status'>_last_transaction_return_status</span> <span class='op'>||</span> <span class='id identifier rubyid_raise'>raise</span>(<span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="Rollback.html" title="ActiveRecord::Rollback (class)">Rollback</a></span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_record'>record</span>
  <span class='kw'>rescue</span> <span class='const'><a href="../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="RecordNotUnique.html" title="ActiveRecord::RecordNotUnique (class)">RecordNotUnique</a></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_connection'>connection</span>.<span class='id identifier rubyid_transaction_open?'>transaction_open?</span>
      <span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_attributes'>attributes</span>).<span class='id identifier rubyid_lock'>lock</span>.<span class='id identifier rubyid_find_by!'>find_by!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='kw'>else</span>
      <span class='id identifier rubyid_find_by!'>find_by!</span>(<span class='id identifier rubyid_attributes'>attributes</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete-instance_method">
  <h3 class='signature '>
    #<strong>delete</strong>(id_or_array)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the row with a primary key matching the <code>id</code> argument, using an SQL <code>DELETE</code> statement, and returns the number of rows deleted. Active Record objects are not instantiated, so the object’s callbacks are not executed, including any <code>:dependent</code> association options.</p>

<p>You can delete multiple rows at once by passing an <a href="../Array.html" title="Array (class)"><code>::Array</code></a> of <code>id</code>s.</p>

<p>Note: Although it is often much faster than the alternative, <a href="#destroy-instance_method" title="ActiveRecord::Relation#destroy (method)">#destroy</a>, skipping callbacks might bypass business logic in your application that ensures referential integrity or performs other essential jobs.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Delete a single row
</span><span class='const'>Todo</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='int'>1</span>)

<span class='comment'># Delete multiple rows
</span><span class='const'>Todo</span>.<span class='id identifier rubyid_delete'>delete</span>([<span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>4</span>])</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1060-L1064'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1060' data-end='1064'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1060</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_id_or_array'>id_or_array</span>)
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_id_or_array'>id_or_array</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> (<span class='id identifier rubyid_id_or_array'>id_or_array</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_id_or_array'>id_or_array</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>)

  <span class='id identifier rubyid_where'>where</span>(<span class='id identifier rubyid_model'><a href="#model-instance_method" title="ActiveRecord::Relation#model (method)">model</a></span>.<span class='id identifier rubyid_primary_key'>primary_key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id_or_array'>id_or_array</span>).<span class='id identifier rubyid_delete_all'><a href="#delete_all-instance_method" title="ActiveRecord::Relation#delete_all (method)">delete_all</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_all-instance_method">
  <h3 class='signature '>
    #<strong>delete_all</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Deletes the records without instantiating the records first, and hence not calling the <a href="Persistence.html#destroy-instance_method" title="ActiveRecord::Persistence#destroy (method)">#destroy</a> method nor invoking callbacks. This is a single SQL DELETE statement that goes straight to the database, much more efficient than <a href="#destroy_all-instance_method" title="ActiveRecord::Relation#destroy_all (method)">#destroy_all</a>. Be careful with relations though, in particular <code>:dependent</code> rules defined on associations are not honored. Returns the number of rows affected.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>person_id:</span> <span class='int'>5</span>).<span class='id identifier rubyid_where'>where</span>(<span class='label'>category:</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Something</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Else</span><span class='tstring_end'>&#39;</span></span>]).<span class='id identifier rubyid_delete_all'>delete_all</span></code></pre>

<p>Both calls delete the affected posts all at once with a single DELETE statement. If you need to destroy dependent associations or call your <code>before_*</code> or <code>after_destroy</code> callbacks, use the <a href="#destroy_all-instance_method" title="ActiveRecord::Relation#destroy_all (method)">#destroy_all</a> method instead.</p>

<p>If an invalid method is supplied, <code>#delete_all</code> raises an <a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)"><code>ActiveRecordError</code></a>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_distinct'>distinct</span>.<span class='id identifier rubyid_delete_all'>delete_all</span>
<span class='comment'># =&gt; ActiveRecord::ActiveRecordError: delete_all doesn&#39;t support distinct</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1014-L1040'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1014' data-end='1040'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1014</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_all'>delete_all</span>
  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='id identifier rubyid_invalid_methods'>invalid_methods</span> <span class='op'>=</span> <span class='const'><a href="#INVALID_METHODS_FOR_DELETE_ALL-constant" title="ActiveRecord::Relation::INVALID_METHODS_FOR_DELETE_ALL (constant)">INVALID_METHODS_FOR_DELETE_ALL</a></span>.<span class='id identifier rubyid_select'><a href="QueryMethods.html#select-instance_method" title="ActiveRecord::QueryMethods#select (method)">select</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='ivar'>@values</span>[<span class='id identifier rubyid_method'>method</span>]
    <span class='id identifier rubyid_method'>method</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_distinct'>distinct</span> <span class='op'>?</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>:</span> <span class='id identifier rubyid_value'>value</span><span class='op'>&amp;.</span><span class='id identifier rubyid_any?'><a href="#any%3F-instance_method" title="ActiveRecord::Relation#any? (method)">any?</a></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_invalid_methods'>invalid_methods</span>.<span class='id identifier rubyid_any?'><a href="#any%3F-instance_method" title="ActiveRecord::Relation#any? (method)">any?</a></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ActiveRecordError.html" title="ActiveRecord::ActiveRecordError (class)">ActiveRecordError</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveRecord::Relation.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>delete_all doesn&#39;t support </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_invalid_methods'>invalid_methods</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='id identifier rubyid_arel'>arel</span> <span class='op'>=</span> <span class='id identifier rubyid_eager_loading?'><a href="#eager_loading%3F-instance_method" title="ActiveRecord::Relation#eager_loading? (method)">eager_loading?</a></span> <span class='op'>?</span> <span class='id identifier rubyid_apply_join_dependency'>apply_join_dependency</span>.<span class='id identifier rubyid_arel'>arel</span> <span class='op'>:</span> <span class='id identifier rubyid_build_arel'>build_arel</span>(<span class='id identifier rubyid_c'>c</span>)
    <span class='id identifier rubyid_arel'>arel</span>.<span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_left'>left</span> <span class='op'>=</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>

    <span class='id identifier rubyid_group_values_arel_columns'>group_values_arel_columns</span> <span class='op'>=</span> <span class='id identifier rubyid_arel_columns'>arel_columns</span>(<span class='id identifier rubyid_group_values'>group_values</span>.<span class='id identifier rubyid_uniq'>uniq</span>)
    <span class='id identifier rubyid_having_clause_ast'>having_clause_ast</span> <span class='op'>=</span> <span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_ast'>ast</span> <span class='kw'>unless</span> <span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_composite_primary_key?'>composite_primary_key?</span>
      <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_pk'>pk</span><span class='op'>|</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>[<span class='id identifier rubyid_pk'>pk</span>] }
    <span class='kw'>else</span>
      <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>[<span class='id identifier rubyid_primary_key'>primary_key</span>]
    <span class='kw'>end</span>
    <span class='id identifier rubyid_stmt'>stmt</span> <span class='op'>=</span> <span class='id identifier rubyid_arel'>arel</span>.<span class='id identifier rubyid_compile_delete'>compile_delete</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_having_clause_ast'>having_clause_ast</span><span class='comma'>,</span> <span class='id identifier rubyid_group_values_arel_columns'>group_values_arel_columns</span>)

    <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Relation#delete (method)">delete</a></span>(<span class='id identifier rubyid_stmt'>stmt</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> Delete All</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_tap'>tap</span> { <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Relation#reset (method)">reset</a></span> }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="delete_by-instance_method">
  <h3 class='signature '>
    #<strong>delete_by</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Finds and deletes all records matching the specified conditions. This is short-hand for <code>relation.where(condition).delete_all</code>. Returns the number of rows affected.</p>

<p>If no record is found, returns <code>0</code> as zero rows were affected.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span>.<span class='id identifier rubyid_delete_by'>delete_by</span>(<span class='label'>id:</span> <span class='int'>13</span>)
<span class='const'>Person</span>.<span class='id identifier rubyid_delete_by'>delete_by</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Spartacus</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>rating:</span> <span class='int'>4</span>)
<span class='const'>Person</span>.<span class='id identifier rubyid_delete_by'>delete_by</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>published_at &lt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span>.<span class='id identifier rubyid_weeks'>weeks</span>.<span class='id identifier rubyid_ago'>ago</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1122-L1124'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1122' data-end='1124'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1122</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_by'>delete_by</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_where'>where</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>).<span class='id identifier rubyid_delete_all'><a href="#delete_all-instance_method" title="ActiveRecord::Relation#delete_all (method)">delete_all</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy-instance_method">
  <h3 class='signature '>
    #<strong>destroy</strong>(id)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Destroy an object (or multiple objects) that has the given id. The object is instantiated first, therefore all callbacks and filters are fired off before the object is deleted. This method is less efficient than <a href="#delete-instance_method" title="ActiveRecord::Relation#delete (method)">#delete</a> but allows cleanup methods and other actions to be run.</p>

<p>This essentially finds the object (or multiple objects) with the given id, creates a new object from the attributes, and then calls destroy on it.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>id</code> - This should be the id or an array of ids to be destroyed.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Destroy a single object
</span><span class='const'>Todo</span>.<span class='id identifier rubyid_destroy'>destroy</span>(<span class='int'>1</span>)

<span class='comment'># Destroy multiple objects
</span><span class='id identifier rubyid_todos'>todos</span> <span class='op'>=</span> [<span class='int'>1</span><span class='comma'>,</span><span class='int'>2</span><span class='comma'>,</span><span class='int'>3</span>]
<span class='const'>Todo</span>.<span class='id identifier rubyid_destroy'>destroy</span>(<span class='id identifier rubyid_todos'>todos</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1086-L1098'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1086' data-end='1098'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1086</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>(<span class='id identifier rubyid_id'>id</span>)
  <span class='id identifier rubyid_multiple_ids'>multiple_ids</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_model'><a href="#model-instance_method" title="ActiveRecord::Relation#model (method)">model</a></span>.<span class='id identifier rubyid_composite_primary_key?'>composite_primary_key?</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_id'>id</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_multiple_ids'>multiple_ids</span>
    <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_destroy'>destroy</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_find'>find</span>(<span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_destroy'>destroy</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy_all-instance_method">
  <h3 class='signature '>
    #<strong>destroy_all</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Destroys the records by instantiating each record and calling its <a href="Persistence.html#destroy-instance_method" title="ActiveRecord::Persistence#destroy (method)">#destroy</a> method. Each object’s callbacks are executed (including <code>:dependent</code> association options). Returns the collection of objects that were destroyed; each will be frozen, to reflect that no changes should be made (since they can’t be persisted).</p>

<p>Note: Instantiation, callback execution, and deletion of each record can be time consuming when you’re removing many records at once. It generates at least one SQL <code>DELETE</code> query per record (or possibly more, to enforce your callbacks). If you want to delete many rows quickly, without concern for their associations or callbacks, use <a href="#delete_all-instance_method" title="ActiveRecord::Relation#delete_all (method)">#delete_all</a> instead.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>age:</span> <span class='int'>0</span><span class='op'>..</span><span class='int'>18</span>).<span class='id identifier rubyid_destroy_all'>destroy_all</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L992-L994'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='992' data-end='994'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 992</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_all'>destroy_all</span>
  <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_each'>each</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_destroy'><a href="#destroy-instance_method" title="ActiveRecord::Relation#destroy (method)">destroy</a></span>).<span class='id identifier rubyid_tap'>tap</span> { <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Relation#reset (method)">reset</a></span> }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destroy_by-instance_method">
  <h3 class='signature '>
    #<strong>destroy_by</strong>(*args)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Finds and destroys all records matching the specified conditions. This is short-hand for <code>relation.where(condition).destroy_all</code>. Returns the collection of objects that were destroyed.</p>

<p>If no record is found, returns empty array.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Person</span>.<span class='id identifier rubyid_destroy_by'>destroy_by</span>(<span class='label'>id:</span> <span class='int'>13</span>)
<span class='const'>Person</span>.<span class='id identifier rubyid_destroy_by'>destroy_by</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Spartacus</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>rating:</span> <span class='int'>4</span>)
<span class='const'>Person</span>.<span class='id identifier rubyid_destroy_by'>destroy_by</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>published_at &lt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span>.<span class='id identifier rubyid_weeks'>weeks</span>.<span class='id identifier rubyid_ago'>ago</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1109-L1111'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1109' data-end='1111'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1109</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy_by'>destroy_by</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='id identifier rubyid_where'>where</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>).<span class='id identifier rubyid_destroy_all'><a href="#destroy_all-instance_method" title="ActiveRecord::Relation#destroy_all (method)">destroy_all</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="encode_with-instance_method">
  <h3 class='signature '>
    #<strong>encode_with</strong>(coder)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Serializes the relation objects <a href="../Array.html" title="Array (class)"><code>::Array</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L351-L353'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='351' data-end='353'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 351</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_with'>encode_with</span>(<span class='id identifier rubyid_coder'>coder</span>)
  <span class='id identifier rubyid_coder'>coder</span>.<span class='id identifier rubyid_represent_seq'>represent_seq</span>(<span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="explain-instance_method">
  <h3 class='signature '>
    #<strong>explain</strong>(*options)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Runs EXPLAIN on the query or queries triggered by this relation and returns the result as a string. The string is formatted imitating the ones printed by the database shell.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_explain'>explain</span>
<span class='comment'># EXPLAIN SELECT {users}.* FROM {users}
</span><span class='comment'># ...</span></code></pre>

<p>Note that this method actually runs the queries, since the results of some are needed by the next ones when eager loading is going on.</p>

<p>To run EXPLAIN on queries created by <code>first</code>, <code>pluck</code> and <code>count</code>, call these methods on <code>explain</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_explain'>explain</span>.<span class='id identifier rubyid_count'>count</span>
<span class='comment'># EXPLAIN SELECT COUNT(*) FROM {users}
</span><span class='comment'># ...</span></code></pre>

<p>The column name can be passed if required:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_explain'>explain</span>.<span class='id identifier rubyid_maximum'>maximum</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_id'>id</span>)
<span class='comment'># EXPLAIN SELECT MAX(`users`.`id`) FROM {users}
</span><span class='comment'># ...</span></code></pre>

<p>Please see further details in the <a href="https://guides.rubyonrails.org/active_record_querying.html#running-explain" target="_parent" title="Active Record Query Interface guide">Active Record Query Interface guide</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L335-L337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='335' data-end='337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 335</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_explain'>explain</span>(<span class='op'>*</span><span class='id identifier rubyid_options'>options</span>)
  <span class='const'><a href="Relation/ExplainProxy.html" title="ActiveRecord::Relation::ExplainProxy (class)">ExplainProxy</a></span>.<span class='id identifier rubyid_new'><a href="Relation/ExplainProxy.html#new-class_method" title="ActiveRecord::Relation::ExplainProxy.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_or_create_by-instance_method">
  <h3 class='signature '>
    #<strong>find_or_create_by</strong>(attributes, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Finds the first record with the given attributes, or creates a record with the attributes if one is not found:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Find the first user named &quot;Penélope&quot; or create a new one.
</span><span class='const'>User</span>.<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Penélope</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; #&lt;User id: 1, first_name: &quot;Penélope&quot;, last_name: nil&gt;
</span>
<span class='comment'># Find the first user named &quot;Penélope&quot; or create a new one.
</span><span class='comment'># We already have one so the existing record will be returned.
</span><span class='const'>User</span>.<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Penélope</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; #&lt;User id: 1, first_name: &quot;Penélope&quot;, last_name: nil&gt;
</span>
<span class='comment'># Find the first user named &quot;Scarlett&quot; or create a new one with
</span><span class='comment'># a particular last name.
</span><span class='const'>User</span>.<span class='id identifier rubyid_create_with'>create_with</span>(<span class='label'>last_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Johansson</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Scarlett</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'># =&gt; #&lt;User id: 2, first_name: &quot;Scarlett&quot;, last_name: &quot;Johansson&quot;&gt;</span></code></pre>

<p>This method accepts a block, which is passed down to <a href="#create-instance_method" title="ActiveRecord::Relation#create (method)">#create</a>. The last example above can be alternatively written this way:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Find the first user named &quot;Scarlett&quot; or create a new one with a
</span><span class='comment'># particular last name.
</span><span class='const'>User</span>.<span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='label'>first_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Scarlett</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
  <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_last_name'>last_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Johansson</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>
<span class='comment'># =&gt; #&lt;User id: 2, first_name: &quot;Scarlett&quot;, last_name: &quot;Johansson&quot;&gt;</span></code></pre>

<p>This method always returns a record, but if creation was attempted and failed due to validation errors it won’t be persisted, you get what <a href="#create-instance_method" title="ActiveRecord::Relation#create (method)">#create</a> returns in such situation.</p>

<p>If creation failed because of a unique constraint, this method will assume it encountered a race condition and will try finding the record once more. If somehow the second find still does not find a record because a concurrent DELETE happened, it will then raise an <a href="RecordNotFound.html" title="ActiveRecord::RecordNotFound (class)"><code>RecordNotFound</code></a> exception.</p>

<p>Please note <strong>this method is not atomic</strong>, it runs first a SELECT, and if there are no results an INSERT is attempted. So if the table doesn’t have a relevant unique constraint it could be the case that you end up with two or more similar records.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L224-L226'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='224' data-end='226'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 224</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_or_create_by'>find_or_create_by</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_find_by'>find_by</span>(<span class='id identifier rubyid_attributes'>attributes</span>) <span class='op'>||</span> <span class='id identifier rubyid_create_or_find_by'><a href="#create_or_find_by-instance_method" title="ActiveRecord::Relation#create_or_find_by (method)">create_or_find_by</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_or_create_by!-instance_method">
  <h3 class='signature '>
    #<strong>find_or_create_by!</strong>(attributes, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#find_or_create_by-instance_method" title="ActiveRecord::Relation#find_or_create_by (method)">#find_or_create_by</a>, but calls <a href="rdoc-ref:Persistence::ClassMethods#create!">create!</a> so an exception is raised if the created record is invalid.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L231-L233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='231' data-end='233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 231</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_or_create_by!'>find_or_create_by!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_find_by'>find_by</span>(<span class='id identifier rubyid_attributes'>attributes</span>) <span class='op'>||</span> <span class='id identifier rubyid_create_or_find_by!'><a href="#create_or_find_by!-instance_method" title="ActiveRecord::Relation#create_or_find_by! (method)">create_or_find_by!</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="find_or_initialize_by-instance_method">
  <h3 class='signature '>
    #<strong>find_or_initialize_by</strong>(attributes, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Like <a href="#find_or_create_by-instance_method" title="ActiveRecord::Relation#find_or_create_by (method)">#find_or_create_by</a>, but calls <code>new</code> instead of <a href="Persistence/ClassMethods.html#create-instance_method" title="ActiveRecord::Persistence::ClassMethods#create (method)">create</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L305-L307'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='305' data-end='307'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 305</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_find_or_initialize_by'>find_or_initialize_by</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_find_by'>find_by</span>(<span class='id identifier rubyid_attributes'>attributes</span>) <span class='op'>||</span> <span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveRecord::Relation.new (method)">new</a></span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="initialize_copy-instance_method">
  <h3 class='signature '>
    #<strong>initialize_copy</strong>(other)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L90-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='90' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 90</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_copy'>initialize_copy</span>(<span class='id identifier rubyid_other'>other</span>)
  <span class='ivar'>@values</span> <span class='op'>=</span> <span class='ivar'>@values</span>.<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Relation#reset (method)">reset</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert-instance_method">
  <h3 class='signature '>
    #<strong>insert</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>See <a href="#insert_all-instance_method" title="ActiveRecord::Relation#insert_all (method)">#insert_all</a> for documentation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L647-L649'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='647' data-end='649'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 647</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert'>insert</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_insert_all'><a href="#insert_all-instance_method" title="ActiveRecord::Relation#insert_all (method)">insert_all</a></span>([ <span class='id identifier rubyid_attributes'>attributes</span> ]<span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='id identifier rubyid_unique_by'>unique_by</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert!-instance_method">
  <h3 class='signature '>
    #<strong>insert!</strong>(attributes, returning: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>See <a href="#insert_all!-instance_method" title="ActiveRecord::Relation#insert_all! (method)">#insert_all!</a> for more.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L736-L738'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='736' data-end='738'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 736</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert!'>insert!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_insert_all!'><a href="#insert_all!-instance_method" title="ActiveRecord::Relation#insert_all! (method)">insert_all!</a></span>([ <span class='id identifier rubyid_attributes'>attributes</span> ]<span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_all-instance_method">
  <h3 class='signature '>
    #<strong>insert_all</strong>(attributes, returning: nil, unique_by: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>The <code>attributes</code> parameter is an <a href="../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. Every Hash determines the attributes for a single row and must have the same keys.</p>

<p>Rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped. Override with <code>:unique_by</code> (see below).</p>

<p>Returns an <a href="Result.html" title="ActiveRecord::Result (class)"><code>Result</code></a> with its contents based on <code>:returning</code> (see below).</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt>:returning</dt>
<dd>
<p>(PostgreSQL, SQLite3, and MariaDB only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p>

<p>You can also pass an SQL string if you need more control on the return values (for example, <code>returning: Arel.sql(&quot;id, name as new_name&quot;)</code>).</p>
</dd><dt>:unique_by</dt>
<dd>
<p>(PostgreSQL and SQLite only) By default rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped.</p>

<p>To skip rows according to just one unique index pass <code>:unique_by</code>.</p>

<p>Consider a Book model where no duplicate ISBNs make sense, but if any row has an existing id, or is not unique by another unique index, ActiveRecord::RecordNotUnique is raised.</p>

<p>Unique indexes can be identified by columns or name:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='words_sep'> </span><span class='tstring_content'>author_id</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index_books_on_isbn'>index_books_on_isbn</span></code></pre>
</dd><dt>:record_timestamps</dt>
<dd>
<p>By default, automatic setting of timestamp columns is controlled by the model’s <code>record_timestamps</code> config, matching typical behavior.</p>

<p>To override this and force automatic setting of timestamp columns one way or the other, pass <code>:record_timestamps</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>true</span>  <span class='comment'># Always set timestamps automatically
</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>false</span> <span class='comment'># Never set timestamps automatically</span></code></pre>
</dd></dl>

<p>Because it relies on the index information from the database <code>:unique_by</code> is recommended to be paired with Active Record’s schema_cache.</p>

<h4 id="label-Example">Example</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Insert records and skip inserting any duplicates.
</span><span class='comment'># Here &quot;Eloquent Ruby&quot; is skipped because its id is not unique.
</span>
<span class='const'>Book</span>.<span class='id identifier rubyid_insert_all'>insert_all</span>([
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span> }
])

<span class='comment'># insert_all works on chained scopes, and you can use create_with
</span><span class='comment'># to set default attributes for all inserted records.
</span>
<span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_books'>books</span>.<span class='id identifier rubyid_create_with'>create_with</span>(<span class='label'>created_at:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_now'>now</span>).<span class='id identifier rubyid_insert_all'>insert_all</span>([
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span> }
])</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L726-L728'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='726' data-end='728'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 726</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert_all'>insert_all</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="InsertAll.html" title="ActiveRecord::InsertAll (class)">InsertAll</a></span>.<span class='id identifier rubyid_execute'><a href="InsertAll.html#execute-class_method" title="ActiveRecord::InsertAll.execute (method)">execute</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_skip'>skip</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='id identifier rubyid_unique_by'>unique_by</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_all!-instance_method">
  <h3 class='signature '>
    #<strong>insert_all!</strong>(attributes, returning: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>The <code>attributes</code> parameter is an <a href="../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. Every Hash determines the attributes for a single row and must have the same keys.</p>

<p>Raises <a href="RecordNotUnique.html" title="ActiveRecord::RecordNotUnique (class)"><code>RecordNotUnique</code></a> if any rows violate a unique index on the table. In that case, no rows are inserted.</p>

<p>To skip duplicate rows, see <a href="#insert_all-instance_method" title="ActiveRecord::Relation#insert_all (method)">#insert_all</a>. To replace them, see <a href="#upsert_all-instance_method" title="ActiveRecord::Relation#upsert_all (method)">#upsert_all</a>.</p>

<p>Returns an <a href="Result.html" title="ActiveRecord::Result (class)"><code>Result</code></a> with its contents based on <code>:returning</code> (see below).</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt>:returning</dt>
<dd>
<p>(PostgreSQL, SQLite3, and MariaDB only) An array of attributes to return for all successfully inserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p>

<p>You can also pass an SQL string if you need more control on the return values (for example, <code>returning: Arel.sql(&quot;id, name as new_name&quot;)</code>).</p>
</dd><dt>:record_timestamps</dt>
<dd>
<p>By default, automatic setting of timestamp columns is controlled by the model’s <code>record_timestamps</code> config, matching typical behavior.</p>

<p>To override this and force automatic setting of timestamp columns one way or the other, pass <code>:record_timestamps</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>true</span>  <span class='comment'># Always set timestamps automatically
</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>false</span> <span class='comment'># Never set timestamps automatically</span></code></pre>
</dd></dl>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Insert multiple records
</span><span class='const'>Book</span>.<span class='id identifier rubyid_insert_all!'>insert_all!</span>([
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span> }
])

<span class='comment'># Raises ActiveRecord::RecordNotUnique because &quot;Eloquent Ruby&quot;
</span><span class='comment'># does not have a unique id.
</span><span class='const'>Book</span>.<span class='id identifier rubyid_insert_all!'>insert_all!</span>([
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span> }
])</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L793-L795'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='793' data-end='795'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 793</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_insert_all!'>insert_all!</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="InsertAll.html" title="ActiveRecord::InsertAll (class)">InsertAll</a></span>.<span class='id identifier rubyid_execute'><a href="InsertAll.html#execute-class_method" title="ActiveRecord::InsertAll.execute (method)">execute</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_raise'>raise</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1282-L1289'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1282' data-end='1289'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1282</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span> <span class='op'>?</span> <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span> <span class='op'>:</span> <span class='id identifier rubyid_annotate'>annotate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>loading for inspect</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_entries'>entries</span> <span class='op'>=</span> <span class='id identifier rubyid_subject'>subject</span>.<span class='id identifier rubyid_take'>take</span>([<span class='id identifier rubyid_limit_value'>limit_value</span><span class='comma'>,</span> <span class='int'>11</span>].<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_min'>min</span>).<span class='id identifier rubyid_map!'>map!</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_inspect'>inspect</span>)

  <span class='id identifier rubyid_entries'>entries</span>[<span class='int'>10</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_entries'>entries</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Relation#size (method)">size</a></span> <span class='op'>==</span> <span class='int'>11</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_class'>class</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_entries'>entries</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>]&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="joined_includes_values-instance_method">
  <h3 class='signature '>
    #<strong>joined_includes_values</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Joins that are also marked for preloading. In which case we should just eager load them. Note that this is a naive implementation because we could have strings and symbols which represent the same association, but that aren’t matched by this. Also, we could have nested hashes which partially match, e.g. <code>{ a: :b } &amp; { a: [:b, :c] }</code></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1244-L1246'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1244' data-end='1246'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_joined_includes_values'>joined_includes_values</span>
  <span class='id identifier rubyid_includes_values'>includes_values</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_joins_values'>joins_values</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load-instance_method">
  <h3 class='signature '>
    #<strong>load</strong>(&amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Causes the records to be loaded from the database if they have not been loaded already. You can use this if for some reason you need to explicitly load some records before actually using them. The return value is the relation itself, not the records.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_load'>load</span> <span class='comment'># =&gt; #&lt;ActiveRecord::Relation&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1175-L1182'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1175' data-end='1182'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1175</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load'>load</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_scheduled?'><a href="#scheduled%3F-instance_method" title="ActiveRecord::Relation#scheduled? (method)">scheduled?</a></span>
    <span class='ivar'>@records</span> <span class='op'>=</span> <span class='id identifier rubyid_exec_queries'><a href="Relation/RecordFetchWarning.html#exec_queries-instance_method" title="ActiveRecord::Relation::RecordFetchWarning#exec_queries (method)">exec_queries</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='ivar'>@loaded</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="load_async-instance_method">
  <h3 class='signature '>
    #<strong>load_async</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Schedule the query to be performed from a background thread pool.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>).<span class='id identifier rubyid_load_async'>load_async</span> <span class='comment'># =&gt; #&lt;ActiveRecord::Relation&gt;</span></code></pre>

<p>When the <code>Relation</code> is iterated, if the background query wasn’t executed yet, it will be performed by the foreground thread.</p>

<p>Note that <a href="https://guides.rubyonrails.org/configuring.html#config-active-record-async-query-executor" target="_parent" title="config.active_record.async_query_executor">config.active_record.async_query_executor</a> must be configured for queries to actually be executed concurrently. Otherwise it defaults to executing them in the foreground.</p>

<p><code>load_async</code> will also fall back to executing in the foreground in the test environment when transactional fixtures are enabled.</p>

<p>If the query was actually executed in the background, the Active Record logs will show it by prefixing the log line with <code>ASYNC</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>ASYNC</span> <span class='const'>Post</span> <span class='const'>Load</span> (<span class='float'>0.0</span><span class='id identifier rubyid_ms'>ms</span>) (<span class='id identifier rubyid_db'>db</span> <span class='id identifier rubyid_time'>time</span> <span class='int'>2</span><span class='id identifier rubyid_ms'>ms</span>)  <span class='const'>SELECT</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts</span><span class='tstring_end'>&quot;</span></span>.<span class='op'>*</span> <span class='const'>FROM</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>posts</span><span class='tstring_end'>&quot;</span></span> <span class='const'>LIMIT</span> <span class='int'>100</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1144-L1161'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1144' data-end='1161'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1144</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_load_async'>load_async</span>
  <span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_load'><a href="#load-instance_method" title="ActiveRecord::Relation#load (method)">load</a></span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_async_enabled?'>async_enabled?</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_exec_main_query'>exec_main_query</span>(<span class='label'>async:</span> <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_current_transaction'>current_transaction</span>.<span class='id identifier rubyid_closed?'>closed?</span>)

      <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
        <span class='ivar'>@records</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>
      <span class='kw'>else</span>
        <span class='ivar'>@future_result</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>
      <span class='kw'>end</span>
      <span class='ivar'>@loaded</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="loaded-instance_method">
  <h3 class='signature ro'>
    #<strong>loaded</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#loaded?</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L71-L71'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='71' data-end='71'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 71</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_loaded'>loaded</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_predicate_builder'><a href="#predicate_builder-instance_method" title="ActiveRecord::Relation#predicate_builder (method)">predicate_builder</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="locked?-instance_method">
  <h3 class='signature '>
    #<strong>locked?</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L75-L75'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='75' data-end='75'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 75</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='symbeg'>:</span><span class='id identifier rubyid_locked?'>locked?</span> <span class='symbeg'>:</span><span class='id identifier rubyid_lock_value'>lock_value</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="new-instance_method">
  <h3 class='signature '>
    #<strong>new</strong>(attributes = nil, &amp;block)  
    <span class='aliases'>Also known as: <span class='names'>#build</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Initializes new record from relation while maintaining the current scope.</p>

<p>Expects arguments in the same format as <code>{ActiveRecord::Base</code>.new}.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DHH</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_new'>new</span> <span class='comment'># =&gt; #&lt;User id: nil, name: &quot;DHH&quot;, created_at: nil, updated_at: nil&gt;</span></code></pre>

<p>You can also pass a block to new with the new record as argument:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_users'>users</span>.<span class='id identifier rubyid_new'>new</span> { <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Oscar</span><span class='tstring_end'>&#39;</span></span> }
<span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_name'>name</span> <span class='comment'># =&gt; Oscar</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L118-L125'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='118' data-end='125'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 118</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>)
    <span class='id identifier rubyid_attributes'>attributes</span>.<span class='id identifier rubyid_collect'>collect</span> { <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span> <span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>else</span>
    <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_current_scope_restoring_block'>current_scope_restoring_block</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
    <span class='id identifier rubyid_scoping'><a href="#scoping-instance_method" title="ActiveRecord::Relation#scoping (method)">scoping</a></span> { <span class='id identifier rubyid__new'>_new</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="none?-instance_method">
  <h3 class='signature '>
    #<strong>none?</strong>(*args)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if there are no records.</p>

<p>When a pattern argument is given, this method checks whether elements in the <a href="../Enumerable.html" title="Enumerable (module)"><code>::Enumerable</code></a> match the pattern via the case-equality operator (<code>===</code>).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_none?'>none?</span>(<span class='const'>Comment</span>) <span class='comment'># =&gt; true or false</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L381-L386'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='381' data-end='386'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 381</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_none?'>none?</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="one?-instance_method">
  <h3 class='signature '>
    #<strong>one?</strong>(*args)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if there is exactly one record.</p>

<p>When a pattern argument is given, this method checks whether elements in the <a href="../Enumerable.html" title="Enumerable (module)"><code>::Enumerable</code></a> match the pattern via the case-equality operator (<code>===</code>).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_one?'>one?</span>(<span class='const'>Post</span>) <span class='comment'># =&gt; true or false</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L407-L413'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='407' data-end='413'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 407</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_one?'>one?</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='kw'>return</span> <span class='kw'>super</span> <span class='kw'>if</span> <span class='id identifier rubyid_args'>args</span>.<span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_one?'>one?</span> <span class='kw'>if</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span>
  <span class='id identifier rubyid_limited_count'>limited_count</span> <span class='op'>==</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pretty_print-instance_method">
  <h3 class='signature '>
    #<strong>pretty_print</strong>(pp)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1260-L1267'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1260' data-end='1267'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1260</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pretty_print'>pretty_print</span>(<span class='id identifier rubyid_pp'>pp</span>)
  <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span> <span class='op'>?</span> <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span> <span class='op'>:</span> <span class='id identifier rubyid_annotate'>annotate</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>loading for pp</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_entries'>entries</span> <span class='op'>=</span> <span class='id identifier rubyid_subject'>subject</span>.<span class='id identifier rubyid_take'>take</span>([<span class='id identifier rubyid_limit_value'>limit_value</span><span class='comma'>,</span> <span class='int'>11</span>].<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_min'>min</span>)

  <span class='id identifier rubyid_entries'>entries</span>[<span class='int'>10</span>] <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_entries'>entries</span>.<span class='id identifier rubyid_size'><a href="#size-instance_method" title="ActiveRecord::Relation#size (method)">size</a></span> <span class='op'>==</span> <span class='int'>11</span>

  <span class='id identifier rubyid_pp'>pp</span>.<span class='id identifier rubyid_pp'>pp</span>(<span class='id identifier rubyid_entries'>entries</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reload-instance_method">
  <h3 class='signature '>
    #<strong>reload</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Forces reloading of relation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1185-L1188'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1185' data-end='1188'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1185</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reload'>reload</span>
  <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Relation#reset (method)">reset</a></span>
  <span class='id identifier rubyid_load'><a href="#load-instance_method" title="ActiveRecord::Relation#load (method)">load</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset-instance_method">
  <h3 class='signature '>
    #<strong>reset</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1190-L1200'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1190' data-end='1200'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1190</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reset'>reset</span>
  <span class='ivar'>@future_result</span><span class='op'>&amp;.</span><span class='id identifier rubyid_cancel'>cancel</span>
  <span class='ivar'>@future_result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@delegate_to_klass</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@to_sql</span> <span class='op'>=</span> <span class='ivar'>@arel</span> <span class='op'>=</span> <span class='ivar'>@loaded</span> <span class='op'>=</span> <span class='ivar'>@should_eager_load</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@offsets</span> <span class='op'>=</span> <span class='ivar'>@take</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@cache_keys</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@cache_versions</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@records</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scope_for_create-instance_method">
  <h3 class='signature '>
    #<strong>scope_for_create</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1227-L1231'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1227' data-end='1231'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1227</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_scope_for_create'>scope_for_create</span>
  <span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='id identifier rubyid_where_clause'>where_clause</span>.<span class='id identifier rubyid_to_h'>to_h</span>(<span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_table_name'>table_name</span><span class='comma'>,</span> <span class='label'>equality_only:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_create_with_value'>create_with_value</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_hash'>hash</span>[<span class='id identifier rubyid_k'>k</span>.<span class='id identifier rubyid_to_s'>to_s</span>] <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span> } <span class='kw'>unless</span> <span class='id identifier rubyid_create_with_value'>create_with_value</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>
  <span class='id identifier rubyid_hash'>hash</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="scoping-instance_method">
  <h3 class='signature '>
    #<strong>scoping</strong>(all_queries: nil, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Scope all queries to the current scope.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Comment</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>post_id:</span> <span class='int'>1</span>).<span class='id identifier rubyid_scoping'>scoping</span> <span class='kw'>do</span>
  <span class='const'>Comment</span>.<span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span>
<span class='comment'># SELECT &quot;comments&quot;.* FROM &quot;comments&quot; WHERE &quot;comments&quot;.&quot;post_id&quot; = 1 ORDER BY &quot;comments&quot;.&quot;id&quot; ASC LIMIT 1</span></code></pre>

<p>If <code>all_queries: true</code> is passed, scoping will apply to all queries for the relation including <a href="#update-instance_method" title="ActiveRecord::Relation#update (method)">#update</a> and <a href="#delete-instance_method" title="ActiveRecord::Relation#delete (method)">#delete</a> on instances. Once <code>all_queries</code> is set to true it cannot be set to false in a nested block.</p>

<p>Please check unscoped if you want to remove all previous scopes (including the default_scope) during the execution of a block.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L544-L553'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='544' data-end='553'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 544</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_scoping'>scoping</span>(<span class='label'>all_queries:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_registry'>registry</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_scope_registry'>scope_registry</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_global_scope?'>global_scope?</span>(<span class='id identifier rubyid_registry'>registry</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_all_queries'>all_queries</span> <span class='op'>==</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Scoping is set to apply to all queries and cannot be unset in a nested block.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_already_in_scope?'>already_in_scope?</span>(<span class='id identifier rubyid_registry'>registry</span>)
    <span class='kw'>yield</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid__scoping'>_scoping</span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_registry'>registry</span><span class='comma'>,</span> <span class='id identifier rubyid_all_queries'>all_queries</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="size-instance_method">
  <h3 class='signature '>
    #<strong>size</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns size of the records.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L356-L362'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='356' data-end='362'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 356</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_loaded?'><a href="#loaded%3F-instance_method" title="ActiveRecord::Relation#loaded? (method)">loaded?</a></span>
    <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_length'>length</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_count'>count</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_all'>all</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_a-instance_method">
  <h3 class='signature '>
    #<strong>to_a</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#to_ary-instance_method" title="ActiveRecord::Relation#to_ary (method)">#to_ary</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L343-L343'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='343' data-end='343'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 343</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_to_a'>to_a</span> <span class='id identifier rubyid_to_ary'><a href="#to_ary-instance_method" title="ActiveRecord::Relation#to_ary (method)">to_ary</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_ary-instance_method">
  <h3 class='signature '>
    #<strong>to_ary</strong>  
    <span class='aliases'>Also known as: <span class='names'>#to_a</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Converts relation objects to <a href="../Array.html" title="Array (class)"><code>::Array</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L340-L342'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='340' data-end='342'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 340</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_ary'>to_ary</span>
  <span class='id identifier rubyid_records'><a href="#records-instance_method" title="ActiveRecord::Relation#records (method)">records</a></span>.<span class='id identifier rubyid_dup'>dup</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_sql-instance_method">
  <h3 class='signature '>
    #<strong>to_sql</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns sql statement for the relation.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>User</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Oscar</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_to_sql'>to_sql</span>
<span class='comment'># SELECT &quot;users&quot;.* FROM &quot;users&quot;  WHERE &quot;users&quot;.&quot;name&quot; = &#39;Oscar&#39;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1206-L1217'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1206' data-end='1217'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1206</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_sql'>to_sql</span>
  <span class='ivar'>@to_sql</span> <span class='op'>||=</span> <span class='kw'>if</span> <span class='id identifier rubyid_eager_loading?'><a href="#eager_loading%3F-instance_method" title="ActiveRecord::Relation#eager_loading? (method)">eager_loading?</a></span>
    <span class='id identifier rubyid_apply_join_dependency'>apply_join_dependency</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_relation'>relation</span><span class='comma'>,</span> <span class='id identifier rubyid_join_dependency'>join_dependency</span><span class='op'>|</span>
      <span class='id identifier rubyid_relation'>relation</span> <span class='op'>=</span> <span class='id identifier rubyid_join_dependency'>join_dependency</span>.<span class='id identifier rubyid_apply_column_aliases'>apply_column_aliases</span>(<span class='id identifier rubyid_relation'>relation</span>)
      <span class='id identifier rubyid_relation'>relation</span>.<span class='id identifier rubyid_to_sql'>to_sql</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='op'>|</span>
      <span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_unprepared_statement'>unprepared_statement</span> { <span class='id identifier rubyid_conn'>conn</span>.<span class='id identifier rubyid_to_sql'>to_sql</span>(<span class='id identifier rubyid_arel'>arel</span>) }
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="touch_all-instance_method">
  <h3 class='signature '>
    #<strong>touch_all</strong>(*names, time: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Touches all records in the current relation, setting the <code>updated_at+/+updated_on</code> attributes to the current time or the time specified. It does not instantiate the involved models, and it does not trigger Active Record callbacks or validations. This method can be passed attribute names and an optional time argument. If attribute names are passed, they are updated along with <code>updated_at+/+updated_on</code> attributes. If no time argument is passed, the current time is used as default.</p>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Touch all records
</span><span class='const'>Person</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_touch_all'>touch_all</span>
<span class='comment'># =&gt; &quot;UPDATE \&quot;people\&quot; SET \&quot;updated_at\&quot; = &#39;2018-01-04 22:55:23.132670&#39;&quot;
</span>
<span class='comment'># Touch multiple records with a custom attribute
</span><span class='const'>Person</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_touch_all'>touch_all</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_created_at'>created_at</span>)
<span class='comment'># =&gt; &quot;UPDATE \&quot;people\&quot; SET \&quot;updated_at\&quot; = &#39;2018-01-04 22:55:23.132670&#39;, \&quot;created_at\&quot; = &#39;2018-01-04 22:55:23.132670&#39;&quot;
</span>
<span class='comment'># Touch multiple records with a specified time
</span><span class='const'>Person</span>.<span class='id identifier rubyid_all'>all</span>.<span class='id identifier rubyid_touch_all'>touch_all</span>(<span class='label'>time:</span> <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveRecord::Relation.new (method)">new</a></span>(<span class='int'>2020</span><span class='comma'>,</span> <span class='int'>5</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>))
<span class='comment'># =&gt; &quot;UPDATE \&quot;people\&quot; SET \&quot;updated_at\&quot; = &#39;2020-05-16 00:00:00&#39;&quot;
</span>
<span class='comment'># Touch records with scope
</span><span class='const'>Person</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>David</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_touch_all'>touch_all</span>
<span class='comment'># =&gt; &quot;UPDATE \&quot;people\&quot; SET \&quot;updated_at\&quot; = &#39;2018-01-04 22:55:23.132670&#39; WHERE \&quot;people\&quot;.\&quot;name\&quot; = &#39;David&#39;&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L972-L974'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='972' data-end='974'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 972</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_touch_all'>touch_all</span>(<span class='op'>*</span><span class='id identifier rubyid_names'>names</span><span class='comma'>,</span> <span class='label'>time:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_update_all'><a href="#update_all-instance_method" title="ActiveRecord::Relation#update_all (method)">update_all</a></span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_touch_attributes_with_time'>touch_attributes_with_time</span>(<span class='op'>*</span><span class='id identifier rubyid_names'>names</span><span class='comma'>,</span> <span class='label'>time:</span> <span class='id identifier rubyid_time'>time</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_all-instance_method">
  <h3 class='signature '>
    #<strong>update_all</strong>(updates)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates all records in the current relation with details given. This method constructs a single SQL UPDATE statement and sends it straight to the database. It does not instantiate the involved models and it does not trigger Active Record callbacks or validations. However, values passed to <code>#update_all</code> will still go through Active Record’s normal type casting and serialization. Returns the number of rows affected.</p>

<p>Note: As Active Record callbacks are not triggered, this method will not automatically update <code>updated_at+/+updated_on</code> columns.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>updates</code> - A string, array, or hash representing the SET part of an SQL statement. Any strings provided will be type cast, unless you use <a href="../Arel.html#sql-class_method" title="Arel.sql (method)">Arel.sql</a>. (Don’t pass user-provided values to <a href="../Arel.html#sql-class_method" title="Arel.sql (method)">Arel.sql</a>.)</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Update all customers with the given attributes
</span><span class='const'>Customer</span>.<span class='id identifier rubyid_update_all'>update_all</span> <span class='label'>wants_email:</span> <span class='kw'>true</span>

<span class='comment'># Update all books with &#39;Rails&#39; in their title
</span><span class='const'>Book</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title LIKE ?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Rails%</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_update_all'>update_all</span>(<span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>David</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Update all books that match conditions, but limit it to 5 ordered by date
</span><span class='const'>Book</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title LIKE ?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Rails%</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_order'>order</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_created_at'>created_at</span>).<span class='id identifier rubyid_limit'>limit</span>(<span class='int'>5</span>).<span class='id identifier rubyid_update_all'>update_all</span>(<span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>David</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Update all invoices and set the number column to its id value.
</span><span class='const'>Invoice</span>.<span class='id identifier rubyid_update_all'>update_all</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>number = id</span><span class='tstring_end'>&#39;</span></span>)

<span class='comment'># Update all books with &#39;Rails&#39; in their title
</span><span class='const'>Book</span>.<span class='id identifier rubyid_where'>where</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title LIKE ?</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Rails%</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_update_all'>update_all</span>(<span class='label'>title:</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title + &#39; - volume 1&#39;</span><span class='tstring_end'>&quot;</span></span>))</code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L591-L622'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='591' data-end='622'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 591</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_all'>update_all</span>(<span class='id identifier rubyid_updates'>updates</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Empty list of attributes to change</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_updates'>updates</span>.<span class='id identifier rubyid_blank?'><a href="#blank%3F-instance_method" title="ActiveRecord::Relation#blank? (method)">blank?</a></span>

  <span class='kw'>return</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='ivar'>@none</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_updates'>updates</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../Hash.html" title="Hash (class)">Hash</a></span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_locking_enabled?'>locking_enabled?</span> <span class='op'>&amp;&amp;</span>
        <span class='op'>!</span><span class='id identifier rubyid_updates'>updates</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_locking_column'>locking_column</span>) <span class='op'>&amp;&amp;</span>
        <span class='op'>!</span><span class='id identifier rubyid_updates'>updates</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_locking_column'>locking_column</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>)
      <span class='id identifier rubyid_attr'>attr</span> <span class='op'>=</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>[<span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_locking_column'>locking_column</span>]
      <span class='id identifier rubyid_updates'>updates</span>[<span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_name'>name</span>] <span class='op'>=</span> <span class='id identifier rubyid__increment_attribute'>_increment_attribute</span>(<span class='id identifier rubyid_attr'>attr</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_values'><a href="#values-instance_method" title="ActiveRecord::Relation#values (method)">values</a></span> <span class='op'>=</span> <span class='id identifier rubyid__substitute_values'>_substitute_values</span>(<span class='id identifier rubyid_updates'>updates</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_values'><a href="#values-instance_method" title="ActiveRecord::Relation#values (method)">values</a></span> <span class='op'>=</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_sanitize_sql_for_assignment'>sanitize_sql_for_assignment</span>(<span class='id identifier rubyid_updates'>updates</span><span class='comma'>,</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>.<span class='id identifier rubyid_name'>name</span>))
  <span class='kw'>end</span>

  <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_with_connection'>with_connection</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='id identifier rubyid_arel'>arel</span> <span class='op'>=</span> <span class='id identifier rubyid_eager_loading?'><a href="#eager_loading%3F-instance_method" title="ActiveRecord::Relation#eager_loading? (method)">eager_loading?</a></span> <span class='op'>?</span> <span class='id identifier rubyid_apply_join_dependency'>apply_join_dependency</span>.<span class='id identifier rubyid_arel'>arel</span> <span class='op'>:</span> <span class='id identifier rubyid_build_arel'>build_arel</span>(<span class='id identifier rubyid_c'>c</span>)
    <span class='id identifier rubyid_arel'>arel</span>.<span class='id identifier rubyid_source'>source</span>.<span class='id identifier rubyid_left'>left</span> <span class='op'>=</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>

    <span class='id identifier rubyid_group_values_arel_columns'>group_values_arel_columns</span> <span class='op'>=</span> <span class='id identifier rubyid_arel_columns'>arel_columns</span>(<span class='id identifier rubyid_group_values'>group_values</span>.<span class='id identifier rubyid_uniq'>uniq</span>)
    <span class='id identifier rubyid_having_clause_ast'>having_clause_ast</span> <span class='op'>=</span> <span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_ast'>ast</span> <span class='kw'>unless</span> <span class='id identifier rubyid_having_clause'>having_clause</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_composite_primary_key?'>composite_primary_key?</span>
      <span class='id identifier rubyid_primary_key'>primary_key</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_pk'>pk</span><span class='op'>|</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>[<span class='id identifier rubyid_pk'>pk</span>] }
    <span class='kw'>else</span>
      <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>[<span class='id identifier rubyid_primary_key'>primary_key</span>]
    <span class='kw'>end</span>
    <span class='id identifier rubyid_stmt'>stmt</span> <span class='op'>=</span> <span class='id identifier rubyid_arel'>arel</span>.<span class='id identifier rubyid_compile_update'>compile_update</span>(<span class='id identifier rubyid_values'><a href="#values-instance_method" title="ActiveRecord::Relation#values (method)">values</a></span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_having_clause_ast'>having_clause_ast</span><span class='comma'>,</span> <span class='id identifier rubyid_group_values_arel_columns'>group_values_arel_columns</span>)
    <span class='id identifier rubyid_c'>c</span>.<span class='id identifier rubyid_update'><a href="#update-instance_method" title="ActiveRecord::Relation#update (method)">update</a></span>(<span class='id identifier rubyid_stmt'>stmt</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span><span class='embexpr_end'>}</span><span class='tstring_content'> Update All</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_tap'>tap</span> { <span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveRecord::Relation#reset (method)">reset</a></span> }
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="update_counters-instance_method">
  <h3 class='signature '>
    #<strong>update_counters</strong>(counters)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates the counters of the records in the current relation.</p>

<h4 id="label-Parameters">Parameters</h4>
<ul><li>
<p><code>counter</code> - A Hash containing the names of the fields to update as keys and the amount to update as values.</p>
</li><li>
<p><code>:touch</code> option - Touch the timestamp columns when updating.</p>
</li><li>
<p>If attributes names are passed, they are updated along with update_at/on attributes.</p>
</li></ul>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># For Posts by a given author increment the comment_count by 1.
</span><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>author_id:</span> <span class='id identifier rubyid_author'>author</span>.<span class='id identifier rubyid_id'>id</span>).<span class='id identifier rubyid_update_counters'>update_counters</span>(<span class='label'>comment_count:</span> <span class='int'>1</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L929-L947'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='929' data-end='947'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 929</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_update_counters'>update_counters</span>(<span class='id identifier rubyid_counters'>counters</span>)
  <span class='id identifier rubyid_touch'>touch</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_delete'><a href="#delete-instance_method" title="ActiveRecord::Relation#delete (method)">delete</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_touch'>touch</span>)

  <span class='id identifier rubyid_updates'>updates</span> <span class='op'>=</span> {}
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_counter_name'>counter_name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_attr'>attr</span> <span class='op'>=</span> <span class='id identifier rubyid_table'><a href="#table-instance_method" title="ActiveRecord::Relation#table (method)">table</a></span>[<span class='id identifier rubyid_counter_name'>counter_name</span>]
    <span class='id identifier rubyid_updates'>updates</span>[<span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_name'>name</span>] <span class='op'>=</span> <span class='id identifier rubyid__increment_attribute'>_increment_attribute</span>(<span class='id identifier rubyid_attr'>attr</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_touch'>touch</span>
    <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> <span class='id identifier rubyid_touch'>touch</span> <span class='kw'>if</span> <span class='id identifier rubyid_touch'>touch</span> <span class='op'>!=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> <span class='const'><a href="../Array.html" title="Array (class)">Array</a></span>.<span class='id identifier rubyid_wrap'><a href="../Array.html#wrap-class_method" title="Array.wrap (method)">wrap</a></span>(<span class='id identifier rubyid_names'>names</span>)
    <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_names'>names</span>.<span class='id identifier rubyid_extract_options!'>extract_options!</span>
    <span class='id identifier rubyid_touch_updates'>touch_updates</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'><a href="#klass-instance_method" title="ActiveRecord::Relation#klass (method)">klass</a></span>.<span class='id identifier rubyid_touch_attributes_with_time'>touch_attributes_with_time</span>(<span class='op'>*</span><span class='id identifier rubyid_names'>names</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>)
    <span class='id identifier rubyid_updates'>updates</span>.<span class='id identifier rubyid_merge!'>merge!</span>(<span class='id identifier rubyid_touch_updates'>touch_updates</span>) <span class='kw'>unless</span> <span class='id identifier rubyid_touch_updates'>touch_updates</span>.<span class='id identifier rubyid_empty?'><a href="#empty%3F-instance_method" title="ActiveRecord::Relation#empty? (method)">empty?</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_update_all'><a href="#update_all-instance_method" title="ActiveRecord::Relation#update_all (method)">update_all</a></span> <span class='id identifier rubyid_updates'>updates</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="upsert-instance_method">
  <h3 class='signature '>
    #<strong>upsert</strong>(attributes, **kwargs)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates or inserts (upserts) a single record into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>See <a href="#upsert_all-instance_method" title="ActiveRecord::Relation#upsert_all (method)">#upsert_all</a> for documentation.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L803-L805'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='803' data-end='805'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 803</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_upsert'>upsert</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
  <span class='id identifier rubyid_upsert_all'><a href="#upsert_all-instance_method" title="ActiveRecord::Relation#upsert_all (method)">upsert_all</a></span>([ <span class='id identifier rubyid_attributes'>attributes</span> ]<span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="upsert_all-instance_method">
  <h3 class='signature '>
    #<strong>upsert_all</strong>(attributes, on_duplicate: :update, update_only: nil, returning: nil, unique_by: nil, record_timestamps: nil)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Updates or inserts (upserts) multiple records into the database in a single SQL INSERT statement. It does not instantiate any models nor does it trigger Active Record callbacks or validations. Though passed values go through Active Record’s type casting and serialization.</p>

<p>The <code>attributes</code> parameter is an <a href="../Array.html" title="Array (class)"><code>::Array</code></a> of Hashes. Every Hash determines the attributes for a single row and must have the same keys.</p>

<p>Returns an <a href="Result.html" title="ActiveRecord::Result (class)"><code>Result</code></a> with its contents based on <code>:returning</code> (see below).</p>

<p>By default, <code>upsert_all</code> will update all the columns that can be updated when there is a conflict. These are all the columns except primary keys, read-only columns, and columns covered by the optional <code>unique_by</code>.</p>

<h4 id="label-Options">Options</h4>
<dl class="rdoc-list label-list"><dt>:returning</dt>
<dd>
<p>(PostgreSQL, SQLite3, and MariaDB only) An array of attributes to return for all successfully upserted records, which by default is the primary key. Pass <code>returning: %w[ id name ]</code> for both id and name or <code>returning: false</code> to omit the underlying <code>RETURNING</code> SQL clause entirely.</p>

<p>You can also pass an SQL string if you need more control on the return values (for example, <code>returning: Arel.sql(&quot;id, name as new_name&quot;)</code>).</p>
</dd><dt>:unique_by</dt>
<dd>
<p>(PostgreSQL and SQLite only) By default rows are considered to be unique by every unique index on the table. Any duplicate rows are skipped.</p>

<p>To skip rows according to just one unique index pass <code>:unique_by</code>.</p>

<p>Consider a Book model where no duplicate ISBNs make sense, but if any row has an existing id, or is not unique by another unique index, ActiveRecord::RecordNotUnique is raised.</p>

<p>Unique indexes can be identified by columns or name:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='qsymbols'><span class='qsymbols_beg'>%i[</span><span class='words_sep'> </span><span class='tstring_content'>author_id</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_end'>]</span></span>
<span class='id identifier rubyid_unique_by'>unique_by</span><span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index_books_on_isbn'>index_books_on_isbn</span></code></pre>
</dd></dl>

<p>Because it relies on the index information from the database <code>:unique_by</code> is recommended to be paired with Active Record’s schema_cache.</p>
<dl class="rdoc-list label-list"><dt>:on_duplicate</dt>
<dd>
<p>Configure the SQL update sentence that will be used in case of conflict.</p>

<p>NOTE: If you use this option you must provide all the columns you want to update by yourself.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Commodity</span>.<span class='id identifier rubyid_upsert_all'>upsert_all</span>(
  [
    { <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Copper</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>4.84</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>4</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gold</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>1380.87</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>6</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Aluminium</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>0.35</span> }
  ]<span class='comma'>,</span>
  <span class='label'>on_duplicate:</span> <span class='const'><a href="../Arel.html" title="Arel (module)">Arel</a></span>.<span class='id identifier rubyid_sql'><a href="../Arel.html#sql-class_method" title="Arel.sql (method)">sql</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price = GREATEST(commodities.price, EXCLUDED.price)</span><span class='tstring_end'>&quot;</span></span>)
)</code></pre>

<p>See the related <code>:update_only</code> option. Both options can’t be used at the same time.</p>
</dd><dt>:update_only</dt>
<dd>
<p>Provide a list of column names that will be updated in case of conflict. If not provided, <code>upsert_all</code> will update all the columns that can be updated. These are all the columns except primary keys, read-only columns, and columns covered by the optional <code>unique_by</code></p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Commodity</span>.<span class='id identifier rubyid_upsert_all'>upsert_all</span>(
  [
    { <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Copper</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>4.84</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>4</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Gold</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>1380.87</span> }<span class='comma'>,</span>
    { <span class='label'>id:</span> <span class='int'>6</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Aluminium</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>price:</span> <span class='float'>0.35</span> }
  ]<span class='comma'>,</span>
  <span class='label'>update_only:</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_price'>price</span>] <span class='comment'># Only prices will be updated
</span>)</code></pre>

<p>See the related <code>:on_duplicate</code> option. Both options can’t be used at the same time.</p>
</dd><dt>:record_timestamps</dt>
<dd>
<p>By default, automatic setting of timestamp columns is controlled by the model’s <code>record_timestamps</code> config, matching typical behavior.</p>

<p>To override this and force automatic setting of timestamp columns one way or the other, pass <code>:record_timestamps</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>true</span>  <span class='comment'># Always set timestamps automatically
</span><span class='id identifier rubyid_record_timestamps'>record_timestamps</span><span class='op'>:</span> <span class='kw'>false</span> <span class='comment'># Never set timestamps automatically</span></code></pre>
</dd></dl>

<h4 id="label-Examples">Examples</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Inserts multiple records, performing an upsert when records have duplicate ISBNs.
</span><span class='comment'># Here &quot;Eloquent Ruby&quot; overwrites &quot;Rework&quot; because its ISBN is duplicate.
</span>
<span class='const'>Book</span>.<span class='id identifier rubyid_upsert_all'>upsert_all</span>([
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Rework</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>isbn:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> }<span class='comma'>,</span>
  { <span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eloquent Ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>author:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Russ</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>isbn:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> }
]<span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_isbn'>isbn</span>)

<span class='const'>Book</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>isbn:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_title'>title</span> <span class='comment'># =&gt; &quot;Eloquent Ruby&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L913-L915'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='913' data-end='915'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 913</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_upsert_all'>upsert_all</span>(<span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_update'><a href="#update-instance_method" title="ActiveRecord::Relation#update (method)">update</a></span><span class='comma'>,</span> <span class='label'>update_only:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='kw'>nil</span>)
  <span class='const'><a href="InsertAll.html" title="ActiveRecord::InsertAll (class)">InsertAll</a></span>.<span class='id identifier rubyid_execute'><a href="InsertAll.html#execute-class_method" title="ActiveRecord::InsertAll.execute (method)">execute</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_attributes'>attributes</span><span class='comma'>,</span> <span class='label'>on_duplicate:</span> <span class='id identifier rubyid_on_duplicate'>on_duplicate</span><span class='comma'>,</span> <span class='label'>update_only:</span> <span class='id identifier rubyid_update_only'>update_only</span><span class='comma'>,</span> <span class='label'>returning:</span> <span class='id identifier rubyid_returning'>returning</span><span class='comma'>,</span> <span class='label'>unique_by:</span> <span class='id identifier rubyid_unique_by'>unique_by</span><span class='comma'>,</span> <span class='label'>record_timestamps:</span> <span class='id identifier rubyid_record_timestamps'>record_timestamps</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="values-instance_method">
  <h3 class='signature '>
    #<strong>values</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.2.3/activerecord/lib/active_record/relation.rb#L1274-L1276'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1274' data-end='1276'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/relation.rb', line 1274</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_values'>values</span>
  <span class='ivar'>@values</span>.<span class='id identifier rubyid_dup'>dup</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>