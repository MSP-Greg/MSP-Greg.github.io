<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActiveRecord::Scoping::Default::ClassMethods &mdash; Rails 7.1.3.2</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveRecord::Scoping::Default::ClassMethods",
    relpath = '../../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Rails 7.1.3.2</a> &raquo; 
      <a href='../../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a> &raquo; 
        <a href="../../Scoping.html" title="ActiveRecord::Scoping (module)">Scoping</a> &raquo; 
        <a href="../Default.html" title="ActiveRecord::Scoping::Default (module)">Default</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActiveRecord::Scoping::Default::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activerecord/lib/active_record/scoping/default.rb#L23'>activerecord/lib/active_record/scoping/default.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#default_scopes%3F-instance_method" title="#default_scopes? (instance method)">#<strong>default_scopes?</strong>(all_queries: false)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the model has any default scopes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#unscoped-instance_method" title="#unscoped (instance method)">#<strong>unscoped</strong>(&amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a scope for the model without the previously set scopes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#default_scope-instance_method" title="#default_scope (instance method)">#<strong>default_scope</strong>(scope = nil, all_queries: nil, &amp;block)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Use this macro in your model to set a default scope for all operations on the model.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="default_scope-instance_method">
  <h3 class='signature priv first'>
    #<strong>default_scope</strong>(scope = nil, all_queries: nil, &amp;block)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Use this macro in your model to set a default scope for all operations on the model.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'><a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_default_scope'>default_scope</span> { <span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>) }
<span class='kw'>end</span>

<span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
<span class='comment'># SELECT * FROM articles WHERE published = true</span></code></pre>

<p>The <code>#default_scope</code> is also applied while creating/building a record. It is not applied while updating or deleting a record.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_new'>new</span>.<span class='id identifier rubyid_published'>published</span>    <span class='comment'># =&gt; true
</span><span class='const'>Article</span>.<span class='id identifier rubyid_create'>create</span>.<span class='id identifier rubyid_published'>published</span> <span class='comment'># =&gt; true</span></code></pre>

<p>To apply a <code>#default_scope</code> when updating or deleting a record, add <code>all_queries: true</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'><a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_default_scope'>default_scope</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='id identifier rubyid_where'>where</span>(<span class='label'>blog_id:</span> <span class='int'>1</span>) }<span class='comma'>,</span> <span class='label'>all_queries:</span> <span class='kw'>true</span>
<span class='kw'>end</span></code></pre>

<p>Applying a default scope to all queries will ensure that records are always queried by the additional conditions. Note that only where clauses apply, as it does not make sense to add order to queries that return a single object by primary key.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Article</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>).<span class='id identifier rubyid_destroy'>destroy</span>
<span class='comment'># DELETE ... FROM `articles` where ID = 1 AND blog_id = 1;</span></code></pre>

<p>(You can also pass any object which responds to <code>call</code> to the <code>default_scope</code> macro, and it will be called when building the default scope.)</p>

<p>If you use multiple <code>#default_scope</code> declarations in your model then they will be merged together:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'><a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_default_scope'>default_scope</span> { <span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>) }
  <span class='id identifier rubyid_default_scope'>default_scope</span> { <span class='id identifier rubyid_where'>where</span>(<span class='label'>rating:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>G</span><span class='tstring_end'>&#39;</span></span>) }
<span class='kw'>end</span>

<span class='const'>Article</span>.<span class='id identifier rubyid_all'>all</span>
<span class='comment'># SELECT * FROM articles WHERE published = true AND rating = &#39;G&#39;</span></code></pre>

<p>This is also the case with inheritance and module includes where the parent or module defines a <code>#default_scope</code> and the child or including class defines a second one.</p>

<p>If you need to do more complex things with a default scope, you can alternatively define it as a class method:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Article</span> <span class='op'>&lt;</span> <span class='const'><a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_default_scope'>default_scope</span>
    <span class='comment'># Should return a scope, you can call &#39;super&#39; here etc.
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activerecord/lib/active_record/scoping/default.rb#L129-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='129' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/scoping/default.rb', line 129</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_default_scope'>default_scope</span>(<span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>all_queries:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='comment'># :doc:
</span>  <span class='id identifier rubyid_scope'>scope</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'><a href="../../Relation.html" title="ActiveRecord::Relation (class)">Relation</a></span>) <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_scope'>scope</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Support for calling #default_scope without a block is removed. For example instead </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>of `default_scope where(color: &#39;red&#39;)`, please use </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>`default_scope { where(color: &#39;red&#39;) }`. (Alternatively you can just redefine </span><span class='tstring_end'>&quot;</span></span> \
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>self.default_scope.)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_default_scope'>default_scope</span> <span class='op'>=</span> <span class='const'><a href="../DefaultScope.html" title="ActiveRecord::Scoping::DefaultScope (class)">DefaultScope</a></span>.<span class='id identifier rubyid_new'><a href="../DefaultScope.html#new-class_method" title="ActiveRecord::Scoping::DefaultScope.new (method)">new</a></span>(<span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span> <span class='id identifier rubyid_all_queries'>all_queries</span>)

  <span class='kw'>self</span>.<span class='id identifier rubyid_default_scopes'>default_scopes</span> <span class='op'>+=</span> [<span class='id identifier rubyid_default_scope'>default_scope</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="default_scopes?-instance_method">
  <h3 class='signature '>
    #<strong>default_scopes?</strong>(all_queries: false)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the model has any default scopes. If all_queries is set to true, the method will check if there are any default_scopes for the model  where <code>all_queries</code> is true.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activerecord/lib/active_record/scoping/default.rb#L62-L68'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='62' data-end='68'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/scoping/default.rb', line 62</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_default_scopes?'>default_scopes?</span>(<span class='label'>all_queries:</span> <span class='kw'>false</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_all_queries'>all_queries</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_default_scopes'>default_scopes</span>.<span class='id identifier rubyid_any?'>any?</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_all_queries'>all_queries</span>)
  <span class='kw'>else</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_default_scopes'>default_scopes</span>.<span class='id identifier rubyid_any?'>any?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unscoped-instance_method">
  <h3 class='signature '>
    #<strong>unscoped</strong>(&amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a scope for the model without the previously set scopes.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Post</span> <span class='op'>&lt;</span> <span class='const'><a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>

  <span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_default_scope'><a href="#default_scope-instance_method" title="ActiveRecord::Scoping::Default::ClassMethods#default_scope (method)">default_scope</a></span>
    <span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>true</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'><a href="../../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span><span class='op'>::</span><span class='const'><a href="../../Base.html" title="ActiveRecord::Base (class)">Base</a></span>
  <span class='id identifier rubyid_has_many'>has_many</span> <span class='symbeg'>:</span><span class='id identifier rubyid_posts'>posts</span>
<span class='kw'>end</span>

<span class='const'>Post</span>.<span class='id identifier rubyid_all'>all</span>                                  <span class='comment'># Fires &quot;SELECT * FROM posts WHERE published = true&quot;
</span><span class='const'>Post</span>.<span class='id identifier rubyid_unscoped'>unscoped</span>.<span class='id identifier rubyid_all'>all</span>                         <span class='comment'># Fires &quot;SELECT * FROM posts&quot;
</span><span class='const'>Post</span>.<span class='id identifier rubyid_where'>where</span>(<span class='label'>published:</span> <span class='kw'>false</span>).<span class='id identifier rubyid_unscoped'>unscoped</span>.<span class='id identifier rubyid_all'>all</span> <span class='comment'># Fires &quot;SELECT * FROM posts&quot;
</span><span class='const'>User</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>).<span class='id identifier rubyid_posts'>posts</span>                        <span class='comment'># Fires &quot;SELECT * FROM posts WHERE published = true AND posts.user_id = 1&quot;
</span><span class='const'>User</span>.<span class='id identifier rubyid_find'>find</span>(<span class='int'>1</span>).<span class='id identifier rubyid_posts'>posts</span>.<span class='id identifier rubyid_unscoped'>unscoped</span>               <span class='comment'># Fires &quot;SELECT * FROM posts&quot;</span></code></pre>

<p>This method also accepts a block. All queries inside the block will not use the previously set scopes.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Post</span>.<span class='id identifier rubyid_unscoped'>unscoped</span> {
  <span class='const'>Post</span>.<span class='id identifier rubyid_limit'>limit</span>(<span class='int'>10</span>) <span class='comment'># Fires &quot;SELECT * FROM posts LIMIT 10&quot;
</span>}</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activerecord/lib/active_record/scoping/default.rb#L50-L52'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='50' data-end='52'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activerecord/lib/active_record/scoping/default.rb', line 50</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unscoped'>unscoped</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_block_given?'>block_given?</span> <span class='op'>?</span> <span class='id identifier rubyid_relation'>relation</span>.<span class='id identifier rubyid_scoping'>scoping</span>(<span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>) <span class='op'>:</span> <span class='id identifier rubyid_relation'>relation</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>