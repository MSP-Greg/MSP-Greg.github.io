<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: ActiveSupport::CurrentAttributes &mdash; Rails 7.1.3.2</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActiveSupport::CurrentAttributes",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Rails 7.1.3.2</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>CurrentAttributes&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: ActiveSupport::CurrentAttributes</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Class Chain:</div>
        <div class='box_22'>
          self,
          <a href="DescendantsTracker.html" title="ActiveSupport::DescendantsTracker (module)"><code>DescendantsTracker</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>Callbacks</code></a>
        </div>
      </td>
    </tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L91'>activesupport/lib/active_support/current_attributes.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Current+Attributes">Current Attributes</h3>

<p>Abstract super class that provides a thread-isolated attributes singleton, which resets automatically before and after each request. This allows you to keep all the per-request attributes easily available to the whole system.</p>

<p>The following full app-like example demonstrates how to use a Current class to facilitate easy access to the global, per-request attributes without passing them deeply around everywhere:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># app/models/current.rb
</span><span class='kw'>class</span> <span class='const'>Current</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'>CurrentAttributes</span>
  <span class='id identifier rubyid_attribute'><a href="#attribute-class_method" title="ActiveSupport::CurrentAttributes.attribute (method)">attribute</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_account'>account</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user'>user</span>
  <span class='id identifier rubyid_attribute'><a href="#attribute-class_method" title="ActiveSupport::CurrentAttributes.attribute (method)">attribute</a></span> <span class='symbeg'>:</span><span class='id identifier rubyid_request_id'>request_id</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_user_agent'>user_agent</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ip_address'>ip_address</span>

  <span class='id identifier rubyid_resets'><a href="#resets-class_method" title="ActiveSupport::CurrentAttributes.resets (method)">resets</a></span> { <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="../Time.html#zone-class_method" title="Time.zone (method)">zone</a></span> <span class='op'>=</span> <span class='kw'>nil</span> }

  <span class='kw'>def</span> <span class='id identifier rubyid_user='>user=</span>(<span class='id identifier rubyid_user'>user</span>)
    <span class='kw'>super</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_account'>account</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_account'>account</span>
    <span class='const'><a href="../Time.html" title="Time (class)">Time</a></span>.<span class='id identifier rubyid_zone'><a href="../Time.html#zone-class_method" title="Time.zone (method)">zone</a></span>    <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>.<span class='id identifier rubyid_time_zone'>time_zone</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># app/controllers/concerns/authentication.rb
</span><span class='kw'>module</span> <span class='const'>Authentication</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="Concern.html" title="ActiveSupport::Concern (module)">Concern</a></span>

  <span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_before_action'>before_action</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authenticate'>authenticate</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>
    <span class='kw'>def</span> <span class='id identifier rubyid_authenticate'>authenticate</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_authenticated_user'>authenticated_user</span> <span class='op'>=</span> <span class='const'>User</span>.<span class='id identifier rubyid_find_by'>find_by</span>(<span class='label'>id:</span> <span class='id identifier rubyid_cookies'>cookies</span>.<span class='id identifier rubyid_encrypted'>encrypted</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_user_id'>user_id</span>])
        <span class='const'>Current</span>.<span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_authenticated_user'>authenticated_user</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_new_session_url'>new_session_url</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='comment'># app/controllers/concerns/set_current_request_details.rb
</span><span class='kw'>module</span> <span class='const'>SetCurrentRequestDetails</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="Concern.html" title="ActiveSupport::Concern (module)">Concern</a></span>

  <span class='id identifier rubyid_included'>included</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_before_action'>before_action</span> <span class='kw'>do</span>
      <span class='const'>Current</span>.<span class='id identifier rubyid_request_id'>request_id</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_uuid'>uuid</span>
      <span class='const'>Current</span>.<span class='id identifier rubyid_user_agent'>user_agent</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_user_agent'>user_agent</span>
      <span class='const'>Current</span>.<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span>.<span class='id identifier rubyid_ip'>ip</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="../ActionController/Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Authentication</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>SetCurrentRequestDetails</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>MessagesController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
    <span class='const'>Current</span>.<span class='id identifier rubyid_account'>account</span>.<span class='id identifier rubyid_messages'>messages</span>.<span class='id identifier rubyid_create'>create</span>(<span class='id identifier rubyid_message_params'>message_params</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Message</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_belongs_to'>belongs_to</span> <span class='symbeg'>:</span><span class='id identifier rubyid_creator'>creator</span><span class='comma'>,</span> <span class='label'>default:</span> <span class='tlambda'>-&gt;</span> <span class='tlambeg'>{</span> <span class='const'>Current</span>.<span class='id identifier rubyid_user'>user</span> }
  <span class='id identifier rubyid_after_create'>after_create</span> { <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='op'>|</span> <span class='const'>Event</span>.<span class='id identifier rubyid_create'>create</span>(<span class='label'>record:</span> <span class='id identifier rubyid_message'>message</span>) }
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>Event</span> <span class='op'>&lt;</span> <span class='const'>ApplicationRecord</span>
  <span class='id identifier rubyid_before_create'>before_create</span> <span class='kw'>do</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_request_id'>request_id</span> <span class='op'>=</span> <span class='const'>Current</span>.<span class='id identifier rubyid_request_id'>request_id</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_user_agent'>user_agent</span> <span class='op'>=</span> <span class='const'>Current</span>.<span class='id identifier rubyid_user_agent'>user_agent</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_ip_address'>ip_address</span> <span class='op'>=</span> <span class='const'>Current</span>.<span class='id identifier rubyid_ip_address'>ip_address</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

<p>A word of caution: It’s easy to overdo a global singleton like Current and tangle your model as a result. Current should only be used for a few, top-level globals, like account, user, and request details. The attributes stuck in Current should be used by more or less all actions on all requests. If you start sticking controller-specific attributes in there, you’re going to create a mess.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
  <h3 class='inherited'><a href="Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>Callbacks</code></a> - Included</h3>
  <p  class='inherited'>
    <a href="Callbacks.html#CALLBACK_FILTER_TYPES-constant" title="ActiveSupport::Callbacks::CALLBACK_FILTER_TYPES (constant)">CALLBACK_FILTER_TYPES</a>
  </p>
</div>

<h2 class='h2_sum'><a href="Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>Callbacks</code></a> - Attributes &amp; Methods</h2>
<div>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#__callbacks-class_method" title=".__callbacks (class method)">.<strong>__callbacks</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#__callbacks-instance_method" title="#__callbacks (instance method)">#<strong>__callbacks</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#__callbacks%3F-class_method" title=".__callbacks? (class method)">.<strong>__callbacks?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#__callbacks%3F-instance_method" title="#__callbacks? (instance method)">#<strong>__callbacks?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#after_reset-class_method" title=".after_reset (class method)">.<strong>after_reset</strong>(*methods, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#resets-class_method" title="ActiveSupport::CurrentAttributes.resets (method)">.resets</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#attribute-class_method" title=".attribute (class method)">.<strong>attribute</strong>(*names)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Declares one or more attributes that will be given both class and instance accessor methods.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#before_reset-class_method" title=".before_reset (class method)">.<strong>before_reset</strong>(*methods, &amp;block)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Calls this callback before <a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">#reset</a> is called on the instance.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#instance-class_method" title=".instance (class method)">.<strong>instance</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns singleton instance for this class in this thread.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>  &#x21d2; CurrentAttributes </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#resets-class_method" title=".resets (class method)">.<strong>resets</strong>(*methods, &amp;block)  </a>
      (also: .after_reset)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Calls this callback after <a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">#reset</a> is called on the instance.</p></div>
    </div>
  </li>
</ul>

<h3 class='inherited'><a href="DescendantsTracker.html" title="ActiveSupport::DescendantsTracker (module)"><code>DescendantsTracker</code></a> - self</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="DescendantsTracker.html#descendants-class_method" title="ActiveSupport::DescendantsTracker.descendants (method)">descendants</a></td>
      <td><div class='inline'><p>See additional method definition at line 104.</p></div></td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m ' href="DescendantsTracker.html#subclasses-class_method" title="ActiveSupport::DescendantsTracker.subclasses (method)">subclasses</a></td>
      <td><div class='inline'><p>See additional method definition at line 100.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#attributes-instance_method" title="#attributes (instance method)">#<strong>attributes</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#reset-instance_method" title="#reset (instance method)">#<strong>reset</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Reset all attributes.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#set-instance_method" title="#set (instance method)">#<strong>set</strong>(set_attributes)  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Expose one or more attributes within a block.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="Callbacks.html" title="ActiveSupport::Callbacks (module)"><code>Callbacks</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr class='i_ds'>
      <td><a class='i_m ' href="Callbacks.html#run_callbacks-instance_method" title="ActiveSupport::Callbacks#run_callbacks (method)">#run_callbacks</a></td>
      <td><div class='inline'><p>Runs the callbacks for the given event.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>  &#x21d2; <code>CurrentAttributes</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L197-L199'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='197' data-end='199'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 197</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@attributes</span> <span class='op'>=</span> {}
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="__callbacks-class_method">
  <h3 class='signature rw first'>
    .<strong>__callbacks</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/callbacks.rb#L70-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/callbacks.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid___callbacks'>__callbacks</span><span class='comma'>,</span> <span class='label'>instance_writer:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>default:</span> {}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__callbacks?-class_method">
  <h3 class='signature rw'>
    .<strong>__callbacks?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/callbacks.rb#L70-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/callbacks.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid___callbacks'><a href="#__callbacks-class_method" title="ActiveSupport::CurrentAttributes.__callbacks (method)">__callbacks</a></span><span class='comma'>,</span> <span class='label'>instance_writer:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>default:</span> {}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="after_reset-class_method">
  <h3 class='signature  first'>
    .<strong>after_reset</strong>(*methods, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#resets-class_method" title="ActiveSupport::CurrentAttributes.resets (method)">.resets</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L154-L154'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='154' data-end='154'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 154</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_alias_method'>alias_method</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after_reset'>after_reset</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_resets'><a href="#resets-class_method" title="ActiveSupport::CurrentAttributes.resets (method)">resets</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="attribute-class_method">
  <h3 class='signature '>
    .<strong>attribute</strong>(*names)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Declares one or more attributes that will be given both class and instance accessor methods.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L104-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='104' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 104</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_attribute'>attribute</span>(<span class='op'>*</span><span class='id identifier rubyid_names'>names</span>)
  <span class='id identifier rubyid_invalid_attribute_names'>invalid_attribute_names</span> <span class='op'>=</span> <span class='id identifier rubyid_names'>names</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_to_sym'>to_sym</span>) <span class='op'>&amp;</span> <span class='const'><a href="#INVALID_ATTRIBUTE_NAMES-constant" title="ActiveSupport::CurrentAttributes::INVALID_ATTRIBUTE_NAMES (constant)">INVALID_ATTRIBUTE_NAMES</a></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_invalid_attribute_names'>invalid_attribute_names</span>.<span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Restricted attribute names: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_invalid_attribute_names'>invalid_attribute_names</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="CodeGenerator.html" title="ActiveSupport::CodeGenerator (class)">CodeGenerator</a></span>.<span class='id identifier rubyid_batch'><a href="CodeGenerator.html#batch-class_method" title="ActiveSupport::CodeGenerator.batch (method)">batch</a></span>(<span class='id identifier rubyid_generated_attribute_methods'>generated_attribute_methods</span><span class='comma'>,</span> <span class='kw'>__FILE__</span><span class='comma'>,</span> <span class='kw'>__LINE__</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_owner'>owner</span><span class='op'>|</span>
    <span class='id identifier rubyid_names'>names</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
      <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_define_cached_method'>define_cached_method</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current_attributes'>current_attributes</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch'>batch</span><span class='op'>|</span>
        <span class='id identifier rubyid_batch'>batch</span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attributes[:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>end</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_define_cached_method'>define_cached_method</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current_attributes'>current_attributes</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch'>batch</span><span class='op'>|</span>
        <span class='id identifier rubyid_batch'>batch</span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=(value)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attributes[:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>] = value</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>end</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='const'><a href="../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span><span class='op'>::</span><span class='const'><a href="CodeGenerator.html" title="ActiveSupport::CodeGenerator (class)">CodeGenerator</a></span>.<span class='id identifier rubyid_batch'><a href="CodeGenerator.html#batch-class_method" title="ActiveSupport::CodeGenerator.batch (method)">batch</a></span>(<span class='id identifier rubyid_singleton_class'>singleton_class</span><span class='comma'>,</span> <span class='kw'>__FILE__</span><span class='comma'>,</span> <span class='kw'>__LINE__</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_owner'>owner</span><span class='op'>|</span>
    <span class='id identifier rubyid_names'>names</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
      <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_define_cached_method'>define_cached_method</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current_attributes_delegation'>current_attributes_delegation</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch'>batch</span><span class='op'>|</span>
        <span class='id identifier rubyid_batch'>batch</span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>instance.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>end</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_owner'>owner</span>.<span class='id identifier rubyid_define_cached_method'>define_cached_method</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>namespace:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current_attributes_delegation'>current_attributes_delegation</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_batch'>batch</span><span class='op'>|</span>
        <span class='id identifier rubyid_batch'>batch</span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>def </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'>=(value)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>instance.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> = value</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>end</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="before_reset-class_method">
  <h3 class='signature '>
    .<strong>before_reset</strong>(*methods, &amp;block)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Calls this callback before <a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">#reset</a> is called on the instance. Used for resetting external collaborators that depend on current values.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L146-L148'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='146' data-end='148'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 146</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_before_reset'>before_reset</span>(<span class='op'>*</span><span class='id identifier rubyid_methods'>methods</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_set_callback'>set_callback</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">reset</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_before'>before</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_methods'>methods</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="instance-class_method">
  <h3 class='signature '>
    .<strong>instance</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns singleton instance for this class in this thread. If none exists, one is created.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L99-L101'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='99' data-end='101'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 99</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_instance'>instance</span>
  <span class='id identifier rubyid_current_instances'>current_instances</span>[<span class='id identifier rubyid_current_instances_key'>current_instances_key</span>] <span class='op'>||=</span> <span class='id identifier rubyid_new'><a href="#new-class_method" title="ActiveSupport::CurrentAttributes.new (method)">new</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="resets-class_method">
  <h3 class='signature '>
    .<strong>resets</strong>(*methods, &amp;block)  
    <span class='aliases'>Also known as: <span class='names'>.after_reset</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Calls this callback after <a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">#reset</a> is called on the instance. Used for resetting external collaborators, like <a href="../Time.html#zone-class_method" title="Time.zone (method)">Time.zone</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L151-L153'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='151' data-end='153'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 151</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_resets'>resets</span>(<span class='op'>*</span><span class='id identifier rubyid_methods'>methods</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_set_callback'>set_callback</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">reset</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_after'>after</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_methods'>methods</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="__callbacks-instance_method">
  <h3 class='signature ro first'>
    #<strong>__callbacks</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/callbacks.rb#L70-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/callbacks.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid___callbacks'>__callbacks</span><span class='comma'>,</span> <span class='label'>instance_writer:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>default:</span> {}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="__callbacks?-instance_method">
  <h3 class='signature ro'>
    #<strong>__callbacks?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/callbacks.rb#L70-L70'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='70'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/callbacks.rb', line 70</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_class_attribute'>class_attribute</span> <span class='symbeg'>:</span><span class='id identifier rubyid___callbacks'><a href="#__callbacks-class_method" title="ActiveSupport::CurrentAttributes.__callbacks (method)">__callbacks</a></span><span class='comma'>,</span> <span class='label'>instance_writer:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>default:</span> {}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="attributes-instance_method">
  <h3 class='signature rw'>
    #<strong>attributes</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L195-L195'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='195' data-end='195'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 195</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_attributes'>attributes</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reset-instance_method">
  <h3 class='signature ro'>
    #<strong>reset</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Reset all attributes. Should be called before and after actions, when used as a per-request singleton.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L220-L220'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='220' data-end='220'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 220</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_delegate'>delegate</span> <span class='symbeg'>:</span><span class='id identifier rubyid_set'><a href="#set-instance_method" title="ActiveSupport::CurrentAttributes#set (method)">set</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reset'>reset</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_instance'><a href="#instance-class_method" title="ActiveSupport::CurrentAttributes.instance (method)">instance</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="set-instance_method">
  <h3 class='signature ro'>
    #<strong>set</strong>(set_attributes)   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Expose one or more attributes within a block. Old values are returned after the block concludes. Example demonstrating the common use of needing to set Current attributes outside the request-cycle:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>Chat</span><span class='op'>::</span><span class='const'>PublicationJob</span> <span class='op'>&lt;</span> <span class='const'>ApplicationJob</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_perform'>perform</span>(<span class='id identifier rubyid_attributes'><a href="#attributes-instance_method" title="ActiveSupport::CurrentAttributes#attributes (method)">attributes</a></span><span class='comma'>,</span> <span class='id identifier rubyid_room_number'>room_number</span><span class='comma'>,</span> <span class='id identifier rubyid_creator'>creator</span>)
    <span class='const'>Current</span>.<span class='id identifier rubyid_set'>set</span>(<span class='label'>person:</span> <span class='id identifier rubyid_creator'>creator</span>) <span class='kw'>do</span>
      <span class='const'>Chat</span><span class='op'>::</span><span class='const'>Publisher</span>.<span class='id identifier rubyid_publish'>publish</span>(<span class='label'>attributes:</span> <span class='id identifier rubyid_attributes'><a href="#attributes-instance_method" title="ActiveSupport::CurrentAttributes#attributes (method)">attributes</a></span><span class='comma'>,</span> <span class='label'>room_number:</span> <span class='id identifier rubyid_room_number'>room_number</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/activesupport/lib/active_support/current_attributes.rb#L211-L211'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='211' data-end='211'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'activesupport/lib/active_support/current_attributes.rb', line 211</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_delegate'>delegate</span> <span class='symbeg'>:</span><span class='id identifier rubyid_set'>set</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_reset'><a href="#reset-instance_method" title="ActiveSupport::CurrentAttributes#reset (method)">reset</a></span><span class='comma'>,</span> <span class='label'>to:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_instance'><a href="#instance-class_method" title="ActiveSupport::CurrentAttributes.instance (method)">instance</a></span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>