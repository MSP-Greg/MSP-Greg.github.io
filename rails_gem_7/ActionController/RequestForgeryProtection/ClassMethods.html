<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: ActionController::RequestForgeryProtection::ClassMethods &mdash; Rails 7.1.3.2</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "ActionController::RequestForgeryProtection::ClassMethods",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rails 7.1.3.2</a> &raquo; 
      <a href='../../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../../ActionController.html" title="ActionController (module)">ActionController</a> &raquo; 
        <a href="../RequestForgeryProtection.html" title="ActionController::RequestForgeryProtection (module)">RequestForgeryProtection</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>ClassMethods&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: ActionController::RequestForgeryProtection::ClassMethods</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L105'>actionpack/lib/action_controller/metal/request_forgery_protection.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#protect_from_forgery-instance_method" title="#protect_from_forgery (instance method)">#<strong>protect_from_forgery</strong>(options = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Turn on request forgery protection.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#skip_forgery_protection-instance_method" title="#skip_forgery_protection (instance method)">#<strong>skip_forgery_protection</strong>(options = {})  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Turn off request forgery protection.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="protect_from_forgery-instance_method">
  <h3 class='signature  first'>
    #<strong>protect_from_forgery</strong>(options = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Turn on request forgery protection. Bear in mind that GET and HEAD requests are not checked.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>FooController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>except:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>
<span class='kw'>end</span></code></pre>

<p>You can disable forgery protection on a controller using skip_forgery_protection:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>BarController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
  <span class='id identifier rubyid_skip_forgery_protection'><a href="#skip_forgery_protection-instance_method" title="ActionController::RequestForgeryProtection::ClassMethods#skip_forgery_protection (method)">skip_forgery_protection</a></span>
<span class='kw'>end</span></code></pre>

<p>Valid Options:</p>
<ul><li>
<p><code>:only</code> / <code>:except</code> - Only apply forgery protection to a subset of actions. For example <code>only: [ :create, :create_all ]</code>.</p>
</li><li>
<p><code>:if</code> / <code>:unless</code> - Turn off the forgery protection entirely depending on the passed Proc or method reference.</p>
</li><li>
<p><code>:prepend</code> - By default, the verification of the authentication token will be added at the position of the protect_from_forgery call in your application. This means any callbacks added before are run first. This is useful when you want your forgery protection to depend on other callbacks, like authentication methods (Oauth vs Cookie auth).</p>

<p>If you need to add verification to the beginning of the callback chain, use <code>prepend: true</code>.</p>
</li><li>
<p><code>:with</code> - Set the method to handle unverified request. Note if <code>default_protect_from_forgery</code> is true, Rails call protect_from_forgery with <code>with :exception</code>.</p>
</li></ul>

<p>Built-in unverified request handling methods are:</p>
<ul><li>
<p><code>:exception</code> - Raises <a href="../InvalidAuthenticityToken.html" title="ActionController::InvalidAuthenticityToken (class)"><code>::ActionController::InvalidAuthenticityToken</code></a> exception.</p>
</li><li>
<p><code>:reset_session</code> - Resets the session.</p>
</li><li>
<p><code>:null_session</code> - Provides an empty session during request but doesn’t reset it completely. Used as default if <code>:with</code> option is not specified.</p>
</li></ul>

<p>You can also implement custom strategy classes for unverified request handling:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CustomStrategy</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'><a href="../RequestForgeryProtection.html#initialize-instance_method" title="ActionController::RequestForgeryProtection#initialize (method)">initialize</a></span>(<span class='id identifier rubyid_controller'>controller</span>)
    <span class='ivar'>@controller</span> <span class='op'>=</span> <span class='id identifier rubyid_controller'>controller</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_handle_unverified_request'><a href="../RequestForgeryProtection.html#handle_unverified_request-instance_method" title="ActionController::RequestForgeryProtection#handle_unverified_request (method)">handle_unverified_request</a></span>
    <span class='comment'># Custom behavior for unverfied request
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>with:</span> <span class='const'>CustomStrategy</span>
<span class='kw'>end</span></code></pre>
<ul><li>
<p><code>:store</code> - Set the strategy to store and retrieve CSRF tokens.</p>
</li></ul>

<p>Built-in session token strategies are:</p>
<ul><li>
<p><code>:session</code> - Store the CSRF token in the session.  Used as default if <code>:store</code> option is not specified.</p>
</li><li>
<p><code>:cookie</code> - Store the CSRF token in an encrypted cookie.</p>
</li></ul>

<p>You can also implement custom strategy classes for CSRF token storage:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>CustomStore</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_fetch'>fetch</span>(<span class='id identifier rubyid_request'>request</span>)
    <span class='comment'># Return the token from a custom location
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_store'>store</span>(<span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_csrf_token'>csrf_token</span>)
    <span class='comment'># Store the token in a custom location
</span>  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reset'>reset</span>(<span class='id identifier rubyid_request'>request</span>)
    <span class='comment'># Delete the stored session token
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='kw'>class</span> <span class='const'>ApplicationController</span> <span class='op'>&lt;</span> <span class='const'><a href="../../ActionController.html" title="ActionController (module)">ActionController</a></span><span class='op'>::</span><span class='const'><a href="../Base.html" title="ActionController::Base (class)">Base</a></span>
  <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span> <span class='label'>store:</span> <span class='const'>CustomStore</span>.<span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L179-L189'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='179' data-end='189'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 179</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_protect_from_forgery'>protect_from_forgery</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_reverse_merge'>reverse_merge</span>(<span class='label'>prepend:</span> <span class='kw'>false</span>)

  <span class='kw'>self</span>.<span class='id identifier rubyid_forgery_protection_strategy'>forgery_protection_strategy</span> <span class='op'>=</span> <span class='id identifier rubyid_protection_method_class'>protection_method_class</span>(<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_with'>with</span>] <span class='op'>||</span> <span class='symbeg'>:</span><span class='id identifier rubyid_null_session'>null_session</span>)
  <span class='kw'>self</span>.<span class='id identifier rubyid_request_forgery_protection_token'>request_forgery_protection_token</span> <span class='op'>||=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_authenticity_token'>authenticity_token</span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_csrf_token_storage_strategy'>csrf_token_storage_strategy</span> <span class='op'>=</span> <span class='id identifier rubyid_storage_strategy'>storage_strategy</span>(<span class='id identifier rubyid_options'>options</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_store'>store</span>] <span class='op'>||</span> <span class='const'><a href="SessionStore.html" title="ActionController::RequestForgeryProtection::SessionStore (class)">SessionStore</a></span>.<span class='id identifier rubyid_new'><a href="../RequestForgeryProtection.html#initialize-instance_method" title="ActionController::RequestForgeryProtection#initialize (method)">new</a></span>)

  <span class='id identifier rubyid_before_action'>before_action</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verify_authenticity_token'><a href="../RequestForgeryProtection.html#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">verify_authenticity_token</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>
  <span class='id identifier rubyid_append_after_action'>append_after_action</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verify_same_origin_request'><a href="../RequestForgeryProtection.html#verify_same_origin_request-instance_method" title="ActionController::RequestForgeryProtection#verify_same_origin_request (method)">verify_same_origin_request</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="skip_forgery_protection-instance_method">
  <h3 class='signature '>
    #<strong>skip_forgery_protection</strong>(options = {})  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Turn off request forgery protection. This is a wrapper for:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_skip_before_action'>skip_before_action</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verify_authenticity_token'><a href="../RequestForgeryProtection.html#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">verify_authenticity_token</a></span></code></pre>

<p>See <code>skip_before_action</code> for allowed options.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rails/rails/blob/v7.1.3.2/actionpack/lib/action_controller/metal/request_forgery_protection.rb#L196-L198'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='196' data-end='198'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'actionpack/lib/action_controller/metal/request_forgery_protection.rb', line 196</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_skip_forgery_protection'>skip_forgery_protection</span>(<span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> {})
  <span class='id identifier rubyid_skip_before_action'>skip_before_action</span> <span class='symbeg'>:</span><span class='id identifier rubyid_verify_authenticity_token'><a href="../RequestForgeryProtection.html#verify_authenticity_token-instance_method" title="ActionController::RequestForgeryProtection#verify_authenticity_token (method)">verify_authenticity_token</a></span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>.<span class='id identifier rubyid_reverse_merge'>reverse_merge</span>(<span class='label'>raise:</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>