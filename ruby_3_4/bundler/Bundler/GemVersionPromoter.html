<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Bundler::GemVersionPromoter &mdash; bundler  Ruby-3.4.7 p58</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Bundler::GemVersionPromoter",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.4.7</a> &raquo; 
      <a href='../'>bundler</a> &raquo; 
      <a href='../_index.html#alpha_G'>Index (G)</a> &raquo; 
        <a href="../Bundler.html" title="Bundler (module)">Bundler</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>GemVersionPromoter&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Bundler::GemVersionPromoter</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L9'>lib/bundler/gem_version_promoter.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>This class contains all of the logic for determining the next version of a <a href="../Gem.html" title="Gem (module)"><code>::Gem</code></a> to update to based on the requested level (patch, minor, major). Primarily designed to work with <a href="Resolver.html" title="Bundler::Resolver (class)"><code>Resolver</code></a> which will provide it the list of available dependency versions as found in its index, before returning it to to the resolution engine to select the best version.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>  &#x21d2; GemVersionPromoter </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a <code>GemVersionPromoter</code> instance.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#level-instance_method" title="#level (instance method)">#<strong>level</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#level=-instance_method" title="#level= (instance method)">#<strong>level=</strong>(value)  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#major%3F-instance_method" title="#major? (instance method)">#<strong>major?</strong>  &#x21d2; bool </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#minor%3F-instance_method" title="#minor? (instance method)">#<strong>minor?</strong>  &#x21d2; bool </a>
    </span>
    <span class='note title readonly'>readonly</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#pre-instance_method" title="#pre (instance method)">#<strong>pre</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#pre%3F-instance_method" title="#pre? (instance method)">#<strong>pre?</strong>  &#x21d2; bool </a>
    </span>
    <span class='note title rw'>rw</span>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#strict-instance_method" title="#strict (instance method)">#<strong>strict</strong>  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>By default, strict is false, meaning every available version of a gem is returned from sort_versions.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#filter_versions-instance_method" title="#filter_versions (instance method)">#<strong>filter_versions</strong>(package, specs)  &#x21d2; Specification </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Given a <a href="Resolver/Package.html" title="Bundler::Resolver::Package (class)"><code>Resolver::Package</code></a> and an Array of Specifications of available versions for a gem, this method will truncate the Array if strict is true.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sort_versions-instance_method" title="#sort_versions (instance method)">#<strong>sort_versions</strong>(package, specs)  &#x21d2; Specification </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Given a <a href="Resolver/Package.html" title="Bundler::Resolver::Package (class)"><code>Resolver::Package</code></a> and an Array of Specifications of available versions for a gem, this method will return the Array of Specifications sorted in an order to give preference to the current level (:major, <code>:minor</code> or <code>:patch</code>) when resolution is deciding what versions best resolve all dependencies in the bundle.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#either_version_older_than_locked%3F-instance_method" title="#either_version_older_than_locked? (instance method)">#<strong>either_version_older_than_locked?</strong>(a, b, locked_version)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#move_version_to_beginning-instance_method" title="#move_version_to_beginning (instance method)">#<strong>move_version_to_beginning</strong>(result, version)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#post_sort-instance_method" title="#post_sort (instance method)">#<strong>post_sort</strong>(result, unlock, locked_version)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Specific version moves canâ€™t always reliably be done during sorting as not all elements are compared against each other.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#segments_do_not_match%3F-instance_method" title="#segments_do_not_match? (instance method)">#<strong>segments_do_not_match?</strong>(a, b, level)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>  &#x21d2; <code>GemVersionPromoter</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a <code>GemVersionPromoter</code> instance.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L29-L33'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='29' data-end='33'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 29</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@level</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_major'>major</span>
  <span class='ivar'>@strict</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@pre</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="level-instance_method">
  <h3 class='signature rw first'>
    #<strong>level</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L10-L10'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='10' data-end='10'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 10</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbeg'>:</span><span class='id identifier rubyid_level'>level</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="level=-instance_method">
  <h3 class='signature rw'>
    #<strong>level=</strong>(value)   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>value</span>
    <span class='type'>(<code>Symbol</code>)</span>
&mdash;    <div class='inline'>
<p>One of three Symbols: <code>:major</code>, <code>:minor</code> or <code>:patch</code>.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>ArgumentError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L36-L44'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='36' data-end='44'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 36</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_level='>level=</span>(<span class='id identifier rubyid_value'>value</span>)
  <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
        <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unexpected level </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Must be :major, :minor or :patch</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_major'>major</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_minor'>minor</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_patch'>patch</span>].<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_v'>v</span>)
  <span class='ivar'>@level</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="major?-instance_method">
  <h3 class='signature ro'>
    #<strong>major?</strong>  &#x21d2; <code>bool</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>bool</code>)</span>
&mdash;    <div class='inline'>
<p>Convenience method for testing value of level variable.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L82-L84'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='82' data-end='84'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 82</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_major?'>major?</span>
  <span class='id identifier rubyid_level'><a href="#level-instance_method" title="Bundler::GemVersionPromoter#level (method)">level</a></span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_major'>major</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="minor?-instance_method">
  <h3 class='signature ro'>
    #<strong>minor?</strong>  &#x21d2; <code>bool</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>bool</code>)</span>
&mdash;    <div class='inline'>
<p>Convenience method for testing value of level variable.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L87-L89'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='87' data-end='89'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 87</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_minor?'>minor?</span>
  <span class='id identifier rubyid_level'><a href="#level-instance_method" title="Bundler::GemVersionPromoter#level (method)">level</a></span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_minor'>minor</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pre-instance_method">
  <h3 class='signature rw'>
    #<strong>pre</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L11-L11'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='11' data-end='11'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pre'>pre</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pre?-instance_method">
  <h3 class='signature rw'>
    #<strong>pre?</strong>  &#x21d2; <code>bool</code>  <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>bool</code>)</span>
&mdash;    <div class='inline'>
<p>Convenience method for testing value of pre variable.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L92-L94'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='92' data-end='94'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 92</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pre?'>pre?</span>
  <span class='id identifier rubyid_pre'><a href="#pre-instance_method" title="Bundler::GemVersionPromoter#pre (method)">pre</a></span> <span class='op'>==</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="strict-instance_method">
  <h3 class='signature rw'>
    #<strong>strict</strong>   <span class="extras">(<span class='rw'>rw</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>By default, strict is false, meaning every available version of a gem is returned from sort_versions. The order gives preference to the requested level (:patch, <code>:minor</code>, <code>:major</code>) but in complicated requirement cases some gems will by necessity be promoted past the requested level, or even reverted to older versions.</p>

<p>If strict is set to true, the results from sort_versions will be truncated, eliminating any version outside the current level scope. This can lead to unexpected outcomes or even VersionConflict exceptions that report a version of a gem not existing for versions that indeed do existing in the referenced source.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L24-L24'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='24' data-end='24'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 24</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_strict'>strict</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="either_version_older_than_locked?-instance_method">
  <h3 class='signature priv first'>
    #<strong>either_version_older_than_locked?</strong>(a, b, locked_version)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L123-L125'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='123' data-end='125'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 123</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_either_version_older_than_locked?'>either_version_older_than_locked?</span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_version'>locked_version</span>)
  <span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_version'>version</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_locked_version'>locked_version</span> <span class='op'>||</span> <span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_version'>version</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_locked_version'>locked_version</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="filter_versions-instance_method">
  <h3 class='signature '>
    #<strong>filter_versions</strong>(package, specs)  &#x21d2; <code>Specification</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given a <a href="Resolver/Package.html" title="Bundler::Resolver::Package (class)"><code>Resolver::Package</code></a> and an Array of Specifications of available versions for a gem, this method will truncate the Array if strict is true. That means filtering out downgrades from the version currently locked, and filtering out upgrades that go past the selected level (major, minor, or patch).</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>package</span>
    <span class='type'>(<a href="Resolver/Package.html" title="Bundler::Resolver::Package (class)">Resolver::Package</a>)</span>
&mdash;    <div class='inline'>
<p>The package being resolved.</p>
</div>
  </li>
  <li>
    <span class='name'>specs</span>
    <span class='type'>(<code>Specification</code>)</span>
&mdash;    <div class='inline'>
<p>An array of Specifications for the package.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Specification</code>)</span>
&mdash;    <div class='inline'>
<p>A new instance of the Specification Array truncated.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L105-L119'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='105' data-end='119'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 105</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_filter_versions'>filter_versions</span>(<span class='id identifier rubyid_package'>package</span><span class='comma'>,</span> <span class='id identifier rubyid_specs'>specs</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_specs'>specs</span> <span class='kw'>unless</span> <span class='id identifier rubyid_strict'><a href="#strict-instance_method" title="Bundler::GemVersionPromoter#strict (method)">strict</a></span>

  <span class='id identifier rubyid_locked_version'>locked_version</span> <span class='op'>=</span> <span class='id identifier rubyid_package'>package</span>.<span class='id identifier rubyid_locked_version'>locked_version</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_specs'>specs</span> <span class='kw'>if</span> <span class='id identifier rubyid_locked_version'>locked_version</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_major?'><a href="#major%3F-instance_method" title="Bundler::GemVersionPromoter#major? (method)">major?</a></span>

  <span class='id identifier rubyid_specs'>specs</span>.<span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_spec'>spec</span><span class='op'>|</span>
    <span class='id identifier rubyid_gsv'>gsv</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span>.<span class='id identifier rubyid_version'>version</span>

    <span class='id identifier rubyid_must_match'>must_match</span> <span class='op'>=</span> <span class='id identifier rubyid_minor?'><a href="#minor%3F-instance_method" title="Bundler::GemVersionPromoter#minor? (method)">minor?</a></span> <span class='op'>?</span> [<span class='int'>0</span>] <span class='op'>:</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span>]

    <span class='id identifier rubyid_all_match'>all_match</span> <span class='op'>=</span> <span class='id identifier rubyid_must_match'>must_match</span>.<span class='id identifier rubyid_all?'>all?</span> {<span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span> <span class='id identifier rubyid_gsv'>gsv</span>.<span class='id identifier rubyid_segments'>segments</span>[<span class='id identifier rubyid_idx'>idx</span>] <span class='op'>==</span> <span class='id identifier rubyid_locked_version'>locked_version</span>.<span class='id identifier rubyid_segments'>segments</span>[<span class='id identifier rubyid_idx'>idx</span>] }
    <span class='id identifier rubyid_all_match'>all_match</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_gsv'>gsv</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_locked_version'>locked_version</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="move_version_to_beginning-instance_method">
  <h3 class='signature priv'>
    #<strong>move_version_to_beginning</strong>(result, version)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L142-L145'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='142' data-end='145'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 142</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_move_version_to_beginning'>move_version_to_beginning</span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span>)
  <span class='id identifier rubyid_move'>move</span><span class='comma'>,</span> <span class='id identifier rubyid_keep'>keep</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>.<span class='id identifier rubyid_partition'>partition</span> {<span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span>.<span class='id identifier rubyid_version'>version</span>.<span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_version'>version</span>.<span class='id identifier rubyid_to_s'>to_s</span> }
  <span class='id identifier rubyid_move'>move</span>.<span class='id identifier rubyid_concat'>concat</span>(<span class='id identifier rubyid_keep'>keep</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="post_sort-instance_method">
  <h3 class='signature priv'>
    #<strong>post_sort</strong>(result, unlock, locked_version)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Specific version moves canâ€™t always reliably be done during sorting as not all elements are compared against each other.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L134-L140'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='134' data-end='140'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 134</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_post_sort'>post_sort</span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_unlock'>unlock</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_version'>locked_version</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_unlock'>unlock</span> <span class='op'>||</span> <span class='id identifier rubyid_locked_version'>locked_version</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_move_version_to_beginning'><a href="#move_version_to_beginning-instance_method" title="Bundler::GemVersionPromoter#move_version_to_beginning (method)">move_version_to_beginning</a></span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_version'>locked_version</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="segments_do_not_match?-instance_method">
  <h3 class='signature priv'>
    #<strong>segments_do_not_match?</strong>(a, b, level)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L127-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='127' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 127</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_segments_do_not_match?'>segments_do_not_match?</span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_level'><a href="#level-instance_method" title="Bundler::GemVersionPromoter#level (method)">level</a></span>)
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_major'>major</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_minor'>minor</span>].<span class='id identifier rubyid_index'>index</span>(<span class='id identifier rubyid_level'><a href="#level-instance_method" title="Bundler::GemVersionPromoter#level (method)">level</a></span>)
  <span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_segments'>segments</span>[<span class='id identifier rubyid_index'>index</span>] <span class='op'>!=</span> <span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_segments'>segments</span>[<span class='id identifier rubyid_index'>index</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sort_versions-instance_method">
  <h3 class='signature '>
    #<strong>sort_versions</strong>(package, specs)  &#x21d2; <code>Specification</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Given a <a href="Resolver/Package.html" title="Bundler::Resolver::Package (class)"><code>Resolver::Package</code></a> and an Array of Specifications of available versions for a gem, this method will return the Array of Specifications sorted in an order to give preference to the current level (:major, <code>:minor</code> or <code>:patch</code>) when resolution is deciding what versions best resolve all dependencies in the bundle.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>package</span>
    <span class='type'>(<a href="Resolver/Package.html" title="Bundler::Resolver::Package (class)">Resolver::Package</a>)</span>
&mdash;    <div class='inline'>
<p>The package being resolved.</p>
</div>
  </li>
  <li>
    <span class='name'>specs</span>
    <span class='type'>(<code>Specification</code>)</span>
&mdash;    <div class='inline'>
<p>An array of Specifications for the package.</p>
</div>
  </li>
</ul>
<p class='tag_title'>Returns:</p>
<ul class='return'>
  <li>
    <span class='type'>(<code>Specification</code>)</span>
&mdash;    <div class='inline'>
<p>A new instance of the Specification Array sorted.</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_7/lib/bundler/gem_version_promoter.rb#L54-L79'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='54' data-end='79'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/bundler/gem_version_promoter.rb', line 54</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_sort_versions'>sort_versions</span>(<span class='id identifier rubyid_package'>package</span><span class='comma'>,</span> <span class='id identifier rubyid_specs'>specs</span>)
  <span class='id identifier rubyid_locked_version'>locked_version</span> <span class='op'>=</span> <span class='id identifier rubyid_package'>package</span>.<span class='id identifier rubyid_locked_version'>locked_version</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_specs'>specs</span>.<span class='id identifier rubyid_sort'>sort</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_package'>package</span>.<span class='id identifier rubyid_prerelease_specified?'>prerelease_specified?</span> <span class='op'>||</span> <span class='id identifier rubyid_pre?'><a href="#pre%3F-instance_method" title="Bundler::GemVersionPromoter#pre? (method)">pre?</a></span>
      <span class='id identifier rubyid_a_pre'>a_pre</span> <span class='op'>=</span> <span class='id identifier rubyid_a'>a</span>.<span class='id identifier rubyid_prerelease?'>prerelease?</span>
      <span class='id identifier rubyid_b_pre'>b_pre</span> <span class='op'>=</span> <span class='id identifier rubyid_b'>b</span>.<span class='id identifier rubyid_prerelease?'>prerelease?</span>

      <span class='kw'>next</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_a_pre'>a_pre</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_b_pre'>b_pre</span>
      <span class='kw'>next</span> <span class='op'>-</span><span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_b_pre'>b_pre</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_a_pre'>a_pre</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_major?'><a href="#major%3F-instance_method" title="Bundler::GemVersionPromoter#major? (method)">major?</a></span> <span class='op'>||</span> <span class='id identifier rubyid_locked_version'>locked_version</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_a'>a</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_either_version_older_than_locked?'><a href="#either_version_older_than_locked%3F-instance_method" title="Bundler::GemVersionPromoter#either_version_older_than_locked? (method)">either_version_older_than_locked?</a></span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_version'>locked_version</span>)
      <span class='id identifier rubyid_b'>b</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_a'>a</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_segments_do_not_match?'><a href="#segments_do_not_match%3F-instance_method" title="Bundler::GemVersionPromoter#segments_do_not_match? (method)">segments_do_not_match?</a></span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_major'>major</span>)
      <span class='id identifier rubyid_a'>a</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span>
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_minor?'><a href="#minor%3F-instance_method" title="Bundler::GemVersionPromoter#minor? (method)">minor?</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_segments_do_not_match?'><a href="#segments_do_not_match%3F-instance_method" title="Bundler::GemVersionPromoter#segments_do_not_match? (method)">segments_do_not_match?</a></span>(<span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_minor'>minor</span>)
      <span class='id identifier rubyid_a'>a</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_b'>b</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_a'>a</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_post_sort'><a href="#post_sort-instance_method" title="Bundler::GemVersionPromoter#post_sort (method)">post_sort</a></span>(<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_package'>package</span>.<span class='id identifier rubyid_unlock?'>unlock?</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_version'>locked_version</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>