<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Ractor &mdash; Core  Ruby-3.4.8 p72</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Ractor",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.4.8</a> &raquo; 
      <a href='.'>Core</a> &raquo; 
      <a href='_index.html#alpha_R'>Index (R)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Ractor&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Ractor</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="Ractor/MovedObject.html" title="Ractor::MovedObject (class)"><code>MovedObject</code></a>,
        <a href="Ractor/Port.html" title="Ractor::Port (class)"><code>Port</code></a>,
        <a class='nodoc' href="Ractor/Selector.html" title="Ractor::Selector (class)"><code>Selector</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Exceptions:</div>
      <div class='box_11'>
          <a href="Ractor/ClosedError.html" title="Ractor::ClosedError (class)"><code>ClosedError</code></a>,
        <a href="Ractor/Error.html" title="Ractor::Error (class)"><code>Error</code></a>,
        <a href="Ractor/IsolationError.html" title="Ractor::IsolationError (class)"><code>IsolationError</code></a>,
        <a href="Ractor/MovedError.html" title="Ractor::MovedError (class)"><code>MovedError</code></a>,
        <a href="Ractor/RemoteError.html" title="Ractor::RemoteError (class)"><code>RemoteError</code></a>,
        <a href="Ractor/UnsafeError.html" title="Ractor::UnsafeError (class)"><code>UnsafeError</code></a>      </div>
    </td></tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L195'>ractor.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.c#L1040'>ractor.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="#new-class_method" title="Ractor.new (method)">.new</a> creates a new Ractor, which can run in parallel with other ractors.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># The simplest ractor
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor!</span><span class='tstring_end'>&quot;</span></span>}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span> <span class='comment'># wait for it to finish
</span><span class='comment'># Here, &quot;I am in Ractor!&quot; is printed</span></code></pre>

<p>Ractors do not share all objects with each other. There are two main benefits to this: across ractors, thread-safety concerns such as data-races and race-conditions are not possible. The other benefit is parallelism.</p>

<p>To achieve this, object sharing is limited across ractors. Unlike in threads, ractors can’t access all the objects available in other ractors. For example, objects normally available through variables in the outer scope are prohibited from being used across ractors.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor! a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a'>a</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}
<span class='comment'># fails immediately with
</span><span class='comment'># ArgumentError (can not isolate a Proc because it accesses outer variables (a).)</span></code></pre>

<p>The object must be explicitly shared:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='id identifier rubyid_a'>a</span>) { <span class='op'>|</span><span class='id identifier rubyid_a1'>a1</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor! a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a1'>a1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}</code></pre>

<p>On CRuby (the default implementation), the Global Virtual Machine Lock (GVL) is held per ractor, so ractors can run in parallel. This is unlike the situation with threads on CRuby.</p>

<p>Instead of accessing shared state, objects should be passed to and from ractors by sending and receiving them as messages.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_a_in_ractor'>a_in_ractor</span> <span class='op'>=</span> <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span> <span class='comment'># receive blocks the Thread until our default port gets sent a message
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I am in Ractor! a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a_in_ractor'>a_in_ractor</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='id identifier rubyid_a'>a</span>)  <span class='comment'># pass it
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># Here, &quot;I am in Ractor! a=1&quot; is printed</span></code></pre>

<p>In addition to that, any arguments passed to <a href="#new-class_method" title="Ractor.new (method)">.new</a> are passed to the block and available there as if received by <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>, and the last block value can be received with <a href="#value-instance_method" title="Ractor#value (method)">#value</a>.</p>

<h3 id="label-Shareable+and+unshareable+objects">Shareable and unshareable objects</h3>

<p>When an object is sent to a ractor, it’s important to understand whether the object is shareable or unshareable. Most Ruby objects are unshareable objects. Even frozen objects can be unshareable if they contain (through their instance variables) unfrozen objects.</p>

<p>Shareable objects are those which can be used by several ractors at once without compromising thread-safety, for example numbers, <code>true</code> and <code>false</code>. <a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">.shareable?</a> allows you to check this, and <a href="#make_shareable-class_method" title="Ractor.make_shareable (method)">.make_shareable</a> tries to make the object shareable if it’s not already and gives an error if it can’t do it.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='int'>1</span>)            <span class='comment'>#=&gt; true -- numbers and other immutable basic values are shareable
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>)        <span class='comment'>#=&gt; false, unless the string is frozen due to # frozen_string_literal: true
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>) <span class='comment'>#=&gt; true
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>([<span class='const'><a href="Object.html" title="Object (class)">Object</a></span>.<span class='id identifier rubyid_new'><a href="BasicObject.html#new-class_method" title="BasicObject.new (method)">new</a></span>].<span class='id identifier rubyid_freeze'>freeze</span>) <span class='comment'>#=&gt; false, inner object is unfrozen
</span>
<span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>world</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                 <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_ary'>ary</span>[<span class='int'>0</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>              <span class='comment'>#=&gt; false
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'><a href="#make_shareable-class_method" title="Ractor.make_shareable (method)">make_shareable</a></span>(<span class='id identifier rubyid_ary'>ary</span>)
<span class='id identifier rubyid_ary'>ary</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                 <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_ary'>ary</span>[<span class='int'>0</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>              <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_ary'>ary</span>[<span class='int'>1</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>              <span class='comment'>#=&gt; true</span></code></pre>

<p>When a shareable object is sent via <a href="#send-instance_method" title="Ractor#send (method)">#send</a>, no additional processing occurs on it and it becomes usable by both ractors. When an unshareable object is sent, it can be either <em>copied</em> or <em>moved</em>. Copying is the default, and it copies the object fully by deep cloning (Object#clone) the non-shareable parts of its structure.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_dup'>dup</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>]
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_data2'>data2</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In ractor: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data2'>data2</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data2'>data2</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data2'>data2</span>[<span class='int'>1</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='id identifier rubyid_data'>data</span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outside  : </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>[<span class='int'>1</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will output something like:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>In</span> <span class='label'>ractor:</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>24</span>
<span class='const'>Outside</span>  <span class='op'>:</span> <span class='int'>32</span><span class='comma'>,</span> <span class='int'>40</span><span class='comma'>,</span> <span class='int'>24</span></code></pre>

<p>Note that the object ids of the array and the non-frozen string inside the array have changed in the ractor because they are different objects. The second array’s element, which is a shareable frozen string, is the same object.</p>

<p>Deep cloning of objects may be slow, and sometimes impossible. Alternatively, <code>move: true</code> may be used during sending. This will <em>move</em> the unshareable object to the receiving ractor, making it inaccessible to the sending ractor.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_data_in_ractor'>data_in_ractor</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In ractor: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data_in_ractor'>data_in_ractor</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data_in_ractor'>data_in_ractor</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='label'>move:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outside: moved? </span><span class='embexpr_beg'>#{</span><span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/MovedObject.html" title="Ractor::MovedObject (class)">MovedObject</a></span> <span class='op'>===</span> <span class='id identifier rubyid_data'>data</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Outside: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>This will output:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>In</span> <span class='label'>ractor:</span> <span class='int'>100</span><span class='comma'>,</span> <span class='int'>120</span>
<span class='const'>Outside</span><span class='op'>:</span> <span class='id identifier rubyid_moved?'>moved?</span> <span class='kw'>true</span>
<span class='id identifier rubyid_test'>test</span>.<span class='id identifier rubyid_rb'>rb</span><span class='symbeg'>:</span><span class='int'>9</span><span class='symbeg'>:</span><span class='kw'>in</span> <span class='backtick'>`</span><span class='tstring_content'>method_missing&#39;: can not send any methods to a moved object (Ractor::MovedError)</span></code></pre>

<p>Notice that even <a href="#inspect-instance_method" title="Ractor#inspect (method)">#inspect</a> and more basic methods like <code>__id__</code> are inaccessible on a moved object.</p>

<p><a href="Class.html" title="Class (class)"><code>::Class</code></a> and <a href="Module.html" title="Module (class)"><code>::Module</code></a> objects are shareable and their class/module definitions are shared between ractors. Ractor objects are also shareable. All operations on shareable objects are thread-safe across ractors. Defining mutable, shareable objects in <a href="Ruby.html" title="Ruby (module)"><code>::Ruby</code></a> is not possible, but C extensions can introduce them.</p>

<p>It is prohibited to access (get) instance variables of shareable objects in other ractors if the values of the variables aren’t shareable. This can occur because modules/classes are shareable, but they can have instance variables whose values are not. In non-main ractors, it’s also prohibited to set instance variables on classes/modules (even if the value is shareable).</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>C</span>
  <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>
    <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbeg'>:</span><span class='id identifier rubyid_tricky'>tricky</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'>C</span>.<span class='id identifier rubyid_tricky'>tricky</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unshareable</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_dup'>dup</span>

<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='const'>C</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cls'>cls</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I see </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cls'>cls</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I can&#39;t see </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cls'>cls</span>.<span class='id identifier rubyid_tricky'>tricky</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_cls'>cls</span>.<span class='id identifier rubyid_tricky'>tricky</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='comment'># doesn&#39;t get here, but this would also raise an error
</span><span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># I see C
</span><span class='comment'># can not access instance variables of classes/modules from non-main Ractors (RuntimeError)</span></code></pre>

<p>Ractors can access constants if they are shareable. The main Ractor is the only one that can access non-shareable constants.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>GOOD</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>good</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>
<span class='const'>BAD</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bad</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_dup'>dup</span>

<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GOOD=</span><span class='embexpr_beg'>#{</span><span class='const'>GOOD</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BAD=</span><span class='embexpr_beg'>#{</span><span class='const'>BAD</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># GOOD=good
</span><span class='comment'># can not access non-shareable objects in constant Object::BAD by non-main Ractor. (NameError)
</span>
<span class='comment'># Consider the same C class from above
</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I see </span><span class='embexpr_beg'>#{</span><span class='const'>C</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I can&#39;t see </span><span class='embexpr_beg'>#{</span><span class='const'>C</span>.<span class='id identifier rubyid_tricky'>tricky</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># I see C
</span><span class='comment'># can not access instance variables of classes/modules from non-main Ractors (RuntimeError)</span></code></pre>

<p>See also the description of <code># shareable_constant_value</code> pragma in <a href="../syntax/comments.html" title="Comments syntax">Comments syntax</a> explanation.</p>

<h3 id="label-Ractors+vs+threads">Ractors vs threads</h3>

<p>Each ractor has its own main <a href="Thread.html" title="Thread (class)"><code>::Thread</code></a>. New threads can be created from inside ractors (and, on CRuby, they share the GVL with other threads of this ractor).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='const'><a href="Thread.html" title="Thread (class)">Thread</a></span>.<span class='id identifier rubyid_new'><a href="Thread.html#new-class_method" title="Thread.new (method)">new</a></span> {<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Thread in ractor: a=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_a'>a</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>}.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># Here &quot;Thread in ractor: a=1&quot; will be printed</span></code></pre>

<h3 id="label-Note+on+code+examples">Note on code examples</h3>

<p>In the examples below, sometimes we use the following method to wait for ractors to make progress or finish.</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>def</span> <span class='id identifier rubyid_wait'>wait</span>
  <span class='id identifier rubyid_sleep'>sleep</span>(<span class='float'>0.1</span>)
<span class='kw'>end</span></code></pre>

<p>This is **only for demonstration purposes** and shouldn’t be used in a real code. Most of the time, <a href="#join-instance_method" title="Ractor#join (method)">#join</a> is used to wait for ractors to finish and <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a> is used to wait for messages.</p>

<h3 id="label-Reference">Reference</h3>

<p>See <a href="../ractor.html" title=" design doc"> design doc</a> for more details.</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_attribute_summary'>Class Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#main-class_method" title=".main (class method)">.<strong>main</strong>  </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the main ractor.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature ro'>
      <a href="#main%3F-class_method" title=".main? (class method)">.<strong>main?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns true if the current ractor is the main ractor.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_attribute_summary -->

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-class_method" title=".[] (class method)">.<strong>[]</strong>(sym)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Gets a value from ractor-local storage for the current <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-class_method" title=".[]= (class method)">.<strong>[]=</strong>(sym, val)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets a value in ractor-local storage for the current <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#count-class_method" title=".count (class method)">.<strong>count</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the number of ractors currently running or blocking (waiting).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#current-class_method" title=".current (class method)">.<strong>current</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the currently executing <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#make_shareable-class_method" title="make_shareable (class method)">.<strong>make_shareable</strong>(obj, copy: false)  &#x21d2; shareable_obj </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Makes <code>obj</code> shareable between ractors.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(*args, name: nil) {|*args| ... } &#x21d2; Ractor </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Creates a new Ractor with args and a block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#receive-class_method" title="receive (class method)">.<strong>receive</strong>  &#x21d2; Object </a>
      (also: .recv)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Receives a message from the current ractor’s default port.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recv-class_method" title=".recv (class method)">.<strong>recv</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#select-class_method" title="select (class method)">.<strong>select</strong>(*ractors_or_ports)  &#x21d2; Ractor, ... </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Blocks the current <a href="Thread.html" title="Thread (class)"><code>::Thread</code></a> until one of the given ports has received a message.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shareable%3F-class_method" title="shareable? (class method)">.<strong>shareable?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Checks if the object is shareable by ractors.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shareable_lambda-class_method" title="shareable_lambda (class method)">.<strong>shareable_lambda</strong>(self: nil)  &#x21d2; shareable lambda </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Same as <a href="#shareable_proc-class_method" title="Ractor.shareable_proc (method)">.shareable_proc</a>, but returns a lambda <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#shareable_proc-class_method" title="shareable_proc (class method)">.<strong>shareable_proc</strong>(self: nil)  &#x21d2; shareable proc </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a shareable copy of the given block’s <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#store_if_absent-class_method" title="store_if_absent (class method)">.<strong>store_if_absent</strong>(key)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>If the corresponding ractor-local value is not set, yields a value with init_block and stores the value in a thread-safe manner.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#_require-class_method" title="._require (class method)">.<strong>_require</strong>(feature)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>internal method.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#_activated-class_method" title="._activated (class method)">.<strong>_activated</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <span class='nodoc note title'>Internal use only</span>
    <div class='summary_desc'>
      <div class='inline'><p>internal method that is called when the first “Ractor.new” is called.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#<<-instance_method" title="#&lt;&lt; (instance method)">#<strong>&lt;&lt;</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(sym)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Gets a value from ractor-local storage for the current <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#[]=-instance_method" title="#[]= (instance method)">#<strong>[]=</strong>(sym, val)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets a value in ractor-local storage for the current <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; Boolean </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Closes the default port.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#default_port-instance_method" title="#default_port (instance method)">#<strong>default_port</strong>  &#x21d2; port object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the default port of the <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  </a>
      (also: #to_s)
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#join-instance_method" title="#join (instance method)">#<strong>join</strong>  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Waits for the termination of the <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#monitor-instance_method" title="#monitor (instance method)">#<strong>monitor</strong>(port)  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Registers the port as a monitoring port for this ractor.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#name-instance_method" title="#name (instance method)">#<strong>name</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the name set in <a href="#new-class_method" title="Ractor.new (method)">.new</a>, or <code>nil</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#recv-instance_method" title="#recv (instance method)">#<strong>recv</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#receive-instance_method" title="Ractor#receive (method)">#receive</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#send-instance_method" title="#send (instance method)">#<strong>send</strong>(msg, move: false)  &#x21d2; self </a>
      (also: #&lt;&lt;)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>This is equivalent to <a href="Ractor/Port.html#send-instance_method" title="Ractor::Port#send (method)">Port#send</a> to the ractor’s <a href="#default_port-instance_method" title="Ractor#default_port (method)">#default_port</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#inspect-instance_method" title="Ractor#inspect (method)">#inspect</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#unmonitor-instance_method" title="#unmonitor (instance method)">#<strong>unmonitor</strong>(port)  &#x21d2; self </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Unregisters the port from the monitoring ports for this ractor.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#value-instance_method" title="#value (instance method)">#<strong>value</strong>  &#x21d2; Object </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Waits for <code>ractor</code> to complete and returns its value or raises the exception which terminated the <code>Ractor</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#receive-instance_method" title="#receive (instance method)">#<strong>receive</strong>  </a>
      (also: #recv)
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>same as <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a></p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(*args, name: nil) {|*args| ... } &#x21d2; <code>Ractor</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Creates a new Ractor with args and a block.</p>

<p>The given block (Proc) is isolated (can’t access any outer variables). <code>self</code> inside the block will refer to the current Ractor.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span> { <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hi, I am </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span>.<span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># Prints &quot;Hi, I am #&lt;Ractor:#2 test.rb:1 running&gt;&quot;</span></code></pre>

<p>Any <code>args</code> passed are propagated to the block arguments by the same rules as objects sent via <code>#send/</code>Ractor.receive. If an argument in <code>args</code> is not shareable, it will be copied (via deep cloning, which might be inefficient).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_arg'>arg</span> <span class='op'>=</span> [<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span>]
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Passing: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg'>arg</span><span class='embexpr_end'>}</span><span class='tstring_content'> (#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span>(<span class='id identifier rubyid_arg'>arg</span>) {<span class='op'>|</span><span class='id identifier rubyid_received_arg'>received_arg</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_received_arg'>received_arg</span><span class='embexpr_end'>}</span><span class='tstring_content'> (#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_received_arg'>received_arg</span>.<span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
}
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='comment'># Prints:
</span><span class='comment'>#   Passing: [1, 2, 3] (#280)
</span><span class='comment'>#   Received: [1, 2, 3] (#300)</span></code></pre>

<p>Ractor’s <a href="#name-instance_method" title="Ractor#name (method)">#name</a> can be set for debugging purposes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'>new</span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my ractor</span><span class='tstring_end'>&#39;</span></span>) {}<span class='semicolon'>;</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_r'>r</span>
<span class='comment'>#=&gt; #&lt;Ractor:#3 my ractor test.rb:1 terminated&gt;</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L229-L239'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='229' data-end='239'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 229</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_new'>new</span>(<span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>)
  <span class='id identifier rubyid_b'>b</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span> <span class='comment'># TODO: builtin bug
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>must be called with a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span>
  <span class='kw'>if</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RBOOL(ruby_single_main_ractor)</span><span class='tstring_end'>&quot;</span></span>)
    <span class='const'><a href="Kernel.html" title="Kernel (module)">Kernel</a></span>.<span class='id identifier rubyid_warn'><a href="Kernel.html#warn-class_method" title="Kernel.warn (method)">warn</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ractor API is experimental and may change in future versions of Ruby.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='label'>uplevel:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>category:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_experimental'>experimental</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_loc'>loc</span> <span class='op'>=</span> <span class='id identifier rubyid_caller_locations'>caller_locations</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span>).<span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_loc'>loc</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_loc'>loc</span>.<span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_loc'>loc</span>.<span class='id identifier rubyid_lineno'>lineno</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid___builtin_ractor_create'>__builtin_ractor_create</span>(<span class='id identifier rubyid_loc'>loc</span><span class='comma'>,</span> <span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Attribute Details</h2>
<section class='method_details first' id="main-class_method">
  <h3 class='signature ro first'>
    .<strong>main</strong>   <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the main ractor.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L519-L523'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='519' data-end='523'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 519</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_main'>main</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_ractor_self(GET_VM()-&gt;ractor.main_ractor);
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="main?-class_method">
  <h3 class='signature ro'>
    .<strong>main?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns true if the current ractor is the main ractor.</p>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L526-L530'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='526' data-end='530'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 526</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_main?'>main?</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    RBOOL(GET_VM()-&gt;ractor.main_ractor == rb_ec_ractor_ptr(ec))
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="[]-class_method">
  <h3 class='signature  first'>
    .<strong>[]</strong>(sym)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Gets a value from ractor-local storage for the current <code>Ractor</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L490-L492'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='490' data-end='492'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 490</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='op'>[]</span>(<span class='id identifier rubyid_sym'>sym</span>)
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value'>ractor_local_value</span>(<span class='id identifier rubyid_sym'>sym</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-class_method">
  <h3 class='signature '>
    .<strong>[]=</strong>(sym, val)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets a value in ractor-local storage for the current <code>Ractor</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L495-L497'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='495' data-end='497'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 495</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='op'>[]=</span>(<span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value_set'>ractor_local_value_set</span>(<span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_activated-class_method">
  <h3 class='signature priv  nodoc'>
    .<strong>_activated</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>internal method that is called when the first “Ractor.new” is called</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L545-L557'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='545' data-end='557'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 545</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid__activated'>_activated</span> <span class='comment'># :nodoc:
</span>  <span class='const'><a href="Kernel.html" title="Kernel (module)">Kernel</a></span>.<span class='id identifier rubyid_prepend'>prepend</span> <span class='const'><a href="Module.html" title="Module (class)">Module</a></span>.<span class='id identifier rubyid_new'><a href="Module.html#new-class_method" title="Module.new (method)">new</a></span>{<span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
    <span class='id identifier rubyid_m'>m</span>.<span class='id identifier rubyid_set_temporary_name'>set_temporary_name</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;RactorRequire&gt;</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>def</span> <span class='id identifier rubyid_require'>require</span> <span class='id identifier rubyid_feature'>feature</span> <span class='comment'># :nodoc: -- otherwise RDoc outputs it as a class method
</span>      <span class='kw'>if</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_main?'><a href="#main%3F-class_method" title="Ractor.main? (method)">main?</a></span>
        <span class='kw'>super</span>
      <span class='kw'>else</span>
        <span class='const'>Ractor</span>.<span class='id identifier rubyid__require'><a href="#_require-class_method" title="Ractor._require (method)">_require</a></span> <span class='id identifier rubyid_feature'>feature</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="_require-class_method">
  <h3 class='signature nodoc'>
    .<strong>_require</strong>(feature)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
<div class='docstring'>
  <div class='discussion'>
    
<p>internal method</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L533-L539'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='533' data-end='539'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 533</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid__require'>_require</span> <span class='id identifier rubyid_feature'>feature</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_main?'><a href="#main%3F-class_method" title="Ractor.main? (method)">main?</a></span>
    <span class='kw'>super</span> <span class='id identifier rubyid_feature'>feature</span>
  <span class='kw'>else</span>
    <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_require'>ractor_require</span> <span class='id identifier rubyid_feature'>feature</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="count-class_method">
  <h3 class='signature '>
    .<strong>count</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the number of ractors currently running or blocking (waiting).</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_count'>count</span>                   <span class='comment'>#=&gt; 1
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>example</span><span class='tstring_end'>&#39;</span></span>) { <span class='const'>Ractor</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span> }
<span class='const'>Ractor</span>.<span class='id identifier rubyid_count'>count</span>                   <span class='comment'>#=&gt; 2 (main + example ractor)
</span><span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='int'>42</span>                        <span class='comment'># r&#39;s Ractor.receive will resume
</span><span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>                         <span class='comment'># wait for r&#39;s termination
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_count'>count</span>                   <span class='comment'>#=&gt; 1</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L258-L262'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='258' data-end='262'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 258</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ULONG2NUM(GET_VM()-&gt;ractor.cnt);
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="current-class_method">
  <h3 class='signature '>
    .<strong>current</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the currently executing <code>Ractor</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_current'>current</span> <span class='comment'>#=&gt; #&lt;Ractor:#1 running&gt;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L244-L248'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='244' data-end='248'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 244</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_current'>current</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_ractor_self(rb_ec_ractor_ptr(ec));
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="make_shareable-class_method">
  <h3 class='signature '>
    .<strong>make_shareable</strong>(obj, copy: false)  &#x21d2; <code>shareable_obj</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Makes <code>obj</code> shareable between ractors.</p>

<p><code>obj</code> and all the objects it refers to will be frozen, unless they are already shareable.</p>

<p>If <code>copy</code> keyword is <code>true</code>, it will copy objects before freezing them, and will not modify <code>obj</code> or its internal objects.</p>

<p>Note that the specification and implementation of this method are not mature and may be changed in the future.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>]
<span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='id identifier rubyid_obj'>obj</span>)     <span class='comment'>#=&gt; false
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='comment'>#=&gt; [&quot;test&quot;]
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'><a href="#shareable%3F-class_method" title="Ractor.shareable? (method)">shareable?</a></span>(<span class='id identifier rubyid_obj'>obj</span>)     <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj'>obj</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj'>obj</span>[<span class='int'>0</span>].<span class='id identifier rubyid_frozen?'>frozen?</span>             <span class='comment'>#=&gt; true
</span>
<span class='comment'># Copy vs non-copy versions:
</span><span class='id identifier rubyid_obj1'>obj1</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_obj1s'>obj1s</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span>(<span class='id identifier rubyid_obj1'>obj1</span>)
<span class='id identifier rubyid_obj1'>obj1</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                        <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj1s'>obj1s</span>.<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_obj1'>obj1</span>.<span class='id identifier rubyid_object_id'>object_id</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj2'>obj2</span> <span class='op'>=</span> [<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>test</span><span class='tstring_end'>&#39;</span></span>]
<span class='id identifier rubyid_obj2s'>obj2s</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span>(<span class='id identifier rubyid_obj2'>obj2</span><span class='comma'>,</span> <span class='label'>copy:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_obj2'>obj2</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                        <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_obj2s'>obj2s</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>                       <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_obj2s'>obj2s</span>.<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_obj2'>obj2</span>.<span class='id identifier rubyid_object_id'>object_id</span>   <span class='comment'>#=&gt; false
</span><span class='id identifier rubyid_obj2s'>obj2s</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span> <span class='op'>==</span> <span class='id identifier rubyid_obj2'>obj2</span>[<span class='int'>0</span>].<span class='id identifier rubyid_object_id'>object_id</span> <span class='comment'>#=&gt; false</span></code></pre>

<p>See also the “Shareable and unshareable objects” section in the <code>Ractor</code> class docs.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L459-L469'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='459' data-end='469'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 459</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_make_shareable'>make_shareable</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='label'>copy:</span> <span class='kw'>false</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_copy'>copy</span>
    <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
      rb_ractor_make_shareable_copy(obj);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
      rb_ractor_make_shareable(obj);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive-class_method">
  <h3 class='signature '>
    .<strong>receive</strong>  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>     <span class='aliases'>Also known as: <span class='names'>.recv</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Receives a message from the current ractor’s default port.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L349-L351'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='349' data-end='351'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 349</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_receive'>receive</span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span>.<span class='id identifier rubyid_default_port'><a href="#default_port-instance_method" title="Ractor#default_port (method)">default_port</a></span>.<span class='id identifier rubyid_receive'>receive</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recv-class_method">
  <h3 class='signature '>
    .<strong>recv</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L354-L354'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='354' data-end='354'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 354</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_recv'>recv</span> <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="select-class_method">
  <h3 class='signature '>
    .<strong>select</strong>(*ractors_or_ports)  &#x21d2; <code>Ractor</code>, ...   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Blocks the current <a href="Thread.html" title="Thread (class)"><code>::Thread</code></a> until one of the given ports has received a message. Returns an array of two elements where the first element is the <a href="Ractor/Port.html" title="Ractor::Port (class)"><code>::Ractor::Port</code></a> and the second is the received object. This method can also accept <code>Ractor</code> objects themselves, and in that case will wait until one has terminated and return a two-element array where the first element is the ractor and the second is its termination value.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p1'>p1</span><span class='comma'>,</span> <span class='id identifier rubyid_p2'>p2</span> <span class='op'>=</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>.<span class='id identifier rubyid_new'><a href="Ractor/Port.html#new-class_method" title="Ractor::Port.new (method)">new</a></span><span class='comma'>,</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>.<span class='id identifier rubyid_new'><a href="Ractor/Port.html#new-class_method" title="Ractor::Port.new (method)">new</a></span>
<span class='id identifier rubyid_ps'>ps</span> <span class='op'>=</span> [<span class='id identifier rubyid_p1'>p1</span><span class='comma'>,</span> <span class='id identifier rubyid_p2'>p2</span>]
<span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='int'>2</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
  <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='id identifier rubyid_ps'>ps</span>.<span class='id identifier rubyid_shift'>shift</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_sleep'>sleep</span> <span class='id identifier rubyid_rand'>rand</span>(<span class='float'>0.99</span>)
    <span class='id identifier rubyid_p'>p</span>.<span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>r</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_sleep'>sleep</span> <span class='id identifier rubyid_rand'>rand</span>(<span class='float'>0.99</span>)
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>r</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'> done</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_waiting_on'>waiting_on</span> <span class='op'>=</span> [<span class='id identifier rubyid_p1'>p1</span><span class='comma'>,</span> <span class='id identifier rubyid_p2'>p2</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rs'>rs</span>]
<span class='kw'>until</span> <span class='id identifier rubyid_waiting_on'>waiting_on</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_received_on'>received_on</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_select'>select</span>(<span class='op'>*</span><span class='id identifier rubyid_waiting_on'>waiting_on</span>)
  <span class='id identifier rubyid_waiting_on'>waiting_on</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_received_on'>received_on</span>)
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_obj'>obj</span>
<span class='kw'>end</span>

<span class='comment'># r0
</span><span class='comment'># r1
</span><span class='comment'># r1 done
</span><span class='comment'># r0 done</span></code></pre>

<p>The following example is almost equivalent to <code>ractors.map(&amp;:value)</code> except the thread is unblocked when any of the ractors has terminated as opposed to waiting for their termination in the array element order.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> []
<span class='kw'>until</span> <span class='id identifier rubyid_ractors'>ractors</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_select'>select</span>(<span class='op'>*</span><span class='id identifier rubyid_ractors'>ractors</span>)
  <span class='id identifier rubyid_ractors'>ractors</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='id identifier rubyid_r'>r</span>)
  <span class='id identifier rubyid_values'>values</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span></code></pre>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L308-L342'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='308' data-end='342'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 308</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_select'>select</span>(<span class='op'>*</span><span class='id identifier rubyid_ports'>ports</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>specify at least one Ractor::Port or Ractor</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_ports'>ports</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_monitors'>monitors</span> <span class='op'>=</span> {} <span class='comment'># Ractor::Port =&gt; Ractor
</span>
  <span class='id identifier rubyid_ports'>ports</span> <span class='op'>=</span> <span class='id identifier rubyid_ports'>ports</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_arg'>arg</span>
    <span class='kw'>when</span> <span class='const'>Ractor</span>
      <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>.<span class='id identifier rubyid_new'><a href="Ractor/Port.html#new-class_method" title="Ractor::Port.new (method)">new</a></span>
      <span class='id identifier rubyid_monitors'>monitors</span>[<span class='id identifier rubyid_port'>port</span>] <span class='op'>=</span> <span class='id identifier rubyid_arg'>arg</span>
      <span class='id identifier rubyid_arg'>arg</span>.<span class='id identifier rubyid_monitor'><a href="#monitor-instance_method" title="Ractor#monitor (method)">monitor</a></span> <span class='id identifier rubyid_port'>port</span>
      <span class='id identifier rubyid_port'>port</span>
    <span class='kw'>when</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>
      <span class='id identifier rubyid_arg'>arg</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="ArgumentError.html" title="ArgumentError (class)">ArgumentError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>should be Ractor::Port or Ractor</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_result_port'>result_port</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='id identifier rubyid___builtin_ractor_select_internal'>__builtin_ractor_select_internal</span>(<span class='id identifier rubyid_ports'>ports</span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_monitors'>monitors</span>[<span class='id identifier rubyid_result_port'>result_port</span>]
      [<span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_value'><a href="#value-instance_method" title="Ractor#value (method)">value</a></span>]
    <span class='kw'>else</span>
      [<span class='id identifier rubyid_result_port'>result_port</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span>]
    <span class='kw'>end</span>
  <span class='kw'>ensure</span>
    <span class='comment'># close all ports for join
</span>    <span class='id identifier rubyid_monitors'>monitors</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
      <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_unmonitor'><a href="#unmonitor-instance_method" title="Ractor#unmonitor (method)">unmonitor</a></span> <span class='id identifier rubyid_port'>port</span>
      <span class='id identifier rubyid_port'>port</span>.<span class='id identifier rubyid_close'><a href="#close-instance_method" title="Ractor#close (method)">close</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shareable?-class_method">
  <h3 class='signature '>
    .<strong>shareable?</strong>(obj)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Checks if the object is shareable by ractors.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'>shareable?</span>(<span class='int'>1</span>)            <span class='comment'>#=&gt; true -- numbers are shareable
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'>shareable?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>)        <span class='comment'>#=&gt; false, unless the string is frozen due to # frozen_string_literal: true
</span><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable?'>shareable?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_freeze'>freeze</span>) <span class='comment'>#=&gt; true</span></code></pre>

<p>See also the “Shareable and unshareable objects” section in the Ractor class docs.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L418-L422'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='418' data-end='422'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 418</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_shareable?'>shareable?</span> <span class='id identifier rubyid_obj'>obj</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    RBOOL(rb_ractor_shareable_p(obj));
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shareable_lambda-class_method">
  <h3 class='signature '>
    .<strong>shareable_lambda</strong>(self: nil)  &#x21d2; <code>shareable</code> <code>lambda</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Same as <a href="#shareable_proc-class_method" title="Ractor.shareable_proc (method)">.shareable_proc</a>, but returns a lambda <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L681-L687'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='681' data-end='687'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 681</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_shareable_lambda'>shareable_lambda</span> <span class='label'>self:</span> <span class='kw'>nil</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_attr!'>attr!</span> <span class='symbeg'>:</span><span class='id identifier rubyid_use_block'>use_block</span>

  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span>(<span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'>
    ractor_shareable_proc(ec, *LOCAL_PTR(self), true)
  </span><span class='tstring_end'>}</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shareable_proc-class_method">
  <h3 class='signature '>
    .<strong>shareable_proc</strong>(self: nil)  &#x21d2; <code>shareable</code> <code>proc</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a shareable copy of the given block’s <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a>. The value of <code>self</code> in the <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a> will be replaced with the value passed via the <code>self:</code> keyword, or <code>nil</code> if not given.</p>

<p>In a shareable <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a>, access to any outer variables if prohibited.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='int'>42</span>
<span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable_proc'>shareable_proc</span>{ <span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_a'>a</span> }
<span class='comment'>#=&gt; can not isolate a Proc because it accesses outer variables (a). (ArgumentError)</span></code></pre>

<p>The value of <code>self</code> in the <a href="Proc.html" title="Proc (class)"><code>::Proc</code></a> must be a shareable object.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_shareable_proc'>shareable_proc</span>(<span class='label'>self:</span> <span class='kw'>self</span>){}
<span class='comment'>#=&gt; self should be shareable: main (Ractor::IsolationError)</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L667-L673'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='667' data-end='673'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 667</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_shareable_proc'>shareable_proc</span> <span class='label'>self:</span> <span class='kw'>nil</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_attr!'>attr!</span> <span class='symbeg'>:</span><span class='id identifier rubyid_use_block'>use_block</span>

  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span>(<span class='tstring'><span class='tstring_beg'>%Q{</span><span class='tstring_content'>
    ractor_shareable_proc(ec, *LOCAL_PTR(self), false)
  </span><span class='tstring_end'>}</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="store_if_absent-class_method">
  <h3 class='signature '>
    .<strong>store_if_absent</strong>(key)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the corresponding ractor-local value is not set, yields a value with init_block and stores the value in a thread-safe manner. This method returns the stored value.</p>

<pre class="code ruby"><code class="ruby">(<span class='int'>1</span><span class='op'>..</span><span class='int'>10</span>).<span class='id identifier rubyid_map'>map</span>{
  <span class='const'><a href="Thread.html" title="Thread (class)">Thread</a></span>.<span class='id identifier rubyid_new'><a href="Thread.html#new-class_method" title="Thread.new (method)">new</a></span>(<span class='id identifier rubyid_it'>it</span>){<span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='const'>Ractor</span>.<span class='id identifier rubyid_store_if_absent'>store_if_absent</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_s'>s</span>){ <span class='id identifier rubyid_f'>f</span>()<span class='semicolon'>;</span> <span class='id identifier rubyid_i'>i</span> }
    <span class='comment'>#=&gt; return stored value of key :s
</span>  }
}.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_value'><a href="#value-instance_method" title="Ractor#value (method)">value</a></span>).<span class='id identifier rubyid_uniq'>uniq</span>.<span class='id identifier rubyid_size'>size</span> <span class='comment'>#=&gt; 1 and f() is called only once</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L513-L516'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='513' data-end='516'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 513</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_store_if_absent'>store_if_absent</span>(<span class='id identifier rubyid_sym'>sym</span>)
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_attr!'>attr!</span> <span class='symbeg'>:</span><span class='id identifier rubyid_use_block'>use_block</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value_store_if_absent'>ractor_local_value_store_if_absent</span>(<span class='id identifier rubyid_sym'>sym</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="<<-instance_method">
  <h3 class='signature  first'>
    #<strong>&lt;&lt;</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#send-instance_method" title="Ractor#send (method)">#send</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L372-L372'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='372' data-end='372'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 372</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_send'><a href="#send-instance_method" title="Ractor#send (method)">send</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]-instance_method">
  <h3 class='signature '>
    #<strong>[]</strong>(sym)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Gets a value from ractor-local storage for the current <code>Ractor</code>. Obsolete, use <a href="#[]-class_method" title="Ractor.[] (method)">.[]</a> instead.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L473-L478'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='473' data-end='478'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 473</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]</span>(<span class='id identifier rubyid_sym'>sym</span>)
  <span class='kw'>if</span> (<span class='kw'>self</span> <span class='op'>!=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot get ractor local storage for non-current ractor</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value'>ractor_local_value</span>(<span class='id identifier rubyid_sym'>sym</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="[]=-instance_method">
  <h3 class='signature '>
    #<strong>[]=</strong>(sym, val)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets a value in ractor-local storage for the current <code>Ractor</code>. Obsolete, use <a href="#[]=-class_method" title="Ractor.[]= (method)">.[]=</a> instead.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L482-L487'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='482' data-end='487'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 482</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='op'>[]=</span>(<span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
  <span class='kw'>if</span> (<span class='kw'>self</span> <span class='op'>!=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_current'><a href="#current-class_method" title="Ractor.current (method)">current</a></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="RuntimeError.html" title="RuntimeError (class)">RuntimeError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot set ractor local storage for non-current ractor</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='const'>Primitive</span>.<span class='id identifier rubyid_ractor_local_value_set'>ractor_local_value_set</span>(<span class='id identifier rubyid_sym'>sym</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature '>
    #<strong>close</strong>  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Closes the default port. Closing a port is allowed only by the ractor which created the port. Therefore, the receiver must be the current ractor.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L403-L405'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='403' data-end='405'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 403</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_default_port'><a href="#default_port-instance_method" title="Ractor#default_port (method)">default_port</a></span>.<span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="default_port-instance_method">
  <h3 class='signature '>
    #<strong>default_port</strong>  &#x21d2; <code>port</code> <code>object</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the default port of the <code>Ractor</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L566-L570'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='566' data-end='570'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 566</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_default_port'>default_port</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    ractor_default_port_value(RACTOR_PTR(self))
  </span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="inspect-instance_method">
  <h3 class='signature '>
    #<strong>inspect</strong>  
    <span class='aliases'>Also known as: <span class='names'>#to_s</span></span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L374-L382'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='374' data-end='382'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 374</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_loc'>loc</span>  <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'> RACTOR_PTR(self)-&gt;loc </span><span class='tstring_end'>}</span></span>
  <span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span> <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'> RACTOR_PTR(self)-&gt;name </span><span class='tstring_end'>}</span></span>
  <span class='id identifier rubyid_id'>id</span>   <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'> UINT2NUM(rb_ractor_id(RACTOR_PTR(self))) </span><span class='tstring_end'>}</span></span>
  <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>
    rb_str_new2(ractor_status_str(RACTOR_PTR(self)-&gt;status_))
  </span><span class='tstring_end'>}</span></span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;Ractor:#</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='op'>+</span><span class='id identifier rubyid_name'><a href="#name-instance_method" title="Ractor#name (method)">name</a></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_loc'>loc</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_loc'>loc</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="join-instance_method">
  <h3 class='signature '>
    #<strong>join</strong>  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Waits for the termination of the <code>Ractor</code>. If the <code>Ractor</code> was aborted (terminated by an unhandled exception), the exception is raised in the current ractor.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>{}.<span class='id identifier rubyid_join'>join</span> <span class='comment'>#=&gt; ractor
</span>
<span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>{ <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> }.<span class='id identifier rubyid_join'>join</span>
<span class='comment'>#=&gt; raises the exception &quot;foo (RuntimeError)&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L585-L596'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='585' data-end='596'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 585</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>.<span class='id identifier rubyid_new'><a href="Ractor/Port.html#new-class_method" title="Ractor::Port.new (method)">new</a></span>

  <span class='kw'>self</span>.<span class='id identifier rubyid_monitor'><a href="#monitor-instance_method" title="Ractor#monitor (method)">monitor</a></span> <span class='id identifier rubyid_port'>port</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_port'>port</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_aborted'>aborted</span>
    <span class='id identifier rubyid___builtin_ractor_value'>__builtin_ractor_value</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_port'>port</span>.<span class='id identifier rubyid_close'><a href="#close-instance_method" title="Ractor#close (method)">close</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="monitor-instance_method">
  <h3 class='signature '>
    #<strong>monitor</strong>(port)  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Registers the port as a monitoring port for this ractor. When the ractor terminates, the port receives a <a href="Symbol.html" title="Symbol (class)"><code>::Symbol</code></a> object.</p>
<ul><li>
<p><code>:exited</code> is sent if the ractor terminates without an unhandled exception.</p>
</li><li>
<p><code>:aborted</code> is sent if the ractor terminates by an unhandled exception.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>{ <span class='id identifier rubyid_some_task'>some_task</span>() }
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_monitor'>monitor</span>(<span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>.<span class='id identifier rubyid_new'><a href="Ractor/Port.html#new-class_method" title="Ractor::Port.new (method)">new</a></span>)
<span class='id identifier rubyid_port'>port</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span> <span class='comment'>#=&gt; :exited and r is terminated
</span>
<span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>{ <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> }
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_monitor'>monitor</span>(<span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='const'>Ractor</span><span class='op'>::</span><span class='const'><a href="Ractor/Port.html" title="Ractor::Port (class)">Port</a></span>.<span class='id identifier rubyid_new'><a href="Ractor/Port.html#new-class_method" title="Ractor::Port.new (method)">new</a></span>)
<span class='id identifier rubyid_port'>port</span>.<span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span> <span class='comment'>#=&gt; :aborted and r is terminated by the RuntimeError &quot;foo&quot;</span></code></pre>
</li></ul>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L634-L636'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='634' data-end='636'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 634</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_monitor'>monitor</span> <span class='id identifier rubyid_port'>port</span>
  <span class='id identifier rubyid___builtin_ractor_monitor'>__builtin_ractor_monitor</span>(<span class='id identifier rubyid_port'>port</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="name-instance_method">
  <h3 class='signature '>
    #<strong>name</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the name set in <a href="#new-class_method" title="Ractor.new (method)">.new</a>, or <code>nil</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L387-L389'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='387' data-end='389'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 387</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='id identifier rubyid___builtin_cexpr!'>__builtin_cexpr!</span> <span class='tstring'><span class='tstring_beg'>%q{</span><span class='tstring_content'>RACTOR_PTR(self)-&gt;name</span><span class='tstring_end'>}</span></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="receive-instance_method">
  <h3 class='signature priv'>
    #<strong>receive</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
    <span class='aliases'>Also known as: <span class='names'>#recv</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>same as <a href="#receive-class_method" title="Ractor.receive (method)">.receive</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L358-L360'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='358' data-end='360'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 358</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_receive'>receive</span>
  <span class='id identifier rubyid_default_port'><a href="#default_port-instance_method" title="Ractor#default_port (method)">default_port</a></span>.<span class='id identifier rubyid_receive'>receive</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="recv-instance_method">
  <h3 class='signature '>
    #<strong>recv</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#receive-instance_method" title="Ractor#receive (method)">#receive</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L361-L361'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='361' data-end='361'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 361</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_recv'>recv</span> <span class='id identifier rubyid_receive'><a href="#receive-class_method" title="Ractor.receive (method)">receive</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send-instance_method">
  <h3 class='signature '>
    #<strong>send</strong>(msg, move: false)  &#x21d2; <code>self</code>     <span class='aliases'>Also known as: <span class='names'>#&lt;&lt;</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>This is equivalent to <a href="Ractor/Port.html#send-instance_method" title="Ractor::Port#send (method)">Port#send</a> to the ractor’s <a href="#default_port-instance_method" title="Ractor#default_port (method)">#default_port</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L368-L371'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='368' data-end='371'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 368</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send'>send</span>(<span class='op'>...</span>)
  <span class='id identifier rubyid_default_port'><a href="#default_port-instance_method" title="Ractor#default_port (method)">default_port</a></span>.<span class='id identifier rubyid_send'>send</span>(<span class='op'>...</span>)
  <span class='kw'>self</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_s-instance_method">
  <h3 class='signature '>
    #<strong>to_s</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#inspect-instance_method" title="Ractor#inspect (method)">#inspect</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L384-L384'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='384' data-end='384'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 384</span></pre>
<pre class='code ruby'>

<span class='kw'>alias</span> <span class='id identifier rubyid_to_s'>to_s</span> <span class='id identifier rubyid_inspect'><a href="#inspect-instance_method" title="Ractor#inspect (method)">inspect</a></span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="unmonitor-instance_method">
  <h3 class='signature '>
    #<strong>unmonitor</strong>(port)  &#x21d2; <code>self</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Unregisters the port from the monitoring ports for this ractor.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L644-L646'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='644' data-end='646'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 644</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_unmonitor'>unmonitor</span> <span class='id identifier rubyid_port'>port</span>
  <span class='id identifier rubyid___builtin_ractor_unmonitor'>__builtin_ractor_unmonitor</span>(<span class='id identifier rubyid_port'>port</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="value-instance_method">
  <h3 class='signature '>
    #<strong>value</strong>  &#x21d2; <a href="Object.html" title="Object (class)">Object</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Waits for <code>ractor</code> to complete and returns its value or raises the exception which terminated the <code>Ractor</code>. The termination value will be moved to the calling <code>Ractor</code>. Therefore, at most 1 <code>Ractor</code> can receive another ractor’s termination value.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>{ [<span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span>] }
<span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_value'>value</span> <span class='comment'>#=&gt; [1, 2] (unshareable object)
</span>
<span class='const'>Ractor</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Ractor.new (method)">new</a></span>(<span class='id identifier rubyid_r'>r</span>){<span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span>.<span class='id identifier rubyid_value'>value</span>} <span class='comment'>#=&gt; Ractor::Error</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/ractor.rb#L611-L614'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='611' data-end='614'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ractor.rb', line 611</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>self</span>.<span class='id identifier rubyid_join'><a href="#join-instance_method" title="Ractor#join (method)">join</a></span>
  <span class='id identifier rubyid___builtin_ractor_value'>__builtin_ractor_value</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>