<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Encoding::Converter &mdash; Core  Ruby-3.4.8 p72</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Encoding::Converter",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.4.8</a> &raquo; 
      <a href='../'>Core</a> &raquo; 
      <a href='../_index.html#alpha_C'>Index (C)</a> &raquo; 
        <a href="../Encoding.html" title="Encoding (class)">Encoding</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Converter&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Encoding::Converter</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4580'>transcode.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3003'>transcode.c</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p><a href="../Encoding.html" title="Encoding (class)"><code>::Encoding</code></a> conversion class.</p>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='AFTER_OUTPUT-constant' class='summary_signature'>AFTER_OUTPUT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Stop converting after some output is complete but before all of the input was consumed.  See primitive_convert for an example.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4638'># File 'transcode.c', line 4638</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_AFTER_OUTPUT</span>)</pre>
  </li>
  <li>
    <span id='CRLF_NEWLINE_DECORATOR-constant' class='summary_signature'>CRLF_NEWLINE_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Decorator for converting LF to CRLF</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4653'># File 'transcode.c', line 4653</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_CRLF_NEWLINE_DECORATOR</span>)</pre>
  </li>
  <li>
    <span id='CR_NEWLINE_DECORATOR-constant' class='summary_signature'>CR_NEWLINE_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Decorator for converting LF to CR</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4658'># File 'transcode.c', line 4658</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_CR_NEWLINE_DECORATOR</span>)</pre>
  </li>
  <li>
    <span id='INVALID_MASK-constant' class='summary_signature'>INVALID_MASK =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Mask for invalid byte sequences</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4603'># File 'transcode.c', line 4603</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_INVALID_MASK</span>)</pre>
  </li>
  <li>
    <span id='INVALID_REPLACE-constant' class='summary_signature'>INVALID_REPLACE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Replace invalid byte sequences</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4608'># File 'transcode.c', line 4608</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_INVALID_REPLACE</span>)</pre>
  </li>
  <li>
    <span id='LF_NEWLINE_DECORATOR-constant' class='summary_signature'>LF_NEWLINE_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Decorator for converting CRLF and CR to LF when writing</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4648'># File 'transcode.c', line 4648</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_LF_NEWLINE_DECORATOR</span>)</pre>
  </li>
  <li>
    <span id='PARTIAL_INPUT-constant' class='summary_signature'>PARTIAL_INPUT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Indicates the source may be part of a larger string.  See primitive_convert for an example.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4632'># File 'transcode.c', line 4632</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_PARTIAL_INPUT</span>)</pre>
  </li>
  <li>
    <span id='UNDEF_HEX_CHARREF-constant' class='summary_signature'>UNDEF_HEX_CHARREF =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Replace byte sequences that are undefined in the destination encoding with an XML hexadecimal character reference.  This is valid for XML conversion.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4626'># File 'transcode.c', line 4626</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_UNDEF_HEX_CHARREF</span>)</pre>
  </li>
  <li>
    <span id='UNDEF_MASK-constant' class='summary_signature'>UNDEF_MASK =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Mask for a valid character in the source encoding but no related character(s) in destination encoding.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4614'># File 'transcode.c', line 4614</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_UNDEF_MASK</span>)</pre>
  </li>
  <li>
    <span id='UNDEF_REPLACE-constant' class='summary_signature'>UNDEF_REPLACE =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Replace byte sequences that are undefined in the destination encoding.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4619'># File 'transcode.c', line 4619</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_UNDEF_REPLACE</span>)</pre>
  </li>
  <li>
    <span id='UNIVERSAL_NEWLINE_DECORATOR-constant' class='summary_signature'>UNIVERSAL_NEWLINE_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Decorator for converting CRLF and CR to LF</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4643'># File 'transcode.c', line 4643</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_UNIVERSAL_NEWLINE_DECORATOR</span>)</pre>
  </li>
  <li>
    <span id='XML_ATTR_CONTENT_DECORATOR-constant' class='summary_signature'>XML_ATTR_CONTENT_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Escape as XML AttValue</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4668'># File 'transcode.c', line 4668</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_XML_ATTR_CONTENT_DECORATOR</span>)</pre>
  </li>
  <li>
    <span id='XML_ATTR_QUOTE_DECORATOR-constant' class='summary_signature'>XML_ATTR_QUOTE_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Escape as XML AttValue</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4673'># File 'transcode.c', line 4673</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_XML_ATTR_QUOTE_DECORATOR</span>)</pre>
  </li>
  <li>
    <span id='XML_TEXT_DECORATOR-constant' class='summary_signature'>XML_TEXT_DECORATOR =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Escape as XML CharData</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4663'># File 'transcode.c', line 4663</a>    <pre class='code c'><span class='const'>INT2FIX</span>(<span class='const'>ECONV_XML_TEXT_DECORATOR</span>)</pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#asciicompat_encoding-class_method" title="asciicompat_encoding (class method)">.<strong>asciicompat_encoding</strong>(string)  &#x21d2; Encoding<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the corresponding ASCII compatible encoding.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(source_encoding, destination_encoding)  </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>possible options elements:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#search_convpath-class_method" title="search_convpath (class method)">.<strong>search_convpath</strong>(source_encoding, destination_encoding)  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns a conversion path.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature rw'>
      <a href="#replacement-instance_method" title="#replacement (instance method)">#<strong>replacement</strong>  &#x21d2; String </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the replacement string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature rw'>
      <a href="#replacement=-instance_method" title="#replacement= (instance method)">#<strong>replacement=</strong>(string)  </a>
    </span>
    <span class='note title rw'>rw</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sets the replacement string.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#==-instance_method" title="#== (instance method)">#<strong>==</strong>(other)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#convert-instance_method" title="#convert (instance method)">#<strong>convert</strong>(source_string)  &#x21d2; destination_string </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Convert source_string and return destination_string.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#convpath-instance_method" title="#convpath (instance method)">#<strong>convpath</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the conversion path of ec.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#destination_encoding-instance_method" title="#destination_encoding (instance method)">#<strong>destination_encoding</strong>  &#x21d2; Encoding </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the destination encoding as an <a href="../Encoding.html" title="Encoding (class)"><code>::Encoding</code></a> object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#finish-instance_method" title="#finish (instance method)">#<strong>finish</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Finishes the converter.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#insert_output-instance_method" title="#insert_output (instance method)">#<strong>insert_output</strong>(string)  &#x21d2; nil </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Inserts string into the encoding converter.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#last_error-instance_method" title="#last_error (instance method)">#<strong>last_error</strong>  &#x21d2; Exception<sup>?</sup> </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns an exception object for the last conversion.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#primitive_convert-instance_method" title="#primitive_convert (instance method)">#<strong>primitive_convert</strong>(source_buffer, destination_buffer)  &#x21d2; Symbol </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>possible opt elements:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#primitive_errinfo-instance_method" title="#primitive_errinfo (instance method)">#<strong>primitive_errinfo</strong>  &#x21d2; Array </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>primitive_errinfo returns important information regarding the last error as a 5-element array:</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#putback-instance_method" title="#putback (instance method)">#<strong>putback</strong>  &#x21d2; String </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Put back the bytes which will be converted.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#source_encoding-instance_method" title="#source_encoding (instance method)">#<strong>source_encoding</strong>  &#x21d2; Encoding </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the source encoding as an <a href="../Encoding.html" title="Encoding (class)"><code>::Encoding</code></a> object.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>new</strong>(source_encoding, destination_encoding)  </span>
      <span class='overload'>.<strong>new</strong>(source_encoding, destination_encoding, opt)  </span>
      <span class='overload'>.<strong>new</strong>(convpath)  </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>possible options elements:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_hash'>hash</span> <span class='label'>form:</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_invalid'>invalid</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span>            <span class='comment'># raise error on invalid byte sequence (default)
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_invalid'>invalid</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_replace'>replace</span>       <span class='comment'># replace invalid byte sequence
</span>  <span class='symbeg'>:</span><span class='kw'>undef</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span>              <span class='comment'># raise error on undefined conversion (default)
</span>  <span class='symbeg'>:</span><span class='kw'>undef</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_replace'>replace</span>         <span class='comment'># replace undefined conversion
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_replace'>replace</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_string'>string</span>         <span class='comment'># replacement string (&quot;?&quot; or &quot;\uFFFD&quot; if not specified)
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_newline'>newline</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_universal'>universal</span>     <span class='comment'># decorator for converting CRLF and CR to LF
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_newline'>newline</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_lf'>lf</span>            <span class='comment'># decorator for converting CRLF and CR to LF when writing
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_newline'>newline</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_crlf'>crlf</span>          <span class='comment'># decorator for converting LF to CRLF
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_newline'>newline</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cr'>cr</span>            <span class='comment'># decorator for converting LF to CR
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_universal_newline'>universal_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='comment'># decorator for converting CRLF and CR to LF
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_crlf_newline'>crlf_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>      <span class='comment'># decorator for converting LF to CRLF
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_cr_newline'>cr_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>        <span class='comment'># decorator for converting LF to CR
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_lf_newline'>lf_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>        <span class='comment'># decorator for converting CRLF and CR to LF when writing
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_xml'>xml</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_text'>text</span>              <span class='comment'># escape as XML CharData.
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_xml'>xml</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_attr'>attr</span>              <span class='comment'># escape as XML AttValue
</span><span class='id identifier rubyid_integer'>integer</span> <span class='label'>form:</span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#INVALID_REPLACE-constant" title="Encoding::Converter::INVALID_REPLACE (constant)">INVALID_REPLACE</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#UNDEF_REPLACE-constant" title="Encoding::Converter::UNDEF_REPLACE (constant)">UNDEF_REPLACE</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#UNDEF_HEX_CHARREF-constant" title="Encoding::Converter::UNDEF_HEX_CHARREF (constant)">UNDEF_HEX_CHARREF</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#UNIVERSAL_NEWLINE_DECORATOR-constant" title="Encoding::Converter::UNIVERSAL_NEWLINE_DECORATOR (constant)">UNIVERSAL_NEWLINE_DECORATOR</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#LF_NEWLINE_DECORATOR-constant" title="Encoding::Converter::LF_NEWLINE_DECORATOR (constant)">LF_NEWLINE_DECORATOR</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#CRLF_NEWLINE_DECORATOR-constant" title="Encoding::Converter::CRLF_NEWLINE_DECORATOR (constant)">CRLF_NEWLINE_DECORATOR</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#CR_NEWLINE_DECORATOR-constant" title="Encoding::Converter::CR_NEWLINE_DECORATOR (constant)">CR_NEWLINE_DECORATOR</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#XML_TEXT_DECORATOR-constant" title="Encoding::Converter::XML_TEXT_DECORATOR (constant)">XML_TEXT_DECORATOR</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#XML_ATTR_CONTENT_DECORATOR-constant" title="Encoding::Converter::XML_ATTR_CONTENT_DECORATOR (constant)">XML_ATTR_CONTENT_DECORATOR</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#XML_ATTR_QUOTE_DECORATOR-constant" title="Encoding::Converter::XML_ATTR_QUOTE_DECORATOR (constant)">XML_ATTR_QUOTE_DECORATOR</a></span></code></pre>

<p><code>new</code> creates an instance of <code>Converter</code>.</p>

<p>Source_encoding and destination_encoding should be a string or <a href="../Encoding.html" title="Encoding (class)"><code>::Encoding</code></a> object.</p>

<p>opt should be nil, a hash or an integer.</p>

<p>convpath should be an array. convpath may contain</p>
<ul><li>
<p>two-element arrays which contain encodings or encoding names, or</p>
</li><li>
<p>strings representing decorator names.</p>
</li></ul>

<p><code>new</code> optionally takes an option. The option should be a hash or an integer. The option hash can contain <code>:invalid</code> =&gt; nil, etc. The option integer should be logical-or of constants such as <a href="#INVALID_REPLACE-constant" title="Encoding::Converter::INVALID_REPLACE (constant)">INVALID_REPLACE</a>, etc.</p>
<dl class="rdoc-list label-list"><dt>:invalid =&gt; nil</dt>
<dd>
<p>Raise error on invalid byte sequence.  This is a default behavior.</p>
</dd><dt>:invalid =&gt; :replace</dt>
<dd>
<p>Replace invalid byte sequence by replacement string.</p>
</dd><dt>:undef =&gt; nil</dt>
<dd>
<p>Raise an error if a character in source_encoding is not defined in destination_encoding. This is a default behavior.</p>
</dd><dt>:undef =&gt; :replace</dt>
<dd>
<p>Replace undefined character in destination_encoding with replacement string.</p>
</dd><dt>:replace =&gt; string</dt>
<dd>
<p>Specify the replacement string. If not specified, “uFFFD” is used for Unicode encodings and “?” for others.</p>
</dd><dt>:universal_newline =&gt; true</dt>
<dd>
<p>Convert CRLF and CR to LF.</p>
</dd><dt>:crlf_newline =&gt; true</dt>
<dd>
<p>Convert LF to CRLF.</p>
</dd><dt>:cr_newline =&gt; true</dt>
<dd>
<p>Convert LF to CR.</p>
</dd><dt>:lf_newline =&gt; true</dt>
<dd>
<p>Convert CRLF and CR to LF (when writing).</p>
</dd><dt>:xml =&gt; :text</dt>
<dd>
<p>Escape as XML CharData. This form can be used as an HTML 4.0 #PCDATA.</p>
<ul><li>
<p>‘&amp;’ -&gt; ‘&amp;amp;’</p>
</li><li>
<p>‘&lt;’ -&gt; ‘&amp;lt;’</p>
</li><li>
<p>‘&gt;’ -&gt; ‘&amp;gt;’</p>
</li><li>
<p>undefined characters in destination_encoding -&gt; hexadecimal CharRef such as &amp;#xHH;</p>
</li></ul>
</dd><dt>:xml =&gt; :attr</dt>
<dd>
<p>Escape as XML AttValue. The converted result is quoted as “…”. This form can be used as an HTML 4.0 attribute value.</p>
<ul><li>
<p>‘&amp;’ -&gt; ‘&amp;amp;’</p>
</li><li>
<p>‘&lt;’ -&gt; ‘&amp;lt;’</p>
</li><li>
<p>‘&gt;’ -&gt; ‘&amp;gt;’</p>
</li><li>
<p>‘“’ -&gt; ‘&amp;quot;’</p>
</li><li>
<p>undefined characters in destination_encoding -&gt; hexadecimal CharRef such as &amp;#xHH;</p>
</li></ul>
</dd></dl>

<p>Examples:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># UTF-16BE to UTF-8
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>)

<span class='comment'># Usually, decorators such as newline conversion are inserted last.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_universal_newline'>universal_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convpath'><a href="#convpath-instance_method" title="Encoding::Converter#convpath (method)">convpath</a></span> <span class='comment'>#=&gt; [[#&lt;Encoding:UTF-16BE&gt;, #&lt;Encoding:UTF-8&gt;],
</span>              <span class='comment'>#    &quot;universal_newline&quot;]
</span>
<span class='comment'># But, if the last encoding is ASCII incompatible,
</span><span class='comment'># decorators are inserted before the last conversion.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'>new</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_crlf_newline'>crlf_newline</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convpath'><a href="#convpath-instance_method" title="Encoding::Converter#convpath (method)">convpath</a></span> <span class='comment'>#=&gt; [&quot;crlf_newline&quot;,
</span>              <span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:UTF-16BE&gt;]]
</span>
<span class='comment'># Conversion path can be specified directly.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'>new</span>([<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>universal_newline</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>]<span class='comma'>,</span> [<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span>]])
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convpath'><a href="#convpath-instance_method" title="Encoding::Converter#convpath (method)">convpath</a></span> <span class='comment'>#=&gt; [&quot;universal_newline&quot;,
</span>              <span class='comment'>#    [#&lt;Encoding:EUC-JP&gt;, #&lt;Encoding:UTF-8&gt;],
</span>              <span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:UTF-16BE&gt;]]</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3495-L3542'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3495' data-end='3542'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3495</span></pre>
<pre class='code cpp'>

static VALUE
econv_init(int argc, VALUE *argv, VALUE self)
{
    VALUE ecopts;
    VALUE snamev, dnamev;
    const char *sname, *dname;
    rb_encoding *senc, *denc;
    rb_econv_t *ec;
    int ecflags;
    VALUE convpath;

    if (rb_check_typeddata(self, &amp;econv_data_type)) {
        rb_raise(rb_eTypeError, &quot;already initialized&quot;);
    }

    if (argc == 1 &amp;&amp; !NIL_P(convpath = rb_check_array_type(argv[0]))) {
        ec = rb_econv_init_by_convpath(self, convpath, &amp;sname, &amp;dname, &amp;senc, &amp;denc);
        ecflags = 0;
        ecopts = Qnil;
    }
    else {
        econv_args(argc, argv, &amp;snamev, &amp;dnamev, &amp;sname, &amp;dname, &amp;senc, &amp;denc, &amp;ecflags, &amp;ecopts);
        ec = rb_econv_open_opts(sname, dname, ecflags, ecopts);
    }

    if (!ec) {
        VALUE exc = rb_econv_open_exc(sname, dname, ecflags);
        RB_GC_GUARD(snamev);
        RB_GC_GUARD(dnamev);
        rb_exc_raise(exc);
    }

    if (!DECORATOR_P(sname, dname)) {
        if (!senc)
            senc = make_dummy_encoding(sname);
        if (!denc)
            denc = make_dummy_encoding(dname);
        RB_GC_GUARD(snamev);
        RB_GC_GUARD(dnamev);
    }

    ec-&gt;source_encoding = senc;
    ec-&gt;destination_encoding = denc;

    DATA_PTR(self) = ec;

    return self;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="asciicompat_encoding-class_method">
  <h3 class='signature  first'>
    <div class='inline-block'>
      <span class='overload'>.<strong>asciicompat_encoding</strong>(string)  &#x21d2; <a href="../Encoding.html" title="Encoding (class)">Encoding</a><sup>?</sup> </span>
      <span class='overload'>.<strong>asciicompat_encoding</strong>(encoding)  &#x21d2; <a href="../Encoding.html" title="Encoding (class)">Encoding</a><sup>?</sup> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the corresponding ASCII compatible encoding.</p>

<p>Returns nil if the argument is an ASCII compatible encoding.</p>

<p>“corresponding ASCII compatible encoding” is an ASCII compatible encoding which can represents exactly the same characters as the given ASCII incompatible encoding. So, no conversion undefined error occurs when converting between the two encodings.</p>

<pre class="code ruby"><code class="ruby"><span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-2022-JP</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'>#=&gt; #&lt;Encoding:stateless-ISO-2022-JP&gt;
</span><span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'>#=&gt; #&lt;Encoding:UTF-8&gt;
</span><span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_asciicompat_encoding'>asciicompat_encoding</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'>#=&gt; nil</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3080-L3094'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3080' data-end='3094'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3080</span></pre>
<pre class='code cpp'>

static VALUE
econv_s_asciicompat_encoding(VALUE klass, VALUE arg)
{
    const char *arg_name, *result_name;
    rb_encoding *arg_enc, *result_enc;
    VALUE enc = Qnil;

    enc_arg(&amp;arg, &amp;arg_name, &amp;arg_enc);
    result_name = rb_econv_asciicompat_encoding(arg_name);
    if (result_name) {
        result_enc = make_encoding(result_name);
        enc = rb_enc_from_encoding(result_enc);
    }
    return enc;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="search_convpath-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>search_convpath</strong>(source_encoding, destination_encoding)  &#x21d2; <a href="../Array.html" title="Array (class)">Array</a> </span>
      <span class='overload'>.<strong>search_convpath</strong>(source_encoding, destination_encoding, opt)  &#x21d2; <a href="../Array.html" title="Array (class)">Array</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns a conversion path.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_search_convpath'>search_convpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'>#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, #&lt;Encoding:UTF-8&gt;],
</span><span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:EUC-JP&gt;]]
</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_search_convpath'>search_convpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>universal_newline:</span> <span class='kw'>true</span>)
<span class='kw'>or</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_search_convpath'>search_convpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>newline:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_universal'>universal</span>)
<span class='comment'>#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, #&lt;Encoding:UTF-8&gt;],
</span><span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:EUC-JP&gt;],
</span><span class='comment'>#    &quot;universal_newline&quot;]
</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_search_convpath'>search_convpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-32BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>universal_newline:</span> <span class='kw'>true</span>)
<span class='kw'>or</span>
<span class='id identifier rubyid_p'>p</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_search_convpath'>search_convpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-32BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>newline:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_universal'>universal</span>)
<span class='comment'>#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, #&lt;Encoding:UTF-8&gt;],
</span><span class='comment'>#    &quot;universal_newline&quot;,
</span><span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:UTF-32BE&gt;]]</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3241-L3271'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3241' data-end='3271'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3241</span></pre>
<pre class='code cpp'>

static VALUE
econv_s_search_convpath(int argc, VALUE *argv, VALUE klass)
{
    VALUE snamev, dnamev;
    const char *sname, *dname;
    rb_encoding *senc, *denc;
    int ecflags;
    VALUE ecopts;
    VALUE convpath;

    econv_args(argc, argv, &amp;snamev, &amp;dnamev, &amp;sname, &amp;dname, &amp;senc, &amp;denc, &amp;ecflags, &amp;ecopts);

    convpath = Qnil;
    transcode_search_path(sname, dname, search_convpath_i, &amp;convpath);

    if (NIL_P(convpath)) {
        VALUE exc = rb_econv_open_exc(sname, dname, ecflags);
        RB_GC_GUARD(snamev);
        RB_GC_GUARD(dnamev);
        rb_exc_raise(exc);
    }

    if (decorate_convpath(convpath, ecflags) == -1) {
        VALUE exc = rb_econv_open_exc(sname, dname, ecflags);
        RB_GC_GUARD(snamev);
        RB_GC_GUARD(dnamev);
        rb_exc_raise(exc);
    }

    return convpath;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="replacement-instance_method">
  <h3 class='signature rw first'>
    #<strong>replacement</strong>  &#x21d2; <a href="../String.html" title="String (class)">String</a>  <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the replacement string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>euc-jp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>us-ascii</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_replacement'>replacement</span>    <span class='comment'>#=&gt; &quot;?&quot;
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>euc-jp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_replacement'>replacement</span>    <span class='comment'>#=&gt; &quot;\uFFFD&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4289-L4303'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4289' data-end='4303'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4289</span></pre>
<pre class='code cpp'>

static VALUE
econv_get_replacement(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    int ret;
    rb_encoding *enc;

    ret = make_replacement(ec);
    if (ret == -1) {
        rb_raise(rb_eUndefinedConversionError, &quot;replacement character setup failed&quot;);
    }

    enc = rb_enc_find(ec-&gt;replacement_enc);
    return rb_enc_str_new((const char *)ec-&gt;replacement_str, (long)ec-&gt;replacement_len, enc);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="replacement=-instance_method">
  <h3 class='signature rw'>
    #<strong>replacement=</strong>(string)   <span class="extras">(<span class='rw'>rw</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sets the replacement string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>us-ascii</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='kw'>undef</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_replace'>replace</span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_replacement'><a href="#replacement-instance_method" title="Encoding::Converter#replacement (method)">replacement</a></span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;undef&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'><a href="#convert-instance_method" title="Encoding::Converter#convert (method)">convert</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a \u3042 b</span><span class='tstring_end'>&quot;</span></span>)      <span class='comment'>#=&gt; &quot;a &lt;undef&gt; b&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4315-L4337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4315' data-end='4337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4315</span></pre>
<pre class='code cpp'>

static VALUE
econv_set_replacement(VALUE self, VALUE arg)
{
    rb_econv_t *ec = check_econv(self);
    VALUE string = arg;
    int ret;
    rb_encoding *enc;

    StringValue(string);
    enc = rb_enc_get(string);

    ret = rb_econv_set_replacement(ec,
            (const unsigned char *)RSTRING_PTR(string),
            RSTRING_LEN(string),
            rb_enc_name(enc));

    if (ret == -1) {
        /* xxx: rb_eInvalidByteSequenceError? */
        rb_raise(rb_eUndefinedConversionError, &quot;replacement character setup failed&quot;);
    }

    return arg;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="==-instance_method">
  <h3 class='signature  first'>
    #<strong>==</strong>(other)  &#x21d2; <code>Boolean</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3666-L3699'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3666' data-end='3699'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3666</span></pre>
<pre class='code cpp'>

static VALUE
econv_equal(VALUE self, VALUE other)
{
    rb_econv_t *ec1 = check_econv(self);
    rb_econv_t *ec2;
    int i;

    if (!rb_typeddata_is_kind_of(other, &amp;econv_data_type)) {
        return Qnil;
    }
    ec2 = DATA_PTR(other);
    if (!ec2) return Qfalse;
    if (ec1-&gt;source_encoding_name != ec2-&gt;source_encoding_name &amp;&amp;
        strcmp(ec1-&gt;source_encoding_name, ec2-&gt;source_encoding_name))
        return Qfalse;
    if (ec1-&gt;destination_encoding_name != ec2-&gt;destination_encoding_name &amp;&amp;
        strcmp(ec1-&gt;destination_encoding_name, ec2-&gt;destination_encoding_name))
        return Qfalse;
    if (ec1-&gt;flags != ec2-&gt;flags) return Qfalse;
    if (ec1-&gt;replacement_enc != ec2-&gt;replacement_enc &amp;&amp;
        strcmp(ec1-&gt;replacement_enc, ec2-&gt;replacement_enc))
        return Qfalse;
    if (ec1-&gt;replacement_len != ec2-&gt;replacement_len) return Qfalse;
    if (ec1-&gt;replacement_str != ec2-&gt;replacement_str &amp;&amp;
        memcmp(ec1-&gt;replacement_str, ec2-&gt;replacement_str, ec2-&gt;replacement_len))
        return Qfalse;

    if (ec1-&gt;num_trans != ec2-&gt;num_trans) return Qfalse;
    for (i = 0; i &lt; ec1-&gt;num_trans; i++) {
        if (ec1-&gt;elems[i].tc-&gt;transcoder != ec2-&gt;elems[i].tc-&gt;transcoder)
            return Qfalse;
    }
    return Qtrue;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="convert-instance_method">
  <h3 class='signature '>
    #<strong>convert</strong>(source_string)  &#x21d2; <code>destination_string</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Convert source_string and return destination_string.</p>

<p>source_string is assumed as a part of source. i.e.  :partial_input=&gt;true is specified internally. finish method should be used last.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>euc-jp</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'>convert</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u3042</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_dump'>dump</span>     <span class='comment'>#=&gt; &quot;\xA4\xA2&quot;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_finish'><a href="#finish-instance_method" title="Encoding::Converter#finish (method)">finish</a></span>.<span class='id identifier rubyid_dump'>dump</span>                <span class='comment'>#=&gt; &quot;&quot;
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>euc-jp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'>convert</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xA4</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;&quot;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'>convert</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xA2</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;\xE3\x81\x82&quot;
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_finish'><a href="#finish-instance_method" title="Encoding::Converter#finish (method)">finish</a></span>.<span class='id identifier rubyid_dump'>dump</span>                <span class='comment'>#=&gt; &quot;&quot;
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-2022-jp</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'>convert</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xE3</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'>convert</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x81</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'>convert</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x82</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_dump'>dump</span>       <span class='comment'>#=&gt; &quot;\e$B$\&quot;&quot;.force_encoding(&quot;ISO-2022-JP&quot;)
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_finish'><a href="#finish-instance_method" title="Encoding::Converter#finish (method)">finish</a></span>.<span class='id identifier rubyid_dump'>dump</span>                <span class='comment'>#=&gt; &quot;\e(B&quot;.force_encoding(&quot;ISO-2022-JP&quot;)</span></code></pre>

<p>If a conversion error occur, <a href="UndefinedConversionError.html" title="Encoding::UndefinedConversionError (class)"><code>UndefinedConversionError</code></a> or <a href="InvalidByteSequenceError.html" title="Encoding::InvalidByteSequenceError (class)"><code>InvalidByteSequenceError</code></a> is raised. <code>convert</code> doesn’t supply methods to recover or restart from these exceptions. When you want to handle these conversion errors, use <a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">#primitive_convert</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3956-L3993'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3956' data-end='3993'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3956</span></pre>
<pre class='code cpp'>

static VALUE
econv_convert(VALUE self, VALUE source_string)
{
    VALUE ret, dst;
    VALUE av[5];
    int ac;
    rb_econv_t *ec = check_econv(self);

    StringValue(source_string);

    dst = rb_str_new(NULL, 0);

    av[0] = rb_str_dup(source_string);
    av[1] = dst;
    av[2] = Qnil;
    av[3] = Qnil;
    av[4] = INT2NUM(ECONV_PARTIAL_INPUT);
    ac = 5;

    ret = econv_primitive_convert(ac, av, self);

    if (ret == sym_invalid_byte_sequence ||
        ret == sym_undefined_conversion ||
        ret == sym_incomplete_input) {
        VALUE exc = make_econv_exception(ec);
        rb_exc_raise(exc);
    }

    if (ret == sym_finished) {
        rb_raise(rb_eArgError, &quot;converter already finished&quot;);
    }

    if (ret != sym_source_buffer_empty) {
        rb_bug(&quot;unexpected result of econv_primitive_convert&quot;);
    }

    return dst;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="convpath-instance_method">
  <h3 class='signature '>
    #<strong>convpath</strong>  &#x21d2; <a href="../Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the conversion path of ec.</p>

<p>The result is an array of conversions.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>crlf_newline:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convpath'>convpath</span>
<span class='comment'>#=&gt; [[#&lt;Encoding:ISO-8859-1&gt;, #&lt;Encoding:UTF-8&gt;],
</span><span class='comment'>#    [#&lt;Encoding:UTF-8&gt;, #&lt;Encoding:EUC-JP&gt;],
</span><span class='comment'>#    &quot;crlf_newline&quot;]</span></code></pre>

<p>Each element of the array is a pair of encodings or a string. A pair means an encoding conversion. A string means a decorator.</p>

<p>In the above example, [#&lt;Encoding:ISO-8859-1&gt;, <code>#<</code>Encoding:UTF-8&gt;] means a converter from ISO-8859-1 to UTF-8. “crlf_newline” means newline converter from LF to CRLF.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3642-L3660'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3642' data-end='3660'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3642</span></pre>
<pre class='code cpp'>

static VALUE
econv_convpath(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    VALUE result;
    int i;

    result = rb_ary_new();
    for (i = 0; i &lt; ec-&gt;num_trans; i++) {
        const rb_transcoder *tr = ec-&gt;elems[i].tc-&gt;transcoder;
        VALUE v;
        if (DECORATOR_P(tr-&gt;src_encoding, tr-&gt;dst_encoding))
            v = rb_str_new_cstr(tr-&gt;dst_encoding);
        else
            v = rb_assoc_new(make_encobj(tr-&gt;src_encoding), make_encobj(tr-&gt;dst_encoding));
        rb_ary_push(result, v);
    }
    return result;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="destination_encoding-instance_method">
  <h3 class='signature '>
    #<strong>destination_encoding</strong>  &#x21d2; <a href="../Encoding.html" title="Encoding (class)">Encoding</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the destination encoding as an <a href="../Encoding.html" title="Encoding (class)"><code>::Encoding</code></a> object.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3613-L3618'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3613' data-end='3618'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3613</span></pre>
<pre class='code cpp'>

static VALUE
econv_destination_encoding(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    return econv_get_encoding(ec-&gt;destination_encoding);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="finish-instance_method">
  <h3 class='signature '>
    #<strong>finish</strong>  &#x21d2; <a href="../String.html" title="String (class)">String</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Finishes the converter. It returns the last part of the converted string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-2022-jp</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_convert'><a href="#convert-instance_method" title="Encoding::Converter#convert (method)">convert</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u3042</span><span class='tstring_end'>&quot;</span></span>)     <span class='comment'>#=&gt; &quot;\e$B$\&quot;&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_finish'>finish</span>                <span class='comment'>#=&gt; &quot;\e(B&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4006-L4037'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4006' data-end='4037'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4006</span></pre>
<pre class='code cpp'>

static VALUE
econv_finish(VALUE self)
{
    VALUE ret, dst;
    VALUE av[5];
    int ac;
    rb_econv_t *ec = check_econv(self);

    dst = rb_str_new(NULL, 0);

    av[0] = Qnil;
    av[1] = dst;
    av[2] = Qnil;
    av[3] = Qnil;
    av[4] = INT2FIX(0);
    ac = 5;

    ret = econv_primitive_convert(ac, av, self);

    if (ret == sym_invalid_byte_sequence ||
        ret == sym_undefined_conversion ||
        ret == sym_incomplete_input) {
        VALUE exc = make_econv_exception(ec);
        rb_exc_raise(exc);
    }

    if (ret != sym_finished) {
        rb_bug(&quot;unexpected result of econv_primitive_convert&quot;);
    }

    return dst;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="insert_output-instance_method">
  <h3 class='signature '>
    #<strong>insert_output</strong>(string)  &#x21d2; <code>nil</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Inserts string into the encoding converter. The string will be converted to the destination encoding and output on later conversions.</p>

<p>If the destination encoding is stateful, string is converted according to the state and the state is updated.</p>

<p>This method should be used only when a conversion error occurs.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-8859-1</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_src'>src</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HIRAGANA LETTER A is \u{3042}.</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>)    <span class='comment'>#=&gt; :undefined_conversion
</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>   <span class='comment'>#=&gt; [&quot;HIRAGANA LETTER A is &quot;, &quot;.&quot;]
</span><span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_insert_output'>insert_output</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;err&gt;</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>)    <span class='comment'>#=&gt; :finished
</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>   <span class='comment'>#=&gt; [&quot;HIRAGANA LETTER A is &lt;err&gt;.&quot;, &quot;&quot;]
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-2022-jp</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_src'>src</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\u{306F 3041 3068 2661 3002}</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># U+2661 is not representable in iso-2022-jp
</span><span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>)    <span class='comment'>#=&gt; :undefined_conversion
</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>   <span class='comment'>#=&gt; [&quot;\e$B$O$!$H&quot;.force_encoding(&quot;ISO-2022-JP&quot;), &quot;\xE3\x80\x82&quot;]
</span><span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_insert_output'>insert_output</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span>                <span class='comment'># state change required to output &quot;?&quot;.
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>)    <span class='comment'>#=&gt; :finished
</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dst'>dst</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_src'>src</span>.<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>   <span class='comment'>#=&gt; [&quot;\e$B$O$!$H\e(B?\e$B!#\e(B&quot;.force_encoding(&quot;ISO-2022-JP&quot;), &quot;&quot;]</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4172-L4191'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4172' data-end='4191'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4172</span></pre>
<pre class='code cpp'>

static VALUE
econv_insert_output(VALUE self, VALUE string)
{
    const char *insert_enc;

    int ret;

    rb_econv_t *ec = check_econv(self);

    StringValue(string);
    insert_enc = rb_econv_encoding_to_insert_output(ec);
    string = rb_str_encode(string, rb_enc_from_encoding(rb_enc_find(insert_enc)), 0, Qnil);

    ret = rb_econv_insert_output(ec, (const unsigned char *)RSTRING_PTR(string), RSTRING_LEN(string), insert_enc);
    if (ret == -1) {
        rb_raise(rb_eArgError, &quot;too big string&quot;);
    }

    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="last_error-instance_method">
  <h3 class='signature '>
    #<strong>last_error</strong>  &#x21d2; <a href="../Exception.html" title="Exception (class)">Exception</a><sup>?</sup>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns an exception object for the last conversion. Returns nil if the last conversion did not produce an error.</p>

<p>“error” means that <a href="InvalidByteSequenceError.html" title="Encoding::InvalidByteSequenceError (class)"><code>InvalidByteSequenceError</code></a> and <a href="UndefinedConversionError.html" title="Encoding::UndefinedConversionError (class)"><code>UndefinedConversionError</code></a> for <a href="#convert-instance_method" title="Encoding::Converter#convert (method)">#convert</a> and <code>:invalid_byte_sequence</code>, <code>:incomplete_input</code> and <code>:undefined_conversion</code> for <a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">#primitive_convert</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-8859-1</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xf1abcd</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>)       <span class='comment'>#=&gt; :invalid_byte_sequence
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_last_error'>last_error</span>      <span class='comment'>#=&gt; #&lt;Encoding::InvalidByteSequenceError: &quot;\xF1&quot; followed by &quot;a&quot; on UTF-8&gt;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span>)             <span class='comment'>#=&gt; :destination_buffer_full
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_last_error'>last_error</span>      <span class='comment'>#=&gt; nil</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4265-L4275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4265' data-end='4275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4265</span></pre>
<pre class='code cpp'>

static VALUE
econv_last_error(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    VALUE exc;

    exc = make_econv_exception(ec);
    if (NIL_P(exc))
        return Qnil;
    return exc;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="primitive_convert-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer)  &#x21d2; <a href="../Symbol.html" title="Symbol (class)">Symbol</a> </span>
      <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer, destination_byteoffset)  &#x21d2; <a href="../Symbol.html" title="Symbol (class)">Symbol</a> </span>
      <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer, destination_byteoffset, destination_bytesize)  &#x21d2; <a href="../Symbol.html" title="Symbol (class)">Symbol</a> </span>
      <span class='overload'>#<strong>primitive_convert</strong>(source_buffer, destination_buffer, destination_byteoffset, destination_bytesize, opt)  &#x21d2; <a href="../Symbol.html" title="Symbol (class)">Symbol</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>possible opt elements:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_hash'>hash</span> <span class='label'>form:</span>
  <span class='symbeg'>:</span><span class='id identifier rubyid_partial_input'>partial_input</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>           <span class='comment'># source buffer may be part of larger source
</span>  <span class='symbeg'>:</span><span class='id identifier rubyid_after_output'>after_output</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>            <span class='comment'># stop conversion after output before input
</span><span class='id identifier rubyid_integer'>integer</span> <span class='label'>form:</span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#PARTIAL_INPUT-constant" title="Encoding::Converter::PARTIAL_INPUT (constant)">PARTIAL_INPUT</a></span>
  <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#AFTER_OUTPUT-constant" title="Encoding::Converter::AFTER_OUTPUT (constant)">AFTER_OUTPUT</a></span></code></pre>

<p>possible results:</p>

<pre class="code ruby"><code class="ruby"><span class='symbeg'>:</span><span class='id identifier rubyid_invalid_byte_sequence'>invalid_byte_sequence</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_incomplete_input'>incomplete_input</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_undefined_conversion'>undefined_conversion</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_after_output'>after_output</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_destination_buffer_full'>destination_buffer_full</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_source_buffer_empty'>source_buffer_empty</span>
<span class='symbeg'>:</span><span class='id identifier rubyid_finished'>finished</span></code></pre>

<p>primitive_convert converts source_buffer into destination_buffer.</p>

<p>source_buffer should be a string or nil. nil means an empty string.</p>

<p>destination_buffer should be a string.</p>

<p>destination_byteoffset should be an integer or nil. nil means the end of destination_buffer. If it is omitted, nil is assumed.</p>

<p>destination_bytesize should be an integer or nil. nil means unlimited. If it is omitted, nil is assumed.</p>

<p>opt should be nil, a hash or an integer. nil means no flags. If it is omitted, nil is assumed.</p>

<p>primitive_convert converts the content of source_buffer from beginning and store the result into destination_buffer.</p>

<p>destination_byteoffset and destination_bytesize specify the region which the converted result is stored. destination_byteoffset specifies the start position in destination_buffer in bytes. If destination_byteoffset is nil, destination_buffer.bytesize is used for appending the result. destination_bytesize specifies maximum number of bytes. If destination_bytesize is nil, destination size is unlimited. After conversion, destination_buffer is resized to destination_byteoffset + actually produced number of bytes. Also destination_buffer’s encoding is set to destination_encoding.</p>

<p>primitive_convert drops the converted part of source_buffer. the dropped part is converted in destination_buffer or buffered in <code>Converter</code> object.</p>

<p>primitive_convert stops conversion when one of following condition met.</p>
<ul><li>
<p>invalid byte sequence found in source buffer (:invalid_byte_sequence) <a href="#primitive_errinfo-instance_method" title="Encoding::Converter#primitive_errinfo (method)">#primitive_errinfo</a> and <a href="#last_error-instance_method" title="Encoding::Converter#last_error (method)">#last_error</a> methods returns the detail of the error.</p>
</li><li>
<p>unexpected end of source buffer (:incomplete_input) this occur only when :partial_input is not specified. <a href="#primitive_errinfo-instance_method" title="Encoding::Converter#primitive_errinfo (method)">#primitive_errinfo</a> and <a href="#last_error-instance_method" title="Encoding::Converter#last_error (method)">#last_error</a> methods returns the detail of the error.</p>
</li><li>
<p>character not representable in output encoding (:undefined_conversion) <a href="#primitive_errinfo-instance_method" title="Encoding::Converter#primitive_errinfo (method)">#primitive_errinfo</a> and <a href="#last_error-instance_method" title="Encoding::Converter#last_error (method)">#last_error</a> methods returns the detail of the error.</p>
</li><li>
<p>after some output is generated, before input is done (:after_output) this occur only when :after_output is specified.</p>
</li><li>
<p>destination buffer is full (:destination_buffer_full) this occur only when destination_bytesize is non-nil.</p>
</li><li>
<p>source buffer is empty (:source_buffer_empty) this occur only when :partial_input is specified.</p>
</li><li>
<p>conversion is finished (:finished)</p>
</li></ul>

<p>example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'>primitive_convert</span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>100</span>)
<span class='id identifier rubyid_p'>p</span> [<span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>] <span class='comment'>#=&gt; [:finished, &quot;&quot;, &quot;\x00p\x00i&quot;]
</span>
<span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'>primitive_convert</span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span>)
<span class='id identifier rubyid_p'>p</span> [<span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>] <span class='comment'>#=&gt; [:destination_buffer_full, &quot;i&quot;, &quot;\x00&quot;]
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'>primitive_convert</span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span>)
<span class='id identifier rubyid_p'>p</span> [<span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>] <span class='comment'>#=&gt; [:destination_buffer_full, &quot;&quot;, &quot;p&quot;]
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'>primitive_convert</span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span>)
<span class='id identifier rubyid_p'>p</span> [<span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>] <span class='comment'>#=&gt; [:destination_buffer_full, &quot;&quot;, &quot;\x00&quot;]
</span><span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'>primitive_convert</span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>1</span>)
<span class='id identifier rubyid_p'>p</span> [<span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>] <span class='comment'>#=&gt; [:finished, &quot;&quot;, &quot;i&quot;]</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3810-L3920'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3810' data-end='3920'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3810</span></pre>
<pre class='code cpp'>

static VALUE
econv_primitive_convert(int argc, VALUE *argv, VALUE self)
{
    VALUE input, output, output_byteoffset_v, output_bytesize_v, opt, flags_v;
    rb_econv_t *ec = check_econv(self);
    rb_econv_result_t res;
    const unsigned char *ip, *is;
    unsigned char *op, *os;
    long output_byteoffset, output_bytesize;
    unsigned long output_byteend;
    int flags;

    argc = rb_scan_args(argc, argv, &quot;23:&quot;, &amp;input, &amp;output, &amp;output_byteoffset_v, &amp;output_bytesize_v, &amp;flags_v, &amp;opt);

    if (NIL_P(output_byteoffset_v))
        output_byteoffset = 0; /* dummy */
    else
        output_byteoffset = NUM2LONG(output_byteoffset_v);

    if (NIL_P(output_bytesize_v))
        output_bytesize = 0; /* dummy */
    else
        output_bytesize = NUM2LONG(output_bytesize_v);

    if (!NIL_P(flags_v)) {
        if (!NIL_P(opt)) {
            rb_error_arity(argc + 1, 2, 5);
        }
        flags = NUM2INT(rb_to_int(flags_v));
    }
    else if (!NIL_P(opt)) {
        VALUE v;
        flags = 0;
        v = rb_hash_aref(opt, sym_partial_input);
        if (RTEST(v))
            flags |= ECONV_PARTIAL_INPUT;
        v = rb_hash_aref(opt, sym_after_output);
        if (RTEST(v))
            flags |= ECONV_AFTER_OUTPUT;
    }
    else {
        flags = 0;
    }

    StringValue(output);
    if (!NIL_P(input))
        StringValue(input);
    rb_str_modify(output);

    if (NIL_P(output_bytesize_v)) {
        output_bytesize = rb_str_capacity(output);

        if (!NIL_P(input) &amp;&amp; output_bytesize &lt; RSTRING_LEN(input))
            output_bytesize = RSTRING_LEN(input);
    }

  retry:

    if (NIL_P(output_byteoffset_v))
        output_byteoffset = RSTRING_LEN(output);

    if (output_byteoffset &lt; 0)
        rb_raise(rb_eArgError, &quot;negative output_byteoffset&quot;);

    if (RSTRING_LEN(output) &lt; output_byteoffset)
        rb_raise(rb_eArgError, &quot;output_byteoffset too big&quot;);

    if (output_bytesize &lt; 0)
        rb_raise(rb_eArgError, &quot;negative output_bytesize&quot;);

    output_byteend = (unsigned long)output_byteoffset +
                     (unsigned long)output_bytesize;

    if (output_byteend &lt; (unsigned long)output_byteoffset ||
        LONG_MAX &lt; output_byteend)
        rb_raise(rb_eArgError, &quot;output_byteoffset+output_bytesize too big&quot;);

    if (rb_str_capacity(output) &lt; output_byteend)
        rb_str_resize(output, output_byteend);

    if (NIL_P(input)) {
        ip = is = NULL;
    }
    else {
        ip = (const unsigned char *)RSTRING_PTR(input);
        is = ip + RSTRING_LEN(input);
    }

    op = (unsigned char *)RSTRING_PTR(output) + output_byteoffset;
    os = op + output_bytesize;

    res = rb_econv_convert(ec, &amp;ip, is, &amp;op, os, flags);
    rb_str_set_len(output, op-(unsigned char *)RSTRING_PTR(output));
    if (!NIL_P(input)) {
        rb_str_drop_bytes(input, ip - (unsigned char *)RSTRING_PTR(input));
    }

    if (NIL_P(output_bytesize_v) &amp;&amp; res == econv_destination_buffer_full) {
        if (LONG_MAX / 2 &lt; output_bytesize)
            rb_raise(rb_eArgError, &quot;too long conversion result&quot;);
        output_bytesize *= 2;
        output_byteoffset_v = Qnil;
        goto retry;
    }

    if (ec-&gt;destination_encoding) {
        rb_enc_associate(output, ec-&gt;destination_encoding);
    }

    return econv_result_to_symbol(res);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="primitive_errinfo-instance_method">
  <h3 class='signature '>
    #<strong>primitive_errinfo</strong>  &#x21d2; <a href="../Array.html" title="Array (class)">Array</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>primitive_errinfo returns important information regarding the last error as a 5-element array:</p>

<pre class="code ruby"><code class="ruby">[<span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_enc1'>enc1</span><span class='comma'>,</span> <span class='id identifier rubyid_enc2'>enc2</span><span class='comma'>,</span> <span class='id identifier rubyid_error_bytes'>error_bytes</span><span class='comma'>,</span> <span class='id identifier rubyid_readagain_bytes'>readagain_bytes</span>]</code></pre>

<p>result is the last result of primitive_convert.</p>

<p>Other elements are only meaningful when result is <code>:invalid_byte_sequence</code>, <code>:incomplete_input</code> or <code>:undefined_conversion</code>.</p>

<p>enc1 and enc2 indicate a conversion step as a pair of strings. For example, a converter from EUC-JP to ISO-8859-1 converts a string as follows: EUC-JP -&gt; UTF-8 -&gt; ISO-8859-1. So [enc1, enc2] is either [“EUC-JP”, “UTF-8”] or [“UTF-8”, “ISO-8859-1”].</p>

<p>error_bytes and readagain_bytes indicate the byte sequences which caused the error. error_bytes is discarded portion. readagain_bytes is buffered portion which is read again on next conversion.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># \xff is invalid as EUC-JP.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Shift_JIS</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xff</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;EUC-JP&quot;, &quot;Shift_JIS&quot;, &quot;\xFF&quot;, &quot;&quot;]
</span>
<span class='comment'># HIRAGANA LETTER A (\xa4\xa2 in EUC-JP) is not representable in ISO-8859-1.
</span><span class='comment'># Since this error is occur in UTF-8 to ISO-8859-1 conversion,
</span><span class='comment'># error_bytes is HIRAGANA LETTER A in UTF-8 (\xE3\x81\x82).
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xa4\xa2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:undefined_conversion, &quot;UTF-8&quot;, &quot;ISO-8859-1&quot;, &quot;\xE3\x81\x82&quot;, &quot;&quot;]
</span>
<span class='comment'># partial character is invalid
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xa4</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:incomplete_input, &quot;EUC-JP&quot;, &quot;UTF-8&quot;, &quot;\xA4&quot;, &quot;&quot;]
</span>
<span class='comment'># Encoding::Converter::PARTIAL_INPUT prevents invalid errors by
</span><span class='comment'># partial characters.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EUC-JP</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ISO-8859-1</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xa4</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span><span class='comma'>,</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span><span class='op'>::</span><span class='const'><a href="#PARTIAL_INPUT-constant" title="Encoding::Converter::PARTIAL_INPUT (constant)">PARTIAL_INPUT</a></span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:source_buffer_empty, nil, nil, nil, nil]
</span>
<span class='comment'># \xd8\x00\x00@ is invalid as UTF-16BE because
</span><span class='comment'># no low surrogate after high surrogate (\xd8\x00).
</span><span class='comment'># It is detected by 3rd byte (\00) which is part of next character.
</span><span class='comment'># So the high surrogate (\xd8\x00) is discarded and
</span><span class='comment'># the 3rd byte is read again later.
</span><span class='comment'># Since the byte is buffered in ec, it is dropped from src.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16BE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xd8\x00\x00@</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;UTF-16BE&quot;, &quot;UTF-8&quot;, &quot;\xD8\x00&quot;, &quot;\x00&quot;]
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_src'>src</span>
<span class='comment'>#=&gt; &quot;@&quot;
</span>
<span class='comment'># Similar to UTF-16BE, \x00\xd8@\x00 is invalid as UTF-16LE.
</span><span class='comment'># The problem is detected by 4th byte.
</span><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-16LE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00\xd8@\x00</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='int'>10</span>)
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'>primitive_errinfo</span>
<span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;UTF-16LE&quot;, &quot;UTF-8&quot;, &quot;\x00\xD8&quot;, &quot;@\x00&quot;]
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_src'>src</span>
<span class='comment'>#=&gt; &quot;&quot;</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4114-L4138'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4114' data-end='4138'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4114</span></pre>
<pre class='code cpp'>

static VALUE
econv_primitive_errinfo(VALUE self)
{
    rb_econv_t *ec = check_econv(self);

    VALUE ary;

    ary = rb_ary_new2(5);

    rb_ary_store(ary, 0, econv_result_to_symbol(ec-&gt;last_error.result));
    rb_ary_store(ary, 4, Qnil);

    if (ec-&gt;last_error.source_encoding)
        rb_ary_store(ary, 1, rb_str_new2(ec-&gt;last_error.source_encoding));

    if (ec-&gt;last_error.destination_encoding)
        rb_ary_store(ary, 2, rb_str_new2(ec-&gt;last_error.destination_encoding));

    if (ec-&gt;last_error.error_bytes_start) {
        rb_ary_store(ary, 3, rb_str_new((const char *)ec-&gt;last_error.error_bytes_start, ec-&gt;last_error.error_bytes_len));
        rb_ary_store(ary, 4, rb_str_new((const char *)ec-&gt;last_error.error_bytes_start + ec-&gt;last_error.error_bytes_len, ec-&gt;last_error.readagain_len));
    }

    return ary;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putback-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>putback</strong>  &#x21d2; <a href="../String.html" title="String (class)">String</a> </span>
      <span class='overload'>#<strong>putback</strong>(max_numbytes)  &#x21d2; <a href="../String.html" title="String (class)">String</a> </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Put back the bytes which will be converted.</p>

<p>The bytes are caused by invalid_byte_sequence error. When invalid_byte_sequence error, some bytes are discarded and some bytes are buffered to be converted later. The latter bytes can be put back. It can be observed by <a href="InvalidByteSequenceError.html#readagain_bytes-instance_method" title="Encoding::InvalidByteSequenceError#readagain_bytes (method)">InvalidByteSequenceError#readagain_bytes</a> and <a href="#primitive_errinfo-instance_method" title="Encoding::Converter#primitive_errinfo (method)">#primitive_errinfo</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ec'>ec</span> <span class='op'>=</span> <span class='const'><a href="../Encoding.html" title="Encoding (class)">Encoding</a></span><span class='op'>::</span><span class='const'>Converter</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Encoding::Converter.new (method)">new</a></span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>utf-16le</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iso-8859-1</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_src'>src</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00\xd8\x61\x00</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_convert'><a href="#primitive_convert-instance_method" title="Encoding::Converter#primitive_convert (method)">primitive_convert</a></span>(<span class='id identifier rubyid_src'>src</span><span class='comma'>,</span> <span class='id identifier rubyid_dst'>dst</span>)   <span class='comment'>#=&gt; :invalid_byte_sequence
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_primitive_errinfo'><a href="#primitive_errinfo-instance_method" title="Encoding::Converter#primitive_errinfo (method)">primitive_errinfo</a></span>     <span class='comment'>#=&gt; [:invalid_byte_sequence, &quot;UTF-16LE&quot;, &quot;UTF-8&quot;, &quot;\x00\xD8&quot;, &quot;a\x00&quot;]
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_putback'>putback</span>               <span class='comment'>#=&gt; &quot;a\x00&quot;
</span><span class='id identifier rubyid_p'>p</span> <span class='id identifier rubyid_ec'>ec</span>.<span class='id identifier rubyid_putback'>putback</span>               <span class='comment'>#=&gt; &quot;&quot;          # no more bytes to put back</span></code></pre>

  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L4217-L4243'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4217' data-end='4243'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 4217</span></pre>
<pre class='code cpp'>

static VALUE
econv_putback(int argc, VALUE *argv, VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    int n;
    int putbackable;
    VALUE str, max;

    if (!rb_check_arity(argc, 0, 1) || NIL_P(max = argv[0])) {
        n = rb_econv_putbackable(ec);
    }
    else {
        n = NUM2INT(max);
        putbackable = rb_econv_putbackable(ec);
        if (putbackable &lt; n)
            n = putbackable;
    }

    str = rb_str_new(NULL, n);
    rb_econv_putback(ec, (unsigned char *)RSTRING_PTR(str), n);

    if (ec-&gt;source_encoding) {
        rb_enc_associate(str, ec-&gt;source_encoding);
    }

    return str;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="source_encoding-instance_method">
  <h3 class='signature '>
    #<strong>source_encoding</strong>  &#x21d2; <a href="../Encoding.html" title="Encoding (class)">Encoding</a>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the source encoding as an <a href="../Encoding.html" title="Encoding (class)"><code>::Encoding</code></a> object.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_8/transcode.c#L3600-L3605'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3600' data-end='3605'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'transcode.c', line 3600</span></pre>
<pre class='code cpp'>

static VALUE
econv_source_encoding(VALUE self)
{
    rb_econv_t *ec = check_econv(self);
    return econv_get_encoding(ec-&gt;source_encoding);
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>