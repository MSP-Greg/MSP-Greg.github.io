<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Benchmark &mdash; benchmark  Ruby-3.4.8 p72</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Benchmark",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../.'>Ruby-3.4.8</a> &raquo; 
      <a href='.'>benchmark</a> &raquo; 
      <a href='_index.html#alpha_B'>Index (B)</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Benchmark&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Benchmark</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a class='nodoc' href="Benchmark/Job.html" title="Benchmark::Job (class)"><code>Job</code></a>,
        <a class='nodoc' href="Benchmark/Report.html" title="Benchmark::Report (class)"><code>Report</code></a>,
        <a href="Benchmark/Tms.html" title="Benchmark::Tms (class)"><code>Tms</code></a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L123'>lib/benchmark.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The Benchmark module provides methods to measure and report the time used to execute Ruby code.</p>
<ul><li>
<p>Measure the time to construct the string given by the expression <code>&quot;a&quot;*1_000_000_000</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_puts'>puts</span> <span class='const'>Benchmark</span>.<span class='id identifier rubyid_measure'><a href="#measure-class_method" title="Benchmark.measure (method)">measure</a></span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span><span class='op'>*</span><span class='int'>1_000_000_000</span> }</code></pre>

<p>On my machine (OSX 10.8.3 on i5 1.7 GHz) this generates:</p>

<pre class="code ruby"><code class="ruby"><span class='float'>0.350000</span>   <span class='float'>0.400000</span>   <span class='float'>0.750000</span> (  <span class='float'>0.835234</span>)</code></pre>

<p>This report shows the user CPU time, system CPU time, the total time (sum of user CPU time, system CPU time, children’s user CPU time, and children’s system CPU time), and the elapsed real time. The unit of time is seconds.</p>
</li><li>
<p>Do some experiments sequentially using the <a href="#bm-instance_method" title="Benchmark#bm (method)">#bm</a> method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'>Benchmark</span>.<span class='id identifier rubyid_bm'><a href="#bm-class_method" title="Benchmark.bm (method)">bm</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span> { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span> { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span> { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">    <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='float'>1.010000</span>   <span class='float'>0.000000</span>   <span class='float'>1.010000</span> (  <span class='float'>1.014479</span>)
<span class='float'>1.000000</span>   <span class='float'>0.000000</span>   <span class='float'>1.000000</span> (  <span class='float'>0.998261</span>)
<span class='float'>0.980000</span>   <span class='float'>0.000000</span>   <span class='float'>0.980000</span> (  <span class='float'>0.981335</span>)</code></pre>
</li><li>
<p>Continuing the previous example, put a label in each report:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'>Benchmark</span>.<span class='id identifier rubyid_bm'><a href="#bm-class_method" title="Benchmark.bm (method)">bm</a></span>(<span class='int'>7</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span>)   { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span>)  { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
<span class='kw'>end</span></code></pre>
</li></ul>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">              <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='kw'>for</span><span class='op'>:</span>      <span class='float'>1.010000</span>   <span class='float'>0.000000</span>   <span class='float'>1.010000</span> (  <span class='float'>1.015688</span>)
<span class='id identifier rubyid_times'>times</span><span class='op'>:</span>    <span class='float'>1.000000</span>   <span class='float'>0.000000</span>   <span class='float'>1.000000</span> (  <span class='float'>1.003611</span>)
<span class='id identifier rubyid_upto'>upto</span><span class='op'>:</span>     <span class='float'>1.030000</span>   <span class='float'>0.000000</span>   <span class='float'>1.030000</span> (  <span class='float'>1.028098</span>)</code></pre>
<ul><li>
<p>The times for some benchmarks depend on the order in which items are run.  These differences are due to the cost of memory allocation and garbage collection. To avoid these discrepancies, the #bmbm method is provided.  For example, to compare ways to sort an array of floats:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> (<span class='int'>1</span><span class='op'>..</span><span class='int'>1000000</span>).<span class='id identifier rubyid_map'>map</span> { <span class='id identifier rubyid_rand'>rand</span> }

<span class='const'>Benchmark</span>.<span class='id identifier rubyid_bmbm'><a href="#bmbm-class_method" title="Benchmark.bmbm (method)">bmbm</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort!</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_sort!'>sort!</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span>)  { <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_sort'>sort</span>  }
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rehearsal</span> <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
<span class='id identifier rubyid_sort!'>sort!</span>   <span class='float'>1.490000</span>   <span class='float'>0.010000</span>   <span class='float'>1.500000</span> (  <span class='float'>1.490520</span>)
<span class='id identifier rubyid_sort'>sort</span>    <span class='float'>1.460000</span>   <span class='float'>0.000000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.463025</span>)
<span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span> <span class='id identifier rubyid_total'>total</span><span class='op'>:</span> <span class='float'>2.960000</span><span class='id identifier rubyid_sec'>sec</span>

            <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='id identifier rubyid_sort!'>sort!</span>   <span class='float'>1.460000</span>   <span class='float'>0.000000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.460465</span>)
<span class='id identifier rubyid_sort'>sort</span>    <span class='float'>1.450000</span>   <span class='float'>0.010000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.448327</span>)</code></pre>
</li><li>
<p><a href="Benchmark/Report.html" title="Benchmark::Report (class)"><code>Report</code></a> statistics of sequential experiments with unique labels, using the #benchmark method:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'>Benchmark</span>         <span class='comment'># we need the CAPTION and FORMAT constants
</span>
<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'>Benchmark</span>.<span class='id identifier rubyid_benchmark'><a href="#benchmark-class_method" title="Benchmark.benchmark (method)">benchmark</a></span>(<span class='const'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='const'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;total:</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;avg:</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_tf'>tf</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span>)   { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_tt'>tt</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_tu'>tu</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span>)  { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  [<span class='id identifier rubyid_tftttu'>tftttu</span><span class='comma'>,</span> (<span class='id identifier rubyid_tftttu'>tftttu</span>)<span class='op'>/</span><span class='int'>3</span>]
<span class='kw'>end</span></code></pre>

<p>The result:</p>

<pre class="code ruby"><code class="ruby">             <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='kw'>for</span><span class='op'>:</span>      <span class='float'>0.950000</span>   <span class='float'>0.000000</span>   <span class='float'>0.950000</span> (  <span class='float'>0.952039</span>)
<span class='id identifier rubyid_times'>times</span><span class='op'>:</span>    <span class='float'>0.980000</span>   <span class='float'>0.000000</span>   <span class='float'>0.980000</span> (  <span class='float'>0.984938</span>)
<span class='id identifier rubyid_upto'>upto</span><span class='op'>:</span>     <span class='float'>0.950000</span>   <span class='float'>0.000000</span>   <span class='float'>0.950000</span> (  <span class='float'>0.946787</span>)
<span class='op'>&gt;</span><span class='id identifier rubyid_total'>total</span><span class='op'>:</span>   <span class='float'>2.880000</span>   <span class='float'>0.000000</span>   <span class='float'>2.880000</span> (  <span class='float'>2.883764</span>)
<span class='op'>&gt;</span><span class='id identifier rubyid_avg'>avg</span><span class='op'>:</span>     <span class='float'>0.960000</span>   <span class='float'>0.000000</span>   <span class='float'>0.960000</span> (  <span class='float'>0.961255</span>)</code></pre>
</li></ul>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='BENCHMARK_VERSION-constant' class='summary_signature nodoc'>BENCHMARK_VERSION =</span>
    <span class='nodoc note title'>Internal use only</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L127-L127'># File 'lib/benchmark.rb', line 127</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2002-04-25</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
  <li>
    <span id='CAPTION-constant' class='summary_signature'>CAPTION =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default caption string (heading above the output times).</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L604-L604'># File 'lib/benchmark.rb', line 604</a>    <pre class='code ruby'><span class='const'>Benchmark</span><span class='op'>::</span><span class='const'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span><span class='op'>::</span><span class='const'><a href="Benchmark/Tms.html#CAPTION-constant" title="Benchmark::Tms::CAPTION (constant)">CAPTION</a></span></pre>
  </li>
  <li>
    <span id='FORMAT-constant' class='summary_signature'>FORMAT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The default format string used to display times.  See also <a href="Benchmark/Tms.html#format-instance_method" title="Benchmark::Tms#format (method)">Tms#format</a>.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L607-L607'># File 'lib/benchmark.rb', line 607</a>    <pre class='code ruby'><span class='const'>Benchmark</span><span class='op'>::</span><span class='const'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span><span class='op'>::</span><span class='const'><a href="Benchmark/Tms.html#FORMAT-constant" title="Benchmark::Tms::FORMAT (constant)">FORMAT</a></span></pre>
  </li>
  <li>
    <span id='VERSION-constant' class='summary_signature'>VERSION =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L125-L125'># File 'lib/benchmark.rb', line 125</a>    <pre class='code ruby'><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.5.0</span><span class='tstring_end'>&quot;</span></span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature mf'>
      <a href="#benchmark-class_method" title=".benchmark (class method)">.<strong>benchmark</strong>(caption = &quot;&quot;, label_width = nil, format = nil, *labels)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Invokes the block with a <a href="Benchmark/Report.html" title="Benchmark::Report (class)"><code>Report</code></a> object, which may be used to collect and report on the results of individual benchmark tests.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#bm-class_method" title=".bm (class method)">.<strong>bm</strong>(label_width = 0, *labels, &amp;blk)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>A simple interface to the <a href="#benchmark-instance_method" title="Benchmark#benchmark (method)">#benchmark</a> method, <a href="#bm-instance_method" title="Benchmark#bm (method)">#bm</a> generates sequential reports with labels.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#bmbm-class_method" title=".bmbm (class method)">.<strong>bmbm</strong>(width = 0)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Sometimes benchmark results are skewed because code executed earlier encounters different garbage collection overheads than that run later.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#measure-class_method" title=".measure (class method)">.<strong>measure</strong>(label = &quot;&quot;)  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the time used to execute the given block as a <a href="Benchmark/Tms.html" title="Benchmark::Tms (class)"><code>Tms</code></a> object.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#ms-class_method" title=".ms (class method)">.<strong>ms</strong>  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the elapsed real time used to execute the given block.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature mf'>
      <a href="#realtime-class_method" title=".realtime (class method)">.<strong>realtime</strong>  </a>
    </span>
    <span class='mod_func note title'>mod_func</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the elapsed real time used to execute the given block.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="benchmark-class_method">
  <h3 class='signature private first'>
    .<strong>benchmark</strong>(caption = &quot;&quot;, label_width = nil, format = nil, *labels)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Invokes the block with a <a href="Benchmark/Report.html" title="Benchmark::Report (class)"><code>::Benchmark::Report</code></a> object, which may be used to collect and report on the results of individual benchmark tests. Reserves <code>label_width</code> leading spaces for labels on each line. Prints <code>caption</code> at the top of the report, and uses <code>format</code> to format each line. (Note: <code>caption</code> must contain a terminating newline character, see the default <a href="Benchmark/Tms.html#CAPTION-constant" title="Benchmark::Tms::CAPTION (constant)">Tms::CAPTION</a> for an example.)</p>

<p>Returns an array of <a href="Benchmark/Tms.html" title="Benchmark::Tms (class)"><code>::Benchmark::Tms</code></a> objects.</p>

<p>If the block returns an array of <a href="Benchmark/Tms.html" title="Benchmark::Tms (class)"><code>::Benchmark::Tms</code></a> objects, these will be used to format additional lines of output. If <code>labels</code> parameter are given, these are used to label these extra lines.</p>

<p><em>Note</em>: Other methods provide a simpler interface to this one, and are suitable for nearly all benchmarking requirements.  See the examples in <code>Benchmark</code>, and the <a href="#bm-instance_method" title="Benchmark#bm (method)">#bm</a> and <a href="#bmbm-instance_method" title="Benchmark#bmbm (method)">#bmbm</a> methods.</p>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_include'>include</span> <span class='const'>Benchmark</span>          <span class='comment'># we need the CAPTION and FORMAT constants
</span>
<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'>Benchmark</span>.<span class='id identifier rubyid_benchmark'>benchmark</span>(<span class='const'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='const'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;total:</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;avg:</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_tf'>tf</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span>)   { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_tt'>tt</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_tu'>tu</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span>)  { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  [<span class='id identifier rubyid_tftttu'>tftttu</span><span class='comma'>,</span> (<span class='id identifier rubyid_tftttu'>tftttu</span>)<span class='op'>/</span><span class='int'>3</span>]
<span class='kw'>end</span></code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby">              <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='kw'>for</span><span class='op'>:</span>      <span class='float'>0.970000</span>   <span class='float'>0.000000</span>   <span class='float'>0.970000</span> (  <span class='float'>0.970493</span>)
<span class='id identifier rubyid_times'>times</span><span class='op'>:</span>    <span class='float'>0.990000</span>   <span class='float'>0.000000</span>   <span class='float'>0.990000</span> (  <span class='float'>0.989542</span>)
<span class='id identifier rubyid_upto'>upto</span><span class='op'>:</span>     <span class='float'>0.970000</span>   <span class='float'>0.000000</span>   <span class='float'>0.970000</span> (  <span class='float'>0.972854</span>)
<span class='op'>&gt;</span><span class='id identifier rubyid_total'>total</span><span class='op'>:</span>   <span class='float'>2.930000</span>   <span class='float'>0.000000</span>   <span class='float'>2.930000</span> (  <span class='float'>2.932889</span>)
<span class='op'>&gt;</span><span class='id identifier rubyid_avg'>avg</span><span class='op'>:</span>     <span class='float'>0.976667</span>   <span class='float'>0.000000</span>   <span class='float'>0.976667</span> (  <span class='float'>0.977630</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L171-L192'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='171' data-end='192'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/benchmark.rb', line 171</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_benchmark'>benchmark</span>(<span class='id identifier rubyid_caption'>caption</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_labels'>labels</span>) <span class='comment'># :yield: report
</span>  <span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_sync'>sync</span>
  <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_format'>format</span> <span class='op'>||=</span> <span class='const'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span>
  <span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='const'><a href="Benchmark/Report.html" title="Benchmark::Report (class)">Report</a></span>.<span class='id identifier rubyid_new'><a href="Benchmark/Report.html#new-class_method" title="Benchmark::Report.new (method)">new</a></span>(<span class='id identifier rubyid_label_width'>label_width</span><span class='comma'>,</span> <span class='id identifier rubyid_format'>format</span>)
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='kw'>yield</span>(<span class='id identifier rubyid_report'>report</span>)

  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_width'>width</span> <span class='op'>+</span> <span class='id identifier rubyid_caption'>caption</span> <span class='kw'>unless</span> <span class='id identifier rubyid_caption'>caption</span>.<span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_list'>list</span>.<span class='id identifier rubyid_each'>each</span> { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_label'>label</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_ljust'>ljust</span>(<span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_width'>width</span>)
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_format'>format</span>(<span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_format'>format</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_format'>format</span>)
  }

  <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_results'>results</span> <span class='kw'>and</span> <span class='id identifier rubyid_results'>results</span>.<span class='id identifier rubyid_grep'>grep</span>(<span class='const'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span>).<span class='id identifier rubyid_each'>each</span> {<span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
    <span class='id identifier rubyid_print'>print</span>((<span class='id identifier rubyid_labels'>labels</span>.<span class='id identifier rubyid_shift'>shift</span> <span class='op'>||</span> <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_label'>label</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_ljust'>ljust</span>(<span class='id identifier rubyid_label_width'>label_width</span>)<span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span>.<span class='id identifier rubyid_format'>format</span>(<span class='id identifier rubyid_format'>format</span>))
  }
  <span class='id identifier rubyid_report'>report</span>.<span class='id identifier rubyid_list'>list</span>
<span class='kw'>ensure</span>
  <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='id identifier rubyid_sync'>sync</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sync'>sync</span>.<span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="bm-class_method">
  <h3 class='signature private'>
    .<strong>bm</strong>(label_width = 0, *labels, &amp;blk)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>A simple interface to the <a href="#benchmark-instance_method" title="Benchmark#benchmark (method)">#benchmark</a> method, <a href="#bm-instance_method" title="Benchmark#bm (method)">#bm</a> generates sequential reports with labels. <code>label_width</code> and <code>labels</code> parameters have the same meaning as for <a href="#benchmark-instance_method" title="Benchmark#benchmark (method)">#benchmark</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>5000000</span>
<span class='const'>Benchmark</span>.<span class='id identifier rubyid_bm'>bm</span>(<span class='int'>7</span>) <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>for:</span><span class='tstring_end'>&quot;</span></span>)   { <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_n'>n</span><span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>times:</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>   <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upto:</span><span class='tstring_end'>&quot;</span></span>)  { <span class='int'>1</span>.<span class='id identifier rubyid_upto'>upto</span>(<span class='id identifier rubyid_n'>n</span>) <span class='kw'>do</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='kw'>end</span> }
<span class='kw'>end</span></code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby">              <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='kw'>for</span><span class='op'>:</span>      <span class='float'>0.960000</span>   <span class='float'>0.000000</span>   <span class='float'>0.960000</span> (  <span class='float'>0.957966</span>)
<span class='id identifier rubyid_times'>times</span><span class='op'>:</span>    <span class='float'>0.960000</span>   <span class='float'>0.000000</span>   <span class='float'>0.960000</span> (  <span class='float'>0.960423</span>)
<span class='id identifier rubyid_upto'>upto</span><span class='op'>:</span>     <span class='float'>0.950000</span>   <span class='float'>0.000000</span>   <span class='float'>0.950000</span> (  <span class='float'>0.954864</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L216-L218'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='216' data-end='218'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/benchmark.rb', line 216</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_bm'>bm</span>(<span class='id identifier rubyid_label_width'>label_width</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_labels'>labels</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_blk'>blk</span>) <span class='comment'># :yield: report
</span>  <span class='id identifier rubyid_benchmark'><a href="#benchmark-class_method" title="Benchmark.benchmark (method)">benchmark</a></span>(<span class='const'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span><span class='comma'>,</span> <span class='id identifier rubyid_label_width'>label_width</span><span class='comma'>,</span> <span class='const'><a href="#FORMAT-constant" title="Benchmark::FORMAT (constant)">FORMAT</a></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_labels'>labels</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_blk'>blk</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="bmbm-class_method">
  <h3 class='signature private'>
    .<strong>bmbm</strong>(width = 0)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Sometimes benchmark results are skewed because code executed earlier encounters different garbage collection overheads than that run later. <a href="#bmbm-instance_method" title="Benchmark#bmbm (method)">#bmbm</a> attempts to minimize this effect by running the tests twice, the first time as a rehearsal in order to get the runtime environment stable, the second time for real. <code>GC.start</code> is executed before the start of each of the real timings; the cost of this is not included in the timings. In reality, though, there’s only so much that <a href="#bmbm-instance_method" title="Benchmark#bmbm (method)">#bmbm</a> can do, and the results are not guaranteed to be isolated from garbage collection and other effects.</p>

<p>Because <a href="#bmbm-instance_method" title="Benchmark#bmbm (method)">#bmbm</a> takes two passes through the tests, it can calculate the required label width.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> (<span class='int'>1</span><span class='op'>..</span><span class='int'>1000000</span>).<span class='id identifier rubyid_map'>map</span> { <span class='id identifier rubyid_rand'>rand</span> }

<span class='const'>Benchmark</span>.<span class='id identifier rubyid_bmbm'>bmbm</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort!</span><span class='tstring_end'>&quot;</span></span>) { <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_sort!'>sort!</span> }
  <span class='id identifier rubyid_x'>x</span>.<span class='id identifier rubyid_report'>report</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span>)  { <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_dup'>dup</span>.<span class='id identifier rubyid_sort'>sort</span>  }
<span class='kw'>end</span></code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Rehearsal</span> <span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span>
<span class='id identifier rubyid_sort!'>sort!</span>   <span class='float'>1.440000</span>   <span class='float'>0.010000</span>   <span class='float'>1.450000</span> (  <span class='float'>1.446833</span>)
<span class='id identifier rubyid_sort'>sort</span>    <span class='float'>1.440000</span>   <span class='float'>0.000000</span>   <span class='float'>1.440000</span> (  <span class='float'>1.448257</span>)
<span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span><span class='op'>-</span> <span class='id identifier rubyid_total'>total</span><span class='op'>:</span> <span class='float'>2.890000</span><span class='id identifier rubyid_sec'>sec</span>

            <span class='id identifier rubyid_user'>user</span>     <span class='id identifier rubyid_system'>system</span>      <span class='id identifier rubyid_total'>total</span>        <span class='id identifier rubyid_real'>real</span>
<span class='id identifier rubyid_sort!'>sort!</span>   <span class='float'>1.460000</span>   <span class='float'>0.000000</span>   <span class='float'>1.460000</span> (  <span class='float'>1.458065</span>)
<span class='id identifier rubyid_sort'>sort</span>    <span class='float'>1.450000</span>   <span class='float'>0.000000</span>   <span class='float'>1.450000</span> (  <span class='float'>1.455963</span>)</code></pre>

<p><a href="#bmbm-instance_method" title="Benchmark#bmbm (method)">#bmbm</a> yields a <a href="Benchmark/Job.html" title="Benchmark::Job (class)"><code>::Benchmark::Job</code></a> object and returns an array of <a href="Benchmark/Tms.html" title="Benchmark::Tms (class)"><code>::Benchmark::Tms</code></a> objects.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L258-L284'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='258' data-end='284'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/benchmark.rb', line 258</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_bmbm'>bmbm</span>(<span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='int'>0</span>) <span class='comment'># :yield: job
</span>  <span class='id identifier rubyid_job'>job</span> <span class='op'>=</span> <span class='const'><a href="Benchmark/Job.html" title="Benchmark::Job (class)">Job</a></span>.<span class='id identifier rubyid_new'><a href="Benchmark/Job.html#new-class_method" title="Benchmark::Job.new (method)">new</a></span>(<span class='id identifier rubyid_width'>width</span>)
  <span class='kw'>yield</span>(<span class='id identifier rubyid_job'>job</span>)
  <span class='id identifier rubyid_width'>width</span> <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_width'>width</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_sync'>sync</span>
  <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'># rehearsal
</span>  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Rehearsal </span><span class='tstring_end'>&#39;</span></span>.<span class='id identifier rubyid_ljust'>ljust</span>(<span class='id identifier rubyid_width'>width</span><span class='op'>+</span><span class='const'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span>.<span class='id identifier rubyid_length'>length</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_ets'>ets</span> <span class='op'>=</span> <span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_list'>list</span>.<span class='id identifier rubyid_inject'>inject</span>(<span class='const'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span>.<span class='id identifier rubyid_new'><a href="Benchmark/Tms.html#new-class_method" title="Benchmark::Tms.new (method)">new</a></span>) { <span class='op'>|</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span>(<span class='id identifier rubyid_label'>label</span><span class='comma'>,</span><span class='id identifier rubyid_item'>item</span>)<span class='op'>|</span>
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_label'>label</span>.<span class='id identifier rubyid_ljust'>ljust</span>(<span class='id identifier rubyid_width'>width</span>)
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='const'>Benchmark</span>.<span class='id identifier rubyid_measure'><a href="#measure-class_method" title="Benchmark.measure (method)">measure</a></span>(<span class='op'>&amp;</span><span class='id identifier rubyid_item'>item</span>)
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_res'>res</span>.<span class='id identifier rubyid_format'>format</span>
    <span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_res'>res</span>
  }.<span class='id identifier rubyid_format'>format</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total: %tsec</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ets'>ets</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>.<span class='id identifier rubyid_rjust'>rjust</span>(<span class='id identifier rubyid_widthCAPTION'>widthCAPTION</span>.<span class='id identifier rubyid_length2'>length2</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># take
</span>  <span class='id identifier rubyid_print'>print</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='op'>*</span><span class='id identifier rubyid_width'>width</span> <span class='op'>+</span> <span class='const'><a href="#CAPTION-constant" title="Benchmark::CAPTION (constant)">CAPTION</a></span>
  <span class='id identifier rubyid_job'>job</span>.<span class='id identifier rubyid_list'>list</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_label'>label</span><span class='comma'>,</span><span class='id identifier rubyid_item'>item</span><span class='op'>|</span>
    <span class='const'>GC</span>.<span class='id identifier rubyid_start'>start</span>
    <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_label'>label</span>.<span class='id identifier rubyid_ljust'>ljust</span>(<span class='id identifier rubyid_width'>width</span>)
    <span class='const'>Benchmark</span>.<span class='id identifier rubyid_measure'><a href="#measure-class_method" title="Benchmark.measure (method)">measure</a></span>(<span class='id identifier rubyid_label'>label</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_item'>item</span>).<span class='id identifier rubyid_tap'>tap</span> { <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span> <span class='id identifier rubyid_print'>print</span> <span class='id identifier rubyid_res'>res</span> }
  }
<span class='kw'>ensure</span>
  <span class='gvar'>$stdout</span>.<span class='id identifier rubyid_sync'>sync</span> <span class='op'>=</span> <span class='id identifier rubyid_sync'>sync</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sync'>sync</span>.<span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="measure-class_method">
  <h3 class='signature private'>
    .<strong>measure</strong>(label = &quot;&quot;)   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the time used to execute the given block as a <a href="Benchmark/Tms.html" title="Benchmark::Tms (class)"><code>::Benchmark::Tms</code></a> object. Takes <code>label</code> option.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>benchmark</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='int'>1000000</span>

<span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Benchmark</span>.<span class='id identifier rubyid_measure'>measure</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_n'>n</span>.<span class='id identifier rubyid_times'>times</span> { <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> }
<span class='kw'>end</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_time'>time</span></code></pre>

<p>Generates:</p>

<pre class="code ruby"><code class="ruby"><span class='float'>0.220000</span>   <span class='float'>0.000000</span>   <span class='float'>0.220000</span> (  <span class='float'>0.227313</span>)</code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L303-L313'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='303' data-end='313'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/benchmark.rb', line 303</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_measure'>measure</span>(<span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># :yield:
</span>  <span class='id identifier rubyid_t0'>t0</span><span class='comma'>,</span> <span class='id identifier rubyid_r0'>r0</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_times'>times</span><span class='comma'>,</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span>)
  <span class='kw'>yield</span>
  <span class='id identifier rubyid_t1'>t1</span><span class='comma'>,</span> <span class='id identifier rubyid_r1'>r1</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_times'>times</span><span class='comma'>,</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span>)
  <span class='const'>Benchmark</span><span class='op'>::</span><span class='const'><a href="Benchmark/Tms.html" title="Benchmark::Tms (class)">Tms</a></span>.<span class='id identifier rubyid_new'><a href="Benchmark/Tms.html#new-class_method" title="Benchmark::Tms.new (method)">new</a></span>(<span class='id identifier rubyid_t1'>t1</span>.<span class='id identifier rubyid_utime'>utime</span>  <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span>.<span class='id identifier rubyid_utime'>utime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_t1'>t1</span>.<span class='id identifier rubyid_stime'>stime</span>  <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span>.<span class='id identifier rubyid_stime'>stime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_t1'>t1</span>.<span class='id identifier rubyid_cutime'>cutime</span> <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span>.<span class='id identifier rubyid_cutime'>cutime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_t1'>t1</span>.<span class='id identifier rubyid_cstime'>cstime</span> <span class='op'>-</span> <span class='id identifier rubyid_t0'>t0</span>.<span class='id identifier rubyid_cstime'>cstime</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_r1'>r1</span> <span class='op'>-</span> <span class='id identifier rubyid_r0'>r0</span><span class='comma'>,</span>
                     <span class='id identifier rubyid_label'>label</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ms-class_method">
  <h3 class='signature private'>
    .<strong>ms</strong>   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the elapsed real time used to execute the given block. The unit of time is milliseconds.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Benchmark</span>.<span class='id identifier rubyid_ms'>ms</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>1_000_000_000</span> }
<span class='comment'>#=&gt; 509.8029999935534</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L335-L339'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='335' data-end='339'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/benchmark.rb', line 335</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ms'>ms</span> <span class='comment'># :yield:
</span>  <span class='id identifier rubyid_r0'>r0</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_float_millisecond'>float_millisecond</span>)
  <span class='kw'>yield</span>
  <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_float_millisecond'>float_millisecond</span>) <span class='op'>-</span> <span class='id identifier rubyid_r0'>r0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="realtime-class_method">
  <h3 class='signature private'>
    .<strong>realtime</strong>   <span class="extras">(<span class='mod_func'>mod_func</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the elapsed real time used to execute the given block. The unit of time is seconds.</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Benchmark</span>.<span class='id identifier rubyid_realtime'>realtime</span> { <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>1_000_000_000</span> }
<span class='comment'>#=&gt; 0.5098029999935534</span></code></pre>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/benchmark/blob/v0.5.0/lib/benchmark.rb#L322-L326'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='322' data-end='326'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/benchmark.rb', line 322</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_realtime'>realtime</span> <span class='comment'># :yield:
</span>  <span class='id identifier rubyid_r0'>r0</span> <span class='op'>=</span> <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span>)
  <span class='kw'>yield</span>
  <span class='const'>Process</span>.<span class='id identifier rubyid_clock_gettime'>clock_gettime</span>(<span class='const'>Process</span><span class='op'>::</span><span class='const'>CLOCK_MONOTONIC</span>) <span class='op'>-</span> <span class='id identifier rubyid_r0'>r0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>