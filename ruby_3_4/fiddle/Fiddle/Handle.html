<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Fiddle::Handle &mdash; fiddle  Ruby-3.4.6 p54</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Fiddle::Handle",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.4.6</a> &raquo; 
      <a href='../'>fiddle</a> &raquo; 
      <a href='../_index.html#alpha_H'>Index (H)</a> &raquo; 
        <a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>Handle&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Fiddle::Handle</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'><a href="../Object.html" title="Object (class)">Object</a></span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L523'>ext/fiddle/handle.c</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/lib/fiddle/ffi_backend.rb#L483'>ext/fiddle/lib/fiddle/ffi_backend.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<p>The <code>Handle</code> is the manner to access the dynamic library</p>

<h3 id="label-Example">Example</h3>

<h4 id="label-Setup">Setup</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_libc_so'>libc_so</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/lib64/libc.so.6</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'>#=&gt; &quot;/lib64/libc.so.6&quot;
</span><span class='ivar'>@handle</span> <span class='op'>=</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'>Handle</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Fiddle::Handle.new (method)">new</a></span>(<span class='id identifier rubyid_libc_so'>libc_so</span>)
<span class='comment'>#=&gt; #&lt;Fiddle::Handle:0x00000000d69ef8&gt;</span></code></pre>

<h4 id="label-Setup-2C+with+flags">Setup, with flags</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_libc_so'>libc_so</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/lib64/libc.so.6</span><span class='tstring_end'>&quot;</span></span>
<span class='comment'>#=&gt; &quot;/lib64/libc.so.6&quot;
</span><span class='ivar'>@handle</span> <span class='op'>=</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'>Handle</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="Fiddle::Handle.new (method)">new</a></span>(<span class='id identifier rubyid_libc_so'>libc_so</span><span class='comma'>,</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'><a href="../Fiddle.html#RTLD_LAZY-constant" title="Fiddle::RTLD_LAZY (constant)">RTLD_LAZY</a></span> <span class='op'>|</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'><a href="../Fiddle.html#RTLD_GLOBAL-constant" title="Fiddle::RTLD_GLOBAL (constant)">RTLD_GLOBAL</a></span>)
<span class='comment'>#=&gt; #&lt;Fiddle::Handle:0x00000000d69ef8&gt;</span></code></pre>

<p>See RTLD_LAZY and <a href="#RTLD_GLOBAL-constant" title="Fiddle::Handle::RTLD_GLOBAL (constant)">RTLD_GLOBAL</a></p>

<h4 id="label-Addresses+to+symbols">Addresses to symbols</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_strcpy_addr'>strcpy_addr</span> <span class='op'>=</span> <span class='ivar'>@handle</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>strcpy</span><span class='tstring_end'>&#39;</span></span>]
<span class='comment'>#=&gt; 140062278451968</span></code></pre>

<p>or</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_strcpy_addr'>strcpy_addr</span> <span class='op'>=</span> <span class='ivar'>@handle</span>.<span class='id identifier rubyid_sym'><a href="#sym-class_method" title="Fiddle::Handle.sym (method)">sym</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>strcpy</span><span class='tstring_end'>&#39;</span></span>)
<span class='comment'>#=&gt; 140062278451968</span></code></pre>

  </div>
</div>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='DEFAULT-constant' class='summary_signature'>DEFAULT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>A predefined pseudo-handle of RTLD_DEFAULT</p>

<p>Which will find the first occurrence of the desired symbol using the default library search order</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L545-L553'># File 'ext/fiddle/handle.c', line 545</a>    <pre class='code c'><span class='id identifier rubyid_new'><a href="#new-class_method" title="Fiddle::Handle.new (method)">new</a></span></pre>
  </li>
  <li>
    <span id='NEXT-constant' class='summary_signature'>NEXT =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>A predefined pseudo-handle of RTLD_NEXT</p>

<p>Which will find the next occurrence of a function in the search order after the current library.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L536'># File 'ext/fiddle/handle.c', line 536</a>    <pre class='code c'><span class='id identifier rubyid_predefined_fiddle_handle'>predefined_fiddle_handle</span>(<span class='const'>RTLD_NEXT</span>)</pre>
  </li>
  <li>
    <span id='RTLD_GLOBAL-constant' class='summary_signature'>RTLD_GLOBAL =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p><code>:Handle</code> flag.</p>

<p>The symbols defined by this library will be made available for symbol resolution of subsequently loaded libraries.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L554-L484'># File 'ext/fiddle/handle.c', line 554</a>    <pre class='code c'><span class='const'>FFI</span><span class='op'>::</span><span class='const'>DynamicLibrary</span><span class='op'>::</span><span class='const'><a href="#RTLD_GLOBAL-constant" title="Fiddle::Handle::RTLD_GLOBAL (constant)">RTLD_GLOBAL</a></span></pre>
  </li>
  <li>
    <span id='RTLD_LAZY-constant' class='summary_signature'>RTLD_LAZY =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p><code>:Handle</code> flag.</p>

<p>Perform lazy binding.  Only resolve symbols as the code that references them is executed.  If the  symbol is never referenced, then it is never resolved.  (Lazy binding is only performed for function references; references to variables are always immediately bound when the library is loaded.)</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L566-L485'># File 'ext/fiddle/handle.c', line 566</a>    <pre class='code c'><span class='const'>FFI</span><span class='op'>::</span><span class='const'>DynamicLibrary</span><span class='op'>::</span><span class='const'><a href="#RTLD_LAZY-constant" title="Fiddle::Handle::RTLD_LAZY (constant)">RTLD_LAZY</a></span></pre>
  </li>
  <li>
    <span id='RTLD_NOW-constant' class='summary_signature'>RTLD_NOW =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p><code>:Handle</code> flag.</p>

<p>If this value is specified or the environment variable LD_BIND_NOW is set to a nonempty string, all undefined symbols in the library are resolved before <a href="../Fiddle.html#dlopen-class_method" title="Fiddle.dlopen (method)">Fiddle.dlopen</a> returns.  If this cannot be done an error is returned.</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L577-L486'># File 'ext/fiddle/handle.c', line 577</a>    <pre class='code c'><span class='const'>FFI</span><span class='op'>::</span><span class='const'>DynamicLibrary</span><span class='op'>::</span><span class='const'><a href="#RTLD_NOW-constant" title="Fiddle::Handle::RTLD_NOW (constant)">RTLD_NOW</a></span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-class_method" title="[] (class method)">.<strong>[]</strong>(name)  </a>
      (also: .sym)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the address as an Integer for the function named <code>name</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(library = nil, flags = Fiddle::RTLD_LAZY | Fiddle::RTLD_GLOBAL)  </a>
    </span>
    <span class='note title constructor'>constructor</span>
    <div class='summary_desc'>
      <div class='inline'><p>Create a new handler that opens <code>library</code> with <code>flags</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sym-class_method" title="sym (class method)">.<strong>sym</strong>(name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#[]-class_method" title="Fiddle::Handle.[] (method)">.[]</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sym_defined%3F-class_method" title=".sym_defined? (class method)">.<strong>sym_defined?</strong>(func)  &#x21d2; Boolean </a>
    </span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro'>
      <a href="#close_enabled%3F-instance_method" title="#close_enabled? (instance method)">#<strong>close_enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns <code>true</code> if dlclose() will be called when this handle is garbage collected.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(name)  </a>
      (also: #sym)
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Get the address as an Integer for the function named <code>name</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>keeping while its symbols are referred.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#disable_close-instance_method" title="#disable_close (instance method)">#<strong>disable_close</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Disable a call to dlclose() when this handle is garbage collected.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#enable_close-instance_method" title="#enable_close (instance method)">#<strong>enable_close</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Enable a call to dlclose() when this handle is garbage collected.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#file_name-instance_method" title="#file_name (instance method)">#<strong>file_name</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the file name of this handle.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(libname = nil, flags = RTLD_LAZY | RTLD_GLOBAL)  &#x21d2; Handle </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sym-instance_method" title="#sym (instance method)">#<strong>sym</strong>(name)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Alias for <a href="#[]-instance_method" title="Fiddle::Handle#[] (method)">#[]</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#sym_defined%3F-instance_method" title="#sym_defined? (instance method)">#<strong>sym_defined?</strong>(func)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_i-instance_method" title="#to_i (instance method)">#<strong>to_i</strong>  &#x21d2; Integer </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the memory address for this handle.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#to_ptr-instance_method" title="#to_ptr (instance method)">#<strong>to_ptr</strong>  &#x21d2; ? </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Returns the <a href="Pointer.html" title="Fiddle::Pointer (class)"><code>Pointer</code></a> of this handle.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(library = nil, flags = Fiddle::RTLD_LAZY | Fiddle::RTLD_GLOBAL)    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Create a new handler that opens <code>library</code> with <code>flags</code>.</p>

<p>If no <code>library</code> is specified or <code>nil</code> is given, <a href="#DEFAULT-constant" title="Fiddle::Handle::DEFAULT (constant)">DEFAULT</a> is used, which is the equivalent to RTLD_DEFAULT. See <code>man 3 dlopen</code> for more.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_lib'>lib</span> <span class='op'>=</span> <span class='const'><a href="../Fiddle.html" title="Fiddle (module)">Fiddle</a></span><span class='op'>::</span><span class='const'>Handle</span>.<span class='id identifier rubyid_new'>new</span></code></pre>

<p>The default is dependent on OS, and provide a handle for all libraries already loaded. For example, in most cases you can use this to access <code>libc</code> functions, or ruby functions like <code>rb_str_new</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L136-L207'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='136' data-end='207'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 136</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_initialize(int argc, VALUE argv[], VALUE self)
{
    void *ptr;
    struct dl_handle *fiddle_handle;
    VALUE lib, flag;
    char  *clib;
    int   cflag;
    const char *err;

    switch( rb_scan_args(argc, argv, &quot;02&quot;, &amp;lib, &amp;flag) ){
      case 0:
	clib = NULL;
	cflag = RTLD_LAZY | RTLD_GLOBAL;
	break;
      case 1:
	clib = NIL_P(lib) ? NULL : StringValueCStr(lib);
	cflag = RTLD_LAZY | RTLD_GLOBAL;
	break;
      case 2:
	clib = NIL_P(lib) ? NULL : StringValueCStr(lib);
	cflag = NUM2INT(flag);
	break;
      default:
	rb_bug(&quot;rb_fiddle_handle_new&quot;);
    }

#if defined(_WIN32)
    if( !clib ){
	HANDLE rb_libruby_handle(void);
	ptr = rb_libruby_handle();
    }
    else if( STRCASECMP(clib, &quot;libc&quot;) == 0
# ifdef RUBY_COREDLL
	     || STRCASECMP(clib, RUBY_COREDLL) == 0
	     || STRCASECMP(clib, RUBY_COREDLL&quot;.dll&quot;) == 0
# endif
	){
# ifdef _WIN32_WCE
	ptr = dlopen(&quot;coredll.dll&quot;, cflag);
# else
	(void)cflag;
	ptr = w32_coredll();
# endif
    }
    else
#endif
	ptr = dlopen(clib, cflag);
#if defined(HAVE_DLERROR)
    if( !ptr &amp;&amp; (err = dlerror()) ){
	rb_raise(rb_eFiddleDLError, &quot;%s&quot;, err);
    }
#else
    if( !ptr ){
	err = dlerror();
	rb_raise(rb_eFiddleDLError, &quot;%s&quot;, err);
    }
#endif
    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if( fiddle_handle-&gt;ptr &amp;&amp; fiddle_handle-&gt;open &amp;&amp; fiddle_handle-&gt;enable_close ){
	dlclose(fiddle_handle-&gt;ptr);
    }
    fiddle_handle-&gt;ptr = ptr;
    fiddle_handle-&gt;open = 1;
    fiddle_handle-&gt;enable_close = 0;

    if( rb_block_given_p() ){
	rb_ensure(rb_yield, self, rb_fiddle_handle_close, self);
    }

    return Qnil;
}
</pre>
  </div>
</div>
</section>

  <section class='method_details' id="initialize-instance_method">
  <h3 class='signature '>
    #<strong>initialize</strong>(libname = nil, flags = RTLD_LAZY | RTLD_GLOBAL)  &#x21d2; <code>Handle</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/lib/fiddle/ffi_backend.rb#L488-L502'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='488' data-end='502'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/lib/fiddle/ffi_backend.rb', line 488</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_libname'>libname</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='const'><a href="#RTLD_LAZY-constant" title="Fiddle::Handle::RTLD_LAZY (constant)">RTLD_LAZY</a></span> <span class='op'>|</span> <span class='const'><a href="#RTLD_GLOBAL-constant" title="Fiddle::Handle::RTLD_GLOBAL (constant)">RTLD_GLOBAL</a></span>)
  <span class='kw'>begin</span>
    <span class='ivar'>@lib</span> <span class='op'>=</span> <span class='const'>FFI</span><span class='op'>::</span><span class='const'>DynamicLibrary</span>.<span class='id identifier rubyid_open'>open</span>(<span class='id identifier rubyid_libname'>libname</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span>)
  <span class='kw'>rescue</span> <span class='const'>LoadError</span><span class='comma'>,</span> <span class='const'>RuntimeError</span> <span class='comment'># LoadError for JRuby, RuntimeError for TruffleRuby
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="DLError.html" title="Fiddle::DLError (class)">DLError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not open </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_libname'>libname</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@open</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='kw'>begin</span>
    <span class='kw'>yield</span>(<span class='kw'>self</span>)
  <span class='kw'>ensure</span>
    <span class='kw'>self</span>.<span class='id identifier rubyid_close'><a href="#close-instance_method" title="Fiddle::Handle#close (method)">close</a></span>
  <span class='kw'>end</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="[]-class_method">
  <h3 class='signature  first'>
    .<strong>[]</strong>(name)      <span class='aliases'>Also known as: <span class='names'>.sym</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the address as an Integer for the function named <code>name</code>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L324-L328'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='324' data-end='328'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 324</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_s_sym(VALUE self, VALUE sym)
{
    return fiddle_handle_sym(RTLD_NEXT, sym);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sym-class_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>.<strong>[]</strong>(name)  </span>
      <span class='overload'>.<strong>sym</strong>(name)  </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#[]-class_method" title="Fiddle::Handle.[] (method)">.[]</a>.</p>

  </div>
</div>
<div class='tags'>
  
</div>

</section>

<section class='method_details' id="sym_defined?-class_method">
  <h3 class='signature '>
    .<strong>sym_defined?</strong>(func)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L394-L407'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='394' data-end='407'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 394</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_s_sym_defined(VALUE self, VALUE sym)
{
    fiddle_void_func func;

    func = fiddle_handle_find_func(RTLD_NEXT, sym);

    if( func ) {
	return PTR2NUM(func);
    }
    else {
	return Qnil;
    }
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="close_enabled?-instance_method">
  <h3 class='signature ro first'>
    #<strong>close_enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>)</span>  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns <code>true</code> if dlclose() will be called when this handle is garbage collected.</p>

<p>See man(3) dlclose() for more info.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L246-L255'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='246' data-end='255'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 246</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_close_enabled_p(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);

    if(fiddle_handle-&gt;enable_close) return Qtrue;
    return Qfalse;
}
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="[]-instance_method">
  <h3 class='signature  first'>
    #<strong>[]</strong>(name)      <span class='aliases'>Also known as: <span class='names'>#sym</span></span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Get the address as an Integer for the function named <code>name</code>.  The function is searched via dlsym on RTLD_NEXT.</p>

<p>See man(3) dlsym() for more info.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L294-L305'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='294' data-end='305'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 294</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_sym(VALUE self, VALUE sym)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if( ! fiddle_handle-&gt;open ){
	rb_raise(rb_eFiddleDLError, &quot;closed handle&quot;);
    }

    return fiddle_handle_sym(fiddle_handle-&gt;ptr, sym);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature '>
    #<strong>close</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>keeping while its symbols are referred.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="DLError.html" title="Fiddle::DLError (class)">DLError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L70-L93'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='70' data-end='93'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 70</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_close(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if(fiddle_handle-&gt;open) {
	int ret = dlclose(fiddle_handle-&gt;ptr);
	fiddle_handle-&gt;open = 0;

	/* Check dlclose for successful return value */
	if(ret) {
#if defined(HAVE_DLERROR)
	    rb_raise(rb_eFiddleDLError, &quot;%s&quot;, dlerror());
#else
	    rb_raise(rb_eFiddleDLError, &quot;could not close handle&quot;);
#endif
	}
	return INT2NUM(ret);
    }
    rb_raise(rb_eFiddleDLError, &quot;dlclose() called too many times&quot;);

    UNREACHABLE;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="disable_close-instance_method">
  <h3 class='signature '>
    #<strong>disable_close</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Disable a call to dlclose() when this handle is garbage collected.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L229-L237'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='229' data-end='237'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 229</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_disable_close(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    fiddle_handle-&gt;enable_close = 0;
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="enable_close-instance_method">
  <h3 class='signature '>
    #<strong>enable_close</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Enable a call to dlclose() when this handle is garbage collected.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L214-L222'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='214' data-end='222'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 214</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_enable_close(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    fiddle_handle-&gt;enable_close = 1;
    return Qnil;
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="file_name-instance_method">
  <h3 class='signature '>
    #<strong>file_name</strong>    </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the file name of this handle.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L449-L484'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='449' data-end='484'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 449</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_file_name(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);

#if defined(HAVE_DLINFO) &amp;&amp; defined(HAVE_CONST_RTLD_DI_LINKMAP)
    {
	struct link_map *lm = NULL;
	int res = dlinfo(fiddle_handle-&gt;ptr, RTLD_DI_LINKMAP, &amp;lm);
	if (res == 0 &amp;&amp; lm != NULL) {
	    return rb_str_new_cstr(lm-&gt;l_name);
	}
	else {
#if defined(HAVE_DLERROR)
	    rb_raise(rb_eFiddleDLError, &quot;could not get handle file name: %s&quot;, dlerror());
#else
	    rb_raise(rb_eFiddleDLError, &quot;could not get handle file name&quot;);
#endif
	}
    }
#elif defined(HAVE_GETMODULEFILENAME)
    {
	char filename[MAX_PATH];
	DWORD res = GetModuleFileName(fiddle_handle-&gt;ptr, filename, MAX_PATH);
	if (res == 0) {
	    rb_raise(rb_eFiddleDLError, &quot;could not get handle file name: %s&quot;, dlerror());
	}
	return rb_str_new_cstr(filename);
    }
#else
    (void)fiddle_handle;
    return Qnil;
#endif
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="sym-instance_method">
  <h3 class='signature '>
    <div class='inline-block'>
      <span class='overload'>#<strong>[]</strong>(name)  </span>
      <span class='overload'>#<strong>sym</strong>(name)  </span>
    </div>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Alias for <a href="#[]-instance_method" title="Fiddle::Handle#[] (method)">#[]</a>.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>TypeError</code>)</span>
  </li>
</ul>

</div>

</section>

<section class='method_details' id="sym_defined?-instance_method">
  <h3 class='signature '>
    #<strong>sym_defined?</strong>(func)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>TypeError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L409-L428'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='409' data-end='428'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 409</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_sym_defined(VALUE self, VALUE sym)
{
    struct dl_handle *fiddle_handle;
    fiddle_void_func func;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    if( ! fiddle_handle-&gt;open ){
	rb_raise(rb_eFiddleDLError, &quot;closed handle&quot;);
    }

    func = fiddle_handle_find_func(fiddle_handle-&gt;ptr, sym);

    if( func ) {
	return PTR2NUM(func);
    }
    else {
	return Qnil;
    }
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_i-instance_method">
  <h3 class='signature '>
    #<strong>to_i</strong>  &#x21d2; <code>Integer</code>   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the memory address for this handle.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L262-L269'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='262' data-end='269'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 262</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_to_i(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    return PTR2NUM(fiddle_handle-&gt;ptr);
}
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_ptr-instance_method">
  <h3 class='signature '>
    #<strong>to_ptr</strong>  &#x21d2; ?   </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Returns the <a href="Pointer.html" title="Fiddle::Pointer (class)"><code>Pointer</code></a> of this handle.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/ext/fiddle/handle.c#L276-L283'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='276' data-end='283'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'ext/fiddle/handle.c', line 276</span></pre>
<pre class='code cpp'>

static VALUE
rb_fiddle_handle_to_ptr(VALUE self)
{
    struct dl_handle *fiddle_handle;

    TypedData_Get_Struct(self, struct dl_handle, &amp;fiddle_handle_data_type, fiddle_handle);
    return rb_fiddle_ptr_new_wrap(fiddle_handle-&gt;ptr, 0, 0, self, 0);
}
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>