<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: RubyVM::RJIT &mdash; ruby_vm  Ruby-3.4.6 p54</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyVM::RJIT",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Ruby-3.4.6</a> &raquo; 
      <a href='../'>ruby_vm</a> &raquo; 
      <a href='../_index.html#alpha_R'>Index (R)</a> &raquo; 
        RubyVM &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>RJIT&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: RubyVM::RJIT</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="RJIT/CPointer.html" title="RubyVM::RJIT::CPointer (module)"><code>CPointer</code></a>,
        <a href="RJIT/CType.html" title="RubyVM::RJIT::CType (module)"><code>CType</code></a>,
        <a class='nodoc' href="RJIT/Hooks.html" title="RubyVM::RJIT::Hooks (module)"><code>Hooks</code></a>,
        <a href="RJIT/OperandMatcher.html" title="RubyVM::RJIT::OperandMatcher (module)"><code>OperandMatcher</code></a>,
        <a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)"><code>TypeDiff</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="RJIT/Assembler.html" title="RubyVM::RJIT::Assembler (class)"><code>Assembler</code></a>,
        <a href="RJIT/BranchStub.html" title="RubyVM::RJIT::BranchStub (class)"><code>BranchStub</code></a>,
        <a href="RJIT/BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)"><code>BranchTarget</code></a>,
        <a href="RJIT/BytePtr.html" title="RubyVM::RJIT::BytePtr (class)"><code>BytePtr</code></a>,
        <a href="RJIT/CodeBlock.html" title="RubyVM::RJIT::CodeBlock (class)"><code>CodeBlock</code></a>,
        <a href="RJIT/Compiler.html" title="RubyVM::RJIT::Compiler (class)"><code>Compiler</code></a>,
        <a href="RJIT/Context.html" title="RubyVM::RJIT::Context (class)"><code>Context</code></a>,
        <a href="RJIT/DwordPtr.html" title="RubyVM::RJIT::DwordPtr (class)"><code>DwordPtr</code></a>,
        <a href="RJIT/EntryStub.html" title="RubyVM::RJIT::EntryStub (class)"><code>EntryStub</code></a>,
        <a href="RJIT/ExitCompiler.html" title="RubyVM::RJIT::ExitCompiler (class)"><code>ExitCompiler</code></a>,
        <a href="RJIT/InsnCompiler.html" title="RubyVM::RJIT::InsnCompiler (class)"><code>InsnCompiler</code></a>,
        <a href="RJIT/Invariants.html" title="RubyVM::RJIT::Invariants (class)"><code>Invariants</code></a>,
        <a href="RJIT/JITState.html" title="RubyVM::RJIT::JITState (class)"><code>JITState</code></a>      </div>
    </td></tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2'>lib/ruby_vm/rjit/insn_compiler.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/assembler.rb#L2'>lib/ruby_vm/rjit/assembler.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/branch_stub.rb#L1'>lib/ruby_vm/rjit/branch_stub.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/c_pointer.rb#L1'>lib/ruby_vm/rjit/c_pointer.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/c_type.rb#L5'>lib/ruby_vm/rjit/c_type.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/code_block.rb#L1'>lib/ruby_vm/rjit/code_block.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L14'>lib/ruby_vm/rjit/compiler.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L1'>lib/ruby_vm/rjit/context.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/entry_stub.rb#L1'>lib/ruby_vm/rjit/entry_stub.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/exit_compiler.rb#L1'>lib/ruby_vm/rjit/exit_compiler.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/hooks.rb#L1'>lib/ruby_vm/rjit/hooks.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/invariants.rb#L3'>lib/ruby_vm/rjit/invariants.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/jit_state.rb#L1'>lib/ruby_vm/rjit/jit_state.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L2'>lib/ruby_vm/rjit/stats.rb</a>,<br/> <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/type.rb#L1'>lib/ruby_vm/rjit/type.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full'>
  <li>
    <span id='CFP-constant' class='summary_signature'>CFP =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L29-L29'># File 'lib/ruby_vm/rjit/compiler.rb', line 29</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='id identifier rubyid_r15'>r15</span></pre>
  </li>
  <li>
    <span id='C_ARGS-constant' class='summary_signature'>C_ARGS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>SystemV x64 calling convention</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/assembler.rb#L13-L13'># File 'lib/ruby_vm/rjit/assembler.rb', line 13</a>    <pre class='code ruby'>[<span class='symbeg'>:</span><span class='id identifier rubyid_rdi'>rdi</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rsi'>rsi</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rdx'>rdx</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_r8'>r8</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_r9'>r9</span>]</pre>
  </li>
  <li>
    <span id='C_RET-constant' class='summary_signature'>C_RET =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/assembler.rb#L14-L14'># File 'lib/ruby_vm/rjit/assembler.rb', line 14</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span></pre>
  </li>
  <li>
    <span id='CantCompile-constant' class='summary_signature'>CantCompile =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L17-L17'># File 'lib/ruby_vm/rjit/compiler.rb', line 17</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span></pre>
  </li>
  <li>
    <span id='Default-constant' class='summary_signature'>Default =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>target1 is a fallthrough</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/branch_stub.rb#L5-L5'># File 'lib/ruby_vm/rjit/branch_stub.rb', line 5</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span></pre>
  </li>
  <li>
    <span id='EC-constant' class='summary_signature'>EC =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Callee-saved registers TODO: support using r12/r13 here</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L28-L28'># File 'lib/ruby_vm/rjit/compiler.rb', line 28</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='id identifier rubyid_r14'>r14</span></pre>
  </li>
  <li>
    <span id='EndBlock-constant' class='summary_signature'>EndBlock =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L18-L18'># File 'lib/ruby_vm/rjit/compiler.rb', line 18</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span></pre>
  </li>
  <li>
    <span id='GC_REFS-constant' class='summary_signature'>GC_REFS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Mark objects in this Array during GC</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L35-L35'># File 'lib/ruby_vm/rjit/compiler.rb', line 35</a>    <pre class='code ruby'>[]</pre>
  </li>
  <li>
    <span id='KeepCompiling-constant' class='summary_signature'>KeepCompiling =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Compilation status</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L16-L16'># File 'lib/ruby_vm/rjit/compiler.rb', line 16</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span></pre>
  </li>
  <li>
    <span id='MAX_LOCAL_TYPES-constant' class='summary_signature'>MAX_LOCAL_TYPES =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Maximum number of local variable types we keep track of</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L5-L5'># File 'lib/ruby_vm/rjit/context.rb', line 5</a>    <pre class='code ruby'><span class='int'>8</span></pre>
  </li>
  <li>
    <span id='MAX_TEMP_TYPES-constant' class='summary_signature'>MAX_TEMP_TYPES =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Maximum number of temp value types we keep track of</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L3-L3'># File 'lib/ruby_vm/rjit/context.rb', line 3</a>    <pre class='code ruby'><span class='int'>8</span></pre>
  </li>
  <li>
    <span id='MAX_VERSIONS-constant' class='summary_signature'>MAX_VERSIONS =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Maximum number of versions per block 1 means always create generic versions</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L39-L39'># File 'lib/ruby_vm/rjit/compiler.rb', line 39</a>    <pre class='code ruby'><span class='int'>4</span></pre>
  </li>
  <li>
    <span id='MapToLocal-constant' class='summary_signature'>MapToLocal =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Temp maps to the self operand</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L15-L15'># File 'lib/ruby_vm/rjit/context.rb', line 15</a>    <pre class='code ruby'><span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_local_index'>local_index</span>)</pre>
  </li>
  <li>
    <span id='MapToSelf-constant' class='summary_signature'>MapToSelf =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Normal stack value</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L14-L14'># File 'lib/ruby_vm/rjit/context.rb', line 14</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#MapToSelf-constant" title="RubyVM::RJIT::MapToSelf (constant)">MapToSelf</a></span></pre>
  </li>
  <li>
    <span id='MapToStack-constant' class='summary_signature'>MapToStack =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Potential mapping of a value on the temporary stack to self, a local variable, or constant so that we can track its type</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L13-L13'># File 'lib/ruby_vm/rjit/context.rb', line 13</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#MapToStack-constant" title="RubyVM::RJIT::MapToStack (constant)">MapToStack</a></span></pre>
  </li>
  <li>
    <span id='Next0-constant' class='summary_signature'>Next0 =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Branch shapes</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/branch_stub.rb#L3-L3'># File 'lib/ruby_vm/rjit/branch_stub.rb', line 3</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#Next0-constant" title="RubyVM::RJIT::Next0 (constant)">Next0</a></span></pre>
  </li>
  <li>
    <span id='Next1-constant' class='summary_signature'>Next1 =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>target0 is a fallthrough</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/branch_stub.rb#L4-L4'># File 'lib/ruby_vm/rjit/branch_stub.rb', line 4</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#Next1-constant" title="RubyVM::RJIT::Next1 (constant)">Next1</a></span></pre>
  </li>
  <li>
    <span id='Qfalse-constant' class='summary_signature'>Qfalse =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L22-L22'># File 'lib/ruby_vm/rjit/compiler.rb', line 22</a>    <pre class='code ruby'><span class='const'>Fiddle</span><span class='op'>::</span><span class='const'><a href="#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span></pre>
  </li>
  <li>
    <span id='Qnil-constant' class='summary_signature'>Qnil =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L23-L23'># File 'lib/ruby_vm/rjit/compiler.rb', line 23</a>    <pre class='code ruby'><span class='const'>Fiddle</span><span class='op'>::</span><span class='const'><a href="#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span></pre>
  </li>
  <li>
    <span id='Qtrue-constant' class='summary_signature'>Qtrue =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Ruby constants</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L21-L21'># File 'lib/ruby_vm/rjit/compiler.rb', line 21</a>    <pre class='code ruby'><span class='const'>Fiddle</span><span class='op'>::</span><span class='const'><a href="#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span></pre>
  </li>
  <li>
    <span id='Qundef-constant' class='summary_signature'>Qundef =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L24-L24'># File 'lib/ruby_vm/rjit/compiler.rb', line 24</a>    <pre class='code ruby'><span class='const'>Fiddle</span><span class='op'>::</span><span class='const'><a href="#Qundef-constant" title="RubyVM::RJIT::Qundef (constant)">Qundef</a></span></pre>
  </li>
  <li>
    <span id='QwordPtr-constant' class='summary_signature'>QwordPtr =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>64-bit memory access</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/assembler.rb#L10-L10'># File 'lib/ruby_vm/rjit/assembler.rb', line 10</a>    <pre class='code ruby'><span class='const'>Array</span></pre>
  </li>
  <li>
    <span id='SP-constant' class='summary_signature'>SP =</span>
    <br/>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/compiler.rb#L30-L30'># File 'lib/ruby_vm/rjit/compiler.rb', line 30</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='id identifier rubyid_rbx'>rbx</span></pre>
  </li>
  <li>
    <span id='SelfOpnd-constant' class='summary_signature'>SelfOpnd =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Operand to a YARV bytecode instruction</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L8-L8'># File 'lib/ruby_vm/rjit/context.rb', line 8</a>    <pre class='code ruby'><span class='symbeg'>:</span><span class='const'><a href="#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span></pre>
  </li>
  <li>
    <span id='StackOpnd-constant' class='summary_signature'>StackOpnd =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>The value is self</p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/context.rb#L9-L9'># File 'lib/ruby_vm/rjit/context.rb', line 9</a>    <pre class='code ruby'><span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_index'>index</span>)</pre>
  </li>
  <li>
    <span id='Type-constant' class='summary_signature'>Type =</span>
    <div class='docstring'>
  <div class='discussion'>
    
<p>Represent the type of a value (local/stack/self) in <code>RJIT</code></p>

  </div>
</div>
    <a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/type.rb#L3-L141'># File 'lib/ruby_vm/rjit/type.rb', line 3</a>    <pre class='code ruby'><span class='const'>Data</span>.<span class='id identifier rubyid_define'>define</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_type'>type</span>) <span class='kw'>do</span>
  <span class='comment'># Check if the type is an immediate
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_imm?'>imm?</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Flonum</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>ImmSymbol</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>else</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Returns true when the type is not specific.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_unknown?'>unknown?</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span> <span class='op'>|</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span> <span class='op'>|</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>else</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Returns true when we know the VALUE is a specific handle type,
</span>  <span class='comment'># such as a static symbol ([Type::ImmSymbol], i.e. true from RB_STATIC_SYM_P()).
</span>  <span class='comment'># Opposite of [Self::is_unknown].
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_specific?'>specific?</span>
    <span class='op'>!</span><span class='kw'>self</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>
  <span class='kw'>end</span>

  <span class='comment'># Check if the type is a heap object
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_heap?'>heap?</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Hash</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>HeapSymbol</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CString</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>BlockParamProxy</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>else</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Check if it&#39;s a T_ARRAY object
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_array?'>array?</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>else</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Check if it&#39;s a T_STRING object (both TString and CString are T_STRING)
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_string?'>string?</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CString</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>else</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Returns the class if it is known, otherwise nil
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_known_class'>known_class</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cNilClass'>rb_cNilClass</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cTrueClass'>rb_cTrueClass</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cFalseClass'>rb_cFalseClass</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cInteger'>rb_cInteger</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Flonum</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cFloat'>rb_cFloat</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>ImmSymbol</span> <span class='op'>|</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>HeapSymbol</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cSymbol'>rb_cSymbol</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CString</span> <span class='kw'>then</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cString'>rb_cString</span>
    <span class='kw'>else</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Returns a boolean representing whether the value is truthy if known, otherwise nil
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_known_truthy'>known_truthy</span>
    <span class='kw'>case</span> <span class='kw'>self</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span> <span class='kw'>then</span> <span class='kw'>false</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span> <span class='kw'>then</span> <span class='kw'>false</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span> <span class='kw'>then</span> <span class='kw'>false</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span> <span class='op'>|</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span> <span class='kw'>then</span> <span class='kw'>nil</span>
    <span class='kw'>else</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Returns a boolean representing whether the value is equal to nil if known, otherwise nil
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_known_nil'>known_nil</span>
    <span class='kw'>case</span> [<span class='kw'>self</span><span class='comma'>,</span> <span class='kw'>self</span>.<span class='id identifier rubyid_known_truthy'>known_truthy</span>]
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>in</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='kw'>then</span> <span class='kw'>false</span> <span class='comment'># Qfalse is not nil
</span>    <span class='kw'>in</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='kw'>true</span> <span class='kw'>then</span> <span class='kw'>false</span> <span class='comment'># if truthy, can&#39;t be nil
</span>    <span class='kw'>in</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='kw'>then</span> <span class='kw'>nil</span> <span class='comment'># otherwise unknown
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_diff'>diff</span>(<span class='id identifier rubyid_dst'>dst</span>)
    <span class='comment'># Perfect match, difference is zero
</span>    <span class='kw'>if</span> <span class='kw'>self</span> <span class='op'>==</span> <span class='id identifier rubyid_dst'>dst</span>
      <span class='kw'>return</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='int'>0</span>]
    <span class='kw'>end</span>

    <span class='comment'># Any type can flow into an unknown type
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_dst'>dst</span> <span class='op'>==</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>
      <span class='kw'>return</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='int'>1</span>]
    <span class='kw'>end</span>

    <span class='comment'># A CString is also a TString.
</span>    <span class='kw'>if</span> <span class='kw'>self</span> <span class='op'>==</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CString</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_dst'>dst</span> <span class='op'>==</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>
      <span class='kw'>return</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='int'>1</span>]
    <span class='kw'>end</span>

    <span class='comment'># Specific heap type into unknown heap type is imperfect but valid
</span>    <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_heap?'>heap?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_dst'>dst</span> <span class='op'>==</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>
      <span class='kw'>return</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='int'>1</span>]
    <span class='kw'>end</span>

    <span class='comment'># Specific immediate type into unknown immediate type is imperfect but valid
</span>    <span class='kw'>if</span> <span class='kw'>self</span>.<span class='id identifier rubyid_imm?'>imm?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_dst'>dst</span> <span class='op'>==</span> <span class='const'><a href="#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>
      <span class='kw'>return</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Compatible-constant" title="RubyVM::RJIT::TypeDiff::Compatible (constant)">Compatible</a></span>[<span class='int'>1</span>]
    <span class='kw'>end</span>

    <span class='comment'># Incompatible types
</span>    <span class='kw'>return</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_upgrade'>upgrade</span>(<span class='id identifier rubyid_new_type'>new_type</span>)
    <span class='id identifier rubyid_assert'>assert</span>(<span class='id identifier rubyid_new_type'>new_type</span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='kw'>self</span>) <span class='op'>!=</span> <span class='const'><a href="RJIT/TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="RJIT/TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>)
    <span class='id identifier rubyid_new_type'>new_type</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_assert'>assert</span>(<span class='id identifier rubyid_cond'>cond</span>)
    <span class='kw'>unless</span> <span class='id identifier rubyid_cond'>cond</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cond'>cond</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; was not true</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#runtime_stats-class_method" title=".runtime_stats (class method)">.<strong>runtime_stats</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Return a Hash for RJIT statistics.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#dump_trace_exits-class_method" title=".dump_trace_exits (class method)">.<strong>dump_trace_exits</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>–yjit-trace-exits at_exit.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#exit_traces-class_method" title=".exit_traces (class method)">.<strong>exit_traces</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Convert rb_rjit_raw_samples and rb_rjit_line_samples into a StackProf format.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#format_number-class_method" title=".format_number (class method)">.<strong>format_number</strong>(pad, number)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Format large numbers with comma separators for readability.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#print_counters-class_method" title=".print_counters (class method)">.<strong>print_counters</strong>(stats, prefix:, prompt:)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#print_exit_counts-class_method" title=".print_exit_counts (class method)">.<strong>print_exit_counts</strong>(stats, how_many: 20, padding: 2)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#print_stats-class_method" title=".print_stats (class method)">.<strong>print_stats</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>–yjit-stats at_exit.</p></div>
    </div>
  </li>
</ul>
</div>  <!-- class_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="dump_trace_exits-class_method">
  <h3 class='signature priv first'>
    .<strong>dump_trace_exits</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>–yjit-trace-exits at_exit</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L110-L114'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='110' data-end='114'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 110</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dump_trace_exits'>dump_trace_exits</span>
  <span class='id identifier rubyid_filename'>filename</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Dir</span>.<span class='id identifier rubyid_pwd'>pwd</span><span class='embexpr_end'>}</span><span class='tstring_content'>/rjit_exit_locations.dump</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>File</span>.<span class='id identifier rubyid_binwrite'>binwrite</span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='const'>Marshal</span>.<span class='id identifier rubyid_dump'>dump</span>(<span class='id identifier rubyid_exit_traces'><a href="#exit_traces-class_method" title="RubyVM::RJIT.exit_traces (method)">exit_traces</a></span>))
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RJIT exit locations dumped to:\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename'>filename</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="exit_traces-class_method">
  <h3 class='signature priv'>
    .<strong>exit_traces</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Convert rb_rjit_raw_samples and rb_rjit_line_samples into a StackProf format.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L117-L189'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='117' data-end='189'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 117</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_exit_traces'>exit_traces</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rjit_exit_traces'>rjit_exit_traces</span>
  <span class='id identifier rubyid_raw_samples'>raw_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_raw'>raw</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_line_samples'>line_samples</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_frames'>frames</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_frames'>frames</span>].<span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_samples_count'>samples_count</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='comment'># Loop through the instructions and set the frame hash with the data.
</span>  <span class='comment'># We use nonexistent.def for the file name, otherwise insns.def will be displayed
</span>  <span class='comment'># and that information isn&#39;t useful in this context.
</span>  <span class='const'>RubyVM</span><span class='op'>::</span><span class='const'>INSTRUCTION_NAMES</span>.<span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_frame_id'>frame_id</span><span class='op'>|</span>
    <span class='id identifier rubyid_frame_hash'>frame_hash</span> <span class='op'>=</span> { <span class='label'>samples:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>total_samples:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>edges:</span> {}<span class='comma'>,</span> <span class='label'>name:</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>file:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nonexistent.def</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>line:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>lines:</span> {} }
    <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_frames'>frames</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_frame_hash'>frame_hash</span>
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>=</span> <span class='id identifier rubyid_frame_hash'>frame_hash</span>
  <span class='kw'>end</span>

  <span class='comment'># Loop through the raw_samples and build the hashes for StackProf.
</span>  <span class='comment'># The loop is based off an example in the StackProf documentation and therefore
</span>  <span class='comment'># this functionality can only work with that library.
</span>  <span class='comment'>#
</span>  <span class='comment'># Raw Samples:
</span>  <span class='comment'># [ length, frame1, frame2, frameN, ..., instruction, count
</span>  <span class='comment'>#
</span>  <span class='comment'># Line Samples
</span>  <span class='comment'># [ length, line_1, line_2, line_n, ..., dummy value, count
</span>  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>.<span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_stack_length'>stack_length</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_i'>i</span>] <span class='op'>+</span> <span class='int'>1</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='comment'># consume the stack length
</span>
    <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_stack_length'>stack_length</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>+=</span> <span class='id identifier rubyid_i'>i</span>
      <span class='id identifier rubyid_frame_id'>frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]

      <span class='kw'>if</span> <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>
        <span class='id identifier rubyid_prev_frame'>prev_frame</span> <span class='op'>=</span> <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>]
        <span class='id identifier rubyid_prev_frame'>prev_frame</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_edges'>edges</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>||=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_prev_frame'>prev_frame</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_edges'>edges</span>][<span class='id identifier rubyid_frame_id'>frame_id</span>] <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_frame_info'>frame_info</span> <span class='op'>=</span> <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_frame_id'>frame_id</span>]
      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_samples'>total_samples</span>] <span class='op'>+=</span> <span class='int'>1</span>

      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_line_samples'>line_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]] <span class='op'>||=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>]
      <span class='id identifier rubyid_frame_info'>frame_info</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_line_samples'>line_samples</span>[<span class='id identifier rubyid_idx'>idx</span>]][<span class='int'>0</span>] <span class='op'>+=</span> <span class='int'>1</span>

      <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_frame_id'>frame_id</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='id identifier rubyid_stack_length'>stack_length</span> <span class='comment'># consume the stack
</span>
    <span class='id identifier rubyid_top_frame_id'>top_frame_id</span> <span class='op'>=</span> <span class='id identifier rubyid_prev_frame_id'>prev_frame_id</span>
    <span class='id identifier rubyid_top_frame_line'>top_frame_line</span> <span class='op'>=</span> <span class='int'>1</span>

    <span class='id identifier rubyid_sample_count'>sample_count</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_samples'>raw_samples</span>[<span class='id identifier rubyid_i'>i</span>]

    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_samples'>samples</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>] <span class='op'>||=</span> {}
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_top_frame_line'>top_frame_line</span>] <span class='op'>||=</span> [<span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span>]
    <span class='id identifier rubyid_frames'>frames</span>[<span class='id identifier rubyid_top_frame_id'>top_frame_id</span>][<span class='symbeg'>:</span><span class='id identifier rubyid_lines'>lines</span>][<span class='id identifier rubyid_top_frame_line'>top_frame_line</span>][<span class='int'>1</span>] <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>

    <span class='id identifier rubyid_samples_count'>samples_count</span> <span class='op'>+=</span> <span class='id identifier rubyid_sample_count'>sample_count</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_samples'>samples</span>] <span class='op'>=</span> <span class='id identifier rubyid_samples_count'>samples_count</span>
  <span class='comment'># Set missed_samples and gc_samples to 0 as their values
</span>  <span class='comment'># don&#39;t matter to us in this context.
</span>  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_missed_samples'>missed_samples</span>] <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_results'>results</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_gc_samples'>gc_samples</span>] <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="format_number-class_method">
  <h3 class='signature priv'>
    .<strong>format_number</strong>(pad, number)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Format large numbers with comma separators for readability</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L102-L107'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='102' data-end='107'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 102</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_format_number'>format_number</span>(<span class='id identifier rubyid_pad'>pad</span><span class='comma'>,</span> <span class='id identifier rubyid_number'>number</span>)
  <span class='id identifier rubyid_integer'>integer</span><span class='comma'>,</span> <span class='id identifier rubyid_decimal'>decimal</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_split'>split</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_d_groups'>d_groups</span> <span class='op'>=</span> <span class='id identifier rubyid_integer'>integer</span>.<span class='id identifier rubyid_chars'>chars</span>.<span class='id identifier rubyid_reverse'>reverse</span>.<span class='id identifier rubyid_each_slice'>each_slice</span>(<span class='int'>3</span>)
  <span class='id identifier rubyid_with_commas'>with_commas</span> <span class='op'>=</span> <span class='id identifier rubyid_d_groups'>d_groups</span>.<span class='id identifier rubyid_map'>map</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_join'>join</span>).<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_reverse'>reverse</span>
  [<span class='id identifier rubyid_with_commas'>with_commas</span><span class='comma'>,</span> <span class='id identifier rubyid_decimal'>decimal</span>].<span class='id identifier rubyid_compact'>compact</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_rjust'>rjust</span>(<span class='id identifier rubyid_pad'>pad</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_counters-class_method">
  <h3 class='signature priv'>
    .<strong>print_counters</strong>(stats, prefix:, prompt:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L63-L83'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='63' data-end='83'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 63</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_counters'>print_counters</span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span><span class='comma'>,</span> <span class='label'>prompt:</span>)
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prompt'>prompt</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_filter'>filter</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='id identifier rubyid_prefix'>prefix</span>) }
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_filter!'>filter!</span> { <span class='op'>|</span><span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>!=</span> <span class='int'>0</span> }
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_transform_keys!'>transform_keys!</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_delete_prefix'>delete_prefix</span>(<span class='id identifier rubyid_prefix'>prefix</span>) }

  <span class='kw'>if</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    (all relevant counters are zero)</span><span class='tstring_end'>&quot;</span></span>)
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_counters'>counters</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_to_a'>to_a</span>
  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_sort_by!'>sort_by!</span> { <span class='op'>|</span>(<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_value'>counter_value</span>)<span class='op'>|</span> <span class='id identifier rubyid_counter_value'>counter_value</span> }
  <span class='id identifier rubyid_longest_name_length'>longest_name_length</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_max_by'>max_by</span> { <span class='op'>|</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span>)<span class='op'>|</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_length'>length</span> }.<span class='id identifier rubyid_first'>first</span>.<span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_sum'>sum</span> { <span class='op'>|</span>(<span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_value'>counter_value</span>)<span class='op'>|</span> <span class='id identifier rubyid_counter_value'>counter_value</span> }

  <span class='id identifier rubyid_counters'>counters</span>.<span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='kw'>do</span> <span class='op'>|</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)<span class='op'>|</span>
    <span class='id identifier rubyid_percentage'>percentage</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_fdiv'>fdiv</span>(<span class='id identifier rubyid_total'>total</span>) <span class='op'>*</span> <span class='int'>100</span>
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_printf'>printf</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>    %*s %s (%4.1f%%)\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_longest_name_length'>longest_name_length</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>10</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)<span class='comma'>,</span> <span class='id identifier rubyid_percentage'>percentage</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_exit_counts-class_method">
  <h3 class='signature priv'>
    .<strong>print_exit_counts</strong>(stats, how_many: 20, padding: 2)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L85-L99'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='85' data-end='99'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 85</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_exit_counts'>print_exit_counts</span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>how_many:</span> <span class='int'>20</span><span class='comma'>,</span> <span class='label'>padding:</span> <span class='int'>2</span>)
  <span class='id identifier rubyid_exits'>exits</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_filter_map'>filter_map</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> [<span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_to_s'>to_s</span>.<span class='id identifier rubyid_delete_prefix'>delete_prefix</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exit_</span><span class='tstring_end'>&#39;</span></span>)<span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span>] <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exit_</span><span class='tstring_end'>&#39;</span></span>) }.<span class='id identifier rubyid_to_h'>to_h</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_top_exits'>top_exits</span> <span class='op'>=</span> <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_sort_by'>sort_by</span> { <span class='op'>|</span><span class='id identifier rubyid__name'>_name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_count'>count</span> }.<span class='id identifier rubyid_first'>first</span>(<span class='id identifier rubyid_how_many'>how_many</span>).<span class='id identifier rubyid_to_h'>to_h</span>
  <span class='id identifier rubyid_total_exits'>total_exits</span> <span class='op'>=</span> <span class='id identifier rubyid_exits'>exits</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_sum'>sum</span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Top-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_top_exits'>top_exits</span>.<span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> most frequent exit ops (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format'>format</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.1f</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_top_exits'>top_exits</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_sum'>sum</span> <span class='op'>/</span> <span class='id identifier rubyid_total_exits'>total_exits</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>% of exits):</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_name_width'>name_width</span>  <span class='op'>=</span> <span class='id identifier rubyid_top_exits'>top_exits</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid__count'>_count</span><span class='op'>|</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_length'>length</span> }.<span class='id identifier rubyid_max'>max</span> <span class='op'>+</span> <span class='id identifier rubyid_padding'>padding</span>
  <span class='id identifier rubyid_count_width'>count_width</span> <span class='op'>=</span> <span class='id identifier rubyid_top_exits'>top_exits</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid__name'>_name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>10</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span>).<span class='id identifier rubyid_length'>length</span> }.<span class='id identifier rubyid_max'>max</span> <span class='op'>+</span> <span class='id identifier rubyid_padding'>padding</span>
  <span class='id identifier rubyid_top_exits'>top_exits</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span>
    <span class='id identifier rubyid_ratio'>ratio</span> <span class='op'>=</span> <span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>/</span> <span class='id identifier rubyid_total_exits'>total_exits</span>
    <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format'>format</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name_width'>name_width</span><span class='embexpr_end'>}</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='id identifier rubyid_count_width'>count_width</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span>)<span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format'>format</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%4.1f</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_ratio'>ratio</span>)<span class='embexpr_end'>}</span><span class='tstring_content'>%)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="print_stats-class_method">
  <h3 class='signature priv'>
    .<strong>print_stats</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>–yjit-stats at_exit</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L39-L61'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='39' data-end='61'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 39</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_print_stats'>print_stats</span>
  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime_stats'><a href="#runtime_stats-class_method" title="RubyVM::RJIT.runtime_stats (method)">runtime_stats</a></span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>***RJIT: Printing RJIT statistics on exit***</span><span class='tstring_end'>&quot;</span></span>)

  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>send_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method call exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokeblock_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokeblock exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokesuper_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>invokesuper exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getblockpp_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getblockparamproxy exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getivar_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>getinstancevariable exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>setivar_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>setinstancevariable exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>optaref_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>opt_aref exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>optgetconst_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>opt_getconstant_path exit reasons</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_print_counters'><a href="#print_counters-class_method" title="RubyVM::RJIT.print_counters (method)">print_counters</a></span>(<span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span> <span class='label'>prefix:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>expandarray_</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>prompt:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>expandarray exit reasons</span><span class='tstring_end'>&#39;</span></span>)

  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>compiled_block_count:  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>13</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_compiled_block_count'>compiled_block_count</span>])<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>side_exit_count:       </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>13</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_side_exit_count'>side_exit_count</span>])<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_insns_count:     </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>13</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>])<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>)
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vm_insns_count:        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>13</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>])<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>)
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rjit_insns_count:      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format_number'><a href="#format_number-class_method" title="RubyVM::RJIT.format_number (method)">format_number</a></span>(<span class='int'>13</span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_rjit_insns_count'>rjit_insns_count</span>])<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$stderr</span>.<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ratio_in_rjit:         </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_format'>format</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%12.1f</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_rjit'>ratio_in_rjit</span>])<span class='embexpr_end'>}</span><span class='tstring_content'>%</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_rjit'>ratio_in_rjit</span>)

  <span class='id identifier rubyid_print_exit_counts'><a href="#print_exit_counts-class_method" title="RubyVM::RJIT.print_exit_counts (method)">print_exit_counts</a></span>(<span class='id identifier rubyid_stats'>stats</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="runtime_stats-class_method">
  <h3 class='signature '>
    .<strong>runtime_stats</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return a Hash for RJIT statistics. --rjit-stats makes more information available.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/stats.rb#L4-L32'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4' data-end='32'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/stats.rb', line 4</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='kw'>self</span>.<span class='id identifier rubyid_runtime_stats'>runtime_stats</span>
  <span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> {}

  <span class='comment'># Insn exits
</span>  <span class='const'>INSNS</span>.<span class='id identifier rubyid_each_value'>each_value</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_insn'>insn</span><span class='op'>|</span>
    <span class='id identifier rubyid_exits'>exits</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rjit_insn_exits'>rjit_insn_exits</span>[<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_bin'>bin</span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_exits'>exits</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:&quot;</span><span class='tstring_content'>exit_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>=</span> <span class='id identifier rubyid_exits'>exits</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Runtime stats
</span>  <span class='const'>C</span>.<span class='id identifier rubyid_rb_rjit_runtime_counters'>rb_rjit_runtime_counters</span>.<span class='id identifier rubyid_members'>members</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_member'>member</span><span class='op'>|</span>
    <span class='id identifier rubyid_stats'>stats</span>[<span class='id identifier rubyid_member'>member</span>] <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_rjit_counters'>rb_rjit_counters</span>.<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_member'>member</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>] <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_insns_count'>rb_vm_insns_count</span>

  <span class='comment'># Other stats are calculated here
</span>  <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_side_exit_count'>side_exit_count</span>] <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_select'>select</span> { <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid__count'>_count</span><span class='op'>|</span> <span class='id identifier rubyid_name'>name</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exit_</span><span class='tstring_end'>&#39;</span></span>) }.<span class='id identifier rubyid_sum'>sum</span>(<span class='op'>&amp;</span><span class='symbeg'>:</span><span class='id identifier rubyid_last'>last</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>] <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_retired_in_rjit'>retired_in_rjit</span> <span class='op'>=</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_rjit_insns_count'>rjit_insns_count</span>] <span class='op'>-</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_side_exit_count'>side_exit_count</span>]
    <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>] <span class='op'>=</span> <span class='id identifier rubyid_retired_in_rjit'>retired_in_rjit</span> <span class='op'>+</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>]
    <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_ratio_in_rjit'>ratio_in_rjit</span>] <span class='op'>=</span> <span class='float'>100.0</span> <span class='op'>*</span> <span class='id identifier rubyid_retired_in_rjit'>retired_in_rjit</span> <span class='op'>/</span> <span class='id identifier rubyid_stats'>stats</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_total_insns_count'>total_insns_count</span>]
  <span class='kw'>else</span>
    <span class='id identifier rubyid_stats'>stats</span>.<span class='id identifier rubyid_delete'>delete</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_vm_insns_count'>vm_insns_count</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_stats'>stats</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>