<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: RubyVM::RJIT::InsnCompiler &mdash; ruby_vm  Ruby-3.4.6 p54</title>

<link rel='stylesheet'  type='text/css' href='../../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "RubyVM::RJIT::InsnCompiler",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../../'>Ruby-3.4.6</a> &raquo; 
      <a href='../../'>ruby_vm</a> &raquo; 
      <a href='../../_index.html#alpha_I'>Index (I)</a> &raquo; 
        RubyVM &raquo; 
        <a href="../RJIT.html" title="RubyVM::RJIT (module)">RJIT</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>InsnCompiler&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: RubyVM::RJIT::InsnCompiler</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="InsnCompiler/CallingInfo.html" title="RubyVM::RJIT::InsnCompiler::CallingInfo (class)"><code>CallingInfo</code></a>      </div>
    </td></tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3'>lib/ruby_vm/rjit/insn_compiler.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(cb, ocb, exit_compiler)  &#x21d2; InsnCompiler </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_attribute_summary'>Instance Attribute Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature ro priv'>
      <a href="#c_method_tracing_currently_enabled%3F-instance_method" title="#c_method_tracing_currently_enabled? (instance method)">#<strong>c_method_tracing_currently_enabled?</strong>  &#x21d2; Boolean </a>
    </span>
    <span class='note title readonly'>readonly</span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_attribute_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#compile-instance_method" title="#compile (instance method)">#<strong>compile</strong>(jit, ctx, asm, insn)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#adjuststack-instance_method" title="#adjuststack (instance method)">#<strong>adjuststack</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#anytostring-instance_method" title="#anytostring (instance method)">#<strong>anytostring</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#assert-instance_method" title="#assert (instance method)">#<strong>assert</strong>(cond)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#assert_equal-instance_method" title="#assert_equal (instance method)">#<strong>assert_equal</strong>(left, right)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#branchif-instance_method" title="#branchif (instance method)">#<strong>branchif</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#branchnil-instance_method" title="#branchnil (instance method)">#<strong>branchnil</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#branchunless-instance_method" title="#branchunless (instance method)">#<strong>branchunless</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#build_calling-instance_method" title="#build_calling (instance method)">#<strong>build_calling</strong>(ci:, block_handler:)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#builtin_function-instance_method" title="#builtin_function (instance method)">#<strong>builtin_function</strong>(iseq)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Return a builtin function if a given iseq consists of only that builtin function.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#checkkeyword-instance_method" title="#checkkeyword (instance method)">#<strong>checkkeyword</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compile_branchif-instance_method" title="#compile_branchif (instance method)">#<strong>compile_branchif</strong>(branch_stub)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Proc escapes arguments in memory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compile_branchnil-instance_method" title="#compile_branchnil (instance method)">#<strong>compile_branchnil</strong>(branch_stub)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Proc escapes arguments in memory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compile_branchunless-instance_method" title="#compile_branchunless (instance method)">#<strong>compile_branchunless</strong>(branch_stub)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Proc escapes arguments in memory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compile_jit_chain_guard-instance_method" title="#compile_jit_chain_guard (instance method)">#<strong>compile_jit_chain_guard</strong>(branch_stub, opcode:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Proc escapes arguments in memory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compile_jit_direct_jump-instance_method" title="#compile_jit_direct_jump (instance method)">#<strong>compile_jit_direct_jump</strong>(branch_stub, comment:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Proc escapes arguments in memory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#compile_jit_return-instance_method" title="#compile_jit_return (instance method)">#<strong>compile_jit_return</strong>(branch_stub, cfp_offset:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Proc escapes arguments in memory.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#concatarray-instance_method" title="#concatarray (instance method)">#<strong>concatarray</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#concatstrings-instance_method" title="#concatstrings (instance method)">#<strong>concatstrings</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#counted_exit-instance_method" title="#counted_exit (instance method)">#<strong>counted_exit</strong>(side_exit, name)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#def_iseq_ptr-instance_method" title="#def_iseq_ptr (instance method)">#<strong>def_iseq_ptr</strong>(cme_def)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#defer_compilation-instance_method" title="#defer_compilation (instance method)">#<strong>defer_compilation</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#defined-instance_method" title="#defined (instance method)">#<strong>defined</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#definedivar-instance_method" title="#definedivar (instance method)">#<strong>definedivar</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#dup-instance_method" title="#dup (instance method)">#<strong>dup</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#duparray-instance_method" title="#duparray (instance method)">#<strong>duparray</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#dupn-instance_method" title="#dupn (instance method)">#<strong>dupn</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#dynamic_symbol%3F-instance_method" title="#dynamic_symbol? (instance method)">#<strong>dynamic_symbol?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#ep_offset_to_local_idx-instance_method" title="#ep_offset_to_local_idx (instance method)">#<strong>ep_offset_to_local_idx</strong>(iseq, ep_offset)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Compute the index of a local variable from its slot index.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#expandarray-instance_method" title="#expandarray (instance method)">#<strong>expandarray</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#fixnum%3F-instance_method" title="#fixnum? (instance method)">#<strong>fixnum?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#flonum%3F-instance_method" title="#flonum? (instance method)">#<strong>flonum?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#full_cfunc_return-instance_method" title="#full_cfunc_return (instance method)">#<strong>full_cfunc_return</strong>  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#get_lvar_level-instance_method" title="#get_lvar_level (instance method)">#<strong>get_lvar_level</strong>(iseq)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>See get_lvar_level in compile.c.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getblockparam-instance_method" title="#getblockparam (instance method)">#<strong>getblockparam</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getblockparamproxy-instance_method" title="#getblockparamproxy (instance method)">#<strong>getblockparamproxy</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getclassvariable-instance_method" title="#getclassvariable (instance method)">#<strong>getclassvariable</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getconstant-instance_method" title="#getconstant (instance method)">#<strong>getconstant</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getglobal-instance_method" title="#getglobal (instance method)">#<strong>getglobal</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getinstancevariable-instance_method" title="#getinstancevariable (instance method)">#<strong>getinstancevariable</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getlocal-instance_method" title="#getlocal (instance method)">#<strong>getlocal</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getlocal_WC_0-instance_method" title="#getlocal_WC_0 (instance method)">#<strong>getlocal_WC_0</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getlocal_WC_1-instance_method" title="#getlocal_WC_1 (instance method)">#<strong>getlocal_WC_1</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#getspecial-instance_method" title="#getspecial (instance method)">#<strong>getspecial</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#guard_block_arg-instance_method" title="#guard_block_arg (instance method)">#<strong>guard_block_arg</strong>(jit, ctx, asm, calling)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_caller_setup_arg_block: Handle VM_CALL_ARGS_BLOCKARG cases.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#guard_object_is_array-instance_method" title="#guard_object_is_array (instance method)">#<strong>guard_object_is_array</strong>(jit, ctx, asm, object_reg, flags_reg, object_opnd, counter = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#guard_object_is_heap-instance_method" title="#guard_object_is_heap (instance method)">#<strong>guard_object_is_heap</strong>(jit, ctx, asm, object, object_opnd, counter = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#guard_object_is_not_ruby2_keyword_hash-instance_method" title="#guard_object_is_not_ruby2_keyword_hash (instance method)">#<strong>guard_object_is_not_ruby2_keyword_hash</strong>(asm, object_reg, flags_reg, side_exit)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>clobbers object_reg.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#guard_object_is_string-instance_method" title="#guard_object_is_string (instance method)">#<strong>guard_object_is_string</strong>(jit, ctx, asm, object_reg, flags_reg, object_opnd, counter = nil)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#guard_two_fixnums-instance_method" title="#guard_two_fixnums (instance method)">#<strong>guard_two_fixnums</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#handle_opt_send_shift_stack-instance_method" title="#handle_opt_send_shift_stack (instance method)">#<strong>handle_opt_send_shift_stack</strong>(asm, argc, ctx, send_shift:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_opt_send (lazy part).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#intern-instance_method" title="#intern (instance method)">#<strong>intern</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invokeblock-instance_method" title="#invokeblock (instance method)">#<strong>invokeblock</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#invokesuper-instance_method" title="#invokesuper (instance method)">#<strong>invokesuper</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_array_len-instance_method" title="#jit_array_len (instance method)">#<strong>jit_array_len</strong>(asm, array_reg, len_reg)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate RARRAY_LEN.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_array_ptr-instance_method" title="#jit_array_ptr (instance method)">#<strong>jit_array_ptr</strong>(asm, array_reg, ary_opnd)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate RARRAY_CONST_PTR (part of RARRAY_AREF).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_alias-instance_method" title="#jit_call_alias (instance method)">#<strong>jit_call_alias</strong>(jit, ctx, asm, calling, cme, comptime_recv, recv_opnd, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_alias.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_attrset-instance_method" title="#jit_call_attrset (instance method)">#<strong>jit_call_attrset</strong>(jit, ctx, asm, cme, calling, comptime_recv, recv_opnd)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_attrset.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_bmethod-instance_method" title="#jit_call_bmethod (instance method)">#<strong>jit_call_bmethod</strong>(jit, ctx, asm, calling, cme, comptime_recv, recv_opnd, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_bmethod.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_cfunc-instance_method" title="#jit_call_cfunc (instance method)">#<strong>jit_call_cfunc</strong>(jit, ctx, asm, cme, calling, known_recv_class: nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_cfunc.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_general-instance_method" title="#jit_call_general (instance method)">#<strong>jit_call_general</strong>(jit, ctx, asm, mid, calling, cme, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_general.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_iseq-instance_method" title="#jit_call_iseq (instance method)">#<strong>jit_call_iseq</strong>(jit, ctx, asm, cme, calling, iseq, frame_type: nil, prev_ep: nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_iseq_setup.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_ivar-instance_method" title="#jit_call_ivar (instance method)">#<strong>jit_call_ivar</strong>(jit, ctx, asm, cme, calling, comptime_recv, recv_opnd)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_ivar (+ part of vm_call_method_each_type).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_method-instance_method" title="#jit_call_method (instance method)">#<strong>jit_call_method</strong>(jit, ctx, asm, mid, calling, cme, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_method.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_method_each_type-instance_method" title="#jit_call_method_each_type (instance method)">#<strong>jit_call_method_each_type</strong>(jit, ctx, asm, calling, cme, comptime_recv, recv_opnd, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_method_each_type.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_opt_call-instance_method" title="#jit_call_opt_call (instance method)">#<strong>jit_call_opt_call</strong>(jit, ctx, asm, cme, flags, argc, block_handler, known_recv_class, send_shift:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_opt_call.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_opt_send-instance_method" title="#jit_call_opt_send (instance method)">#<strong>jit_call_opt_send</strong>(jit, ctx, asm, cme, calling, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_opt_send.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_opt_struct_aref-instance_method" title="#jit_call_opt_struct_aref (instance method)">#<strong>jit_call_opt_struct_aref</strong>(jit, ctx, asm, cme, flags, argc, block_handler, known_recv_class, send_shift:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_opt_struct_aref.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_optimized-instance_method" title="#jit_call_optimized (instance method)">#<strong>jit_call_optimized</strong>(jit, ctx, asm, cme, calling, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_optimized.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_call_symbol-instance_method" title="#jit_call_symbol (instance method)">#<strong>jit_call_symbol</strong>(jit, ctx, asm, cme, calling, known_recv_class, flags)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_call_symbol.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_caller_setup_arg-instance_method" title="#jit_caller_setup_arg (instance method)">#<strong>jit_caller_setup_arg</strong>(jit, ctx, asm, flags)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>CALLER_SETUP_ARG: Return CantCompile if not supported.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_chain_guard-instance_method" title="#jit_chain_guard (instance method)">#<strong>jit_chain_guard</strong>(opcode, jit, ctx, asm, side_exit, limit: 20)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_check_ints-instance_method" title="#jit_check_ints (instance method)">#<strong>jit_check_ints</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>rb_vm_check_ints.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_direct_jump-instance_method" title="#jit_direct_jump (instance method)">#<strong>jit_direct_jump</strong>(iseq, pc, ctx, asm, comment: &#39;jit_direct_jump&#39;)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_equality_specialized-instance_method" title="#jit_equality_specialized (instance method)">#<strong>jit_equality_specialized</strong>(jit, ctx, asm, gen_eq)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_fixnum_cmp-instance_method" title="#jit_fixnum_cmp (instance method)">#<strong>jit_fixnum_cmp</strong>(jit, ctx, asm, opcode:, bop:)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_get_ep-instance_method" title="#jit_get_ep (instance method)">#<strong>jit_get_ep</strong>(asm, level, reg:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_get_ep.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_get_lep-instance_method" title="#jit_get_lep (instance method)">#<strong>jit_get_lep</strong>(jit, asm, reg:)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>GET_LEP.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_getivar-instance_method" title="#jit_getivar (instance method)">#<strong>jit_getivar</strong>(jit, ctx, asm, comptime_obj, ivar_id, obj_opnd, obj_yarv_opnd)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_getivar.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_getlocal_generic-instance_method" title="#jit_getlocal_generic (instance method)">#<strong>jit_getlocal_generic</strong>(jit, ctx, asm, idx:, level:)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_guard_known_klass-instance_method" title="#jit_guard_known_klass (instance method)">#<strong>jit_guard_known_klass</strong>(jit, ctx, asm, known_klass, obj_opnd, insn_opnd, comptime_obj, side_exit, limit: 10)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_leaf_builtin_func-instance_method" title="#jit_leaf_builtin_func (instance method)">#<strong>jit_leaf_builtin_func</strong>(jit, ctx, asm, flags, iseq)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_obj_respond_to-instance_method" title="#jit_obj_respond_to (instance method)">#<strong>jit_obj_respond_to</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_prepare_routine_call-instance_method" title="#jit_prepare_routine_call (instance method)">#<strong>jit_prepare_routine_call</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>NOTE: This clobbers <code>:rax</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_protected_callee_ancestry_guard-instance_method" title="#jit_protected_callee_ancestry_guard (instance method)">#<strong>jit_protected_callee_ancestry_guard</strong>(asm, cme, side_exit)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Generate ancestry guard for protected callee.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_push_frame-instance_method" title="#jit_push_frame (instance method)">#<strong>jit_push_frame</strong>(jit, ctx, asm, cme, flags, argc, frame_type, block_handler, iseq: nil, local_size: 0, stack_max: 0, prev_ep: nil, doing_kw_call: nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_push_frame.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_ary_empty_p-instance_method" title="#jit_rb_ary_empty_p (instance method)">#<strong>jit_rb_ary_empty_p</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_ary_push-instance_method" title="#jit_rb_ary_push (instance method)">#<strong>jit_rb_ary_push</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_f_block_given_p-instance_method" title="#jit_rb_f_block_given_p (instance method)">#<strong>jit_rb_f_block_given_p</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_false-instance_method" title="#jit_rb_false (instance method)">#<strong>jit_rb_false</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_int_aref-instance_method" title="#jit_rb_int_aref (instance method)">#<strong>jit_rb_int_aref</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_int_div-instance_method" title="#jit_rb_int_div (instance method)">#<strong>jit_rb_int_div</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_int_equal-instance_method" title="#jit_rb_int_equal (instance method)">#<strong>jit_rb_int_equal</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_int_mul-instance_method" title="#jit_rb_int_mul (instance method)">#<strong>jit_rb_int_mul</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_kernel_instance_of-instance_method" title="#jit_rb_kernel_instance_of (instance method)">#<strong>jit_rb_kernel_instance_of</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_kernel_is_a-instance_method" title="#jit_rb_kernel_is_a (instance method)">#<strong>jit_rb_kernel_is_a</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_mod_eqq-instance_method" title="#jit_rb_mod_eqq (instance method)">#<strong>jit_rb_mod_eqq</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_obj_equal-instance_method" title="#jit_rb_obj_equal (instance method)">#<strong>jit_rb_obj_equal</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_obj_not-instance_method" title="#jit_rb_obj_not (instance method)">#<strong>jit_rb_obj_not</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_obj_not_equal-instance_method" title="#jit_rb_obj_not_equal (instance method)">#<strong>jit_rb_obj_not_equal</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_str_bytesize-instance_method" title="#jit_rb_str_bytesize (instance method)">#<strong>jit_rb_str_bytesize</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_str_concat-instance_method" title="#jit_rb_str_concat (instance method)">#<strong>jit_rb_str_concat</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_str_empty_p-instance_method" title="#jit_rb_str_empty_p (instance method)">#<strong>jit_rb_str_empty_p</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_str_getbyte-instance_method" title="#jit_rb_str_getbyte (instance method)">#<strong>jit_rb_str_getbyte</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_str_to_s-instance_method" title="#jit_rb_str_to_s (instance method)">#<strong>jit_rb_str_to_s</strong>(jit, ctx, asm, argc, known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_str_uplus-instance_method" title="#jit_rb_str_uplus (instance method)">#<strong>jit_rb_str_uplus</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_rb_true-instance_method" title="#jit_rb_true (instance method)">#<strong>jit_rb_true</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_save_pc-instance_method" title="#jit_save_pc (instance method)">#<strong>jit_save_pc</strong>(jit, asm, comment: &#39;save PC to CFP&#39;)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>NOTE: This clobbers <code>:rax</code>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_save_sp-instance_method" title="#jit_save_sp (instance method)">#<strong>jit_save_sp</strong>(ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_search_method-instance_method" title="#jit_search_method (instance method)">#<strong>jit_search_method</strong>(jit, ctx, asm, mid, calling)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_search_method.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_setlocal_generic-instance_method" title="#jit_setlocal_generic (instance method)">#<strong>jit_setlocal_generic</strong>(jit, ctx, asm, idx:, level:)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_thread_s_current-instance_method" title="#jit_thread_s_current (instance method)">#<strong>jit_thread_s_current</strong>(jit, ctx, asm, argc, _known_recv_class)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jit_write_iv-instance_method" title="#jit_write_iv (instance method)">#<strong>jit_write_iv</strong>(asm, comptime_receiver, recv_reg, temp_reg, ivar_index, set_value, needs_extension)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jump-instance_method" title="#jump (instance method)">#<strong>jump</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#jump_to_next_insn-instance_method" title="#jump_to_next_insn (instance method)">#<strong>jump_to_next_insn</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#leave-instance_method" title="#leave (instance method)">#<strong>leave</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#lookup_cfunc_codegen-instance_method" title="#lookup_cfunc_codegen (instance method)">#<strong>lookup_cfunc_codegen</strong>(cme_def)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#move_rest_args_to_stack-instance_method" title="#move_rest_args_to_stack (instance method)">#<strong>move_rest_args_to_stack</strong>(array, num_args, jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Pushes arguments from an array to the stack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#newarray-instance_method" title="#newarray (instance method)">#<strong>newarray</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#newhash-instance_method" title="#newhash (instance method)">#<strong>newhash</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#newrange-instance_method" title="#newrange (instance method)">#<strong>newrange</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#nop-instance_method" title="#nop (instance method)">#<strong>nop</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#objtostring-instance_method" title="#objtostring (instance method)">#<strong>objtostring</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_and-instance_method" title="#opt_and (instance method)">#<strong>opt_and</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_aref-instance_method" title="#opt_aref (instance method)">#<strong>opt_aref</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_ary_freeze-instance_method" title="#opt_ary_freeze (instance method)">#<strong>opt_ary_freeze</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_aset-instance_method" title="#opt_aset (instance method)">#<strong>opt_aset</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_case_dispatch-instance_method" title="#opt_case_dispatch (instance method)">#<strong>opt_case_dispatch</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_div-instance_method" title="#opt_div (instance method)">#<strong>opt_div</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_empty_p-instance_method" title="#opt_empty_p (instance method)">#<strong>opt_empty_p</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_eq-instance_method" title="#opt_eq (instance method)">#<strong>opt_eq</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_ge-instance_method" title="#opt_ge (instance method)">#<strong>opt_ge</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_getconstant_path-instance_method" title="#opt_getconstant_path (instance method)">#<strong>opt_getconstant_path</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_gt-instance_method" title="#opt_gt (instance method)">#<strong>opt_gt</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_hash_freeze-instance_method" title="#opt_hash_freeze (instance method)">#<strong>opt_hash_freeze</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_invokebuiltin_delegate-instance_method" title="#opt_invokebuiltin_delegate (instance method)">#<strong>opt_invokebuiltin_delegate</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_invokebuiltin_delegate_leave-instance_method" title="#opt_invokebuiltin_delegate_leave (instance method)">#<strong>opt_invokebuiltin_delegate_leave</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_le-instance_method" title="#opt_le (instance method)">#<strong>opt_le</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_length-instance_method" title="#opt_length (instance method)">#<strong>opt_length</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_lt-instance_method" title="#opt_lt (instance method)">#<strong>opt_lt</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_ltlt-instance_method" title="#opt_ltlt (instance method)">#<strong>opt_ltlt</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_minus-instance_method" title="#opt_minus (instance method)">#<strong>opt_minus</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_mod-instance_method" title="#opt_mod (instance method)">#<strong>opt_mod</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_mult-instance_method" title="#opt_mult (instance method)">#<strong>opt_mult</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_neq-instance_method" title="#opt_neq (instance method)">#<strong>opt_neq</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_newarray_hash-instance_method" title="#opt_newarray_hash (instance method)">#<strong>opt_newarray_hash</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_newarray_max-instance_method" title="#opt_newarray_max (instance method)">#<strong>opt_newarray_max</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_newarray_min-instance_method" title="#opt_newarray_min (instance method)">#<strong>opt_newarray_min</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_newarray_send-instance_method" title="#opt_newarray_send (instance method)">#<strong>opt_newarray_send</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_nil_p-instance_method" title="#opt_nil_p (instance method)">#<strong>opt_nil_p</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_not-instance_method" title="#opt_not (instance method)">#<strong>opt_not</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_or-instance_method" title="#opt_or (instance method)">#<strong>opt_or</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_plus-instance_method" title="#opt_plus (instance method)">#<strong>opt_plus</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_regexpmatch2-instance_method" title="#opt_regexpmatch2 (instance method)">#<strong>opt_regexpmatch2</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_send_without_block-instance_method" title="#opt_send_without_block (instance method)">#<strong>opt_send_without_block</strong>(jit, ctx, asm, cd: C.rb_call_data.new(jit.operand(0)))  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_size-instance_method" title="#opt_size (instance method)">#<strong>opt_size</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_str_freeze-instance_method" title="#opt_str_freeze (instance method)">#<strong>opt_str_freeze</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#opt_succ-instance_method" title="#opt_succ (instance method)">#<strong>opt_succ</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#pop-instance_method" title="#pop (instance method)">#<strong>pop</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#push_splat_args-instance_method" title="#push_splat_args (instance method)">#<strong>push_splat_args</strong>(required_args, jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>vm_caller_setup_arg_splat (+ CALLER_SETUP_ARG): Pushes arguments from an array to the stack that are passed with a splat (i.e. *args).</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putchilledstring-instance_method" title="#putchilledstring (instance method)">#<strong>putchilledstring</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putnil-instance_method" title="#putnil (instance method)">#<strong>putnil</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putobject-instance_method" title="#putobject (instance method)">#<strong>putobject</strong>(jit, ctx, asm, val: jit.operand(0))  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putobject_INT2FIX_0_-instance_method" title="#putobject_INT2FIX_0_ (instance method)">#<strong>putobject_INT2FIX_0_</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putobject_INT2FIX_1_-instance_method" title="#putobject_INT2FIX_1_ (instance method)">#<strong>putobject_INT2FIX_1_</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putself-instance_method" title="#putself (instance method)">#<strong>putself</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putspecialobject-instance_method" title="#putspecialobject (instance method)">#<strong>putspecialobject</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#putstring-instance_method" title="#putstring (instance method)">#<strong>putstring</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#register_cfunc_codegen_funcs-instance_method" title="#register_cfunc_codegen_funcs (instance method)">#<strong>register_cfunc_codegen_funcs</strong>  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Helpers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#register_cfunc_method-instance_method" title="#register_cfunc_method (instance method)">#<strong>register_cfunc_method</strong>(klass, mid_sym, func)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#send-instance_method" title="#send (instance method)">#<strong>send</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setclassvariable-instance_method" title="#setclassvariable (instance method)">#<strong>setclassvariable</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setinstancevariable-instance_method" title="#setinstancevariable (instance method)">#<strong>setinstancevariable</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setlocal-instance_method" title="#setlocal (instance method)">#<strong>setlocal</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setlocal_WC_0-instance_method" title="#setlocal_WC_0 (instance method)">#<strong>setlocal_WC_0</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setlocal_WC_1-instance_method" title="#setlocal_WC_1 (instance method)">#<strong>setlocal_WC_1</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#setn-instance_method" title="#setn (instance method)">#<strong>setn</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#shape_too_complex%3F-instance_method" title="#shape_too_complex? (instance method)">#<strong>shape_too_complex?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#side_exit-instance_method" title="#side_exit (instance method)">#<strong>side_exit</strong>(jit, ctx)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#slot_to_local_idx-instance_method" title="#slot_to_local_idx (instance method)">#<strong>slot_to_local_idx</strong>(iseq, slot_idx)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Compute the index of a local variable from its slot index.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#splatarray-instance_method" title="#splatarray (instance method)">#<strong>splatarray</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#stack_swap-instance_method" title="#stack_swap (instance method)">#<strong>stack_swap</strong>(_jit, ctx, asm, offset0, offset1)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#static_symbol%3F-instance_method" title="#static_symbol? (instance method)">#<strong>static_symbol?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#swap-instance_method" title="#swap (instance method)">#<strong>swap</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#symbol%3F-instance_method" title="#symbol? (instance method)">#<strong>symbol?</strong>(obj)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#throw-instance_method" title="#throw (instance method)">#<strong>throw</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#to_value-instance_method" title="#to_value (instance method)">#<strong>to_value</strong>(obj)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#topn-instance_method" title="#topn (instance method)">#<strong>topn</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#toregexp-instance_method" title="#toregexp (instance method)">#<strong>toregexp</strong>(jit, ctx, asm)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#two_fixnums_on_stack%3F-instance_method" title="#two_fixnums_on_stack? (instance method)">#<strong>two_fixnums_on_stack?</strong>(jit)  &#x21d2; Boolean </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature  first'>
    .<strong>new</strong>(cb, ocb, exit_compiler)  &#x21d2; <code>InsnCompiler</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>ocb</span>
    <span class='type'>(<a href="CodeBlock.html" title="RubyVM::RJIT::CodeBlock (class)">CodeBlock</a>)</span>
  </li>
  <li>
    <span class='name'>exit_compiler</span>
    <span class='type'>(<a href="ExitCompiler.html" title="RubyVM::RJIT::ExitCompiler (class)">RubyVM::RJIT::ExitCompiler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L11-L17'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='11' data-end='17'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 11</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_cb'>cb</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb'>ocb</span><span class='comma'>,</span> <span class='id identifier rubyid_exit_compiler'>exit_compiler</span>)
  <span class='ivar'>@ocb</span> <span class='op'>=</span> <span class='id identifier rubyid_ocb'>ocb</span>
  <span class='ivar'>@exit_compiler</span> <span class='op'>=</span> <span class='id identifier rubyid_exit_compiler'>exit_compiler</span>

  <span class='ivar'>@cfunc_codegen_table</span> <span class='op'>=</span> {}
  <span class='id identifier rubyid_register_cfunc_codegen_funcs'><a href="#register_cfunc_codegen_funcs-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_codegen_funcs (method)">register_cfunc_codegen_funcs</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Attribute Details</h2>
<section class='method_details first' id="c_method_tracing_currently_enabled?-instance_method">
  <h3 class='signature ro priv first'>
    #<strong>c_method_tracing_currently_enabled?</strong>  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='readonly'>readonly</span>, <span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L6020-L6022'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='6020' data-end='6022'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 6020</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_c_method_tracing_currently_enabled?'>c_method_tracing_currently_enabled?</span>
  <span class='const'>C</span>.<span class='id identifier rubyid_rb_rjit_global_events'>rb_rjit_global_events</span> <span class='op'>&amp;</span> (<span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_EVENT_C_CALL</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_EVENT_C_RETURN</span>) <span class='op'>!=</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="adjuststack-instance_method">
  <h3 class='signature priv first'>
    #<strong>adjuststack</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1255-L1259'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1255' data-end='1259'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1255</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_adjuststack'>adjuststack</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="anytostring-instance_method">
  <h3 class='signature priv'>
    #<strong>anytostring</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L836-L852'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='836' data-end='852'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 836</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_anytostring'>anytostring</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Save the PC and SP since we might call #to_s
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_obj_as_string_result'>rb_obj_as_string_result</span>)

  <span class='comment'># Push the return value
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="assert-instance_method">
  <h3 class='signature priv'>
    #<strong>assert</strong>(cond)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5908-L5910'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5908' data-end='5910'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5908</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assert'>assert</span>(<span class='id identifier rubyid_cond'>cond</span>)
  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='id identifier rubyid_cond'>cond</span><span class='comma'>,</span> <span class='kw'>true</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="assert_equal-instance_method">
  <h3 class='signature priv'>
    #<strong>assert_equal</strong>(left, right)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5912-L5916'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5912' data-end='5916'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5912</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_assert_equal'>assert_equal</span>(<span class='id identifier rubyid_left'>left</span><span class='comma'>,</span> <span class='id identifier rubyid_right'>right</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_left'>left</span> <span class='op'>!=</span> <span class='id identifier rubyid_right'>right</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_left'>left</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; was not &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_right'>right</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="branchif-instance_method">
  <h3 class='signature priv'>
    #<strong>branchif</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1950-L1993'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1950' data-end='1993'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1950</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_branchif'>branchif</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Check for interrupts, but only on backward branches that may create loops
</span>  <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>signed:</span> <span class='kw'>true</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_jit_check_ints'><a href="#jit_check_ints-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_check_ints (method)">jit_check_ints</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='comment'># Get the branch target instruction offsets
</span>  <span class='id identifier rubyid_next_pc'>next_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span>
  <span class='id identifier rubyid_jump_pc'>jump_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>+</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span>)

  <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
  <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='kw'>if</span> (<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_known_truthy'>known_truthy</span>) <span class='op'>!=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_target_pc'>target_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>?</span> <span class='id identifier rubyid_jump_pc'>jump_pc</span> <span class='op'>:</span> <span class='id identifier rubyid_next_pc'>next_pc</span>
    <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_target_pc'>target_pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>else</span>
    <span class='comment'># This `test` sets ZF only for Qnil and Qfalse, which let jz jump.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_val_opnd'>val_opnd</span><span class='comma'>,</span> <span class='op'>~</span><span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)

    <span class='comment'># Set stubs
</span>    <span class='id identifier rubyid_branch_stub'>branch_stub</span> <span class='op'>=</span> <span class='const'><a href="BranchStub.html" title="RubyVM::RJIT::BranchStub (class)">BranchStub</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
      <span class='label'>iseq:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
      <span class='label'>shape:</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span><span class='comma'>,</span>
      <span class='label'>target0:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_jump_pc'>jump_pc</span>)<span class='comma'>,</span> <span class='comment'># branch target
</span>      <span class='label'>target1:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_next_pc'>next_pc</span>)<span class='comma'>,</span> <span class='comment'># fallthrough
</span>    )
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>true</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>false</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>

    <span class='comment'># Jump to target0 on jnz
</span>    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span> <span class='op'>=</span> <span class='id identifier rubyid_compile_branchif'><a href="#compile_branchif-instance_method" title="RubyVM::RJIT::InsnCompiler#compile_branchif (method)">compile_branchif</a></span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>)
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="branchnil-instance_method">
  <h3 class='signature priv'>
    #<strong>branchnil</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2080-L2122'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2080' data-end='2122'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2080</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_branchnil'>branchnil</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Check for interrupts, but only on backward branches that may create loops
</span>  <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>signed:</span> <span class='kw'>true</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_jit_check_ints'><a href="#jit_check_ints-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_check_ints (method)">jit_check_ints</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='comment'># Get the branch target instruction offsets
</span>  <span class='id identifier rubyid_next_pc'>next_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span>
  <span class='id identifier rubyid_jump_pc'>jump_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>+</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span>)

  <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
  <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='kw'>if</span> (<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_known_nil'>known_nil</span>) <span class='op'>!=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_target_pc'>target_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>?</span> <span class='id identifier rubyid_jump_pc'>jump_pc</span> <span class='op'>:</span> <span class='id identifier rubyid_next_pc'>next_pc</span>
    <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_target_pc'>target_pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_val_opnd'>val_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)

    <span class='comment'># Set stubs
</span>    <span class='id identifier rubyid_branch_stub'>branch_stub</span> <span class='op'>=</span> <span class='const'><a href="BranchStub.html" title="RubyVM::RJIT::BranchStub (class)">BranchStub</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
      <span class='label'>iseq:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
      <span class='label'>shape:</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span><span class='comma'>,</span>
      <span class='label'>target0:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_jump_pc'>jump_pc</span>)<span class='comma'>,</span> <span class='comment'># branch target
</span>      <span class='label'>target1:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_next_pc'>next_pc</span>)<span class='comma'>,</span> <span class='comment'># fallthrough
</span>    )
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>true</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>false</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>

    <span class='comment'># Jump to target0 on je
</span>    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span> <span class='op'>=</span> <span class='id identifier rubyid_compile_branchnil'><a href="#compile_branchnil-instance_method" title="RubyVM::RJIT::InsnCompiler#compile_branchnil (method)">compile_branchnil</a></span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>)
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="branchunless-instance_method">
  <h3 class='signature priv'>
    #<strong>branchunless</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2015-L2058'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2015' data-end='2058'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2015</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_branchunless'>branchunless</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Check for interrupts, but only on backward branches that may create loops
</span>  <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>signed:</span> <span class='kw'>true</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_jit_check_ints'><a href="#jit_check_ints-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_check_ints (method)">jit_check_ints</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='comment'># Get the branch target instruction offsets
</span>  <span class='id identifier rubyid_next_pc'>next_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span>
  <span class='id identifier rubyid_jump_pc'>jump_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>+</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span>)

  <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
  <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='kw'>if</span> (<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_known_truthy'>known_truthy</span>) <span class='op'>!=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_target_pc'>target_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>?</span> <span class='id identifier rubyid_next_pc'>next_pc</span> <span class='op'>:</span> <span class='id identifier rubyid_jump_pc'>jump_pc</span>
    <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_target_pc'>target_pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>else</span>
    <span class='comment'># This `test` sets ZF only for Qnil and Qfalse, which let jz jump.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_val_opnd'>val_opnd</span><span class='comma'>,</span> <span class='op'>~</span><span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)

    <span class='comment'># Set stubs
</span>    <span class='id identifier rubyid_branch_stub'>branch_stub</span> <span class='op'>=</span> <span class='const'><a href="BranchStub.html" title="RubyVM::RJIT::BranchStub (class)">BranchStub</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
      <span class='label'>iseq:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
      <span class='label'>shape:</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span><span class='comma'>,</span>
      <span class='label'>target0:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_jump_pc'>jump_pc</span>)<span class='comma'>,</span> <span class='comment'># branch target
</span>      <span class='label'>target1:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_next_pc'>next_pc</span>)<span class='comma'>,</span> <span class='comment'># fallthrough
</span>    )
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>true</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>false</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>

    <span class='comment'># Jump to target0 on jz
</span>    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span> <span class='op'>=</span> <span class='id identifier rubyid_compile_branchunless'><a href="#compile_branchunless-instance_method" title="RubyVM::RJIT::InsnCompiler#compile_branchunless (method)">compile_branchunless</a></span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>)
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="build_calling-instance_method">
  <h3 class='signature priv'>
    #<strong>build_calling</strong>(ci:, block_handler:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L6035-L6044'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='6035' data-end='6044'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 6035</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_build_calling'>build_calling</span>(<span class='label'>ci:</span><span class='comma'>,</span> <span class='label'>block_handler:</span>)
  <span class='const'><a href="InsnCompiler/CallingInfo.html" title="RubyVM::RJIT::InsnCompiler::CallingInfo (class)">CallingInfo</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
    <span class='label'>argc:</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_argc'>vm_ci_argc</span>(<span class='id identifier rubyid_ci'>ci</span>)<span class='comma'>,</span>
    <span class='label'>flags:</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_flag'>vm_ci_flag</span>(<span class='id identifier rubyid_ci'>ci</span>)<span class='comma'>,</span>
    <span class='label'>kwarg:</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_kwarg'>vm_ci_kwarg</span>(<span class='id identifier rubyid_ci'>ci</span>)<span class='comma'>,</span>
    <span class='label'>ci_addr:</span> <span class='id identifier rubyid_ci'>ci</span>.<span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
    <span class='label'>send_shift:</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='label'>block_handler:</span><span class='comma'>,</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="builtin_function-instance_method">
  <h3 class='signature priv'>
    #<strong>builtin_function</strong>(iseq)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Return a builtin function if a given iseq consists of only that builtin function</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L6025-L6033'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='6025' data-end='6033'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 6025</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_builtin_function'>builtin_function</span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span> <span class='op'>=</span> <span class='const'>INSNS</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_find'>find</span> { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span> }
  <span class='id identifier rubyid_leave'><a href="#leave-instance_method" title="RubyVM::RJIT::InsnCompiler#leave (method)">leave</a></span> <span class='op'>=</span> <span class='const'>INSNS</span>.<span class='id identifier rubyid_values'>values</span>.<span class='id identifier rubyid_find'>find</span> { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span>.<span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_leave'><a href="#leave-instance_method" title="RubyVM::RJIT::InsnCompiler#leave (method)">leave</a></span> }
  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq_size'>iseq_size</span> <span class='op'>==</span> <span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>+</span> <span class='id identifier rubyid_leave'><a href="#leave-instance_method" title="RubyVM::RJIT::InsnCompiler#leave (method)">leave</a></span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>&amp;&amp;</span>
      <span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_insn_decode'>rb_vm_insn_decode</span>(<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq_encoded'>iseq_encoded</span>[<span class='int'>0</span>]) <span class='op'>==</span> <span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span>.<span class='id identifier rubyid_bin'>bin</span> <span class='op'>&amp;&amp;</span>
      <span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_insn_decode'>rb_vm_insn_decode</span>(<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq_encoded'>iseq_encoded</span>[<span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span>.<span class='id identifier rubyid_len'>len</span>]) <span class='op'>==</span> <span class='id identifier rubyid_leave'><a href="#leave-instance_method" title="RubyVM::RJIT::InsnCompiler#leave (method)">leave</a></span>.<span class='id identifier rubyid_bin'>bin</span>
    <span class='const'>C</span>.<span class='id identifier rubyid_rb_builtin_function'>rb_builtin_function</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq_encoded'>iseq_encoded</span>[<span class='int'>1</span>])
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="checkkeyword-instance_method">
  <h3 class='signature priv'>
    #<strong>checkkeyword</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1379-L1413'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1379' data-end='1413'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1379</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_checkkeyword'>checkkeyword</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># When a keyword is unspecified past index 32, a hash will be used
</span>  <span class='comment'># instead. This can only happen in iseqs taking more than 32 keywords.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_num'>num</span> <span class='op'>&gt;=</span> <span class='int'>32</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># The EP offset to the undefined bits local
</span>  <span class='id identifier rubyid_bits_offset'>bits_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># The index of the keyword we want to check
</span>  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='label'>signed:</span> <span class='kw'>true</span>)

  <span class='comment'># Load environment pointer EP
</span>  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)

  <span class='comment'># VALUE kw_bits = *(ep - bits)
</span>  <span class='id identifier rubyid_bits_opnd'>bits_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='op'>-</span><span class='id identifier rubyid_bits_offset'>bits_offset</span>]

  <span class='comment'># unsigned int b = (unsigned int)FIX2ULONG(kw_bits);
</span>  <span class='comment'># if ((b &amp; (0x01 &lt;&lt; idx))) {
</span>  <span class='comment'>#
</span>  <span class='comment'># We can skip the FIX2ULONG conversion by shifting the bit we test
</span>  <span class='id identifier rubyid_bit_test'>bit_test</span> <span class='op'>=</span> <span class='int'>0x01</span> <span class='op'>&lt;&lt;</span> (<span class='id identifier rubyid_index'>index</span> <span class='op'>+</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_bits_opnd'>bits_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_bit_test'>bit_test</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovz'>cmovz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile-instance_method">
  <h3 class='signature '>
    #<strong>compile</strong>(jit, ctx, asm, insn)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
  <li>
    <span class='name'>insn</span>
    <span class='type'>(<code>RubyVM::RJIT::Instruction</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L23-L143'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='23' data-end='143'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 23</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile'>compile</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_insn'>insn</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rjit_insns_count'>rjit_insns_count</span>)

  <span class='id identifier rubyid_stack'>stack</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_size'>stack_size</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_stack_idx'>stack_idx</span><span class='op'>|</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_size'>stack_size</span> <span class='op'>-</span> <span class='id identifier rubyid_stack_idx'>stack_idx</span> <span class='op'>-</span> <span class='int'>1</span>]).<span class='id identifier rubyid_type'>type</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_locals'>locals</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_table_size'>local_table_size</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_local_idx'>local_idx</span><span class='op'>|</span>
    (<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_local_types'>local_types</span>[<span class='id identifier rubyid_local_idx'>local_idx</span>] <span class='op'>||</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>).<span class='id identifier rubyid_type'>type</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_insn_idx'>insn_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_format'>format</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%04d</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> (<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span>.<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>-</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq_encoded'>iseq_encoded</span>.<span class='id identifier rubyid_to_i'>to_i</span>) <span class='op'>/</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Insn: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_insn_idx'>insn_idx</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> (stack: [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_stack'>stack</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>], locals: [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_locals'>locals</span>.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span>)<span class='embexpr_end'>}</span><span class='tstring_content'>])</span><span class='tstring_end'>&quot;</span></span>)

  <span class='comment'># 83/102
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_name'>name</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_nop'><a href="#nop-instance_method" title="RubyVM::RJIT::InsnCompiler#nop (method)">nop</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_nop'><a href="#nop-instance_method" title="RubyVM::RJIT::InsnCompiler#nop (method)">nop</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getlocal'><a href="#getlocal-instance_method" title="RubyVM::RJIT::InsnCompiler#getlocal (method)">getlocal</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getlocal'><a href="#getlocal-instance_method" title="RubyVM::RJIT::InsnCompiler#getlocal (method)">getlocal</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setlocal'><a href="#setlocal-instance_method" title="RubyVM::RJIT::InsnCompiler#setlocal (method)">setlocal</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_setlocal'><a href="#setlocal-instance_method" title="RubyVM::RJIT::InsnCompiler#setlocal (method)">setlocal</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getblockparam'><a href="#getblockparam-instance_method" title="RubyVM::RJIT::InsnCompiler#getblockparam (method)">getblockparam</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getblockparam'><a href="#getblockparam-instance_method" title="RubyVM::RJIT::InsnCompiler#getblockparam (method)">getblockparam</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># setblockparam
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getblockparamproxy'><a href="#getblockparamproxy-instance_method" title="RubyVM::RJIT::InsnCompiler#getblockparamproxy (method)">getblockparamproxy</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getblockparamproxy'><a href="#getblockparamproxy-instance_method" title="RubyVM::RJIT::InsnCompiler#getblockparamproxy (method)">getblockparamproxy</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getspecial'><a href="#getspecial-instance_method" title="RubyVM::RJIT::InsnCompiler#getspecial (method)">getspecial</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getspecial'><a href="#getspecial-instance_method" title="RubyVM::RJIT::InsnCompiler#getspecial (method)">getspecial</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># setspecial
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getinstancevariable'><a href="#getinstancevariable-instance_method" title="RubyVM::RJIT::InsnCompiler#getinstancevariable (method)">getinstancevariable</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getinstancevariable'><a href="#getinstancevariable-instance_method" title="RubyVM::RJIT::InsnCompiler#getinstancevariable (method)">getinstancevariable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setinstancevariable'><a href="#setinstancevariable-instance_method" title="RubyVM::RJIT::InsnCompiler#setinstancevariable (method)">setinstancevariable</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_setinstancevariable'><a href="#setinstancevariable-instance_method" title="RubyVM::RJIT::InsnCompiler#setinstancevariable (method)">setinstancevariable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getclassvariable'><a href="#getclassvariable-instance_method" title="RubyVM::RJIT::InsnCompiler#getclassvariable (method)">getclassvariable</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getclassvariable'><a href="#getclassvariable-instance_method" title="RubyVM::RJIT::InsnCompiler#getclassvariable (method)">getclassvariable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setclassvariable'><a href="#setclassvariable-instance_method" title="RubyVM::RJIT::InsnCompiler#setclassvariable (method)">setclassvariable</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_setclassvariable'><a href="#setclassvariable-instance_method" title="RubyVM::RJIT::InsnCompiler#setclassvariable (method)">setclassvariable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_getconstant_path'><a href="#opt_getconstant_path-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_getconstant_path (method)">opt_getconstant_path</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_getconstant_path'><a href="#opt_getconstant_path-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_getconstant_path (method)">opt_getconstant_path</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getconstant'><a href="#getconstant-instance_method" title="RubyVM::RJIT::InsnCompiler#getconstant (method)">getconstant</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getconstant'><a href="#getconstant-instance_method" title="RubyVM::RJIT::InsnCompiler#getconstant (method)">getconstant</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># setconstant
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getglobal'><a href="#getglobal-instance_method" title="RubyVM::RJIT::InsnCompiler#getglobal (method)">getglobal</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getglobal'><a href="#getglobal-instance_method" title="RubyVM::RJIT::InsnCompiler#getglobal (method)">getglobal</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># setglobal
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putnil'><a href="#putnil-instance_method" title="RubyVM::RJIT::InsnCompiler#putnil (method)">putnil</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putnil'><a href="#putnil-instance_method" title="RubyVM::RJIT::InsnCompiler#putnil (method)">putnil</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putself'><a href="#putself-instance_method" title="RubyVM::RJIT::InsnCompiler#putself (method)">putself</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putself'><a href="#putself-instance_method" title="RubyVM::RJIT::InsnCompiler#putself (method)">putself</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putspecialobject'><a href="#putspecialobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putspecialobject (method)">putspecialobject</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putspecialobject'><a href="#putspecialobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putspecialobject (method)">putspecialobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putstring'><a href="#putstring-instance_method" title="RubyVM::RJIT::InsnCompiler#putstring (method)">putstring</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putstring'><a href="#putstring-instance_method" title="RubyVM::RJIT::InsnCompiler#putstring (method)">putstring</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putchilledstring'><a href="#putchilledstring-instance_method" title="RubyVM::RJIT::InsnCompiler#putchilledstring (method)">putchilledstring</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putchilledstring'><a href="#putchilledstring-instance_method" title="RubyVM::RJIT::InsnCompiler#putchilledstring (method)">putchilledstring</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_concatstrings'><a href="#concatstrings-instance_method" title="RubyVM::RJIT::InsnCompiler#concatstrings (method)">concatstrings</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_concatstrings'><a href="#concatstrings-instance_method" title="RubyVM::RJIT::InsnCompiler#concatstrings (method)">concatstrings</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_anytostring'><a href="#anytostring-instance_method" title="RubyVM::RJIT::InsnCompiler#anytostring (method)">anytostring</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_anytostring'><a href="#anytostring-instance_method" title="RubyVM::RJIT::InsnCompiler#anytostring (method)">anytostring</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_toregexp'><a href="#toregexp-instance_method" title="RubyVM::RJIT::InsnCompiler#toregexp (method)">toregexp</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_toregexp'><a href="#toregexp-instance_method" title="RubyVM::RJIT::InsnCompiler#toregexp (method)">toregexp</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_intern'><a href="#intern-instance_method" title="RubyVM::RJIT::InsnCompiler#intern (method)">intern</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_intern'><a href="#intern-instance_method" title="RubyVM::RJIT::InsnCompiler#intern (method)">intern</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_newarray'><a href="#newarray-instance_method" title="RubyVM::RJIT::InsnCompiler#newarray (method)">newarray</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_newarray'><a href="#newarray-instance_method" title="RubyVM::RJIT::InsnCompiler#newarray (method)">newarray</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_duparray'><a href="#duparray-instance_method" title="RubyVM::RJIT::InsnCompiler#duparray (method)">duparray</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_duparray'><a href="#duparray-instance_method" title="RubyVM::RJIT::InsnCompiler#duparray (method)">duparray</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># duphash
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_expandarray'><a href="#expandarray-instance_method" title="RubyVM::RJIT::InsnCompiler#expandarray (method)">expandarray</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_expandarray'><a href="#expandarray-instance_method" title="RubyVM::RJIT::InsnCompiler#expandarray (method)">expandarray</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_concatarray'><a href="#concatarray-instance_method" title="RubyVM::RJIT::InsnCompiler#concatarray (method)">concatarray</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_concatarray'><a href="#concatarray-instance_method" title="RubyVM::RJIT::InsnCompiler#concatarray (method)">concatarray</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_splatarray'><a href="#splatarray-instance_method" title="RubyVM::RJIT::InsnCompiler#splatarray (method)">splatarray</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_splatarray'><a href="#splatarray-instance_method" title="RubyVM::RJIT::InsnCompiler#splatarray (method)">splatarray</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_newhash'><a href="#newhash-instance_method" title="RubyVM::RJIT::InsnCompiler#newhash (method)">newhash</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_newhash'><a href="#newhash-instance_method" title="RubyVM::RJIT::InsnCompiler#newhash (method)">newhash</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_newrange'><a href="#newrange-instance_method" title="RubyVM::RJIT::InsnCompiler#newrange (method)">newrange</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_newrange'><a href="#newrange-instance_method" title="RubyVM::RJIT::InsnCompiler#newrange (method)">newrange</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_dupn'><a href="#dupn-instance_method" title="RubyVM::RJIT::InsnCompiler#dupn (method)">dupn</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_dupn'><a href="#dupn-instance_method" title="RubyVM::RJIT::InsnCompiler#dupn (method)">dupn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_swap'><a href="#swap-instance_method" title="RubyVM::RJIT::InsnCompiler#swap (method)">swap</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_swap'><a href="#swap-instance_method" title="RubyVM::RJIT::InsnCompiler#swap (method)">swap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># opt_reverse
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_topn'><a href="#topn-instance_method" title="RubyVM::RJIT::InsnCompiler#topn (method)">topn</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_topn'><a href="#topn-instance_method" title="RubyVM::RJIT::InsnCompiler#topn (method)">topn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setn'><a href="#setn-instance_method" title="RubyVM::RJIT::InsnCompiler#setn (method)">setn</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_setn'><a href="#setn-instance_method" title="RubyVM::RJIT::InsnCompiler#setn (method)">setn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_adjuststack'><a href="#adjuststack-instance_method" title="RubyVM::RJIT::InsnCompiler#adjuststack (method)">adjuststack</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_adjuststack'><a href="#adjuststack-instance_method" title="RubyVM::RJIT::InsnCompiler#adjuststack (method)">adjuststack</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_defined'><a href="#defined-instance_method" title="RubyVM::RJIT::InsnCompiler#defined (method)">defined</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_defined'><a href="#defined-instance_method" title="RubyVM::RJIT::InsnCompiler#defined (method)">defined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_definedivar'><a href="#definedivar-instance_method" title="RubyVM::RJIT::InsnCompiler#definedivar (method)">definedivar</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_definedivar'><a href="#definedivar-instance_method" title="RubyVM::RJIT::InsnCompiler#definedivar (method)">definedivar</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># checkmatch
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_checkkeyword'><a href="#checkkeyword-instance_method" title="RubyVM::RJIT::InsnCompiler#checkkeyword (method)">checkkeyword</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_checkkeyword'><a href="#checkkeyword-instance_method" title="RubyVM::RJIT::InsnCompiler#checkkeyword (method)">checkkeyword</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># checktype
</span>  <span class='comment'># defineclass
</span>  <span class='comment'># definemethod
</span>  <span class='comment'># definesmethod
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send'><a href="#send-instance_method" title="RubyVM::RJIT::InsnCompiler#send (method)">send</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_send'><a href="#send-instance_method" title="RubyVM::RJIT::InsnCompiler#send (method)">send</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_objtostring'><a href="#objtostring-instance_method" title="RubyVM::RJIT::InsnCompiler#objtostring (method)">objtostring</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_objtostring'><a href="#objtostring-instance_method" title="RubyVM::RJIT::InsnCompiler#objtostring (method)">objtostring</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_str_freeze'><a href="#opt_str_freeze-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_str_freeze (method)">opt_str_freeze</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_str_freeze'><a href="#opt_str_freeze-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_str_freeze (method)">opt_str_freeze</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_ary_freeze'><a href="#opt_ary_freeze-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_ary_freeze (method)">opt_ary_freeze</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_ary_freeze'><a href="#opt_ary_freeze-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_ary_freeze (method)">opt_ary_freeze</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_hash_freeze'><a href="#opt_hash_freeze-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_hash_freeze (method)">opt_hash_freeze</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_hash_freeze'><a href="#opt_hash_freeze-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_hash_freeze (method)">opt_hash_freeze</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_nil_p'><a href="#opt_nil_p-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_nil_p (method)">opt_nil_p</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_nil_p'><a href="#opt_nil_p-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_nil_p (method)">opt_nil_p</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># opt_str_uminus
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_newarray_send'><a href="#opt_newarray_send-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_newarray_send (method)">opt_newarray_send</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_newarray_send'><a href="#opt_newarray_send-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_newarray_send (method)">opt_newarray_send</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokesuper'><a href="#invokesuper-instance_method" title="RubyVM::RJIT::InsnCompiler#invokesuper (method)">invokesuper</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_invokesuper'><a href="#invokesuper-instance_method" title="RubyVM::RJIT::InsnCompiler#invokesuper (method)">invokesuper</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock'><a href="#invokeblock-instance_method" title="RubyVM::RJIT::InsnCompiler#invokeblock (method)">invokeblock</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_invokeblock'><a href="#invokeblock-instance_method" title="RubyVM::RJIT::InsnCompiler#invokeblock (method)">invokeblock</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_leave'><a href="#leave-instance_method" title="RubyVM::RJIT::InsnCompiler#leave (method)">leave</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_leave'><a href="#leave-instance_method" title="RubyVM::RJIT::InsnCompiler#leave (method)">leave</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_throw'><a href="#throw-instance_method" title="RubyVM::RJIT::InsnCompiler#throw (method)">throw</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_throw'><a href="#throw-instance_method" title="RubyVM::RJIT::InsnCompiler#throw (method)">throw</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jump'><a href="#jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jump (method)">jump</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_jump'><a href="#jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jump (method)">jump</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_branchif'><a href="#branchif-instance_method" title="RubyVM::RJIT::InsnCompiler#branchif (method)">branchif</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_branchif'><a href="#branchif-instance_method" title="RubyVM::RJIT::InsnCompiler#branchif (method)">branchif</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_branchunless'><a href="#branchunless-instance_method" title="RubyVM::RJIT::InsnCompiler#branchunless (method)">branchunless</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_branchunless'><a href="#branchunless-instance_method" title="RubyVM::RJIT::InsnCompiler#branchunless (method)">branchunless</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_branchnil'><a href="#branchnil-instance_method" title="RubyVM::RJIT::InsnCompiler#branchnil (method)">branchnil</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_branchnil'><a href="#branchnil-instance_method" title="RubyVM::RJIT::InsnCompiler#branchnil (method)">branchnil</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># once
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_case_dispatch'><a href="#opt_case_dispatch-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_case_dispatch (method)">opt_case_dispatch</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_case_dispatch'><a href="#opt_case_dispatch-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_case_dispatch (method)">opt_case_dispatch</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_plus'><a href="#opt_plus-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_plus (method)">opt_plus</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_plus'><a href="#opt_plus-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_plus (method)">opt_plus</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_minus'><a href="#opt_minus-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_minus (method)">opt_minus</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_minus'><a href="#opt_minus-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_minus (method)">opt_minus</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_mult'><a href="#opt_mult-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_mult (method)">opt_mult</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_mult'><a href="#opt_mult-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_mult (method)">opt_mult</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_div'><a href="#opt_div-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_div (method)">opt_div</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_div'><a href="#opt_div-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_div (method)">opt_div</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_mod'><a href="#opt_mod-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_mod (method)">opt_mod</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_mod'><a href="#opt_mod-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_mod (method)">opt_mod</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_eq'><a href="#opt_eq-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_eq (method)">opt_eq</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_eq'><a href="#opt_eq-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_eq (method)">opt_eq</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_neq'><a href="#opt_neq-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_neq (method)">opt_neq</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_neq'><a href="#opt_neq-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_neq (method)">opt_neq</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_lt'><a href="#opt_lt-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_lt (method)">opt_lt</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_lt'><a href="#opt_lt-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_lt (method)">opt_lt</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_le'><a href="#opt_le-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_le (method)">opt_le</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_le'><a href="#opt_le-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_le (method)">opt_le</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_gt'><a href="#opt_gt-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_gt (method)">opt_gt</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_gt'><a href="#opt_gt-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_gt (method)">opt_gt</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_ge'><a href="#opt_ge-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_ge (method)">opt_ge</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_ge'><a href="#opt_ge-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_ge (method)">opt_ge</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_ltlt'><a href="#opt_ltlt-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_ltlt (method)">opt_ltlt</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_ltlt'><a href="#opt_ltlt-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_ltlt (method)">opt_ltlt</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_and'><a href="#opt_and-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_and (method)">opt_and</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_and'><a href="#opt_and-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_and (method)">opt_and</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_or'><a href="#opt_or-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_or (method)">opt_or</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_or'><a href="#opt_or-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_or (method)">opt_or</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_aref'><a href="#opt_aref-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_aref (method)">opt_aref</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_aref'><a href="#opt_aref-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_aref (method)">opt_aref</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_aset'><a href="#opt_aset-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_aset (method)">opt_aset</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_aset'><a href="#opt_aset-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_aset (method)">opt_aset</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># opt_aset_with
</span>  <span class='comment'># opt_aref_with
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_length'><a href="#opt_length-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_length (method)">opt_length</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_length'><a href="#opt_length-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_length (method)">opt_length</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_size'><a href="#opt_size-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_size (method)">opt_size</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_size'><a href="#opt_size-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_size (method)">opt_size</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_empty_p'><a href="#opt_empty_p-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_empty_p (method)">opt_empty_p</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_empty_p'><a href="#opt_empty_p-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_empty_p (method)">opt_empty_p</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_succ'><a href="#opt_succ-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_succ (method)">opt_succ</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_succ'><a href="#opt_succ-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_succ (method)">opt_succ</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_not'><a href="#opt_not-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_not (method)">opt_not</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_not'><a href="#opt_not-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_not (method)">opt_not</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_regexpmatch2'><a href="#opt_regexpmatch2-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_regexpmatch2 (method)">opt_regexpmatch2</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_regexpmatch2'><a href="#opt_regexpmatch2-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_regexpmatch2 (method)">opt_regexpmatch2</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># invokebuiltin
</span>  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_invokebuiltin_delegate'><a href="#opt_invokebuiltin_delegate-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate (method)">opt_invokebuiltin_delegate</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_invokebuiltin_delegate'><a href="#opt_invokebuiltin_delegate-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate (method)">opt_invokebuiltin_delegate</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'><a href="#opt_invokebuiltin_delegate_leave-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate_leave (method)">opt_invokebuiltin_delegate_leave</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getlocal_WC_0'><a href="#getlocal_WC_0-instance_method" title="RubyVM::RJIT::InsnCompiler#getlocal_WC_0 (method)">getlocal_WC_0</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getlocal_WC_0'><a href="#getlocal_WC_0-instance_method" title="RubyVM::RJIT::InsnCompiler#getlocal_WC_0 (method)">getlocal_WC_0</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getlocal_WC_1'><a href="#getlocal_WC_1-instance_method" title="RubyVM::RJIT::InsnCompiler#getlocal_WC_1 (method)">getlocal_WC_1</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_getlocal_WC_1'><a href="#getlocal_WC_1-instance_method" title="RubyVM::RJIT::InsnCompiler#getlocal_WC_1 (method)">getlocal_WC_1</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setlocal_WC_0'><a href="#setlocal_WC_0-instance_method" title="RubyVM::RJIT::InsnCompiler#setlocal_WC_0 (method)">setlocal_WC_0</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_setlocal_WC_0'><a href="#setlocal_WC_0-instance_method" title="RubyVM::RJIT::InsnCompiler#setlocal_WC_0 (method)">setlocal_WC_0</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setlocal_WC_1'><a href="#setlocal_WC_1-instance_method" title="RubyVM::RJIT::InsnCompiler#setlocal_WC_1 (method)">setlocal_WC_1</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_setlocal_WC_1'><a href="#setlocal_WC_1-instance_method" title="RubyVM::RJIT::InsnCompiler#setlocal_WC_1 (method)">setlocal_WC_1</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putobject_INT2FIX_0_'><a href="#putobject_INT2FIX_0_-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject_INT2FIX_0_ (method)">putobject_INT2FIX_0_</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putobject_INT2FIX_0_'><a href="#putobject_INT2FIX_0_-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject_INT2FIX_0_ (method)">putobject_INT2FIX_0_</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_putobject_INT2FIX_1_'><a href="#putobject_INT2FIX_1_-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject_INT2FIX_1_ (method)">putobject_INT2FIX_1_</a></span> <span class='kw'>then</span> <span class='id identifier rubyid_putobject_INT2FIX_1_'><a href="#putobject_INT2FIX_1_-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject_INT2FIX_1_ (method)">putobject_INT2FIX_1_</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>else</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile_branchif-instance_method">
  <h3 class='signature priv'>
    #<strong>compile_branchif</strong>(branch_stub)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Proc escapes arguments in memory</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1995-L2010'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1995' data-end='2010'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1995</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_branchif'>compile_branchif</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='comment'># Proc escapes arguments in memory
</span>  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_branch_asm'>branch_asm</span><span class='op'>|</span>
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>branchif </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_stub'>stub</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='kw'>do</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span>
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next0-constant" title="RubyVM::RJIT::Next0 (constant)">Next0</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next1-constant" title="RubyVM::RJIT::Next1 (constant)">Next1</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile_branchnil-instance_method">
  <h3 class='signature priv'>
    #<strong>compile_branchnil</strong>(branch_stub)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Proc escapes arguments in memory</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2124-L2139'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2124' data-end='2139'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2124</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_branchnil'>compile_branchnil</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='comment'># Proc escapes arguments in memory
</span>  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_branch_asm'>branch_asm</span><span class='op'>|</span>
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>branchnil </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_stub'>stub</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='kw'>do</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span>
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next0-constant" title="RubyVM::RJIT::Next0 (constant)">Next0</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next1-constant" title="RubyVM::RJIT::Next1 (constant)">Next1</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile_branchunless-instance_method">
  <h3 class='signature priv'>
    #<strong>compile_branchunless</strong>(branch_stub)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Proc escapes arguments in memory</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2060-L2075'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2060' data-end='2075'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2060</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_branchunless'>compile_branchunless</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='comment'># Proc escapes arguments in memory
</span>  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_branch_asm'>branch_asm</span><span class='op'>|</span>
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>branchunless </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_stub'>stub</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='kw'>do</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span>
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next0-constant" title="RubyVM::RJIT::Next0 (constant)">Next0</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target1'>target1</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next1-constant" title="RubyVM::RJIT::Next1 (constant)">Next1</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile_jit_chain_guard-instance_method">
  <h3 class='signature priv'>
    #<strong>compile_jit_chain_guard</strong>(branch_stub, opcode:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Proc escapes arguments in memory</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3708-L3718'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3708' data-end='3718'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3708</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_jit_chain_guard'>compile_jit_chain_guard</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='label'>opcode:</span>) <span class='comment'># Proc escapes arguments in memory
</span>  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_branch_asm'>branch_asm</span><span class='op'>|</span>
    <span class='comment'># Not using `asm.comment` here since it&#39;s usually put before cmp/test before this.
</span>    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_stub'>stub</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='kw'>do</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span>
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_opcode'>opcode</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile_jit_direct_jump-instance_method">
  <h3 class='signature priv'>
    #<strong>compile_jit_direct_jump</strong>(branch_stub, comment:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Proc escapes arguments in memory</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5969-L5981'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5969' data-end='5981'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5969</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_jit_direct_jump'>compile_jit_direct_jump</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='label'>comment:</span>) <span class='comment'># Proc escapes arguments in memory
</span>  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_branch_asm'>branch_asm</span><span class='op'>|</span>
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='id identifier rubyid_comment'>comment</span>)
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_stub'>stub</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='kw'>do</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span>
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Next0-constant" title="RubyVM::RJIT::Next0 (constant)">Next0</a></span>
        <span class='comment'># Just write the block without a jump
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="compile_jit_return-instance_method">
  <h3 class='signature priv'>
    #<strong>compile_jit_return</strong>(branch_stub, cfp_offset:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Proc escapes arguments in memory</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5732-L5743'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5732' data-end='5743'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5732</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_jit_return'>compile_jit_return</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='label'>cfp_offset:</span>) <span class='comment'># Proc escapes arguments in memory
</span>  <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_branch_asm'>branch_asm</span><span class='op'>|</span>
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set jit_return to callee CFP</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_stub'>stub</span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span>) <span class='kw'>do</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_shape'>shape</span>
      <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span>
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span>)
        <span class='id identifier rubyid_branch_asm'>branch_asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jit_return'>jit_return</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="concatarray-instance_method">
  <h3 class='signature priv'>
    #<strong>concatarray</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1051-L1069'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1051' data-end='1069'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1051</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_concatarray'>concatarray</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Save the PC and SP because the callee may allocate
</span>  <span class='comment'># Note that this modifies REG_SP, which is why we do it first
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Get the operands from the stack
</span>  <span class='id identifier rubyid_ary2st_opnd'>ary2st_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_ary1_opnd'>ary1_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># Call rb_vm_concat_array(ary1, ary2st)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ary1_opnd'>ary1_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ary2st_opnd'>ary2st_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_concat_array'>rb_vm_concat_array</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="concatstrings-instance_method">
  <h3 class='signature priv'>
    #<strong>concatstrings</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L813-L831'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='813' data-end='831'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 813</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_concatstrings'>concatstrings</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we are allocating
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_n'>n</span>))

  <span class='comment'># call rb_str_concat_literals(size_t n, const VALUE *strings);
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_str_concat_literals'>rb_str_concat_literals</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="counted_exit-instance_method">
  <h3 class='signature priv'>
    #<strong>counted_exit</strong>(side_exit, name)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5997-L6002'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5997' data-end='6002'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5997</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_counted_exit'>counted_exit</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_asm'>asm</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)
  <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="def_iseq_ptr-instance_method">
  <h3 class='signature priv'>
    #<strong>def_iseq_ptr</strong>(cme_def)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L6004-L6006'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='6004' data-end='6006'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 6004</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_def_iseq_ptr'>def_iseq_ptr</span>(<span class='id identifier rubyid_cme_def'>cme_def</span>)
  <span class='const'>C</span>.<span class='id identifier rubyid_rb_iseq_check'>rb_iseq_check</span>(<span class='id identifier rubyid_cme_def'>cme_def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_iseqptr'>iseqptr</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="defer_compilation-instance_method">
  <h3 class='signature priv'>
    #<strong>defer_compilation</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5946-L5953'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5946' data-end='5953'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5946</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_defer_compilation'>defer_compilation</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Make a stub to compile the current insn
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>double defer!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>defer_compilation</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="defined-instance_method">
  <h3 class='signature priv'>
    #<strong>defined</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1264-L1299'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1264' data-end='1299'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1264</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_defined'>defined</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_op_type'>op_type</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_pushval'>pushval</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>2</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Save the PC and SP because the callee may allocate
</span>  <span class='comment'># Note that this modifies REG_SP, which is why we do it first
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Get the operands from the stack
</span>  <span class='id identifier rubyid_v_opnd'>v_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># Call vm_defined(ec, reg_cfp, op_type, obj, v)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_op_type'>op_type</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>3</span>]<span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_obj'>obj</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>4</span>]<span class='comma'>,</span> <span class='id identifier rubyid_v_opnd'>v_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_defined'>rb_vm_defined</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span><span class='comma'>,</span> <span class='int'>255</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_pushval'>pushval</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovnz'>cmovnz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='comment'># Push the return value onto the stack
</span>  <span class='id identifier rubyid_out_type'>out_type</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>SPECIAL_CONST_P</span>(<span class='id identifier rubyid_pushval'>pushval</span>)
    <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>
  <span class='kw'>else</span>
    <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='id identifier rubyid_out_type'>out_type</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="definedivar-instance_method">
  <h3 class='signature priv'>
    #<strong>definedivar</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1304-L1372'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1304' data-end='1372'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1304</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_definedivar'>definedivar</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Defer compilation so we can specialize base on a runtime receiver
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ivar_name'>ivar_name</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='comment'># Value that will be pushed on the stack if the ivar is defined. In practice this is always the
</span>  <span class='comment'># string &quot;instance-variable&quot;. If the ivar is not defined, nil will be pushed instead.
</span>  <span class='id identifier rubyid_pushval'>pushval</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>2</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Get the receiver
</span>  <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])

  <span class='comment'># Specialize base on compile time values
</span>  <span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_self'>peek_at_self</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_shape_too_complex?'><a href="#shape_too_complex%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#shape_too_complex? (method)">shape_too_complex?</a></span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span>)
    <span class='comment'># Fall back to calling rb_ivar_defined
</span>
    <span class='comment'># Save the PC and SP because the callee may allocate
</span>    <span class='comment'># Note that this modifies REG_SP, which is why we do it first
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>) <span class='comment'># clobbers :rax
</span>
    <span class='comment'># Call rb_ivar_defined(recv, ivar_name)
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ivar_name'>ivar_name</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ivar_defined'>rb_ivar_defined</span>)

    <span class='comment'># if (rb_ivar_defined(recv, ivar_name)) {
</span>    <span class='comment'>#  val = pushval;
</span>    <span class='comment'># }
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span><span class='comma'>,</span> <span class='int'>255</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_pushval'>pushval</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovnz'>cmovnz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_out_type'>out_type</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>SPECIAL_CONST_P</span>(<span class='id identifier rubyid_pushval'>pushval</span>) <span class='op'>?</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span> <span class='op'>:</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='id identifier rubyid_out_type'>out_type</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_shape_id'>shape_id</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_shape_id'>rb_shape_get_shape_id</span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span>)
  <span class='id identifier rubyid_ivar_exists'>ivar_exists</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_iv_index'>rb_shape_get_iv_index</span>(<span class='id identifier rubyid_shape_id'>shape_id</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_name'>ivar_name</span>)

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='comment'># Guard heap object (recv_opnd must be used before stack_pop)
</span>  <span class='id identifier rubyid_guard_object_is_heap'><a href="#guard_object_is_heap-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_heap (method)">guard_object_is_heap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span>)

  <span class='id identifier rubyid_shape_opnd'>shape_opnd</span> <span class='op'>=</span> <span class='const'><a href="DwordPtr.html" title="RubyVM::RJIT::DwordPtr (class)">DwordPtr</a></span>[<span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_id_offset'>rb_shape_id_offset</span>]

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard shape</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_shape_opnd'>shape_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_shape_id'>shape_id</span>)
  <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_ivar_exists'>ivar_exists</span> <span class='op'>?</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_pushval'>pushval</span>) <span class='op'>:</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>
  <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='id identifier rubyid_result'>result</span>)

  <span class='comment'># Jump to next instruction. This allows guard chains to share the same successor.
</span>  <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dup-instance_method">
  <h3 class='signature priv'>
    #<strong>dup</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1171-L1180'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1171' data-end='1180'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1171</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dup'>dup</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_dup_val'>dup_val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_mapping'>mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_tmp_type'>tmp_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])

  <span class='id identifier rubyid_loc0'>loc0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push_mapping'>stack_push_mapping</span>([<span class='id identifier rubyid_mapping'>mapping</span><span class='comma'>,</span> <span class='id identifier rubyid_tmp_type'>tmp_type</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_dup_val'>dup_val</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_loc0'>loc0</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="duparray-instance_method">
  <h3 class='signature priv'>
    #<strong>duparray</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L951-L966'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='951' data-end='966'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 951</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_duparray'>duparray</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we are allocating
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># call rb_ary_resurrect(VALUE ary);
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call rb_ary_resurrect</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ary'>ary</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_resurrect'>rb_ary_resurrect</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dupn-instance_method">
  <h3 class='signature priv'>
    #<strong>dupn</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1185-L1208'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1185' data-end='1208'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1185</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dupn'>dupn</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># In practice, seems to be only used for n==2
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>!=</span> <span class='int'>2</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_opnd1'>opnd1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_opnd0'>opnd0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)

  <span class='id identifier rubyid_mapping1'>mapping1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>])
  <span class='id identifier rubyid_mapping0'>mapping0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])

  <span class='id identifier rubyid_dst1'>dst1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push_mapping'>stack_push_mapping</span>(<span class='id identifier rubyid_mapping1'>mapping1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_opnd1'>opnd1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst1'>dst1</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='id identifier rubyid_dst0'>dst0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push_mapping'>stack_push_mapping</span>(<span class='id identifier rubyid_mapping0'>mapping0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_opnd0'>opnd0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst0'>dst0</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="dynamic_symbol?-instance_method">
  <h3 class='signature priv'>
    #<strong>dynamic_symbol?</strong>(obj)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5934-L5937'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5934' data-end='5937'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5934</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_dynamic_symbol?'>dynamic_symbol?</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>SPECIAL_CONST_P</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_SYMBOL</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="ep_offset_to_local_idx-instance_method">
  <h3 class='signature priv'>
    #<strong>ep_offset_to_local_idx</strong>(iseq, ep_offset)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Compute the index of a local variable from its slot index</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3531-L3552'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3531' data-end='3552'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3531</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_ep_offset_to_local_idx'>ep_offset_to_local_idx</span>(<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_ep_offset'>ep_offset</span>)
  <span class='comment'># Layout illustration
</span>  <span class='comment'># This is an array of VALUE
</span>  <span class='comment'>#                                           | VM_ENV_DATA_SIZE |
</span>  <span class='comment'>#                                           v                  v
</span>  <span class='comment'># low addr &lt;----------------------------------------------
</span>  <span class='comment'>#           |local 0|local 1|  ...  |local n|       ....       |
</span>  <span class='comment'>#           ----------------------------------------------
</span>  <span class='comment'>#           ^       ^                       ^                  ^
</span>  <span class='comment'>#           ----------local_table_size----+         cfp-&gt;ep--+
</span>  <span class='comment'>#                   |                                          |
</span>  <span class='comment'>#                   ------------------ep_offset---------------
</span>  <span class='comment'>#
</span>  <span class='comment'># See usages of local_var_name() from iseq.c for similar calculation.
</span>
  <span class='comment'># Equivalent of iseq-&gt;body-&gt;local_table_size
</span>  <span class='id identifier rubyid_local_table_size'>local_table_size</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_table_size'>local_table_size</span>
  <span class='id identifier rubyid_op'>op</span> <span class='op'>=</span> <span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_SIZE</span>
  <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_local_table_size'>local_table_size</span> <span class='op'>-</span> <span class='id identifier rubyid_op'>op</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>&gt;=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_local_table_size'>local_table_size</span>)
  <span class='id identifier rubyid_local_idx'>local_idx</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="expandarray-instance_method">
  <h3 class='signature priv'>
    #<strong>expandarray</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L973-L1046'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='973' data-end='1046'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 973</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_expandarray'>expandarray</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Both arguments are rb_num_t which is unsigned
</span>  <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># If this instruction has the splat flag, then bail out.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>&amp;</span> <span class='int'>0x01</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_expandarray_splat'>expandarray_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># If this instruction has the postarg flag, then bail out.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flag'>flag</span> <span class='op'>&amp;</span> <span class='int'>0x02</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_expandarray_postarg'>expandarray_postarg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='id identifier rubyid_array_opnd'>array_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_array_stack_opnd'>array_stack_opnd</span> <span class='op'>=</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>]

  <span class='comment'># num is the number of requested values. If there aren&#39;t enough in the
</span>  <span class='comment'># array then we&#39;re going to push on nils.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='id identifier rubyid_array_stack_opnd'>array_stack_opnd</span>) <span class='op'>==</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>) <span class='comment'># pop after using the type info
</span>    <span class='comment'># special case for a, b = nil pattern
</span>    <span class='comment'># push N nils onto the stack
</span>    <span class='id identifier rubyid_num'>num</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_push_opnd'>push_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_push_opnd'>push_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Move the array from the stack and check that it&#39;s an array.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_array_opnd'>array_opnd</span>)
  <span class='id identifier rubyid_guard_object_is_array'><a href="#guard_object_is_array-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_array (method)">guard_object_is_array</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_array_stack_opnd'>array_stack_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_expandarray_not_array'>expandarray_not_array</span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>) <span class='comment'># pop after using the type info
</span>
  <span class='comment'># If we don&#39;t actually want any values, then just return.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_num'>num</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jit_array_len'><a href="#jit_array_len-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_array_len (method)">jit_array_len</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='comment'># Only handle the case where the number of values in the array is greater
</span>  <span class='comment'># than or equal to the number of values requested.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jl'>jl</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_expandarray_rhs_too_small'>expandarray_rhs_too_small</span>))

  <span class='comment'># Conditionally load the address of the heap array into REG1.
</span>  <span class='comment'># (struct RArray *)(obj)-&gt;as.heap.ptr
</span>  <span class='comment'>#asm.mov(:rax, array_opnd)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_FLAG</span>)<span class='semicolon'>;</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ptr'>ptr</span>)])

  <span class='comment'># Load the address of the embedded array into REG1.
</span>  <span class='comment'># (struct RArray *)(obj)-&gt;as.ary
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>)])

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovnz'>cmovnz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='comment'># Loop backward through the array and push each element onto the stack.
</span>  (<span class='id identifier rubyid_num'>num</span> <span class='op'>-</span> <span class='int'>1</span>).<span class='id identifier rubyid_downto'>downto</span>(<span class='int'>0</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="fixnum?-instance_method">
  <h3 class='signature priv'>
    #<strong>fixnum?</strong>(obj)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5918-L5920'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5918' data-end='5920'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5918</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fixnum?'>fixnum?</span>(<span class='id identifier rubyid_obj'>obj</span>)
  (<span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FIXNUM_FLAG</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FIXNUM_FLAG</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="flonum?-instance_method">
  <h3 class='signature priv'>
    #<strong>flonum?</strong>(obj)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5922-L5924'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5922' data-end='5924'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5922</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_flonum?'>flonum?</span>(<span class='id identifier rubyid_obj'>obj</span>)
  (<span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FLONUM_MASK</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FLONUM_FLAG</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="full_cfunc_return-instance_method">
  <h3 class='signature priv'>
    #<strong>full_cfunc_return</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L6013-L6018'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='6013' data-end='6018'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 6013</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_full_cfunc_return'>full_cfunc_return</span>
  <span class='ivar'>@full_cfunc_return</span> <span class='op'>||=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_asm'>asm</span><span class='op'>|</span>
    <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_full_cfunc_return'>compile_full_cfunc_return</span>(<span class='id identifier rubyid_asm'>asm</span>)
    <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="get_lvar_level-instance_method">
  <h3 class='signature priv'>
    #<strong>get_lvar_level</strong>(iseq)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>See get_lvar_level in compile.c</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4105-L4112'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4105' data-end='4112'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4105</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_get_lvar_level'>get_lvar_level</span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>!=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_iseq'>local_iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_level'>level</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_parent_iseq'>parent_iseq</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_level'>level</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getblockparam-instance_method">
  <h3 class='signature priv'>
    #<strong>getblockparam</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L212-L278'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='212' data-end='278'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 212</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getblockparam'>getblockparam</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># EP level
</span>  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># Save the PC and SP because we might allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># A mirror of the interpreter code. Checking for the case
</span>  <span class='comment'># where it&#39;s pushing rb_block_param_proxy.
</span>  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='comment'># Load environment pointer EP from CFP
</span>  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)

  <span class='comment'># Bail when VM_ENV_FLAGS(ep, VM_FRAME_FLAG_MODIFIED_BLOCK_PARAM) is non zero
</span>  <span class='comment'># FIXME: This is testing bits in the same place that the WB check is testing.
</span>  <span class='comment'># We should combine these at some point
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>([<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_FLAGS</span>]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_MODIFIED_BLOCK_PARAM</span>)

  <span class='comment'># If the frame flag has been modified, then the actual proc value is
</span>  <span class='comment'># already in the EP and we should just use the value.
</span>  <span class='id identifier rubyid_frame_flag_modified'>frame_flag_modified</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>frame_flag_modified</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_frame_flag_modified'>frame_flag_modified</span>)

  <span class='comment'># This instruction writes the block handler to the EP.  If we need to
</span>  <span class='comment'># fire a write barrier for the write, then exit (we&#39;ll let the
</span>  <span class='comment'># interpreter handle it so it can fire the write barrier).
</span>  <span class='comment'># flags &amp; VM_ENV_FLAG_WB_REQUIRED
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>([<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_FLAGS</span>]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_FLAG_WB_REQUIRED</span>)

  <span class='comment'># if (flags &amp; VM_ENV_FLAG_WB_REQUIRED) != 0
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='comment'># Convert the block handler in to a proc
</span>  <span class='comment'># call rb_vm_bh_to_procval(const rb_execution_context_t *ec, VALUE block_handler)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='comment'># The block handler for the current frame
</span>  <span class='comment'># note, VM_ASSERT(VM_ENV_LOCAL_P(ep))
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_bh_to_procval'>rb_vm_bh_to_procval</span>)

  <span class='comment'># Load environment pointer EP from CFP (again)
</span>  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)

  <span class='comment'># Write the value at the environment pointer
</span>  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_offs'>offs</span> <span class='op'>=</span> <span class='op'>-</span>(<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_idx'>idx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_offs'>offs</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)<span class='semicolon'>;</span>

  <span class='comment'># Set the frame modified flag
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_FLAGS</span>]) <span class='comment'># flag_check
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_or'>or</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_MODIFIED_BLOCK_PARAM</span>) <span class='comment'># modified_flag
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_FLAGS</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_frame_flag_modified'>frame_flag_modified</span>)

  <span class='comment'># Push the proc on the stack
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_offs'>offs</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getblockparamproxy-instance_method">
  <h3 class='signature priv'>
    #<strong>getblockparamproxy</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L285-L350'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='285' data-end='350'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 285</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getblockparamproxy'>getblockparamproxy</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># To get block_handler
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_starting_context'>starting_context</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span> <span class='comment'># make a copy for use with jit_chain_guard
</span>
  <span class='comment'># A mirror of the interpreter code. Checking for the case
</span>  <span class='comment'># where it&#39;s pushing rb_block_param_proxy.
</span>  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='comment'># EP level
</span>  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># Peek at the block handler so we can check whether it&#39;s nil
</span>  <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_block_handler'>peek_at_block_handler</span>(<span class='id identifier rubyid_level'>level</span>)

  <span class='comment'># When a block handler is present, it should always be a GC-guarded
</span>  <span class='comment'># pointer (VM_BH_ISEQ_BLOCK_P)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>&amp;</span> <span class='int'>0x3</span> <span class='op'>!=</span> <span class='int'>0x1</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_getblockpp_not_gc_guarded'>getblockpp_not_gc_guarded</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Load environment pointer EP from CFP
</span>  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)

  <span class='comment'># Bail when VM_ENV_FLAGS(ep, VM_FRAME_FLAG_MODIFIED_BLOCK_PARAM) is non zero
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>([<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_FLAGS</span>]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_MODIFIED_BLOCK_PARAM</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getblockpp_block_param_modified'>getblockpp_block_param_modified</span>))

  <span class='comment'># Load the block handler for the current frame
</span>  <span class='comment'># note, VM_ASSERT(VM_ENV_LOCAL_P(ep))
</span>  <span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>])

  <span class='comment'># Specialize compilation for the case where no block handler is present
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='comment'># Bail if there is a block handler
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='int'>0</span>)

    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jnz'>jnz</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_starting_context'>starting_context</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getblockpp_block_handler_none'>getblockpp_block_handler_none</span>))

    <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
  <span class='kw'>else</span>
    <span class='comment'># Block handler is a tagged pointer. Look at the tag. 0x03 is from VM_BH_ISEQ_BLOCK_P().
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='int'>0x3</span>)

    <span class='comment'># Bail unless VM_BH_ISEQ_BLOCK_P(bh). This also checks for null.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='int'>0x1</span>)

    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jnz'>jnz</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_starting_context'>starting_context</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getblockpp_not_iseq_block'>getblockpp_not_iseq_block</span>))

    <span class='comment'># Push rb_block_param_proxy. It&#39;s a root, so no need to use jit_mov_gc_ptr.
</span>    <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>BlockParamProxy</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_block_param_proxy'>rb_block_param_proxy</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getclassvariable-instance_method">
  <h3 class='signature priv'>
    #<strong>getclassvariable</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L574-L588'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='574' data-end='588'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 574</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getclassvariable'>getclassvariable</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># rb_vm_getclassvariable can raise exceptions.
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_iseq'>iseq</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>3</span>]<span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_getclassvariable'>rb_vm_getclassvariable</span>)

  <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getconstant-instance_method">
  <h3 class='signature priv'>
    #<strong>getconstant</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L676-L695'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='676' data-end='695'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 676</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getconstant'>getconstant</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># vm_get_ev_const can raise exceptions.
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_allow_nil_opnd'>allow_nil_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_klass_opnd'>klass_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_klass_opnd'>klass_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>3</span>]<span class='comma'>,</span> <span class='id identifier rubyid_allow_nil_opnd'>allow_nil_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_get_ev_const'>rb_vm_get_ev_const</span>)

  <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getglobal-instance_method">
  <h3 class='signature priv'>
    #<strong>getglobal</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L702-L715'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='702' data-end='715'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 702</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getglobal'>getglobal</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_gid'>gid</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we might make a Ruby call for warning
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_gid'>gid</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_gvar_get'>rb_gvar_get</span>)

  <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getinstancevariable-instance_method">
  <h3 class='signature priv'>
    #<strong>getinstancevariable</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L423-L434'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='423' data-end='434'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 423</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getinstancevariable'>getinstancevariable</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Specialize on a compile-time receiver, and split a block for chain guards
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_comptime_obj'>comptime_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_self'>peek_at_self</span>

  <span class='id identifier rubyid_jit_getivar'><a href="#jit_getivar-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_getivar (method)">jit_getivar</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_obj'>comptime_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getlocal-instance_method">
  <h3 class='signature priv'>
    #<strong>getlocal</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L162-L166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='162' data-end='166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 162</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getlocal'>getlocal</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_jit_getlocal_generic'><a href="#jit_getlocal_generic-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_getlocal_generic (method)">jit_getlocal_generic</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getlocal_WC_0-instance_method">
  <h3 class='signature priv'>
    #<strong>getlocal_WC_0</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L171-L174'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='171' data-end='174'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 171</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getlocal_WC_0'>getlocal_WC_0</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_jit_getlocal_generic'><a href="#jit_getlocal_generic-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_getlocal_generic (method)">jit_getlocal_generic</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span> <span class='int'>0</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getlocal_WC_1-instance_method">
  <h3 class='signature priv'>
    #<strong>getlocal_WC_1</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L179-L182'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='179' data-end='182'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 179</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getlocal_WC_1'>getlocal_WC_1</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_jit_getlocal_generic'><a href="#jit_getlocal_generic-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_getlocal_generic (method)">jit_getlocal_generic</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span> <span class='int'>1</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="getspecial-instance_method">
  <h3 class='signature priv'>
    #<strong>getspecial</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L355-L416'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='355' data-end='416'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 355</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_getspecial'>getspecial</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># This takes two arguments, key and type
</span>  <span class='comment'># key is only used when type == 0
</span>  <span class='comment'># A non-zero type determines which type of backref to fetch
</span>  <span class='comment'>#rb_num_t key = jit.jit_get_arg(0);
</span>  <span class='id identifier rubyid_rtype'>rtype</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_rtype'>rtype</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='comment'># not yet implemented
</span>    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span><span class='semicolon'>;</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_rtype'>rtype</span> <span class='op'>&amp;</span> <span class='int'>0x01</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># Fetch a &quot;special&quot; backref based on a char encoded by shifting by 1
</span>
    <span class='comment'># Can raise if matchdata uninitialized
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># call rb_backref_get()
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_backref_get</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_backref_get'>rb_backref_get</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>) <span class='comment'># backref
</span>    <span class='kw'>case</span> [<span class='id identifier rubyid_rtype'>rtype</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span>].<span class='id identifier rubyid_pack'>pack</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>c</span><span class='tstring_end'>&#39;</span></span>)
    <span class='kw'>in</span> <span class='CHAR'>?&amp;</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb_reg_last_match</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_reg_last_match'>rb_reg_last_match</span>)
    <span class='kw'>in</span> <span class='CHAR'>?`</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb_reg_match_pre</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_reg_match_pre'>rb_reg_match_pre</span>)
    <span class='kw'>in</span> <span class='CHAR'>?&#39;</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb_reg_match_post</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_reg_match_post'>rb_reg_match_post</span>)
    <span class='kw'>in</span> <span class='CHAR'>?+</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb_reg_match_last</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_reg_match_last'>rb_reg_match_last</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='comment'># Fetch the N-th match from the last backref based on type shifted by 1
</span>
    <span class='comment'># Can raise if matchdata uninitialized
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># call rb_backref_get()
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_backref_get</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_backref_get'>rb_backref_get</span>)

    <span class='comment'># rb_reg_nth_match((int)(type &gt;&gt; 1), backref);
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_reg_nth_match</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_rtype'>rtype</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>) <span class='comment'># backref
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_reg_nth_match'>rb_reg_nth_match</span>)

    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="guard_block_arg-instance_method">
  <h3 class='signature priv'>
    #<strong>guard_block_arg</strong>(jit, ctx, asm, calling)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_caller_setup_arg_block: Handle VM_CALL_ARGS_BLOCKARG cases.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4249-L4262'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4249' data-end='4262'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4249</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_guard_block_arg'>guard_block_arg</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_block_arg_type'>block_arg_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
    <span class='kw'>case</span> <span class='id identifier rubyid_block_arg_type'>block_arg_type</span>
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span>
      <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>
    <span class='kw'>in</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>BlockParamProxy</span>
      <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_block_param_proxy'>rb_block_param_proxy</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_block_arg'>send_block_arg</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="guard_object_is_array-instance_method">
  <h3 class='signature priv'>
    #<strong>guard_object_is_array</strong>(jit, ctx, asm, object_reg, flags_reg, object_opnd, counter = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3604-L3627'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3604' data-end='3627'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3604</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_guard_object_is_array'>guard_object_is_array</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_object_type'>object_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='id identifier rubyid_object_opnd'>object_opnd</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span>.<span class='id identifier rubyid_array?'>array?</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_guard_object_is_heap'><a href="#guard_object_is_heap-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_heap (method)">guard_object_is_heap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span>)

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span>) <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is array</span><span class='tstring_end'>&#39;</span></span>)
  <span class='comment'># Pull out the type mask
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_MASK</span>)

  <span class='comment'># Compare the result with T_ARRAY
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_ARRAY</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>) <span class='op'>!=</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="guard_object_is_heap-instance_method">
  <h3 class='signature priv'>
    #<strong>guard_object_is_heap</strong>(jit, ctx, asm, object, object_opnd, counter = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3578-L3599'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3578' data-end='3599'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3578</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_guard_object_is_heap'>guard_object_is_heap</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_object_type'>object_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='id identifier rubyid_object_opnd'>object_opnd</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span>) <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is heap</span><span class='tstring_end'>&#39;</span></span>)
  <span class='comment'># Test that the object is not an immediate
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_IMMEDIATE_MASK</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='comment'># Test that the object is not false
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>) <span class='op'>!=</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="guard_object_is_not_ruby2_keyword_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>guard_object_is_not_ruby2_keyword_hash</strong>(asm, object_reg, flags_reg, side_exit)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>clobbers object_reg</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3658-L3680'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3658' data-end='3680'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3658</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_guard_object_is_not_ruby2_keyword_hash'>guard_object_is_not_ruby2_keyword_hash</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is not ruby2 keyword hash</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_not_ruby2_keyword'>not_ruby2_keyword</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>not_ruby2_keyword</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_IMMEDIATE_MASK</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_not_ruby2_keyword'>not_ruby2_keyword</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_not_ruby2_keyword'>not_ruby2_keyword</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])
  <span class='id identifier rubyid_type_reg'>type_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_object_reg'>object_reg</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_type_reg'>type_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags_reg'>flags_reg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='id identifier rubyid_type_reg'>type_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_MASK</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_type_reg'>type_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_HASH</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_not_ruby2_keyword'>not_ruby2_keyword</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RHASH_PASS_AS_KEYWORDS</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_not_ruby2_keyword'>not_ruby2_keyword</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="guard_object_is_string-instance_method">
  <h3 class='signature priv'>
    #<strong>guard_object_is_string</strong>(jit, ctx, asm, object_reg, flags_reg, object_opnd, counter = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3632-L3655'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3632' data-end='3655'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3632</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_guard_object_is_string'>guard_object_is_string</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_object_type'>object_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='id identifier rubyid_object_opnd'>object_opnd</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span>.<span class='id identifier rubyid_string?'>string?</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_guard_object_is_heap'><a href="#guard_object_is_heap-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_heap (method)">guard_object_is_heap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span>)

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='id identifier rubyid_counter'>counter</span>) <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is string</span><span class='tstring_end'>&#39;</span></span>)
  <span class='comment'># Pull out the type mask
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_object_reg'>object_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_MASK</span>)

  <span class='comment'># Compare the result with T_STRING
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_flags_reg'>flags_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_STRING</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span>.<span class='id identifier rubyid_diff'>diff</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>) <span class='op'>!=</span> <span class='const'><a href="TypeDiff.html" title="RubyVM::RJIT::TypeDiff (module)">TypeDiff</a></span><span class='op'>::</span><span class='const'><a href="TypeDiff.html#Incompatible-constant" title="RubyVM::RJIT::TypeDiff::Incompatible (constant)">Incompatible</a></span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_object_opnd'>object_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="guard_two_fixnums-instance_method">
  <h3 class='signature priv'>
    #<strong>guard_two_fixnums</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3865-L3912'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3865' data-end='3912'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3865</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_guard_two_fixnums'>guard_two_fixnums</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Get stack operands without popping them
</span>  <span class='id identifier rubyid_arg1'>arg1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_arg0'>arg0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)

  <span class='comment'># Get the stack operand types
</span>  <span class='id identifier rubyid_arg1_type'>arg1_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
  <span class='id identifier rubyid_arg0_type'>arg0_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>])

  <span class='kw'>if</span> <span class='id identifier rubyid_arg0_type'>arg0_type</span>.<span class='id identifier rubyid_heap?'>heap?</span> <span class='op'>||</span> <span class='id identifier rubyid_arg1_type'>arg1_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>arg is heap object</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_arg0_type'>arg0_type</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_arg0_type'>arg0_type</span>.<span class='id identifier rubyid_specific?'>specific?</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>arg0 not fixnum</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_arg1_type'>arg1_type</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_arg1_type'>arg1_type</span>.<span class='id identifier rubyid_specific?'>specific?</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>arg1 not fixnum</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_arg0_type'>arg0_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
  <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_arg1_type'>arg1_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
  <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_arg0_type'>arg0_type</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span> <span class='op'>||</span> <span class='id identifier rubyid_arg0_type'>arg0_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)
  <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_arg1_type'>arg1_type</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span> <span class='op'>||</span> <span class='id identifier rubyid_arg1_type'>arg1_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

  <span class='comment'># If not fixnums at run-time, fall back
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_arg0_type'>arg0_type</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard arg0 fixnum</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_arg0'>arg0</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FIXNUM_FLAG</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jz'>jz</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_arg1_type'>arg1_type</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard arg1 fixnum</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_arg1'>arg1</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FIXNUM_FLAG</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jz'>jz</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
  <span class='kw'>end</span>

  <span class='comment'># Set stack types in context
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="handle_opt_send_shift_stack-instance_method">
  <h3 class='signature priv'>
    #<strong>handle_opt_send_shift_stack</strong>(asm, argc, ctx, send_shift:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_opt_send (lazy part)</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5551-L5564'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5551' data-end='5564'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5551</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_opt_send_shift_stack'>handle_opt_send_shift_stack</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='comment'># We don&#39;t support `send(:send, ...)` for now.
</span>  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_send_shift'>send_shift</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>shift stack</span><span class='tstring_end'>&#39;</span></span>)
  (<span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_argc'>argc</span>).<span class='id identifier rubyid_reverse_each'>reverse_each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_opnd'>opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_i'>i</span>)
    <span class='id identifier rubyid_opnd2'>opnd2</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_opnd'>opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_opnd2'>opnd2</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_shift_stack'>shift_stack</span>(<span class='id identifier rubyid_argc'>argc</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="intern-instance_method">
  <h3 class='signature priv'>
    #<strong>intern</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L900-L913'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='900' data-end='913'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 900</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_intern'>intern</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Save the PC and SP because we might allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)<span class='semicolon'>;</span>

  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_str_intern'>rb_str_intern</span>)

  <span class='comment'># Push the return value
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invokeblock-instance_method">
  <h3 class='signature priv'>
    #<strong>invokeblock</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1774-L1871'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1774' data-end='1871'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1774</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invokeblock'>invokeblock</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Get call info
</span>  <span class='id identifier rubyid_cd'>cd</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_calling'>calling</span> <span class='op'>=</span> <span class='id identifier rubyid_build_calling'><a href="#build_calling-instance_method" title="RubyVM::RJIT::InsnCompiler#build_calling (method)">build_calling</a></span>(<span class='label'>ci:</span> <span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span><span class='comma'>,</span> <span class='label'>block_handler:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>)

  <span class='comment'># Get block_handler
</span>  <span class='id identifier rubyid_cfp'>cfp</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_cfp'>cfp</span>
  <span class='id identifier rubyid_lep'>lep</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_ep_local_ep'>rb_vm_ep_local_ep</span>(<span class='id identifier rubyid_cfp'>cfp</span>.<span class='id identifier rubyid_ep'>ep</span>)
  <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>=</span> <span class='id identifier rubyid_lep'>lep</span>[<span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]

  <span class='comment'># Handle each block_handler type
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span> <span class='comment'># no block given
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_none'>invokeblock_none</span>)
    <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>&amp;</span> <span class='int'>0x3</span> <span class='op'>==</span> <span class='int'>0x1</span> <span class='comment'># VM_BH_ISEQ_BLOCK_P
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>get local EP</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
    <span class='id identifier rubyid_jit_get_lep'><a href="#jit_get_lep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_lep (method)">jit_get_lep</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]) <span class='comment'># block_handler_opnd
</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard block_handler type</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='int'>0x3</span>) <span class='comment'># block_handler is a tagged pointer
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='int'>0x1</span>) <span class='comment'># VM_BH_ISEQ_BLOCK_P
</span>    <span class='id identifier rubyid_tag_changed_exit'>tag_changed_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_tag_changed'>invokeblock_tag_changed</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_tag_changed_exit'>tag_changed_exit</span>)

    <span class='id identifier rubyid_comptime_captured'>comptime_captured</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_captured_block'>rb_captured_block</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>&amp;</span> <span class='op'>~</span><span class='int'>0x3</span>)
    <span class='id identifier rubyid_comptime_iseq'>comptime_iseq</span> <span class='op'>=</span> <span class='id identifier rubyid_comptime_captured'>comptime_captured</span>.<span class='id identifier rubyid_code'>code</span>.<span class='id identifier rubyid_iseq'>iseq</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard known ISEQ</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='op'>~</span><span class='int'>0x3</span>) <span class='comment'># captured
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>2</span>]) <span class='comment'># captured-&gt;iseq
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_iseq'>comptime_iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_block_changed_exit'>block_changed_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_iseq_block_changed'>invokeblock_iseq_block_changed</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_block_changed_exit'>block_changed_exit</span>)

    <span class='id identifier rubyid_jit_call_iseq'><a href="#jit_call_iseq-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_iseq (method)">jit_call_iseq</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_iseq'>comptime_iseq</span><span class='comma'>,</span> <span class='label'>frame_type:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_MAGIC_BLOCK</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_comptime_handler'>comptime_handler</span> <span class='op'>&amp;</span> <span class='int'>0x3</span> <span class='op'>==</span> <span class='int'>0x3</span> <span class='comment'># VM_BH_IFUNC_P
</span>    <span class='comment'># We aren&#39;t handling CALLER_SETUP_ARG and CALLER_REMOVE_EMPTY_KW_SPLAT yet.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_ifunc_args_splat'>invokeblock_ifunc_args_splat</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_ifunc_kw_splat'>invokeblock_ifunc_kw_splat</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>get local EP</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_jit_get_lep'><a href="#jit_get_lep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_lep (method)">jit_get_lep</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]) <span class='comment'># block_handler_opnd
</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard block_handler type</span><span class='tstring_end'>&#39;</span></span>)<span class='semicolon'>;</span>
    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>) <span class='comment'># block_handler_opnd
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>0x3</span>) <span class='comment'># tag_opnd: block_handler is a tagged pointer
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>0x3</span>) <span class='comment'># VM_BH_IFUNC_P
</span>    <span class='id identifier rubyid_tag_changed_exit'>tag_changed_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_tag_changed'>invokeblock_tag_changed</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_tag_changed_exit'>tag_changed_exit</span>)

    <span class='comment'># The cfunc may not be leaf
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>) <span class='comment'># clobbers :rax
</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call ifunc</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='op'>~</span><span class='int'>0x3</span>) <span class='comment'># captured_opnd
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>)) <span class='comment'># argv
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>) <span class='comment'># captured_opnd
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>3</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># argv
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_yield_with_cfunc'>rb_vm_yield_with_cfunc</span>)

    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>)
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='comment'># cfunc calls may corrupt types
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_clear_local_types'>clear_local_types</span>

    <span class='comment'># Share the successor with other chains
</span>    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_symbol?'><a href="#symbol%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#symbol? (method)">symbol?</a></span>(<span class='id identifier rubyid_comptime_handler'>comptime_handler</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_symbol'>invokeblock_symbol</span>)
    <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>else</span> <span class='comment'># Proc
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_proc'>invokeblock_proc</span>)
    <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="invokesuper-instance_method">
  <h3 class='signature priv'>
    #<strong>invokesuper</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1651-L1769'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1651' data-end='1769'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1651</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_invokesuper'>invokesuper</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_cd'>cd</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># Defer compilation so we can specialize on class of receiver
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_me'>me</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_frame_method_entry'>rb_vm_frame_method_entry</span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_cfp'>cfp</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># FIXME: We should track and invalidate this block when this cme is invalidated
</span>  <span class='id identifier rubyid_current_defined_class'>current_defined_class</span> <span class='op'>=</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_defined_class'>defined_class</span>
  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_original_id'>original_id</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>!=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_callable_method_entry'>rb_callable_method_entry</span>(<span class='id identifier rubyid_current_defined_class'>current_defined_class</span><span class='comma'>,</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_called_id'>called_id</span>).<span class='id identifier rubyid_to_i'>to_i</span>
    <span class='comment'># Though we likely could generate this call, as we are only concerned
</span>    <span class='comment'># with the method entry remaining valid, assume_method_lookup_stable
</span>    <span class='comment'># below requires that the method lookup matches as well
</span>    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># vm_search_normal_superclass
</span>  <span class='id identifier rubyid_rbasic_klass'>rbasic_klass</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_ruby'>to_ruby</span>(<span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_current_defined_class'>current_defined_class</span>)).<span class='id identifier rubyid_klass'>klass</span>)
  <span class='kw'>if</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BUILTIN_TYPE</span>(<span class='id identifier rubyid_current_defined_class'>current_defined_class</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_ICLASS</span> <span class='op'>&amp;&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BUILTIN_TYPE</span>(<span class='id identifier rubyid_rbasic_klass'>rbasic_klass</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_MODULE</span> <span class='op'>&amp;&amp;</span> \
      <span class='const'>C</span><span class='op'>::</span><span class='const'>FL_TEST_RAW</span>(<span class='id identifier rubyid_rbasic_klass'>rbasic_klass</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RMODULE_IS_REFINEMENT</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_comptime_superclass'>comptime_superclass</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_get_superclass'>rb_class_get_superclass</span>(<span class='const'>C</span>.<span class='const'>RCLASS_ORIGIN</span>(<span class='id identifier rubyid_current_defined_class'>current_defined_class</span>))

  <span class='id identifier rubyid_ci'>ci</span> <span class='op'>=</span> <span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span>
  <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_argc'>vm_ci_argc</span>(<span class='id identifier rubyid_ci'>ci</span>)

  <span class='id identifier rubyid_ci_flags'>ci_flags</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_flag'>vm_ci_flag</span>(<span class='id identifier rubyid_ci'>ci</span>)

  <span class='comment'># Don&#39;t JIT calls that aren&#39;t simple
</span>  <span class='comment'># Note, not using VM_CALL_ARGS_SIMPLE because sometimes we pass a block.
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ci_flags'>ci_flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KWARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_keywords'>send_keywords</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ci_flags'>ci_flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_kw_splat'>send_kw_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ci_flags'>ci_flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_block_arg'>send_block_arg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Ensure we haven&#39;t rebound this method onto an incompatible class.
</span>  <span class='comment'># In the interpreter we try to avoid making this check by performing some
</span>  <span class='comment'># cheaper calculations first, but since we specialize on the method entry
</span>  <span class='comment'># and so only have to do this once at compile time this is fine to always
</span>  <span class='comment'># check and side exit.
</span>  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_argc'>argc</span>)
  <span class='kw'>unless</span> <span class='const'>C</span>.<span class='id identifier rubyid_obj_is_kind_of'>obj_is_kind_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_current_defined_class'>current_defined_class</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Do method lookup
</span>  <span class='id identifier rubyid_cme'>cme</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_callable_method_entry'>rb_callable_method_entry</span>(<span class='id identifier rubyid_comptime_superclass'>comptime_superclass</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Check that we&#39;ll be able to write this method dispatch before generating checks
</span>  <span class='id identifier rubyid_cme_def_type'>cme_def_type</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_type'>type</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cme_def_type'>cme_def_type</span> <span class='op'>!=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_ISEQ</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_cme_def_type'>cme_def_type</span> <span class='op'>!=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_CFUNC</span>
    <span class='comment'># others unimplemented
</span>    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard known me</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_lep_opnd'>lep_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_lep'><a href="#jit_get_lep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_lep (method)">jit_get_lep</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_lep_opnd'>lep_opnd</span>)
  <span class='id identifier rubyid_ep_me_opnd'>ep_me_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_lep_opnd'>lep_opnd</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_ME_CREF</span>]

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_ep_me_opnd'>ep_me_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokesuper_me_changed'>invokesuper_me_changed</span>))

  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>
    <span class='comment'># Guard no block passed
</span>    <span class='comment'># rb_vm_frame_block_handler(GET_EC()-&gt;cfp) == VM_BLOCK_HANDLER_NONE
</span>    <span class='comment'># note, we assume VM_ASSERT(VM_ENV_LOCAL_P(ep))
</span>    <span class='comment'>#
</span>    <span class='comment'># TODO: this could properly forward the current block handler, but
</span>    <span class='comment'># would require changes to gen_send_*
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard no block given</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_ep_specval_opnd'>ep_specval_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_lep_opnd'>lep_opnd</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_ep_specval_opnd'>ep_specval_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_invokesuper_block'>invokesuper_block</span>))
  <span class='kw'>end</span>

  <span class='comment'># We need to assume that both our current method entry and the super
</span>  <span class='comment'># method entry we invoke remain stable
</span>  <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_method_lookup_stable'><a href="Invariants.html#assume_method_lookup_stable-class_method" title="RubyVM::RJIT::Invariants.assume_method_lookup_stable (method)">assume_method_lookup_stable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_me'>me</span>)
  <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_method_lookup_stable'><a href="Invariants.html#assume_method_lookup_stable-class_method" title="RubyVM::RJIT::Invariants.assume_method_lookup_stable (method)">assume_method_lookup_stable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span>)

  <span class='comment'># Method calls may corrupt types
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_clear_local_types'>clear_local_types</span>

  <span class='id identifier rubyid_calling'>calling</span> <span class='op'>=</span> <span class='id identifier rubyid_build_calling'><a href="#build_calling-instance_method" title="RubyVM::RJIT::InsnCompiler#build_calling (method)">build_calling</a></span>(<span class='label'>ci:</span><span class='comma'>,</span> <span class='label'>block_handler:</span> <span class='id identifier rubyid_block'>block</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_cme_def_type'>cme_def_type</span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_ISEQ</span>
    <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='id identifier rubyid_def_iseq_ptr'><a href="#def_iseq_ptr-instance_method" title="RubyVM::RJIT::InsnCompiler#def_iseq_ptr (method)">def_iseq_ptr</a></span>(<span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>)
    <span class='id identifier rubyid_frame_type'>frame_type</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_MAGIC_METHOD</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_FLAG_LOCAL</span>
    <span class='id identifier rubyid_jit_call_iseq'><a href="#jit_call_iseq-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_iseq (method)">jit_call_iseq</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='label'>frame_type:</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_CFUNC</span>
    <span class='id identifier rubyid_jit_call_cfunc'><a href="#jit_call_cfunc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_cfunc (method)">jit_call_cfunc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_array_len-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_array_len</strong>(asm, array_reg, len_reg)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate RARRAY_LEN. For array_opnd, use <code>Opnd::Reg</code> to reduce memory access, and use <code>Opnd::Mem</code> to save registers.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5878-L5893'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5878' data-end='5893'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5878</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_array_len'>jit_array_len</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_len_reg'>len_reg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>get array length for embedded or heap</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># Pull out the embed flag to check if it&#39;s an embedded array.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_len_reg'>len_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])

  <span class='comment'># Get the length of the array
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='id identifier rubyid_len_reg'>len_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_LEN_MASK</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_sar'>sar</span>(<span class='id identifier rubyid_len_reg'>len_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_LEN_SHIFT</span>)

  <span class='comment'># Conditionally move the length of the heap array
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>([<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_FLAG</span>)

  <span class='comment'># Select the array length value
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovz'>cmovz</span>(<span class='id identifier rubyid_len_reg'>len_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_len'>len</span>)])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_array_ptr-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_array_ptr</strong>(asm, array_reg, ary_opnd)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate RARRAY_CONST_PTR (part of RARRAY_AREF)</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5896-L5906'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5896' data-end='5906'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5896</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_array_ptr'>jit_array_ptr</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_ary_opnd'>ary_opnd</span>) <span class='comment'># clobbers array_reg
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>get array pointer for embedded or heap</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_flags_opnd'>flags_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)]
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_flags_opnd'>flags_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_FLAG</span>)
  <span class='comment'># Load the address of the embedded array
</span>  <span class='comment'># (struct RArray *)(obj)-&gt;as.ary
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ptr'>ptr</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>)]) <span class='comment'># clobbers array_reg
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovnz'>cmovnz</span>(<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_alias-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_alias</strong>(jit, ctx, asm, calling, cme, comptime_recv, recv_opnd, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_alias</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5382-L5385'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5382' data-end='5385'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5382</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_alias'>jit_call_alias</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='id identifier rubyid_cme'>cme</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_aliased_callable_method_entry'>rb_aliased_callable_method_entry</span>(<span class='id identifier rubyid_cme'>cme</span>)
  <span class='id identifier rubyid_jit_call_method_each_type'><a href="#jit_call_method_each_type-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_method_each_type (method)">jit_call_method_each_type</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_attrset-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_attrset</strong>(jit, ctx, asm, cme, calling, comptime_recv, recv_opnd)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_attrset</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5252-L5302'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5252' data-end='5302'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5252</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_attrset'>jit_call_attrset</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
  <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span>
  <span class='id identifier rubyid_send_shift'>send_shift</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_attrset_splat'>send_attrset_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KWARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_attrset_kwarg'>send_attrset_kwarg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span> <span class='op'>||</span> <span class='op'>!</span><span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_OBJECT</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_attrset_method'>send_attrset_method</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_c_method_tracing_currently_enabled?'><a href="#c_method_tracing_currently_enabled%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#c_method_tracing_currently_enabled? (method)">c_method_tracing_currently_enabled?</a></span>
    <span class='comment'># Can&#39;t generate code for firing c_call and c_return events
</span>    <span class='comment'># See :attr-tracing:
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_c_tracingg'>send_c_tracingg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_block_arg'>send_block_arg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ivar_name'>ivar_name</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_id'>id</span>

  <span class='comment'># This is a .send call and we need to adjust the stack
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_handle_opt_send_shift_stack'><a href="#handle_opt_send_shift_stack-instance_method" title="RubyVM::RJIT::InsnCompiler#handle_opt_send_shift_stack (method)">handle_opt_send_shift_stack</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='kw'>end</span>

  <span class='comment'># Save the PC and SP because the callee may allocate
</span>  <span class='comment'># Note that this modifies REG_SP, which is why we do it first
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Get the operands from the stack
</span>  <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># Call rb_vm_set_ivar_id with the receiver, the ivar name, and the value
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ivar_name'>ivar_name</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_val_opnd'>val_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_set_ivar_id'>rb_vm_set_ivar_id</span>)

  <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_bmethod-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_bmethod</strong>(jit, ctx, asm, calling, cme, comptime_recv, recv_opnd, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_bmethod</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5343-L5376'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5343' data-end='5376'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5343</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_bmethod'>jit_call_bmethod</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='id identifier rubyid_proc_addr'>proc_addr</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_bmethod'>bmethod</span>.<span class='id identifier rubyid_proc'>proc</span>

  <span class='id identifier rubyid_proc_t'>proc_t</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_yjit_get_proc_ptr'>rb_yjit_get_proc_ptr</span>(<span class='id identifier rubyid_proc_addr'>proc_addr</span>)
  <span class='id identifier rubyid_proc_block'>proc_block</span> <span class='op'>=</span> <span class='id identifier rubyid_proc_t'>proc_t</span>.<span class='id identifier rubyid_block'>block</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_proc_block'>proc_block</span>.<span class='id identifier rubyid_type'>type</span> <span class='op'>!=</span> <span class='const'>C</span>.<span class='id identifier rubyid_block_type_iseq'>block_type_iseq</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_bmethod_not_iseq'>send_bmethod_not_iseq</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_capture'>capture</span> <span class='op'>=</span> <span class='id identifier rubyid_proc_block'>proc_block</span>.<span class='id identifier rubyid_as'>as</span>.<span class='id identifier rubyid_captured'>captured</span>
  <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='id identifier rubyid_capture'>capture</span>.<span class='id identifier rubyid_code'>code</span>.<span class='id identifier rubyid_iseq'>iseq</span>

  <span class='comment'># TODO: implement this
</span>  <span class='comment'># Optimize for single ractor mode and avoid runtime check for
</span>  <span class='comment'># &quot;defined with an un-shareable Proc in a different Ractor&quot;
</span>  <span class='comment'># if !assume_single_ractor_mode(jit, ocb)
</span>  <span class='comment'>#     return CantCompile;
</span>  <span class='comment'># end
</span>
  <span class='comment'># Passing a block to a block needs logic different from passing
</span>  <span class='comment'># a block to a method and sometimes requires allocation. Bail for now.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>!=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_bmethod_blockarg'>send_bmethod_blockarg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jit_call_iseq'><a href="#jit_call_iseq-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_iseq (method)">jit_call_iseq</a></span>(
    <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
    <span class='label'>frame_type:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_MAGIC_BLOCK</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_BMETHOD</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_LAMBDA</span><span class='comma'>,</span>
    <span class='label'>prev_ep:</span> <span class='id identifier rubyid_capture'>capture</span>.<span class='id identifier rubyid_ep'>ep</span><span class='comma'>,</span>
  )
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_cfunc-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_cfunc</strong>(jit, ctx, asm, cme, calling, known_recv_class: nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_cfunc</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5024-L5246'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5024' data-end='5246'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5024</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_cfunc'>jit_call_cfunc</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='label'>known_recv_class:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span>

  <span class='id identifier rubyid_cfunc'>cfunc</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_cfunc'>cfunc</span>
  <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>=</span> <span class='id identifier rubyid_cfunc'>cfunc</span>.<span class='id identifier rubyid_argc'>argc</span>

  <span class='comment'># If the function expects a Ruby array of arguments
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>!=</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_ruby_array_varg'>send_cfunc_ruby_array_varg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># We aren&#39;t handling a vararg cfuncs with splat currently.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_cfunc_var_args'>send_args_splat_cfunc_var_args</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ZSUPER</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># zsuper methods are super calls without any arguments.
</span>    <span class='comment'># They are also marked as splat, but don&#39;t actually have an array
</span>    <span class='comment'># they pull arguments from, instead we need to change to call
</span>    <span class='comment'># a different method with the current stack.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_cfunc_zuper'>send_args_splat_cfunc_zuper</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='comment'># In order to handle backwards compatibility between ruby 3 and 2
</span>  <span class='comment'># ruby2_keywords was introduced. It is called only on methods
</span>  <span class='comment'># with splat and changes they way they handle them.
</span>  <span class='comment'># We are just going to not compile these.
</span>  <span class='comment'># https://docs.ruby-lang.org/en/3.2/Module.html#method-i-ruby2_keywords
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_ruby2_keywords'>ruby2_keywords</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_cfunc_ruby2_keywords'>send_args_splat_cfunc_ruby2_keywords</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_kw_arg'>kw_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_kwarg'>kwarg</span>
  <span class='id identifier rubyid_kw_arg_num'>kw_arg_num</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='int'>0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_keyword_len'>keyword_len</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg_num'>kw_arg_num</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_splat_with_kw'>send_cfunc_splat_with_kw</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_c_method_tracing_currently_enabled?'><a href="#c_method_tracing_currently_enabled%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#c_method_tracing_currently_enabled? (method)">c_method_tracing_currently_enabled?</a></span>
    <span class='comment'># Don&#39;t JIT if tracing c_call or c_return
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_tracing'>send_cfunc_tracing</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Delegate to codegen for C methods if we have it.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>==</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span>)
    <span class='id identifier rubyid_known_cfunc_codegen'>known_cfunc_codegen</span> <span class='op'>=</span> <span class='id identifier rubyid_lookup_cfunc_codegen'><a href="#lookup_cfunc_codegen-instance_method" title="RubyVM::RJIT::InsnCompiler#lookup_cfunc_codegen (method)">lookup_cfunc_codegen</a></span>(<span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_known_cfunc_codegen'>known_cfunc_codegen</span><span class='op'>&amp;.</span><span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
      <span class='comment'># cfunc codegen generated code. Terminate the block so
</span>      <span class='comment'># there isn&#39;t multiple calls in the same block.
</span>      <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Check for interrupts
</span>  <span class='id identifier rubyid_jit_check_ints'><a href="#jit_check_ints-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_check_ints (method)">jit_check_ints</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Stack overflow check
</span>  <span class='comment'># #define CHECK_VM_STACK_OVERFLOW0(cfp, sp, margin)
</span>  <span class='comment'># REG_CFP &lt;= REG_SP + 4 * SIZEOF_VALUE + sizeof(rb_control_frame_t)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stack overflow check</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>4</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_size'>size</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jbe'>jbe</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_stackoverflow'>send_stackoverflow</span>))

  <span class='comment'># Number of args which will be passed through to the callee
</span>  <span class='comment'># This is adjusted by the kwargs being combined into a hash.
</span>  <span class='id identifier rubyid_passed_argc'>passed_argc</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_argc'>argc</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='id identifier rubyid_kw_arg_num'>kw_arg_num</span> <span class='op'>+</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='comment'># If the argument count doesn&#39;t match
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>&gt;=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>!=</span> <span class='id identifier rubyid_passed_argc'>passed_argc</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_argc_mismatch'>send_cfunc_argc_mismatch</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t JIT functions that need C stack arguments for now
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>&gt;=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_passed_argc'>passed_argc</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>&gt;</span> <span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>.<span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_toomany_args'>send_cfunc_toomany_args</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_block_arg'>block_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>

  <span class='comment'># Guard block_arg_type
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_guard_block_arg'><a href="#guard_block_arg-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_block_arg (method)">guard_block_arg</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>) <span class='op'>==</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_arg'>block_arg</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='kw'>end</span>

  <span class='comment'># push_splat_args does stack manipulation so we can no longer side exit
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>&gt;=</span> <span class='int'>0</span>)
    <span class='id identifier rubyid_required_args'>required_args</span> <span class='op'>=</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span> <span class='op'>-</span> (<span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span>)
    <span class='comment'># + 1 because we pass self
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_required_args'>required_args</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>.<span class='id identifier rubyid_size'>size</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_toomany_args'>send_cfunc_toomany_args</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># We are going to assume that the splat fills
</span>    <span class='comment'># all the remaining arguments. So the number of args
</span>    <span class='comment'># should just equal the number of args the cfunc takes.
</span>    <span class='comment'># In the generated code we test if this is true
</span>    <span class='comment'># and if not side exit.
</span>    <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span>
    <span class='id identifier rubyid_passed_argc'>passed_argc</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span>
    <span class='id identifier rubyid_push_splat_args'><a href="#push_splat_args-instance_method" title="RubyVM::RJIT::InsnCompiler#push_splat_args (method)">push_splat_args</a></span>(<span class='id identifier rubyid_required_args'>required_args</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='comment'># This is a .send call and we need to adjust the stack
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_handle_opt_send_shift_stack'><a href="#handle_opt_send_shift_stack-instance_method" title="RubyVM::RJIT::InsnCompiler#handle_opt_send_shift_stack (method)">handle_opt_send_shift_stack</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>send_shift:</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>)
  <span class='kw'>end</span>

  <span class='comment'># Points to the receiver operand on the stack
</span>
  <span class='comment'># Store incremented PC into current control frame in case callee raises.
</span>  <span class='id identifier rubyid_jit_save_pc'><a href="#jit_save_pc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_pc (method)">jit_save_pc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Increment the stack pointer by 3 (in the callee)
</span>  <span class='comment'># sp += 3
</span>
  <span class='id identifier rubyid_frame_type'>frame_type</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_MAGIC_CFUNC</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_CFRAME</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_FLAG_LOCAL</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg'>kw_arg</span>
    <span class='id identifier rubyid_frame_type'>frame_type</span> <span class='op'>|=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_FLAG_CFRAME_KW</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jit_push_frame'><a href="#jit_push_frame-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_push_frame (method)">jit_push_frame</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_frame_type'>frame_type</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg'>kw_arg</span>
    <span class='comment'># Build a hash from all kwargs passed
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>build_kwhash</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_imemo_ci'>imemo_ci</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_ci_addr'>ci_addr</span>
    <span class='comment'># we assume all callinfos with kwargs are on the GC heap
</span>    <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_imemo_type_p'>imemo_type_p</span>(<span class='id identifier rubyid_imemo_ci'>imemo_ci</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_imemo_callinfo'>imemo_callinfo</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_imemo_ci'>imemo_ci</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='int'>0</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rjit_build_kwhash'>rjit_build_kwhash</span>)

    <span class='comment'># Replace the stack location at the start of kwargs with the new hash
</span>    <span class='id identifier rubyid_stack_opnd'>stack_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='id identifier rubyid_passed_argc'>passed_argc</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_opnd'>stack_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>end</span>

  <span class='comment'># Copy SP because REG_SP will get overwritten
</span>  <span class='id identifier rubyid_sp'>sp</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='id identifier rubyid_sp'>sp</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='int'>0</span>))

  <span class='comment'># Pop the C function arguments from the stack (in the caller)
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> <span class='int'>1</span>)

  <span class='comment'># Write interpreter SP into CFP.
</span>  <span class='comment'># Needed in case the callee yields to the block.
</span>  <span class='id identifier rubyid_jit_save_sp'><a href="#jit_save_sp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_sp (method)">jit_save_sp</a></span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Non-variadic method
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_cfunc_argc'>cfunc_argc</span>
  <span class='kw'>in</span> (<span class='int'>0</span><span class='op'>..</span>) <span class='comment'># Non-variadic method
</span>    <span class='comment'># Copy the arguments from the stack to the C argument registers
</span>    <span class='comment'># self is the 0th argument and is at index argc from the stack top
</span>    (<span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_passed_argc'>passed_argc</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='id identifier rubyid_i'>i</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_sp'>sp</span><span class='comma'>,</span> <span class='op'>-</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_i'>i</span>) <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])
    <span class='kw'>end</span>
  <span class='kw'>in</span> <span class='op'>-</span><span class='int'>1</span> <span class='comment'># Variadic method: rb_f_puts(int argc, VALUE *argv, VALUE recv)
</span>    <span class='comment'># The method gets a pointer to the first argument
</span>    <span class='comment'># rb_f_puts(int argc, VALUE *argv, VALUE recv)
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_passed_argc'>passed_argc</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_sp'>sp</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_argc'>argc</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>]) <span class='comment'># argv
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> [<span class='id identifier rubyid_sp'>sp</span><span class='comma'>,</span> <span class='op'>-</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> <span class='int'>1</span>) <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>]) <span class='comment'># recv
</span>  <span class='kw'>end</span>

  <span class='comment'># Call the C function
</span>  <span class='comment'># VALUE ret = (cfunc-&gt;func)(recv, argv[0], argv[1]);
</span>  <span class='comment'># cfunc comes from compile-time cme-&gt;def, which we assume to be stable.
</span>  <span class='comment'># Invalidation logic is in yjit_method_lookup_change()
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call C function</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_cfunc'>cfunc</span>.<span class='id identifier rubyid_func'>func</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># TODO: use rel32 if close enough
</span>
  <span class='comment'># Record code position for TracePoint patching. See full_cfunc_return().
</span>  <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_record_global_inval_patch'><a href="Invariants.html#record_global_inval_patch-class_method" title="RubyVM::RJIT::Invariants.record_global_inval_patch (method)">record_global_inval_patch</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_full_cfunc_return'><a href="#full_cfunc_return-instance_method" title="RubyVM::RJIT::InsnCompiler#full_cfunc_return (method)">full_cfunc_return</a></span>)

  <span class='comment'># Push the return value on the Ruby stack
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='comment'># Pop the stack frame (ec-&gt;cfp++)
</span>  <span class='comment'># Instead of recalculating, we can reuse the previous CFP, which is stored in a callee-saved
</span>  <span class='comment'># register
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_execution_context_t'>rb_execution_context_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_cfp'>cfp</span>)]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span>)

  <span class='comment'># cfunc calls may corrupt types
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_clear_local_types'>clear_local_types</span>

  <span class='comment'># Note: the return block of jit_call_iseq has ctx-&gt;sp_offset == 1
</span>  <span class='comment'># which allows for sharing the same successor.
</span>
  <span class='comment'># Jump (fall through) to the call continuation block
</span>  <span class='comment'># We do this to end the current block after the call
</span>  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span>)
  <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_general-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_general</strong>(jit, ctx, asm, mid, calling, cme, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_general</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4308-L4310'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4308' data-end='4310'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4308</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_general'>jit_call_general</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='id identifier rubyid_jit_call_method'><a href="#jit_call_method-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_method (method)">jit_call_method</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_iseq-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_iseq</strong>(jit, ctx, asm, cme, calling, iseq, frame_type: nil, prev_ep: nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_iseq_setup</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4403-L4978'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4403' data-end='4978'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4403</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_iseq'>jit_call_iseq</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='label'>frame_type:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>prev_ep:</span> <span class='kw'>nil</span>)
  <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span>
  <span class='id identifier rubyid_send_shift'>send_shift</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>

  <span class='comment'># When you have keyword arguments, there is an extra object that gets
</span>  <span class='comment'># placed on the stack the represents a bitmap of the keywords that were not
</span>  <span class='comment'># specified at the call site. We need to keep track of the fact that this
</span>  <span class='comment'># value is present on the stack in order to properly set up the callee&#39;s
</span>  <span class='comment'># stack pointer.
</span>  <span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_kw'>has_kw</span>
  <span class='id identifier rubyid_supplying_kws'>supplying_kws</span> <span class='op'>=</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KWARG</span> <span class='op'>!=</span> <span class='int'>0</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_TAILCALL</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># We can&#39;t handle tailcalls
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_tailcall'>send_tailcall</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># No support for callees with these parameters yet as they require allocation
</span>  <span class='comment'># or complex handling.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_post'>has_post</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_opt'>send_iseq_has_opt</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_kwrest'>has_kwrest</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_kwrest'>send_iseq_has_kwrest</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># In order to handle backwards compatibility between ruby 3 and 2
</span>  <span class='comment'># ruby2_keywords was introduced. It is called only on methods
</span>  <span class='comment'># with splat and changes they way they handle them.
</span>  <span class='comment'># We are just going to not compile these.
</span>  <span class='comment'># https://www.rubydoc.info/stdlib/core/Proc:ruby2_keywords
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_ruby2_keywords'>ruby2_keywords</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_ruby2_keywords'>send_iseq_ruby2_keywords</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_rest'>has_rest</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_rest_and_captured'>send_iseq_has_rest_and_captured</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_kw'>has_kw</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_supplying_kws'>supplying_kws</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_rest_and_kw_supplied'>send_iseq_has_rest_and_kw_supplied</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># If we have keyword arguments being passed to a callee that only takes
</span>  <span class='comment'># positionals, then we need to allocate a hash. For now we&#39;re going to
</span>  <span class='comment'># call that too complex and bail.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_supplying_kws'>supplying_kws</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_kw'>has_kw</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_no_kw'>send_iseq_has_no_kw</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># If we have a method accepting no kwargs (**nil), exit if we have passed
</span>  <span class='comment'># it any kwargs.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_supplying_kws'>supplying_kws</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_accepts_no_kwarg'>accepts_no_kwarg</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_accepts_no_kwarg'>send_iseq_accepts_no_kwarg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># For computing number of locals to set up for the callee
</span>  <span class='id identifier rubyid_num_params'>num_params</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_size'>size</span>

  <span class='comment'># Block parameter handling. This mirrors setup_parameters_complex().
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_block'>has_block</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_iseq'>local_iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_num_params'>num_params</span> <span class='op'>-=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='comment'># In this case (param.flags.has_block &amp;&amp; local_iseq != iseq),
</span>      <span class='comment'># the block argument is setup as a local variable and requires
</span>      <span class='comment'># materialization (allocation). Bail.
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_materialized_block'>send_iseq_materialized_block</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ZSUPER</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># zsuper methods are super calls without any arguments.
</span>    <span class='comment'># They are also marked as splat, but don&#39;t actually have an array
</span>    <span class='comment'># they pull arguments from, instead we need to change to call
</span>    <span class='comment'># a different method with the current stack.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_zsuper'>send_iseq_zsuper</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_start_pc_offset'>start_pc_offset</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_lead_num'>lead_num</span>

  <span class='comment'># This struct represents the metadata about the caller-specified
</span>  <span class='comment'># keyword arguments.
</span>  <span class='id identifier rubyid_kw_arg'>kw_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_kwarg'>kwarg</span>
  <span class='id identifier rubyid_kw_arg_num'>kw_arg_num</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='int'>0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_keyword_len'>keyword_len</span>
  <span class='kw'>end</span>

  <span class='comment'># Arity handling and optional parameter setup
</span>  <span class='id identifier rubyid_opts_filled'>opts_filled</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>-</span> <span class='id identifier rubyid_kw_arg_num'>kw_arg_num</span>
  <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_opt_num'>opt_num</span>
  <span class='id identifier rubyid_opts_missing'>opts_missing</span> <span class='op'>=</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>-</span> <span class='id identifier rubyid_opts_filled'>opts_filled</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_splat_with_kw'>send_iseq_splat_with_kw</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_kw_splat'>send_iseq_kw_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_rest_and_optional'>send_iseq_has_rest_and_optional</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_opts_filled'>opts_filled</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='comment'># Too few arguments and no splat to make up for it
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_arity_error'>send_iseq_arity_error</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_opts_filled'>opts_filled</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span>
    <span class='comment'># Too many arguments and no place to put them (i.e. rest arg)
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_arity_error'>send_iseq_arity_error</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_block_arg'>block_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>

  <span class='comment'># Guard block_arg_type
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_guard_block_arg'><a href="#guard_block_arg-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_block_arg (method)">guard_block_arg</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>) <span class='op'>==</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># If we have unfilled optional arguments and keyword arguments then we
</span>  <span class='comment'># would need to adjust the arguments location to account for that.
</span>  <span class='comment'># For now we aren&#39;t handling this case.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts_missing'>opts_missing</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_missing_optional_kw'>send_iseq_missing_optional_kw</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># We will handle splat case later
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_num_params'>num_params</span> <span class='op'>-=</span> <span class='id identifier rubyid_opts_missing'>opts_missing</span>
    <span class='id identifier rubyid_start_pc_offset'>start_pc_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_opt_table'>opt_table</span>[<span class='id identifier rubyid_opts_filled'>opts_filled</span>]
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span>
    <span class='comment'># Here we&#39;re calling a method with keyword arguments and specifying
</span>    <span class='comment'># keyword arguments at this call site.
</span>
    <span class='comment'># This struct represents the metadata about the callee-specified
</span>    <span class='comment'># keyword parameters.
</span>    <span class='id identifier rubyid_keyword'>keyword</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_keyword'>keyword</span>
    <span class='id identifier rubyid_keyword_num'>keyword_num</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_num'>num</span>
    <span class='id identifier rubyid_keyword_required_num'>keyword_required_num</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_required_num'>required_num</span>

    <span class='id identifier rubyid_required_kwargs_filled'>required_kwargs_filled</span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_keyword_num'>keyword_num</span> <span class='op'>&gt;</span> <span class='int'>30</span>
      <span class='comment'># We have so many keywords that (1 &lt;&lt; num) encoded as a FIXNUM
</span>      <span class='comment'># (which shifts it left one more) no longer fits inside a 32-bit
</span>      <span class='comment'># immediate.
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_too_many_kwargs'>send_iseq_too_many_kwargs</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that the kwargs being passed are valid
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_supplying_kws'>supplying_kws</span>
      <span class='comment'># This is the list of keyword arguments that the callee specified
</span>      <span class='comment'># in its initial declaration.
</span>      <span class='comment'># SAFETY: see compile.c for sizing of this slice.
</span>      <span class='id identifier rubyid_callee_kwargs'>callee_kwargs</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword_num'>keyword_num</span>.<span class='id identifier rubyid_times'>times</span>.<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_table'>table</span>[<span class='id identifier rubyid_i'>i</span>] }

      <span class='comment'># Here we&#39;re going to build up a list of the IDs that correspond to
</span>      <span class='comment'># the caller-specified keyword arguments. If they&#39;re not in the
</span>      <span class='comment'># same order as the order specified in the callee declaration, then
</span>      <span class='comment'># we&#39;re going to need to generate some code to swap values around
</span>      <span class='comment'># on the stack.
</span>      <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span> <span class='op'>=</span> []
      <span class='id identifier rubyid_kw_arg'>kw_arg</span>.<span class='id identifier rubyid_keyword_len'>keyword_len</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span><span class='op'>|</span>
        <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_ruby'>to_ruby</span>(<span class='id identifier rubyid_kw_arg'>kw_arg</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_keywords'>keywords</span>][<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>])
        <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span> <span class='op'>&lt;&lt;</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_sym2id'>rb_sym2id</span>(<span class='id identifier rubyid_sym'>sym</span>)
      <span class='kw'>end</span>

      <span class='comment'># First, we&#39;re going to be sure that the names of every
</span>      <span class='comment'># caller-specified keyword argument correspond to a name in the
</span>      <span class='comment'># list of callee-specified keyword parameters.
</span>      <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_caller_kwarg'>caller_kwarg</span><span class='op'>|</span>
        <span class='id identifier rubyid_search_result'>search_result</span> <span class='op'>=</span> <span class='id identifier rubyid_callee_kwargs'>callee_kwargs</span>.<span class='id identifier rubyid_map'>map</span>.<span class='id identifier rubyid_with_index'>with_index</span>.<span class='id identifier rubyid_find'>find</span> { <span class='op'>|</span><span class='id identifier rubyid_kwarg'>kwarg</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_kwarg'>kwarg</span> <span class='op'>==</span> <span class='id identifier rubyid_caller_kwarg'>caller_kwarg</span> }

        <span class='kw'>case</span> <span class='id identifier rubyid_search_result'>search_result</span>
        <span class='kw'>in</span> <span class='kw'>nil</span>
          <span class='comment'># If the keyword was never found, then we know we have a
</span>          <span class='comment'># mismatch in the names of the keyword arguments, so we need to
</span>          <span class='comment'># bail.
</span>          <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_kwargs_mismatch'>send_iseq_kwargs_mismatch</span>)
          <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
        <span class='kw'>in</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_callee_idx'>callee_idx</span> <span class='kw'>if</span> <span class='id identifier rubyid_callee_idx'>callee_idx</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_keyword_required_num'>keyword_required_num</span>
          <span class='comment'># Keep a count to ensure all required kwargs are specified
</span>          <span class='id identifier rubyid_required_kwargs_filled'>required_kwargs_filled</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>else</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_required_kwargs_filled'>required_kwargs_filled</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_keyword_required_num'>keyword_required_num</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_required_kwargs_filled'>required_kwargs_filled</span> <span class='op'>!=</span> <span class='id identifier rubyid_keyword_required_num'>keyword_required_num</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_kwargs_mismatch'>send_iseq_kwargs_mismatch</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Check if we need the arg0 splat handling of vm_callee_setup_block_arg
</span>  <span class='id identifier rubyid_arg_setup_block'>arg_setup_block</span> <span class='op'>=</span> (<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>) <span class='comment'># arg_setup_type: arg_setup_block (invokeblock)
</span>  <span class='id identifier rubyid_block_arg0_splat'>block_arg0_splat</span> <span class='op'>=</span> <span class='id identifier rubyid_arg_setup_block'>arg_setup_block</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span>
    (<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_has_lead'>has_lead</span> <span class='op'>||</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>&gt;</span> <span class='int'>1</span>) <span class='op'>&amp;&amp;</span>
    <span class='op'>!</span><span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_ambiguous_param0'>ambiguous_param0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_arg0_splat'>block_arg0_splat</span>
    <span class='comment'># If block_arg0_splat, we still need side exits after splat, but
</span>    <span class='comment'># doing push_splat_args here disallows it. So bail out.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_iseq_arg0_args_splat'>invokeblock_iseq_arg0_args_splat</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
    <span class='comment'># The block_arg0_splat implementation is for the rb_simple_iseq_p case,
</span>    <span class='comment'># but doing_kw_call means it&#39;s not a simple ISEQ.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_iseq_arg0_has_kw'>invokeblock_iseq_arg0_has_kw</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
    <span class='comment'># The block_arg0_splat implementation cannot deal with optional parameters.
</span>    <span class='comment'># This is a setup_parameters_complex() situation and interacts with the
</span>    <span class='comment'># starting position of the callee.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_invokeblock_iseq_arg0_optional'>invokeblock_iseq_arg0_optional</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span>
    <span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_block_arg'>block_arg</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>)
    <span class='id identifier rubyid_splat_array_length'>splat_array_length</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='int'>0</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_array'>array</span>.<span class='id identifier rubyid_length'>length</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>!=</span> <span class='id identifier rubyid_splat_array_length'>splat_array_length</span> <span class='op'>+</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_splat_arity_error'>send_iseq_splat_arity_error</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t compile forwardable iseqs
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_flags'>flags</span>.<span class='id identifier rubyid_forwardable'>forwardable</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># We will not have CantCompile from here.
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_arg'>block_arg</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_builtin_attrs'>builtin_attrs</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BUILTIN_ATTR_LEAF</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_jit_leaf_builtin_func'><a href="#jit_leaf_builtin_func-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_leaf_builtin_func (method)">jit_leaf_builtin_func</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Number of locals that are not parameters
</span>  <span class='id identifier rubyid_num_locals'>num_locals</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_table_size'>local_table_size</span> <span class='op'>-</span> <span class='id identifier rubyid_num_params'>num_params</span>

  <span class='comment'># Stack overflow check
</span>  <span class='comment'># Note that vm_push_frame checks it against a decremented cfp, hence the multiply by 2.
</span>  <span class='comment'># #define CHECK_VM_STACK_OVERFLOW0(cfp, sp, margin)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stack overflow check</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_locals_offs'>locals_offs</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_num_locals'>num_locals</span> <span class='op'>+</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_stack_max'>stack_max</span>) <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='id identifier rubyid_locals_offs'>locals_offs</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jbe'>jbe</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_stackoverflow'>send_stackoverflow</span>))

  <span class='comment'># push_splat_args does stack manipulation so we can no longer side exit
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_splat_array_length'>splat_array_length</span>
    <span class='id identifier rubyid_remaining_opt'>remaining_opt</span> <span class='op'>=</span> (<span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>+</span> <span class='id identifier rubyid_required_num'>required_num</span>) <span class='op'>-</span> (<span class='id identifier rubyid_splat_array_length'>splat_array_length</span> <span class='op'>+</span> (<span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span>))

    <span class='kw'>if</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='comment'># We are going to jump to the correct offset based on how many optional
</span>      <span class='comment'># params are remaining.
</span>      <span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='id identifier rubyid_opt_num'>opt_num</span> <span class='op'>-</span> <span class='id identifier rubyid_remaining_opt'>remaining_opt</span>
      <span class='id identifier rubyid_start_pc_offset'>start_pc_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_opt_table'>opt_table</span>[<span class='id identifier rubyid_offset'>offset</span>]
    <span class='kw'>end</span>
    <span class='comment'># We are going to assume that the splat fills
</span>    <span class='comment'># all the remaining arguments. In the generated code
</span>    <span class='comment'># we test if this is true and if not side exit.
</span>    <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_splat_array_length'>splat_array_length</span> <span class='op'>+</span> <span class='id identifier rubyid_remaining_opt'>remaining_opt</span>
    <span class='id identifier rubyid_push_splat_args'><a href="#push_splat_args-instance_method" title="RubyVM::RJIT::InsnCompiler#push_splat_args (method)">push_splat_args</a></span>(<span class='id identifier rubyid_splat_array_length'>splat_array_length</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_remaining_opt'>remaining_opt</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
      <span class='comment'># We need to push nil for the optional arguments
</span>      <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># This is a .send call and we need to adjust the stack
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_handle_opt_send_shift_stack'><a href="#handle_opt_send_shift_stack-instance_method" title="RubyVM::RJIT::InsnCompiler#handle_opt_send_shift_stack (method)">handle_opt_send_shift_stack</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_iseq_has_rest'>iseq_has_rest</span>
    <span class='comment'># We are going to allocate so setting pc and sp.
</span>    <span class='id identifier rubyid_jit_save_pc'><a href="#jit_save_pc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_pc (method)">jit_save_pc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>) <span class='comment'># clobbers rax
</span>    <span class='id identifier rubyid_jit_save_sp'><a href="#jit_save_sp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_sp (method)">jit_save_sp</a></span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_non_rest_arg_count'>non_rest_arg_count</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='comment'># We start by dupping the array because someone else might have
</span>      <span class='comment'># a reference to it.
</span>      <span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_dup'>rb_ary_dup</span>)
      <span class='id identifier rubyid_array'>array</span> <span class='op'>=</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_non_rest_arg_count'>non_rest_arg_count</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_required_num'>required_num</span>
        <span class='comment'># If we have more arguments than required, we need to prepend
</span>        <span class='comment'># the items from the stack onto the array.
</span>        <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> (<span class='id identifier rubyid_non_rest_arg_count'>non_rest_arg_count</span> <span class='op'>-</span> <span class='id identifier rubyid_required_num'>required_num</span>)

        <span class='comment'># diff is &gt;0 so no need to worry about null pointer
</span>        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>load pointer to array elements</span><span class='tstring_end'>&#39;</span></span>)
        <span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_diff'>diff</span>
        <span class='id identifier rubyid_values_opnd'>values_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span>)
        <span class='id identifier rubyid_values_ptr'>values_ptr</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='id identifier rubyid_values_ptr'>values_ptr</span><span class='comma'>,</span> <span class='id identifier rubyid_values_opnd'>values_opnd</span>)

        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>prepend stack values to rest array</span><span class='tstring_end'>&#39;</span></span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_diff'>diff</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_values_ptr'>values_ptr</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_unshift_m'>rb_ary_unshift_m</span>)
        <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_diff'>diff</span>)

        <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
        <span class='comment'># We now should have the required arguments
</span>        <span class='comment'># and an array of all the rest arguments
</span>        <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>+</span> <span class='int'>1</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_non_rest_arg_count'>non_rest_arg_count</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_required_num'>required_num</span>
        <span class='comment'># If we have fewer arguments than required, we need to take some
</span>        <span class='comment'># from the array and move them to the stack.
</span>        <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> (<span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>-</span> <span class='id identifier rubyid_non_rest_arg_count'>non_rest_arg_count</span>)
        <span class='comment'># This moves the arguments onto the stack. But it doesn&#39;t modify the array.
</span>        <span class='id identifier rubyid_move_rest_args_to_stack'><a href="#move_rest_args_to_stack-instance_method" title="RubyVM::RJIT::InsnCompiler#move_rest_args_to_stack (method)">move_rest_args_to_stack</a></span>(<span class='id identifier rubyid_array'>array</span><span class='comma'>,</span> <span class='id identifier rubyid_diff'>diff</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

        <span class='comment'># We will now slice the array to give us a new array of the correct size
</span>        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_diff'>diff</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rjit_rb_ary_subseq_length'>rjit_rb_ary_subseq_length</span>)
        <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

        <span class='comment'># We now should have the required arguments
</span>        <span class='comment'># and an array of all the rest arguments
</span>        <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>+</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='comment'># The arguments are equal so we can just push to the stack
</span>        <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='id identifier rubyid_non_rest_arg_count'>non_rest_arg_count</span><span class='comma'>,</span> <span class='id identifier rubyid_required_num'>required_num</span>)
        <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span>)
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_required_num'>required_num</span>)
      <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> (<span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='id identifier rubyid_required_num'>required_num</span>)
      <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>+</span> <span class='int'>1</span>
      <span class='comment'># If n is 0, then elts is never going to be read, so we can just pass null
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='id identifier rubyid_values_ptr'>values_ptr</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>load pointer to array elements</span><span class='tstring_end'>&#39;</span></span>)
        <span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_n'>n</span>
        <span class='id identifier rubyid_values_opnd'>values_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span>)
        <span class='id identifier rubyid_values_ptr'>values_ptr</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='id identifier rubyid_values_ptr'>values_ptr</span><span class='comma'>,</span> <span class='id identifier rubyid_values_opnd'>values_opnd</span>)
      <span class='kw'>end</span>

      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_values_ptr'>values_ptr</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ec_ary_new_from_values'>rb_ec_ary_new_from_values</span>)

      <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_n'>n</span>)
      <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span>
    <span class='comment'># Here we&#39;re calling a method with keyword arguments and specifying
</span>    <span class='comment'># keyword arguments at this call site.
</span>
    <span class='comment'># Number of positional arguments the callee expects before the first
</span>    <span class='comment'># keyword argument
</span>    <span class='id identifier rubyid_args_before_kw'>args_before_kw</span> <span class='op'>=</span> <span class='id identifier rubyid_required_num'>required_num</span> <span class='op'>+</span> <span class='id identifier rubyid_opt_num'>opt_num</span>

    <span class='comment'># This struct represents the metadata about the caller-specified
</span>    <span class='comment'># keyword arguments.
</span>    <span class='id identifier rubyid_ci_kwarg'>ci_kwarg</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_kwarg'>kwarg</span>
    <span class='id identifier rubyid_caller_keyword_len'>caller_keyword_len</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_ci_kwarg'>ci_kwarg</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='int'>0</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_ci_kwarg'>ci_kwarg</span>.<span class='id identifier rubyid_keyword_len'>keyword_len</span>
    <span class='kw'>end</span>

    <span class='comment'># This struct represents the metadata about the callee-specified
</span>    <span class='comment'># keyword parameters.
</span>    <span class='id identifier rubyid_keyword'>keyword</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_param'>param</span>.<span class='id identifier rubyid_keyword'>keyword</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>keyword args</span><span class='tstring_end'>&#39;</span></span>)

    <span class='comment'># This is the list of keyword arguments that the callee specified
</span>    <span class='comment'># in its initial declaration.
</span>    <span class='id identifier rubyid_callee_kwargs'>callee_kwargs</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_table'>table</span>
    <span class='id identifier rubyid_total_kwargs'>total_kwargs</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_num'>num</span>

    <span class='comment'># Here we&#39;re going to build up a list of the IDs that correspond to
</span>    <span class='comment'># the caller-specified keyword arguments. If they&#39;re not in the
</span>    <span class='comment'># same order as the order specified in the callee declaration, then
</span>    <span class='comment'># we&#39;re going to need to generate some code to swap values around
</span>    <span class='comment'># on the stack.
</span>    <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span> <span class='op'>=</span> []

    <span class='id identifier rubyid_caller_keyword_len'>caller_keyword_len</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_sym'>sym</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_ruby'>to_ruby</span>(<span class='id identifier rubyid_ci_kwarg'>ci_kwarg</span>[<span class='symbeg'>:</span><span class='id identifier rubyid_keywords'>keywords</span>][<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>])
      <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span> <span class='op'>&lt;&lt;</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_sym2id'>rb_sym2id</span>(<span class='id identifier rubyid_sym'>sym</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_caller_keyword_len'>caller_keyword_len</span>

    <span class='id identifier rubyid_unspecified_bits'>unspecified_bits</span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='id identifier rubyid_keyword_required_num'>keyword_required_num</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_required_num'>required_num</span>
    (<span class='id identifier rubyid_keyword_required_num'>keyword_required_num</span><span class='op'>...</span><span class='id identifier rubyid_total_kwargs'>total_kwargs</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_callee_idx'>callee_idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_already_passed'>already_passed</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_callee_kwarg'>callee_kwarg</span> <span class='op'>=</span> <span class='id identifier rubyid_callee_kwargs'>callee_kwargs</span>[<span class='id identifier rubyid_callee_idx'>callee_idx</span>]

      <span class='id identifier rubyid_caller_keyword_len'>caller_keyword_len</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_caller_idx'>caller_idx</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_caller_idx'>caller_idx</span>] <span class='op'>==</span> <span class='id identifier rubyid_callee_kwarg'>callee_kwarg</span>
          <span class='id identifier rubyid_already_passed'>already_passed</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='kw'>break</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='kw'>unless</span> <span class='id identifier rubyid_already_passed'>already_passed</span>
        <span class='comment'># Reserve space on the stack for each default value we&#39;ll be
</span>        <span class='comment'># filling in (which is done in the next loop). Also increments
</span>        <span class='comment'># argc so that the callee&#39;s SP is recorded correctly.
</span>        <span class='id identifier rubyid_argc'>argc</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_default_arg'>default_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)

        <span class='comment'># callee_idx - keyword-&gt;required_num is used in a couple of places below.
</span>        <span class='id identifier rubyid_req_num'>req_num</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_required_num'>required_num</span>
        <span class='id identifier rubyid_extra_args'>extra_args</span> <span class='op'>=</span> <span class='id identifier rubyid_callee_idx'>callee_idx</span> <span class='op'>-</span> <span class='id identifier rubyid_req_num'>req_num</span>

        <span class='comment'># VALUE default_value = keyword-&gt;default_values[callee_idx - keyword-&gt;required_num];
</span>        <span class='id identifier rubyid_default_value'>default_value</span> <span class='op'>=</span> <span class='id identifier rubyid_keyword'>keyword</span>.<span class='id identifier rubyid_default_values'>default_values</span>[<span class='id identifier rubyid_extra_args'>extra_args</span>]

        <span class='kw'>if</span> <span class='id identifier rubyid_default_value'>default_value</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#Qundef-constant" title="RubyVM::RJIT::Qundef (constant)">Qundef</a></span>
          <span class='comment'># Qundef means that this value is not constant and must be
</span>          <span class='comment'># recalculated at runtime, so we record it in unspecified_bits
</span>          <span class='comment'># (Qnil is then used as a placeholder instead of Qundef).
</span>          <span class='id identifier rubyid_unspecified_bits'>unspecified_bits</span> <span class='op'>|=</span> <span class='int'>0x01</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extra_args'>extra_args</span>
          <span class='id identifier rubyid_default_value'>default_value</span> <span class='op'>=</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_default_value'>default_value</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_default_arg'>default_arg</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

        <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>] <span class='op'>=</span> <span class='id identifier rubyid_callee_kwarg'>callee_kwarg</span>
        <span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span><span class='comma'>,</span> <span class='id identifier rubyid_total_kwargs'>total_kwargs</span>)

    <span class='comment'># Next, we&#39;re going to loop through every keyword that was
</span>    <span class='comment'># specified by the caller and make sure that it&#39;s in the correct
</span>    <span class='comment'># place. If it&#39;s not we&#39;re going to swap it around with another one.
</span>    <span class='id identifier rubyid_total_kwargs'>total_kwargs</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_callee_kwarg'>callee_kwarg</span> <span class='op'>=</span> <span class='id identifier rubyid_callee_kwargs'>callee_kwargs</span>[<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>]

      <span class='comment'># If the argument is already in the right order, then we don&#39;t
</span>      <span class='comment'># need to generate any code since the expected value is already
</span>      <span class='comment'># in the right place on the stack.
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_callee_kwarg'>callee_kwarg</span> <span class='op'>==</span> <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>]
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='comment'># In this case the argument is not in the right place, so we
</span>      <span class='comment'># need to find its position where it _should_ be and swap with
</span>      <span class='comment'># that location.
</span>      ((<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span> <span class='op'>+</span> <span class='int'>1</span>)<span class='op'>...</span><span class='id identifier rubyid_total_kwargs'>total_kwargs</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_swap_idx'>swap_idx</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_callee_kwarg'>callee_kwarg</span> <span class='op'>==</span> <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_swap_idx'>swap_idx</span>]
          <span class='comment'># First we&#39;re going to generate the code that is going
</span>          <span class='comment'># to perform the actual swapping at runtime.
</span>          <span class='id identifier rubyid_offset0'>offset0</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_swap_idx'>swap_idx</span> <span class='op'>-</span> <span class='id identifier rubyid_args_before_kw'>args_before_kw</span>
          <span class='id identifier rubyid_offset1'>offset1</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>-</span> <span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span> <span class='op'>-</span> <span class='id identifier rubyid_args_before_kw'>args_before_kw</span>
          <span class='id identifier rubyid_stack_swap'><a href="#stack_swap-instance_method" title="RubyVM::RJIT::InsnCompiler#stack_swap (method)">stack_swap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_offset0'>offset0</span><span class='comma'>,</span> <span class='id identifier rubyid_offset1'>offset1</span>)

          <span class='comment'># Next we&#39;re going to do some bookkeeping on our end so
</span>          <span class='comment'># that we know the order that the arguments are
</span>          <span class='comment'># actually in now.
</span>          <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>]<span class='comma'>,</span> <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_swap_idx'>swap_idx</span>] <span class='op'>=</span>
            <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_swap_idx'>swap_idx</span>]<span class='comma'>,</span> <span class='id identifier rubyid_caller_kwargs'>caller_kwargs</span>[<span class='id identifier rubyid_kwarg_idx'>kwarg_idx</span>]

          <span class='kw'>break</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Keyword arguments cause a special extra local variable to be
</span>    <span class='comment'># pushed onto the stack that represents the parameters that weren&#39;t
</span>    <span class='comment'># explicitly given a value and have a non-constant default.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='op'>-</span><span class='int'>1</span>)<span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_unspecified_bits'>unspecified_bits</span>))
  <span class='kw'>end</span>

  <span class='comment'># Same as vm_callee_setup_block_arg_arg0_check and vm_callee_setup_block_arg_arg0_splat
</span>  <span class='comment'># on vm_callee_setup_block_arg for arg_setup_block. This is done after CALLER_SETUP_ARG
</span>  <span class='comment'># and CALLER_REMOVE_EMPTY_KW_SPLAT, so this implementation is put here. This may need
</span>  <span class='comment'># side exits, so you still need to allow side exits here if block_arg0_splat is true.
</span>  <span class='comment'># Note that you can&#39;t have side exits after this arg0 splat.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_block_arg0_splat'>block_arg0_splat</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_block_arg0_splat'>send_iseq_block_arg0_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Create a context for the callee
</span>  <span class='id identifier rubyid_callee_ctx'>callee_ctx</span> <span class='op'>=</span> <span class='const'><a href="Context.html" title="RubyVM::RJIT::Context (class)">Context</a></span>.<span class='id identifier rubyid_new'><a href="Context.html#new-class_method" title="RubyVM::RJIT::Context.new (method)">new</a></span>

  <span class='comment'># Set the argument types in the callee&#39;s context
</span>  <span class='id identifier rubyid_argc'>argc</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_arg_idx'>arg_idx</span><span class='op'>|</span>
    <span class='id identifier rubyid_stack_offs'>stack_offs</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='id identifier rubyid_arg_idx'>arg_idx</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='id identifier rubyid_arg_type'>arg_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_stack_offs'>stack_offs</span>])
    <span class='id identifier rubyid_callee_ctx'>callee_ctx</span>.<span class='id identifier rubyid_set_local_type'>set_local_type</span>(<span class='id identifier rubyid_arg_idx'>arg_idx</span><span class='comma'>,</span> <span class='id identifier rubyid_arg_type'>arg_type</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_recv_type'>recv_type</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>
    <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span> <span class='comment'># we don&#39;t track the type information of captured-&gt;self for now
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_argc'>argc</span>])
  <span class='kw'>end</span>
  <span class='id identifier rubyid_callee_ctx'>callee_ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span><span class='comma'>,</span> <span class='id identifier rubyid_recv_type'>recv_type</span>)

  <span class='comment'># Setup the new frame
</span>  <span class='id identifier rubyid_frame_type'>frame_type</span> <span class='op'>||=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_FRAME_MAGIC_METHOD</span> <span class='op'>|</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_FLAG_LOCAL</span>
  <span class='id identifier rubyid_jit_push_frame'><a href="#jit_push_frame-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_push_frame (method)">jit_push_frame</a></span>(
    <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_frame_type'>frame_type</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span>
    <span class='label'>iseq:</span>       <span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
    <span class='label'>local_size:</span> <span class='id identifier rubyid_num_locals'>num_locals</span><span class='comma'>,</span>
    <span class='label'>stack_max:</span>  <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_stack_max'>stack_max</span><span class='comma'>,</span>
    <span class='label'>prev_ep:</span><span class='comma'>,</span>
    <span class='label'>doing_kw_call:</span><span class='comma'>,</span>
  )

  <span class='comment'># Directly jump to the entry point of the callee
</span>  <span class='id identifier rubyid_pc'>pc</span> <span class='op'>=</span> (<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_iseq_encoded'>iseq_encoded</span> <span class='op'>+</span> <span class='id identifier rubyid_start_pc_offset'>start_pc_offset</span>).<span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_pc'>pc</span><span class='comma'>,</span> <span class='id identifier rubyid_callee_ctx'>callee_ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_ivar-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_ivar</strong>(jit, ctx, asm, cme, calling, comptime_recv, recv_opnd)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_ivar (+ part of vm_call_method_each_type)</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5308-L5337'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5308' data-end='5337'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5308</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_ivar'>jit_call_ivar</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
  <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_ivar_splat'>send_ivar_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_arity'>send_arity</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># We don&#39;t support handle_opt_send_shift_stack for this yet.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_ivar_opt_send'>send_ivar_opt_send</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ivar_id'>ivar_id</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_attr'>attr</span>.<span class='id identifier rubyid_id'>id</span>

  <span class='comment'># Not handling block_handler
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_block_arg'>send_block_arg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jit_getivar'><a href="#jit_getivar-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_getivar (method)">jit_getivar</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_id'>ivar_id</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_method-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_method</strong>(jit, ctx, asm, mid, calling, cme, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_method</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
  <li>
    <span class='name'>send_shift</span>
    <span class='type'>(<code>Integer</code>)</span>
&mdash;    <div class='inline'>
<p>The number of shifts needed for VM_CALL_OPT_SEND</p>
</div>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4317-L4343'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4317' data-end='4343'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4317</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_method'>jit_call_method</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='comment'># The main check of vm_call_method before vm_call_method_each_type
</span>  <span class='kw'>case</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_ENTRY_VISI</span>(<span class='id identifier rubyid_cme'>cme</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_VISI_PUBLIC</span>
    <span class='comment'># You can always call public methods
</span>  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_VISI_PRIVATE</span>
    <span class='comment'># Allow only callsites without a receiver
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_FCALL</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_private'>send_private</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_VISI_PROTECTED</span>
    <span class='comment'># If the method call is an FCALL, it is always valid
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_FCALL</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='comment'># otherwise we need an ancestry check to ensure the receiver is valid to be called as protected
</span>      <span class='id identifier rubyid_jit_protected_callee_ancestry_guard'><a href="#jit_protected_callee_ancestry_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_protected_callee_ancestry_guard (method)">jit_protected_callee_ancestry_guard</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Get a compile-time receiver
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> (<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>) <span class='comment'># blockarg is not popped yet
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>+=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>
  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_recv_idx'>recv_idx</span>)
  <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_recv_idx'>recv_idx</span>)

  <span class='id identifier rubyid_jit_call_method_each_type'><a href="#jit_call_method_each_type-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_method_each_type (method)">jit_call_method_each_type</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_method_each_type-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_method_each_type</strong>(jit, ctx, asm, calling, cme, comptime_recv, recv_opnd, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_method_each_type</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4364-L4397'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4364' data-end='4397'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4364</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_method_each_type'>jit_call_method_each_type</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>case</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_type'>type</span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_ISEQ</span>
    <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>=</span> <span class='id identifier rubyid_def_iseq_ptr'><a href="#def_iseq_ptr-instance_method" title="RubyVM::RJIT::InsnCompiler#def_iseq_ptr (method)">def_iseq_ptr</a></span>(<span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>)
    <span class='id identifier rubyid_jit_call_iseq'><a href="#jit_call_iseq-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_iseq (method)">jit_call_iseq</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_NOTIMPLEMENTED</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_notimplemented'>send_notimplemented</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_CFUNC</span>
    <span class='id identifier rubyid_jit_call_cfunc'><a href="#jit_call_cfunc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_cfunc (method)">jit_call_cfunc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='label'>known_recv_class:</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_ATTRSET</span>
    <span class='id identifier rubyid_jit_call_attrset'><a href="#jit_call_attrset-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_attrset (method)">jit_call_attrset</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_IVAR</span>
    <span class='id identifier rubyid_jit_call_ivar'><a href="#jit_call_ivar-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_ivar (method)">jit_call_ivar</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_MISSING</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_missing'>send_missing</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_BMETHOD</span>
    <span class='id identifier rubyid_jit_call_bmethod'><a href="#jit_call_bmethod-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_bmethod (method)">jit_call_bmethod</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_ALIAS</span>
    <span class='id identifier rubyid_jit_call_alias'><a href="#jit_call_alias-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_alias (method)">jit_call_alias</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_OPTIMIZED</span>
    <span class='id identifier rubyid_jit_call_optimized'><a href="#jit_call_optimized-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_optimized (method)">jit_call_optimized</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_UNDEF</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_undef'>send_undef</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_ZSUPER</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_zsuper'>send_zsuper</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_REFINED</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_refined'>send_refined</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_opt_call-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_opt_call</strong>(jit, ctx, asm, cme, flags, argc, block_handler, known_recv_class, send_shift:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_opt_call</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5444-L5496'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5444' data-end='5496'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5444</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_opt_call'>jit_call_opt_call</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>!=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_call_block'>send_optimized_call_block</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KWARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_call_kwarg'>send_optimized_call_kwarg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_call_splat'>send_optimized_call_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># TODO: implement this
</span>  <span class='comment'># Optimize for single ractor mode and avoid runtime check for
</span>  <span class='comment'># &quot;defined with an un-shareable Proc in a different Ractor&quot;
</span>  <span class='comment'># if !assume_single_ractor_mode(jit, ocb)
</span>  <span class='comment'>#   return CantCompile
</span>  <span class='comment'># end
</span>
  <span class='comment'># If this is a .send call we need to adjust the stack
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_handle_opt_send_shift_stack'><a href="#handle_opt_send_shift_stack-instance_method" title="RubyVM::RJIT::InsnCompiler#handle_opt_send_shift_stack (method)">handle_opt_send_shift_stack</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='kw'>end</span>

  <span class='comment'># About to reset the SP, need to load this here
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='comment'># blockarg is not supported. send_shift is already handled.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_recv_idx'>recv_idx</span>)) <span class='comment'># recv
</span>
  <span class='comment'># Save the PC and SP because the callee can make Ruby calls
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>) <span class='comment'># NOTE: clobbers rax
</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='int'>0</span>)) <span class='comment'># sp
</span>
  <span class='id identifier rubyid_kw_splat'>kw_splat</span> <span class='op'>=</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>3</span>]<span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_argc'>argc</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>]) <span class='comment'># stack_argument_pointer. NOTE: C_ARGS[3] is rcx
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>4</span>]<span class='comma'>,</span> <span class='id identifier rubyid_kw_splat'>kw_splat</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>5</span>]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rjit_optimized_call'>rjit_optimized_call</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> <span class='int'>1</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_opt_send-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_opt_send</strong>(jit, ctx, asm, cme, calling, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_opt_send</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5418-L5438'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5418' data-end='5438'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5418</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_opt_send'>jit_call_opt_send</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_jit_caller_setup_arg'><a href="#jit_caller_setup_arg-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_caller_setup_arg (method)">jit_caller_setup_arg</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span>) <span class='op'>==</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_send_no_args'>send_optimized_send_no_args</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span> <span class='op'>-=</span> <span class='int'>1</span>
  <span class='comment'># We aren&#39;t handling `send(:send, ...)` yet. This might work, but not tested yet.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_send_send'>send_optimized_send_send</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='comment'># Lazily handle stack shift in handle_opt_send_shift_stack
</span>  <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span> <span class='op'>+=</span> <span class='int'>1</span>

  <span class='id identifier rubyid_jit_call_symbol'><a href="#jit_call_symbol-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_symbol (method)">jit_call_symbol</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_FCALL</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_opt_struct_aref-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_opt_struct_aref</strong>(jit, ctx, asm, cme, flags, argc, block_handler, known_recv_class, send_shift:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_opt_struct_aref</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5502-L5546'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5502' data-end='5546'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5502</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_opt_struct_aref'>jit_call_opt_struct_aref</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_struct_aref_error'>send_optimized_struct_aref_error</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_c_method_tracing_currently_enabled?'><a href="#c_method_tracing_currently_enabled%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#c_method_tracing_currently_enabled? (method)">c_method_tracing_currently_enabled?</a></span>
    <span class='comment'># Don&#39;t JIT if tracing c_call or c_return
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_cfunc_tracing'>send_cfunc_tracing</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_off'>off</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_optimized'>optimized</span>.<span class='id identifier rubyid_index'>index</span>

  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='comment'># blockarg is not supported
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>+=</span> <span class='id identifier rubyid_send_shift'>send_shift</span>
  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_recv_idx'>recv_idx</span>)

  <span class='comment'># This is a .send call and we need to adjust the stack
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_handle_opt_send_shift_stack'><a href="#handle_opt_send_shift_stack-instance_method" title="RubyVM::RJIT::InsnCompiler#handle_opt_send_shift_stack (method)">handle_opt_send_shift_stack</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='label'>send_shift:</span>)
  <span class='kw'>end</span>

  <span class='comment'># All structs from the same Struct class should have the same
</span>  <span class='comment'># length. So if our comptime_recv is embedded all runtime
</span>  <span class='comment'># structs of the same class should be as well, and the same is
</span>  <span class='comment'># true of the converse.
</span>  <span class='id identifier rubyid_embedded'>embedded</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>FL_TEST_RAW</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RSTRUCT_EMBED_LEN_MASK</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>struct aref</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)) <span class='comment'># recv
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_embedded'>embedded</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RStruct</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>) <span class='op'>+</span> (<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_off'>off</span>)])
  <span class='kw'>else</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RStruct</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ptr'>ptr</span>)])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_off'>off</span>])
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ret'>ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_optimized-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_optimized</strong>(jit, ctx, asm, cme, calling, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_optimized</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5391-L5412'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5391' data-end='5412'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5391</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_optimized'>jit_call_optimized</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># Not working yet
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_block_arg'>send_block_arg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_optimized'>optimized</span>.<span class='id identifier rubyid_type'>type</span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OPTIMIZED_METHOD_TYPE_SEND</span>
    <span class='id identifier rubyid_jit_call_opt_send'><a href="#jit_call_opt_send-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_opt_send (method)">jit_call_opt_send</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OPTIMIZED_METHOD_TYPE_CALL</span>
    <span class='id identifier rubyid_jit_call_opt_call'><a href="#jit_call_opt_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_opt_call (method)">jit_call_opt_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span><span class='comma'>,</span> <span class='label'>send_shift:</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OPTIMIZED_METHOD_TYPE_BLOCK_CALL</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_block_call'>send_optimized_block_call</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OPTIMIZED_METHOD_TYPE_STRUCT_AREF</span>
    <span class='id identifier rubyid_jit_call_opt_struct_aref'><a href="#jit_call_opt_struct_aref-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_opt_struct_aref (method)">jit_call_opt_struct_aref</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span><span class='comma'>,</span> <span class='label'>send_shift:</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>)
  <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OPTIMIZED_METHOD_TYPE_STRUCT_ASET</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_struct_aset'>send_optimized_struct_aset</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_call_symbol-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_call_symbol</strong>(jit, ctx, asm, cme, calling, known_recv_class, flags)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_call_symbol</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>
<p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<code>NotImplementedError</code>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5570-L5609'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5570' data-end='5609'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5570</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_call_symbol'>jit_call_symbol</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span>)
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>|</span> (<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_kw_splat'>kw_splat</span> <span class='op'>?</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>:</span> <span class='int'>0</span>)

  <span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span>.<span class='id identifier rubyid_class'>class</span> <span class='op'>!=</span> <span class='const'>String</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_static_symbol?'><a href="#static_symbol%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#static_symbol? (method)">static_symbol?</a></span>(<span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_send_not_sym_or_str'>send_optimized_send_not_sym_or_str</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_get_symbol_id'>get_symbol_id</span>(<span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_mid'>mid</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_send_null_mid'>send_optimized_send_null_mid</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Guard </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> is on stack</span><span class='tstring_end'>&quot;</span></span>)
  <span class='id identifier rubyid_class_changed_exit'>class_changed_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_send_mid_class_changed'>send_optimized_send_mid_class_changed</span>)
  <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(
    <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span>)<span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>)<span class='comma'>,</span>
    <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_symbol'>comptime_symbol</span><span class='comma'>,</span> <span class='id identifier rubyid_class_changed_exit'>class_changed_exit</span><span class='comma'>,</span>
  )
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_get_symbol_id'>rb_get_symbol_id</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span>)
  <span class='id identifier rubyid_id_changed_exit'>id_changed_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_optimized_send_mid_id_changed'>send_optimized_send_mid_id_changed</span>)
  <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_id_changed_exit'>id_changed_exit</span>)

  <span class='comment'># rb_callable_method_entry_with_refinements
</span>  <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>=</span> <span class='id identifier rubyid_flags'>flags</span>
  <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_jit_search_method'><a href="#jit_search_method-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_search_method (method)">jit_search_method</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_cme'>cme</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_FCALL</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_jit_call_method'><a href="#jit_call_method-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_method (method)">jit_call_method</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>NotImplementedError</span> <span class='comment'># unreachable for now
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_caller_setup_arg-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_caller_setup_arg</strong>(jit, ctx, asm, flags)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>CALLER_SETUP_ARG: Return CantCompile if not supported</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5749-L5764'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5749' data-end='5764'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5749</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_caller_setup_arg'>jit_caller_setup_arg</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_kw_splat'>send_args_splat_kw_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># splat is not supported in this path
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat'>send_args_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_args_kw_splat'>send_args_kw_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KWARG</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_kwarg'>send_kwarg</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_chain_guard-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_chain_guard</strong>(opcode, jit, ctx, asm, side_exit, limit: 20)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3685-L3706'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3685' data-end='3706'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3685</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_chain_guard'>jit_chain_guard</span>(<span class='id identifier rubyid_opcode'>opcode</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>20</span>)
  <span class='id identifier rubyid_opcode'>opcode</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_je'>je</span> <span class='op'>|</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span> <span class='op'>|</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jnz'>jnz</span> <span class='op'>|</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jz'>jz</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_limit'>limit</span>
    <span class='id identifier rubyid_deeper'>deeper</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span>
    <span class='id identifier rubyid_deeper'>deeper</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='id identifier rubyid_branch_stub'>branch_stub</span> <span class='op'>=</span> <span class='const'><a href="BranchStub.html" title="RubyVM::RJIT::BranchStub (class)">BranchStub</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
      <span class='label'>iseq:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
      <span class='label'>shape:</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span><span class='comma'>,</span>
      <span class='label'>target0:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span> <span class='id identifier rubyid_deeper'>deeper</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span>)<span class='comma'>,</span>
    )
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_deeper'>deeper</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>true</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span> <span class='op'>=</span> <span class='id identifier rubyid_compile_jit_chain_guard'><a href="#compile_jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#compile_jit_chain_guard (method)">compile_jit_chain_guard</a></span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='label'>opcode:</span>)
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_opcode'>opcode</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_check_ints-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_check_ints</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>rb_vm_check_ints</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4097-L4102'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4097' data-end='4102'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4097</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_check_ints'>jit_check_ints</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RUBY_VM_CHECK_INTS(ec)</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_eax'>eax</span><span class='comma'>,</span> <span class='const'><a href="DwordPtr.html" title="RubyVM::RJIT::DwordPtr (class)">DwordPtr</a></span>[<span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_execution_context_t'>rb_execution_context_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_interrupt_flag'>interrupt_flag</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_eax'>eax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_eax'>eax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_direct_jump-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_direct_jump</strong>(iseq, pc, ctx, asm, comment: &#39;jit_direct_jump&#39;)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5955-L5967'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5955' data-end='5967'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5955</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_direct_jump'>jit_direct_jump</span>(<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_pc'>pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>jit_direct_jump</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_branch_stub'>branch_stub</span> <span class='op'>=</span> <span class='const'><a href="BranchStub.html" title="RubyVM::RJIT::BranchStub (class)">BranchStub</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
    <span class='label'>iseq:</span><span class='comma'>,</span>
    <span class='label'>shape:</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span><span class='comma'>,</span>
    <span class='label'>target0:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span><span class='comma'>,</span> <span class='label'>pc:</span>)<span class='comma'>,</span>
  )
  <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
    <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>true</span>)
    <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span> <span class='op'>=</span> <span class='id identifier rubyid_compile_jit_direct_jump'><a href="#compile_jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#compile_jit_direct_jump (method)">compile_jit_direct_jump</a></span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='label'>comment:</span>)
  <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_equality_specialized-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_equality_specialized</strong>(jit, ctx, asm, gen_eq)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3957-L4034'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3957' data-end='4034'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3957</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_equality_specialized'>jit_equality_specialized</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_gen_eq'>gen_eq</span>)
  <span class='comment'># Create a side-exit to fall back to the interpreter
</span>  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='id identifier rubyid_a_opnd'>a_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_b_opnd'>b_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)

  <span class='id identifier rubyid_comptime_a'>comptime_a</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_b'>comptime_b</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_EQ</span>)
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check fixnum equality</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_a_opnd'>a_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_b_opnd'>b_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_gen_eq'>gen_eq</span> <span class='op'>?</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span> <span class='op'>:</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_gen_eq'>gen_eq</span> <span class='op'>?</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>  <span class='op'>:</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmove'>cmove</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

    <span class='comment'># Push the output on the stack
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)
    <span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst'>dst</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='kw'>true</span>
  <span class='kw'>elsif</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_a'>comptime_a</span>) <span class='op'>==</span> <span class='const'>String</span> <span class='op'>&amp;&amp;</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_b'>comptime_b</span>) <span class='op'>==</span> <span class='const'>String</span>
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>STRING_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_EQ</span>)
      <span class='comment'># if overridden, emit the generic version
</span>      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>

    <span class='comment'># Guard that a is a String
</span>    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_a'>comptime_a</span>)<span class='comma'>,</span> <span class='id identifier rubyid_a_opnd'>a_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_a'>comptime_a</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

    <span class='id identifier rubyid_equal_label'>equal_label</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_equal'>equal</span>)
    <span class='id identifier rubyid_ret_label'>ret_label</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ret'>ret</span>)

    <span class='comment'># If they are equal by identity, return true
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_a_opnd'>a_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_b_opnd'>b_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_equal_label'>equal_label</span>)

    <span class='comment'># Otherwise guard that b is a T_STRING (from type info) or String (from runtime guard)
</span>    <span class='id identifier rubyid_btype'>btype</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
    <span class='kw'>unless</span> <span class='id identifier rubyid_btype'>btype</span>.<span class='id identifier rubyid_string?'>string?</span>
      <span class='comment'># Note: any T_STRING is valid here, but we check for a ::String for simplicity
</span>      <span class='comment'># To pass a mutable static variable (rb_cString) requires an unsafe block
</span>      <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_b'>comptime_b</span>)<span class='comma'>,</span> <span class='id identifier rubyid_b_opnd'>b_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_b'>comptime_b</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call rb_str_eql_internal</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_a_opnd'>a_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_b_opnd'>b_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_gen_eq'>gen_eq</span> <span class='op'>?</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_str_eql_internal'>rb_str_eql_internal</span> <span class='op'>:</span> <span class='const'>C</span>.<span class='id identifier rubyid_rjit_str_neq_internal'>rjit_str_neq_internal</span>)

    <span class='comment'># Push the output on the stack
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)
    <span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst'>dst</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_ret_label'>ret_label</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_equal_label'>equal_label</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst'>dst</span><span class='comma'>,</span> <span class='id identifier rubyid_gen_eq'>gen_eq</span> <span class='op'>?</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span> <span class='op'>:</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_ret_label'>ret_label</span>)

    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_fixnum_cmp-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_fixnum_cmp</strong>(jit, ctx, asm, opcode:, bop:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3917-L3952'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3917' data-end='3952'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3917</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_fixnum_cmp'>jit_fixnum_cmp</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>opcode:</span><span class='comma'>,</span> <span class='label'>bop:</span>)
  <span class='id identifier rubyid_opcode'>opcode</span> <span class='op'>=&gt;</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovl'>cmovl</span> <span class='op'>|</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovle'>cmovle</span> <span class='op'>|</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovg'>cmovg</span> <span class='op'>|</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovge'>cmovge</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_obj'>comptime_obj</span>  <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='id identifier rubyid_bop'>bop</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that both operands are fixnums
</span>    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>  <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
    <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_public_send'>public_send</span>(<span class='id identifier rubyid_opcode'>opcode</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

    <span class='id identifier rubyid_dst_opnd'>dst_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst_opnd'>dst_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_get_ep-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_get_ep</strong>(asm, level, reg:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_get_ep</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4124-L4131'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4124' data-end='4131'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4124</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_get_ep'>jit_get_ep</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ep'>ep</span>)])
  <span class='id identifier rubyid_level'>level</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
    <span class='comment'># GET_PREV_EP: ep[VM_ENV_DATA_INDEX_SPECVAL] &amp; ~0x03
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='id identifier rubyid_reg'>reg</span><span class='comma'>,</span> <span class='op'>~</span><span class='int'>0x03</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_get_lep-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_get_lep</strong>(jit, asm, reg:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>GET_LEP</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4117-L4120'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4117' data-end='4120'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4117</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_get_lep'>jit_get_lep</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span>)
  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_get_lvar_level'><a href="#get_lvar_level-instance_method" title="RubyVM::RJIT::InsnCompiler#get_lvar_level (method)">get_lvar_level</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_getivar-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_getivar</strong>(jit, ctx, asm, comptime_obj, ivar_id, obj_opnd, obj_yarv_opnd)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_getivar</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4137-L4218'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4137' data-end='4218'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4137</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_getivar'>jit_getivar</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_obj'>comptime_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_id'>ivar_id</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_yarv_opnd'>obj_yarv_opnd</span>)
  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='id identifier rubyid_starting_ctx'>starting_ctx</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span> <span class='comment'># copy for jit_chain_guard
</span>
  <span class='comment'># Guard not special const
</span>  <span class='kw'>if</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>SPECIAL_CONST_P</span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_getivar_special_const'>getivar_special_const</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BUILTIN_TYPE</span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
  <span class='kw'>when</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>T_OBJECT</span>
    <span class='comment'># This is the only supported case for now (ROBJECT_IVPTR)
</span>  <span class='kw'>else</span>
    <span class='comment'># General case. Call rb_ivar_get().
</span>    <span class='comment'># VALUE rb_ivar_get(VALUE obj, ID id)
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call rb_ivar_get()</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span> <span class='op'>?</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span> <span class='op'>:</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ivar_id'>ivar_id</span>)

    <span class='comment'># The function could raise exceptions.
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>) <span class='comment'># clobbers obj_opnd and :rax
</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ivar_get'>rb_ivar_get</span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span> <span class='comment'># attr_reader
</span>      <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
    <span class='kw'>end</span>

    <span class='comment'># Push the ivar on the stack
</span>    <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='comment'># Jump to next instruction. This allows guard chains to share the same successor.
</span>    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span> <span class='op'>?</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span> <span class='op'>:</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])
  <span class='id identifier rubyid_guard_object_is_heap'><a href="#guard_object_is_heap-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_heap (method)">guard_object_is_heap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_yarv_opnd'>obj_yarv_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getivar_not_heap'>getivar_not_heap</span>)

  <span class='id identifier rubyid_shape_id'>shape_id</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_shape_id'>rb_shape_get_shape_id</span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_shape_id'>shape_id</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OBJ_TOO_COMPLEX_SHAPE_ID</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_getivar_too_complex'>getivar_too_complex</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard shape</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='const'><a href="DwordPtr.html" title="RubyVM::RJIT::DwordPtr (class)">DwordPtr</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_id_offset'>rb_shape_id_offset</span>]<span class='comma'>,</span> <span class='id identifier rubyid_shape_id'>shape_id</span>)
  <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_starting_ctx'>starting_ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getivar_megamorphic'>getivar_megamorphic</span>))

  <span class='kw'>if</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span> <span class='comment'># pop receiver for attr_reader
</span>  <span class='kw'>end</span>

  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_iv_index'>rb_shape_get_iv_index</span>(<span class='id identifier rubyid_shape_id'>shape_id</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_id'>ivar_id</span>)
  <span class='comment'># If there is no IVAR index, then the ivar was undefined
</span>  <span class='comment'># when we entered the compiler.  That means we can just return
</span>  <span class='comment'># nil for this shape + iv name
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_stack_opnd'>stack_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span>)
    <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ROBJECT_IVPTR</span><span class='tstring_end'>&#39;</span></span>)
    <span class='kw'>if</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>FL_TEST_RAW</span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>ROBJECT_EMBED</span>)
      <span class='comment'># Access embedded array
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RObject</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>) <span class='op'>+</span> (<span class='id identifier rubyid_index'>index</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>)])
    <span class='kw'>else</span>
      <span class='comment'># Pull out an ivar table on heap
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RObject</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ivptr'>ivptr</span>)])
      <span class='comment'># Read the table
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])
    <span class='kw'>end</span>
    <span class='id identifier rubyid_stack_opnd'>stack_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_opnd'>stack_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_val_opnd'>val_opnd</span>)

  <span class='comment'># Let guard chains share the same successor
</span>  <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_getlocal_generic-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_getlocal_generic</strong>(jit, ctx, asm, idx:, level:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3475-L3494'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3475' data-end='3494'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3475</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_getlocal_generic'>jit_getlocal_generic</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span>)
  <span class='comment'># Load environment pointer EP (level 0) from CFP
</span>  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)

  <span class='comment'># Load the local from the block
</span>  <span class='comment'># val = *(vm_get_ep(GET_EP(), level) - idx);
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='op'>-</span><span class='id identifier rubyid_idx'>idx</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])

  <span class='comment'># Write the local at SP
</span>  <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_ep_offset_to_local_idx'><a href="#ep_offset_to_local_idx-instance_method" title="RubyVM::RJIT::InsnCompiler#ep_offset_to_local_idx (method)">ep_offset_to_local_idx</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span>)
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push_local'>stack_push_local</span>(<span class='id identifier rubyid_local_idx'>local_idx</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_guard_known_klass-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_guard_known_klass</strong>(jit, ctx, asm, known_klass, obj_opnd, insn_opnd, comptime_obj, side_exit, limit: 10)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3723-L3853'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3723' data-end='3853'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3723</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_guard_known_klass'>jit_guard_known_klass</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_known_klass'>known_klass</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_obj'>comptime_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='int'>10</span>)
  <span class='comment'># Only memory operand is supported for now
</span>  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Array</span>))

  <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_known_klass'>known_klass</span>)
  <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_known_class'>known_class</span> <span class='op'>==</span> <span class='id identifier rubyid_known_klass'>known_klass</span>
    <span class='comment'># We already know from type information that this is a match
</span>    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># Touching this as Ruby could crash for FrozenCore
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cNilClass'>rb_cNilClass</span>
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is nil</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Nil</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cTrueClass'>rb_cTrueClass</span>
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is true</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cFalseClass'>rb_cFalseClass</span>
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is false</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cInteger'>rb_cInteger</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='comment'># We will guard fixnum and bignum as though they were separate classes
</span>    <span class='comment'># BIGNUM can be handled by the general else case below
</span>    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is fixnum</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FIXNUM_FLAG</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jz'>jz</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cSymbol'>rb_cSymbol</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_static_symbol?'><a href="#static_symbol%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#static_symbol? (method)">static_symbol?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
    <span class='comment'># We will guard STATIC vs DYNAMIC as though they were separate classes
</span>    <span class='comment'># DYNAMIC symbols can be handled by the general else case below
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>ImmSymbol</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_imm?'>imm?</span>
      <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is static symbol</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='int'>8</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_SPECIAL_SHIFT</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='const'><a href="BytePtr.html" title="RubyVM::RJIT::BytePtr (class)">BytePtr</a></span>[<span class='op'>*</span><span class='id identifier rubyid_obj_opnd'>obj_opnd</span>]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_SYMBOL_FLAG</span>)
      <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

      <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>ImmSymbol</span>)
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cFloat'>rb_cFloat</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flonum?'><a href="#flonum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#flonum? (method)">flonum?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>)
    <span class='kw'>if</span> <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Flonum</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_imm?'>imm?</span>
      <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_unknown?'>unknown?</span>)

      <span class='comment'># We will guard flonum vs heap float as though they were separate classes
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard object is flonum</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FLONUM_MASK</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FLONUM_FLAG</span>)
      <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

      <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Flonum</span>)
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='const'>C</span>.<span class='const'>RCLASS_SINGLETON_P</span>(<span class='id identifier rubyid_known_klass'>known_klass</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_comptime_obj'>comptime_obj</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_attached_object'>rb_class_attached_object</span>(<span class='id identifier rubyid_known_klass'>known_klass</span>)
    <span class='comment'># Singleton classes are attached to one specific object, so we can
</span>    <span class='comment'># avoid one memory access (and potentially the is_heap check) by
</span>    <span class='comment'># looking for the expected object directly.
</span>    <span class='comment'># Note that in case the sample instance has a singleton class that
</span>    <span class='comment'># doesn&#39;t attach to the sample instance, it means the sample instance
</span>    <span class='comment'># has an empty singleton class that hasn&#39;t been materialized yet. In
</span>    <span class='comment'># this case, comparing against the sample instance doesn&#39;t guarantee
</span>    <span class='comment'># that its singleton class is empty, so we can&#39;t avoid the memory
</span>    <span class='comment'># access. As an example, `Object.new.singleton_class` is an object in
</span>    <span class='comment'># this situation.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard known object with singleton class</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CString</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cString'>rb_cString</span>
    <span class='comment'># guard elided because the context says we&#39;ve already checked
</span>    <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>))<span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cString'>rb_cString</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_assert'><a href="#assert-instance_method" title="RubyVM::RJIT::InsnCompiler#assert (method)">assert</a></span>(<span class='op'>!</span><span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_imm?'>imm?</span>)

    <span class='comment'># Load memory to a register
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>)
    <span class='id identifier rubyid_obj_opnd'>obj_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>

    <span class='comment'># Check that the receiver is a heap object
</span>    <span class='comment'># Note: if we get here, the class doesn&#39;t have immediate instances.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_val_type'>val_type</span>.<span class='id identifier rubyid_heap?'>heap?</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard not immediate</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_IMMEDIATE_MASK</span>)
      <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jnz'>jnz</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
      <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_je'>je</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)
    <span class='kw'>end</span>

    <span class='comment'># Bail if receiver class is different from known_klass
</span>    <span class='id identifier rubyid_klass_opnd'>klass_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_obj_opnd'>obj_opnd</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_klass'>klass</span>)]
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>guard known class </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_known_klass'>known_klass</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_known_klass'>known_klass</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_klass_opnd'>klass_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='label'>limit:</span>)

    <span class='kw'>if</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cString'>rb_cString</span>
      <span class='comment'># Upgrading to Type::CString here is incorrect.
</span>      <span class='comment'># The guard we put only checks RBASIC_CLASS(obj),
</span>      <span class='comment'># which adding a singleton class can change. We
</span>      <span class='comment'># additionally need to know the string is frozen
</span>      <span class='comment'># to claim Type::CString.
</span>      <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_known_klass'>known_klass</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_cArray'>rb_cArray</span>
      <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_upgrade_opnd_type'>upgrade_opnd_type</span>(<span class='id identifier rubyid_insn_opnd'>insn_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_leaf_builtin_func-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_leaf_builtin_func</strong>(jit, ctx, asm, flags, iseq)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4980-L5018'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4980' data-end='5018'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4980</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_leaf_builtin_func'>jit_leaf_builtin_func</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='id identifier rubyid_builtin_func'>builtin_func</span> <span class='op'>=</span> <span class='id identifier rubyid_builtin_function'><a href="#builtin_function-instance_method" title="RubyVM::RJIT::InsnCompiler#builtin_function (method)">builtin_function</a></span>(<span class='id identifier rubyid_iseq'>iseq</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_builtin_func'>builtin_func</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># this is a .send call not currently supported for builtins
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_OPT_SEND</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_builtin_argc'>builtin_argc</span> <span class='op'>=</span> <span class='id identifier rubyid_builtin_func'>builtin_func</span>.<span class='id identifier rubyid_argc'>argc</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_builtin_argc'>builtin_argc</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>&gt;=</span> <span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>.<span class='id identifier rubyid_size'>size</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>inlined leaf builtin</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># The callee may allocate, e.g. Integer#abs on a Bignum.
</span>  <span class='comment'># Save SP for GC, save PC for allocation tracing, and prepare
</span>  <span class='comment'># for global invalidation after GC&#39;s VM lock contention.
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Call the builtin func (ec, recv, arg1, arg2, ...)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)

  <span class='comment'># Copy self and arguments
</span>  (<span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_builtin_argc'>builtin_argc</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_stack_opnd'>stack_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_builtin_argc'>builtin_argc</span> <span class='op'>-</span> <span class='id identifier rubyid_i'>i</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_stack_opnd'>stack_opnd</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_builtin_argc'>builtin_argc</span> <span class='op'>+</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_builtin_func'>builtin_func</span>.<span class='id identifier rubyid_func_ptr'>func_ptr</span>)

  <span class='comment'># Push the return value
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_obj_respond_to-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_obj_respond_to</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3263-L3349'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3263' data-end='3349'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3263</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_obj_respond_to'>jit_obj_respond_to</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='comment'># respond_to(:sym) or respond_to(:sym, true)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>2</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_recv_class'>recv_class</span> <span class='op'>=</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>

  <span class='comment'># Get the method_id from compile time. We will later add a guard against it.
</span>  <span class='id identifier rubyid_mid_sym'>mid_sym</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>-</span> <span class='int'>1</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_static_symbol?'><a href="#static_symbol%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#static_symbol? (method)">static_symbol?</a></span>(<span class='id identifier rubyid_mid_sym'>mid_sym</span>)
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_sym2id'>rb_sym2id</span>(<span class='id identifier rubyid_mid_sym'>mid_sym</span>)

  <span class='comment'># This represents the value of the &quot;include_all&quot; argument and whether it&#39;s known
</span>  <span class='id identifier rubyid_allow_priv'>allow_priv</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='comment'># Default is false
</span>    <span class='kw'>false</span>
  <span class='kw'>else</span>
    <span class='comment'># Get value from type information (may or may not be known)
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>]).<span class='id identifier rubyid_known_truthy'>known_truthy</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_target_cme'>target_cme</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_callable_method_entry_or_negative'>rb_callable_method_entry_or_negative</span>(<span class='id identifier rubyid_recv_class'>recv_class</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span>)

  <span class='comment'># Should never be null, as in that case we will be returned a &quot;negative CME&quot;
</span>  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_target_cme'>target_cme</span>.<span class='id identifier rubyid_nil?'>nil?</span>)

  <span class='id identifier rubyid_cme_def_type'>cme_def_type</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>UNDEFINED_METHOD_ENTRY_P</span>(<span class='id identifier rubyid_target_cme'>target_cme</span>) <span class='op'>?</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_UNDEF</span> <span class='op'>:</span> <span class='id identifier rubyid_target_cme'>target_cme</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_type'>type</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_cme_def_type'>cme_def_type</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_REFINED</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_visibility'>visibility</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_cme_def_type'>cme_def_type</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_METHOD_TYPE_UNDEF</span>
    <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_VISI_UNDEF</span>
  <span class='kw'>else</span>
    <span class='const'>C</span>.<span class='const'>METHOD_ENTRY_VISI</span>(<span class='id identifier rubyid_target_cme'>target_cme</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span>
    <span class='kw'>case</span> [<span class='id identifier rubyid_visibility'>visibility</span><span class='comma'>,</span> <span class='id identifier rubyid_allow_priv'>allow_priv</span>]
    <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_VISI_UNDEF</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='kw'>then</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span> <span class='comment'># No method =&gt; false
</span>    <span class='kw'>in</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>METHOD_VISI_PUBLIC</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='kw'>then</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span> <span class='comment'># Public method =&gt; true regardless of include_all
</span>    <span class='kw'>in</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='kw'>true</span> <span class='kw'>then</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span> <span class='comment'># include_all =&gt; always true
</span>    <span class='kw'>else</span> <span class='kw'>return</span> <span class='kw'>false</span> <span class='comment'># not public and include_all not known, can&#39;t compile
</span>    <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>!=</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>
    <span class='comment'># Only if respond_to_missing? hasn&#39;t been overridden
</span>    <span class='comment'># In the future, we might want to jit the call to respond_to_missing?
</span>    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_method_basic_definition'><a href="Invariants.html#assume_method_basic_definition-class_method" title="RubyVM::RJIT::Invariants.assume_method_basic_definition (method)">assume_method_basic_definition</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_class'>recv_class</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_idRespond_to_missing'>idRespond_to_missing</span>)
      <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Invalidate this block if method lookup changes for the method being queried. This works
</span>  <span class='comment'># both for the case where a method does or does not exist, as for the latter we asked for a
</span>  <span class='comment'># &quot;negative CME&quot; earlier.
</span>  <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_method_lookup_stable'><a href="Invariants.html#assume_method_lookup_stable-class_method" title="RubyVM::RJIT::Invariants.assume_method_lookup_stable (method)">assume_method_lookup_stable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_target_cme'>target_cme</span>)

  <span class='comment'># Generate a side exit
</span>  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>==</span> <span class='int'>2</span>
    <span class='comment'># pop include_all argument (we only use its type info)
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_sym_opnd'>sym_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid__recv_opnd'>_recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># This is necessary because we have no guarantee that sym_opnd is a constant
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard known mid</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_mid_sym'>mid_sym</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_sym_opnd'>sym_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

  <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='id identifier rubyid_result'>result</span>)

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_prepare_routine_call-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_prepare_routine_call</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>NOTE: This clobbers <code>:rax</code></p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4040-L4048'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4040' data-end='4048'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4040</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_prepare_routine_call'>jit_prepare_routine_call</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_record_boundary_patch_point'>record_boundary_patch_point</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_jit_save_pc'><a href="#jit_save_pc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_pc (method)">jit_save_pc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_jit_save_sp'><a href="#jit_save_sp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_sp (method)">jit_save_sp</a></span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># In case the routine calls Ruby methods, it can set local variables
</span>  <span class='comment'># through Kernel#binding and other means.
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_clear_local_types'>clear_local_types</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_protected_callee_ancestry_guard-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_protected_callee_ancestry_guard</strong>(asm, cme, side_exit)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Generate ancestry guard for protected callee. Calls to protected callees only go through when self.is_a?(klass_that_defines_the_callee).</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4347-L4358'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4347' data-end='4358'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4347</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_protected_callee_ancestry_guard'>jit_protected_callee_ancestry_guard</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)
  <span class='comment'># See vm_call_method().
</span>  <span class='id identifier rubyid_def_class'>def_class</span> <span class='op'>=</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_defined_class'>defined_class</span>
  <span class='comment'># Note: PC isn&#39;t written to current control frame as rb_is_kind_of() shouldn&#39;t raise.
</span>  <span class='comment'># VALUE rb_obj_is_kind_of(VALUE obj, VALUE klass);
</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_def_class'>def_class</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_obj_is_kind_of'>rb_obj_is_kind_of</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_protected_check_failed'>send_protected_check_failed</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_push_frame-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_push_frame</strong>(jit, ctx, asm, cme, flags, argc, frame_type, block_handler, iseq: nil, local_size: 0, stack_max: 0, prev_ep: nil, doing_kw_call: nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_push_frame</p>

<p>Frame structure: | args | locals | cme/cref | block_handler/prev EP | frame type (EP here) | stack bottom (SP here)</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5619-L5730'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5619' data-end='5730'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5619</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_push_frame'>jit_push_frame</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_frame_type'>frame_type</span><span class='comma'>,</span> <span class='id identifier rubyid_block_handler'>block_handler</span><span class='comma'>,</span> <span class='label'>iseq:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>local_size:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>stack_max:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>prev_ep:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>doing_kw_call:</span> <span class='kw'>nil</span>)
  <span class='comment'># Save caller SP and PC before pushing a callee frame for backtrace and side exits
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>save SP to caller CFP</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_argc'>argc</span> <span class='comment'># blockarg is already popped
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>+=</span> (<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>) <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='int'>1</span> <span class='comment'># receiver is not on stack when captured-&gt;self is used
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>
    <span class='comment'># Skip setting this to SP register. This cfp-&gt;sp will be copied to SP on leave insn.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='op'>-</span><span class='id identifier rubyid_recv_idx'>recv_idx</span>)) <span class='comment'># Pop receiver and arguments to prepare for side exits
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sp'>sp</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='op'>-</span><span class='id identifier rubyid_recv_idx'>recv_idx</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sp'>sp</span>)]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span>)
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_recv_idx'>recv_idx</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_jit_save_pc'><a href="#jit_save_pc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_pc (method)">jit_save_pc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>save PC to caller CFP</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>+</span> <span class='int'>3</span> <span class='op'>+</span> <span class='id identifier rubyid_local_size'>local_size</span> <span class='op'>+</span> (<span class='id identifier rubyid_doing_kw_call'>doing_kw_call</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>) <span class='comment'># callee_sp
</span>  <span class='id identifier rubyid_local_size'>local_size</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set local variables</span><span class='tstring_end'>&#39;</span></span>) <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_local_index'>local_index</span> <span class='op'>=</span> <span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>+</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>-</span> <span class='id identifier rubyid_local_size'>local_size</span> <span class='op'>-</span> <span class='int'>3</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_local_index'>local_index</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set up EP with managing data</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='comment'># ep[-2]: cref_or_me
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>2</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='comment'># ep[-1]: block handler or prev env ptr (specval)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_prev_ep'>prev_ep</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_prev_ep'>prev_ep</span>.<span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>|</span> <span class='int'>1</span>) <span class='comment'># tagged prev ep
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>1</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>
    <span class='comment'># Set captured-&gt;ep, saving captured in :rcx for captured-&gt;self
</span>    <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
    <span class='id identifier rubyid_jit_get_lep'><a href="#jit_get_lep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_lep (method)">jit_get_lep</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]) <span class='comment'># block_handler
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='op'>~</span><span class='int'>0x3</span>) <span class='comment'># captured
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>]) <span class='comment'># captured-&gt;ep
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_or'>or</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>0x1</span>) <span class='comment'># GC_GUARDED_PTR
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>1</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>1</span>)]<span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>)
  <span class='kw'>elsif</span> <span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_block_param_proxy'>rb_block_param_proxy</span>
    <span class='comment'># vm_caller_setup_arg_block: block_code == rb_block_param_proxy
</span>    <span class='id identifier rubyid_jit_get_lep'><a href="#jit_get_lep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_lep (method)">jit_get_lep</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># VM_CF_BLOCK_HANDLER: VM_CF_LEP
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]) <span class='comment'># VM_CF_BLOCK_HANDLER: VM_ENV_BLOCK_HANDLER
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_block_code'>block_code</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># reg_cfp-&gt;block_code = handler
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>1</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># return handler;
</span>  <span class='kw'>else</span> <span class='comment'># assume blockiseq
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_block_handler'>block_handler</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_block_code'>block_code</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)]) <span class='comment'># VM_CFP_TO_CAPTURED_BLOCK
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_or'>or</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='comment'># VM_BH_FROM_ISEQ_BLOCK
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>1</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>end</span>
  <span class='comment'># ep[-0]: ENV_FLAGS
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_ep_offset'>ep_offset</span> <span class='op'>-</span> <span class='int'>0</span>)]<span class='comma'>,</span> <span class='id identifier rubyid_frame_type'>frame_type</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>set up new frame</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>=</span> <span class='op'>-</span><span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_size'>size</span> <span class='comment'># callee CFP
</span>  <span class='comment'># For ISEQ, JIT code will set it as needed. However, C func needs 0 there for svar frame detection.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_pc'>pc</span>)]<span class='comma'>,</span> <span class='int'>0</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_iseq'>iseq</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>]) <span class='comment'># captured-&gt;self
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_self_index'>self_index</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>-</span> (<span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_argc'>argc</span>) <span class='comment'># blockarg has been popped
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_self_index'>self_index</span>])
  <span class='kw'>end</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_ep_offset'>ep_offset</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ep'>ep</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_block_code'>block_code</span>)]<span class='comma'>,</span> <span class='int'>0</span>)
  <span class='comment'># Update SP register only for ISEQ calls. SP-relative operations should be done above this.
</span>  <span class='id identifier rubyid_sp_reg'>sp_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>?</span> <span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span> <span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='id identifier rubyid_sp_reg'>sp_reg</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_sp_offset'>sp_offset</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sp'>sp</span>)]<span class='comma'>,</span> <span class='id identifier rubyid_sp_reg'>sp_reg</span>)

  <span class='comment'># cfp-&gt;jit_return is used only for ISEQs
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_iseq'>iseq</span>
    <span class='comment'># The callee might change locals through Kernel#binding and other means.
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_clear_local_types'>clear_local_types</span>

    <span class='comment'># Stub cfp-&gt;jit_return
</span>    <span class='id identifier rubyid_return_ctx'>return_ctx</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span>
    <span class='id identifier rubyid_return_ctx'>return_ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> ((<span class='id identifier rubyid_block_handler'>block_handler</span> <span class='op'>==</span> <span class='symbeg'>:</span><span class='id identifier rubyid_captured'>captured</span>) <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='int'>1</span>)) <span class='comment'># Pop args and receiver. blockarg has been popped
</span>    <span class='id identifier rubyid_return_ctx'>return_ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>) <span class='comment'># push callee&#39;s return value
</span>    <span class='id identifier rubyid_return_ctx'>return_ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>=</span> <span class='int'>1</span> <span class='comment'># SP is in the position after popping a receiver and arguments
</span>    <span class='id identifier rubyid_return_ctx'>return_ctx</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_branch_stub'>branch_stub</span> <span class='op'>=</span> <span class='const'><a href="BranchStub.html" title="RubyVM::RJIT::BranchStub (class)">BranchStub</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(
      <span class='label'>iseq:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span>
      <span class='label'>shape:</span> <span class='const'><a href="../RJIT.html#Default-constant" title="RubyVM::RJIT::Default (constant)">Default</a></span><span class='comma'>,</span>
      <span class='label'>target0:</span> <span class='const'><a href="BranchTarget.html" title="RubyVM::RJIT::BranchTarget (class)">BranchTarget</a></span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='label'>ctx:</span> <span class='id identifier rubyid_return_ctx'>return_ctx</span><span class='comma'>,</span> <span class='label'>pc:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>)<span class='comma'>,</span>
    )
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_target0'>target0</span>.<span class='id identifier rubyid_address'>address</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_branch_stub'>compile_branch_stub</span>(<span class='id identifier rubyid_return_ctx'>return_ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='comma'>,</span> <span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='kw'>true</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span> <span class='op'>=</span> <span class='id identifier rubyid_compile_jit_return'><a href="#compile_jit_return-instance_method" title="RubyVM::RJIT::InsnCompiler#compile_jit_return (method)">compile_jit_return</a></span>(<span class='id identifier rubyid_branch_stub'>branch_stub</span><span class='comma'>,</span> <span class='label'>cfp_offset:</span>)
    <span class='id identifier rubyid_branch_stub'>branch_stub</span>.<span class='id identifier rubyid_compile'><a href="#compile-instance_method" title="RubyVM::RJIT::InsnCompiler#compile (method)">compile</a></span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>switch to callee CFP</span><span class='tstring_end'>&#39;</span></span>)
  <span class='comment'># Update CFP register only for ISEQ calls
</span>  <span class='id identifier rubyid_cfp_reg'>cfp_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span> <span class='op'>?</span> <span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span> <span class='op'>:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='id identifier rubyid_cfp_reg'>cfp_reg</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_cfp_offset'>cfp_offset</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_execution_context_t'>rb_execution_context_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_cfp'>cfp</span>)]<span class='comma'>,</span> <span class='id identifier rubyid_cfp_reg'>cfp_reg</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_ary_empty_p-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_ary_empty_p</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3224-L3238'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3224' data-end='3238'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3224</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_ary_empty_p'>jit_rb_ary_empty_p</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='id identifier rubyid_array_reg'>array_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>))
  <span class='id identifier rubyid_jit_array_len'><a href="#jit_array_len-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_array_len (method)">jit_array_len</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovz'>cmovz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_ary_push-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_ary_push</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3243-L3258'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3243' data-end='3258'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3243</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_ary_push'>jit_rb_ary_push</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_ary_push</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_item_opnd'>item_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_ary_opnd'>ary_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ary_opnd'>ary_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_item_opnd'>item_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_push'>rb_ary_push</span>)

  <span class='id identifier rubyid_ret_opnd'>ret_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ret_opnd'>ret_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_f_block_given_p-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_f_block_given_p</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3354-L3372'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3354' data-end='3372'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3354</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_f_block_given_p'>jit_rb_f_block_given_p</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>block_given?</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># Same as rb_vm_frame_block_handler
</span>  <span class='id identifier rubyid_jit_get_lep'><a href="#jit_get_lep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_lep (method)">jit_get_lep</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_SPECVAL</span>]) <span class='comment'># block_handler
</span>
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)

  <span class='comment'># Return `block_handler != VM_BLOCK_HANDLER_NONE`
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovne'>cmovne</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>) <span class='comment'># block_given
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_false-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_false</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2759-L2766'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2759' data-end='2766'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2759</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_false'>jit_rb_false</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nil? == false</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_int_aref-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_int_aref</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3031-L3048'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3031' data-end='3048'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3031</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_int_aref'>jit_rb_int_aref</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)

  <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_int_aref</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_y_opnd'>y_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_x_opnd'>x_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_x_opnd'>x_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_y_opnd'>y_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_fix_aref'>rb_fix_aref</span>)

  <span class='id identifier rubyid_ret_opnd'>ret_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ret_opnd'>ret_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_int_div-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_int_div</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3006-L3026'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3006' data-end='3026'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3006</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_int_div'>jit_rb_int_div</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)

  <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_int_div</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_y_opnd'>y_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_x_opnd'>x_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_y_opnd'>y_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_x_opnd'>x_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_fix_div_fix'>rb_fix_div_fix</span>)

  <span class='id identifier rubyid_ret_opnd'>ret_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ret_opnd'>ret_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_int_equal-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_int_equal</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2964-L2983'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2964' data-end='2983'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2964</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_int_equal'>jit_rb_int_equal</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)

  <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Compare the arguments
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_int_equal</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_arg1'>arg1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_arg0'>arg0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_arg1'>arg1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_arg0'>arg0</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmove'>cmove</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_int_mul-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_int_mul</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2988-L3004'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2988' data-end='3004'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2988</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_int_mul'>jit_rb_int_mul</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)

  <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_int_mul</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_y_opnd'>y_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_x_opnd'>x_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_x_opnd'>x_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_y_opnd'>y_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_fix_mul_fix'>rb_fix_mul_fix</span>)

  <span class='id identifier rubyid_ret_opnd'>ret_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ret_opnd'>ret_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_kernel_instance_of-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_kernel_instance_of</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2819-L2868'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2819' data-end='2868'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2819</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_kernel_instance_of'>jit_rb_kernel_instance_of</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># If this is a super call we might not know the class
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># Important note: The output code will simply `return true/false`.
</span>  <span class='comment'># Correctness follows from:
</span>  <span class='comment'>#  - `known_recv_class` implies there is a guard scheduled before here
</span>  <span class='comment'>#    for a particular `CLASS_OF(lhs)`.
</span>  <span class='comment'>#  - We guard that rhs is identical to the compile-time sample
</span>  <span class='comment'>#  - For a particular `CLASS_OF(lhs)`, `rb_obj_class(lhs)` does not change.
</span>  <span class='comment'>#    (because for any singleton class `s`, `s.superclass.equal?(s.attached_object.class)`)
</span>
  <span class='id identifier rubyid_sample_rhs'>sample_rhs</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_sample_lhs'>sample_lhs</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)

  <span class='comment'># Filters out cases where the C implementation raises
</span>  <span class='kw'>unless</span> <span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_sample_rhs'>sample_rhs</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_CLASS</span>) <span class='op'>||</span> <span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_sample_rhs'>sample_rhs</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_MODULE</span>)
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># We need to grab the class here to deal with singleton classes.
</span>  <span class='comment'># Instance of grabs the &quot;real class&quot; of the object rather than the
</span>  <span class='comment'># singleton class.
</span>  <span class='id identifier rubyid_sample_lhs_real_class'>sample_lhs_real_class</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_obj_class'>rb_obj_class</span>(<span class='id identifier rubyid_sample_lhs'>sample_lhs</span>)

  <span class='id identifier rubyid_sample_instance_of'>sample_instance_of</span> <span class='op'>=</span> (<span class='id identifier rubyid_sample_lhs_real_class'>sample_lhs_real_class</span> <span class='op'>==</span> <span class='id identifier rubyid_sample_rhs'>sample_rhs</span>)

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Kernel#instance_of?</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_sample_rhs'>sample_rhs</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_instance_of_class_mismatch'>send_instance_of_class_mismatch</span>))

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_sample_instance_of'>sample_instance_of</span>
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>true</span><span class='semicolon'>;</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_kernel_is_a-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_kernel_is_a</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2771-L2814'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2771' data-end='2814'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2771</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_kernel_is_a'>jit_rb_kernel_is_a</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># If this is a super call we might not know the class
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># Important note: The output code will simply `return true/false`.
</span>  <span class='comment'># Correctness follows from:
</span>  <span class='comment'>#  - `known_recv_class` implies there is a guard scheduled before here
</span>  <span class='comment'>#    for a particular `CLASS_OF(lhs)`.
</span>  <span class='comment'>#  - We guard that rhs is identical to the compile-time sample
</span>  <span class='comment'>#  - In general, for any two Class instances A, B, `A &lt; B` does not change at runtime.
</span>  <span class='comment'>#    Class#superclass is stable.
</span>
  <span class='id identifier rubyid_sample_rhs'>sample_rhs</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_sample_lhs'>sample_lhs</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)

  <span class='comment'># We are not allowing module here because the module hierarchy can change at runtime.
</span>  <span class='kw'>if</span> <span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_sample_rhs'>sample_rhs</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_CLASS</span>)
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_sample_is_a'>sample_is_a</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_obj_is_kind_of'>obj_is_kind_of</span>(<span class='id identifier rubyid_sample_lhs'>sample_lhs</span><span class='comma'>,</span> <span class='id identifier rubyid_sample_rhs'>sample_rhs</span>)

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Kernel#is_a?</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_sample_rhs'>sample_rhs</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_is_a_class_mismatch'>send_is_a_class_mismatch</span>))

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_sample_is_a'>sample_is_a</span>
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='kw'>else</span>
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_mod_eqq-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_mod_eqq</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2937-L2959'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2937' data-end='2959'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2937</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_mod_eqq'>jit_rb_mod_eqq</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Module#===</span><span class='tstring_end'>&#39;</span></span>)
  <span class='comment'># By being here, we know that the receiver is a T_MODULE or a T_CLASS, because Module#=== can
</span>  <span class='comment'># only live on these objects. With that, we can call rb_obj_is_kind_of() without
</span>  <span class='comment'># jit_prepare_routine_call() or a control frame push because it can&#39;t raise, allocate, or call
</span>  <span class='comment'># Ruby methods with these inputs.
</span>  <span class='comment'># Note the difference in approach from Kernel#is_a? because we don&#39;t get a free guard for the
</span>  <span class='comment'># right hand side.
</span>  <span class='id identifier rubyid_lhs'>lhs</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>) <span class='comment'># the module
</span>  <span class='id identifier rubyid_rhs'>rhs</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_rhs'>rhs</span>)<span class='semicolon'>;</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_lhs'>lhs</span>)<span class='semicolon'>;</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_obj_is_kind_of'>rb_obj_is_kind_of</span>)

  <span class='comment'># Return the result
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_obj_equal-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_obj_equal</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2908-L2924'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2908' data-end='2924'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2908</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_obj_equal'>jit_rb_obj_equal</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>equal?</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_obj1'>obj1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_obj2'>obj2</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_obj1'>obj1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_obj2'>obj2</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmove'>cmove</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_obj_not-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_obj_not</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2873-L2903'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2873' data-end='2903'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2873</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_obj_not'>jit_rb_obj_not</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_recv_type'>recv_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])

  <span class='kw'>case</span> <span class='id identifier rubyid_recv_type'>recv_type</span>.<span class='id identifier rubyid_known_truthy'>known_truthy</span>
  <span class='kw'>in</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_obj_not(nil_or_false)</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='kw'>in</span> <span class='kw'>true</span>
    <span class='comment'># Note: recv_type != Type::Nil &amp;&amp; recv_type != Type::False.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_obj_not(truthy)</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>False</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='kw'>in</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_obj_not</span><span class='tstring_end'>&#39;</span></span>)

    <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
    <span class='comment'># This `test` sets ZF only for Qnil and Qfalse, which let cmovz set.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> <span class='op'>~</span><span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovz'>cmovz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_obj_not_equal-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_obj_not_equal</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2929-L2932'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2929' data-end='2932'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2929</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_obj_not_equal'>jit_rb_obj_not_equal</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_jit_equality_specialized'><a href="#jit_equality_specialized-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_equality_specialized (method)">jit_equality_specialized</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='kw'>false</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_str_bytesize-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_str_bytesize</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3087-L3098'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3087' data-end='3098'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3087</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_str_bytesize'>jit_rb_str_bytesize</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>String#bytesize</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_str_bytesize'>rb_str_bytesize</span>)

  <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_str_concat-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_str_concat</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3103-L3166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3103' data-end='3166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3103</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_str_concat'>jit_rb_str_concat</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='comment'># The &lt;&lt; operator can accept integer codepoints for characters
</span>  <span class='comment'># as the argument. We only specially optimise string arguments.
</span>  <span class='comment'># If the peeked-at compile time argument is something other than
</span>  <span class='comment'># a string, assume it won&#39;t be a string later either.
</span>  <span class='id identifier rubyid_comptime_arg'>comptime_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)
  <span class='kw'>unless</span> <span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_comptime_arg'>comptime_arg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_STRING</span>)
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># Guard that the concat argument is a string
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_guard_object_is_string'><a href="#guard_object_is_string-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_string (method)">guard_object_is_string</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])

  <span class='comment'># Guard buffers from GC since rb_str_buf_append may allocate. During the VM lock on GC,
</span>  <span class='comment'># other Ractors may trigger global invalidation, so we need ctx.clear_local_types.
</span>  <span class='comment'># PC is used on errors like Encoding::CompatibilityError raised by rb_str_buf_append.
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_concat_arg'>concat_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># Test if string encodings differ. If different, use rb_str_append. If the same,
</span>  <span class='comment'># use rb_yjit_str_simple_append, which calls rb_str_cat.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;&lt; on strings</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># Take receiver&#39;s object flags XOR arg&#39;s flags. If any
</span>  <span class='comment'># string-encoding flags are different between the two,
</span>  <span class='comment'># the encodings don&#39;t match.
</span>  <span class='id identifier rubyid_recv_reg'>recv_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
  <span class='id identifier rubyid_concat_arg_reg'>concat_arg_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_concat_arg_reg'>concat_arg_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_concat_arg'>concat_arg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_concat_arg_reg'>concat_arg_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_concat_arg_reg'>concat_arg_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_xor'>xor</span>(<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_concat_arg_reg'>concat_arg_reg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_ENCODING_MASK</span>)

  <span class='comment'># Push once, use the resulting operand in both branches below.
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)

  <span class='id identifier rubyid_enc_mismatch'>enc_mismatch</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>enc_mismatch</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_enc_mismatch'>enc_mismatch</span>)

  <span class='comment'># If encodings match, call the simple append function and jump to return
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_concat_arg'>concat_arg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rjit_str_simple_append'>rjit_str_simple_append</span>)
  <span class='id identifier rubyid_ret_label'>ret_label</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>func_return</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>(<span class='id identifier rubyid_ret_label'>ret_label</span>)

  <span class='comment'># If encodings are different, use a slower encoding-aware concatenate
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_enc_mismatch'>enc_mismatch</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_concat_arg'>concat_arg</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_str_buf_append'>rb_str_buf_append</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='comment'># Drop through to return
</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_ret_label'>ret_label</span>)

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_str_empty_p-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_str_empty_p</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3053-L3068'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3053' data-end='3068'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3053</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_str_empty_p'>jit_rb_str_empty_p</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_out_opnd'>out_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownImm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>get string length</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
  <span class='id identifier rubyid_str_len_opnd'>str_len_opnd</span> <span class='op'>=</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RString</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_len'>len</span>)]

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_str_len_opnd'>str_len_opnd</span><span class='comma'>,</span> <span class='int'>0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qfalse-constant" title="RubyVM::RJIT::Qfalse (constant)">Qfalse</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmove'>cmove</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_out_opnd'>out_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_str_getbyte-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_str_getbyte</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3206-L3219'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3206' data-end='3219'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3206</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_str_getbyte'>jit_rb_str_getbyte</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rb_str_getbyte</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_index_opnd'>index_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_str_opnd'>str_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_str_opnd'>str_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_index_opnd'>index_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_str_getbyte'>rb_str_getbyte</span>)

  <span class='id identifier rubyid_ret_opnd'>ret_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ret_opnd'>ret_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_str_to_s-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_str_to_s</strong>(jit, ctx, asm, argc, known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3073-L3082'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3073' data-end='3082'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3073</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_str_to_s'>jit_rb_str_to_s</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_known_recv_class'>known_recv_class</span> <span class='op'>==</span> <span class='const'>String</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>to_s on plain string</span><span class='tstring_end'>&#39;</span></span>)
    <span class='comment'># The method returns the receiver, which is already on the stack.
</span>    <span class='comment'># No stack movement.
</span>    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='kw'>false</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_str_uplus-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_str_uplus</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3171-L3201'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3171' data-end='3201'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3171</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_str_uplus'>jit_rb_str_uplus</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='comment'># We allocate when we dup the string
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unary plus on string</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)) <span class='comment'># recv_opnd
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)]) <span class='comment'># flags_opnd
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FL_FREEZE</span>)

  <span class='id identifier rubyid_ret_label'>ret_label</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>stack_ret</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># String#+@ can only exist on T_STRING
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)

  <span class='comment'># If the string isn&#39;t frozen, we just return it.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># recv_opnd
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_ret_label'>ret_label</span>)

  <span class='comment'># Str is frozen - duplicate it
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># recv_opnd
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_str_dup'>rb_str_dup</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_ret_label'>ret_label</span>)

  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_rb_true-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_rb_true</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2747-L2754'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2747' data-end='2754'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2747</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_rb_true'>jit_rb_true</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nil? == true</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>True</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qtrue-constant" title="RubyVM::RJIT::Qtrue (constant)">Qtrue</a></span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_save_pc-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_save_pc</strong>(jit, asm, comment: &#39;save PC to CFP&#39;)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>NOTE: This clobbers <code>:rax</code></p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4053-L4058'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4053' data-end='4058'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4053</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_save_pc'>jit_save_pc</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>save PC to CFP</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_next_pc'>next_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='comment'># Use the next one for backtrace and side exits
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='id identifier rubyid_comment'>comment</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_next_pc'>next_pc</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_pc'>pc</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_save_sp-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_save_sp</strong>(ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4062-L4069'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4062' data-end='4069'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4062</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_save_sp'>jit_save_sp</span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>save SP to CFP</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sp'>sp</span>)]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span>)
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_search_method-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_search_method</strong>(jit, ctx, asm, mid, calling)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_search_method</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4268-L4302'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4268' data-end='4302'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4268</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_search_method'>jit_search_method</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>)
  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>)

  <span class='comment'># Generate a side exit
</span>  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='comment'># kw_splat is not supported yet
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_KW_SPLAT</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_kw_splat'>send_kw_splat</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Get a compile-time receiver and its class
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_argc'>argc</span> <span class='op'>+</span> (<span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_ARGS_BLOCKARG</span> <span class='op'>!=</span> <span class='int'>0</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>) <span class='comment'># blockarg is not popped yet
</span>  <span class='id identifier rubyid_recv_idx'>recv_idx</span> <span class='op'>+=</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_send_shift'>send_shift</span>
  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='id identifier rubyid_recv_idx'>recv_idx</span>)
  <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>)

  <span class='comment'># Guard the receiver class (part of vm_search_method_fastpath)
</span>  <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_recv_idx'>recv_idx</span>)
  <span class='id identifier rubyid_megamorphic_exit'>megamorphic_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_klass_megamorphic'>send_klass_megamorphic</span>)
  <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_recv_idx'>recv_idx</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_megamorphic_exit'>megamorphic_exit</span>)

  <span class='comment'># Do method lookup (vm_cc_cme(cc) != NULL)
</span>  <span class='id identifier rubyid_cme'>cme</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_callable_method_entry'>rb_callable_method_entry</span>(<span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_cme'>cme</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_send_missing_cme'>send_missing_cme</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span> <span class='comment'># We don&#39;t support vm_call_method_name
</span>  <span class='kw'>end</span>

  <span class='comment'># Invalidate on redefinition (part of vm_search_method_fastpath)
</span>  <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_method_lookup_stable'><a href="Invariants.html#assume_method_lookup_stable-class_method" title="RubyVM::RJIT::Invariants.assume_method_lookup_stable (method)">assume_method_lookup_stable</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span>)

  <span class='kw'>return</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_setlocal_generic-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_setlocal_generic</strong>(jit, ctx, asm, idx:, level:)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3496-L3528'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3496' data-end='3528'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3496</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_setlocal_generic'>jit_setlocal_generic</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span>)
  <span class='id identifier rubyid_value_type'>value_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_type'>get_opnd_type</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])

  <span class='comment'># Load environment pointer EP at level
</span>  <span class='id identifier rubyid_ep_reg'>ep_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_jit_get_ep'><a href="#jit_get_ep-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_get_ep (method)">jit_get_ep</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='comma'>,</span> <span class='label'>reg:</span> <span class='id identifier rubyid_ep_reg'>ep_reg</span>)

  <span class='comment'># Write barriers may be required when VM_ENV_FLAG_WB_REQUIRED is set, however write barriers
</span>  <span class='comment'># only affect heap objects being written. If we know an immediate value is being written we
</span>  <span class='comment'># can skip this check.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_value_type'>value_type</span>.<span class='id identifier rubyid_imm?'>imm?</span>
    <span class='comment'># flags &amp; VM_ENV_FLAG_WB_REQUIRED
</span>    <span class='id identifier rubyid_flags_opnd'>flags_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_INDEX_FLAGS</span>]
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_flags_opnd'>flags_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_FLAG_WB_REQUIRED</span>)

    <span class='comment'># if (flags &amp; VM_ENV_FLAG_WB_REQUIRED) != 0
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_local_idx'>local_idx</span> <span class='op'>=</span> <span class='id identifier rubyid_ep_offset_to_local_idx'><a href="#ep_offset_to_local_idx-instance_method" title="RubyVM::RJIT::InsnCompiler#ep_offset_to_local_idx (method)">ep_offset_to_local_idx</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span>)
    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_set_local_type'>set_local_type</span>(<span class='id identifier rubyid_local_idx'>local_idx</span><span class='comma'>,</span> <span class='id identifier rubyid_value_type'>value_type</span>)
  <span class='kw'>end</span>

  <span class='comment'># Pop the value to write from the stack
</span>  <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># Write the value at the environment pointer
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_stack_top'>stack_top</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='id identifier rubyid_ep_reg'>ep_reg</span><span class='comma'>,</span> <span class='op'>-</span>(<span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_idx'>idx</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_thread_s_current-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_thread_s_current</strong>(jit, ctx, asm, argc, _known_recv_class)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3377-L3391'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3377' data-end='3391'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3377</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_thread_s_current'>jit_thread_s_current</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_argc'>argc</span><span class='comma'>,</span> <span class='id identifier rubyid__known_recv_class'>_known_recv_class</span>)
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Thread.current</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># ec-&gt;thread_ptr
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_execution_context_t'>rb_execution_context_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_thread_ptr'>thread_ptr</span>)])

  <span class='comment'># thread-&gt;self
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_thread_struct'>rb_thread_struct</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>true</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jit_write_iv-instance_method">
  <h3 class='signature priv'>
    #<strong>jit_write_iv</strong>(asm, comptime_receiver, recv_reg, temp_reg, ivar_index, set_value, needs_extension)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4220-L4243'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4220' data-end='4243'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4220</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jit_write_iv'>jit_write_iv</span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_temp_reg'>temp_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_index'>ivar_index</span><span class='comma'>,</span> <span class='id identifier rubyid_set_value'>set_value</span><span class='comma'>,</span> <span class='id identifier rubyid_needs_extension'>needs_extension</span>)
  <span class='comment'># Compile time self is embedded and the ivar index lands within the object
</span>  <span class='id identifier rubyid_embed_test_result'>embed_test_result</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>FL_TEST_RAW</span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>ROBJECT_EMBED</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_needs_extension'>needs_extension</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_embed_test_result'>embed_test_result</span>
    <span class='comment'># Find the IV offset
</span>    <span class='id identifier rubyid_offs'>offs</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>RObject</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>) <span class='op'>+</span> <span class='id identifier rubyid_ivar_index'>ivar_index</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>

    <span class='comment'># Write the IV
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>write IV</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_temp_reg'>temp_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_set_value'>set_value</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_offs'>offs</span>]<span class='comma'>,</span> <span class='id identifier rubyid_temp_reg'>temp_reg</span>)
  <span class='kw'>else</span>
    <span class='comment'># Compile time value is *not* embedded.
</span>
    <span class='comment'># Get a pointer to the extended table
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> [<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RObject</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ivptr'>ivptr</span>)])

    <span class='comment'># Write the ivar in to the extended table
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>write IV</span><span class='tstring_end'>&quot;</span></span>)<span class='semicolon'>;</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_temp_reg'>temp_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_set_value'>set_value</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='id identifier rubyid_recv_reg'>recv_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_ivar_index'>ivar_index</span>]<span class='comma'>,</span> <span class='id identifier rubyid_temp_reg'>temp_reg</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jump-instance_method">
  <h3 class='signature priv'>
    #<strong>jump</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1935-L1945'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1935' data-end='1945'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1935</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jump'>jump</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Check for interrupts, but only on backward branches that may create loops
</span>  <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>signed:</span> <span class='kw'>true</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_jit_check_ints'><a href="#jit_check_ints-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_check_ints (method)">jit_check_ints</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_pc'>pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> (<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>+</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span>)
  <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_pc'>pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="jump_to_next_insn-instance_method">
  <h3 class='signature priv'>
    #<strong>jump_to_next_insn</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L4074-L4091'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='4074' data-end='4091'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 4074</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_jump_to_next_insn'>jump_to_next_insn</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_reset_depth'>reset_depth</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span>
  <span class='id identifier rubyid_reset_depth'>reset_depth</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='id identifier rubyid_next_pc'>next_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>

  <span class='comment'># We are at the end of the current instruction. Record the boundary.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_record_boundary_patch_point'>record_boundary_patch_point</span>
    <span class='id identifier rubyid_exit_pos'>exit_pos</span> <span class='op'>=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ocb_asm'>ocb_asm</span><span class='op'>|</span>
      <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_side_exit'>compile_side_exit</span>(<span class='id identifier rubyid_next_pc'>next_pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
      <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_ocb_asm'>ocb_asm</span>)
    <span class='kw'>end</span>
    <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_record_global_inval_patch'><a href="Invariants.html#record_global_inval_patch-class_method" title="RubyVM::RJIT::Invariants.record_global_inval_patch (method)">record_global_inval_patch</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_exit_pos'>exit_pos</span>)
    <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_record_boundary_patch_point'>record_boundary_patch_point</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_next_pc'>next_pc</span><span class='comma'>,</span> <span class='id identifier rubyid_reset_depth'>reset_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>comment:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>jump_to_next_insn</span><span class='tstring_end'>&#39;</span></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="leave-instance_method">
  <h3 class='signature priv'>
    #<strong>leave</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1876-L1898'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1876' data-end='1898'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1876</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_leave'>leave</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_size'>stack_size</span><span class='comma'>,</span> <span class='int'>1</span>)

  <span class='id identifier rubyid_jit_check_ints'><a href="#jit_check_ints-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_check_ints (method)">jit_check_ints</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pop stack frame</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_size'>size</span>])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_execution_context_t'>rb_execution_context_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_cfp'>cfp</span>)]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='comment'># Return a value (for compile_leave_exit)
</span>  <span class='id identifier rubyid_ret_opnd'>ret_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ret_opnd'>ret_opnd</span>)

  <span class='comment'># Set caller&#39;s SP and push a value to its stack (for JIT)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_sp'>sp</span>)]) <span class='comment'># Note: SP is in the position after popping a receiver and arguments
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>([<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='comment'># Jump to cfp-&gt;jit_return
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jmp'>jmp</span>([<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='op'>-</span><span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>+</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jit_return'>jit_return</span>)])

  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="lookup_cfunc_codegen-instance_method">
  <h3 class='signature priv'>
    #<strong>lookup_cfunc_codegen</strong>(cme_def)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3455-L3457'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3455' data-end='3457'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3455</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_lookup_cfunc_codegen'>lookup_cfunc_codegen</span>(<span class='id identifier rubyid_cme_def'>cme_def</span>)
  <span class='ivar'>@cfunc_codegen_table</span>[<span class='id identifier rubyid_cme_def'>cme_def</span>.<span class='id identifier rubyid_method_serial'>method_serial</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="move_rest_args_to_stack-instance_method">
  <h3 class='signature priv'>
    #<strong>move_rest_args_to_stack</strong>(array, num_args, jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Pushes arguments from an array to the stack. Differs from push splat because the array can have items left over.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5771-L5807'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5771' data-end='5807'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5771</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_move_rest_args_to_stack'>move_rest_args_to_stack</span>(<span class='id identifier rubyid_array'>array</span><span class='comma'>,</span> <span class='id identifier rubyid_num_args'>num_args</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>move_rest_args_to_stack</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># array is :rax
</span>  <span class='id identifier rubyid_array_len_opnd'>array_len_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
  <span class='id identifier rubyid_jit_array_len'><a href="#jit_array_len-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_array_len (method)">jit_array_len</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span><span class='comma'>,</span> <span class='id identifier rubyid_array_len_opnd'>array_len_opnd</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Side exit if length is less than required</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_array_len_opnd'>array_len_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_num_args'>num_args</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jl'>jl</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_iseq_has_rest_and_splat_not_equal'>send_iseq_has_rest_and_splat_not_equal</span>))

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Push arguments from array</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># Load the address of the embedded array
</span>  <span class='comment'># (struct RArray *)(obj)-&gt;as.ary
</span>  <span class='id identifier rubyid_array_reg'>array_reg</span> <span class='op'>=</span> <span class='id identifier rubyid_array'>array</span>

  <span class='comment'># Conditionally load the address of the heap array
</span>  <span class='comment'># (struct RArray *)(obj)-&gt;as.heap.ptr
</span>  <span class='id identifier rubyid_flags_opnd'>flags_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)]
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_flags_opnd'>flags_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_FLAG</span>)
  <span class='id identifier rubyid_heap_ptr_opnd'>heap_ptr_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ptr'>ptr</span>)]
  <span class='comment'># Load the address of the embedded array
</span>  <span class='comment'># (struct RArray *)(obj)-&gt;as.ary
</span>  <span class='id identifier rubyid_ary_opnd'>ary_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rdx'>rdx</span> <span class='comment'># NOTE: array :rax is used after move_rest_args_to_stack too
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_heap_ptr_opnd'>heap_ptr_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovnz'>cmovnz</span>(<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)

  <span class='id identifier rubyid_num_args'>num_args</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="newarray-instance_method">
  <h3 class='signature priv'>
    #<strong>newarray</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L918-L946'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='918' data-end='946'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 918</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_newarray'>newarray</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we are allocating
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># If n is 0, then elts is never going to be read, so we can just pass null
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_values_ptr'>values_ptr</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>load pointer to array elts</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_n'>n</span>
    <span class='id identifier rubyid_values_opnd'>values_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span>(<span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_values_opnd'>values_opnd</span>)
    <span class='id identifier rubyid_values_ptr'>values_ptr</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='kw'>end</span>

  <span class='comment'># call rb_ec_ary_new_from_values(struct rb_execution_context_struct *ec, long n, const VALUE *elts);
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_values_ptr'>values_ptr</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ec_ary_new_from_values'>rb_ec_ary_new_from_values</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="newhash-instance_method">
  <h3 class='signature priv'>
    #<strong>newhash</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1098-L1136'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1098' data-end='1136'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1098</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_newhash'>newhash</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we are allocating
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_num'>num</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='comment'># val = rb_hash_new_with_size(num / 2);
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span> <span class='op'>/</span> <span class='int'>2</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_new_with_size'>rb_hash_new_with_size</span>)

    <span class='comment'># Save the allocated hash as we want to push it after insertion
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_push'>push</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_push'>push</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>) <span class='comment'># x86 alignment
</span>
    <span class='comment'># Get a pointer to the values to insert into the hash
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_num'>num</span> <span class='op'>-</span> <span class='int'>1</span>))

    <span class='comment'># rb_hash_bulk_insert(num, STACK_ADDR_FROM_TOP(num), val);
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_bulk_insert'>rb_hash_bulk_insert</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_num'>num</span>)
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Hash</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>else</span>
    <span class='comment'># val = rb_hash_new();
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_new'>rb_hash_new</span>)
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Hash</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="newrange-instance_method">
  <h3 class='signature priv'>
    #<strong>newrange</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1141-L1158'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1141' data-end='1158'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1141</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_newrange'>newrange</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># rb_range_new() allocates and can raise
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># val = rb_range_new(low, high, (int)flag);
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_range_new'>rb_range_new</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="nop-instance_method">
  <h3 class='signature priv'>
    #<strong>nop</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L154-L157'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='154' data-end='157'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 154</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_nop'>nop</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Do nothing
</span>  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="objtostring-instance_method">
  <h3 class='signature priv'>
    #<strong>objtostring</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1474-L1493'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1474' data-end='1493'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1474</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_objtostring'>objtostring</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='kw'>if</span> <span class='const'>C</span>.<span class='const'>RB_TYPE_P</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_T_STRING</span>)
    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>)<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)
    <span class='comment'># No work needed. The string value is already on the top of the stack.
</span>    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_cd'>cd</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>cd:</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_and-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_and</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2389-L2419'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2389' data-end='2419'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2389</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_and'>opt_and</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_AND</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that both operands are fixnums
</span>    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># Get the operands and destination from the stack
</span>    <span class='id identifier rubyid_arg1'>arg1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_arg0'>arg0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bitwise and</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_arg0'>arg0</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_and'>and</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_arg1'>arg1</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst'>dst</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_aref-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_aref</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2460-L2545'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2460' data-end='2545'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2460</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_aref'>opt_aref</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_cd'>cd</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_argc'>argc</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_argc'>vm_ci_argc</span>(<span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_argc'>argc</span> <span class='op'>!=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_optaref_argc_not_one'>optaref_argc_not_one</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_obj'>comptime_obj</span>  <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='kw'>if</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>==</span> <span class='const'>Array</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>ARRAY_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_AREF</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_idx_opnd'>idx_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
    <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)

    <span class='id identifier rubyid_not_array_exit'>not_array_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optaref_recv_not_array'>optaref_recv_not_array</span>)
    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>)<span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_not_array_exit'>not_array_exit</span>)

    <span class='comment'># Bail if idx is not a FIXNUM
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_idx_opnd'>idx_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_FIXNUM_FLAG</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optaref_arg_not_fixnum'>optaref_arg_not_fixnum</span>))

    <span class='comment'># Call VALUE rb_ary_entry_internal(VALUE ary, long offset).
</span>    <span class='comment'># It never raises or allocates, so we don&#39;t need to write to cfp-&gt;pc.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_sar'>sar</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='comment'># Convert fixnum to int
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_entry_internal'>rb_ary_entry_internal</span>)

    <span class='comment'># Pop the argument and the receiver
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='comment'># Let guard chains share the same successor
</span>    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>elsif</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>==</span> <span class='const'>Hash</span>
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>HASH_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_AREF</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)

    <span class='comment'># Guard that the receiver is a Hash
</span>    <span class='id identifier rubyid_not_hash_exit'>not_hash_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optaref_recv_not_hash'>optaref_recv_not_hash</span>)
    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>)<span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_not_hash_exit'>not_hash_exit</span>)

    <span class='comment'># Prepare to call rb_hash_aref(). It might call #hash on the key.
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call rb_hash_aref</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_key_opnd'>key_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
    <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rdi'>rdi</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rsi'>rsi</span><span class='comma'>,</span> <span class='id identifier rubyid_key_opnd'>key_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_aref'>rb_hash_aref</span>)

    <span class='comment'># Pop the key and the receiver
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>2</span>)

    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='comment'># Let guard chains share the same successor
</span>    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_ary_freeze-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_ary_freeze</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1498-L1511'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1498' data-end='1511'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1498</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_ary_freeze'>opt_ary_freeze</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>ARRAY_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_FREEZE</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Push the return value onto the stack
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CArray</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_ary'>ary</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_aset-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_aset</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2550-L2628'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2550' data-end='2628'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2550</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_aset'>opt_aset</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Defer compilation so we can specialize on a runtime `self`
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>2</span>)
  <span class='id identifier rubyid_comptime_key'>comptime_key</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)

  <span class='comment'># Get the operands from the stack
</span>  <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>2</span>)
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid__val'>_val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)

  <span class='kw'>if</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>==</span> <span class='const'>Array</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_key'>comptime_key</span>)
    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

    <span class='comment'># Guard receiver is an Array
</span>    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>)<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

    <span class='comment'># Guard key is a fixnum
</span>    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_key'>comptime_key</span>)<span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_key'>comptime_key</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

    <span class='comment'># We might allocate or raise
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call rb_ary_store</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>2</span>)
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_sar'>sar</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='comment'># FIX2LONG(key)
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_store'>rb_ary_store</span>)

    <span class='comment'># rb_ary_store returns void
</span>    <span class='comment'># stored value should still be on stack
</span>    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>3</span>)
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>elsif</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>==</span> <span class='const'>Hash</span>
    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

    <span class='comment'># Guard receiver is a Hash
</span>    <span class='id identifier rubyid_jit_guard_known_klass'><a href="#jit_guard_known_klass-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_guard_known_klass (method)">jit_guard_known_klass</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_class_of'>rb_class_of</span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>)<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv'>comptime_recv</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

    <span class='comment'># We might allocate or raise
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># Call rb_hash_aset
</span>    <span class='id identifier rubyid_recv'>recv</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>2</span>)
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_recv'>recv</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_aset'>rb_hash_aset</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>3</span>)
    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_case_dispatch-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_case_dispatch</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2146-L2192'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2146' data-end='2192'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2146</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_case_dispatch'>opt_case_dispatch</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Normally this instruction would lookup the key in a hash and jump to an
</span>  <span class='comment'># offset based on that.
</span>  <span class='comment'># Instead we can take the fallback case and continue with the next
</span>  <span class='comment'># instruction.
</span>  <span class='comment'># We&#39;d hope that our jitted code will be sufficiently fast without the
</span>  <span class='comment'># hash lookup, at least for small hashes, but it&#39;s worth revisiting this
</span>  <span class='comment'># assumption in the future.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_starting_context'>starting_context</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span>

  <span class='id identifier rubyid_case_hash'>case_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_else_offset'>else_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># Try to reorder case/else branches so that ones that are actually used come first.
</span>  <span class='comment'># Supporting only Fixnum for now so that the implementation can be an equality check.
</span>  <span class='id identifier rubyid_key_opnd'>key_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_key'>comptime_key</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='comment'># Check that all cases are fixnums to avoid having to register BOP assumptions on
</span>  <span class='comment'># all the types that case hashes support. This spends compile time to save memory.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_key'>comptime_key</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_comptime_key'>comptime_key</span> <span class='op'>&lt;=</span> <span class='int'>2</span><span class='op'>**</span><span class='int'>32</span> <span class='op'>&amp;&amp;</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_keys'>rb_hash_keys</span>(<span class='id identifier rubyid_case_hash'>case_hash</span>).<span class='id identifier rubyid_all?'>all?</span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_key'>key</span>) }
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_EQQ</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check if the key is the same value
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_key_opnd'>key_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_comptime_key'>comptime_key</span>))
    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_starting_context'>starting_context</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_starting_context'>starting_context</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>)

    <span class='comment'># Get the offset for the compile-time key
</span>    <span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_hash_stlike_lookup'>rb_hash_stlike_lookup</span>(<span class='id identifier rubyid_case_hash'>case_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_key'>comptime_key</span>)
    <span class='comment'># NOTE: If we hit the else branch with various values, it could negatively impact the performance.
</span>    <span class='id identifier rubyid_jump_offset'>jump_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>||</span> <span class='id identifier rubyid_else_offset'>else_offset</span>

    <span class='comment'># Jump to the offset of case or else
</span>    <span class='id identifier rubyid_target_pc'>target_pc</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span> <span class='op'>+</span> (<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_insn'>insn</span>.<span class='id identifier rubyid_len'>len</span> <span class='op'>+</span> <span class='id identifier rubyid_jump_offset'>jump_offset</span>) <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_jit_direct_jump'><a href="#jit_direct_jump-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_direct_jump (method)">jit_direct_jump</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_target_pc'>target_pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>else</span>
    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span> <span class='comment'># continue with === branches
</span>  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_div-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_div</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2280-L2282'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2280' data-end='2282'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2280</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_div'>opt_div</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_empty_p-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_empty_p</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2650-L2652'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2650' data-end='2652'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2650</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_empty_p'>opt_empty_p</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_eq-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_eq</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2327-L2339'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2327' data-end='2339'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2327</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_eq'>opt_eq</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_jit_equality_specialized'><a href="#jit_equality_specialized-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_equality_specialized (method)">jit_equality_specialized</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='kw'>true</span>)
    <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_ge-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_ge</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2375-L2377'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2375' data-end='2377'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2375</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_ge'>opt_ge</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_jit_fixnum_cmp'><a href="#jit_fixnum_cmp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_fixnum_cmp (method)">jit_fixnum_cmp</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>opcode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovge'>cmovge</span><span class='comma'>,</span> <span class='label'>bop:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_GE</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_getconstant_path-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_getconstant_path</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L610-L671'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='610' data-end='671'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 610</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_getconstant_path'>opt_getconstant_path</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Cut the block for invalidation
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ic'>ic</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_iseq_inline_constant_cache'>iseq_inline_constant_cache</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_idlist'>idlist</span> <span class='op'>=</span> <span class='id identifier rubyid_ic'>ic</span>.<span class='id identifier rubyid_segments'>segments</span>

  <span class='comment'># Make sure there is an exit for this block as the interpreter might want
</span>  <span class='comment'># to invalidate this block from rb_rjit_constant_ic_update().
</span>  <span class='comment'># For now, we always take an entry exit even if it was a side exit.
</span>  <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_ensure_block_entry_exit'><a href="Invariants.html#ensure_block_entry_exit-class_method" title="RubyVM::RJIT::Invariants.ensure_block_entry_exit (method)">ensure_block_entry_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='label'>cause:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>opt_getconstant_path</span><span class='tstring_end'>&#39;</span></span>)

  <span class='comment'># See vm_ic_hit_p(). The same conditions are checked in yjit_constant_ic_update().
</span>  <span class='id identifier rubyid_ice'>ice</span> <span class='op'>=</span> <span class='id identifier rubyid_ic'>ic</span>.<span class='id identifier rubyid_entry'>entry</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ice'>ice</span>.<span class='id identifier rubyid_nil?'>nil?</span>
    <span class='comment'># In this case, leave a block that unconditionally side exits
</span>    <span class='comment'># for the interpreter to invalidate.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_optgetconst_not_cached'>optgetconst_not_cached</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ice'>ice</span>.<span class='id identifier rubyid_ic_cref'>ic_cref</span> <span class='comment'># with cref
</span>    <span class='comment'># Cache is keyed on a certain lexical scope. Use the interpreter&#39;s cache.
</span>    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

    <span class='comment'># Call function to verify the cache. It doesn&#39;t allocate or call methods.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ic'>ic</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ep'>ep</span>)])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_ic_hit_p'>rb_vm_ic_hit_p</span>)

    <span class='comment'># Check the result. SysV only specifies one byte for _Bool return values,
</span>    <span class='comment'># so it&#39;s important we only check one bit to ignore the higher bits in the register.
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span><span class='comma'>,</span> <span class='int'>1</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jz'>jz</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_optgetconst_cache_miss'>optgetconst_cache_miss</span>))

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ic'>ic</span>.<span class='id identifier rubyid_to_i'>to_i</span>) <span class='comment'># inline_cache
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_iseq_inline_constant_cache'>iseq_inline_constant_cache</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_entry'>entry</span>)]) <span class='comment'># ic_entry
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_iseq_inline_constant_cache_entry'>iseq_inline_constant_cache_entry</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_value'>value</span>)]) <span class='comment'># ic_entry_val
</span>
    <span class='comment'># Push ic-&gt;entry-&gt;value
</span>    <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>else</span> <span class='comment'># without cref
</span>    <span class='comment'># TODO: implement this
</span>    <span class='comment'># Optimize for single ractor mode.
</span>    <span class='comment'># if !assume_single_ractor_mode(jit, ocb)
</span>    <span class='comment'>#   return CantCompile
</span>    <span class='comment'># end
</span>
    <span class='comment'># Invalidate output code on any constant writes associated with
</span>    <span class='comment'># constants referenced within the current block.
</span>    <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_stable_constant_names'><a href="Invariants.html#assume_stable_constant_names-class_method" title="RubyVM::RJIT::Invariants.assume_stable_constant_names (method)">assume_stable_constant_names</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_idlist'>idlist</span>)

    <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='id identifier rubyid_ice'>ice</span>.<span class='id identifier rubyid_value'>value</span>)
  <span class='kw'>end</span>

  <span class='id identifier rubyid_jump_to_next_insn'><a href="#jump_to_next_insn-instance_method" title="RubyVM::RJIT::InsnCompiler#jump_to_next_insn (method)">jump_to_next_insn</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_gt-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_gt</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2368-L2370'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2368' data-end='2370'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2368</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_gt'>opt_gt</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_jit_fixnum_cmp'><a href="#jit_fixnum_cmp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_fixnum_cmp (method)">jit_fixnum_cmp</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>opcode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovg'>cmovg</span><span class='comma'>,</span> <span class='label'>bop:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_GT</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_hash_freeze-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_hash_freeze</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1516-L1529'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1516' data-end='1529'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1516</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_hash_freeze'>opt_hash_freeze</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>HASH_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_FREEZE</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Push the return value onto the stack
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CHash</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_hash'>hash</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_invokebuiltin_delegate-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_invokebuiltin_delegate</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2680-L2716'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2680' data-end='2716'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2680</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_invokebuiltin_delegate'>opt_invokebuiltin_delegate</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_bf'>bf</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_builtin_function'>rb_builtin_function</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_bf_argc'>bf_argc</span> <span class='op'>=</span> <span class='id identifier rubyid_bf'>bf</span>.<span class='id identifier rubyid_argc'>argc</span>
  <span class='id identifier rubyid_start_index'>start_index</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># ec, self, and arguments
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_bf_argc'>bf_argc</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>&gt;</span> <span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>.<span class='id identifier rubyid_size'>size</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># If the calls don&#39;t allocate, do they need up to date PC, SP?
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Call the builtin func (ec, recv, arg1, arg2, ...)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call builtin func</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])

  <span class='comment'># Copy arguments from locals
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_bf_argc'>bf_argc</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='comment'># Load environment pointer EP from CFP
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_ep'>ep</span>)])

    <span class='id identifier rubyid_bf_argc'>bf_argc</span>.<span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='id identifier rubyid_table_size'>table_size</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_table_size'>local_table_size</span>
      <span class='id identifier rubyid_offs'>offs</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_table_size'>table_size</span> <span class='op'>-</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_SIZE</span> <span class='op'>+</span> <span class='int'>1</span> <span class='op'>+</span> <span class='id identifier rubyid_start_index'>start_index</span> <span class='op'>+</span> <span class='id identifier rubyid_i'>i</span>
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_i'>i</span>]<span class='comma'>,</span> [<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_offs'>offs</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_bf'>bf</span>.<span class='id identifier rubyid_func_ptr'>func_ptr</span>)

  <span class='comment'># Push the return value
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_invokebuiltin_delegate_leave-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_invokebuiltin_delegate_leave</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2721-L2724'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2721' data-end='2724'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2721</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_invokebuiltin_delegate_leave'>opt_invokebuiltin_delegate_leave</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_invokebuiltin_delegate'><a href="#opt_invokebuiltin_delegate-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_invokebuiltin_delegate (method)">opt_invokebuiltin_delegate</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># opt_invokebuiltin_delegate is always followed by leave insn
</span><span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_le-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_le</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2361-L2363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2361' data-end='2363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2361</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_le'>opt_le</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_jit_fixnum_cmp'><a href="#jit_fixnum_cmp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_fixnum_cmp (method)">jit_fixnum_cmp</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>opcode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovle'>cmovle</span><span class='comma'>,</span> <span class='label'>bop:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_LE</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_length-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_length</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2636-L2638'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2636' data-end='2638'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2636</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_length'>opt_length</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_lt-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_lt</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2354-L2356'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2354' data-end='2356'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2354</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_lt'>opt_lt</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_jit_fixnum_cmp'><a href="#jit_fixnum_cmp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_fixnum_cmp (method)">jit_fixnum_cmp</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>opcode:</span> <span class='symbeg'>:</span><span class='id identifier rubyid_cmovl'>cmovl</span><span class='comma'>,</span> <span class='label'>bop:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_LT</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_ltlt-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_ltlt</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2382-L2384'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2382' data-end='2384'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2382</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_ltlt'>opt_ltlt</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_minus-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_minus</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2235-L2268'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2235' data-end='2268'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2235</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_minus'>opt_minus</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_obj'>comptime_obj</span>  <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_MINUS</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that both operands are fixnums
</span>    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>  <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
    <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jo'>jo</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_add'>add</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='comment'># re-tag
</span>
    <span class='id identifier rubyid_dst_opnd'>dst_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst_opnd'>dst_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_mod-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_mod</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2287-L2322'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2287' data-end='2322'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2287</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_mod'>opt_mod</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_MOD</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that both operands are fixnums
</span>    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># Get the operands and destination from the stack
</span>    <span class='id identifier rubyid_arg1'>arg1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_arg0'>arg0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

    <span class='comment'># Check for arg0 % 0
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_arg1'>arg1</span><span class='comma'>,</span> <span class='int'>0</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_je'>je</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))

    <span class='comment'># Call rb_fix_mod_fix(VALUE recv, VALUE obj)
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_arg0'>arg0</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_arg1'>arg1</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_fix_mod_fix'>rb_fix_mod_fix</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_mult-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_mult</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2273-L2275'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2273' data-end='2275'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2273</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_mult'>opt_mult</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_neq-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_neq</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2344-L2349'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2344' data-end='2349'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2344</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_neq'>opt_neq</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># opt_neq is passed two rb_call_data as arguments:
</span>  <span class='comment'># first for ==, second for !=
</span>  <span class='id identifier rubyid_neq_cd'>neq_cd</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>))
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>cd:</span> <span class='id identifier rubyid_neq_cd'>neq_cd</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_newarray_hash-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_newarray_hash</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1626-L1646'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1626' data-end='1646'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1626</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_newarray_hash'>opt_newarray_hash</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we may allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_num'>num</span>
  <span class='id identifier rubyid_values_opnd'>values_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_values_opnd'>values_opnd</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_opt_newarray_hash'>rb_vm_opt_newarray_hash</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_newarray_max-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_newarray_max</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1601-L1621'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1601' data-end='1621'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1601</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_newarray_max'>opt_newarray_max</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we may allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_num'>num</span>
  <span class='id identifier rubyid_values_opnd'>values_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_values_opnd'>values_opnd</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_opt_newarray_max'>rb_vm_opt_newarray_max</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_newarray_min-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_newarray_min</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1576-L1596'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1576' data-end='1596'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1576</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_newarray_min'>opt_newarray_min</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because we may allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_num'>num</span>
  <span class='id identifier rubyid_values_opnd'>values_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='id identifier rubyid_offset_magnitude'>offset_magnitude</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_values_opnd'>values_opnd</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_opt_newarray_min'>rb_vm_opt_newarray_min</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_num'>num</span>)
  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_newarray_send-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_newarray_send</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1561-L1571'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1561' data-end='1571'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1561</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_newarray_send'>opt_newarray_send</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='const'>ID2SYM</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='kw'>case</span> <span class='id identifier rubyid_type'>type</span>
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_min'>min</span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_newarray_min'><a href="#opt_newarray_min-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_newarray_min (method)">opt_newarray_min</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_max'>max</span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_newarray_max'><a href="#opt_newarray_max-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_newarray_max (method)">opt_newarray_max</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>when</span> <span class='symbeg'>:</span><span class='id identifier rubyid_hash'>hash</span> <span class='kw'>then</span> <span class='id identifier rubyid_opt_newarray_hash'><a href="#opt_newarray_hash-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_newarray_hash (method)">opt_newarray_hash</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_nil_p-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_nil_p</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1552-L1554'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1552' data-end='1554'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1552</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_nil_p'>opt_nil_p</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_not-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_not</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2664-L2666'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2664' data-end='2666'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2664</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_not'>opt_not</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_or-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_or</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2424-L2455'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2424' data-end='2455'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2424</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_or'>opt_or</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_two_fixnums_on_stack?'><a href="#two_fixnums_on_stack%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#two_fixnums_on_stack? (method)">two_fixnums_on_stack?</a></span>(<span class='id identifier rubyid_jit'>jit</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_OR</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that both operands are fixnums
</span>    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># Get the operands and destination from the stack
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bitwise or</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_arg1'>arg1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
    <span class='id identifier rubyid_arg0'>arg0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

    <span class='comment'># Do the bitwise or arg0 | arg1
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_arg0'>arg0</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_or'>or</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_arg1'>arg1</span>)

    <span class='comment'># Push the return value onto the stack
</span>    <span class='id identifier rubyid_dst'>dst</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst'>dst</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_plus-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_plus</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2197-L2230'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2197' data-end='2230'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2197</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_plus'>opt_plus</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_obj'>comptime_obj</span>  <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_obj'>comptime_obj</span>)
    <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>INTEGER_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_PLUS</span>)
      <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>end</span>

    <span class='comment'># Check that both operands are fixnums
</span>    <span class='id identifier rubyid_guard_two_fixnums'><a href="#guard_two_fixnums-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_two_fixnums (method)">guard_two_fixnums</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>  <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
    <span class='id identifier rubyid_recv_opnd'>recv_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_recv_opnd'>recv_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_sub'>sub</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='int'>1</span>) <span class='comment'># untag
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_obj_opnd'>obj_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_add'>add</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jo'>jo</span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>))

    <span class='id identifier rubyid_dst_opnd'>dst_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Fixnum</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst_opnd'>dst_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_regexpmatch2-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_regexpmatch2</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2671-L2673'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2671' data-end='2673'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2671</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_regexpmatch2'>opt_regexpmatch2</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_send_without_block-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_send_without_block</strong>(jit, ctx, asm, cd: C.rb_call_data.new(jit.operand(0)))   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1452-L1469'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1452' data-end='1469'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1452</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_send_without_block'>opt_send_without_block</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>cd:</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)))
  <span class='comment'># Specialize on a compile-time receiver, and split a block for chain guards
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='comment'># calling-&gt;ci
</span>  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_mid'>vm_ci_mid</span>(<span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span>)
  <span class='id identifier rubyid_calling'>calling</span> <span class='op'>=</span> <span class='id identifier rubyid_build_calling'><a href="#build_calling-instance_method" title="RubyVM::RJIT::InsnCompiler#build_calling (method)">build_calling</a></span>(<span class='label'>ci:</span> <span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span><span class='comma'>,</span> <span class='label'>block_handler:</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_BLOCK_HANDLER_NONE</span>)

  <span class='comment'># vm_sendish
</span>  <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span> <span class='op'>=</span> <span class='id identifier rubyid_jit_search_method'><a href="#jit_search_method-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_search_method (method)">jit_search_method</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_cme'>cme</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_jit_call_general'><a href="#jit_call_general-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_general (method)">jit_call_general</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_size-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_size</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2643-L2645'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2643' data-end='2645'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2643</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_size'>opt_size</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_str_freeze-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_str_freeze</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1534-L1547'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1534' data-end='1547'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1534</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_str_freeze'>opt_str_freeze</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>unless</span> <span class='const'><a href="Invariants.html" title="RubyVM::RJIT::Invariants (class)">Invariants</a></span>.<span class='id identifier rubyid_assume_bop_not_redefined'><a href="Invariants.html#assume_bop_not_redefined-class_method" title="RubyVM::RJIT::Invariants.assume_bop_not_redefined (method)">assume_bop_not_redefined</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>STRING_REDEFINED_OP_FLAG</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BOP_FREEZE</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Push the return value onto the stack
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>CString</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_str'>str</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="opt_succ-instance_method">
  <h3 class='signature priv'>
    #<strong>opt_succ</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2657-L2659'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2657' data-end='2659'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2657</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_opt_succ'>opt_succ</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt_send_without_block'><a href="#opt_send_without_block-instance_method" title="RubyVM::RJIT::InsnCompiler#opt_send_without_block (method)">opt_send_without_block</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="pop-instance_method">
  <h3 class='signature priv'>
    #<strong>pop</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1163-L1166'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1163' data-end='1166'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1163</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>
  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="push_splat_args-instance_method">
  <h3 class='signature priv'>
    #<strong>push_splat_args</strong>(required_args, jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>vm_caller_setup_arg_splat (+ CALLER_SETUP_ARG): Pushes arguments from an array to the stack that are passed with a splat (i.e. *args). It optimistically compiles to a static size that is the exact number of arguments needed for the function.</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5815-L5874'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5815' data-end='5874'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5815</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_push_splat_args'>push_splat_args</span>(<span class='id identifier rubyid_required_args'>required_args</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>push_splat_args</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_array_opnd'>array_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_array_stack_opnd'>array_stack_opnd</span> <span class='op'>=</span> <span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>]
  <span class='id identifier rubyid_array_reg'>array_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_array_opnd'>array_opnd</span>)

  <span class='id identifier rubyid_guard_object_is_array'><a href="#guard_object_is_array-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_array (method)">guard_object_is_array</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_array_stack_opnd'>array_stack_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_not_array'>send_args_splat_not_array</span>)

  <span class='id identifier rubyid_array_len_opnd'>array_len_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
  <span class='id identifier rubyid_jit_array_len'><a href="#jit_array_len-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_array_len (method)">jit_array_len</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_array_len_opnd'>array_len_opnd</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Side exit if length is not equal to remaining args</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_array_len_opnd'>array_len_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_required_args'>required_args</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jne'>jne</span>(<span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_length_not_equal'>send_args_splat_length_not_equal</span>))

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Check last argument is not ruby2keyword hash</span><span class='tstring_end'>&#39;</span></span>)

  <span class='id identifier rubyid_ary_opnd'>ary_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>
  <span class='id identifier rubyid_jit_array_ptr'><a href="#jit_array_ptr-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_array_ptr (method)">jit_array_ptr</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_ary_opnd'>ary_opnd</span>) <span class='comment'># clobbers array_reg
</span>
  <span class='id identifier rubyid_last_array_value'>last_array_value</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_last_array_value'>last_array_value</span><span class='comma'>,</span> [<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> (<span class='id identifier rubyid_required_args'>required_args</span> <span class='op'>-</span> <span class='int'>1</span>) <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])

  <span class='id identifier rubyid_ruby2_exit'>ruby2_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_send_args_splat_ruby2_hash'>send_args_splat_ruby2_hash</span>)<span class='semicolon'>;</span>
  <span class='id identifier rubyid_guard_object_is_not_ruby2_keyword_hash'><a href="#guard_object_is_not_ruby2_keyword_hash-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_not_ruby2_keyword_hash (method)">guard_object_is_not_ruby2_keyword_hash</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_last_array_value'>last_array_value</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_ruby2_exit'>ruby2_exit</span>) <span class='comment'># clobbers :rax
</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Push arguments from array</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_array_opnd'>array_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_required_args'>required_args</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='comment'># Load the address of the embedded array
</span>    <span class='comment'># (struct RArray *)(obj)-&gt;as.ary
</span>    <span class='id identifier rubyid_array_reg'>array_reg</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='id identifier rubyid_array_opnd'>array_opnd</span>)

    <span class='comment'># Conditionally load the address of the heap array
</span>    <span class='comment'># (struct RArray *)(obj)-&gt;as.heap.ptr
</span>    <span class='id identifier rubyid_flags_opnd'>flags_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RBasic</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_flags'>flags</span>)]
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_flags_opnd'>flags_opnd</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RARRAY_EMBED_FLAG</span>)
    <span class='id identifier rubyid_heap_ptr_opnd'>heap_ptr_opnd</span> <span class='op'>=</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_heap'>heap</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ptr'>ptr</span>)]
    <span class='comment'># Load the address of the embedded array
</span>    <span class='comment'># (struct RArray *)(obj)-&gt;as.ary
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='id identifier rubyid_array_reg'>array_reg</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='const'>RArray</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_as'>as</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_ary'>ary</span>)])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_heap_ptr_opnd'>heap_ptr_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmovnz'>cmovnz</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='id identifier rubyid_ary_opnd'>ary_opnd</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>

    (<span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_required_args'>required_args</span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
      <span class='id identifier rubyid_top'>top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>Unknown</span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> [<span class='id identifier rubyid_ary_opnd'>ary_opnd</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>*</span> <span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span>])
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_top'>top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>end push_each</span><span class='tstring_end'>&#39;</span></span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putchilledstring-instance_method">
  <h3 class='signature priv'>
    #<strong>putchilledstring</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L793-L808'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='793' data-end='808'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 793</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putchilledstring'>putchilledstring</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_put_val'>put_val</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Save the PC and SP because the callee will allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_put_val'>put_val</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='int'>1</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ec_str_resurrect'>rb_ec_str_resurrect</span>)

  <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putnil-instance_method">
  <h3 class='signature priv'>
    #<strong>putnil</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L722-L724'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='722' data-end='724'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 722</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putnil'>putnil</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putobject-instance_method">
  <h3 class='signature priv'>
    #<strong>putobject</strong>(jit, ctx, asm, val: jit.operand(0))   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L739-L751'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='739' data-end='751'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 739</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putobject'>putobject</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='comment'># Push it to the stack
</span>  <span class='id identifier rubyid_val_type'>val_type</span> <span class='op'>=</span> <span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span>.<span class='id identifier rubyid_from'>from</span>(<span class='const'>C</span>.<span class='id identifier rubyid_to_ruby'>to_ruby</span>(<span class='id identifier rubyid_val'>val</span>))
  <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='id identifier rubyid_val_type'>val_type</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_imm32?'>imm32?</span>(<span class='id identifier rubyid_val'>val</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
  <span class='kw'>else</span> <span class='comment'># 64-bit immediates can&#39;t be directly written to memory
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putobject_INT2FIX_0_-instance_method">
  <h3 class='signature priv'>
    #<strong>putobject_INT2FIX_0_</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2729-L2731'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2729' data-end='2731'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2729</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putobject_INT2FIX_0_'>putobject_INT2FIX_0_</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='int'>0</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putobject_INT2FIX_1_-instance_method">
  <h3 class='signature priv'>
    #<strong>putobject_INT2FIX_1_</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L2736-L2738'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='2736' data-end='2738'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 2736</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putobject_INT2FIX_1_'>putobject_INT2FIX_1_</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_putobject'><a href="#putobject-instance_method" title="RubyVM::RJIT::InsnCompiler#putobject (method)">putobject</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>val:</span> <span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='int'>1</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putself-instance_method">
  <h3 class='signature priv'>
    #<strong>putself</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L729-L734'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='729' data-end='734'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 729</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putself'>putself</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push_self'>stack_push_self</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putspecialobject-instance_method">
  <h3 class='signature priv'>
    #<strong>putspecialobject</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L756-L768'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='756' data-end='768'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 756</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putspecialobject'>putspecialobject</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_object_type'>object_type</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_object_type'>object_type</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_SPECIAL_OBJECT_VMCORE</span>
    <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_mRubyVMFrozenCore'>rb_mRubyVMFrozenCore</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
    <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
  <span class='kw'>else</span>
    <span class='comment'># TODO: implement for VM_SPECIAL_OBJECT_CBASE and
</span>    <span class='comment'># VM_SPECIAL_OBJECT_CONST_BASE
</span>    <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="putstring-instance_method">
  <h3 class='signature priv'>
    #<strong>putstring</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L773-L788'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='773' data-end='788'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 773</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_putstring'>putstring</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_put_val'>put_val</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>ruby:</span> <span class='kw'>true</span>)

  <span class='comment'># Save the PC and SP because the callee will allocate
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_put_val'>put_val</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='int'>0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ec_str_resurrect'>rb_ec_str_resurrect</span>)

  <span class='id identifier rubyid_stack_top'>stack_top</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TString</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_top'>stack_top</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="register_cfunc_codegen_funcs-instance_method">
  <h3 class='signature priv'>
    #<strong>register_cfunc_codegen_funcs</strong>   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Helpers</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3397-L3441'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3397' data-end='3441'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3397</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_register_cfunc_codegen_funcs'>register_cfunc_codegen_funcs</span>
  <span class='comment'># Specialization for C methods. See register_cfunc_method for details.
</span>  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>BasicObject</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>!</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_not'><a href="#jit_rb_obj_not-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_not (method)">jit_rb_obj_not</a></span>)

  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>NilClass</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_nil?'>nil?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_true'><a href="#jit_rb_true-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_true (method)">jit_rb_true</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_nil?'>nil?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_false'><a href="#jit_rb_false-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_false (method)">jit_rb_false</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_kernel_is_a'><a href="#jit_rb_kernel_is_a-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_kernel_is_a (method)">jit_rb_kernel_is_a</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_kernel_is_a'><a href="#jit_rb_kernel_is_a-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_kernel_is_a (method)">jit_rb_kernel_is_a</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_instance_of?'>instance_of?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_kernel_instance_of'><a href="#jit_rb_kernel_instance_of-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_kernel_instance_of (method)">jit_rb_kernel_instance_of</a></span>)

  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>BasicObject</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>==</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_equal'><a href="#jit_rb_obj_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_equal (method)">jit_rb_obj_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>BasicObject</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_equal?'>equal?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_equal'><a href="#jit_rb_obj_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_equal (method)">jit_rb_obj_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>BasicObject</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>!=</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_not_equal'><a href="#jit_rb_obj_not_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_not_equal (method)">jit_rb_obj_not_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_eql?'>eql?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_equal'><a href="#jit_rb_obj_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_equal (method)">jit_rb_obj_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Module</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>==</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_equal'><a href="#jit_rb_obj_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_equal (method)">jit_rb_obj_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Module</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>===</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_mod_eqq'><a href="#jit_rb_mod_eqq-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_mod_eqq (method)">jit_rb_mod_eqq</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Symbol</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>==</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_equal'><a href="#jit_rb_obj_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_equal (method)">jit_rb_obj_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Symbol</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>===</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_obj_equal'><a href="#jit_rb_obj_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_obj_equal (method)">jit_rb_obj_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Integer</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>==</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_int_equal'><a href="#jit_rb_int_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_int_equal (method)">jit_rb_int_equal</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Integer</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>===</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_int_equal'><a href="#jit_rb_int_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_int_equal (method)">jit_rb_int_equal</a></span>)

  <span class='comment'># rb_str_to_s() methods in string.c
</span>  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_empty?'>empty?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_empty_p'><a href="#jit_rb_str_empty_p-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_empty_p (method)">jit_rb_str_empty_p</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_to_s'><a href="#jit_rb_str_to_s-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_to_s (method)">jit_rb_str_to_s</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_to_str'>to_str</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_to_s'><a href="#jit_rb_str_to_s-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_to_s (method)">jit_rb_str_to_s</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_bytesize'>bytesize</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_bytesize'><a href="#jit_rb_str_bytesize-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_bytesize (method)">jit_rb_str_bytesize</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>&lt;&lt;</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_concat'><a href="#jit_rb_str_concat-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_concat (method)">jit_rb_str_concat</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>+@</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_uplus'><a href="#jit_rb_str_uplus-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_uplus (method)">jit_rb_str_uplus</a></span>)

  <span class='comment'># rb_ary_empty_p() method in array.c
</span>  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Array</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_empty?'>empty?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_ary_empty_p'><a href="#jit_rb_ary_empty_p-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_ary_empty_p (method)">jit_rb_ary_empty_p</a></span>)

  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_obj_respond_to'><a href="#jit_obj_respond_to-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_obj_respond_to (method)">jit_obj_respond_to</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Kernel</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_block_given?'>block_given?</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_f_block_given_p'><a href="#jit_rb_f_block_given_p-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_f_block_given_p (method)">jit_rb_f_block_given_p</a></span>)

  <span class='comment'># Thread.current
</span>  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_singleton_class'>rb_singleton_class</span>(<span class='const'>Thread</span>)<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_current'>current</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_thread_s_current'><a href="#jit_thread_s_current-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_thread_s_current (method)">jit_thread_s_current</a></span>)

  <span class='comment'>#---
</span>  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Array</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>&lt;&lt;</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_ary_push'><a href="#jit_rb_ary_push-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_ary_push (method)">jit_rb_ary_push</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Integer</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>*</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_int_mul'><a href="#jit_rb_int_mul-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_int_mul (method)">jit_rb_int_mul</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Integer</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>/</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_int_div'><a href="#jit_rb_int_div-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_int_div (method)">jit_rb_int_div</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>Integer</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='op'>[]</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_int_aref'><a href="#jit_rb_int_aref-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_int_aref (method)">jit_rb_int_aref</a></span>)
  <span class='id identifier rubyid_register_cfunc_method'><a href="#register_cfunc_method-instance_method" title="RubyVM::RJIT::InsnCompiler#register_cfunc_method (method)">register_cfunc_method</a></span>(<span class='const'>String</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_getbyte'>getbyte</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_jit_rb_str_getbyte'><a href="#jit_rb_str_getbyte-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_rb_str_getbyte (method)">jit_rb_str_getbyte</a></span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="register_cfunc_method-instance_method">
  <h3 class='signature priv'>
    #<strong>register_cfunc_method</strong>(klass, mid_sym, func)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3443-L3453'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3443' data-end='3453'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3443</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_register_cfunc_method'>register_cfunc_method</span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_mid_sym'>mid_sym</span><span class='comma'>,</span> <span class='id identifier rubyid_func'>func</span>)
  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_intern'>rb_intern</span>(<span class='id identifier rubyid_mid_sym'>mid_sym</span>.<span class='id identifier rubyid_to_s'>to_s</span>)
  <span class='id identifier rubyid_me'>me</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_method_entry_at'>rb_method_entry_at</span>(<span class='id identifier rubyid_klass'>klass</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span>)

  <span class='id identifier rubyid_assert_equal'><a href="#assert_equal-instance_method" title="RubyVM::RJIT::InsnCompiler#assert_equal (method)">assert_equal</a></span>(<span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_nil?'>nil?</span>)

  <span class='comment'># Only cfuncs are supported
</span>  <span class='id identifier rubyid_method_serial'>method_serial</span> <span class='op'>=</span> <span class='id identifier rubyid_me'>me</span>.<span class='id identifier rubyid_def'>def</span>.<span class='id identifier rubyid_method_serial'>method_serial</span>

  <span class='ivar'>@cfunc_codegen_table</span>[<span class='id identifier rubyid_method_serial'>method_serial</span>] <span class='op'>=</span> <span class='id identifier rubyid_method'>method</span>(<span class='id identifier rubyid_func'>func</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="send-instance_method">
  <h3 class='signature priv'>
    #<strong>send</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1423-L1447'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1423' data-end='1447'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1423</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_send'>send</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># Specialize on a compile-time receiver, and split a block for chain guards
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cd'>cd</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_call_data'>rb_call_data</span>.<span class='id identifier rubyid_new'><a href="#new-class_method" title="RubyVM::RJIT::InsnCompiler.new (method)">new</a></span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_blockiseq'>blockiseq</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># calling-&gt;ci
</span>  <span class='id identifier rubyid_mid'>mid</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_vm_ci_mid'>vm_ci_mid</span>(<span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span>)
  <span class='id identifier rubyid_calling'>calling</span> <span class='op'>=</span> <span class='id identifier rubyid_build_calling'><a href="#build_calling-instance_method" title="RubyVM::RJIT::InsnCompiler#build_calling (method)">build_calling</a></span>(<span class='label'>ci:</span> <span class='id identifier rubyid_cd'>cd</span>.<span class='id identifier rubyid_ci'>ci</span><span class='comma'>,</span> <span class='label'>block_handler:</span> <span class='id identifier rubyid_blockiseq'>blockiseq</span>)

  <span class='kw'>if</span> <span class='id identifier rubyid_calling'>calling</span>.<span class='id identifier rubyid_flags'>flags</span> <span class='op'>&amp;</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_CALL_FORWARDING</span> <span class='op'>!=</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># vm_sendish
</span>  <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span> <span class='op'>=</span> <span class='id identifier rubyid_jit_search_method'><a href="#jit_search_method-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_search_method (method)">jit_search_method</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_cme'>cme</span> <span class='op'>==</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_jit_call_general'><a href="#jit_call_general-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_call_general (method)">jit_call_general</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_mid'>mid</span><span class='comma'>,</span> <span class='id identifier rubyid_calling'>calling</span><span class='comma'>,</span> <span class='id identifier rubyid_cme'>cme</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_recv_klass'>comptime_recv_klass</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setclassvariable-instance_method">
  <h3 class='signature priv'>
    #<strong>setclassvariable</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L593-L605'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='593' data-end='605'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 593</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setclassvariable'>setclassvariable</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='comment'># rb_vm_setclassvariable can raise exceptions.
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_iseq'>iseq</span>)])
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>3</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>4</span>]<span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>))
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_setclassvariable'>rb_vm_setclassvariable</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setinstancevariable-instance_method">
  <h3 class='signature priv'>
    #<strong>setinstancevariable</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L439-L569'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='439' data-end='569'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 439</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setinstancevariable'>setinstancevariable</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_starting_context'>starting_context</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_dup'><a href="#dup-instance_method" title="RubyVM::RJIT::InsnCompiler#dup (method)">dup</a></span> <span class='comment'># make a copy for use with jit_chain_guard
</span>
  <span class='comment'># Defer compilation so we can specialize on a runtime `self`
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_at_current_insn?'>at_current_insn?</span>
    <span class='id identifier rubyid_defer_compilation'><a href="#defer_compilation-instance_method" title="RubyVM::RJIT::InsnCompiler#defer_compilation (method)">defer_compilation</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_ivar_name'>ivar_name</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_self'>peek_at_self</span>

  <span class='comment'># If the comptime receiver is frozen, writing an IV will raise an exception
</span>  <span class='comment'># and we don&#39;t want to JIT code to deal with that situation.
</span>  <span class='kw'>if</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_obj_frozen_p'>rb_obj_frozen_p</span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_setivar_frozen'>setivar_frozen</span>)
    <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
  <span class='kw'>end</span>

  <span class='comment'># Check if the comptime receiver is a T_OBJECT
</span>  <span class='id identifier rubyid_receiver_t_object'>receiver_t_object</span> <span class='op'>=</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>BUILTIN_TYPE</span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>T_OBJECT</span>

  <span class='comment'># If the receiver isn&#39;t a T_OBJECT, or uses a custom allocator,
</span>  <span class='comment'># then just write out the IV write as a function call.
</span>  <span class='comment'># too-complex shapes can&#39;t use index access, so we use rb_ivar_get for them too.
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_receiver_t_object'>receiver_t_object</span> <span class='op'>||</span> <span class='id identifier rubyid_shape_too_complex?'><a href="#shape_too_complex%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#shape_too_complex? (method)">shape_too_complex?</a></span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span>) <span class='op'>||</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_chain_depth'>chain_depth</span> <span class='op'>&gt;=</span> <span class='int'>10</span>
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call rb_vm_setinstancevariable</span><span class='tstring_end'>&#39;</span></span>)

    <span class='id identifier rubyid_ic'>ic</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

    <span class='comment'># The function could raise exceptions.
</span>    <span class='comment'># Note that this modifies REG_SP, which is why we do it first
</span>    <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

    <span class='comment'># Get the operands from the stack
</span>    <span class='id identifier rubyid_val_opnd'>val_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

    <span class='comment'># Call rb_vm_setinstancevariable(iseq, obj, id, val, ic);
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rdi'>rdi</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_to_i'>to_i</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rsi'>rsi</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rdx'>rdx</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_name'>ivar_name</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_val_opnd'>val_opnd</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_r8'>r8</span><span class='comma'>,</span> <span class='id identifier rubyid_ic'>ic</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_setinstancevariable'>rb_vm_setinstancevariable</span>)
  <span class='kw'>else</span>
    <span class='comment'># Get the iv index
</span>    <span class='id identifier rubyid_shape_id'>shape_id</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_shape_id'>rb_shape_get_shape_id</span>(<span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span>)
    <span class='id identifier rubyid_ivar_index'>ivar_index</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_iv_index'>rb_shape_get_iv_index</span>(<span class='id identifier rubyid_shape_id'>shape_id</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_name'>ivar_name</span>)

    <span class='comment'># Get the receiver
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])

    <span class='comment'># Generate a side exit
</span>    <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span> <span class='op'>=</span> <span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)

    <span class='comment'># Upgrade type
</span>    <span class='id identifier rubyid_guard_object_is_heap'><a href="#guard_object_is_heap-instance_method" title="RubyVM::RJIT::InsnCompiler#guard_object_is_heap (method)">guard_object_is_heap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#SelfOpnd-constant" title="RubyVM::RJIT::SelfOpnd (constant)">SelfOpnd</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setivar_not_heap'>setivar_not_heap</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>guard shape</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='const'><a href="DwordPtr.html" title="RubyVM::RJIT::DwordPtr (class)">DwordPtr</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_id_offset'>rb_shape_id_offset</span>]<span class='comma'>,</span> <span class='id identifier rubyid_shape_id'>shape_id</span>)
    <span class='id identifier rubyid_megamorphic_side_exit'>megamorphic_side_exit</span> <span class='op'>=</span> <span class='id identifier rubyid_counted_exit'><a href="#counted_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#counted_exit (method)">counted_exit</a></span>(<span class='id identifier rubyid_side_exit'><a href="#side_exit-instance_method" title="RubyVM::RJIT::InsnCompiler#side_exit (method)">side_exit</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_setivar_megamorphic'>setivar_megamorphic</span>)
    <span class='id identifier rubyid_jit_chain_guard'><a href="#jit_chain_guard-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_chain_guard (method)">jit_chain_guard</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_jne'>jne</span><span class='comma'>,</span> <span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_starting_context'>starting_context</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_megamorphic_side_exit'>megamorphic_side_exit</span>)

    <span class='comment'># If we don&#39;t have an instance variable index, then we need to
</span>    <span class='comment'># transition out of the current shape.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_ivar_index'>ivar_index</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_shape'>shape</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_shape_by_id'>rb_shape_get_shape_by_id</span>(<span class='id identifier rubyid_shape_id'>shape_id</span>)

      <span class='id identifier rubyid_current_capacity'>current_capacity</span> <span class='op'>=</span> <span class='id identifier rubyid_shape'>shape</span>.<span class='id identifier rubyid_capacity'>capacity</span>
      <span class='id identifier rubyid_dest_shape'>dest_shape</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_next_no_warnings'>rb_shape_get_next_no_warnings</span>(<span class='id identifier rubyid_shape'>shape</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_name'>ivar_name</span>)
      <span class='id identifier rubyid_new_shape_id'>new_shape_id</span> <span class='op'>=</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_id'>rb_shape_id</span>(<span class='id identifier rubyid_dest_shape'>dest_shape</span>)

      <span class='kw'>if</span> <span class='id identifier rubyid_new_shape_id'>new_shape_id</span> <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OBJ_TOO_COMPLEX_SHAPE_ID</span>
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_incr_counter'>incr_counter</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_setivar_too_complex'>setivar_too_complex</span>)
        <span class='kw'>return</span> <span class='const'><a href="../RJIT.html#CantCompile-constant" title="RubyVM::RJIT::CantCompile (constant)">CantCompile</a></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_ivar_index'>ivar_index</span> <span class='op'>=</span> <span class='id identifier rubyid_shape'>shape</span>.<span class='id identifier rubyid_next_iv_index'>next_iv_index</span>

      <span class='comment'># If the new shape has a different capacity, we need to
</span>      <span class='comment'># reallocate the object.
</span>      <span class='id identifier rubyid_needs_extension'>needs_extension</span> <span class='op'>=</span> <span class='id identifier rubyid_dest_shape'>dest_shape</span>.<span class='id identifier rubyid_capacity'>capacity</span> <span class='op'>!=</span> <span class='id identifier rubyid_shape'>shape</span>.<span class='id identifier rubyid_capacity'>capacity</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_needs_extension'>needs_extension</span>
        <span class='comment'># Generate the C call so that runtime code will increase
</span>        <span class='comment'># the capacity and set the buffer.
</span>        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_current_capacity'>current_capacity</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_dest_shape'>dest_shape</span>.<span class='id identifier rubyid_capacity'>capacity</span>)
        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ensure_iv_list_size'>rb_ensure_iv_list_size</span>)

        <span class='comment'># Load the receiver again after the function call
</span>        <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)])
      <span class='kw'>end</span>

      <span class='id identifier rubyid_write_val'>write_val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
      <span class='id identifier rubyid_jit_write_iv'><a href="#jit_write_iv-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_write_iv (method)">jit_write_iv</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_index'>ivar_index</span><span class='comma'>,</span> <span class='id identifier rubyid_write_val'>write_val</span><span class='comma'>,</span> <span class='id identifier rubyid_needs_extension'>needs_extension</span>)

      <span class='comment'># Store the new shape
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>write shape</span><span class='tstring_end'>&#39;</span></span>)
      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)]) <span class='comment'># reload after jit_write_iv
</span>      <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="DwordPtr.html" title="RubyVM::RJIT::DwordPtr (class)">DwordPtr</a></span>[<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_id_offset'>rb_shape_id_offset</span>]<span class='comma'>,</span> <span class='id identifier rubyid_new_shape_id'>new_shape_id</span>)
    <span class='kw'>else</span>
      <span class='comment'># If the iv index already exists, then we don&#39;t need to
</span>      <span class='comment'># transition to a new shape.  The reason is because we find
</span>      <span class='comment'># the iv index by searching up the shape tree.  If we&#39;ve
</span>      <span class='comment'># made the transition already, then there&#39;s no reason to
</span>      <span class='comment'># update the shape on the object.  Just set the IV.
</span>      <span class='id identifier rubyid_write_val'>write_val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)
      <span class='id identifier rubyid_jit_write_iv'><a href="#jit_write_iv-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_write_iv (method)">jit_write_iv</a></span>(<span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_comptime_receiver'>comptime_receiver</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_ivar_index'>ivar_index</span><span class='comma'>,</span> <span class='id identifier rubyid_write_val'>write_val</span><span class='comma'>,</span> <span class='kw'>false</span>)
    <span class='kw'>end</span>

    <span class='id identifier rubyid_skip_wb'>skip_wb</span> <span class='op'>=</span> <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_new_label'>new_label</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>skip_wb</span><span class='tstring_end'>&#39;</span></span>)
    <span class='comment'># If the value we&#39;re writing is an immediate, we don&#39;t need to WB
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_test'>test</span>(<span class='id identifier rubyid_write_val'>write_val</span><span class='comma'>,</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_IMMEDIATE_MASK</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jnz'>jnz</span>(<span class='id identifier rubyid_skip_wb'>skip_wb</span>)

    <span class='comment'># If the value we&#39;re writing is nil or false, we don&#39;t need to WB
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_cmp'>cmp</span>(<span class='id identifier rubyid_write_val'>write_val</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#Qnil-constant" title="RubyVM::RJIT::Qnil (constant)">Qnil</a></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_jbe'>jbe</span>(<span class='id identifier rubyid_skip_wb'>skip_wb</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>write barrier</span><span class='tstring_end'>&#39;</span></span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> [<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span><span class='comma'>,</span> <span class='const'>C</span>.<span class='id identifier rubyid_rb_control_frame_t'>rb_control_frame_t</span>.<span class='id identifier rubyid_offsetof'>offsetof</span>(<span class='symbeg'>:</span><span class='kw'>self</span>)]) <span class='comment'># reload after jit_write_iv
</span>    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_write_val'>write_val</span>)
    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_gc_writebarrier'>rb_gc_writebarrier</span>)

    <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_write_label'>write_label</span>(<span class='id identifier rubyid_skip_wb'>skip_wb</span>)
  <span class='kw'>end</span>

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setlocal-instance_method">
  <h3 class='signature priv'>
    #<strong>setlocal</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L187-L191'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='187' data-end='191'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 187</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setlocal'>setlocal</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_jit_setlocal_generic'><a href="#jit_setlocal_generic-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_setlocal_generic (method)">jit_setlocal_generic</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setlocal_WC_0-instance_method">
  <h3 class='signature priv'>
    #<strong>setlocal_WC_0</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L196-L199'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='196' data-end='199'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 196</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setlocal_WC_0'>setlocal_WC_0</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_jit_setlocal_generic'><a href="#jit_setlocal_generic-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_setlocal_generic (method)">jit_setlocal_generic</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span> <span class='int'>0</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setlocal_WC_1-instance_method">
  <h3 class='signature priv'>
    #<strong>setlocal_WC_1</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L204-L207'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='204' data-end='207'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 204</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setlocal_WC_1'>setlocal_WC_1</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_jit_setlocal_generic'><a href="#jit_setlocal_generic-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_setlocal_generic (method)">jit_setlocal_generic</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='label'>idx:</span><span class='comma'>,</span> <span class='label'>level:</span> <span class='int'>1</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="setn-instance_method">
  <h3 class='signature priv'>
    #<strong>setn</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1238-L1250'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1238' data-end='1250'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1238</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_setn'>setn</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='id identifier rubyid_top_val'>top_val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_dst_opnd'>dst_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_top_val'>top_val</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_dst_opnd'>dst_opnd</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='id identifier rubyid_mapping'>mapping</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='int'>0</span>])
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_set_opnd_mapping'>set_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_n'>n</span>]<span class='comma'>,</span> <span class='id identifier rubyid_mapping'>mapping</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="shape_too_complex?-instance_method">
  <h3 class='signature priv'>
    #<strong>shape_too_complex?</strong>(obj)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5939-L5941'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5939' data-end='5941'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5939</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_shape_too_complex?'>shape_too_complex?</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='const'>C</span>.<span class='id identifier rubyid_rb_shape_get_shape_id'>rb_shape_get_shape_id</span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>OBJ_TOO_COMPLEX_SHAPE_ID</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="side_exit-instance_method">
  <h3 class='signature priv'>
    #<strong>side_exit</strong>(jit, ctx)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5985-L5995'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5985' data-end='5995'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5985</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_side_exit'>side_exit</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>)
  <span class='comment'># We use the latest ctx.sp_offset to generate a side exit to tolerate sp_offset changes by jit_save_sp.
</span>  <span class='comment'># However, we want to simulate an old stack_size when we take a side exit. We do that by adjusting the
</span>  <span class='comment'># sp_offset because gen_outlined_exit uses ctx.sp_offset to move SP.
</span>  <span class='id identifier rubyid_ctx'>ctx</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_with_stack_size'>with_stack_size</span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_stack_size_for_pc'>stack_size_for_pc</span>)

  <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_side_exit_for_pc'>side_exit_for_pc</span>[<span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_offset'>sp_offset</span>] <span class='op'>||=</span> <span class='const'><a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">Assembler</a></span>.<span class='id identifier rubyid_new'><a href="Assembler.html#new-class_method" title="RubyVM::RJIT::Assembler.new (method)">new</a></span>.<span class='id identifier rubyid_then'>then</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_asm'>asm</span><span class='op'>|</span>
    <span class='ivar'>@exit_compiler</span>.<span class='id identifier rubyid_compile_side_exit'>compile_side_exit</span>(<span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_pc'>pc</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
    <span class='ivar'>@ocb</span>.<span class='id identifier rubyid_write'>write</span>(<span class='id identifier rubyid_asm'>asm</span>)
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="slot_to_local_idx-instance_method">
  <h3 class='signature priv'>
    #<strong>slot_to_local_idx</strong>(iseq, slot_idx)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Compute the index of a local variable from its slot index</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3555-L3573'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3555' data-end='3573'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3555</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_slot_to_local_idx'>slot_to_local_idx</span>(<span class='id identifier rubyid_iseq'>iseq</span><span class='comma'>,</span> <span class='id identifier rubyid_slot_idx'>slot_idx</span>)
  <span class='comment'># Layout illustration
</span>  <span class='comment'># This is an array of VALUE
</span>  <span class='comment'>#                                           | VM_ENV_DATA_SIZE |
</span>  <span class='comment'>#                                           v                  v
</span>  <span class='comment'># low addr &lt;----------------------------------------------
</span>  <span class='comment'>#           |local 0|local 1|  ...  |local n|       ....       |
</span>  <span class='comment'>#           ----------------------------------------------
</span>  <span class='comment'>#           ^       ^                       ^                  ^
</span>  <span class='comment'>#           ----------local_table_size----+         cfp-&gt;ep--+
</span>  <span class='comment'>#                   |                                          |
</span>  <span class='comment'>#                   ------------------slot_idx----------------
</span>  <span class='comment'>#
</span>  <span class='comment'># See usages of local_var_name() from iseq.c for similar calculation.
</span>
  <span class='id identifier rubyid_local_table_size'>local_table_size</span> <span class='op'>=</span> <span class='id identifier rubyid_iseq'>iseq</span>.<span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_local_table_size'>local_table_size</span>
  <span class='id identifier rubyid_op'>op</span> <span class='op'>=</span> <span class='id identifier rubyid_slot_idx'>slot_idx</span> <span class='op'>-</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>VM_ENV_DATA_SIZE</span>
  <span class='id identifier rubyid_local_table_size'>local_table_size</span> <span class='op'>-</span> <span class='id identifier rubyid_op'>op</span> <span class='op'>-</span> <span class='int'>1</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="splatarray-instance_method">
  <h3 class='signature priv'>
    #<strong>splatarray</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1074-L1093'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1074' data-end='1093'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1074</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_splatarray'>splatarray</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_flag'>flag</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='comment'># Save the PC and SP because the callee may allocate
</span>  <span class='comment'># Note that this modifies REG_SP, which is why we do it first
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># Get the operands from the stack
</span>  <span class='id identifier rubyid_ary_opnd'>ary_opnd</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)

  <span class='comment'># Call rb_vm_splat_array(flag, ary)
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_ary_opnd'>ary_opnd</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_splat_array'>rb_vm_splat_array</span>)

  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>TArray</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="stack_swap-instance_method">
  <h3 class='signature priv'>
    #<strong>stack_swap</strong>(_jit, ctx, asm, offset0, offset1)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3459-L3473'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3459' data-end='3473'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3459</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_stack_swap'>stack_swap</span>(<span class='id identifier rubyid__jit'>_jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='id identifier rubyid_offset0'>offset0</span><span class='comma'>,</span> <span class='id identifier rubyid_offset1'>offset1</span>)
  <span class='id identifier rubyid_stack0_mem'>stack0_mem</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_offset0'>offset0</span>)
  <span class='id identifier rubyid_stack1_mem'>stack1_mem</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_offset1'>offset1</span>)

  <span class='id identifier rubyid_mapping0'>mapping0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_offset0'>offset0</span>])
  <span class='id identifier rubyid_mapping1'>mapping1</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_offset1'>offset1</span>])

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_stack0_mem'>stack0_mem</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_stack1_mem'>stack1_mem</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack0_mem'>stack0_mem</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack1_mem'>stack1_mem</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_set_opnd_mapping'>set_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_offset0'>offset0</span>]<span class='comma'>,</span> <span class='id identifier rubyid_mapping1'>mapping1</span>)
  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_set_opnd_mapping'>set_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_offset1'>offset1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_mapping0'>mapping0</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="static_symbol?-instance_method">
  <h3 class='signature priv'>
    #<strong>static_symbol?</strong>(obj)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5930-L5932'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5930' data-end='5932'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5930</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_static_symbol?'>static_symbol?</span>(<span class='id identifier rubyid_obj'>obj</span>)
  (<span class='const'>C</span>.<span class='id identifier rubyid_to_value'><a href="#to_value-instance_method" title="RubyVM::RJIT::InsnCompiler#to_value (method)">to_value</a></span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='op'>&amp;</span> <span class='int'>0xff</span>) <span class='op'>==</span> <span class='const'>C</span><span class='op'>::</span><span class='const'>RUBY_SYMBOL_FLAG</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="swap-instance_method">
  <h3 class='signature priv'>
    #<strong>swap</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1213-L1216'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1213' data-end='1216'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1213</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_swap'>swap</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_stack_swap'><a href="#stack_swap-instance_method" title="RubyVM::RJIT::InsnCompiler#stack_swap (method)">stack_swap</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span>)
  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="symbol?-instance_method">
  <h3 class='signature priv'>
    #<strong>symbol?</strong>(obj)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L5926-L5928'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='5926' data-end='5928'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 5926</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_symbol?'>symbol?</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='id identifier rubyid_static_symbol?'><a href="#static_symbol%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#static_symbol? (method)">static_symbol?</a></span>(<span class='id identifier rubyid_obj'>obj</span>) <span class='op'>||</span> <span class='id identifier rubyid_dynamic_symbol?'><a href="#dynamic_symbol%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#dynamic_symbol? (method)">dynamic_symbol?</a></span>(<span class='id identifier rubyid_obj'>obj</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="throw-instance_method">
  <h3 class='signature priv'>
    #<strong>throw</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1903-L1930'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1903' data-end='1930'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1903</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_throw'>throw</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_throw_state'>throw_state</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='int'>1</span>)) <span class='comment'># throwobj
</span>
  <span class='comment'># THROW_DATA_NEW allocates. Save SP for GC and PC for allocation tracing as
</span>  <span class='comment'># well as handling the catch table. However, not using jit_prepare_routine_call
</span>  <span class='comment'># since we don&#39;t need a patch point for this implementation.
</span>  <span class='id identifier rubyid_jit_save_pc'><a href="#jit_save_pc-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_pc (method)">jit_save_pc</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>) <span class='comment'># clobbers rax
</span>  <span class='id identifier rubyid_jit_save_sp'><a href="#jit_save_sp-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_save_sp (method)">jit_save_sp</a></span>(<span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='comment'># rb_vm_throw verifies it&#39;s a valid throw, sets ec-&gt;tag-&gt;state, and returns throw
</span>  <span class='comment'># data, which is throwobj or a vm_throw_data wrapping it. When ec-&gt;tag-&gt;state is
</span>  <span class='comment'># set, JIT code callers will handle the throw with vm_exec_handle_exception.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='id identifier rubyid_throw_state'>throw_state</span>)
  <span class='comment'># asm.mov(C_ARGS[3], :rcx) # same reg
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_vm_throw'>rb_vm_throw</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_comment'>comment</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>exit from throw</span><span class='tstring_end'>&#39;</span></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='const'><a href="../RJIT.html#SP-constant" title="RubyVM::RJIT::SP (constant)">SP</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='const'><a href="../RJIT.html#EC-constant" title="RubyVM::RJIT::EC (constant)">EC</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='const'><a href="../RJIT.html#CFP-constant" title="RubyVM::RJIT::CFP (constant)">CFP</a></span>)

  <span class='comment'># return C_RET as C_RET
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_ret'>ret</span>
  <span class='const'><a href="../RJIT.html#EndBlock-constant" title="RubyVM::RJIT::EndBlock (constant)">EndBlock</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_value-instance_method">
  <h3 class='signature priv'>
    #<strong>to_value</strong>(obj)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L6008-L6011'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='6008' data-end='6011'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 6008</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_value'>to_value</span>(<span class='id identifier rubyid_obj'>obj</span>)
  <span class='const'><a href="../RJIT.html#GC_REFS-constant" title="RubyVM::RJIT::GC_REFS (constant)">GC_REFS</a></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_obj'>obj</span>
  <span class='const'>C</span>.<span class='id identifier rubyid_to_value'>to_value</span>(<span class='id identifier rubyid_obj'>obj</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="topn-instance_method">
  <h3 class='signature priv'>
    #<strong>topn</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L1223-L1233'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='1223' data-end='1233'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 1223</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_topn'>topn</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span>)

  <span class='id identifier rubyid_top_n_val'>top_n_val</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_opnd'>stack_opnd</span>(<span class='id identifier rubyid_n'>n</span>)
  <span class='id identifier rubyid_mapping'>mapping</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_get_opnd_mapping'>get_opnd_mapping</span>(<span class='const'><a href="../RJIT.html#StackOpnd-constant" title="RubyVM::RJIT::StackOpnd (constant)">StackOpnd</a></span>[<span class='id identifier rubyid_n'>n</span>])
  <span class='id identifier rubyid_loc0'>loc0</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push_mapping'>stack_push_mapping</span>(<span class='id identifier rubyid_mapping'>mapping</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_top_n_val'>top_n_val</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_loc0'>loc0</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="toregexp-instance_method">
  <h3 class='signature priv'>
    #<strong>toregexp</strong>(jit, ctx, asm)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
  <li>
    <span class='name'>ctx</span>
    <span class='type'>(<a href="Context.html" title="RubyVM::RJIT::Context (class)">RubyVM::RJIT::Context</a>)</span>
  </li>
  <li>
    <span class='name'>asm</span>
    <span class='type'>(<a href="Assembler.html" title="RubyVM::RJIT::Assembler (class)">RubyVM::RJIT::Assembler</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L857-L895'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='857' data-end='895'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 857</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_toregexp'>toregexp</span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)
  <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>0</span><span class='comma'>,</span> <span class='label'>signed:</span> <span class='kw'>true</span>)
  <span class='id identifier rubyid_cnt'>cnt</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_operand'>operand</span>(<span class='int'>1</span>)

  <span class='comment'># Save the PC and SP because this allocates an object and could
</span>  <span class='comment'># raise an exception.
</span>  <span class='id identifier rubyid_jit_prepare_routine_call'><a href="#jit_prepare_routine_call-instance_method" title="RubyVM::RJIT::InsnCompiler#jit_prepare_routine_call (method)">jit_prepare_routine_call</a></span>(<span class='id identifier rubyid_jit'>jit</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span><span class='comma'>,</span> <span class='id identifier rubyid_asm'>asm</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_lea'>lea</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_sp_opnd'>sp_opnd</span>(<span class='op'>-</span><span class='const'>C</span>.<span class='const'>VALUE</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='id identifier rubyid_cnt'>cnt</span>)) <span class='comment'># values_ptr
</span>  <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_pop'>stack_pop</span>(<span class='id identifier rubyid_cnt'>cnt</span>)

  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='int'>0</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_cnt'>cnt</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>2</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rax'>rax</span>) <span class='comment'># values_ptr
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_tmp_new_from_values'>rb_ary_tmp_new_from_values</span>)

  <span class='comment'># Save the array so we can clear it later
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_push'>push</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_push'>push</span>(<span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>) <span class='comment'># Alignment
</span>
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>1</span>]<span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_reg_new_ary'>rb_reg_new_ary</span>)

  <span class='comment'># The actual regex is in RAX now.  Pop the temp array from
</span>  <span class='comment'># rb_ary_tmp_new_from_values into C arg regs so we can clear it
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>) <span class='comment'># Alignment
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_pop'><a href="#pop-instance_method" title="RubyVM::RJIT::InsnCompiler#pop (method)">pop</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>) <span class='comment'># ary
</span>
  <span class='comment'># The value we want to push on the stack is in RAX right now
</span>  <span class='id identifier rubyid_stack_ret'>stack_ret</span> <span class='op'>=</span> <span class='id identifier rubyid_ctx'>ctx</span>.<span class='id identifier rubyid_stack_push'>stack_push</span>(<span class='const'><a href="../RJIT.html#Type-constant" title="RubyVM::RJIT::Type (constant)">Type</a></span><span class='op'>::</span><span class='const'>UnknownHeap</span>)
  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='id identifier rubyid_stack_ret'>stack_ret</span><span class='comma'>,</span> <span class='const'><a href="../RJIT.html#C_RET-constant" title="RubyVM::RJIT::C_RET (constant)">C_RET</a></span>)

  <span class='comment'># Clear the temp array.
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_mov'>mov</span>(<span class='const'><a href="../RJIT.html#C_ARGS-constant" title="RubyVM::RJIT::C_ARGS (constant)">C_ARGS</a></span>[<span class='int'>0</span>]<span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_rcx'>rcx</span>) <span class='comment'># ary
</span>  <span class='id identifier rubyid_asm'>asm</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'>C</span>.<span class='id identifier rubyid_rb_ary_clear'>rb_ary_clear</span>)

  <span class='const'><a href="../RJIT.html#KeepCompiling-constant" title="RubyVM::RJIT::KeepCompiling (constant)">KeepCompiling</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="two_fixnums_on_stack?-instance_method">
  <h3 class='signature priv'>
    #<strong>two_fixnums_on_stack?</strong>(jit)  &#x21d2; <code>Boolean</code>  <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Parameters:</p>
<ul class='param'>
  <li>
    <span class='name'>jit</span>
    <span class='type'>(<a href="JITState.html" title="RubyVM::RJIT::JITState (class)">RubyVM::RJIT::JITState</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/ruby/ruby/blob/v3_4_6/lib/ruby_vm/rjit/insn_compiler.rb#L3856-L3860'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='3856' data-end='3860'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/ruby_vm/rjit/insn_compiler.rb', line 3856</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_two_fixnums_on_stack?'>two_fixnums_on_stack?</span>(<span class='id identifier rubyid_jit'>jit</span>)
  <span class='id identifier rubyid_comptime_recv'>comptime_recv</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>1</span>)
  <span class='id identifier rubyid_comptime_arg'>comptime_arg</span> <span class='op'>=</span> <span class='id identifier rubyid_jit'>jit</span>.<span class='id identifier rubyid_peek_at_stack'>peek_at_stack</span>(<span class='int'>0</span>)
  <span class='kw'>return</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_recv'>comptime_recv</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fixnum?'><a href="#fixnum%3F-instance_method" title="RubyVM::RJIT::InsnCompiler#fixnum? (method)">fixnum?</a></span>(<span class='id identifier rubyid_comptime_arg'>comptime_arg</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>