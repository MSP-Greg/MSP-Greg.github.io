<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Rinda::RingServer &mdash; rinda Ruby-2.2.6 p342</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/custom.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/common.css' />

<script type='text/javascript'>
  var pathId = "Rinda::RingServer",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
  <svg id='y_wait' class='' viewBox='0 0 90 90'></svg>
  <div id='tbl_cont'>
    <div id='y_list' class='d h'>
      <button id='list_sizer' class='y_sizer' title='LIST Resizer'></button>
      <header id='list_header'>
        <div id='list_title'>&#160;</div>
        <div id='list_menu'><span>&#160;</span></div>
        <input  id='list_search_text' type='search' placeholder='Search' size='12' value='' autocomplete='off' class='search_input'/>
        <svg id='list_search_icon' viewBox='0 0 30 30'>
          <path class='s_main' d='M21.189,17.213C22.022,15.726,22.5,14.014,22.5,12.188C22.5,6.493,17.884,1.875,12.188,1.875S1.875,6.493,1.875,12.188C1.875,17.882,6.491,22.5,12.188,22.5c1.826,0,3.536-0.48,5.025-1.311l6.113,6.113C23.873,27.851,24.593,28.125,25.313,28.125s1.44-0.274,1.989-0.823c1.099-1.099,1.099-2.878,0-3.977L21.189,17.213z M12.188,19.329c-3.943,0-7.14-3.197-7.14-7.142c0.0-3.943,3.197-7.14,7.14-7.14c3.941,0,7.14,3.195,7.14,7.14C19.328,16.133,16.129,19.329,12.188,19.329z'/>
          <path class='s_clear' d='M 4.414, 1.586 A 1,1 0 1,0 1.586, 4.414 L 21.586,24.414 A 1,1 0 1,0 24.414,21.586 z' />
          <path class='s_clear' d='M 1.586,21.586 A 1,1 0 1,0 4.414,24.414 L 24.414, 4.414 A 1,1 0 1,0 21.586, 1.586 z' />
        </svg>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All'></button>
      </header>
      <nav id= 'list_nav' class='y_nav l_nav'>
        <ul id='list_items'></ul>
      </nav>
    </div>
    <div id='y_toc' class='f h'>
      <button id='toc_sizer' class='y_sizer' title='TOC Resizer'></button>
      <header id='toc_header'>
        <div>Table of Contents</div>
        <button class='y_minus' title='Collapse All'></button>
        <button class='y_plus' title='Expand All' ></button>
      </header>
      <nav id= 'toc_nav' class='y_nav t_nav'>
      <ol id='toc_items'></ol>
      </nav>
    </div>
    <div id='y_main' tabindex='-1'>
      <header id='y_header'>
        <div id='y_menu'>
          <a href='../../../index.html'>Home</a> &raquo; 
          <a href='../../index.html'>Ruby-2.2.6</a> &raquo; 
          <a href='../index.html'>rinda</a> &raquo; 
          <a href='../_index.html'>Index (R)</a> &raquo; 
        #  <a href="../Rinda.html" title="Rinda (module)">Rinda</a> &raquo; 
          <span class='title'>RingServer</span>
        </div>

        <div id='y_measure_em' class='y_measure'></div>
        <div id='y_measure_vh' class='y_measure'></div>
        <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
        <a id='list_href' href="../class_list.html"></a>
        <div id='hdr_button'>
          <button id='src' class='c' title='Source Show / Hide'>S<svg class='c' viewBox='0 0 36 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
              <rect x='20' y='0'  width='4'  height='28' rx='1.0' ry='1.0'/>
            </svg><svg class='o' viewBox='0 0 34 28'>
              <rect x='8'  y='12' width='28' height='4'  rx='1.0' ry='1.0'/>
            </svg></button>
          <button id='list_loc' class='d' title='LIST Location'>L<svg class='f' viewBox='0 0 36 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='toc_loc' class='f' title='TOC Location'>T<svg class='f' viewBox='0 0 34 28'>
            <path d='M36 0 L36 28 8 14'/></svg><svg class='d' viewBox='0 0 36 28'><path d='M 8 0 L36 14 8 28'/></svg></button>
          <button id='list_vis' title='LIST Show / Hide'>LIST</button>
          <button id='toc_vis' title='TOC Show / Hide'>TOC</button>
        </div>
        <div id='y_debug'></div>
      </header>
<div id='content' class='class'>

<h1>Class: Rinda::RingServer</h1>

<div class="box_info">
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class='inheritName'>Object</span>
        <ul class='fullTree'>
          <li>Object</li>
            <li class='next'>Rinda::RingServer</li>
        </ul>
        <a href='#' class='inheritanceTree'>show all</a>
    </dd>
  </dl>

  <dl>
      <dt>Includes:</dt>
      <dd>DRbUndumped</dd>
  </dl>


  <dl>
    <dt>Defined in:</dt>
    <dd>rinda/ring.rb</dd>
  </dl>
</div>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A RingServer allows a <a href="TupleSpace.html" title="Rinda::TupleSpace (class)">TupleSpace</a> to be located via UDP broadcasts.
Default service location uses the following steps:</p>
<ol><li>
<p>A RingServer begins listening on the network broadcast UDP address.</p>
</li><li>
<p>A RingFinger sends a UDP packet containing the DRb URI where it will listen
for a reply.</p>
</li><li>
<p>The RingServer receives the UDP packet and connects back to the provided
DRb URI with the DRb service.</p>
</li></ol>

<p>A RingServer requires a TupleSpace:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>TupleSpace</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>RingServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
</code></pre>

<p>RingServer can also listen on multicast addresses for announcements.  This
allows multiple RingServers to run on the same host.  To use network
broadcast and multicast:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>TupleSpace</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>RingServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_ts'>ts</span><span class='comma'>,</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>Socket::INADDR_ANY,</span><span class='words_sep'> </span><span class='tstring_content'>239.0.0.1</span><span class='words_sep'> </span><span class='tstring_content'>ff02::1</span><span class='words_sep'>]</span>
</code></pre>


  </div>
</div>
<div class="tags">
  
</div>
<h2>Defined Under Namespace</h2>

  <p class='children'><strong class='classes'>Classes:</strong>
    <a href="RingServer/Renewer.html" title="Rinda::RingServer::Renewer (class)">Renewer</a>
  </p>





<h2>Class Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(ts, addresses = [Socket::INADDR_ANY], port = Ring_PORT)  &#x21d2; RingServer </a>
      </span>
      <span class='note title constructor'>constructor</span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Advertises <code>ts</code> on the given <code>addresses</code> at
<code>port</code>.</p>
</div>
      </span>
    </li>
  </ul>
<h2>Instance Method Summary
  <small><a href='#' class='summary_toggle'>collapse</a></small>
</h2>

  <ul class='summary'>
    <li>
      <span class="summary_signature">
        <a href="#do_reply-instance_method" title="#do_reply (instance method)">#<strong>do_reply</strong>  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Pulls lookup tuples out of the TupleSpace and sends their DRb object the
address of the local TupleSpace.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#do_write-instance_method" title="#do_write (instance method)">#<strong>do_write</strong>(msg)  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Extracts the response URI from <code>msg</code> and adds it to TupleSpace
where it will be picked up by <code>reply_service</code> for notification.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#make_socket-instance_method" title="#make_socket (instance method)">#<strong>make_socket</strong>(address, interface_address = nil, multicast_interface = 0)  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a socket at <code>address</code></p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#reply_service-instance_method" title="#reply_service (instance method)">#<strong>reply_service</strong>  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Creates a thread that notifies waiting clients from the TupleSpace.</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#shutdown-instance_method" title="#shutdown (instance method)">#<strong>shutdown</strong>  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Shuts down the RingServer</p>
</div>
      </span>
    </li>
    <li>
      <span class="summary_signature">
        <a href="#write_services-instance_method" title="#write_services (instance method)">#<strong>write_services</strong>  </a>
      </span>
      

      <span class='summary_desc'>
        <div class='inline'>
<p>Creates threads that pick up UDP packets and passes them to do_write for
decoding.</p>
</div>
      </span>
    </li>
  </ul>


  <h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>
  <section class='method_details first' id="new-class_method">
  <h3 class='signature first'>
  .<strong>new</strong>(ts, addresses = [Socket::INADDR_ANY], port = Ring_PORT)  &#x21d2; <tt><a href="" title="Rinda::RingServer (class)">RingServer</a></tt> 
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Advertises <code>ts</code> on the given <code>addresses</code> at
<code>port</code>.</p>

<p>If <code>addresses</code> is omitted only the UDP broadcast address is
used.</p>

<p><code>addresses</code> can contain multiple addresses.  If a multicast
address is given in <code>addresses</code> then the RingServer will listen
for multicast queries.</p>

<p>If you use IPv4 multicast you may need to set an address of the inbound
interface which joins a multicast group.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>TupleSpace</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>RingServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>239.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>9.5.1.1</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>
</code></pre>

<p>You can set addresses as an Array Object.  The first element of the Array
is a multicast address and the second is an inbound interface address.  If
the second is omitted then &#39;0.0.0.0&#39; is used.</p>

<p>If you use IPv6 multicast you may need to set both the local interface
address and the inbound interface index:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_rs'>rs</span> <span class='op'>=</span> <span class='const'>Rinda</span><span class='op'>::</span><span class='const'>RingServer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ff02::1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rparen'>)</span>
</code></pre>

<p>The first element is a multicast address and the second is an inbound
interface address.  The third is an inbound interface index.</p>

<p>At this time there is no easy way to get an interface index by name.</p>

<p>If the second is omitted then &#39;::1&#39; is used. If the third is
omitted then 0 (default interface) is used.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_ts'>ts</span><span class='comma'>,</span> <span class='id identifier rubyid_addresses'>addresses</span><span class='op'>=</span><span class='lbracket'>[</span><span class='const'>Socket</span><span class='op'>::</span><span class='const'>INADDR_ANY</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='op'>=</span><span class='const'>Ring_PORT</span><span class='rparen'>)</span>
      <span class='ivar'>@port</span> <span class='op'>=</span> <span class='id identifier rubyid_port'>port</span>

      <span class='kw'>if</span> <span class='const'>Integer</span> <span class='op'>===</span> <span class='id identifier rubyid_addresses'>addresses</span> <span class='kw'>then</span>
        <span class='id identifier rubyid_addresses'>addresses</span><span class='comma'>,</span> <span class='ivar'>@port</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Socket</span><span class='op'>::</span><span class='const'>INADDR_ANY</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_addresses'>addresses</span>
      <span class='kw'>end</span>

      <span class='ivar'>@renewer</span> <span class='op'>=</span> <span class='const'>Renewer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

      <span class='ivar'>@ts</span> <span class='op'>=</span> <span class='id identifier rubyid_ts'>ts</span>
      <span class='ivar'>@sockets</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_addresses'>addresses</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_address'>address</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_address'>address</span>
          <span class='id identifier rubyid_make_socket'>make_socket</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_make_socket'>make_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_address'>address</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='ivar'>@w_services</span> <span class='op'>=</span> <span class='id identifier rubyid_write_services'>write_services</span>
      <span class='ivar'>@r_service</span>  <span class='op'>=</span> <span class='id identifier rubyid_reply_service'>reply_service</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section><h2 class='y_details'>Instance Method Details</h2>
  <section class='method_details first' id="do_reply-instance_method">
  <h3 class='signature first'>
  #<strong>do_reply</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Pulls lookup tuples out of the TupleSpace and sends their DRb object the
address of the local TupleSpace.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


214
215
216
217
218</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_reply'>do_reply</span>
      <span class='id identifier rubyid_tuple'>tuple</span> <span class='op'>=</span> <span class='ivar'>@ts</span><span class='period'>.</span><span class='id identifier rubyid_take'>take</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:lookup_ring</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@renewer</span><span class='rparen'>)</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_tuple'>tuple</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='ivar'>@ts</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='kw'>nil</span><span class='rbrace'>}</span>
    <span class='kw'>rescue</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="do_write-instance_method">
  <h3 class='signature'>
  #<strong>do_write</strong>(msg)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Extracts the response URI from <code>msg</code> and adds it to TupleSpace
where it will be picked up by <code>reply_service</code> for notification.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


189
190
191
192
193
194
195
196
197</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_write'>do_write</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_tuple'>tuple</span><span class='comma'>,</span> <span class='id identifier rubyid_sec'>sec</span> <span class='op'>=</span> <span class='const'>Marshal</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
          <span class='ivar'>@ts</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_tuple'>tuple</span><span class='comma'>,</span> <span class='id identifier rubyid_sec'>sec</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="make_socket-instance_method">
  <h3 class='signature'>
  #<strong>make_socket</strong>(address, interface_address = nil, multicast_interface = 0)  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a socket at <code>address</code></p>

<p>If <code>address</code> is multicast address then
<code>interface_address</code> and <code>multicast_interface</code> can be
set as optional.</p>

<p>A created socket is bound to <code>interface_address</code>.  If you use
IPv4 multicast then the interface of <code>interface_address</code> is used
as the inbound interface.  If <code>interface_address</code> is omitted or
nil then &#39;0.0.0.0&#39; or &#39;::1&#39; is used.</p>

<p>If you use IPv6 multicast then <code>multicast_interface</code> is used as
the inbound interface.  <code>multicast_interface</code> is a network
interface index. If <code>multicast_interface</code> is omitted then 0
(default interface) is used.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 132</span>

<span class='kw'>def</span> <span class='id identifier rubyid_make_socket'>make_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='id identifier rubyid_interface_address'>interface_address</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_multicast_interface'>multicast_interface</span><span class='op'>=</span><span class='int'>0</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_addrinfo'>addrinfo</span> <span class='op'>=</span> <span class='const'>Addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_udp'>udp</span><span class='lparen'>(</span><span class='id identifier rubyid_address'>address</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_pfamily'>pfamily</span><span class='comma'>,</span> <span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_socktype'>socktype</span><span class='comma'>,</span>
                          <span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_protocol'>protocol</span><span class='rparen'>)</span>
      <span class='ivar'>@sockets</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_socket'>socket</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_ipv4_multicast?'>ipv4_multicast?</span> <span class='kw'>or</span> <span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_ipv6_multicast?'>ipv6_multicast?</span> <span class='kw'>then</span>
        <span class='kw'>if</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='symbol'>:SO_REUSEPORT</span><span class='rparen'>)</span> <span class='kw'>then</span>
          <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:SO_REUSEPORT</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:SOCKET</span><span class='comma'>,</span> <span class='symbol'>:SO_REUSEADDR</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_ipv4_multicast?'>ipv4_multicast?</span> <span class='kw'>then</span>
          <span class='id identifier rubyid_interface_address'>interface_address</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_interface_address'>interface_address</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='const'>Addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_udp'>udp</span><span class='lparen'>(</span><span class='id identifier rubyid_interface_address'>interface_address</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='rparen'>)</span><span class='rparen'>)</span>

          <span class='id identifier rubyid_mreq'>mreq</span> <span class='op'>=</span> <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hton'>hton</span> <span class='op'>+</span>
            <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_interface_address'>interface_address</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hton'>hton</span>

          <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:IPPROTO_IP</span><span class='comma'>,</span> <span class='symbol'>:IP_ADD_MEMBERSHIP</span><span class='comma'>,</span> <span class='id identifier rubyid_mreq'>mreq</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_interface_address'>interface_address</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>::1</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_interface_address'>interface_address</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='const'>Addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_udp'>udp</span><span class='lparen'>(</span><span class='id identifier rubyid_interface_address'>interface_address</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='rparen'>)</span><span class='rparen'>)</span>

          <span class='id identifier rubyid_mreq'>mreq</span> <span class='op'>=</span> <span class='const'>IPAddr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='period'>.</span><span class='id identifier rubyid_ip_address'>ip_address</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_hton'>hton</span> <span class='op'>+</span>
            <span class='lbracket'>[</span><span class='id identifier rubyid_multicast_interface'>multicast_interface</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>I</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

          <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_setsockopt'>setsockopt</span><span class='lparen'>(</span><span class='symbol'>:IPPROTO_IPV6</span><span class='comma'>,</span> <span class='symbol'>:IPV6_JOIN_GROUP</span><span class='comma'>,</span> <span class='id identifier rubyid_mreq'>mreq</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='id identifier rubyid_addrinfo'>addrinfo</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_socket'>socket</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="reply_service-instance_method">
  <h3 class='signature'>
  #<strong>reply_service</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates a thread that notifies waiting clients from the TupleSpace.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


202
203
204
205
206
207
208</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reply_service'>reply_service</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
          <span class='id identifier rubyid_do_reply'>do_reply</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="shutdown-instance_method">
  <h3 class='signature'>
  #<strong>shutdown</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Shuts down the RingServer</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


223
224
225
226
227
228
229
230
231
232
233
234
235
236
237</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 223</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown'>shutdown</span>
      <span class='ivar'>@renewer</span><span class='period'>.</span><span class='id identifier rubyid_renew'>renew</span> <span class='op'>=</span> <span class='kw'>false</span>

      <span class='ivar'>@w_services</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_thread'>thread</span><span class='op'>|</span>
        <span class='id identifier rubyid_thread'>thread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>
        <span class='id identifier rubyid_thread'>thread</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
      <span class='kw'>end</span>

      <span class='ivar'>@sockets</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
        <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
      <span class='kw'>end</span>

      <span class='ivar'>@r_service</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>
      <span class='ivar'>@r_service</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section>  <section class='method_details' id="write_services-instance_method">
  <h3 class='signature'>
  #<strong>write_services</strong>  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Creates threads that pick up UDP packets and passes them to do_write for
decoding.</p>


  </div>
</div>
<div class="tags">
  
</div><div class='source_code h'>
  <pre class='lines_num'>


174
175
176
177
178
179
180
181
182
183</pre>
  <div class='lines_code'>
      <pre class='code'><span class='info file'># File 'rinda/ring.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_services'>write_services</span>
      <span class='ivar'>@sockets</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
        <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
          <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_recv'>recv</span><span class='lparen'>(</span><span class='int'>1024</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_do_write'>do_write</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span></pre>
  </div>
</div>
</section>
<div id='footer'>
  Generated by
  <a href='http://yardoc.org' title='Yay! A Ruby Documentation Tool' target="_parent">yard</a>
  0.8.7.6 with <a href='https://msp-greg.github.io/yard-t2/' title='yard-t2' target="_parent">yard-t2</a> 0.6.0 (ruby-2.3.2p135)
</div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</div> <!-- tbl_cont -->
</body>
</html>