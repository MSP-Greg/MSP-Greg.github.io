<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Rack::Lint::Wrapper &mdash; Rack main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Rack::Lint::Wrapper",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rack main</a> &raquo; 
      <a href='../../_index.html#alpha_W'>Index (W)</a> &raquo; 
        <a href="../../Rack.html" title="Rack (module)">Rack</a> &raquo; 
        <a href="../Lint.html" title="Rack::Lint (class)">Lint</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Wrapper&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Rack::Lint::Wrapper</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a class='nodoc' href="Wrapper/ErrorWrapper.html" title="Rack::Lint::Wrapper::ErrorWrapper (class)"><code>ErrorWrapper</code></a>,
        <a class='nodoc' href="Wrapper/InputWrapper.html" title="Rack::Lint::Wrapper::InputWrapper (class)"><code>InputWrapper</code></a>,
        <a class='nodoc' href="Wrapper/StreamWrapper.html" title="Rack::Lint::Wrapper::StreamWrapper (class)"><code>StreamWrapper</code></a>      </div>
    </td></tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L38'>lib/rack/lint.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='BODY_METHODS-constant' class='summary_signature nodoc'>BODY_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L818-L818'># File 'lib/rack/lint.rb', line 818</a>    <pre class='code ruby'>{<span class='label'>to_ary:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>each:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>call:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_path:</span> <span class='kw'>true</span>}</pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(app, env)  &#x21d2; Wrapper </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(stream)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Streaming Body.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_content_length-instance_method" title="#check_content_length (instance method)">#<strong>check_content_length</strong>(status, headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The content-length.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_content_type-instance_method" title="#check_content_type (instance method)">#<strong>check_content_type</strong>(status, headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The content-type.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_environment-instance_method" title="#check_environment (instance method)">#<strong>check_environment</strong>(env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Environment.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_error_stream-instance_method" title="#check_error_stream (instance method)">#<strong>check_error_stream</strong>(error)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Error Stream.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_header_value-instance_method" title="#check_header_value (instance method)">#<strong>check_header_value</strong>(key, value)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_headers-instance_method" title="#check_headers (instance method)">#<strong>check_headers</strong>(headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Headers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_hijack-instance_method" title="#check_hijack (instance method)">#<strong>check_hijack</strong>(env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Hijacking.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_hijack_response-instance_method" title="#check_hijack_response (instance method)">#<strong>check_hijack_response</strong>(headers, env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Partial Hijack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_input_stream-instance_method" title="#check_input_stream (instance method)">#<strong>check_input_stream</strong>(input)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Input Stream.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_status-instance_method" title="#check_status (instance method)">#<strong>check_status</strong>(status)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Body.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Enumerable Body.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#respond_to%3F-instance_method" title="#respond_to? (instance method)">#<strong>respond_to?</strong>(name)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#response-instance_method" title="#response (instance method)">#<strong>response</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_ary-instance_method" title="#to_ary (instance method)">#<strong>to_ary</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>If the Body responds to <code>to_ary</code>, it must return an <code>Array</code> whose contents are identical to that produced by calling <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_path-instance_method" title="#to_path (instance method)">#<strong>to_path</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#verify_content_length-instance_method" title="#verify_content_length (instance method)">#<strong>verify_content_length</strong>(size)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#verify_to_path-instance_method" title="#verify_to_path (instance method)">#<strong>verify_to_path</strong>  </a>
    </span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature nodoc first'>
    .<strong>new</strong>(app, env)  &#x21d2; <code>Wrapper</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L39-L52'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='39' data-end='52'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 39</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'>app</span>
  <span class='ivar'>@env</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>
  <span class='ivar'>@response</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@head_request</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@body</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@invoked</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@content_length</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@size</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="call-instance_method">
  <h3 class='signature nodoc first'>
    #<strong>call</strong>(stream)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Streaming+Body">Streaming Body</h4>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L853-L871'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='853' data-end='871'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 853</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_stream'>stream</span>)
  <span class='comment'>## The Streaming Body must respond to call.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Streaming Body must respond to call</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>)

  <span class='comment'>## It must only be called once.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body must only be invoked once (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@invoked</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@invoked</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'>## It must not be called after being closed.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body is already closed</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@closed</span>

  <span class='ivar'>@invoked</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>

  <span class='comment'>## It takes a stream argument.
</span>  <span class='comment'>##
</span>  <span class='comment'>## The stream argument must implement:
</span>  <span class='comment'>## &lt;tt&gt;read, write, &lt;&lt;, flush, close, close_read, close_write, closed?&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='ivar'>@body</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'><a href="Wrapper/StreamWrapper.html" title="Rack::Lint::Wrapper::StreamWrapper (class)">StreamWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/StreamWrapper.html#new-class_method" title="Rack::Lint::Wrapper::StreamWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_stream'>stream</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_content_length-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_content_length</strong>(status, headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+content-length">The content-length</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L691-L702'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='691' data-end='702'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 691</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_content_length'>check_content_length</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-length</span><span class='tstring_end'>&#39;</span></span>
      <span class='comment'>## There must not be a &lt;tt&gt;content-length&lt;/tt&gt; header key when the
</span>      <span class='comment'>## Status is 1xx, 204, or 304.
</span>      <span class='kw'>if</span> <span class='const'><a href="../../Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html" title="Rack::Utils (module)">Utils</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html#STATUS_WITH_NO_ENTITY_BODY-constant" title="Rack::Utils::STATUS_WITH_NO_ENTITY_BODY (constant)">STATUS_WITH_NO_ENTITY_BODY</a></span>.<span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-length header found in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'> response, not allowed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='ivar'>@content_length</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_content_type-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_content_type</strong>(status, headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+content-type">The content-type</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L675-L686'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='675' data-end='686'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 675</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_content_type'>check_content_type</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='comment'>## There must not be a &lt;tt&gt;content-type&lt;/tt&gt; header key when the Status is 1xx,
</span>    <span class='comment'>## 204, or 304.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-type</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='const'><a href="../../Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html" title="Rack::Utils (module)">Utils</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html#STATUS_WITH_NO_ENTITY_BODY-constant" title="Rack::Utils::STATUS_WITH_NO_ENTITY_BODY (constant)">STATUS_WITH_NO_ENTITY_BODY</a></span>.<span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-type header found in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'> response, not allowed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_environment-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_environment</strong>(env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Environment">The Environment</h4>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L94-L378'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='94' data-end='378'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 94</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_environment'>check_environment</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='comment'>## The environment must be an unfrozen instance of Hash that includes
</span>  <span class='comment'>## CGI-like headers. The Rack application is free to modify the
</span>  <span class='comment'>## environment.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not a Hash, but </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Hash</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env should not be frozen, but is</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>

  <span class='comment'>##
</span>  <span class='comment'>## The environment is required to include these variables
</span>  <span class='comment'>## (adopted from {PEP 333}[https://peps.python.org/pep-0333/]), except when they&#39;d be empty, but see
</span>  <span class='comment'>## below.
</span>
  <span class='comment'>## &lt;tt&gt;REQUEST_METHOD&lt;/tt&gt;:: The HTTP request method, such as
</span>  <span class='comment'>##                           &quot;GET&quot; or &quot;POST&quot;. This cannot ever
</span>  <span class='comment'>##                           be an empty string, and so is
</span>  <span class='comment'>##                           always required.
</span>
  <span class='comment'>## &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt;:: The initial portion of the request
</span>  <span class='comment'>##                        URL&#39;s &quot;path&quot; that corresponds to the
</span>  <span class='comment'>##                        application object, so that the
</span>  <span class='comment'>##                        application knows its virtual
</span>  <span class='comment'>##                        &quot;location&quot;. This may be an empty
</span>  <span class='comment'>##                        string, if the application corresponds
</span>  <span class='comment'>##                        to the &quot;root&quot; of the server.
</span>
  <span class='comment'>## &lt;tt&gt;PATH_INFO&lt;/tt&gt;:: The remainder of the request URL&#39;s
</span>  <span class='comment'>##                      &quot;path&quot;, designating the virtual
</span>  <span class='comment'>##                      &quot;location&quot; of the request&#39;s target
</span>  <span class='comment'>##                      within the application. This may be an
</span>  <span class='comment'>##                      empty string, if the request URL targets
</span>  <span class='comment'>##                      the application root and does not have a
</span>  <span class='comment'>##                      trailing slash. This value may be
</span>  <span class='comment'>##                      percent-encoded when originating from
</span>  <span class='comment'>##                      a URL.
</span>
  <span class='comment'>## &lt;tt&gt;QUERY_STRING&lt;/tt&gt;:: The portion of the request URL that
</span>  <span class='comment'>##                         follows the &lt;tt&gt;?&lt;/tt&gt;, if any. May be
</span>  <span class='comment'>##                         empty, but is always required!
</span>
  <span class='comment'>## &lt;tt&gt;SERVER_NAME&lt;/tt&gt;:: When combined with &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; and
</span>  <span class='comment'>##                        &lt;tt&gt;PATH_INFO&lt;/tt&gt;, these variables can be
</span>  <span class='comment'>##                        used to complete the URL. Note, however,
</span>  <span class='comment'>##                        that &lt;tt&gt;HTTP_HOST&lt;/tt&gt;, if present,
</span>  <span class='comment'>##                        should be used in preference to
</span>  <span class='comment'>##                        &lt;tt&gt;SERVER_NAME&lt;/tt&gt; for reconstructing
</span>  <span class='comment'>##                        the request URL.
</span>  <span class='comment'>##                        &lt;tt&gt;SERVER_NAME&lt;/tt&gt; can never be an empty
</span>  <span class='comment'>##                        string, and so is always required.
</span>
  <span class='comment'>## &lt;tt&gt;SERVER_PORT&lt;/tt&gt;:: An optional Integer which is the port the
</span>  <span class='comment'>##                        server is running on. Should be specified if
</span>  <span class='comment'>##                        the server is running on a non-standard port.
</span>
  <span class='comment'>## &lt;tt&gt;SERVER_PROTOCOL&lt;/tt&gt;:: A string representing the HTTP version used
</span>  <span class='comment'>##                            for the request.
</span>
  <span class='comment'>## &lt;tt&gt;HTTP_&lt;/tt&gt; Variables:: Variables corresponding to the
</span>  <span class='comment'>##                            client-supplied HTTP request
</span>  <span class='comment'>##                            headers (i.e., variables whose
</span>  <span class='comment'>##                            names begin with &lt;tt&gt;HTTP_&lt;/tt&gt;). The
</span>  <span class='comment'>##                            presence or absence of these
</span>  <span class='comment'>##                            variables should correspond with
</span>  <span class='comment'>##                            the presence or absence of the
</span>  <span class='comment'>##                            appropriate HTTP header in the
</span>  <span class='comment'>##                            request. See
</span>  <span class='comment'>##                            {RFC3875 section 4.1.18}[https://tools.ietf.org/html/rfc3875#section-4.1.18]
</span>  <span class='comment'>##                            for specific behavior.
</span>
  <span class='comment'>## In addition to this, the Rack environment must include these
</span>  <span class='comment'>## Rack-specific variables:
</span>
  <span class='comment'>## &lt;tt&gt;rack.url_scheme&lt;/tt&gt;:: http or https, depending on the
</span>  <span class='comment'>##                            request URL.
</span>
  <span class='comment'>## &lt;tt&gt;rack.input&lt;/tt&gt;:: See below, the input stream.
</span>
  <span class='comment'>## &lt;tt&gt;rack.errors&lt;/tt&gt;:: See below, the error stream.
</span>
  <span class='comment'>## &lt;tt&gt;rack.hijack?&lt;/tt&gt;:: See below, if present and true, indicates
</span>  <span class='comment'>##                         that the server supports partial hijacking.
</span>
  <span class='comment'>## &lt;tt&gt;rack.hijack&lt;/tt&gt;:: See below, if present, an object responding
</span>  <span class='comment'>##                        to call that is used to perform a full
</span>  <span class='comment'>##                        hijack.
</span>
  <span class='comment'>## Additional environment specifications have approved to
</span>  <span class='comment'>## standardized middleware APIs. None of these are required to
</span>  <span class='comment'>## be implemented by the server.
</span>
  <span class='comment'>## &lt;tt&gt;rack.session&lt;/tt&gt;:: A hash-like interface for storing
</span>  <span class='comment'>##                         request session data.
</span>  <span class='comment'>##                         The store must implement:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_SESSION-constant" title="Rack::RACK_SESSION (constant)">RACK_SESSION</a></span>]
    <span class='comment'>##                         store(key, value)         (aliased as []=);
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_store'>store</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='op'>[]=</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to store and []=</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         fetch(key, default = nil) (aliased as []);
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='op'>[]</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to fetch and []</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         delete(key);
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to delete</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         clear;
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_clear'>clear</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to clear</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         to_hash (returning unfrozen Hash instance);
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_to_hash'>to_hash</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_to_hash'>to_hash</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Hash</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_to_hash'>to_hash</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to to_hash and return unfrozen Hash instance</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>## &lt;tt&gt;rack.logger&lt;/tt&gt;:: A common object interface for logging messages.
</span>  <span class='comment'>##                        The object must implement:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_LOGGER-constant" title="Rack::RACK_LOGGER (constant)">RACK_LOGGER</a></span>]
    <span class='comment'>##                         info(message, &amp;block)
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_info'>info</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to info</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         debug(message, &amp;block)
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_debug'>debug</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to debug</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         warn(message, &amp;block)
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_warn'>warn</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to warn</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         error(message, &amp;block)
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_error'>error</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to error</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##                         fatal(message, &amp;block)
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fatal'>fatal</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to fatal</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>## &lt;tt&gt;rack.multipart.buffer_size&lt;/tt&gt;:: An Integer hint to the multipart parser as to what chunk size to use for reads and writes.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_bufsize'>bufsize</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_MULTIPART_BUFFER_SIZE-constant" title="Rack::RACK_MULTIPART_BUFFER_SIZE (constant)">RACK_MULTIPART_BUFFER_SIZE</a></span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_bufsize'>bufsize</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Integer</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_bufsize'>bufsize</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.multipart.buffer_size must be an Integer &gt; 0 if specified</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>## &lt;tt&gt;rack.multipart.tempfile_factory&lt;/tt&gt;:: An object responding to #call with two arguments, the filename and content_type given for the multipart form field, and returning an IO-like object that responds to #&lt;&lt; and optionally #rewind. This factory will be used to instantiate the tempfile for each multipart form file upload field, rather than the default class of Tempfile.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_tempfile_factory'>tempfile_factory</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_MULTIPART_TEMPFILE_FACTORY-constant" title="Rack::RACK_MULTIPART_TEMPFILE_FACTORY (constant)">RACK_MULTIPART_TEMPFILE_FACTORY</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.multipart.tempfile_factory must respond to #call</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_tempfile_factory'>tempfile_factory</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)
    <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_MULTIPART_TEMPFILE_FACTORY-constant" title="Rack::RACK_MULTIPART_TEMPFILE_FACTORY (constant)">RACK_MULTIPART_TEMPFILE_FACTORY</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span><span class='op'>|</span>
      <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_tempfile_factory'>tempfile_factory</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.multipart.tempfile_factory return value must respond to #&lt;&lt;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='op'>&lt;&lt;</span>)
      <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>## The server or the application can store their own data in the
</span>  <span class='comment'>## environment, too.  The keys must contain at least one dot,
</span>  <span class='comment'>## and should be prefixed uniquely.  The prefix &lt;tt&gt;rack.&lt;/tt&gt;
</span>  <span class='comment'>## is reserved for use with the Rack core distribution and other
</span>  <span class='comment'>## accepted specifications and must not be used otherwise.
</span>  <span class='comment'>##
</span>  <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>REQUEST_METHOD</span><span class='words_sep'> </span><span class='tstring_content'>SERVER_NAME</span><span class='words_sep'> </span><span class='tstring_content'>QUERY_STRING</span><span class='words_sep'> </span><span class='tstring_content'>SERVER_PROTOCOL</span><span class='words_sep'> </span><span class='tstring_content'>rack.errors</span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env missing required key </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_header'>header</span>
  <span class='kw'>end</span>

  <span class='comment'>## The &lt;tt&gt;SERVER_PORT&lt;/tt&gt; must be an Integer if set.
</span>  <span class='id identifier rubyid_server_port'>server_port</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SERVER_PORT</span><span class='tstring_end'>&quot;</span></span>]
  <span class='kw'>unless</span> <span class='id identifier rubyid_server_port'>server_port</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> (<span class='const'>Integer</span>(<span class='id identifier rubyid_server_port'>server_port</span>) <span class='kw'>rescue</span> <span class='kw'>false</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env[SERVER_PORT] is not an Integer</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## The &lt;tt&gt;SERVER_NAME&lt;/tt&gt; must be a valid authority as defined by RFC7540.
</span>  <span class='kw'>unless</span> (<span class='const'>URI</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SERVER_NAME-constant" title="Rack::SERVER_NAME (constant)">SERVER_NAME</a></span>]<span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>rescue</span> <span class='kw'>false</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SERVER_NAME-constant" title="Rack::SERVER_NAME (constant)">SERVER_NAME</a></span>]<span class='embexpr_end'>}</span><span class='tstring_content'> must be a valid authority</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## The &lt;tt&gt;HTTP_HOST&lt;/tt&gt; must be a valid authority as defined by RFC7540.
</span>  <span class='kw'>unless</span> (<span class='const'>URI</span>.<span class='id identifier rubyid_parse'>parse</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#HTTP_HOST-constant" title="Rack::HTTP_HOST (constant)">HTTP_HOST</a></span>]<span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>) <span class='kw'>rescue</span> <span class='kw'>false</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#HTTP_HOST-constant" title="Rack::HTTP_HOST (constant)">HTTP_HOST</a></span>]<span class='embexpr_end'>}</span><span class='tstring_content'> must be a valid authority</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## The &lt;tt&gt;SERVER_PROTOCOL&lt;/tt&gt; must match the regexp &lt;tt&gt;HTTP/\d(\.\d)?&lt;/tt&gt;.
</span>  <span class='id identifier rubyid_server_protocol'>server_protocol</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SERVER_PROTOCOL</span><span class='tstring_end'>&#39;</span></span>]
  <span class='kw'>unless</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>HTTP/\d(\.\d)?</span><span class='regexp_end'>}</span></span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='id identifier rubyid_server_protocol'>server_protocol</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env[SERVER_PROTOCOL] does not match HTTP/\\d(\\.\\d)?</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## The environment must not contain the keys
</span>  <span class='comment'>## &lt;tt&gt;HTTP_CONTENT_TYPE&lt;/tt&gt; or &lt;tt&gt;HTTP_CONTENT_LENGTH&lt;/tt&gt;
</span>  <span class='comment'>## (use the versions without &lt;tt&gt;HTTP_&lt;/tt&gt;).
</span>  <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>HTTP_CONTENT_TYPE</span><span class='words_sep'> </span><span class='tstring_content'>HTTP_CONTENT_LENGTH</span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_header'>header</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env contains </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span><span class='embexpr_end'>}</span><span class='tstring_content'>, must use </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span>[<span class='int'>5</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  }

  <span class='comment'>## The CGI keys (named without a period) must have String values.
</span>  <span class='comment'>## If the string values for CGI keys contain non-ASCII characters,
</span>  <span class='comment'>## they should use ASCII-8BIT encoding.
</span>  <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>next</span>  <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_include?'>include?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>   <span class='comment'># Skip extensions
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env variable </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> has non-string value </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>==</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_b'>b</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\x80-\xff]</span><span class='regexp_end'>/n</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env variable </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> has value containing non-ASCII characters and has non-ASCII-8BIT encoding </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> encoding: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_encoding'>encoding</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  }

  <span class='comment'>## There are the following restrictions:
</span>
  <span class='comment'>## * &lt;tt&gt;rack.url_scheme&lt;/tt&gt; must either be http or https.
</span>  <span class='kw'>unless</span> <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>http</span><span class='words_sep'> </span><span class='tstring_content'>https</span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_URL_SCHEME-constant" title="Rack::RACK_URL_SCHEME (constant)">RACK_URL_SCHEME</a></span>])
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.url_scheme unknown: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_URL_SCHEME-constant" title="Rack::RACK_URL_SCHEME (constant)">RACK_URL_SCHEME</a></span>].<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## * There may be a valid input stream in &lt;tt&gt;rack.input&lt;/tt&gt;.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_rack_input'>rack_input</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_INPUT-constant" title="Rack::RACK_INPUT (constant)">RACK_INPUT</a></span>]
    <span class='id identifier rubyid_check_input_stream'><a href="#check_input_stream-instance_method" title="Rack::Lint::Wrapper#check_input_stream (method)">check_input_stream</a></span>(<span class='id identifier rubyid_rack_input'>rack_input</span>)
    <span class='ivar'>@env</span>[<span class='const'><a href="../../Rack.html#RACK_INPUT-constant" title="Rack::RACK_INPUT (constant)">RACK_INPUT</a></span>] <span class='op'>=</span> <span class='const'><a href="Wrapper/InputWrapper.html" title="Rack::Lint::Wrapper::InputWrapper (class)">InputWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/InputWrapper.html#new-class_method" title="Rack::Lint::Wrapper::InputWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_rack_input'>rack_input</span>)
  <span class='kw'>end</span>

  <span class='comment'>## * There must be a valid error stream in &lt;tt&gt;rack.errors&lt;/tt&gt;.
</span>  <span class='id identifier rubyid_rack_errors'>rack_errors</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_ERRORS-constant" title="Rack::RACK_ERRORS (constant)">RACK_ERRORS</a></span>]
  <span class='id identifier rubyid_check_error_stream'><a href="#check_error_stream-instance_method" title="Rack::Lint::Wrapper#check_error_stream (method)">check_error_stream</a></span>(<span class='id identifier rubyid_rack_errors'>rack_errors</span>)
  <span class='ivar'>@env</span>[<span class='const'><a href="../../Rack.html#RACK_ERRORS-constant" title="Rack::RACK_ERRORS (constant)">RACK_ERRORS</a></span>] <span class='op'>=</span> <span class='const'><a href="Wrapper/ErrorWrapper.html" title="Rack::Lint::Wrapper::ErrorWrapper (class)">ErrorWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/ErrorWrapper.html#new-class_method" title="Rack::Lint::Wrapper::ErrorWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_rack_errors'>rack_errors</span>)

  <span class='comment'>## * There may be a valid hijack callback in &lt;tt&gt;rack.hijack&lt;/tt&gt;
</span>  <span class='id identifier rubyid_check_hijack'><a href="#check_hijack-instance_method" title="Rack::Lint::Wrapper#check_hijack (method)">check_hijack</a></span> <span class='id identifier rubyid_env'>env</span>

  <span class='comment'>## * The &lt;tt&gt;REQUEST_METHOD&lt;/tt&gt; must be a valid token.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#REQUEST_METHOD-constant" title="Rack::REQUEST_METHOD (constant)">REQUEST_METHOD</a></span>] <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A[0-9A-Za-z!\#$%&amp;&#39;*.^_`|~-]\z</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>REQUEST_METHOD unknown: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#REQUEST_METHOD-constant" title="Rack::REQUEST_METHOD (constant)">REQUEST_METHOD</a></span>].<span class='id identifier rubyid_dump'>dump</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## * The &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt;, if non-empty, must start with &lt;tt&gt;/&lt;/tt&gt;
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='const'><a href="../../Rack.html#SCRIPT_NAME-constant" title="Rack::SCRIPT_NAME (constant)">SCRIPT_NAME</a></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SCRIPT_NAME-constant" title="Rack::SCRIPT_NAME (constant)">SCRIPT_NAME</a></span>] <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SCRIPT_NAME-constant" title="Rack::SCRIPT_NAME (constant)">SCRIPT_NAME</a></span>] <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\/</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SCRIPT_NAME must start with /</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## * The &lt;tt&gt;PATH_INFO&lt;/tt&gt;, if non-empty (or the request is something other than &lt;tt&gt;OPTIONS *&lt;/tt&gt;), must start with &lt;tt&gt;/&lt;/tt&gt;
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='const'><a href="../../Rack.html#PATH_INFO-constant" title="Rack::PATH_INFO (constant)">PATH_INFO</a></span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span>(<span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#REQUEST_METHOD-constant" title="Rack::REQUEST_METHOD (constant)">REQUEST_METHOD</a></span>] <span class='op'>==</span> <span class='const'><a href="../../Rack.html#OPTIONS-constant" title="Rack::OPTIONS (constant)">OPTIONS</a></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#PATH_INFO-constant" title="Rack::PATH_INFO (constant)">PATH_INFO</a></span>] <span class='op'>==</span> <span class='CHAR'>?*</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#PATH_INFO-constant" title="Rack::PATH_INFO (constant)">PATH_INFO</a></span>] <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#PATH_INFO-constant" title="Rack::PATH_INFO (constant)">PATH_INFO</a></span>] <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\/</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PATH_INFO must start with /</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='comment'>## * The &lt;tt&gt;CONTENT_LENGTH&lt;/tt&gt;, if given, must consist of digits only.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONTENT_LENGTH</span><span class='tstring_end'>&quot;</span></span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONTENT_LENGTH</span><span class='tstring_end'>&quot;</span></span>] <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\d+\z</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid CONTENT_LENGTH: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONTENT_LENGTH</span><span class='tstring_end'>&quot;</span></span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## * One of &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; or &lt;tt&gt;PATH_INFO&lt;/tt&gt; must be
</span>  <span class='comment'>##   set. &lt;tt&gt;PATH_INFO&lt;/tt&gt; should be &lt;tt&gt;/&lt;/tt&gt; if
</span>  <span class='comment'>##   &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; is empty.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SCRIPT_NAME-constant" title="Rack::SCRIPT_NAME (constant)">SCRIPT_NAME</a></span>] <span class='op'>||</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#PATH_INFO-constant" title="Rack::PATH_INFO (constant)">PATH_INFO</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>One of SCRIPT_NAME or PATH_INFO must be set (make PATH_INFO &#39;/&#39; if SCRIPT_NAME is empty)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='comment'>##   &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; never should be &lt;tt&gt;/&lt;/tt&gt;, but instead be empty.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SCRIPT_NAME-constant" title="Rack::SCRIPT_NAME (constant)">SCRIPT_NAME</a></span>] <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SCRIPT_NAME cannot be &#39;/&#39;, make it &#39;&#39; and PATH_INFO &#39;/&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## &lt;tt&gt;rack.response_finished&lt;/tt&gt;:: An array of callables run by the server after the response has been
</span>  <span class='comment'>## processed. This would typically be invoked after sending the response to the client, but it could also be
</span>  <span class='comment'>## invoked if an error occurs while generating the response or sending the response; in that case, the error
</span>  <span class='comment'>## argument will be a subclass of Exception.
</span>  <span class='comment'>## The callables are invoked with +env, status, headers, error+ arguments and should not raise any
</span>  <span class='comment'>## exceptions. They should be invoked in reverse order of registration.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_callables'>callables</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_RESPONSE_FINISHED-constant" title="Rack::RACK_RESPONSE_FINISHED (constant)">RACK_RESPONSE_FINISHED</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.response_finished must be an array of callable objects</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_callables'>callables</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Array</span>)

    <span class='id identifier rubyid_callables'>callables</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_callable'>callable</span><span class='op'>|</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.response_finished values must respond to call(env, status, headers, error)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_callable'>callable</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_error_stream-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_error_stream</strong>(error)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Error+Stream">The Error Stream</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L489-L496'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='489' data-end='496'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 489</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_error_stream'>check_error_stream</span>(<span class='id identifier rubyid_error'>error</span>)
  <span class='comment'>## The error stream must respond to puts, write and flush.
</span>  [<span class='symbeg'>:</span><span class='id identifier rubyid_puts'>puts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_flush'>flush</span>].<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span> <span class='id identifier rubyid_method'>method</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.error </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not respond to #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_header_value-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_header_value</strong>(key, value)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L665-L670'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='665' data-end='670'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 665</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_header_value'>check_header_value</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
  <span class='comment'>## such that each String instance must not contain characters below 037.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\000-\037]</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid header value </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_headers-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_headers</strong>(headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Headers">The Headers</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L625-L663'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='625' data-end='663'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 625</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_headers'>check_headers</span>(<span class='id identifier rubyid_headers'>headers</span>)
  <span class='comment'>## The headers must be a unfrozen Hash.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Hash</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>headers object should be a hash, but isn&#39;t (got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> as headers)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>headers object should not be frozen, but is</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='comment'>## The header keys must be Strings.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>header key must be a string, was </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## Special headers starting &quot;rack.&quot; are for communicating with the
</span>    <span class='comment'>## server, and must not be sent back to the client.
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.</span><span class='tstring_end'>&quot;</span></span>)

    <span class='comment'>## The header must not contain a Status key.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>header must not contain status</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>status</span><span class='tstring_end'>&quot;</span></span>
    <span class='comment'>## Header keys must conform to RFC7230 token specification, i.e. cannot
</span>    <span class='comment'>## contain non-printable ASCII, DQUOTE or &quot;(),/:;&lt;=&gt;?@[\]{}&quot;.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid header name: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\(\),\/:;&lt;=&gt;\?@\[\\\]{}[:cntrl:]]</span><span class='regexp_end'>/</span></span>
    <span class='comment'>## Header keys must not contain uppercase ASCII characters (A-Z).
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uppercase character in header name: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[A-Z]</span><span class='regexp_end'>/</span></span>

    <span class='comment'>## Header values must be either a String instance,
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>String</span>)
      <span class='id identifier rubyid_check_header_value'><a href="#check_header_value-instance_method" title="Rack::Lint::Wrapper#check_header_value (method)">check_header_value</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Array</span>)
      <span class='comment'>## or an Array of String instances,
</span>      <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span>{<span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_check_header_value'><a href="#check_header_value-instance_method" title="Rack::Lint::Wrapper#check_header_value (method)">check_header_value</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)}
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a header value must be a String or Array of Strings, but the value of &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; is a </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_hijack-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_hijack</strong>(env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Hijacking">Hijacking</h4>

<p>The hijacking interfaces provides a means for an application to take control of the HTTP connection. There are two distinct hijack interfaces: full hijacking where the application takes over the raw connection, and partial hijacking where the application takes over just the response body stream. In both cases, the application is responsible for closing the hijacked stream.</p>

<p>Full hijacking only works with HTTP/1. Partial hijacking is functionally equivalent to streaming bodies, and is still optionally supported for backwards compatibility with older <a href="../../Rack.html" title="Rack (module)"><code>::Rack</code></a> versions.</p>

<h5 id="label-Full+Hijack">Full Hijack</h5>

<p>Full hijack is used to completely take over an HTTP/1 connection. It occurs before any headers are written and causes the request to ignores any response generated by the application.</p>

<p>It is intended to be used when applications need access to raw HTTP/1 connection.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L549-L565'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='549' data-end='565'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 549</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_hijack'>check_hijack</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='comment'>## If rack.hijack is present in env, it must respond to call
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.hijack must respond to call</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)

    <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>

      <span class='comment'>## and return an IO instance which can be used to read and write
</span>      <span class='comment'>## to the underlying connection using HTTP/1 semantics and
</span>      <span class='comment'>## formatting.
</span>      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.hijack must return an IO instance</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>IO</span>)

      <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_hijack_response-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_hijack_response</strong>(headers, env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Partial+Hijack">Partial Hijack</h4>

<p>Partial hijack is used for bi-directional streaming of the request and response body. It occurs after the status and headers are written by the server and causes the server to ignore the Body of the response.</p>

<p>It is intended to be used when applications need bi-directional streaming.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L577-L608'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='577' data-end='608'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 577</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_hijack_response'>check_hijack_response</span>(<span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
  <span class='comment'>## If rack.hijack? is present in env and truthy,
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_IS_HIJACK-constant" title="Rack::RACK_IS_HIJACK (constant)">RACK_IS_HIJACK</a></span>]
    <span class='comment'>## an application may set the special response header rack.hijack
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>]
      <span class='comment'>## to an object that responds to call,
</span>      <span class='kw'>unless</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.hijack header must respond to #call</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='comment'>## accepting a stream argument.
</span>      <span class='kw'>return</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
        <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span> <span class='const'><a href="Wrapper/StreamWrapper.html" title="Rack::Lint::Wrapper::StreamWrapper (class)">StreamWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/StreamWrapper.html#new-class_method" title="Rack::Lint::Wrapper::StreamWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_io'>io</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'>##
</span>    <span class='comment'>## After the response status and headers have been sent, this hijack
</span>    <span class='comment'>## callback will be invoked with a stream argument which follows the
</span>    <span class='comment'>## same interface as outlined in &quot;Streaming Body&quot;. Servers must
</span>    <span class='comment'>## ignore the body part of the response tuple when the
</span>    <span class='comment'>## rack.hijack response header is present. Using an empty Array
</span>    <span class='comment'>## instance is recommended.
</span>  <span class='kw'>else</span>
    <span class='comment'>##
</span>    <span class='comment'>## The special response header rack.hijack must only be set
</span>    <span class='comment'>## if the request env has a truthy rack.hijack?.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.hijack header must not be present if server does not support hijacking</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_input_stream-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_input_stream</strong>(input)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Input+Stream">The Input Stream</h4>

<p>The input stream is an IO-like object which contains the raw HTTP <a href="../../Rack.html#POST-constant" title="Rack::POST (constant)">POST</a> data.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L385-L401'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='385' data-end='401'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 385</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_input_stream'>check_input_stream</span>(<span class='id identifier rubyid_input'>input</span>)
  <span class='comment'>## When applicable, its external encoding must be &quot;ASCII-8BIT&quot; and it
</span>  <span class='comment'>## must be opened in binary mode, for Ruby 1.9 compatibility.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_external_encoding'>external_encoding</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_external_encoding'>external_encoding</span> <span class='op'>!=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.input </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_input'>input</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not have ASCII-8BIT as its external encoding</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_binmode?'>binmode?</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_binmode?'>binmode?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.input </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_input'>input</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not opened in binary mode</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## The input stream must respond to gets, each, and read.
</span>  [<span class='symbeg'>:</span><span class='id identifier rubyid_gets'>gets</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>].<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> { <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span> <span class='id identifier rubyid_method'>method</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.input </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_input'>input</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not respond to #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  }
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_status-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_status</strong>(status)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Response">The Response</h4>

<h5 id="label-The+Status">The Status</h5>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L614-L620'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='614' data-end='620'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 614</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_status'>check_status</span>(<span class='id identifier rubyid_status'>status</span>)
  <span class='comment'>## This is an HTTP status. It must be an Integer greater than or equal to
</span>  <span class='comment'>## 100.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Integer</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>&gt;=</span> <span class='int'>100</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Status must be an Integer &gt;=100</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature nodoc'>
    #<strong>close</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Body">The Body</h4>

<p>The Body is typically an <code>Array</code> of <code>String</code> instances, an enumerable that yields <code>String</code> instances, a <code>Proc</code> instance, or a File-like object.</p>

<p>The Body must respond to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> or <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>. It may optionally respond to <a href="#to_path-instance_method" title="Rack::Lint::Wrapper#to_path (method)">#to_path</a> or <a href="#to_ary-instance_method" title="Rack::Lint::Wrapper#to_ary (method)">#to_ary</a>. A Body that responds to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> is considered to be an Enumerable Body. A Body that responds to <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a> is considered to be a Streaming Body.</p>

<p>A Body that responds to both <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> and <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a> must be treated as an Enumerable Body, not a Streaming Body. If it responds to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>, you must call <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> and not <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>. If the Body doesn’t respond to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>, then you can assume it responds to <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>.</p>

<p>The Body must either be consumed or returned. The Body is consumed by optionally calling either <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> or <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>. Then, if the Body responds to <code>close</code>, it must be called to release any resources associated with the generation of the body. In other words, <code>close</code> must always be called at least once; typically after the web server has sent the response to the client, but also in cases where the <a href="../../Rack.html" title="Rack (module)"><code>::Rack</code></a> application makes internal/virtual requests and discards the response.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L742-L756'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='742' data-end='756'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 742</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='comment'>##
</span>  <span class='comment'>## After calling close, the Body is considered closed and should not
</span>  <span class='comment'>## be consumed again.
</span>  <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'>## If the original Body is replaced by a new Body, the new Body must
</span>  <span class='comment'>## also consume the original Body by calling close if possible.
</span>  <span class='ivar'>@body</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>)

  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='ivar'>@lint</span>.<span class='id identifier rubyid_index'>index</span>(<span class='kw'>self</span>)
  <span class='kw'>unless</span> <span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint</span><span class='tstring_end'>&#39;</span></span>][<span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_index'>index</span>].<span class='id identifier rubyid_all?'>all?</span> {<span class='op'>|</span><span class='id identifier rubyid_lint'>lint</span><span class='op'>|</span> <span class='id identifier rubyid_lint'>lint</span>.<span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span>(<span class='symbeg'>:</span><span class='ivar'>@closed</span>)}
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Body has not been closed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each-instance_method">
  <h3 class='signature nodoc'>
    #<strong>each</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Enumerable+Body">Enumerable Body</h4>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L776-L816'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='776' data-end='816'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 776</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
  <span class='comment'>## The Enumerable Body must respond to each.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enumerable Body must respond to each</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_each'>each</span>)

  <span class='comment'>## It must only be called once.
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body must only be invoked once (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@invoked</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@invoked</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'>## It must not be called after being closed,
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body is already closed</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@closed</span>

  <span class='ivar'>@invoked</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_each'>each</span>

  <span class='ivar'>@body</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_chunk'>chunk</span><span class='op'>|</span>
    <span class='comment'>## and must only yield String values.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_chunk'>chunk</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Body yielded non-string value </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_chunk'>chunk</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##
</span>    <span class='comment'>## The Body itself should not be an instance of String, as this will
</span>    <span class='comment'>## break in Ruby 1.9.
</span>    <span class='comment'>##
</span>    <span class='comment'>## Middleware must not call each directly on the Body.
</span>    <span class='comment'>## Instead, middleware can return a new Body that calls each on the
</span>    <span class='comment'>## original Body, yielding at least once per iteration.
</span>    <span class='kw'>if</span> <span class='ivar'>@lint</span>[<span class='int'>0</span>] <span class='op'>==</span> <span class='kw'>self</span>
      <span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint.body_iteration</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> (<span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint.body_iteration</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>-=</span> <span class='int'>1</span>) <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New body must yield at least once per iteration of old body</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='ivar'>@size</span> <span class='op'>+=</span> <span class='id identifier rubyid_chunk'>chunk</span>.<span class='id identifier rubyid_bytesize'>bytesize</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_chunk'>chunk</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_verify_content_length'><a href="#verify_content_length-instance_method" title="Rack::Lint::Wrapper#verify_content_length (method)">verify_content_length</a></span>(<span class='ivar'>@size</span>)

  <span class='id identifier rubyid_verify_to_path'><a href="#verify_to_path-instance_method" title="Rack::Lint::Wrapper#verify_to_path (method)">verify_to_path</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="respond_to?-instance_method">
  <h3 class='signature nodoc'>
    #<strong>respond_to?</strong>(name)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L824-L830'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='824' data-end='830'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 824</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span>)
  <span class='kw'>if</span> <span class='const'><a href="#BODY_METHODS-constant" title="Rack::Lint::Wrapper::BODY_METHODS (constant)">BODY_METHODS</a></span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="response-instance_method">
  <h3 class='signature nodoc'>
    #<strong>response</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L54-L89'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='54' data-end='89'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 54</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_response'>response</span>
  <span class='comment'>## It takes exactly one argument, the *environment*
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No env given</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@env</span>
  <span class='id identifier rubyid_check_environment'><a href="#check_environment-instance_method" title="Rack::Lint::Wrapper#check_environment (method)">check_environment</a></span>(<span class='ivar'>@env</span>)

  <span class='comment'>## and returns a non-frozen Array of exactly three values:
</span>  <span class='ivar'>@response</span> <span class='op'>=</span> <span class='ivar'>@app</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>(<span class='ivar'>@env</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response is not an Array, but </span><span class='embexpr_beg'>#{</span><span class='ivar'>@response</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@response</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response is frozen</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@response</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response array has </span><span class='embexpr_beg'>#{</span><span class='ivar'>@response</span>.<span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> elements instead of 3</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@response</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>3</span>

  <span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span><span class='comma'>,</span> <span class='ivar'>@body</span> <span class='op'>=</span> <span class='ivar'>@response</span>
  <span class='comment'>## The *status*,
</span>  <span class='id identifier rubyid_check_status'><a href="#check_status-instance_method" title="Rack::Lint::Wrapper#check_status (method)">check_status</a></span>(<span class='ivar'>@status</span>)

  <span class='comment'>## the *headers*,
</span>  <span class='id identifier rubyid_check_headers'><a href="#check_headers-instance_method" title="Rack::Lint::Wrapper#check_headers (method)">check_headers</a></span>(<span class='ivar'>@headers</span>)

  <span class='id identifier rubyid_hijack_proc'>hijack_proc</span> <span class='op'>=</span> <span class='id identifier rubyid_check_hijack_response'><a href="#check_hijack_response-instance_method" title="Rack::Lint::Wrapper#check_hijack_response (method)">check_hijack_response</a></span>(<span class='ivar'>@headers</span><span class='comma'>,</span> <span class='ivar'>@env</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_hijack_proc'>hijack_proc</span>
    <span class='ivar'>@headers</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_hijack_proc'>hijack_proc</span>
  <span class='kw'>end</span>

  <span class='comment'>## and the *body*.
</span>  <span class='id identifier rubyid_check_content_type'><a href="#check_content_type-instance_method" title="Rack::Lint::Wrapper#check_content_type (method)">check_content_type</a></span>(<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span>)
  <span class='id identifier rubyid_check_content_length'><a href="#check_content_length-instance_method" title="Rack::Lint::Wrapper#check_content_length (method)">check_content_length</a></span>(<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span>)
  <span class='ivar'>@head_request</span> <span class='op'>=</span> <span class='ivar'>@env</span>[<span class='const'><a href="../../Rack.html#REQUEST_METHOD-constant" title="Rack::REQUEST_METHOD (constant)">REQUEST_METHOD</a></span>] <span class='op'>==</span> <span class='const'><a href="../../Rack.html#HEAD-constant" title="Rack::HEAD (constant)">HEAD</a></span>

  <span class='ivar'>@lint</span> <span class='op'>=</span> (<span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> []) <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>

  <span class='kw'>if</span> (<span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint.body_iteration</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> <span class='int'>0</span>) <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Middleware must not call #each directly</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> [<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span><span class='comma'>,</span> <span class='kw'>self</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_ary-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_ary</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the Body responds to <code>to_ary</code>, it must return an <code>Array</code> whose contents are identical to that produced by calling <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>. Middleware may call <code>to_ary</code> directly on the Body and return a new Body in its place. In other words, middleware can only process the Body directly if it responds to <code>to_ary</code>. If the Body responds to both <code>to_ary</code> and <a href="#close-instance_method" title="Rack::Lint::Wrapper#close (method)">#close</a>, its implementation of <code>to_ary</code> must call <a href="#close-instance_method" title="Rack::Lint::Wrapper#close (method)">#close</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L840-L848'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='840' data-end='848'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 840</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_ary'>to_ary</span>
  <span class='ivar'>@body</span>.<span class='id identifier rubyid_to_ary'>to_ary</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_content'>content</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_content'>content</span> <span class='op'>==</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_enum_for'>enum_for</span>.<span class='id identifier rubyid_to_a'>to_a</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#to_ary not identical to contents produced by calling #each</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_close'><a href="#close-instance_method" title="Rack::Lint::Wrapper#close (method)">close</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_path-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_path</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L820-L822'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='820' data-end='822'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 820</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_path'>to_path</span>
  <span class='ivar'>@body</span>.<span class='id identifier rubyid_to_path'>to_path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_content_length-instance_method">
  <h3 class='signature nodoc'>
    #<strong>verify_content_length</strong>(size)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L704-L714'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='704' data-end='714'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 704</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_content_length'>verify_content_length</span>(<span class='id identifier rubyid_size'>size</span>)
  <span class='kw'>if</span> <span class='ivar'>@head_request</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body was given for HEAD request, but should be empty</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='ivar'>@content_length</span>
    <span class='kw'>unless</span> <span class='ivar'>@content_length</span> <span class='op'>==</span> <span class='id identifier rubyid_size'>size</span>.<span class='id identifier rubyid_to_s'>to_s</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-length header was </span><span class='embexpr_beg'>#{</span><span class='ivar'>@content_length</span><span class='embexpr_end'>}</span><span class='tstring_content'>, but should be </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_to_path-instance_method">
  <h3 class='signature nodoc'>
    #<strong>verify_to_path</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L758-L771'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='758' data-end='771'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 758</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_to_path'>verify_to_path</span>
  <span class='comment'>##
</span>  <span class='comment'>## If the Body responds to to_path, it must return a String
</span>  <span class='comment'>## path for the local file system whose contents are identical
</span>  <span class='comment'>## to that produced by calling each; this may be used by the
</span>  <span class='comment'>## server as an alternative, possibly more efficient way to
</span>  <span class='comment'>## transport the response. The to_path method does not consume
</span>  <span class='comment'>## the body.
</span>  <span class='kw'>if</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_to_path'><a href="#to_path-instance_method" title="Rack::Lint::Wrapper#to_path (method)">to_path</a></span>)
    <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_to_path'><a href="#to_path-instance_method" title="Rack::Lint::Wrapper#to_path (method)">to_path</a></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The file identified by body.to_path does not exist</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>