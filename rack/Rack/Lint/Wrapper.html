<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Class: Rack::Lint::Wrapper &mdash; Rack main</title>

<link rel='stylesheet'  type='text/css' href='../../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Rack::Lint::Wrapper",
    relpath = '../../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../../'>Rack main</a> &raquo; 
      <a href='../../_index.html#alpha_W'>Index (W)</a> &raquo; 
        <a href="../../Rack.html" title="Rack (module)">Rack</a> &raquo; 
        <a href="../Lint.html" title="Rack::Lint (class)">Lint</a> &raquo; 
      <span class='title'><a class='nodoc' id='t2_doc_top' href='#'>Wrapper&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='class'>
<h1>Class: Rack::Lint::Wrapper</h1>
  <div class='note nodoc inline-block'>
    <strong>Do not use.  This class is for internal use only.</strong>
  </div>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a class='nodoc' href="Wrapper/ErrorWrapper.html" title="Rack::Lint::Wrapper::ErrorWrapper (class)"><code>ErrorWrapper</code></a>,
        <a class='nodoc' href="Wrapper/InputWrapper.html" title="Rack::Lint::Wrapper::InputWrapper (class)"><code>InputWrapper</code></a>,
        <a class='nodoc' href="Wrapper/ResponseFinishedWrapper.html" title="Rack::Lint::Wrapper::ResponseFinishedWrapper (class)"><code>ResponseFinishedWrapper</code></a>,
        <a class='nodoc' href="Wrapper/StreamWrapper.html" title="Rack::Lint::Wrapper::StreamWrapper (class)"><code>StreamWrapper</code></a>      </div>
    </td></tr>
    <tr>
      <td id='t2_inherits' class='box_2'>Inherits:</td>
      <td class='box_rel'>
        <span class='inheritName'>Object</span>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L71'>lib/rack/lint.rb</a>      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='t2_cnst' class='h2_sum'>Constant Summary</h2>
<div>
<ul class='constants summary full nodoc'>
  <li>
    <span id='BODY_METHODS-constant' class='summary_signature nodoc'>BODY_METHODS =</span>
    <br/>
    <a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L925-L925'># File 'lib/rack/lint.rb', line 925</a>    <pre class='code ruby'>{<span class='label'>to_ary:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>each:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>call:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>to_path:</span> <span class='kw'>true</span>}</pre>
  </li>
</ul>
</div>

<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#new-class_method" title=".new (class method)">.<strong>new</strong>(app, env)  &#x21d2; Wrapper </a>
    </span>
    <span class='note title constructor'>constructor</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_method_summary'>Instance Method Summary</h2>
<div class='div_sum'>
<ul class='summary full nodoc'>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>(stream)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Streaming Body.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_content_length_header-instance_method" title="#check_content_length_header (instance method)">#<strong>check_content_length_header</strong>(status, headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The <code>content-length</code> Header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_content_type_header-instance_method" title="#check_content_type_header (instance method)">#<strong>check_content_type_header</strong>(status, headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The <code>content-type</code> Header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_early_hints-instance_method" title="#check_early_hints (instance method)">#<strong>check_early_hints</strong>(env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Early Hints.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_environment-instance_method" title="#check_environment (instance method)">#<strong>check_environment</strong>(env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Request Environment.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_error_stream-instance_method" title="#check_error_stream (instance method)">#<strong>check_error_stream</strong>(error)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Error Stream.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_header_value-instance_method" title="#check_header_value (instance method)">#<strong>check_header_value</strong>(key, value)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_headers-instance_method" title="#check_headers (instance method)">#<strong>check_headers</strong>(headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Headers.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_hijack-instance_method" title="#check_hijack (instance method)">#<strong>check_hijack</strong>(env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Hijacking.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_hijack_response-instance_method" title="#check_hijack_response (instance method)">#<strong>check_hijack_response</strong>(headers, env)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Partial Hijack.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_input_stream-instance_method" title="#check_input_stream (instance method)">#<strong>check_input_stream</strong>(input)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Input Stream.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_rack_protocol_header-instance_method" title="#check_rack_protocol_header (instance method)">#<strong>check_rack_protocol_header</strong>(status, headers)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The <code>rack.protocol</code> Header.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#check_status-instance_method" title="#check_status (instance method)">#<strong>check_status</strong>(status)  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>The Response.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Setting this value informs the server that it should perform a connection upgrade.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Enumerable Body.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#respond_to%3F-instance_method" title="#respond_to? (instance method)">#<strong>respond_to?</strong>(name)  &#x21d2; Boolean </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#response-instance_method" title="#response (instance method)">#<strong>response</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_ary-instance_method" title="#to_ary (instance method)">#<strong>to_ary</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>If the Body responds to <a href="#to_ary-instance_method" title="Rack::Lint::Wrapper#to_ary (method)">#to_ary</a>, it must return an <code>Array</code> whose contents are identical to that produced by calling <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#to_path-instance_method" title="#to_path (instance method)">#<strong>to_path</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#verify_content_length-instance_method" title="#verify_content_length (instance method)">#<strong>verify_content_length</strong>(size)  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#verify_to_path-instance_method" title="#verify_to_path (instance method)">#<strong>verify_to_path</strong>  </a>
    </span>
  </li>
  <li>
    <span class='summary_signature priv nodoc'>
      <a href="#assert_required-instance_method" title="#assert_required (instance method)">#<strong>assert_required</strong>(key)  </a>
    </span>
    <span class='note title private'>private</span>
  </li>
</ul>
</div>  <!-- instance_method_summary -->
<h2 id='Constructor_Details' class='y_details'>Constructor Details</h2>

  <section class='method_details first' id="new-class_method">
  <h3 class='signature nodoc first'>
    .<strong>new</strong>(app, env)  &#x21d2; <code>Wrapper</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L72-L85'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='72' data-end='85'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 72</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>(<span class='id identifier rubyid_app'>app</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
  <span class='ivar'>@app</span> <span class='op'>=</span> <span class='id identifier rubyid_app'>app</span>
  <span class='ivar'>@env</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>
  <span class='ivar'>@response</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@head_request</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@body</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@consumed</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@content_length</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@size</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<h2 class='y_details'>Instance Method Details</h2>
<section class='method_details first' id="assert_required-instance_method">
  <h3 class='signature priv  nodoc first'>
    #<strong>assert_required</strong>(key)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L126-L130'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='126' data-end='130'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 126</span></pre>
<pre class='code ruby'>

<span class='id identifier rubyid_private'>private</span> <span class='kw'>def</span> <span class='id identifier rubyid_assert_required'>assert_required</span>(<span class='id identifier rubyid_key'>key</span>)
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env missing required key </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@env</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_key'>key</span>)

  <span class='kw'>return</span> <span class='ivar'>@env</span>[<span class='id identifier rubyid_key'>key</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="call-instance_method">
  <h3 class='signature nodoc'>
    #<strong>call</strong>(stream)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Streaming+Body">Streaming Body</h4>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L954-L970'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='954' data-end='970'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 954</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span>(<span class='id identifier rubyid_stream'>stream</span>)
  <span class='comment'>## The Streaming Body must respond to call, \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Streaming Body must respond to call</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>)

  <span class='comment'>## which must only be called once, \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body must only be called once (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@consumed</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@consumed</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'>## must not be called after being closed, \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body is already closed</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@closed</span>

  <span class='ivar'>@consumed</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_call'>call</span>

  <span class='comment'>## and accept a stream argument.
</span>  <span class='comment'>##
</span>  <span class='comment'>## The stream argument must respond to: read, write, &lt;tt&gt;&lt;&lt;&lt;/tt&gt;, flush, close, close_read, close_write, and closed?. \
</span>  <span class='ivar'>@body</span>.<span class='id identifier rubyid_call'>call</span>(<span class='const'><a href="Wrapper/StreamWrapper.html" title="Rack::Lint::Wrapper::StreamWrapper (class)">StreamWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/StreamWrapper.html#new-class_method" title="Rack::Lint::Wrapper::StreamWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_stream'>stream</span>))
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_content_length_header-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_content_length_header</strong>(status, headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+content-length+Header">The <code>content-length</code> Header</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L804-L814'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='804' data-end='814'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 804</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_content_length_header'>check_content_length_header</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>content-length</span><span class='tstring_end'>&#39;</span></span>
      <span class='comment'>## There must not be a &lt;tt&gt;content-length&lt;/tt&gt; header key when the status is &lt;tt&gt;1xx&lt;/tt&gt;, &lt;tt&gt;204&lt;/tt&gt;, or &lt;tt&gt;304&lt;/tt&gt;.
</span>      <span class='kw'>if</span> <span class='const'><a href="../../Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html" title="Rack::Utils (module)">Utils</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html#STATUS_WITH_NO_ENTITY_BODY-constant" title="Rack::Utils::STATUS_WITH_NO_ENTITY_BODY (constant)">STATUS_WITH_NO_ENTITY_BODY</a></span>.<span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-length header found in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'> response, not allowed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='ivar'>@content_length</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_content_type_header-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_content_type_header</strong>(status, headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+content-type+Header">The <code>content-type</code> Header</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L789-L799'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='789' data-end='799'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 789</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_content_type_header'>check_content_type_header</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='comment'>## There must not be a &lt;tt&gt;content-type&lt;/tt&gt; header key when the status is &lt;tt&gt;1xx&lt;/tt&gt;, &lt;tt&gt;204&lt;/tt&gt;, or &lt;tt&gt;304&lt;/tt&gt;.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-type</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='const'><a href="../../Rack.html" title="Rack (module)">Rack</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html" title="Rack::Utils (module)">Utils</a></span><span class='op'>::</span><span class='const'><a href="../Utils.html#STATUS_WITH_NO_ENTITY_BODY-constant" title="Rack::Utils::STATUS_WITH_NO_ENTITY_BODY (constant)">STATUS_WITH_NO_ENTITY_BODY</a></span>.<span class='id identifier rubyid_key?'>key?</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_to_i'>to_i</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-type header found in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_status'>status</span><span class='embexpr_end'>}</span><span class='tstring_content'> response, not allowed</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_early_hints-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_early_hints</strong>(env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Early+Hints">Early Hints</h4>

<p>The application or any middleware may call the <code>rack.early_hints</code> with an object which would be valid as the headers of a <a href="../../Rack.html" title="Rack (module)"><code>::Rack</code></a> response.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L706-L721'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='706' data-end='721'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 706</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_early_hints'>check_early_hints</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_EARLY_HINTS-constant" title="Rack::RACK_EARLY_HINTS (constant)">RACK_EARLY_HINTS</a></span>]
    <span class='comment'>##
</span>    <span class='comment'>## If &lt;tt&gt;rack.early_hints&lt;/tt&gt; is present, it must respond to call.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_EARLY_HINTS-constant" title="Rack::RACK_EARLY_HINTS (constant)">RACK_EARLY_HINTS</a></span>].<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.early_hints must respond to call</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_original_callback'>original_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_EARLY_HINTS-constant" title="Rack::RACK_EARLY_HINTS (constant)">RACK_EARLY_HINTS</a></span>]
    <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_EARLY_HINTS-constant" title="Rack::RACK_EARLY_HINTS (constant)">RACK_EARLY_HINTS</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_headers'>headers</span><span class='op'>|</span>
      <span class='comment'>## If &lt;tt&gt;rack.early_hints&lt;/tt&gt; is called, it must be called with valid Rack response headers.
</span>      <span class='id identifier rubyid_check_headers'><a href="#check_headers-instance_method" title="Rack::Lint::Wrapper#check_headers (method)">check_headers</a></span>(<span class='id identifier rubyid_headers'>headers</span>)
      <span class='id identifier rubyid_original_callback'>original_callback</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>(<span class='id identifier rubyid_headers'>headers</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_environment-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_environment</strong>(env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Request+Environment">The Request Environment</h4>

<p>Incoming HTTP requests are represented using an environment. \</p>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L136-L481'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='136' data-end='481'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 136</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_environment'>check_environment</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='comment'>## The environment must be an unfrozen Hash. The Rack application is free to modify the environment, but the modified environment should also comply with this specification. \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not a Hash, but </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Hash</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env should not be frozen, but is</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>

  <span class='comment'>## All environment keys must be strings.
</span>  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_keys'>keys</span>
  <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_reject!'>reject!</span>{<span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id identifier rubyid_key'>key</span>}
  <span class='kw'>unless</span> <span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env contains non-string keys: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_keys'>keys</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## === CGI Variables
</span>  <span class='comment'>##
</span>  <span class='comment'>## The environment is required to include these variables, adopted from {The Common Gateway Interface}[https://datatracker.ietf.org/doc/html/rfc3875] (CGI), except when they&#39;d be empty, but see below.
</span>
  <span class='comment'>##
</span>  <span class='comment'>## The CGI keys (named without a period) must have String values and are reserved for the Rack specification. If the values for CGI keys contain non-ASCII characters, they should use &lt;tt&gt;ASCII-8BIT&lt;/tt&gt; encoding.
</span>  <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>) <span class='comment'># Skip extensions
</span>    
    <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env variable </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> has non-string value </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>==</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_b'>b</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\x80-\xff]</span><span class='regexp_end'>/n</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env variable </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'> has value containing non-ASCII characters and has non-ASCII-8BIT encoding </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> encoding: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_encoding'>encoding</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## The server and application can store their own data in the environment, too. The keys must contain at least one dot, and should be prefixed uniquely. The prefix &lt;tt&gt;rack.&lt;/tt&gt; is reserved for use with the Rack specification and the classes that ship with Rack.
</span>
  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;REQUEST_METHOD&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The HTTP request method, such as &quot;GET&quot; or &quot;POST&quot;. This cannot ever be an empty string, and so is always required.
</span>  <span class='id identifier rubyid_request_method'>request_method</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_required'><a href="#assert_required-instance_method" title="Rack::Lint::Wrapper#assert_required (method)">assert_required</a></span>(<span class='const'><a href="../../Rack.html#REQUEST_METHOD-constant" title="Rack::REQUEST_METHOD (constant)">REQUEST_METHOD</a></span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_request_method'>request_method</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A[0-9A-Za-z!\#$%&amp;&#39;*.^_`|~-]\z</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>REQUEST_METHOD unknown: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request_method'>request_method</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The initial portion of the request URL&#39;s path that corresponds to the application object, so that the application knows its virtual location. This may be an empty string, if the application corresponds to the root of the server. If non-empty, the string must start with &lt;tt&gt;/&lt;/tt&gt;, but should not end with &lt;tt&gt;/&lt;/tt&gt;.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SCRIPT_NAME-constant" title="Rack::SCRIPT_NAME (constant)">SCRIPT_NAME</a></span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\/</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SCRIPT_NAME must start with /</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##
</span>    <span class='comment'>## In addition, &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; MUST not be &lt;tt&gt;/&lt;/tt&gt;, but instead be empty, \
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_script_name'>script_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SCRIPT_NAME cannot be &#39;/&#39;, make it &#39;&#39; and PATH_INFO &#39;/&#39;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>## and one of &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; or &lt;tt&gt;PATH_INFO&lt;/tt&gt; must be set, e.g. &lt;tt&gt;PATH_INFO&lt;/tt&gt; can be &lt;tt&gt;/&lt;/tt&gt; if &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt; is empty.
</span>  <span class='id identifier rubyid_path_info'>path_info</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#PATH_INFO-constant" title="Rack::PATH_INFO (constant)">PATH_INFO</a></span>]
  <span class='kw'>if</span> (<span class='id identifier rubyid_script_name'>script_name</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_script_name'>script_name</span>.<span class='id identifier rubyid_empty?'>empty?</span>) <span class='op'>&amp;&amp;</span> (<span class='id identifier rubyid_path_info'>path_info</span>.<span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_path_info'>path_info</span>.<span class='id identifier rubyid_empty?'>empty?</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>One of SCRIPT_NAME or PATH_INFO must be set (make PATH_INFO &#39;/&#39; if SCRIPT_NAME is empty)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;PATH_INFO&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The remainder of the request URL&#39;s &quot;path&quot;, designating the virtual &quot;location&quot; of the request&#39;s target within the application. This may be an empty string, if the request URL targets the application root and does not have a trailing slash. This value may be percent-encoded when originating from a URL.
</span>  <span class='comment'>##
</span>  <span class='comment'>## The &lt;tt&gt;PATH_INFO&lt;/tt&gt;, if provided, must be a valid request target or an empty string, as defined by {RFC9110}[https://datatracker.ietf.org/doc/html/rfc9110#target.resource].
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_path_info'>path_info</span>
  <span class='kw'>when</span> <span class='const'><a href="../Lint.html#REQUEST_PATH_ASTERISK_FORM-constant" title="Rack::Lint::REQUEST_PATH_ASTERISK_FORM (constant)">REQUEST_PATH_ASTERISK_FORM</a></span>
    <span class='comment'>## * Only &lt;tt&gt;OPTIONS&lt;/tt&gt; requests may have &lt;tt&gt;PATH_INFO&lt;/tt&gt; set to &lt;tt&gt;*&lt;/tt&gt; (asterisk-form).
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_request_method'>request_method</span> <span class='op'>==</span> <span class='const'><a href="../../Rack.html#OPTIONS-constant" title="Rack::OPTIONS (constant)">OPTIONS</a></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Only OPTIONS requests may have PATH_INFO set to &#39;*&#39; (asterisk-form)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='const'><a href="../Lint.html#REQUEST_PATH_AUTHORITY_FORM-constant" title="Rack::Lint::REQUEST_PATH_AUTHORITY_FORM (constant)">REQUEST_PATH_AUTHORITY_FORM</a></span>
    <span class='comment'>## * Only &lt;tt&gt;CONNECT&lt;/tt&gt; requests may have &lt;tt&gt;PATH_INFO&lt;/tt&gt; set to an authority (authority-form). Note that in HTTP/2+, the authority-form is not a valid request target.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_request_method'>request_method</span> <span class='op'>==</span> <span class='const'><a href="../../Rack.html#CONNECT-constant" title="Rack::CONNECT (constant)">CONNECT</a></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Only CONNECT requests may have PATH_INFO set to an authority (authority-form)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='const'><a href="../Lint.html#REQUEST_PATH_ABSOLUTE_FORM-constant" title="Rack::Lint::REQUEST_PATH_ABSOLUTE_FORM (constant)">REQUEST_PATH_ABSOLUTE_FORM</a></span>
    <span class='comment'>## * &lt;tt&gt;CONNECT&lt;/tt&gt; and &lt;tt&gt;OPTIONS&lt;/tt&gt; requests must not have &lt;tt&gt;PATH_INFO&lt;/tt&gt; set to a URI (absolute-form).
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_request_method'>request_method</span> <span class='op'>==</span> <span class='const'><a href="../../Rack.html#CONNECT-constant" title="Rack::CONNECT (constant)">CONNECT</a></span> <span class='op'>||</span> <span class='id identifier rubyid_request_method'>request_method</span> <span class='op'>==</span> <span class='const'><a href="../../Rack.html#OPTIONS-constant" title="Rack::OPTIONS (constant)">OPTIONS</a></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONNECT and OPTIONS requests must not have PATH_INFO set to a URI (absolute-form)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='const'><a href="../Lint.html#REQUEST_PATH_ORIGIN_FORM-constant" title="Rack::Lint::REQUEST_PATH_ORIGIN_FORM (constant)">REQUEST_PATH_ORIGIN_FORM</a></span>
    <span class='comment'>## * Otherwise, &lt;tt&gt;PATH_INFO&lt;/tt&gt; must start with a &lt;tt&gt;/&lt;/tt&gt; and must not include a fragment part starting with &lt;tt&gt;#&lt;/tt&gt; (origin-form).
</span>  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>nil</span>
    <span class='comment'># Empty string or nil is okay.
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>PATH_INFO must start with a &#39;/&#39; and must not include a fragment part starting with &#39;#&#39; (origin-form)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;QUERY_STRING&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The portion of the request URL that follows the &lt;tt&gt;?&lt;/tt&gt;, if any. May be empty, but is always required!
</span>  <span class='id identifier rubyid_assert_required'><a href="#assert_required-instance_method" title="Rack::Lint::Wrapper#assert_required (method)">assert_required</a></span>(<span class='const'><a href="../../Rack.html#QUERY_STRING-constant" title="Rack::QUERY_STRING (constant)">QUERY_STRING</a></span>)

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;SERVER_NAME&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## Must be a valid host, as defined by {RFC3986}[https://datatracker.ietf.org/doc/html/rfc3986#section-3.2.2].
</span>  <span class='comment'>##
</span>  <span class='comment'>## When combined with &lt;tt&gt;SCRIPT_NAME&lt;/tt&gt;, &lt;tt&gt;PATH_INFO&lt;/tt&gt;, and &lt;tt&gt;QUERY_STRING&lt;/tt&gt;, these variables can be used to reconstruct the original the request URL. Note, however, that &lt;tt&gt;HTTP_HOST&lt;/tt&gt;, if present, should be used in preference to &lt;tt&gt;SERVER_NAME&lt;/tt&gt; for reconstructing the request URL.
</span>  <span class='id identifier rubyid_server_name'>server_name</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_required'><a href="#assert_required-instance_method" title="Rack::Lint::Wrapper#assert_required (method)">assert_required</a></span>(<span class='const'><a href="../../Rack.html#SERVER_NAME-constant" title="Rack::SERVER_NAME (constant)">SERVER_NAME</a></span>)
  <span class='kw'>unless</span> <span class='id identifier rubyid_server_name'>server_name</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='const'><a href="../Lint.html#SERVER_NAME_PATTERN-constant" title="Rack::Lint::SERVER_NAME_PATTERN (constant)">SERVER_NAME_PATTERN</a></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env[SERVER_NAME] must be a valid host</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;SERVER_PROTOCOL&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The HTTP version used for the request. It must match the regular expression &lt;tt&gt;HTTP\/\d(\.\d)?&lt;/tt&gt;.
</span>  <span class='id identifier rubyid_server_protocol'>server_protocol</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_required'><a href="#assert_required-instance_method" title="Rack::Lint::Wrapper#assert_required (method)">assert_required</a></span>(<span class='const'><a href="../../Rack.html#SERVER_PROTOCOL-constant" title="Rack::SERVER_PROTOCOL (constant)">SERVER_PROTOCOL</a></span>)
  <span class='kw'>unless</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>HTTP/\d(\.\d)?</span><span class='regexp_end'>}</span></span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='id identifier rubyid_server_protocol'>server_protocol</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env[SERVER_PROTOCOL] does not match HTTP/\\d(\\.\\d)?</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;SERVER_PORT&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The port the server is running on, if the server is running on a non-standard port. It must consist of digits only.
</span>  <span class='comment'>##
</span>  <span class='comment'>## The standard ports are:
</span>  <span class='comment'>## * 80 for HTTP
</span>  <span class='comment'>## * 443 for HTTPS
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_server_port'>server_port</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#SERVER_PORT-constant" title="Rack::SERVER_PORT (constant)">SERVER_PORT</a></span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_server_port'>server_port</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\d+\z</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env[SERVER_PORT] is not an Integer</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;CONTENT_TYPE&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The optional MIME type of the request body, if any.
</span>  <span class='comment'># N.B. We do not validate this field as it is considered user-provided data.
</span>
  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;CONTENT_LENGTH&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The length of the request body, if any. It must consist of digits only.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_content_length'>content_length</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONTENT_LENGTH</span><span class='tstring_end'>&quot;</span></span>]
    <span class='kw'>if</span> <span class='id identifier rubyid_content_length'>content_length</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\d+\z</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid CONTENT_LENGTH: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_content_length'>content_length</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;HTTP_HOST&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## An optional HTTP authority, as defined by {RFC9110}[https://datatracker.ietf.org/doc/html/rfc9110#name-host-and-authority].
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_http_host'>http_host</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#HTTP_HOST-constant" title="Rack::HTTP_HOST (constant)">HTTP_HOST</a></span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_http_host'>http_host</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='const'><a href="../Lint.html#HTTP_HOST_PATTERN-constant" title="Rack::Lint::HTTP_HOST_PATTERN (constant)">HTTP_HOST_PATTERN</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env[HTTP_HOST] must be a valid authority</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;HTTP_&lt;/tt&gt; Headers
</span>  <span class='comment'>##
</span>  <span class='comment'>## Unless specified above, the environment can contain any number of additional headers, each starting with &lt;tt&gt;HTTP_&lt;/tt&gt;. The presence or absence of these variables should correspond with the presence or absence of the appropriate HTTP header in the request, and those headers have no specific interpretation or validation by the Rack specification. However, there are many standard HTTP headers that have a specific meaning in the context of a request; see {RFC3875 section 4.1.18}[https://tools.ietf.org/html/rfc3875#section-4.1.18] for more details.
</span>  <span class='comment'>##
</span>  <span class='comment'>## For compatibility with the CGI specifiction, the environment must not contain the keys &lt;tt&gt;HTTP_CONTENT_TYPE&lt;/tt&gt; or &lt;tt&gt;HTTP_CONTENT_LENGTH&lt;/tt&gt;. Instead, the keys &lt;tt&gt;CONTENT_TYPE&lt;/tt&gt; and &lt;tt&gt;CONTENT_LENGTH&lt;/tt&gt; must be used.
</span>  <span class='qwords'><span class='qwords_beg'>%w[</span><span class='tstring_content'>HTTP_CONTENT_TYPE</span><span class='words_sep'> </span><span class='tstring_content'>HTTP_CONTENT_LENGTH</span><span class='tstring_end'>]</span></span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_header'>header</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_header'>header</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>env contains </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span><span class='embexpr_end'>}</span><span class='tstring_content'>, must use </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_header'>header</span>[<span class='int'>5</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>]<span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## === Rack-Specific Variables
</span>  <span class='comment'>##
</span>  <span class='comment'>## In addition to CGI variables, the Rack environment includes Rack-specific variables. These variables are prefixed with &lt;tt&gt;rack.&lt;/tt&gt; and are reserved for use by the Rack specification, or by the classes that ship with Rack.
</span>  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.url_scheme&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The URL scheme, which must be one of &lt;tt&gt;http&lt;/tt&gt;, &lt;tt&gt;https&lt;/tt&gt;, &lt;tt&gt;ws&lt;/tt&gt; or &lt;tt&gt;wss&lt;/tt&gt;. This can never be an empty string, and so is always required. The scheme should be set according to the last hop. For example, if a client makes a request to a reverse proxy over HTTPS, but the connection between the reverse proxy and the server is over plain HTTP, the reverse proxy should set &lt;tt&gt;rack.url_scheme&lt;/tt&gt; to &lt;tt&gt;http&lt;/tt&gt;.
</span>  <span class='id identifier rubyid_rack_url_scheme'>rack_url_scheme</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_required'><a href="#assert_required-instance_method" title="Rack::Lint::Wrapper#assert_required (method)">assert_required</a></span>(<span class='const'><a href="../../Rack.html#RACK_URL_SCHEME-constant" title="Rack::RACK_URL_SCHEME (constant)">RACK_URL_SCHEME</a></span>)
  <span class='kw'>unless</span> <span class='const'><a href="../Lint.html#ALLOWED_SCHEMES-constant" title="Rack::Lint::ALLOWED_SCHEMES (constant)">ALLOWED_SCHEMES</a></span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_rack_url_scheme'>rack_url_scheme</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.url_scheme unknown: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_rack_url_scheme'>rack_url_scheme</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.protocol&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## An optional Array of String values, containing the protocols advertised by the client in the &lt;tt&gt;upgrade&lt;/tt&gt; header (HTTP/1) or the &lt;tt&gt;:protocol&lt;/tt&gt; pseudo-header (HTTP/2+).
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_protocols'>protocols</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_PROTOCOL-constant" title="Rack::RACK_PROTOCOL (constant)">RACK_PROTOCOL</a></span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_protocols'>protocols</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Array</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_protocols'>protocols</span>.<span class='id identifier rubyid_all?'>all?</span>{<span class='op'>|</span><span class='id identifier rubyid_protocol'>protocol</span><span class='op'>|</span> <span class='id identifier rubyid_protocol'>protocol</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>String</span>)}
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.protocol must be an Array of Strings</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.session&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## An optional Hash-like interface for storing request session data. The store must implement:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_SESSION-constant" title="Rack::RACK_SESSION (constant)">RACK_SESSION</a></span>]
    <span class='comment'>## * &lt;tt&gt;store(key, value)&lt;/tt&gt; (aliased as &lt;tt&gt;[]=&lt;/tt&gt;) to set a value for a key,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_store'>store</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='op'>[]=</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to store and []=</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;fetch(key, default = nil)&lt;/tt&gt; (aliased as &lt;tt&gt;[]&lt;/tt&gt;) to retrieve a value for a key,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fetch'>fetch</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='op'>[]</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to fetch and []</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;delete(key)&lt;/tt&gt; to delete a key,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_delete'>delete</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to delete</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;clear&lt;/tt&gt; to clear the session,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_clear'>clear</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to clear</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;to_hash&lt;/tt&gt; (optional) to retrieve the session as a Hash.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_to_hash'>to_hash</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_to_hash'>to_hash</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Hash</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_to_hash'>to_hash</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_session'>session</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to to_hash and return unfrozen Hash instance</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.logger&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## An optional Logger-like interface for logging messages. The logger must implement:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_LOGGER-constant" title="Rack::RACK_LOGGER (constant)">RACK_LOGGER</a></span>]
    <span class='comment'>## * &lt;tt&gt;info(message, &amp;block)&lt;/tt&gt;,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_info'>info</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to info</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;debug(message, &amp;block)&lt;/tt&gt;,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_debug'>debug</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to debug</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;warn(message, &amp;block)&lt;/tt&gt;,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_warn'>warn</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to warn</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;error(message, &amp;block)&lt;/tt&gt;,
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_error'>error</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to error</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## * &lt;tt&gt;fatal(message, &amp;block)&lt;/tt&gt;.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_fatal'>fatal</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_logger'>logger</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> must respond to fatal</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.multipart.buffer_size&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## An optional Integer hint to the multipart parser as to what chunk size to use for reads and writes.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_rack_multipart_buffer_size'>rack_multipart_buffer_size</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_MULTIPART_BUFFER_SIZE-constant" title="Rack::RACK_MULTIPART_BUFFER_SIZE (constant)">RACK_MULTIPART_BUFFER_SIZE</a></span>]
    <span class='kw'>unless</span> <span class='id identifier rubyid_rack_multipart_buffer_size'>rack_multipart_buffer_size</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Integer</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_rack_multipart_buffer_size'>rack_multipart_buffer_size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.multipart.buffer_size must be an Integer &gt; 0 if specified</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.multipart.tempfile_factory&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## An optional object for constructing temporary files for multipart form data. The factory must implement:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_rack_multipart_tempfile_factory'>rack_multipart_tempfile_factory</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_MULTIPART_TEMPFILE_FACTORY-constant" title="Rack::RACK_MULTIPART_TEMPFILE_FACTORY (constant)">RACK_MULTIPART_TEMPFILE_FACTORY</a></span>]
    <span class='comment'>## * &lt;tt&gt;call(filename, content_type)&lt;/tt&gt; to create a temporary file for a multipart form field.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_rack_multipart_tempfile_factory'>rack_multipart_tempfile_factory</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.multipart.tempfile_factory must respond to #call</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## The factory must return an IO-like object that responds to &lt;tt&gt;&lt;&lt;&lt;/tt&gt; and optionally &lt;tt&gt;rewind&lt;/tt&gt;.
</span>    <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_MULTIPART_TEMPFILE_FACTORY-constant" title="Rack::RACK_MULTIPART_TEMPFILE_FACTORY (constant)">RACK_MULTIPART_TEMPFILE_FACTORY</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span><span class='op'>|</span>
      <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_rack_multipart_tempfile_factory'>rack_multipart_tempfile_factory</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>(<span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span>)
      <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='op'>&lt;&lt;</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.multipart.tempfile_factory return value must respond to #&lt;&lt;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.hijack?&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## If present and truthy, indicates that the server supports partial hijacking. See the section below on hijacking for more information.
</span>  <span class='comment'>#
</span>  <span class='comment'># N.B. There is no specific validation here. If the user provides a partial hijack response, we will confirm this value is truthy in `check_hijack_response`.
</span>
  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.hijack&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## If present, an object responding to call that is used to perform a full hijack. See the section below on hijacking for more information.
</span>  <span class='id identifier rubyid_check_hijack'><a href="#check_hijack-instance_method" title="Rack::Lint::Wrapper#check_hijack (method)">check_hijack</a></span>(<span class='id identifier rubyid_env'>env</span>)

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.early_hints&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## If present, an object responding to call that is used to send early hints. See the section below on early hints for more information.
</span>  <span class='id identifier rubyid_check_early_hints'><a href="#check_early_hints-instance_method" title="Rack::Lint::Wrapper#check_early_hints (method)">check_early_hints</a></span> <span class='id identifier rubyid_env'>env</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.input&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## If present, the input stream. See the section below on the input stream for more information.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_rack_input'>rack_input</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_INPUT-constant" title="Rack::RACK_INPUT (constant)">RACK_INPUT</a></span>]
    <span class='id identifier rubyid_check_input_stream'><a href="#check_input_stream-instance_method" title="Rack::Lint::Wrapper#check_input_stream (method)">check_input_stream</a></span>(<span class='id identifier rubyid_rack_input'>rack_input</span>)
    <span class='ivar'>@env</span>[<span class='const'><a href="../../Rack.html#RACK_INPUT-constant" title="Rack::RACK_INPUT (constant)">RACK_INPUT</a></span>] <span class='op'>=</span> <span class='const'><a href="Wrapper/InputWrapper.html" title="Rack::Lint::Wrapper::InputWrapper (class)">InputWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/InputWrapper.html#new-class_method" title="Rack::Lint::Wrapper::InputWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_rack_input'>rack_input</span>)
  <span class='kw'>end</span>

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.errors&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## The error stream. See the section below on the error stream for more information.
</span>  <span class='id identifier rubyid_rack_errors'>rack_errors</span> <span class='op'>=</span> <span class='id identifier rubyid_assert_required'><a href="#assert_required-instance_method" title="Rack::Lint::Wrapper#assert_required (method)">assert_required</a></span>(<span class='const'><a href="../../Rack.html#RACK_ERRORS-constant" title="Rack::RACK_ERRORS (constant)">RACK_ERRORS</a></span>)
  <span class='id identifier rubyid_check_error_stream'><a href="#check_error_stream-instance_method" title="Rack::Lint::Wrapper#check_error_stream (method)">check_error_stream</a></span>(<span class='id identifier rubyid_rack_errors'>rack_errors</span>)
  <span class='ivar'>@env</span>[<span class='const'><a href="../../Rack.html#RACK_ERRORS-constant" title="Rack::RACK_ERRORS (constant)">RACK_ERRORS</a></span>] <span class='op'>=</span> <span class='const'><a href="Wrapper/ErrorWrapper.html" title="Rack::Lint::Wrapper::ErrorWrapper (class)">ErrorWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/ErrorWrapper.html#new-class_method" title="Rack::Lint::Wrapper::ErrorWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_rack_errors'>rack_errors</span>)

  <span class='comment'>##
</span>  <span class='comment'>## ==== &lt;tt&gt;rack.response_finished&lt;/tt&gt;
</span>  <span class='comment'>##
</span>  <span class='comment'>## If present, an array of callables that will be run by the server after the response has been processed. Typically this will be after sending the response to the client, but it could also be if an error occurs while generating the response or sending the response.
</span>  <span class='comment'>##
</span>  <span class='comment'>## The callables must be called in reverse order with four arguments which must be:
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_rack_response_finished'>rack_response_finished</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_RESPONSE_FINISHED-constant" title="Rack::RACK_RESPONSE_FINISHED (constant)">RACK_RESPONSE_FINISHED</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.response_finished must be an array of callable objects</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_rack_response_finished'>rack_response_finished</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Array</span>)

    <span class='id identifier rubyid_rack_response_finished'>rack_response_finished</span>.<span class='id identifier rubyid_map!'>map!</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_callable'>callable</span><span class='op'>|</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.response_finished values must respond to call(env, status, headers, error)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_callable'>callable</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)

      <span class='kw'>if</span> <span class='const'><a href="Wrapper/ResponseFinishedWrapper.html" title="Rack::Lint::Wrapper::ResponseFinishedWrapper (class)">ResponseFinishedWrapper</a></span> <span class='op'>===</span> <span class='id identifier rubyid_callable'>callable</span>
        <span class='id identifier rubyid_callable'>callable</span>
      <span class='kw'>else</span>
        <span class='const'><a href="Wrapper/ResponseFinishedWrapper.html" title="Rack::Lint::Wrapper::ResponseFinishedWrapper (class)">ResponseFinishedWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/ResponseFinishedWrapper.html#new-class_method" title="Rack::Lint::Wrapper::ResponseFinishedWrapper.new (method)">new</a></span>(<span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_callable'>callable</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_error_stream-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_error_stream</strong>(error)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Error+Stream">The Error Stream</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L607-L614'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='607' data-end='614'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 607</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_error_stream'>check_error_stream</span>(<span class='id identifier rubyid_error'>error</span>)
  <span class='comment'>## The error stream must respond to puts, write and flush:
</span>  [<span class='symbeg'>:</span><span class='id identifier rubyid_puts'>puts</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_write'>write</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_flush'>flush</span>].<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_error'>error</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span> <span class='id identifier rubyid_method'>method</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.error </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_error'>error</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not respond to #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_header_value-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_header_value</strong>(key, value)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L779-L784'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='779' data-end='784'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 779</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_header_value'>check_header_value</span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
  <span class='comment'>## such that each String must not contain &lt;tt&gt;NUL&lt;/tt&gt; (&lt;tt&gt;\0&lt;/tt&gt;), &lt;tt&gt;CR&lt;/tt&gt; (&lt;tt&gt;\r&lt;/tt&gt;), or &lt;tt&gt;LF&lt;/tt&gt; (&lt;tt&gt;\n&lt;/tt&gt;).
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_match?'>match?</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\x00\x0A\x0D]</span><span class='regexp_end'>/</span></span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid header value </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_headers-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_headers</strong>(headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Headers">The Headers</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L740-L777'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='740' data-end='777'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 740</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_headers'>check_headers</span>(<span class='id identifier rubyid_headers'>headers</span>)
  <span class='comment'>## The headers must be an unfrozen Hash. \
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Hash</span>)
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>headers object should be a hash, but isn&#39;t (got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> as headers)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>headers object should not be frozen, but is</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='comment'>## The header keys must be String values. \
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>header key must be a string, was </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>## Special headers starting &lt;tt&gt;rack.&lt;/tt&gt; are for communicating with the server, and must not be sent back to the client.
</span>    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span>.<span class='id identifier rubyid_start_with?'>start_with?</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.</span><span class='tstring_end'>&quot;</span></span>)

    <span class='comment'>##
</span>    <span class='comment'>## * The headers must not contain a &lt;tt&gt;&quot;status&quot;&lt;/tt&gt; key.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>headers must not contain status</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>status</span><span class='tstring_end'>&quot;</span></span>
    <span class='comment'>## * Header keys must conform to {RFC7230}[https://tools.ietf.org/html/rfc7230] token specification, i.e. cannot contain non-printable ASCII, &lt;tt&gt;DQUOTE&lt;/tt&gt; or &lt;tt&gt;(),/:;&lt;=&gt;?@[\]{}&lt;/tt&gt;.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid header name: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[\(\),\/:;&lt;=&gt;\?@\[\\\]{}[:cntrl:]]</span><span class='regexp_end'>/</span></span>
    <span class='comment'>## * Header keys must not contain uppercase ASCII characters (A-Z).
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uppercase character in header name: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[A-Z]</span><span class='regexp_end'>/</span></span>

    <span class='comment'>## * Header values must be either a String, \
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>String</span>)
      <span class='id identifier rubyid_check_header_value'><a href="#check_header_value-instance_method" title="Rack::Lint::Wrapper#check_header_value (method)">check_header_value</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)
    <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span>(<span class='const'>Array</span>)
      <span class='comment'>## or an Array of String values, \
</span>      <span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span>{<span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_check_header_value'><a href="#check_header_value-instance_method" title="Rack::Lint::Wrapper#check_header_value (method)">check_header_value</a></span>(<span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span>)}
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a header value must be a String or Array of Strings, but the value of &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; is a </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_hijack-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_hijack</strong>(env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Hijacking">Hijacking</h4>

<p>The hijacking interfaces provides a means for an application to take control of the HTTP connection. There are two distinct hijack interfaces: full hijacking where the application takes over the raw connection, and partial hijacking where the application takes over just the response body stream. In both cases, the application is responsible for closing the hijacked stream.</p>

<p>Full hijacking only works with HTTP/1. Partial hijacking is functionally equivalent to streaming bodies, and is still optionally supported for backwards compatibility with older <a href="../../Rack.html" title="Rack (module)"><code>::Rack</code></a> versions.</p>

<h5 id="label-Full+Hijack">Full Hijack</h5>

<p>Full hijack is used to completely take over an HTTP/1 connection. It occurs before any headers are written and causes the server to ignore any response generated by the application. It is intended to be used when applications need access to the raw HTTP/1 connection.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L654-L668'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='654' data-end='668'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 654</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_hijack'>check_hijack</span>(<span class='id identifier rubyid_env'>env</span>)
  <span class='comment'>## If &lt;tt&gt;rack.hijack&lt;/tt&gt; is present in env, it must respond to call \
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span> <span class='op'>=</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>]
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.hijack must respond to call</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)

    <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>

      <span class='comment'>## and return an IO object which can be used to read and write to the underlying connection using HTTP/1 semantics and formatting.
</span>      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.hijack must return an IO instance</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_io'>io</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>IO</span>)

      <span class='id identifier rubyid_io'>io</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_hijack_response-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_hijack_response</strong>(headers, env)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Partial+Hijack">Partial Hijack</h4>

<p>Partial hijack is used for bi-directional streaming of the request and response body. It occurs after the status and headers are written by the server and causes the server to ignore the Body of the response. It is intended to be used when applications need bi-directional streaming.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L675-L700'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='675' data-end='700'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 675</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_hijack_response'>check_hijack_response</span>(<span class='id identifier rubyid_headers'>headers</span><span class='comma'>,</span> <span class='id identifier rubyid_env'>env</span>)
  <span class='comment'>## If &lt;tt&gt;rack.hijack?&lt;/tt&gt; is present in env and truthy, \
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_env'>env</span>[<span class='const'><a href="../../Rack.html#RACK_IS_HIJACK-constant" title="Rack::RACK_IS_HIJACK (constant)">RACK_IS_HIJACK</a></span>]
    <span class='comment'>## an application may set the special response header &lt;tt&gt;rack.hijack&lt;/tt&gt; \
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>]
      <span class='comment'>## to an object that responds to call, \
</span>      <span class='kw'>unless</span> <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.hijack header must respond to #call</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='comment'>## accepting a stream argument.
</span>      <span class='kw'>return</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_io'>io</span><span class='op'>|</span>
        <span class='id identifier rubyid_original_hijack'>original_hijack</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span> <span class='const'><a href="Wrapper/StreamWrapper.html" title="Rack::Lint::Wrapper::StreamWrapper (class)">StreamWrapper</a></span>.<span class='id identifier rubyid_new'><a href="Wrapper/StreamWrapper.html#new-class_method" title="Rack::Lint::Wrapper::StreamWrapper.new (method)">new</a></span>(<span class='id identifier rubyid_io'>io</span>)
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='comment'>##
</span>    <span class='comment'>## After the response status and headers have been sent, this hijack callback will be called with a stream argument which follows the same interface as outlined in &quot;Streaming Body&quot;. Servers must ignore the body part of the response tuple when the &lt;tt&gt;rack.hijack&lt;/tt&gt; response header is present. Using an empty Array is recommended.
</span>  <span class='kw'>else</span>
    <span class='comment'>##
</span>    <span class='comment'>## If &lt;tt&gt;rack.hijack?&lt;/tt&gt; is not present and truthy, the special response header &lt;tt&gt;rack.hijack&lt;/tt&gt; must not be present in the response headers.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_headers'>headers</span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.hijack header must not be present if server does not support hijacking</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_input_stream-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_input_stream</strong>(input)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Input+Stream">The Input Stream</h4>

<p>The input stream is an <code>IO</code>-like object which contains the raw HTTP request data. \</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L514-L529'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='514' data-end='529'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 514</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_input_stream'>check_input_stream</span>(<span class='id identifier rubyid_input'>input</span>)
  <span class='comment'>## When applicable, its external encoding must be &lt;tt&gt;ASCII-8BIT&lt;/tt&gt; and it must be opened in binary mode. \
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_external_encoding'>external_encoding</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_external_encoding'>external_encoding</span> <span class='op'>!=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.input </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_input'>input</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not have ASCII-8BIT as its external encoding</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_binmode?'>binmode?</span>) <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_binmode?'>binmode?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.input </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_input'>input</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not opened in binary mode</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>## The input stream must respond to gets, each, and read:
</span>  [<span class='symbeg'>:</span><span class='id identifier rubyid_gets'>gets</span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span><span class='comma'>,</span> <span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>].<span class='id identifier rubyid_each'><a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">each</a></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_input'>input</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span> <span class='id identifier rubyid_method'>method</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.input </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_input'>input</span><span class='embexpr_end'>}</span><span class='tstring_content'> does not respond to #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_rack_protocol_header-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_rack_protocol_header</strong>(status, headers)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+rack.protocol+Header">The <code>rack.protocol</code> Header</h4>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L831-L844'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='831' data-end='844'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 831</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_rack_protocol_header'>check_rack_protocol_header</span>(<span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_headers'>headers</span>)
  <span class='comment'>## If the &lt;tt&gt;rack.protocol&lt;/tt&gt; header is present, it must be a String, and must be one of the values from the &lt;tt&gt;rack.protocol&lt;/tt&gt; array from the environment.
</span>  <span class='id identifier rubyid_protocol'>protocol</span> <span class='op'>=</span> <span class='id identifier rubyid_headers'>headers</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.protocol</span><span class='tstring_end'>&#39;</span></span>]

  <span class='kw'>if</span> <span class='id identifier rubyid_protocol'>protocol</span>
    <span class='id identifier rubyid_request_protocols'>request_protocols</span> <span class='op'>=</span> <span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.protocol</span><span class='tstring_end'>&#39;</span></span>]

    <span class='kw'>if</span> <span class='id identifier rubyid_request_protocols'>request_protocols</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.protocol header is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_protocol'>protocol</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, but rack.protocol was not set in request!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_request_protocols'>request_protocols</span>.<span class='id identifier rubyid_include?'>include?</span>(<span class='id identifier rubyid_protocol'>protocol</span>)
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rack.protocol header is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_protocol'>protocol</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, but should be one of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request_protocols'>request_protocols</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> from the request!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="check_status-instance_method">
  <h3 class='signature nodoc'>
    #<strong>check_status</strong>(status)  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-The+Response">The Response</h4>

<p>Outgoing HTTP responses are generated from the response tuple generated by the application. The response tuple is an <code>Array</code> of three elements, which are: the HTTP status, the headers, and the response body. The Rack application is responsible for ensuring that the response tuple is well-formed and should follow the rules set out in this specification.</p>

<h5 id="label-The+Status">The Status</h5>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L730-L735'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='730' data-end='735'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 730</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_check_status'>check_status</span>(<span class='id identifier rubyid_status'>status</span>)
  <span class='comment'>## This is an HTTP status. It must be an Integer greater than or equal to 100.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_status'>status</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>Integer</span>) <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>&gt;=</span> <span class='int'>100</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Status must be an Integer &gt;=100</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="close-instance_method">
  <h3 class='signature nodoc'>
    #<strong>close</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Setting this value informs the server that it should perform a connection upgrade. In HTTP/1, this is done using the <code>upgrade</code> header. In HTTP/2+, this is done by accepting the request.</p>

<h4 id="label-The+Body">The Body</h4>

<p>The Body is typically an <code>Array</code> of <code>String</code> values, an enumerable that yields <code>String</code> values, a <code>Proc</code>, or an <code>IO</code>-like object.</p>

<p>The Body must respond to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> or <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>. It may optionally respond to <a href="#to_path-instance_method" title="Rack::Lint::Wrapper#to_path (method)">#to_path</a> or <a href="#to_ary-instance_method" title="Rack::Lint::Wrapper#to_ary (method)">#to_ary</a>. A Body that responds to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> is considered to be an Enumerable Body. A Body that responds to <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a> is considered to be a Streaming Body.</p>

<p>A Body that responds to both <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> and <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a> must be treated as an Enumerable Body, not a Streaming Body. If it responds to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>, you must call <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> and not <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>. If the Body doesn’t respond to <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>, then you can assume it responds to <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>.</p>

<p>The Body must either be consumed or returned. The Body is consumed by optionally calling either <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a> or <a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">#call</a>. Then, if the Body responds to <code>close</code>, it must be called to release any resources associated with the generation of the body. In other words, <code>close</code> must always be called at least once; typically after the web server has sent the response to the client, but also in cases where the <a href="../../Rack.html" title="Rack (module)"><code>::Rack</code></a> application makes internal/virtual requests and discards the response.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L857-L869'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='857' data-end='869'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 857</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='comment'>##
</span>  <span class='comment'>## After calling close, the Body is considered closed and should not be consumed again. \
</span>  <span class='ivar'>@closed</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='comment'>## If the original Body is replaced by a new Body, the new Body must also consume the original Body by calling close if possible.
</span>  <span class='ivar'>@body</span>.<span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_close'>close</span>)

  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='ivar'>@lint</span>.<span class='id identifier rubyid_index'>index</span>(<span class='kw'>self</span>)
  <span class='kw'>unless</span> <span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint</span><span class='tstring_end'>&#39;</span></span>][<span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_index'>index</span>].<span class='id identifier rubyid_all?'>all?</span> {<span class='op'>|</span><span class='id identifier rubyid_lint'>lint</span><span class='op'>|</span> <span class='id identifier rubyid_lint'>lint</span>.<span class='id identifier rubyid_instance_variable_get'>instance_variable_get</span>(<span class='symbeg'>:</span><span class='ivar'>@closed</span>)}
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Body has not been closed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="each-instance_method">
  <h3 class='signature nodoc'>
    #<strong>each</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<h4 id="label-Enumerable+Body">Enumerable Body</h4>

  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L888-L923'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='888' data-end='923'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 888</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span>
  <span class='comment'>## The Enumerable Body must respond to each, \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enumerable Body must respond to each</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_each'>each</span>)

  <span class='comment'>## which must only be called once, \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body must only be called once (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@consumed</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@consumed</span>.<span class='id identifier rubyid_nil?'>nil?</span>

  <span class='comment'>## must not be called after being closed, \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body is already closed</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@closed</span>

  <span class='ivar'>@consumed</span> <span class='op'>=</span> <span class='symbeg'>:</span><span class='id identifier rubyid_each'>each</span>

  <span class='ivar'>@body</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_chunk'>chunk</span><span class='op'>|</span>
    <span class='comment'>## and must only yield String values.
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_chunk'>chunk</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>String</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Body yielded non-string value </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_chunk'>chunk</span>.<span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'>##
</span>    <span class='comment'>## Middleware must not call each directly on the Body. Instead, middleware can return a new Body that calls each on the original Body, yielding at least once per iteration.
</span>    <span class='kw'>if</span> <span class='ivar'>@lint</span>[<span class='int'>0</span>] <span class='op'>==</span> <span class='kw'>self</span>
      <span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint.body_iteration</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> (<span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint.body_iteration</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>-=</span> <span class='int'>1</span>) <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New body must yield at least once per iteration of old body</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='ivar'>@size</span> <span class='op'>+=</span> <span class='id identifier rubyid_chunk'>chunk</span>.<span class='id identifier rubyid_bytesize'>bytesize</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_chunk'>chunk</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_verify_content_length'><a href="#verify_content_length-instance_method" title="Rack::Lint::Wrapper#verify_content_length (method)">verify_content_length</a></span>(<span class='ivar'>@size</span>)

  <span class='id identifier rubyid_verify_to_path'><a href="#verify_to_path-instance_method" title="Rack::Lint::Wrapper#verify_to_path (method)">verify_to_path</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="respond_to?-instance_method">
  <h3 class='signature nodoc'>
    #<strong>respond_to?</strong>(name)  &#x21d2; <code>Boolean</code> 
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L931-L937'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='931' data-end='937'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 931</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='op'>*</span>)
  <span class='kw'>if</span> <span class='const'><a href="#BODY_METHODS-constant" title="Rack::Lint::Wrapper::BODY_METHODS (constant)">BODY_METHODS</a></span>.<span class='id identifier rubyid_key?'>key?</span>(<span class='id identifier rubyid_name'>name</span>)
    <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='id identifier rubyid_name'>name</span>)
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="response-instance_method">
  <h3 class='signature nodoc'>
    #<strong>response</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
  </div>
</div>
<div class='tags'>
  <p class='tag_title'>Raises:</p>
<ul class='raise'>
  <li>
    <span class='type'>(<a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a>)</span>
  </li>
</ul>

</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L87-L124'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='87' data-end='124'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 87</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_response'>response</span>
  <span class='comment'>## It takes exactly one argument, the environment (representing an HTTP request) \
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No env given</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@env</span>
  <span class='id identifier rubyid_check_environment'><a href="#check_environment-instance_method" title="Rack::Lint::Wrapper#check_environment (method)">check_environment</a></span>(<span class='ivar'>@env</span>)

  <span class='comment'>## and returns a non-frozen Array of exactly three elements: \
</span>  <span class='ivar'>@response</span> <span class='op'>=</span> <span class='ivar'>@app</span>.<span class='id identifier rubyid_call'><a href="#call-instance_method" title="Rack::Lint::Wrapper#call (method)">call</a></span>(<span class='ivar'>@env</span>)

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response is not an Array, but </span><span class='embexpr_beg'>#{</span><span class='ivar'>@response</span>.<span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@response</span>.<span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response is frozen</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@response</span>.<span class='id identifier rubyid_frozen?'>frozen?</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>response array has </span><span class='embexpr_beg'>#{</span><span class='ivar'>@response</span>.<span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> elements instead of 3</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='ivar'>@response</span>.<span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>3</span>

  <span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span><span class='comma'>,</span> <span class='ivar'>@body</span> <span class='op'>=</span> <span class='ivar'>@response</span>
  <span class='comment'>## the status, \
</span>  <span class='id identifier rubyid_check_status'><a href="#check_status-instance_method" title="Rack::Lint::Wrapper#check_status (method)">check_status</a></span>(<span class='ivar'>@status</span>)

  <span class='comment'>## the headers, \
</span>  <span class='id identifier rubyid_check_headers'><a href="#check_headers-instance_method" title="Rack::Lint::Wrapper#check_headers (method)">check_headers</a></span>(<span class='ivar'>@headers</span>)

  <span class='id identifier rubyid_hijack_proc'>hijack_proc</span> <span class='op'>=</span> <span class='id identifier rubyid_check_hijack_response'><a href="#check_hijack_response-instance_method" title="Rack::Lint::Wrapper#check_hijack_response (method)">check_hijack_response</a></span>(<span class='ivar'>@headers</span><span class='comma'>,</span> <span class='ivar'>@env</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_hijack_proc'>hijack_proc</span>
    <span class='ivar'>@headers</span>[<span class='const'><a href="../../Rack.html#RACK_HIJACK-constant" title="Rack::RACK_HIJACK (constant)">RACK_HIJACK</a></span>] <span class='op'>=</span> <span class='id identifier rubyid_hijack_proc'>hijack_proc</span>
  <span class='kw'>end</span>

  <span class='comment'>## and the body (representing an HTTP response).
</span>  <span class='id identifier rubyid_check_content_type_header'><a href="#check_content_type_header-instance_method" title="Rack::Lint::Wrapper#check_content_type_header (method)">check_content_type_header</a></span>(<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span>)
  <span class='id identifier rubyid_check_content_length_header'><a href="#check_content_length_header-instance_method" title="Rack::Lint::Wrapper#check_content_length_header (method)">check_content_length_header</a></span>(<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span>)
  <span class='id identifier rubyid_check_rack_protocol_header'><a href="#check_rack_protocol_header-instance_method" title="Rack::Lint::Wrapper#check_rack_protocol_header (method)">check_rack_protocol_header</a></span>(<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span>)
  <span class='ivar'>@head_request</span> <span class='op'>=</span> <span class='ivar'>@env</span>[<span class='const'><a href="../../Rack.html#REQUEST_METHOD-constant" title="Rack::REQUEST_METHOD (constant)">REQUEST_METHOD</a></span>] <span class='op'>==</span> <span class='const'><a href="../../Rack.html#HEAD-constant" title="Rack::HEAD (constant)">HEAD</a></span>

  <span class='ivar'>@lint</span> <span class='op'>=</span> (<span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> []) <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>

  <span class='kw'>if</span> (<span class='ivar'>@env</span>[<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rack.lint.body_iteration</span><span class='tstring_end'>&#39;</span></span>] <span class='op'>||=</span> <span class='int'>0</span>) <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Middleware must not call #each directly</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> [<span class='ivar'>@status</span><span class='comma'>,</span> <span class='ivar'>@headers</span><span class='comma'>,</span> <span class='kw'>self</span>]
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_ary-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_ary</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>If the Body responds to <code>to_ary</code>, it must return an <code>Array</code> whose contents are identical to that produced by calling <a href="#each-instance_method" title="Rack::Lint::Wrapper#each (method)">#each</a>. Middleware may call <code>to_ary</code> directly on the Body and return a new Body in its place. In other words, middleware can only process the Body directly if it responds to <code>to_ary</code>. If the Body responds to both <code>to_ary</code> and <a href="#close-instance_method" title="Rack::Lint::Wrapper#close (method)">#close</a>, its implementation of <code>to_ary</code> must call <a href="#close-instance_method" title="Rack::Lint::Wrapper#close (method)">#close</a>.</p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L941-L949'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='941' data-end='949'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 941</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_ary'>to_ary</span>
  <span class='ivar'>@body</span>.<span class='id identifier rubyid_to_ary'>to_ary</span>.<span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_content'>content</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_content'>content</span> <span class='op'>==</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_enum_for'>enum_for</span>.<span class='id identifier rubyid_to_a'>to_a</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#to_ary not identical to contents produced by calling #each</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_close'><a href="#close-instance_method" title="Rack::Lint::Wrapper#close (method)">close</a></span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="to_path-instance_method">
  <h3 class='signature nodoc'>
    #<strong>to_path</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L927-L929'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='927' data-end='929'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 927</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_to_path'>to_path</span>
  <span class='ivar'>@body</span>.<span class='id identifier rubyid_to_path'>to_path</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_content_length-instance_method">
  <h3 class='signature nodoc'>
    #<strong>verify_content_length</strong>(size)  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L816-L826'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='816' data-end='826'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 816</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_content_length'>verify_content_length</span>(<span class='id identifier rubyid_size'>size</span>)
  <span class='kw'>if</span> <span class='ivar'>@head_request</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Response body was given for HEAD request, but should be empty</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='ivar'>@content_length</span>
    <span class='kw'>unless</span> <span class='ivar'>@content_length</span> <span class='op'>==</span> <span class='id identifier rubyid_size'>size</span>.<span class='id identifier rubyid_to_s'>to_s</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>content-length header was </span><span class='embexpr_beg'>#{</span><span class='ivar'>@content_length</span><span class='embexpr_end'>}</span><span class='tstring_content'>, but should be </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="verify_to_path-instance_method">
  <h3 class='signature nodoc'>
    #<strong>verify_to_path</strong>  
  </h3>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/rack/rack/blob/main/lib/rack/lint.rb#L871-L883'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='871' data-end='883'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/rack/lint.rb', line 871</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_verify_to_path'>verify_to_path</span>
  <span class='comment'>##
</span>  <span class='comment'>## If the Body responds to to_path, it must return either nil or a String. If a String is returned, it must be a path for the local file system whose contents are identical to that produced by calling each; this may be used by the server as an alternative, possibly more efficient way to transport the response. The to_path method does not consume the body.
</span>  <span class='kw'>if</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_respond_to?'><a href="#respond_to%3F-instance_method" title="Rack::Lint::Wrapper#respond_to? (method)">respond_to?</a></span>(<span class='symbeg'>:</span><span class='id identifier rubyid_to_path'><a href="#to_path-instance_method" title="Rack::Lint::Wrapper#to_path (method)">to_path</a></span>)
    <span class='id identifier rubyid_optional_path'>optional_path</span> <span class='op'>=</span> <span class='ivar'>@body</span>.<span class='id identifier rubyid_to_path'><a href="#to_path-instance_method" title="Rack::Lint::Wrapper#to_path (method)">to_path</a></span>

    <span class='kw'>if</span> <span class='id identifier rubyid_optional_path'>optional_path</span> <span class='op'>!=</span> <span class='kw'>nil</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_optional_path'>optional_path</span>.<span class='id identifier rubyid_is_a?'>is_a?</span>(<span class='const'>String</span>) <span class='op'>&amp;&amp;</span> <span class='op'>::</span><span class='const'>File</span>.<span class='id identifier rubyid_exist?'>exist?</span>(<span class='id identifier rubyid_optional_path'>optional_path</span>)
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'><a href="LintError.html" title="Rack::Lint::LintError (class)">LintError</a></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>body.to_path must be nil or a path to an existing file</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>