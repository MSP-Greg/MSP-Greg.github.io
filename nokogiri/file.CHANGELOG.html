<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: CHANGELOG &mdash; Nokogiri main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "CHANGELOG",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Nokogiri main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: CHANGELOG&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1><a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> Changelog</h1>

<p><a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> follows <a href="https://semver.org/">Semantic Versioning</a>, please see the <a href="file.README.html">README.md</a> for details.</p>

<hr>

<h2>next / unreleased</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.14.6">v2.14.6</a>, from v2.13.8. libxml2 v2.14 includes changes to more closely adhere to the HTML5 parser spec. Notably, the content of <code>iframe</code> and <code>noframes</code> tags is now treated as raw text, where previously it was parsed as PCDATA.</li>
<li>[CRuby] Update to rake-compiler-dock v1.9.1 for building precompiled native gems. (#3404, #3418) @flavorjones</li>
</ul>

<h3>Improved</h3>

<ul>
<li>[CRuby] The HTML5 parser now has linear performance when parsing many attributes. Previously performance was quadratic due to two hotspots, one in detecting duplicate attributes and one in constructing the libxml2 data structures. (#3393) @flavorjones</li>
</ul>

<h3>Changed</h3>

<ul>
<li>The unused constant <code>Struct::HTMLElementDescription</code> is no longer defined. (#3432, #3433) @viralpraxis</li>
</ul>

<h3>Fixed</h3>

<ul>
<li>[CRuby] When a namespace is set on an unparented node, ensure the namespace is defined on the node. (#3459, #3462)</li>
<li>[CRuby] Builder now correctly builds namespaced nodes that define their own namespace when that ns prefix collides with one defined by the parent (or another ancestor). (#3458, #3461) @flavorjones</li>
<li>[CRuby] <code>Reader.outer_xml</code> and <code>.inner_xml</code> properly capture syntax errors. (#3558) @flavorjones</li>
<li>[CRuby MacOS] Fixed an issue handling SIGINT during HTML5 parsing. (#3528, #3535) @stevecheckoway</li>
<li>[JRuby] Fixed multiple issues with <code>Node#namespace_definitions</code> so that it now behaves identically to CRuby. (#2543, #3460) @flavorjones</li>
<li>[JRuby] <code>Document#create_element</code> and <code>Node.new</code> no longer set the namespace to the document&#39;s default namespace. The namespace must be set explicitly with <code>namespace=</code> or by parenting the node. (#3457, #3463) @flavorjones</li>
</ul>

<h2>v1.19.0 / 2025-12-28</h2>

<h4>Ruby</h4>

<p>This release is focused on changes to Ruby version support, and is otherwise functionally identical to v1.18.10.</p>

<ul>
<li>Introduce native gem support for Ruby 4.0. #3590</li>
<li>End support for Ruby 3.1, for which <a href="https://www.ruby-lang.org/en/downloads/branches/">upstream support ended 2025-03-26</a>.</li>
<li>End support for JRuby 9.4 (which targets Ruby 3.1 compatibility).</li>
</ul>

<h2>v1.18.10 / 2025-09-15</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.13.9">v2.13.9</a>. Note that the security fixes published in v2.13.9 were already present in <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> v1.18.9.</li>
<li>[CRuby] [Windows and MacOS] Vendored libiconv is updated to <a href="https://savannah.gnu.org/news/?id=10703">v1.18</a></li>
</ul>

<h2>v1.18.9 / 2025-07-20</h2>

<h3>Security</h3>

<ul>
<li>[CRuby] Applied upstream libxml2 patches to address CVE-2025-6021, CVE-2025-6170, CVE-2025-49794, CVE-2025-49795, and CVE-2025-49796. See <a href="https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-353f-x4gh-cqq8">GHSA-353f-x4gh-cqq8</a> for more information.</li>
</ul>

<h2>v1.18.8 / 2025-04-21</h2>

<h3>Security</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.13.8">v2.13.8</a> to address CVE-2025-32414 and CVE-2025-32415. See <a href="https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-5w6v-399v-w3cc">GHSA-5w6v-399v-w3cc</a> for more information.</li>
</ul>

<h2>v1.18.7 / 2025-03-31</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.13.7">v2.13.7</a>, which is a bugfix release.</li>
</ul>

<h2>v1.18.6 / 2025-03-24</h2>

<h3>Fixed</h3>

<ul>
<li>[JRuby] In HTML documents, <code>Node#attribute</code> now returns the correct attribute. This has been broken, and returning <code>nil</code>, since v1.17.0. (#3487) @flavorjones</li>
</ul>

<h2>v1.18.5 / 2025-03-19</h2>

<h3>Fixed</h3>

<ul>
<li>[JRuby] Update JRuby&#39;s XML serialization so it outputs namespaces exactly like CRuby. (#3455, #3456) @johnnyshields</li>
</ul>

<h2>v1.18.4 / 2025-03-14</h2>

<h3>Security</h3>

<ul>
<li>[CRuby] Vendored libxslt is updated to <a href="https://gitlab.gnome.org/GNOME/libxslt/-/releases/v1.1.43">v1.1.43</a> to address CVE-2025-24855 and CVE-2024-55549. See <a href="https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-mrxw-mxhj-p664">GHSA-mrxw-mxhj-p664</a> for more information.</li>
</ul>

<h2>v1.18.3 / 2025-02-18</h2>

<h3>Security</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.13.6">v2.13.6</a> to address CVE-2025-24928 and CVE-2024-56171. See <a href="https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-vvfq-8hwr-qm4m">GHSA-vvfq-8hwr-qm4m</a> for more information.</li>
</ul>

<h2>v1.18.2 / 2024-01-19</h2>

<h3>Fixed</h3>

<ul>
<li>When performing a CSS selector query, an XML document&#39;s root namespace declarations should not be applied to wildcard selectors (<code>&quot;*&quot;</code>). Fixes a bug introduced in v1.17.0. (#3411) @flavorjones</li>
</ul>

<h2>v1.18.1 / 2024-12-29</h2>

<h3>Fixed</h3>

<ul>
<li>[CRuby] XML::SAX::ParserContext keeps a reference to the input to avoid a potential use-after-free issue that&#39;s existed since v1.4.0 (2009). (#3395) @flavorjones</li>
</ul>

<h2>v1.18.0 / 2024-12-25</h2>

<h3>Notable Changes</h3>

<h4>Ruby</h4>

<p>This release introduces native gem support for Ruby 3.4.</p>

<p>This release ends support for Ruby 3.0, for which <a href="https://www.ruby-lang.org/en/downloads/branches/">upstream support ended 2024-04-23</a>.</p>

<p>This release ships separate precompiled GNU and Musl gems for all linux platforms. Previously both GNU and Musl target systems could use and install the same gem, e.g., the platform gem for <code>x86_64-linux</code>. Now, however, the precompiled gem platforms would be <code>x86_64-linux-gnu</code> and <code>x86_64-linux-musl</code>. So long as you&#39;re on <code>bundler &gt;= 2.5.6</code> this should be seamless other than perhaps needing to update the platforms in your &quot;Gemfile.lock&quot;.</p>

<p>This release drops precompiled native platform gems for <code>x86-linux</code> and <code>x86-mingw32</code>. <strong>These platforms are still supported.</strong> Users on these platforms must install the &quot;ruby platform&quot; gem which requires a compiler toolchain. See <a href="https://nokogiri.org/tutorials/installing_nokogiri.html#installing-the-ruby-platform-gem">Installing the <code>ruby</code> platform gem</a> in the installation docs. (#3369, #3081)</p>

<h3>Improved</h3>

<ul>
<li>[CRuby] CSS and XPath queries are faster now that <code>Node#xpath</code>, <code>Node#css</code>, and related functions are using a faster XPathContext initialization process. We benchmarked a 1.9x improvement for a 6kb file. Big thanks to @nwellnhof for helping with this one. (#3378, superseded by #3389) @flavorjones</li>
</ul>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Update to rake-compiler-dock v1.7.0 for building precompiled native gems. (#3375, #3392) @flavorjones</li>
</ul>

<h2>v1.17.2 / 2024-12-12</h2>

<h3>Fixed</h3>

<ul>
<li>[JRuby] Fixed an issue where <code>Node#dup</code> when called with the <code>new_parent_doc</code> parameter was not decorating the node with the document&#39;s <code>Node</code> decorators. [#3372] @flavorjones</li>
</ul>

<h2>v1.17.1 / 2024-12-10</h2>

<h3>Fixed</h3>

<ul>
<li>Fixed a potential segfault when using <code>Node#dup</code> and <code>DocumentFragment#dup</code>. [#3359] @byroot @flavorjones</li>
<li><code>Node#dup</code> and <code>Node#clone</code> now correctly decorate the new node with the document&#39;s <code>Node</code> decorators. [#3363] @flavorjones</li>
</ul>

<h2>v1.17.0 / 2024-12-08</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.13.5">v2.13.5</a>. @flavorjones</li>
<li>[CRuby] Vendored libxslt is updated to <a href="https://gitlab.gnome.org/GNOME/libxslt/-/releases/v1.1.42">v1.1.42</a>. @flavorjones</li>
<li>[CRuby] Minimum supported version of libxml2 raised to v2.9.2 (released 2014-10-16) from v2.6.21. [#3232, #3287] @flavorjones</li>
<li>[JRuby] Minimum supported version of Java raised to 8 (released 2014-03-18) from 7. [#3134] @flavorjones</li>
<li>[CRuby] Update to rake-compiler-dock v1.5.1 for building precompiled native gems. [#3216] @flavorjones</li>
</ul>

<h3>Notable changes</h3>

<h4>SAX Parsers</h4>

<p>The XML and HTML4 SAX parsers have received a lot of attention in this release, and we&#39;ve fixed multiple long-standing bugs with encoding and entity handling. In addition, libxml2 v2.13 has also made some underlying fixes and improvements to encoding and entity handling.</p>

<p>We&#39;re shipping these fixes in a minor release because we firmly believe the resulting behavior is correct and standards-compliant, however applications that have been depending on the buggy behavior may be impacted.</p>

<p>If your application relies on the SAX parsers, and in particular if you&#39;re SAX-parsing documents with parsed entities or incorrect encoding declarations, please read the changelog below carefully.</p>

<h4>Fragment parsing</h4>

<p>Document fragment parsing has been improved, particularly with respect to handling malformed fragments or fragments with implicit namespace prefixes. Namespace reconciliation still isn&#39;t where we want it to be, but it&#39;s an improvement.</p>

<p>HTML5 fragment parsing now allows the context node to be specified as a <code>context:</code> keyword argument to the <code>HTML5::DocumentFragment.parse</code> and <code>.new</code> methods, which should allow for more flexible sanitization and future support for the <a href="https://wicg.github.io/sanitizer-api/">draft HTML Sanitizer API</a> in downstream libraries.</p>

<h4>Error handling</h4>

<p>In scenarios where multiple errors could be reported by the underlying parser, the errors will be aggregated into a single <a href="Nokogiri/XML/SyntaxError.html" title="Nokogiri::XML::SyntaxError (class)"><code>::Nokogiri::XML::SyntaxError</code></a> that is raised. Previously only the final error reported by libxml2 was raised (which was often misleading if it was only a warning and not the fatal error).</p>

<h4>Schema validation</h4>

<p>We&#39;ve resolved many long-standing bugs in the various schema classes, validation methods, and their error reporting. Behavior is now consistent across schema types and input types, as well as parser backends (Xerces and libxml2).</p>

<h4>Keyword arguments</h4>

<p>The following methods now accept keyword arguments in addition to positional arguments, and use <code>...</code> parameter forwarding when possible:
<code>HTML4()</code>, <code>HTML4.fragment</code>, <code>HTML4.parse</code>, <code>HTML4::Document.parse</code>, <code>HTML4::DocumentFragment#initialize</code>, <code>HTML4::DocumentFragment.parse</code>, <code>HTML5()</code>, <code>HTML5.fragment</code>, <code>HTML5.parse</code>, <code>HTML5::Document.parse</code>, <code>HTML5::Document.read_io</code>, <code>HTML5::Document.read_memory</code>, <code>HTML5::DocumentFragment#initialize</code>, <code>HTML5::DocumentFragment.parse</code>, <code>XML()</code>, <code>XML.fragment</code>, <code>XML.parse</code>, <code>XML::Document.parse</code>, <code>XML::DocumentFragment#initialize</code>, <code>XML::DocumentFragment.parse</code>, <code>XML::Node#canonicalize</code>, <code>XML::Node.parse</code>, <code>XML::Reader()</code>, <code>XML::RelaxNG()</code>, <code>XML::RelaxNG.new</code>, <code>XML::RelaxNG.read_memory</code>, <code>XML::SAX::PushParser#initialize</code>, <code>XML::Schema()</code>, <code>XML::Schema.new</code>, <code>XML::Schema.read_memory</code>, and <code>XSLT()</code>.</p>

<p>Special thanks to those contributors who participated in the RubyConf 2024 Hack Day to work on #3323 to help modernize <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> by adding keyword arguments and using parameter forwarding in many methods, and expanding some of the documentation! We intend to continue adding keyword argument support to more methods. #3323 #3324 #3326 #3327 #3329 #3330 #3332 #3333 #3334 #3335 #3336 #3342 #3355 #3356 @infews @matiasow @MattJones @mononoken @openbl @flavorjones</p>

<h3>Added</h3>

<ul>
<li>Introduce support for a new SAX callback <code>XML::SAX::Document#reference</code>, which is called to report some parsed XML entities when <code>XML::SAX::ParserContext#replace_entities</code> is set to the default value <code>false</code>. This is necessary functionality for some applications that were previously relying on incorrect entity error reporting which has been fixed (see below). For more information, read the docs for <a href="Nokogiri/XML/SAX/Document.html" title="Nokogiri::XML::SAX::Document (class)"><code>::Nokogiri::XML::SAX::Document</code></a>. [#1926] @flavorjones</li>
<li><code>XML::SAX::Parser#parse_memory</code> and <code>#parse_file</code> now accept an optional <code>encoding</code> argument. When not provided, the parser will fall back to the encoding passed to the initializer, and then fall back to autodetection. [#3288] @flavorjones</li>
<li><code>XML::SAX::ParserContext.memory</code> now accepts an optional <code>encoding</code> argument. When not provided, the encoding will be autodetected. [#3288] @flavorjones</li>
<li>New readonly attributes <code>XML::DocumentFragment#parse_options</code> and <code>HTML4::DocumentFragment#parse_options</code> return the options used to parse the document fragment. @flavorjones</li>
<li>New method <code>XML::Reader.new</code> is the primary constructor to which <code>XML::Reader()</code> forwards. Both methods now take <code>url:</code>, <code>encoding:</code>, and <code>options:</code> kwargs in addition to  the previous calling convention of passing positional parameters. #3326 @infews @flavorjones</li>
<li>[CRuby] The HTML5 parse methods accept a <code>:parse_noscript_content_as_text</code> keyword argument which will emulate the parsing behavior of a browser which has scripting enabled. [#3178, #3231] @stevecheckoway</li>
<li>[CRuby] <code>HTML5::DocumentFragment.parse</code> and <code>.new</code> accept a <code>:context</code> keyword argument that is the parse context node or element name. Previously this could only be passed in as a positional argument to <code>.new</code> and not at all to <code>.parse</code>. @flavorjones</li>
<li>[CRuby] <a href="Nokogiri/HTML5/Builder.html" title="Nokogiri::HTML5::Builder (class)"><code>::Nokogiri::HTML5::Builder</code></a> is similar to <code>HTML4::Builder</code> but returns an <code>HTML5::Document</code>. [#3119] @flavorjones</li>
<li>[CRuby] Attributes in an HTML5 document can be serialized individually, something that has always been supported by the HTML4 serializer. [#3125, #3127] @flavorjones</li>
<li>[CRuby] Introduce a compile-time option, <code>--disable-xml2-legacy</code>, to remove from libxml2 its dependencies on <code>zlib</code> and <code>liblzma</code> and disable implicit <code>HTTP</code> network requests. These all remain enabled by default, and are present in the precompiled native gems. This option is a precursor for removing these libraries in a future major release, but may be interesting for the security-minded who do not need features like automatic decompression and would like to remove these dependencies. You can read more and give feedback on these plans in #3168. [#3247] @flavorjones</li>
<li>[CRuby] If errors are returned from schema validation, a new attribute <code>SyntaxError#path</code> will contain the XPath path of the node that caused the validation failure. [#3316] @ryanong</li>
</ul>

<h3>Improved</h3>

<ul>
<li>Documentation has been improved for <code>XML::RelaxNG</code>, <code>XML::Schema</code>, <code>XML::Reader</code>, <code>HTML5</code>, <code>HTML5::Document</code>, <code>HTML5::DocumentFragment</code>, <code>HTML4::Document</code>, <code>HTML4::DocumentFragment</code>, <code>XML</code>, <code>XML::Document</code>, <code>XML::DocumentFragment</code>. #3355 @flavorjones</li>
<li>Documentation has been improved for <code>CSS.xpath_for</code>. [#3224] @flavorjones</li>
<li>Documentation for the SAX parsing classes has been greatly improved, including encoding overrides and the complex entity-handling behavior. [#3265] @flavorjones</li>
<li><code>XML::Schema#read_memory</code> and <code>XML::RelaxNG#read_memory</code> are now Ruby methods that call <code>#from_document</code>. Previously these were native functions, but they were buggy on both CRuby and JRuby (but worse on JRuby) and so this is now useful, comparable in performance, and simpler code that is easier to maintain. [#2113, #2115] @flavorjones</li>
<li><code>XML::SAX::ParserContext.io</code>&#39;s <code>encoding</code> argument is now optional, and can now be an <code>Encoding</code> or an encoding name. When not provided will default to autodetecting the encoding. [#3288] @flavorjones</li>
<li>[CRuby] The update to libxml v2.13 improves &quot;in context&quot; fragment parsing recovery. We removed our hacky workaround for recovery that led to silently-degraded functionality when parsing fragments with parse errors. Specifically, malformed XML fragments that used implicit namespace prefixes will now &quot;link up&quot; to the namespaces in the parent document or node, where previously they did not. [#2092] @flavorjones</li>
<li>[CRuby] When multiple errors could be detected by the parser and there&#39;s no obvious document to save them in (for example, when parsing a document with the recovery parse option turned off), the libxml2 errors are aggregated into a single <a href="Nokogiri/XML/SyntaxError.html" title="Nokogiri::XML::SyntaxError (class)"><code>::Nokogiri::XML::SyntaxError</code></a>. Previously, only the last error recorded by libxml2 was raised, which might be misleading if it&#39;s merely a warning and not the fatal error preventing the operation. [#2562] @flavorjones</li>
<li>[CRuby] The SAX parser context and handler implementation has been simplified and now takes advantage of some of libxml2&#39;s default SAX handlers for entities and DTD management. [#3265] @flavorjones</li>
<li>[CRuby] When compiling packaged libraries from source, allow users&#39; <code>AR</code> and <code>LD</code> environment variables to set the archiver and linker commands, respectively. This augments the existing <code>CC</code> environment variable to set the compiler command. [#3165] @ziggythehamster</li>
<li>[CRuby] When building from source on MacOS, environment variables <code>AR</code> and <code>RANLIB</code> are now respected when set instead of being overridden to /usr/bin/<code>ar,ranlib</code> (which is still the default). [#3338] @joshheinrichs-shopify</li>
</ul>

<h3>Fixed</h3>

<ul>
<li><code>Node#clone</code>, <code>NodeSet#clone</code>, and <code>*::Document#clone</code> all properly copy the metaclass of the original as expected. Previously, <code>#clone</code> had been aliased to <code>#dup</code> for these classes (since v1.3.0 in 2009). [#316, #3117] @flavorjones</li>
<li>CSS queries for pseudo-selectors that cannot be translated into XPath expressions now raise a more descriptive <a href="Nokogiri/CSS/SyntaxError.html" title="Nokogiri::CSS::SyntaxError (class)"><code>::Nokogiri::CSS::SyntaxError</code></a> when they are parsed. Previously, an invalid XPath expression was evaluated and a hard-to-understand XPath error was raised by the query engine. [#3193] @flavorjones</li>
<li><code>Schema#validate</code> returns errors on empty and malformed files. Previously, it would return errors on empty/malformed Documents, but not when reading from files. [#642] @flavorjones</li>
<li><code>XML::Builder</code> is now consistent with how it sets block scope. Previously, missing methods with blocks on dynamically-created nodes were always handled by invoking <code>instance_eval(&amp;block)</code> on the Builder, even when the Builder was yielding self for all other missing methods with blocks. [#1041] @flavorjones</li>
<li><code>HTML4::DocumentFragment.parse</code> accepts <code>IO</code> input. Previously, it required a string and would raise a <code>TypeError</code> when passed an <code>IO</code>. [#2069] @sharvy</li>
<li>[CRuby] libgumbo (the HTML5 parser) treats reaching max-depth as EOF. This addresses a class of issues when the parser is interrupted in this way. [#3121] @stevecheckoway</li>
<li>[CRuby] Update node GC lifecycle to avoid a potential memory leak with fragments in libxml 2.13.0 caused by changes in <code>xmlAddChild</code>. [#3156] @flavorjones</li>
<li>[CRuby] libgumbo correctly prints nonstandard element names in error messages. [#3219] @stevecheckoway</li>
<li>[CRuby] External entity references no long cause the SAX parser to register errors. [#1926] @flavorjones</li>
<li>[JRuby] Fixed entity reference serialization, which rendered both the reference and the replacement text. Incredibly nobody noticed this bug for over a decade. [#3272] @flavorjones</li>
<li>[JRuby] Fixed some bugs in how <code>Node#attributes</code> handles attributes with namespaces. [#2677, #2679] @flavorjones</li>
<li>[JRuby] Fix <code>Schema#validate</code> to only return the most recent Document&#39;s errors. Previously, if multiple documents were validated, this method returned the accumulated errors of all previous documents. [#1282] @flavorjones</li>
<li>[JRuby] Fix <code>Schema#validate</code> to not clobber the <code>@errors</code> instance variable. [#1282] @flavorjones</li>
<li>[JRuby] Empty documents fail schema validation as they should. [#783] @flavorjones</li>
<li>[JRuby] SAX parsing now respects the <code>#replace_entities</code> attribute, which defaults to <code>false</code>. Previously this flag defaulted to <code>true</code> and was completely ignored. [#614] @flavorjones</li>
<li>[JRuby] The SAX callback <code>Document#start_element_namespace</code> received a blank string for the URI when a namespace was not present. It now receives <code>nil</code> (as does the CRuby impl). [#3265] @flavorjones</li>
<li>[JRuby] <code>Reader#outer_xml</code> and <code>#inner_xml</code> encode entities properly. [#1523] @flavorjones</li>
</ul>

<h3>Changed</h3>

<ul>
<li>[CRuby] <code>Nokogiri::XML::CData.new</code> no longer accepts <code>nil</code> as the content argument, making <code>CData</code> behave like other character data classes (like <code>Comment</code> and <code>Text</code>). This change was necessitated by behavioral changes in libxml2 v2.13.0. If you wish to create an empty CDATA node, pass an empty string. [#3156] @flavorjones</li>
<li>Internals:

<ul>
<li>The internal <code>CSS::XPathVisitor</code> class now accepts the xpath prefix and the context namespaces as constructor arguments. The <code>prefix:</code> and <code>ns:</code> keyword arguments to <code>CSS.xpath_for</code> cannot be specified if the <code>visitor:</code> keyword argument is also used. <code>CSS::XPathVisitor</code> now exposes <code>#builtins</code>, <code>#doctype</code>, <code>#prefix</code>, and <code>#namespaces</code> attributes. [#3225] @flavorjones</li>
<li>The internal CSS selector cache has been extracted into a distinct class, <code>CSS::SelectorCache</code>. Previously it was part of the <code>CSS::Parser</code> class. [#3226] @flavorjones</li>
<li>The internal <code>Gumbo.parse</code> and <code>Gumbo.fragment</code> methods now take keyword arguments instead of positional arguments. [#3199] @flavorjones</li>
</ul></li>
</ul>

<h3>Deprecated</h3>

<ul>
<li>The undocumented and unused method <a href="Nokogiri/CSS.html#parse-class_method" title="Nokogiri::CSS.parse (method)">Nokogiri::CSS.parse</a> is now deprecated and will generate a warning. The AST returned by this method is private and subject to change and removal in future versions of <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a>. This method will be removed in a future version of <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a>.</li>
<li>Passing an options hash to <code>CSS.xpath_for</code> is now deprecated and will generate a warning. Use keyword arguments instead. This will become an error in a future version of <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a>.</li>
<li>Passing libxml2 encoding IDs to <code>SAX::ParserContext</code> methods is now deprecated and will generate a warning. The use of <code>SAX::Parser::ENCODINGS</code> is also deprecated. Use <code>Encoding</code> objects or encoding names instead.</li>
</ul>

<h3>Thank you!</h3>

<p>The following people and organizations were kind enough to sponsor @flavorjones or the <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> project during the development of v1.17.0:</p>

<ul>
<li>via Github sponsors

<ul>
<li>renuo @renuo</li>
<li>Ajaya Agrawalla @ajaya</li>
<li>Rob Stringer @Mycobee</li>
<li>Better Stack Community @betterstack-community</li>
<li>Prowly @prowlycom</li>
<li>Maxime Gauthier @biximilien</li>
<li>Harry Lascelles @hlascelles</li>
<li>Evil Martians @evilmartians</li>
<li>Typesense @typesense</li>
<li>YOSHIDA Katsuhiko @kyoshidajp</li>
<li>Quan Nguyen @qu8n</li>
<li>Sentry @getsentry</li>
<li>Codecov @codecov</li>
<li>Frank Groeneveld @frenkel</li>
<li>Hiroshi SHIBATA @hsbt</li>
<li>Nando Vieira @fnando</li>
<li>Orien Madgwick @orien</li>
<li>Avo @avo-hq</li>
<li>Zoran Pesic @zokioki</li>
<li>@zzak</li>
<li>Graham Watts @GingerGraham</li>
<li>Nandang Permana Kusuma @nandangpk</li>
<li>Mr. Henry @mrhenry</li>
<li>Götz Görisch @GoetzGoerisch</li>
<li>Andrew Nesbitt @andrew</li>
</ul></li>
<li>via Thanks.dev

<ul>
<li>Sentry @getsentry</li>
<li>Codecov @codecov</li>
<li>Keygen @keygen-sh</li>
<li>Keith Bauson @kwbauson</li>
<li>Nicco Kunzmann @niccokunzmann</li>
<li>timhaynes @timhaynes</li>
</ul></li>
<li>via Open Collective

<ul>
<li>Airbnb @airbnb</li>
<li>Nemo @captn3m0</li>
<li>Velocity Labs @velocity-labs</li>
</ul></li>
</ul>

<p>We&#39;d also like to thank @github who donate a ton of compute time for our CI pipelines!</p>

<h2>v1.16.8 / 2024-12-02</h2>

<h3>Fixed</h3>

<ul>
<li>[CRuby] When serializing HTML5 documents, properly escape foreign content &quot;style&quot; elements. Normally, a &quot;style&quot; tag contains  raw text that does not need entity-escaping, but when it appears in either SVG or MathML foreign content, the &quot;style&quot; tag is now correctly escaped when serialized. @flavorjones</li>
</ul>

<h2>v1.16.7 / 2024-07-27</h2>

<h2>Dependencies</h2>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.9">v2.12.9</a>, which the upstream release notes state is a security release to address CVE-2024-40896. Nokogiri&#39;s maintainers believe this vulnerability does not affect users of <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a>, but we advise upgrading at your earliest convenience anyway.</li>
</ul>

<h2>v1.16.6 / 2024-06-13</h2>

<h2>Dependencies</h2>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.8">v2.12.8</a>, which the release notes state is a bugfix release.</li>
</ul>

<h2>v1.16.5</h2>

<h3>Security</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to address CVE-2024-34459. See <a href="https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-r95h-9x8f-r3f7">GHSA-r95h-9x8f-r3f7</a> for more information.</li>
</ul>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.7">v2.12.7</a> from v2.12.6. (@flavorjones)</li>
</ul>

<h2>v1.16.4 / 2024-04-10</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored zlib in the precompiled native gems is updated to <a href="https://zlib.net/ChangeLog.txt">v1.3.1</a> from v1.3. <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> is not affected by the minizip CVE patched in this version, but this update may satisfy some security scanners. Related, see <a href="https://github.com/sparklemotion/nokogiri/discussions/3168">this discussion</a> about removing the compression libraries altogether in a future version of <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a>.</li>
</ul>

<h2>v1.16.3 / 2024-03-15</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.6">v2.12.6</a> from v2.12.5. (@flavorjones)</li>
</ul>

<h3>Changed</h3>

<ul>
<li>[CRuby] <code>XML::Reader</code> sets the <code>@encoding</code> instance variable during reading if it is not passed into the initializer. Previously, it would remain <code>nil</code>. The behavior of <code>Reader#encoding</code> has not changed. This works around changes to how libxml2 reports the encoding used in v2.12.6.</li>
</ul>

<h2>v1.16.2 / 2024-02-04</h2>

<h3>Security</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to address CVE-2024-25062. See <a href="https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-xc9x-jj77-9p9j">GHSA-xc9x-jj77-9p9j</a> for more information.</li>
</ul>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.5">v2.12.5</a> from v2.12.4. (@flavorjones)</li>
</ul>

<h2>v1.16.1 / 2024-02-03</h2>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to <a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.4">v2.12.4</a> from v2.12.3. (@flavorjones)</li>
</ul>

<h3>Fixed</h3>

<ul>
<li>[CRuby] <code>XML::Reader</code> defaults the encoding to UTF-8 if it&#39;s not specified in either the document or as a method parameter. Previously non-ASCII characters were serialized as NCRs in this case. <a href="@flavorjones">#2891</a></li>
<li>[CRuby] Restored support for compilation by GCC versions earlier than 4.6, which was broken in v1.15.0 (540e9aee). <a href="@adfoster-r7">#3090</a></li>
<li>[CRuby] Patched upstream libxml2 to allow parsing HTML5 in the context of a namespaced node (e.g., foreign content like MathML). <a href="@flavorjones">#3112, #3116</a></li>
<li>[CRuby] Fixed a small memory leak in libgumbo (HTML5 parser) when the maximum tree depth limit is hit. <a href="@stevecheckoway">#3098, #3100</a></li>
</ul>

<h2>v1.16.0 / 2023-12-27</h2>

<h3>Notable Changes</h3>

<h4>Ruby</h4>

<p>This release introduces native gem support for Ruby 3.3.</p>

<p>This release ends support for Ruby 2.7, for which <a href="https://www.ruby-lang.org/en/downloads/branches/">upstream support ended 2023-03-31</a>.</p>

<h4>Pattern matching</h4>

<p>This version marks <em>official support</em> for the pattern matching API in <code>XML::Attr</code>, <code>XML::Document</code>, <code>XML::DocumentFragment</code>, <code>XML::Namespace</code>, <code>XML::Node</code>, and <code>XML::NodeSet</code> (and their subclasses), originally introduced as an experimental feature in v1.14.0. (@flavorjones)</p>

<p>Documentation on what can be matched:</p>

<ul>
<li><a href="https://nokogiri.org/rdoc/Nokogiri/XML/Attr.html?h=deconstruct#method-i-deconstruct_keys"><code>XML::Attr#deconstruct_keys</code></a></li>
<li><a href="https://nokogiri.org/rdoc/Nokogiri/XML/Document.html?h=deconstruct#method-i-deconstruct_keys"><code>XML::Document#deconstruct_keys</code></a></li>
<li><a href="https://nokogiri.org/rdoc/Nokogiri/XML/Namespace.html?h=deconstruct+namespace#method-i-deconstruct_keys"><code>XML::Namespace#deconstruct_keys</code></a></li>
<li><a href="https://nokogiri.org/rdoc/Nokogiri/XML/Node.html?h=deconstruct#method-i-deconstruct_keys"><code>XML::Node#deconstruct_keys</code></a></li>
<li><a href="https://nokogiri.org/rdoc/Nokogiri/XML/DocumentFragment.html?h=deconstruct#method-i-deconstruct"><code>XML::DocumentFragment#deconstruct</code></a></li>
<li><a href="https://nokogiri.org/rdoc/Nokogiri/XML/NodeSet.html?h=deconstruct#method-i-deconstruct"><code>XML::NodeSet#deconstruct</code></a></li>
</ul>

<h3>Dependencies</h3>

<ul>
<li>[CRuby] Vendored libxml2 is updated to v2.12.3 from v2.11.6. (@flavorjones)

<ul>
<li><a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.0">https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.0</a></li>
<li><a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.1">https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.1</a></li>
<li><a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.2">https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.2</a></li>
<li><a href="https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.3">https://gitlab.gnome.org/GNOME/libxml2/-/releases/v2.12.3</a></li>
</ul></li>
</ul>

<h3>Fixed</h3>

<ul>
<li>CSS <code>nth</code> pseudo-classes now handle spaces, e.g. <code>&quot;2n + 1&quot;</code>. <a href="@fusion2004">#3018</a></li>
<li>[CRuby] <code>libgumbo</code> no longer leaks memory when an incomplete tag is abandoned by the HTML5 parser. <a href="@flavorjones">#3036</a></li>
</ul>

<h3>Removed</h3>

<ul>
<li>Removed <code>Nokogiri::HTML5.get</code> which was deprecated in v1.12.0. <a href="@flavorjones">#2278</a></li>
<li>Removed the CSS-to-XPath utility modules <code>XPathVisitorAlwaysUseBuiltins</code> and <code>XPathVisitorOptimallyUseBuiltins</code>, which were deprecated in v1.13.0 in favor of <code>XPathVisitor</code> constructor args. <a href="@flavorjones">#2403</a></li>
<li>Removed <code>XML::Reader#attribute_nodes</code> which was deprecated in v1.13.8 in favor of <code>#attribute_hash</code>. <a href="@flavorjones">#2598, #2599</a></li>
<li>[CRuby] Removed the <code>libxml/libxml2_path</code> key from <code>VersionInfo</code>, used in the past for third-party library integration, in favor of the <code>nokogiri/cppflags</code> and <code>nokogiri/ldflags</code> keys. Please note that third-party library integration is not fully supported and may be deprecated soon, see #2746 for more context. <a href="@flavorjones">#2143</a></li>
</ul>

<h3>Thank you!</h3>

<p>The following people and organizations were kind enough to sponsor @flavorjones or the <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> project during the development of v1.16.0:</p>

<ul>
<li>Götz Görisch @GoetzGoerisch</li>
<li>Airbnb @airbnb</li>
<li>Maxime Gauthier @biximilien</li>
<li>Renuo AG @renuo</li>
<li>YOSHIDA Katsuhiko @kyoshidajp</li>
<li>Homebrew @Homebrew</li>
<li>Hiroshi SHIBATA @hsbt</li>
<li>@zzak</li>
<li>Evil Martians @evilmartians</li>
<li>Ajaya Agrawalla @ajaya</li>
<li>Modern Treasury @Modern-Treasury</li>
<li>Danilo Lessa Bernardineli @danlessa</li>
<li>matt marques @mestre-dos-magos</li>
<li>Quan Nguyen @qu8n</li>
<li>Harry Lascelles @hlascelles</li>
<li>Oleksandr Tyshchenko @altivi</li>
<li>Prowly @prowlycom</li>
<li>Better Stack Community @betterstack-community</li>
<li>Sentry @getsentry</li>
<li>Codecov @codecov</li>
<li>Typesense @typesense</li>
<li>Roy Boivin II @Yabbo</li>
<li>Frank Groeneveld @frenkel</li>
</ul>

<p>We&#39;d also like to thank @github who donate a ton of compute time for our CI pipelines!</p>

<h2>Older releases</h2>

<p>See <a href="file.CHANGELOG-archive.html">misc/CHANGELOG-archive.md</a></p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>