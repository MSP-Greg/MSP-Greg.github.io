<!DOCTYPE html>
<html>
<head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>Module: Nokogiri::HTML5 &mdash; Nokogiri main</title>

<link rel='stylesheet'  type='text/css' href='../../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "Nokogiri::HTML5",
    relpath = '../';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='../'>Nokogiri main</a> &raquo; 
      <a href='../_index.html#alpha_H'>Index (H)</a> &raquo; 
        <a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>HTML5&nbsp;&#x25B2;</a></span>
    </div>

    <a id='list_href' href="../class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='module'>
<h1>Module: Nokogiri::HTML5</h1>
<div id='t2_rel_sf_div'>
<table id='t2_rel_sf' class='y_box'>
  <thead>
    <tr><td id='t2_relations' colspan='2'>Relationships & Source Files</td></tr>
  </thead>
  <tbody>
    <tr><td class='box_h' colspan='2'>Namespace Children</td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Modules:</div>
      <div class='box_11'>
          <a href="HTML5/Node.html" title="Nokogiri::HTML5::Node (module)"><code>Node</code></a>,
        <a href="HTML5/QuirksMode.html" title="Nokogiri::HTML5::QuirksMode (module)"><code>QuirksMode</code></a>      </div>
    </td></tr>
    <tr><td colspan='2'>
      <div class='box_1'>Classes:</div>
      <div class='box_11'>
          <a href="HTML5/Builder.html" title="Nokogiri::HTML5::Builder (class)"><code>Builder</code></a>,
        <a href="HTML5/Document.html" title="Nokogiri::HTML5::Document (class)"><code>Document</code></a>,
        <a href="HTML5/DocumentFragment.html" title="Nokogiri::HTML5::DocumentFragment (class)"><code>DocumentFragment</code></a>      </div>
    </td></tr>
    <tr><td class='box_h' colspan='2'>Super Chains via Extension / Inclusion / Inheritance</td></tr>
    <tr>
      <td colspan='2'>
        <div class='box_2'>Instance Chain:</div>
        <div class='box_22'>
          self,
          <a href="HTML5/Node.html" title="Nokogiri::HTML5::Node (module)"><code>Node</code></a>
        </div>
      </td>
    </tr>
    <tr class='single'>
      <td id='t2_defined_in' class='box_2 o'>Defined in:</td>
      <td class='box_rel'><a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5.rb#L272'>lib/nokogiri/html5.rb</a><span class='defines'>,<br /><a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/ext/nokogiri/nokogiri.c#L190'>ext/nokogiri/nokogiri.c</a>,<br/> <a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5/builder.rb#L4'>lib/nokogiri/html5/builder.rb</a>,<br/> <a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5/document.rb#L23'>lib/nokogiri/html5/document.rb</a>,<br/> <a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5/document_fragment.rb#L23'>lib/nokogiri/html5/document_fragment.rb</a>,<br/> <a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5/node.rb#L26'>lib/nokogiri/html5/node.rb</a></span>
      </td>
    </tr>
  </tbody>
</table>
</div>
<h2 id='h2_overview'>Overview</h2>
<div id='overview_ds'>
<div class='docstring'>
  <div class='discussion'>
    
<h3 id="label-Usage">Usage</h3>

<p>Parse an <code>HTML5</code> document:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span>.<span class='const'>HTML5</span>(<span class='id identifier rubyid_input'>input</span>)</code></pre>

<p>Parse an <code>HTML5</code> fragment:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_fragment'><a href="#fragment-class_method" title="Nokogiri::HTML5.fragment (method)">fragment</a></span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_fragment'><a href="#fragment-class_method" title="Nokogiri::HTML5.fragment (method)">fragment</a></span>(<span class='id identifier rubyid_input'>input</span>)</code></pre>

<p>⚠ <code>HTML5</code> functionality is not available when running JRuby.</p>

<h3 id="label-Parsing+options">Parsing options</h3>

<p>The document and fragment parsing methods support options that are different from <a href="HTML4/Document.html" title="Nokogiri::HTML4::Document (class)"><code>HTML4::Document</code></a> or <a href="XML/Document.html" title="Nokogiri::XML::Document (class)"><code>XML::Document</code></a>.</p>
<ul><li>
<p><code>Nokogiri.HTML5(input, url:, encoding:, **parse_options)</code></p>
</li><li>
<p><code>Nokogiri::HTML5.parse(input, url:, encoding:, **parse_options)</code></p>
</li><li>
<p><code>Nokogiri::HTML5::Document.parse(input, url:, encoding:, **parse_options)</code></p>
</li><li>
<p><code>Nokogiri::HTML5.fragment(input, encoding:, **parse_options)</code></p>
</li><li>
<p><code>Nokogiri::HTML5::DocumentFragment.parse(input, encoding:, **parse_options)</code></p>
</li></ul>

<p>The four currently supported parse options are</p>
<ul><li>
<p><code>max_errors:</code> (Integer, default 0) Maximum number of parse errors to report in <code>HTML5::Document#errors</code>.</p>
</li><li>
<p><code>max_tree_depth:</code> (Integer, default <a href="Gumbo.html#DEFAULT_MAX_TREE_DEPTH-constant" title="Nokogiri::Gumbo::DEFAULT_MAX_TREE_DEPTH (constant)">Gumbo::DEFAULT_MAX_TREE_DEPTH</a>) Maximum tree depth to parse.</p>
</li><li>
<p><code>max_attributes:</code> (Integer, default <a href="Gumbo.html#DEFAULT_MAX_ATTRIBUTES-constant" title="Nokogiri::Gumbo::DEFAULT_MAX_ATTRIBUTES (constant)">Gumbo::DEFAULT_MAX_ATTRIBUTES</a>) Maximum number of attributes to parse per element.</p>
</li><li>
<p><code>parse_noscript_content_as_text:</code> (Boolean, default false) When enabled, parse <code>noscript</code> tag content as text, mimicking the behavior of web browsers.</p>
</li></ul>

<p>These options are explained in the following sections.</p>

<h4 id="label-Error+reporting-3A+-7Bmax_errors-3A-7D">Error reporting: <code>max_errors:</code></h4>

<p><a href="../Nokogiri.html" title="Nokogiri (module)"><code>::Nokogiri</code></a> contains an experimental <code>HTML5</code> parse error reporting facility. By default, no parse errors are reported but this can be configured by passing the <code>:max_errors</code> option to <a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">.parse</a> or <a href="#fragment-class_method" title="Nokogiri::HTML5.fragment (method)">.fragment</a>.</p>

<p>For example, this script:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_parse'><a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">parse</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;span/&gt;Hi there!&lt;/span foo=bar /&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>max_errors:</span> <span class='int'>10</span>)
<span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_err'>err</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span>(<span class='id identifier rubyid_err'>err</span>)
<span class='kw'>end</span></code></pre>

<p>Emits:</p>

<pre class="code ruby"><code class="ruby"><span class='int'>1</span><span class='op'>:</span><span class='int'>1</span><span class='op'>:</span> <span class='const'>ERROR</span><span class='op'>:</span> <span class='const'>Expected</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_doctype'>doctype</span> <span class='id identifier rubyid_token'>token</span>
<span class='op'>&lt;</span><span class='id identifier rubyid_span'>span</span><span class='op'>/</span><span class='op'>&gt;</span><span class='const'>Hi</span> <span class='id identifier rubyid_there!'>there!</span><span class='op'>&lt;</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>span foo=bar </span><span class='regexp_end'>/</span></span><span class='op'>&gt;</span>
<span class='op'>^</span>
<span class='int'>1</span><span class='op'>:</span><span class='int'>1</span><span class='op'>:</span> <span class='const'>ERROR</span><span class='op'>:</span> <span class='const'>Start</span> <span class='id identifier rubyid_tag'>tag</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_nonvoid'>nonvoid</span> <span class='const'><a href="HTML.html" title="Nokogiri::HTML (module)">HTML</a></span> <span class='id identifier rubyid_element'>element</span> <span class='id identifier rubyid_ends'>ends</span> <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_use'>use</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span>.
<span class='op'>&lt;</span><span class='id identifier rubyid_span'>span</span><span class='op'>/</span><span class='op'>&gt;</span><span class='const'>Hi</span> <span class='id identifier rubyid_there!'>there!</span><span class='op'>&lt;</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>span foo=bar </span><span class='regexp_end'>/</span></span><span class='op'>&gt;</span>
<span class='op'>^</span>
<span class='int'>1</span><span class='op'>:</span><span class='int'>17</span><span class='op'>:</span> <span class='const'>ERROR</span><span class='op'>:</span> <span class='const'>End</span> <span class='id identifier rubyid_tag'>tag</span> <span class='id identifier rubyid_ends'>ends</span> <span class='id identifier rubyid_with'>with</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_use'>use</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span>.
<span class='op'>&lt;</span><span class='id identifier rubyid_span'>span</span><span class='op'>/</span><span class='op'>&gt;</span><span class='const'>Hi</span> <span class='id identifier rubyid_there!'>there!</span><span class='op'>&lt;</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>span foo=bar </span><span class='regexp_end'>/</span></span><span class='op'>&gt;</span>
                <span class='op'>^</span>
<span class='int'>1</span><span class='op'>:</span><span class='int'>17</span><span class='op'>:</span> <span class='const'>ERROR</span><span class='op'>:</span> <span class='const'>End</span> <span class='id identifier rubyid_tag'>tag</span> <span class='id identifier rubyid_contains'>contains</span> <span class='id identifier rubyid_attributes'>attributes</span>.
<span class='op'>&lt;</span><span class='id identifier rubyid_span'>span</span><span class='op'>/</span><span class='op'>&gt;</span><span class='const'>Hi</span> <span class='id identifier rubyid_there!'>there!</span><span class='op'>&lt;</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>span foo=bar </span><span class='regexp_end'>/</span></span><span class='op'>&gt;</span>
                <span class='op'>^</span></code></pre>

<p>Using <code>max_errors: -1</code> results in an unlimited number of errors being returned.</p>

<p>The errors returned by <code>HTML5::Document#errors</code> are instances of <a href="XML/SyntaxError.html" title="Nokogiri::XML::SyntaxError (class)"><code>XML::SyntaxError</code></a>.</p>

<p>The <a href="https://html.spec.whatwg.org/multipage/parsing.html#parse-errors" target="_parent" title="{Nokogiri::HTML">{Nokogiri::HTML</a> standard} defines a number of standard parse error codes. These error codes only cover the “tokenization” stage of parsing <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a>. The parse errors in the “tree construction” stage do not have standardized error codes (yet).</p>

<p>As a convenience to <a href="../Nokogiri.html" title="Nokogiri (module)"><code>::Nokogiri</code></a> users, the defined error codes are available via <a href="XML/SyntaxError.html#str1-instance_method" title="Nokogiri::XML::SyntaxError#str1 (method)">XML::SyntaxError#str1</a> method.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_parse'><a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">parse</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;span/&gt;Hi there!&lt;/span foo=bar /&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>max_errors:</span> <span class='int'>10</span>)
<span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_errors'>errors</span>.<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_err'>err</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_line'>line</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_column'>column</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_err'>err</span>.<span class='id identifier rubyid_str1'>str1</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>)
<span class='kw'>end</span>
<span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_parse'><a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">parse</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;span/&gt;Hi there!&lt;/span foo=bar /&gt;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
<span class='comment'># =&gt; 1:1: generic-parser
</span><span class='comment'>#    1:1: non-void-html-element-start-tag-with-trailing-solidus
</span><span class='comment'>#    1:17: end-tag-with-trailing-solidus
</span><span class='comment'>#    1:17: end-tag-with-attributes</span></code></pre>

<p>Note that the first error is <code>generic-parser</code> because it’s an error from the tree construction stage and doesn’t have a standardized error code.</p>

<p>For the purposes of semantic versioning, the error messages, error locations, and error codes are not part of Nokogiri’s public API. That is, these are subject to change without Nokogiri’s major version number changing. These may be stabilized in the future.</p>

<h4 id="label-Maximum+tree+depth-3A+-7Bmax_tree_depth-3A-7D">Maximum tree depth: <code>max_tree_depth:</code></h4>

<p>The maximum depth of the DOM tree parsed by the various parsing methods is configurable by the <code>:max_tree_depth</code> option. If the depth of the tree would exceed this limit, then an <code>ArgumentError</code> is thrown.</p>

<p>This limit (which defaults to <a href="Gumbo.html#DEFAULT_MAX_TREE_DEPTH-constant" title="Nokogiri::Gumbo::DEFAULT_MAX_TREE_DEPTH (constant)">Gumbo::DEFAULT_MAX_TREE_DEPTH</a>) can be removed by giving the option <code>max_tree_depth: -1</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_html'>html</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;!DOCTYPE html&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;div&gt;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>*</span> <span class='int'>1000</span>
<span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span>.<span class='const'>HTML5</span>(<span class='id identifier rubyid_html'>html</span>)
<span class='comment'># raises ArgumentError: Document tree depth limit exceeded
</span><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span>.<span class='const'>HTML5</span>(<span class='id identifier rubyid_html'>html</span><span class='comma'>,</span> <span class='label'>max_tree_depth:</span> <span class='op'>-</span><span class='int'>1</span>)</code></pre>

<h4 id="label-Attribute+limit+per+element-3A+-7Bmax_attributes-3A-7D">Attribute limit per element: <code>max_attributes:</code></h4>

<p>The maximum number of attributes per DOM element is configurable by the <code>:max_attributes</code> option. If a given element would exceed this limit, then an <code>ArgumentError</code> is thrown.</p>

<p>This limit (which defaults to <a href="Gumbo.html#DEFAULT_MAX_ATTRIBUTES-constant" title="Nokogiri::Gumbo::DEFAULT_MAX_ATTRIBUTES (constant)">Gumbo::DEFAULT_MAX_ATTRIBUTES</a>) can be removed by giving the option <code>max_attributes: -1</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_html'>html</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;!DOCTYPE html&gt;&lt;div </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> (<span class='int'>1</span><span class='op'>..</span><span class='int'>1000</span>).<span class='id identifier rubyid_map'>map</span> { <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attr-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> }.<span class='id identifier rubyid_join'>join</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> # </span><span class='tstring_end'>&#39;</span></span>) <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&#39;</span></span>
<span class='comment'># &quot;&lt;!DOCTYPE html&gt;&lt;div attr-1 attr-2 attr-3 ... attr-1000&gt;&quot;
</span><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span>.<span class='const'>HTML5</span>(<span class='id identifier rubyid_html'>html</span>)
<span class='comment'># raises ArgumentError: Attributes per element limit exceeded
</span>
<span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span>.<span class='const'>HTML5</span>(<span class='id identifier rubyid_html'>html</span><span class='comma'>,</span> <span class='label'>max_attributes:</span> <span class='op'>-</span><span class='int'>1</span>)
<span class='comment'># parses successfully</span></code></pre>

<h4 id="label-Parse+-7Bnoscript-7D+elements-27+content+as+text-3A+-7Bparse_noscript_content_as_text-3A-7D">Parse <code>noscript</code> elements’ content as text: <code>parse_noscript_content_as_text:</code></h4>

<p>By default, the content of <code>noscript</code> elements is parsed as <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> elements. Browsers that support scripting parse the content of <code>noscript</code> elements as raw text.</p>

<p>The <code>:parse_noscript_content_as_text</code> option causes <a href="../Nokogiri.html" title="Nokogiri (module)"><code>::Nokogiri</code></a> to parse the content of <code>noscript</code> elements as a single text node.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_html'>html</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;!DOCTYPE html&gt;&lt;noscript&gt;&lt;meta charset=&#39;UTF-8&#39;&gt;&lt;link rel=stylesheet href=!&gt;&lt;/noscript&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_parse'><a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">parse</a></span>(<span class='id identifier rubyid_html'>html</span><span class='comma'>,</span> <span class='label'>parse_noscript_content_as_text:</span> <span class='kw'>true</span>)
<span class='id identifier rubyid_pp'>pp</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_at_xpath'>at_xpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/html/head/noscript</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; #(Element:0x878c {
</span><span class='comment'>#        name = &quot;noscript&quot;,
</span><span class='comment'>#        children = [ #(Text &quot;&lt;meta charset=&#39;UTF-8&#39;&gt;&lt;link rel=stylesheet href=!&gt;&quot;)]
</span><span class='comment'>#      })</span></code></pre>

<p>In contrast, <code>parse_noscript_content_as_text: false</code> (the default) causes the <code>noscript</code> element in the previous example to have two children, a <code>meta</code> element and a <code>link</code> element.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_parse'><a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">parse</a></span>(<span class='id identifier rubyid_html'>html</span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_at_xpath'>at_xpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/html/head/noscript</span><span class='tstring_end'>&quot;</span></span>)
<span class='comment'># =&gt; #(Element:0x96b4 {
</span><span class='comment'>#      name = &quot;noscript&quot;,
</span><span class='comment'>#      children = [
</span><span class='comment'>#        #(Element:0x97e0 { name = &quot;meta&quot;, attribute_nodes = [ #(Attr:0x990c { name = &quot;charset&quot;, value = &quot;UTF-8&quot; })] }),
</span><span class='comment'>#        #(Element:0x9b00 {
</span><span class='comment'>#          name = &quot;link&quot;,
</span><span class='comment'>#          attribute_nodes = [
</span><span class='comment'>#            #(Attr:0x9c2c { name = &quot;rel&quot;, value = &quot;stylesheet&quot; }),
</span><span class='comment'>#            #(Attr:0x9dd0 { name = &quot;href&quot;, value = &quot;!&quot; })]
</span><span class='comment'>#          })]
</span><span class='comment'>#      })</span></code></pre>

<h3 id="label-HTML+Serialization">HTML Serialization</h3>

<p>After parsing <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a>, it may be serialized using any of the <a href="XML/Node.html" title="Nokogiri::XML::Node (class)"><code>XML::Node</code></a> serialization methods. In particular, <a href="XML/Node.html#serialize-instance_method" title="Nokogiri::XML::Node#serialize (method)">XML::Node#serialize</a>, <a href="XML/Node.html#to_html-instance_method" title="Nokogiri::XML::Node#to_html (method)">XML::Node#to_html</a>, and <a href="XML/Node.html#to_s-instance_method" title="Nokogiri::XML::Node#to_s (method)">XML::Node#to_s</a> will serialize a given node and its children. (This is the equivalent of JavaScript’s <code>Element.outerHTML</code>.) Similarly, <a href="XML/Node.html#inner_html-instance_method" title="Nokogiri::XML::Node#inner_html (method)">XML::Node#inner_html</a> will serialize the children of a given node. (This is the equivalent of JavaScript’s <code>Element.innerHTML</code>.)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;!DOCTYPE html&gt;&lt;span&gt;Hello world!&lt;/span&gt;</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_serialize'>serialize</span>
<span class='comment'># =&gt; &lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;span&gt;Hello world!&lt;/span&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>

<p>Due to quirks in how <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> is parsed and serialized, it’s possible for a DOM tree to be serialized and then re-parsed, resulting in a different DOM. Mostly, this happens with DOMs produced from invalid <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a>. Unfortunately, even valid <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> may not survive serialization and re-parsing.</p>

<p>In particular, a newline at the start of <code>pre</code>, <code>listing</code>, and <code>textarea</code> elements is ignored by the parser.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>(<span class='heredoc_beg'>&lt;&lt;-EOF</span>)
<span class='tstring_content'>&lt;!DOCTYPE html&gt;
&lt;pre&gt;
Content&lt;/pre&gt;
</span><span class='heredoc_end'>EOF
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_at'>at</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/html/body/pre</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_serialize'>serialize</span>
<span class='comment'># =&gt; &lt;pre&gt;Content&lt;/pre&gt;</span></code></pre>

<p>In this case, the original <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> is semantically equivalent to the serialized version. If the <code>pre</code>, <code>listing</code>, or <code>textarea</code> content starts with two newlines, the first newline will be stripped on the first parse and the second newline will be stripped on the second, leading to semantically different DOMs. Passing the parameter <code>preserve_newline: true</code> will cause two or more newlines to be preserved. (A single leading newline will still be removed.)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>(<span class='heredoc_beg'>&lt;&lt;-EOF</span>)
<span class='tstring_content'>&lt;!DOCTYPE html&gt;
&lt;listing&gt;

Content&lt;/listing&gt;
</span><span class='heredoc_end'>EOF
</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_at'>at</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/html/body/listing</span><span class='tstring_end'>&#39;</span></span>).<span class='id identifier rubyid_serialize'>serialize</span>(<span class='label'>preserve_newline:</span> <span class='kw'>true</span>)
<span class='comment'># =&gt; &lt;listing&gt;
</span><span class='comment'>#
</span><span class='comment'>#    Content&lt;/listing&gt;</span></code></pre>

<h3 id="label-Encodings">Encodings</h3>

<p><a href="../Nokogiri.html" title="Nokogiri (module)"><code>::Nokogiri</code></a> always parses <code>HTML5</code> using <a href="https://en.wikipedia.org/wiki/UTF-8" target="_parent" title="UTF-8">UTF-8</a>; however, the encoding of the input can be explicitly selected via the optional <code>encoding</code> parameter. This is most useful when the input comes not from a string but from an IO object.</p>

<p>When serializing a document or node, the encoding of the output string can be specified via the <code>:encoding</code> options. Characters that cannot be encoded in the selected encoding will be encoded as <a href="https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references">HTML numeric entities</a>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_frag'>frag</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_fragment'><a href="#fragment-class_method" title="Nokogiri::HTML5.fragment (method)">fragment</a></span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;span&gt;아는 길도 물어가라&lt;/span&gt;</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_html'>html</span> <span class='op'>=</span> <span class='id identifier rubyid_frag'>frag</span>.<span class='id identifier rubyid_serialize'>serialize</span>(<span class='label'>encoding:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>US-ASCII</span><span class='tstring_end'>&#39;</span></span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_html'>html</span>
<span class='comment'># =&gt; &lt;span&gt;&amp;#xc544;&amp;#xb294; &amp;#xae38;&amp;#xb3c4; &amp;#xbb3c;&amp;#xc5b4;&amp;#xac00;&amp;#xb77c;&lt;/span&gt;
</span>
<span class='id identifier rubyid_frag'>frag</span> <span class='op'>=</span> <span class='const'><a href="../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>HTML5</span>.<span class='id identifier rubyid_fragment'><a href="#fragment-class_method" title="Nokogiri::HTML5.fragment (method)">fragment</a></span>(<span class='id identifier rubyid_html'>html</span>)
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_frag'>frag</span>.<span class='id identifier rubyid_serialize'>serialize</span>
<span class='comment'># =&gt; &lt;span&gt;아는 길도 물어가라&lt;/span&gt;</span></code></pre>

<p>(There’s a <a href="https://bugs.ruby-lang.org/issues/15033" target="_parent" title="bug">bug</a> in all current versions of Ruby that can cause the entity encoding to fail. Of the mandated supported encodings for <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a>, the only encoding I’m aware of that has this bug is <code>&#39;ISO-2022-JP&#39;</code>. We recommend avoiding this encoding.)</p>

<h3 id="label-Notes">Notes</h3>
<ul><li>
<p>The <a href="#fragment-class_method" title="Nokogiri::HTML5.fragment (method)">.fragment</a> function takes a String or IO and parses it as a <code>HTML5</code> document in a <code>body</code> context. As a result, the <code>html</code>, <code>head</code>, and <code>body</code> elements are removed from this document, and any children of these elements that remain are returned as a Nokogiri::HTML5::DocumentFragment; but you can pass in a different context (e.g., “html” to get <code>head</code> and <code>body</code> tags in the result).</p>
</li><li>
<p>The <a href="#parse-class_method" title="Nokogiri::HTML5.parse (method)">.parse</a> function takes a String or IO and passes it to the <code>gumbo_parse_with_options</code> method, using the default options.  The resulting Gumbo parse tree is then walked.</p>
</li><li>
<p>Instead of uppercase element names, lowercase element names are produced.</p>
</li><li>
<p>Instead of returning <code>unknown</code> as the element name for unknown tags, the original tag name is returned verbatim.</p>
</li></ul>

<p>Since v1.12.0</p>

  </div>
</div>
</div>
<h2 class='h2_sum' id='class_method_summary'>Class Method Summary</h2>
<div class='div_sum'>
<ul class='summary full'>
  <li>
    <span class='summary_signature '>
      <a href="#fragment-class_method" title=".fragment (class method)">.<strong>fragment</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Convenience method for <a href="HTML5/DocumentFragment.html#parse-class_method" title="Nokogiri::HTML5::DocumentFragment.parse (method)">DocumentFragment.parse</a></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature '>
      <a href="#parse-class_method" title=".parse (class method)">.<strong>parse</strong>  </a>
    </span>
    <div class='summary_desc'>
      <div class='inline'><p>Convenience method for <a href="HTML5/Document.html#parse-class_method" title="Nokogiri::HTML5::Document.parse (method)">Document.parse</a></p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature priv'>
      <a href="#reencode-class_method" title=".reencode (class method)">.<strong>reencode</strong>(body, content_type = nil)  </a>
    </span>
    <span class='note title private'>private</span>
    <div class='summary_desc'>
      <div class='inline'><p>Charset sniffing is a complex and controversial topic that understandably isn’t done _by default_ by the Ruby <code>Net::HTTP</code> library.</p></div>
    </div>
  </li>
  <li>
    <span class='summary_signature nodoc'>
      <a href="#read_and_encode-class_method" title=".read_and_encode (class method)">.<strong>read_and_encode</strong>(string, encoding)  </a>
    </span>
    <span class='nodoc note title'>Internal use only</span>
  </li>
</ul>
</div>  <!-- class_method_summary -->

<h2 class='h2_sum' id='instance_Method_summary'>Instance Method Summary</h2>
<div class='div_sum'>

<h3 class='inherited'><a href="HTML5/Node.html" title="Nokogiri::HTML5::Node (module)"><code>Node</code></a> - Included</h3>
<div class='inherited'><table class='inherited'>
  <tbody>
    <tr>
      <td colspan='2'>
        <a class='i_m ' href="HTML5/Node.html#fragment-instance_method" title="Nokogiri::HTML5::Node#fragment (method)">#fragment</a>,
        <a class='i_m ' href="HTML5/Node.html#inner_html-instance_method" title="Nokogiri::HTML5::Node#inner_html (method)">#inner_html</a>,
        <a class='i_m ' href="HTML5/Node.html#write_to-instance_method" title="Nokogiri::HTML5::Node#write_to (method)">#write_to</a>,
      </td>
    </tr>
    <tr class='i_ds'>
      <td><a class='i_m priv' href="HTML5/Node.html#add_child_node_and_reparent_attrs-instance_method" title="Nokogiri::HTML5::Node#add_child_node_and_reparent_attrs (method)">#add_child_node_and_reparent_attrs</a></td>
      <td><div class='inline'><p><a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> elements can have attributes that contain colons.</p></div></td>
    </tr>
  </tbody>
</table></div>
</div>  <!-- instance_method_summary -->
<h2 class='y_details'>Class Method Details</h2>
<section class='method_details first' id="fragment-class_method">
  <h3 class='signature  first'>
    .<strong>fragment</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Convenience method for <a href="HTML5/DocumentFragment.html#parse-class_method" title="Nokogiri::HTML5::DocumentFragment.parse (method)">DocumentFragment.parse</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5.rb#L280-L282'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='280' data-end='282'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/nokogiri/html5.rb', line 280</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_fragment'>fragment</span>(<span class='op'>...</span>)
  <span class='const'><a href="HTML5/DocumentFragment.html" title="Nokogiri::HTML5::DocumentFragment (class)">DocumentFragment</a></span>.<span class='id identifier rubyid_parse'><a href="HTML5/DocumentFragment.html#parse-class_method" title="Nokogiri::HTML5::DocumentFragment.parse (method)">parse</a></span>(<span class='op'>...</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="parse-class_method">
  <h3 class='signature '>
    .<strong>parse</strong>  
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Convenience method for <a href="HTML5/Document.html#parse-class_method" title="Nokogiri::HTML5::Document.parse (method)">Document.parse</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5.rb#L275-L277'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='275' data-end='277'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/nokogiri/html5.rb', line 275</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_parse'>parse</span>(<span class='op'>...</span>)
  <span class='const'><a href="HTML5/Document.html" title="Nokogiri::HTML5::Document (class)">Document</a></span>.<span class='id identifier rubyid_parse'><a href="HTML5/Document.html#parse-class_method" title="Nokogiri::HTML5::Document.parse (method)">parse</a></span>(<span class='op'>...</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="read_and_encode-class_method">
  <h3 class='signature nodoc'>
    .<strong>read_and_encode</strong>(string, encoding)  
  </h3>
  <div class='note nodoc inline-block'>
    <strong>This method is for internal use only.</strong>
  </div><div></div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5.rb#L285-L307'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='285' data-end='307'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/nokogiri/html5.rb', line 285</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_read_and_encode'>read_and_encode</span>(<span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='id identifier rubyid_encoding'>encoding</span>)
  <span class='comment'># Read the string with the given encoding.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_respond_to?'>respond_to?</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_read'>read</span>)
    <span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span>.<span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_read'>read</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_read'>read</span>(<span class='label'>encoding:</span> <span class='id identifier rubyid_encoding'>encoding</span>)
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Otherwise the string has the given encoding.
</span>    <span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_encoding'>encoding</span>
      <span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_dup'>dup</span>
      <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_force_encoding'>force_encoding</span>(<span class='id identifier rubyid_encoding'>encoding</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># convert to UTF-8
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_string'>string</span>.<span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>!=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span>
    <span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='id identifier rubyid_reencode'><a href="#reencode-class_method" title="Nokogiri::HTML5.reencode (method)">reencode</a></span>(<span class='id identifier rubyid_string'>string</span>)
  <span class='kw'>end</span>
  <span class='id identifier rubyid_string'>string</span>
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>

<section class='method_details' id="reencode-class_method">
  <h3 class='signature priv'>
    .<strong>reencode</strong>(body, content_type = nil)   <span class="extras">(<span class='priv'>private</span>)</span>
  </h3>
<div class='docstring'>
  <div class='discussion'>
    
<p>Charset sniffing is a complex and controversial topic that understandably isn’t done _by default_ by the Ruby <code>Net::HTTP</code> library. This being said, it is a very real problem for consumers of <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> as the default for <a href="HTML.html" title="Nokogiri::HTML (module)"><code>HTML</code></a> is iso-8859-1, most “good” producers use utf-8, and the <a href="Gumbo.html" title="Nokogiri::Gumbo (module)"><code>Gumbo</code></a> parser <strong>only</strong> supports utf-8.</p>

<p>Accordingly, <a href="HTML4/Document.html#parse-class_method" title="Nokogiri::HTML4::Document.parse (method)">HTML4::Document.parse</a> provides limited encoding detection. Following this lead, <code>HTML5</code> attempts to do likewise, while attempting to more closely follow the <code>HTML5</code> standard.</p>

<p><a href="http://bugs.ruby-lang.org/issues/2567">bugs.ruby-lang.org/issues/2567</a> <a href="http://www.w3.org/TR/html5/syntax.html#determining-the-character-encoding">www.w3.org/TR/html5/syntax.html#determining-the-character-encoding</a></p>

  </div>
</div>
  <span class='link_repo'>[&#8202;<a class='repo' href='https://github.com/sparklemotion/nokogiri/blob/main/lib/nokogiri/html5.rb#L323-L363'>GitHub</a>&#8202;]</span>
<div class='source_code h'>
  <pre class='lines_num' data-start='323' data-end='363'></pre>
  <div class='lines_code'>
<pre><span class='info file'># File 'lib/nokogiri/html5.rb', line 323</span></pre>
<pre class='code ruby'>

<span class='kw'>def</span> <span class='id identifier rubyid_reencode'>reencode</span>(<span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_content_type'>content_type</span> <span class='op'>=</span> <span class='kw'>nil</span>)
  <span class='kw'>if</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>==</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ASCII_8BIT</span>
    <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='kw'>nil</span>

    <span class='comment'># look for a Byte Order Mark (BOM)
</span>    <span class='id identifier rubyid_initial_bytes'>initial_bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>[<span class='int'>0</span><span class='op'>..</span><span class='int'>2</span>].<span class='id identifier rubyid_bytes'>bytes</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_initial_bytes'>initial_bytes</span>[<span class='int'>0</span><span class='op'>..</span><span class='int'>2</span>] <span class='op'>==</span> [<span class='int'>0xEF</span><span class='comma'>,</span> <span class='int'>0xBB</span><span class='comma'>,</span> <span class='int'>0xBF</span>]
      <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_initial_bytes'>initial_bytes</span>[<span class='int'>0</span><span class='op'>..</span><span class='int'>1</span>] <span class='op'>==</span> [<span class='int'>0xFE</span><span class='comma'>,</span> <span class='int'>0xFF</span>]
      <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_16BE</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_initial_bytes'>initial_bytes</span>[<span class='int'>0</span><span class='op'>..</span><span class='int'>1</span>] <span class='op'>==</span> [<span class='int'>0xFF</span><span class='comma'>,</span> <span class='int'>0xFE</span>]
      <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_16LE</span>
    <span class='kw'>end</span>

    <span class='comment'># look for a charset in a content-encoding header
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_content_type'>content_type</span>
      <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>||=</span> <span class='id identifier rubyid_content_type'>content_type</span>[<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>charset=[&quot;&#39;]?(.*?)($|[&quot;&#39;;\s])</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='int'>1</span>]
    <span class='kw'>end</span>

    <span class='comment'># look for a charset in a meta tag in the first 1024 bytes
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_encoding'>encoding</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>[<span class='int'>0</span><span class='op'>..</span><span class='int'>1023</span>].<span class='id identifier rubyid_gsub'>gsub</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;!--.*?(--&gt;|\Z)</span><span class='regexp_end'>/m</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>)
      <span class='id identifier rubyid_data'>data</span>.<span class='id identifier rubyid_scan'>scan</span>(<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;meta.*?&gt;</span><span class='regexp_end'>/im</span></span>).<span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_meta'>meta</span><span class='op'>|</span>
        <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>||=</span> <span class='id identifier rubyid_meta'>meta</span>[<span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>charset=[&quot;&#39;]?([^&gt;]*?)($|[&quot;&#39;\s&gt;])</span><span class='regexp_end'>/im</span></span><span class='comma'>,</span> <span class='int'>1</span>]
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># if all else fails, default to the official default encoding for HTML
</span>    <span class='id identifier rubyid_encoding'>encoding</span> <span class='op'>||=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ISO_8859_1</span>

    <span class='comment'># change the encoding to match the detected or inferred encoding
</span>    <span class='id identifier rubyid_body'>body</span> <span class='op'>=</span> <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_dup'>dup</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_force_encoding'>force_encoding</span>(<span class='id identifier rubyid_encoding'>encoding</span>)
    <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
      <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_force_encoding'>force_encoding</span>(<span class='const'>Encoding</span><span class='op'>::</span><span class='const'>ISO_8859_1</span>)
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_body'>body</span>.<span class='id identifier rubyid_encode'>encode</span>(<span class='const'>Encoding</span><span class='op'>::</span><span class='const'>UTF_8</span>)
<span class='kw'>end</span>
</pre>
  </div>
</div>
</section>


<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>