<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Searching a Xml Html Document &mdash; Nokogiri main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "searching_a_xml_html_document",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Nokogiri main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Searching a Xml Html Document&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Searching an HTML / XML Document</h1>

<h2>Basic Searching</h2>

<p>Let&#39;s suppose you have the following document:</p>

<pre class="code xml"><code class="xml">&lt;root&gt;
  &lt;sitcoms&gt;
    &lt;sitcom&gt;
      &lt;name&gt;Married with Children&lt;/name&gt;
      &lt;characters&gt;
        &lt;character&gt;Al Bundy&lt;/character&gt;
        &lt;character&gt;Bud Bundy&lt;/character&gt;
        &lt;character&gt;Marcy Darcy&lt;/character&gt;
      &lt;/characters&gt;
    &lt;/sitcom&gt;
    &lt;sitcom&gt;
      &lt;name&gt;Perfect Strangers&lt;/name&gt;
      &lt;characters&gt;
        &lt;character&gt;Larry Appleton&lt;/character&gt;
        &lt;character&gt;Balki Bartokomous&lt;/character&gt;
      &lt;/characters&gt;
    &lt;/sitcom&gt;
  &lt;/sitcoms&gt;
  &lt;dramas&gt;
    &lt;drama&gt;
      &lt;name&gt;The A-Team&lt;/name&gt;
      &lt;characters&gt;
        &lt;character&gt;John &quot;Hannibal&quot; Smith&lt;/character&gt;
        &lt;character&gt;Templeton &quot;Face&quot; Peck&lt;/character&gt;
        &lt;character&gt;&quot;B.A.&quot; Baracus&lt;/character&gt;
        &lt;character&gt;&quot;Howling Mad&quot; Murdock&lt;/character&gt;
      &lt;/characters&gt;
    &lt;/drama&gt;
  &lt;/dramas&gt;
&lt;/root&gt;
</code></pre>

<p>Let&#39;s further suppose that you want a list of all the characters in
all the shows in this document.</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_xpath'>xpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//character</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;character&gt;Al Bundy&lt;/character&gt;
&lt;character&gt;Bud Bundy&lt;/character&gt;
&lt;character&gt;Marcy Darcy&lt;/character&gt;
&lt;character&gt;Larry Appleton&lt;/character&gt;
&lt;character&gt;Balki Bartokomous&lt;/character&gt;
&lt;character&gt;John &quot;Hannibal&quot; Smith&lt;/character&gt;
&lt;character&gt;Templeton &quot;Face&quot; Peck&lt;/character&gt;
&lt;character&gt;&quot;B.A.&quot; Baracus&lt;/character&gt;
&lt;character&gt;&quot;Howling Mad&quot; Murdock&lt;/character&gt;
</code></pre>

<p>The <code>Node</code> methods <code>xpath</code> and <code>css</code> actually return a <a href="https://nokogiri.org/rdoc/Nokogiri/XML/NodeSet">NodeSet</a>,
which acts very much like an array, and contains matching nodes from
the document.</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_characters'>characters</span> <span class='op'>=</span> <span class='ivar'>@doc</span>.<span class='id identifier rubyid_xpath'>xpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//character</span><span class='tstring_end'>&quot;</span></span>)
<span class='id identifier rubyid_characters'>characters</span>[<span class='int'>0</span>].<span class='id identifier rubyid_to_s'>to_s</span></code></pre>

<pre class="code xml"><code class="xml">&lt;character&gt;Al Bundy&lt;/character&gt;
</code></pre>

<p>You can use any XPath or CSS query you like (see the chapter on XPath
and CSS syntax for more information).</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_xpath'>xpath</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>//dramas//character</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;character&gt;John &quot;Hannibal&quot; Smith&lt;/character&gt;
&lt;character&gt;Templeton &quot;Face&quot; Peck&lt;/character&gt;
&lt;character&gt;&quot;B.A.&quot; Baracus&lt;/character&gt;
&lt;character&gt;&quot;Howling Mad&quot; Murdock&lt;/character&gt;
</code></pre>

<p>Notably, you can even use CSS queries in an XML document!</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_characters'>characters</span> <span class='op'>=</span> <span class='ivar'>@doc</span>.<span class='id identifier rubyid_css'>css</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sitcoms name</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;name&gt;Married with Children&lt;/name&gt;
&lt;name&gt;Perfect Strangers&lt;/name&gt;
</code></pre>

<p>CSS queries are often the easiest and most succinct way to express
what you&#39;re looking for, so don&#39;t be afraid to use them!</p>

<h2>Single Results</h2>

<p>If you know you&#39;re going to get only a single result back, you can use
the shortcuts <code>at_css</code> and <code>at_xpath</code> instead of having to access the
first element of a NodeSet.</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_css'>css</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dramas name</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_first'>first</span></code></pre>

<pre class="code xml"><code class="xml">&lt;name&gt;The A-Team&lt;/name&gt;
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_at_css'>at_css</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dramas name</span><span class='tstring_end'>&quot;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;name&gt;The A-Team&lt;/name&gt;
</code></pre>

<h2>Namespaces</h2>

<p>Just like our Ruby code, XML can suffer from name collisions.  For example,
an autoparts dealer can sell tires and so can a bike dealer.  Both of them
may use a &quot;tire&quot; tag to describe the tires they sell.  However, we need to be
able to tell the difference between a <em>car tire</em> and a <em>bike tire</em>.  This is
where namespaces come to the rescue.</p>

<p>Namespaces associate tags with a unique URL.  Let&#39;s take a look at the autoparts
store&#39;s XML versus the bike stores:</p>

<pre class="code xml"><code class="xml">&lt;parts&gt;
  &lt;!-- Alice&#39;s Auto Parts Store --&gt;
  &lt;inventory xmlns=&quot;http://alicesautoparts.com/&quot;&gt;
    &lt;tire&gt;all weather&lt;/tire&gt;
    &lt;tire&gt;studded&lt;/tire&gt;
    &lt;tire&gt;extra wide&lt;/tire&gt;
  &lt;/inventory&gt;

  &lt;!-- Bob&#39;s Bike Shop --&gt;
  &lt;inventory xmlns=&quot;http://bobsbikes.com/&quot;&gt;
    &lt;tire&gt;street&lt;/tire&gt;
    &lt;tire&gt;mountain&lt;/tire&gt;
  &lt;/inventory&gt;
&lt;/parts&gt;
</code></pre>

<p>Since the URLs are unique, we can associate our query with a URL and get only
the tires belonging to <em>that</em> url:</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span> <span class='op'>=</span> <span class='const'><a href="Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'><a href="Nokogiri/XML.html" title="Nokogiri::XML (module)">XML</a></span>(<span class='const'>File</span>.<span class='id identifier rubyid_read'>read</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>parts.xml</span><span class='tstring_end'>&quot;</span></span>))

<span class='id identifier rubyid_car_tires'>car_tires</span> <span class='op'>=</span> <span class='ivar'>@doc</span>.<span class='id identifier rubyid_xpath'>xpath</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//car:tire</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>car</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://alicesautoparts.com/</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;tire&gt;all weather&lt;/tire&gt;
&lt;tire&gt;studded&lt;/tire&gt;
&lt;tire&gt;extra wide&lt;/tire&gt;
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bike_tires'>bike_tires</span> <span class='op'>=</span> <span class='ivar'>@doc</span>.<span class='id identifier rubyid_xpath'>xpath</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//bike:tire</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>bike</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://bobsbikes.com/</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;tire&gt;street&lt;/tire&gt;
&lt;tire&gt;mountain&lt;/tire&gt;
</code></pre>

<p>To make this namespace registration a bit easier, nokogiri will automatically
register any namespaces it finds on the root node <em>for you</em>.  Nokogiri will
associate the name in the declaration with the supplied URL.  If we stick to
this naming convention, we can shorten up our code.</p>

<p>Let&#39;s take this atom feed for example:</p>

<pre class="code xml"><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;

  &lt;title&gt;Example Feed&lt;/title&gt;
  &lt;link href=&quot;http://example.org/&quot;/&gt;
  &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
  &lt;author&gt;
    &lt;name&gt;John Doe&lt;/name&gt;
  &lt;/author&gt;
  &lt;id&gt;urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6&lt;/id&gt;

  &lt;entry&gt;
    &lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
    &lt;link href=&quot;http://example.org/2003/12/13/atom03&quot;/&gt;
    &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
    &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
    &lt;summary&gt;Some text.&lt;/summary&gt;
  &lt;/entry&gt;

&lt;/feed&gt;
</code></pre>

<p>If we stick to the convention, we can grab all title tags like this</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_xpath'>xpath</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//xmlns:title</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;title&gt;Example Feed&lt;/title&gt;
&lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
</code></pre>

<p>Don&#39;t be fooled though.  You <em>do not</em> have to use XPath to get the benefits of
namespaces.  CSS selectors can be used as well.  CSS just uses the pipe symbol
to indicate a namespace search.</p>

<p>Let&#39;s see the previous search rewritten to use CSS:</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_css'>css</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>xmlns|title</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;title&gt;Example Feed&lt;/title&gt;
&lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
</code></pre>

<p>When using CSS, if the namespace is called &quot;xmlns&quot;, you can even omit the
namespace name.  That means your CSS will reduce to:</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@doc</span>.<span class='id identifier rubyid_css'>css</span>(<span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>title</span><span class='tstring_end'>&#39;</span></span>)</code></pre>

<pre class="code xml"><code class="xml">&lt;title&gt;Example Feed&lt;/title&gt;
&lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
</code></pre>

<p>Dealing with namespaces is a broad topic.  If you need more examples, be sure
to check out <a href="http://tenderlovemaking.com/2009/04/23/namespaces-in-xml/">this blog post</a> or send an email to the <a href="http://groups.google.com/group/nokogiri-talk">mailing list</a>, and
we can help out.</p>

<h2>But I&#39;m Lazy and Don&#39;t Want to Deal With Namespaces!</h2>

<p>Lazy == Efficient, so no judgements. :)</p>

<p>If you have an XML document with namespaces, but would prefer to
ignore them entirely (and query as if Tim Bray had never invented
them), then you can call <a href="https://nokogiri.org/rdoc/Nokogiri/XML/Document#remove_namespaces%21-instance_method">remove_namespaces!</a> on an XML::Document to
remove all namespaces. Of course, if the document had nodes with the
same names but different namespaces, they will now be ambiguous. But
you&#39;re lazy! You don&#39;t care!</p>

<h2>Slop [^1]</h2>

<p>Maybe you want a more interactive (read: sloppy) way to access nodes
and attributes. If you like what <a href="http://xml-simple.rubyforge.org/">XmlSimple</a> does, then you&#39;ll
probably like Nokogiri&#39;s Slop mode.[^2]</p>

<p>Slop mode allows you to violate the Law of Demeter with extreme
prejudice, by using <code>#method_missing</code> to introspect on a node&#39;s child tags.[^3]</p>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'><a href="Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span><span class='op'>::</span><span class='const'>Slop</span> <span class='heredoc_beg'>&lt;&lt;-EOXML</span>
<span class='tstring_content'>&lt;employees&gt;
  &lt;employee status=&quot;active&quot;&gt;
    &lt;fullname&gt;Dean Martin&lt;/fullname&gt;
  &lt;/employee&gt;
  &lt;employee status=&quot;inactive&quot;&gt;
    &lt;fullname&gt;Jerry Lewis&lt;/fullname&gt;
  &lt;/employee&gt;
&lt;/employees&gt;
</span><span class='heredoc_end'>EOXML
</span>
<span class='comment'># navigate!
</span><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_employees'>employees</span>.<span class='id identifier rubyid_employee'>employee</span>.<span class='id identifier rubyid_last'>last</span>.<span class='id identifier rubyid_fullname'>fullname</span>.<span class='id identifier rubyid_content'>content</span></code></pre>

<pre class="code xml"><code class="xml">Jerry Lewis
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># access node attributes!
</span><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_employees'>employees</span>.<span class='id identifier rubyid_employee'>employee</span>.<span class='id identifier rubyid_first'>first</span>[<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>status</span><span class='tstring_end'>&quot;</span></span>]</code></pre>

<pre class="code xml"><code class="xml">active
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># use some xpath!
</span><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_employees'>employees</span>.<span class='id identifier rubyid_employee'>employee</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[@status=&#39;active&#39;]</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_fullname'>fullname</span>.<span class='id identifier rubyid_content'>content</span></code></pre>

<pre class="code xml"><code class="xml">Dean Martin
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_employees'>employees</span>.<span class='id identifier rubyid_employee'>employee</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_xpath'>xpath</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@status=&#39;active&#39;</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_fullname'>fullname</span>.<span class='id identifier rubyid_content'>content</span></code></pre>

<pre class="code xml"><code class="xml">Dean Martin
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># use some css!
</span><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_employees'>employees</span>.<span class='id identifier rubyid_employee'>employee</span>(<span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[status=&#39;active&#39;]</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_fullname'>fullname</span>.<span class='id identifier rubyid_content'>content</span></code></pre>

<pre class="code xml"><code class="xml">Dean Martin
</code></pre>

<p>Code &amp; Output:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_doc'>doc</span>.<span class='id identifier rubyid_employees'>employees</span>.<span class='id identifier rubyid_employee'>employee</span>(<span class='symbeg'>:</span><span class='id identifier rubyid_css'>css</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[status=&#39;active&#39;]</span><span class='tstring_end'>&quot;</span></span>).<span class='id identifier rubyid_fullname'>fullname</span>.<span class='id identifier rubyid_content'>content</span></code></pre>

<pre class="code xml"><code class="xml">Dean Martin
</code></pre>

<p>Aww yeah. Can you feel the spirit of <a href="http://twitter.com/jbarnette">@jbarnette</a> and
<a href="http://twitter.com/nakajima">@nakajima</a> flowing through you? That&#39;s the power of the
<em>slop</em>.[^4]</p>

<p>[^1]: Don&#39;t use this.
  [^2]: This may or may not be a backhanded compliment.
  [^3]: No, really, don&#39;t use this. If you use it, don&#39;t report bugs.
  [^4]: You&#39;ve been warned!</p>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>