<!DOCTYPE html>
<html>
<head>

<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='apple-touch-fullscreen'       content='yes'>
<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='apple-mobile-web-app-status-bar-style' content='rgba(228,228,228,1.0)'>

<title>File: Installing Nokogiri &mdash; Nokogiri main</title>

<link rel='stylesheet'  type='text/css' href='../css/y_fonts.css' />
<link rel='stylesheet'  type='text/css' href='../css/highlight.github.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_style.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_list.css' />
<link rel='stylesheet'  type='text/css' href='../css/y_color.css' />

<script type='text/javascript'>
  var pathId = "installing_nokogiri",
    relpath = '';

  var t2Info = {
    CSEP: '.',
    ISEP: '#',
    NSEP: '::'
  };
</script>

<script type='text/javascript' charset='utf-8' src='../js/highlight.pack.js'></script>
<script type='text/javascript' charset='utf-8' src='../js/y_app.js'></script>

</head>
<body>
<svg id='y_wait' class viewBox='0 0 90 90'></svg>
<div id='settings' class='hidden'></div>
<div id='y_list' class='d h'>
  <header id='list_header'></header>
  <nav id= 'list_nav' class='y_nav l_nav'>
    <ul id='list_items'></ul>
  </nav>
</div>
<div id='y_toc' class='f h'>
  <header id='toc_header'></header>
  <nav id= 'toc_nav' class='y_nav t_nav'>
  <ol id='toc_items'></ol>
  </nav>
</div>
<div id='y_main' tabindex='-1'>
  <header id='y_header'>
    <div id='y_menu'>
      <a id='home_no_xhr' href='/'>Home</a> &raquo; 
      <a href='.'>Nokogiri main</a> &raquo; 
      <a href='_index.html'>Index</a> &raquo; 
      <span class='title'><a id='t2_doc_top' href='#'>File: Installing Nokogiri&nbsp;&#x25B2;</a></span>
          </div>

    <a id='list_href' href="class_list.html"></a>
    <div id='y_measure_em' class='y_measure'></div>
    <div id='y_measure_vh' class='y_measure'></div>
    <span id='y_measure_50pre' class='y_measure'><code>123456789_123456789_123456789_123456789_123456789_</code></span>
  </header>
<div id='content' class='file'>
<h1>Installing Nokogiri</h1>

<p>Welcome! We&#39;ve spent quite a bit of time over the past year trying to make <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> v1.11 easy and reliable to install. This page should hopefully get you on your way quickly.</p>

<h2>Meta</h2>

<p>The current version of this page focuses on the installation experience for <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> v1.11.x. If you&#39;re trying to install an earlier version, please visit:</p>

<ul>
<li>[Nokogiri v1.10.x installation instructions])</li>
</ul>

<p>If this document doesn&#39;t address your problem, please jump over to <a href="https://nokogiri.org/tutorials/getting_help.html">Getting Help</a>.</p>

<p>If you&#39;d like to contribute improvements to this document, please open a GitHub issue or pull-request on [nokogiri.org/installing_nokogiri.md]).</p>

<h2>Installing Native Gems</h2>

<h3>Faster, more reliable installation</h3>

<p>&quot;Native gems&quot; contain pre-compiled libraries for a specific machine architecture. On supported platforms, this removes the need for compiling the C extension and the packaged libraries, or for system dependencies to exist. This results in <strong>much faster installation</strong> and <strong>more reliable installation</strong>, which as you probably know are the biggest headaches for <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> users.</p>

<h3>Supported Platforms</h3>

<p>As of v1.11.0, <a href="Nokogiri.html" title="Nokogiri (module)"><code>Nokogiri</code></a> ships pre-compiled, &quot;native&quot; gems for the following platforms:</p>

<ul>
<li>Linux: <code>x86-linux</code> and <code>x86_64-linux</code> (req: <code>glibc &gt;= 2.17</code>), including musl platforms like Alpine</li>
<li>Darwin/MacOS: <code>x86_64-darwin</code> and <code>arm64-darwin</code></li>
<li>Windows: <code>x86-mingw32</code> and <code>x64-mingw32</code></li>
<li>Java: any platform running JRuby 9.2 or higher</li>
</ul>

<p>To determine whether your system supports one of these gems, look at the output of <code>bundle platform</code> or <code>ruby -e &#39;puts Gem::Platform.local.to_s&#39;</code>.</p>

<p>If you&#39;re on a supported platform, either <code>gem install</code> or <code>bundle install</code> should install a native gem without any additional action on your part. This installation should only take a few seconds, and your output should look something like:</p>

<pre class="code text"><code class="text">$ gem install nokogiri
Fetching nokogiri-1.11.0-x86_64-linux.gem
Successfully installed nokogiri-1.11.0-x86_64-linux
1 gem installed
</code></pre>

<h3>Why would I not want to use a native gem?</h3>

<p>I can imagine some folks might have trust issues; if this is you, please let us know in a comment at <a href="https://github.com/sparklemotion/nokogiri/issues/2013">RFC: Increase the level of trust in released gem files · Issue #2013 · sparklemotion/nokogiri</a>. What can we do to increase that trust? (I can imagine providing a chain of custody including public build logs with cryptographic hashes of artifacts, but I&#39;d like to hear from real users.)</p>

<p>Anybody on a linux system old enough to not have <code>glibc &gt;= 2.17</code> will need to install from the <code>ruby</code> platform gem.</p>

<p>If you have other reasons for not wanting to use a precompiled native gem, let us know! (See <a href="https://nokogiri.org/tutorials/getting_help.html">Getting Help</a>.)</p>

<h3>How can I avoid using a precompiled native gem?</h3>

<p>The Nokogiri maintainers strongly urge you to use a native gem if at all possible. We expect it will be a much better experience for you and allow us to focus our efforts on improving functionality rather than diagnosing installation issues.</p>

<p>If you&#39;re on a platform that supports a native gem but you want to avoid using it in your project, do one of the following:</p>

<ul>
<li>If you&#39;re not using bundler, then run <code>gem install nokogiri --platform=ruby</code></li>
<li>If you are using bundler, then you&#39;ll need to run <code>bundle config set force_ruby_platform true</code></li>
</ul>

<h2>Installing the <code>ruby</code> platform gem</h2>

<p>Again, we recommend that you upgrade to v1.11.x and use a native gem whenever possible. If you&#39;re here, it should be because you&#39;re on an older version, or you&#39;re on an unsupported platform.</p>

<p><strong>Before you begin, make sure you have the full compiler toolchain for compiling Ruby C Extensions.</strong> See <a href="#appendix-a-the-compiler-toolchain">Appendix A: The Compiler Toolchain</a>.</p>

<h3>Installing Using The Packaged Libraries</h3>

<p>Nokogiri packages its own updated and patched copies of <a href="http://xmlsoft.org/">libxml2</a> and <a href="http://xmlsoft.org/libxslt/">libxslt</a> source code. By default, installation of Nokogiri will compile and use these packaged libraries.</p>

<p>If you don&#39;t see your operating system / distro in this section, then no additional setup is required beyond <a href="#appendix-a-the-compiler-toolchain">Appendix A: The Compiler Toolchain</a>. Just run <code>gem install nokogiri --platform=ruby</code>.</p>

<h4>Ubuntu or Debian-based Distros</h4>

<pre class="code sh"><code class="sh">sudo apt-get install zlib1g-dev liblzma-dev patch
gem install nokogiri --platform=ruby
</code></pre>

<p>You may substitute <code>git</code> for <code>patch</code> (<code>mini_portile2</code> can use either for applying patches).</p>

<h4>Fedora, Red Hat, and CentOS</h4>

<pre class="code sh"><code class="sh">dnf install -y zlib-devel
gem install nokogiri --platform=ruby
</code></pre>

<h4>OpenBSD &lt; 6.2</h4>

<p>Use <code>gcc</code> from ports in order to compile the packaged libraries:</p>

<pre class="code sh"><code class="sh">pkg_add -v gcc
gem install nokogiri --platform=ruby
</code></pre>

<h3>Installing Using Standard System Libraries</h3>

<p>Rather than use Nokogiri&#39;s packaged versions, you may prefer to use your system&#39;s or distro&#39;s standard libxml2/libxslt libraries. This section will try to help you do that.</p>

<p>Nokogiri will refuse to build against older, unsupported versions of <code>libxml2</code> and <code>libxslt</code>, and there may be some behavioral changes when using older versions. If you have installed libxml2 or libxslt to a custom location, please jump to the next section, <a href="#installing-with-custom-non-standard-libraries">Installing With Custom / Non-Standard Libraries</a>.</p>

<p>If you don&#39;t see your operating system or distro listed below, then no additional setup is required beyond <a href="#appendix-a-the-compiler-toolchain">Appendix A: The Compiler Toolchain</a>. Just run <code>gem install nokogiri --platform=ruby -- --use-system-libraries</code>. Or, if you&#39;re using bundler, <code>bundle config build.nokogiri --use-system-libraries</code>.</p>

<h4>Debian/Ubuntu</h4>

<pre class="code sh"><code class="sh">sudo apt-get install pkg-config libxml2-dev libxslt-dev
gem install nokogiri --platform=ruby -- --use-system-libraries
</code></pre>

<h4>MacOS</h4>

<p>If you&#39;re using homebrew:</p>

<pre class="code sh"><code class="sh">brew install libxml2 libxslt
gem install nokogiri --platform=ruby -- --use-system-libraries
</code></pre>

<p>If you&#39;re using macports and would like to contribute documentation, please open a GitHub issue or pull-request on [nokogiri.org/installing_nokogiri.md]).</p>

<h4>FreeBSD</h4>

<pre class="code sh"><code class="sh">sudo pkg install pkgconf
gem install nokogiri --platform=ruby -- --use-system-libraries
</code></pre>

<h4>Windows</h4>

<p>We recommend installing Nokogiri against the MSYS2 system libraries:</p>

<pre class="code sh"><code class="sh">ridk exec pacman -S mingw-w64-x86_64-libxslt
gem install nokogiri --platform=ruby -- --use-system-libraries
</code></pre>

<h3>Installing With Custom / Non-Standard Libraries</h3>

<p>You may have your own custom version of libxml2/libxslt that you&#39;d like to use. OK! Here we go.</p>

<p>Ideally you can install <code>pkg-config</code> and the installed libraries should self-describe how to compile and build against themselves.</p>

<p>But if:</p>

<ul>
<li>you&#39;ve got <code>libxml2</code> and/or <code>libxslt</code> installed in a nonstandard place,</li>
<li>and you don&#39;t have <code>pkg-config</code> installed</li>
</ul>

<p>... then you can use command-line parameters to the <code>gem install</code> command to specify build parameters.</p>

<p>You can specify the installation root directory:</p>

<pre class="code sh"><code class="sh">gem install nokogiri -- \
    --use-system-libraries \
    --with-xml2-dir=/path/to/dir \
    --with-xslt-dir=/path/to/dir
</code></pre>

<p>or, you can specify include and library directories separately:</p>

<pre class="code sh"><code class="sh">gem install nokogiri -- \
    --use-system-libraries \
    --with-xml2-lib=/path/to/builds/lib \
    --with-xml2-include=/path/to/builds/include/libxml2 \
    --with-xslt-lib=/path/to/builds/lib \
    --with-xslt-include=/path/to/builds/include
</code></pre>

<p><em>Note: By default, libxslt header files are installed into the root include directory, but libxml2 header files are installed into a subdirectory thereof named <code>libxml2</code>.</em></p>

<p>It&#39;s likely that you&#39;ll also need to specify the location of your <code>zlib</code> and <code>iconv</code> (and possibly <code>exslt</code>) install directories as well. In that case, you can add the options:</p>

<pre class="code sh"><code class="sh">gem install nokogiri -- \
    --use-system-libraries \
    # ...
    --with-iconv-dir=/path/to/dir \
    --with-zlib-dir=/path/to/dir \
    [--with-exslt-dir=/path/to/dir]
    [--with-exslt-config=/path/to/exslt-config]
</code></pre>

<p>You can also tell bundler to remember these configuration parameters:</p>

<pre class="code sh"><code class="sh">bundle config build.nokogiri \
       --use-system-libraries \
       --with-xml2-lib=/usr/local/lib \
       --with-xml2-include=/usr/local/include/libxml2/libxml \
       --with-xslt-lib=/usr/local/lib \
       --with-xslt-include=/usr/local/include/libxslt \
       --with-iconv-lib=/usr/local/lib \
       --with-iconv-include=/usr/local/include
</code></pre>

<p>Do not attempt Bundler installation using Bundler versions before v1.8.3 (see <a href="https://github.com/bundler/bundler/issues/3053">bundler/bundler#3053</a> for details). If you really must, see earlier git history of [this file]), which includes a workaround.</p>

<h3>Installing Third-Party Distributions of Nokogiri</h3>

<h4>Debian</h4>

<p>See <a href="https://packages.debian.org/sid/ruby-nokogiri">https://packages.debian.org/sid/ruby-nokogiri</a></p>

<pre class="code sh"><code class="sh">sudo apt-get install ruby-nokogiri
</code></pre>

<h4>openSUSE/SLE</h4>

<p>See <a href="https://download.opensuse.org/repositories/devel:/languages:/ruby:/extensions/">https://download.opensuse.org/repositories/devel:/languages:/ruby:/extensions/</a></p>

<h4>Fedora, Red Hat, and CentOS</h4>

<p>You may install the appropriate <a href="http://fedoraproject.org/wiki/EPEL#How_can_I_use_these_extra_packages.3F">epel-release</a> and get the Nokogiri package from <a href="http://fedoraproject.org/wiki/EPEL">EPEL</a> using:</p>

<pre class="code sh"><code class="sh">sudo dnf install -y rubygem-nokogiri
</code></pre>

<h4>GNU Guix</h4>

<p>Install on any Linux distribution using <a href="https://www.gnu.org/software/guix/">GNU Guix</a>, a reproducible binary software package management and distribution system.</p>

<p>Use this command:</p>

<pre class="code sh"><code class="sh">guix package -i ruby-nokogiri
</code></pre>

<p><em>Note: source code is available <a href="http://git.savannah.gnu.org/cgit/guix.git/tree/gnu/packages/ruby.scm">here</a>. A short description of how Nokogiri was packaged can be found <a href="https://github.com/pjotrp/guix-notes/blob/master/RUBYGEMS-Nokogiri.org">here</a>.</em></p>

<h3>Other Installation Scenarios</h3>

<h4>Alpine Docker Images</h4>

<p>To just install the native gem:</p>

<pre class="code Dockerfile"><code class="Dockerfile">FROM ruby:3.0-alpine

RUN gem install nokogiri
</code></pre>

<p>To compile with the packaged libraries:</p>

<pre class="code Dockerfile"><code class="Dockerfile">FROM ruby:3.0-alpine

RUN apk add --no-cache build-base
RUN gem install nokogiri --platform=ruby
</code></pre>

<p>To compile against Alpine&#39;s own XML libraries, add the necessary development tools and libraries to the image.</p>

<pre class="code Dockerfile"><code class="Dockerfile">FROM ruby:3.0-alpine

RUN apk add --no-cache build-base libxml2-dev libxslt-dev
RUN gem install nokogiri --platform=ruby -- --use-system-libraries
</code></pre>

<p>When optimizing the size of an Alpine image, the runtime libraries must be permanently added. Additionally, adding and removing development tooling can be chained with gem installation to ensure a small layer.</p>

<pre class="code Dockerfile"><code class="Dockerfile">FROM ruby:3.0-alpine

RUN apk add --no-cache libxml2 libxslt &amp;&amp; \
        apk add --no-cache --virtual .gem-installdeps build-base libxml2-dev libxslt-dev &amp;&amp; \
        gem install nokogiri --platform=ruby -- --use-system-libraries &amp;&amp; \
        rm -rf $GEM_HOME/cache &amp;&amp; \
        apk del .gem-installdeps
</code></pre>

<p>This approach nets an 12.1 MB layer (versus 18.1 MB without <code>--use-system-libraries</code>)
and saves over 170 MB in build tools.</p>

<h4>TermUX</h4>

<p>Although TermUX isn&#39;t fully supported right now, some people have reported success getting Nokogiri installed on it by running these commands:</p>

<pre class="code sh"><code class="sh">pkg install ruby clang make pkg-config libxslt
gem install nokogiri --platform=ruby -- --use-system-libraries
</code></pre>

<h4>SmartOS (Nonstandard)</h4>

<p>SmartOS installation requires building and using libxml2/libxslt/libiconv in a nonstandard location. Building on the previous section, here&#39;s how to do it:</p>

<p>(Note: <code>pkgsrc</code> is included in JPC SmartOS instances)</p>

<pre class="code sh"><code class="sh">pkgin install ruby gcc49 libxml2 libxslt zlib libiconv ruby22-rake gmake
ln -s /opt/local/gcc49/bin/gcc /opt/local/bin/gcc

gem install nokogiri -- \
    --use-system-libraries \
    --with-xml2-lib=/opt/local/lib \
    --with-xml2-include=/opt/local/include/libxml2 \
    --with-xslt-lib=/opt/local/lib \
    --with-xslt-include=/opt/local/include/libxslt \
    --with-iconv-lib=/opt/local/lib \
    --with-iconv-include=/opt/local/include \
    --with-zlib-dir=/opt/local/lib
</code></pre>

<p>See the previous section for guidance on how to instruct Bundler to use these options.</p>

<h2>Troubleshooting</h2>

<h3>Using <code>vendor/cache</code> to deploy to another architecture</h3>

<p>A common workflow is for a team to develop on a Mac but deploy to production on Linux. This workflow depends on Bundler caching an appropriate gem file in <code>vendor/cache</code>. Unfortunately, in this situation Bundler&#39;s default behavior is to cache only gems for the development system and not the production system, leading to an error at deploy time.</p>

<h4>Symptoms</h4>

<p>During deployment, the buildpack may fail to find a relevant gem in <code>vendor/cache</code> and emit an error like this (from Heroku):</p>

<p>``` text hl_lines=&quot;8-11&quot;
-----&gt; Ruby app detected
-----&gt; Installing bundler 2.1.4
-----&gt; Removing BUNDLED WITH version in the Gemfile.lock
-----&gt; Compiling Ruby/Rails
-----&gt; Using Ruby version: ruby-2.7.2
-----&gt; Installing dependencies using bundler 2.1.4
       Running: BUNDLE_WITHOUT=&#39;development:test&#39; BUNDLE_PATH=vendor/bundle BUNDLE_BIN=vendor/bundle/bin BUNDLE_DEPLOYMENT=1 bundle install -j4
       Some gems seem to be missing from your vendor/cache directory.
       Could not find nokogiri-1.11.0 in any of the sources
       Bundler Output: Some gems seem to be missing from your vendor/cache directory.
       Could not find nokogiri-1.11.0 in any of the sources
 !
 !     Failed to install gems via Bundler.
 !
 !     Push rejected, failed to compile Ruby app.
 !     Push failed</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#### Solution
</span>
<span class='const'>Bundler</span> <span class='float'>2.2</span> <span class='kw'>and</span> <span class='id identifier rubyid_later'>later</span> <span class='id identifier rubyid_has'>has</span> <span class='op'>*</span><span class='id identifier rubyid_great'>great</span><span class='op'>*</span> <span class='id identifier rubyid_multiplatform'>multiplatform</span> <span class='id identifier rubyid_support'>support</span> <span class='kw'>and</span> <span class='id identifier rubyid_allows'>allows</span> <span class='id identifier rubyid_you'>you</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_cache'>cache</span> <span class='id identifier rubyid_gems'>gems</span> <span class='kw'>for</span> <span class='id identifier rubyid_multiple'>multiple</span> <span class='id identifier rubyid_platforms'>platforms</span>. <span class='const'>You</span> <span class='id identifier rubyid_can'>can</span> <span class='id identifier rubyid_run'>run</span> <span class='id identifier rubyid_commands'>commands</span> <span class='id identifier rubyid_like'>like</span> <span class='id identifier rubyid_these'>these</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_cause'>cause</span> <span class='const'>Bundler</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_fetch'>fetch</span> <span class='kw'>and</span> <span class='id identifier rubyid_cache'>cache</span> <span class='id identifier rubyid_gems'>gems</span> <span class='kw'>for</span> <span class='id identifier rubyid_all'>all</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_named'>named</span> <span class='label'>platforms:</span>

<span class='backtick'>`</span><span class='tstring_end'>`</span></span><span class='backtick'>`</span><span class='tstring_content'> sh
bundle lock --add-platform x86_64-darwin
bundle lock --add-platform x86_64-linux
bundle package --all-platforms</span></code></pre>

<p>For more information, please read <a href="https://blog.thegnar.co/caching-all-native-gem-platforms">this wonderful blog post</a> written by Kevin Murphy explaining this approach.</p>

<h4>Fallback Solution</h4>

<p>If you can&#39;t upgrade to Bundler 2.2 (or later), you can force older versions to always use the <code>ruby</code> platform, which supports all platforms, but applies to <em>all</em> gems and comes with the installation challenges mentioned earlier in this guide. Here&#39;s how:</p>

<pre class="code sh"><code class="sh">rm -rf vendor/cache
bundle config set force_ruby_platform true
bundle install
</code></pre>

<h3>Cannot install <code>racc</code></h3>

<p>As of v1.11.0, Nokogiri is declaring an explicit dependency on <code>racc ~&gt; 1.4</code>, which itself is a C extension that users may have trouble installing.</p>

<h4>Symptoms</h4>

<p>You may see an error message like this:</p>

<p>``` text hl_lines=&quot;1-2 25-26&quot;
Fetching racc 1.5.2
Installing racc 1.5.2 with native extensions
Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</p>

<p>current directory:
/Users/myuser2/.gem/ruby/2.7.0/gems/racc-1.5.2/ext/racc/cparse
/opt/local/bin/ruby2.7 -I /opt/local/lib/ruby2.7/2.7.0 -r
./siteconf20210104-30183-axgzet.rb extconf.rb
checking for rb_ary_subseq()... *** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of necessary
libraries and/or headers.  Check the mkmf.log file for more details.  You may
need configuration options.</p>

<p>Provided configuration options:
       --with-opt-dir
       --with-opt-include
       --without-opt-include=$<code>opt-dir</code>/include
       --with-opt-lib
       --without-opt-lib=$<code>opt-dir</code>/lib
       --with-make-prog
       --without-make-prog
       --srcdir=.
       --curdir
       --ruby=/opt/local/bin/$(RUBY_BASE_NAME)2.7
/opt/local/lib/ruby2.7/2.7.0/mkmf.rb:471:in <code>try_do&#39;: The compiler failed to generate an executable file. (RuntimeError)
You have to install development tools first.
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:564:in</code>try_link0&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:582:in <code>try_link&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:794:in</code>try_func&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:1083:in <code>block in have_func&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:971:in</code>block in checking_for&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:361:in <code>block (2 levels) in postpone&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:331:in</code>open&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:361:in <code>block in postpone&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:331:in</code>open&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:357:in <code>postpone&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:970:in</code>checking_for&#39;
       from /opt/local/lib/ruby2.7/2.7.0/mkmf.rb:1082:in <code>have_func&#39;
       from extconf.rb:6:in</code><main>&#39;</p>

<p>To see why this extension failed to compile, please check the mkmf.log which can
be found here:</p>

<p>/Users/myuser2/.gem/ruby/2.7.0/extensions/arm64-darwin-20/2.7.0/racc-1.5.2/mkmf.log</p>

<p>extconf failed, exit code 1</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#### Solution 1 - Compiler toolchain
</span>
<span class='const'>Racc</span> <span class='id identifier rubyid_needs'>needs</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_same'>same</span> <span class='id identifier rubyid_compiler'>compiler</span> <span class='id identifier rubyid_toolchain'>toolchain</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_be'>be</span> <span class='id identifier rubyid_present'>present</span> <span class='id identifier rubyid_as'>as</span> <span class='id identifier rubyid_any'>any</span> <span class='const'>Gem</span> <span class='id identifier rubyid_with'>with</span> <span class='id identifier rubyid_a'>a</span> <span class='const'>C</span> <span class='id identifier rubyid_extension'>extension</span>. <span class='const'>See</span> [<span class='const'>Appendix</span> <span class='label'>A:</span> <span class='const'>The</span> <span class='const'>Compiler</span> <span class='const'>Toolchain</span>](<span class='comment'>#appendix-a-the-compiler-toolchain).
</span>

<span class='comment'>#### Solution 2 - Avoid installing Racc
</span>
<span class='const'>Ruby</span> <span class='float'>3.0</span> <span class='id identifier rubyid_comes'>comes</span> <span class='id identifier rubyid_with'>with</span> <span class='const'>Racc</span> <span class='float'>1.5</span>.<span class='id identifier rubyid_x'>x</span> <span class='id identifier rubyid_as'>as</span> <span class='id identifier rubyid_a'>a</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>builtin gem</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_so'>so</span> <span class='id identifier rubyid_you'>you</span> <span class='id identifier rubyid_could'>could</span> <span class='id identifier rubyid_update'>update</span> <span class='id identifier rubyid_to'>to</span> <span class='const'>Ruby</span> <span class='int'>3</span><span class='op'>!</span>

<span class='const'>Ruby</span> <span class='float'>2.7</span> <span class='id identifier rubyid_comes'>comes</span> <span class='id identifier rubyid_with'>with</span> <span class='const'>Racc</span> <span class='float'>1.4</span>.<span class='id identifier rubyid_x'>x</span> <span class='id identifier rubyid_as'>as</span> <span class='id identifier rubyid_a'>a</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>builtin gem</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_so'>so</span> <span class='id identifier rubyid_you'>you</span> <span class='id identifier rubyid_could'>could</span> <span class='id identifier rubyid_use'>use</span> <span class='id identifier rubyid_that'>that</span> <span class='id identifier rubyid_version'>version</span> <span class='id identifier rubyid_instead'>instead</span> <span class='id identifier rubyid_of'>of</span> <span class='id identifier rubyid_trying'>trying</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_upgrade'>upgrade</span>. <span class='const'>Update</span> <span class='id identifier rubyid_to'>to</span> <span class='const'>Ruby</span> <span class='float'>2.7</span> <span class='kw'>and</span> <span class='id identifier rubyid_add'>add</span> <span class='id identifier rubyid_a'>a</span> <span class='id identifier rubyid_line'>line</span> <span class='id identifier rubyid_like'>like</span> <span class='backtick'>`</span><span class='tstring_content'>gem &quot;racc&quot;, &quot;~&gt; 1.4.0&quot;</span><span class='tstring_end'>`</span></span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_prevent'>prevent</span> <span class='id identifier rubyid_bundler'>bundler</span> <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_trying'>trying</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_upgrade'>upgrade</span>.



<span class='comment'>### [Linux] `/usr/bin/ld: cannot find -lgmp`
</span>
<span class='const'>If</span> <span class='id identifier rubyid_you'>you</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>re compiling the `ruby` platform gem, and if you</span><span class='tstring_end'>&#39;</span></span><span class='id identifier rubyid_ve'>ve</span> <span class='id identifier rubyid_installed'>installed</span> <span class='const'>Ruby</span> <span class='id identifier rubyid_using'>using</span> <span class='const'>RVM</span><span class='comma'>,</span> [<span class='id identifier rubyid_you'>you</span> <span class='id identifier rubyid_may'>may</span> <span class='id identifier rubyid_require'>require</span> <span class='id identifier rubyid_libgmp'>libgmp</span>](<span class='label'>https:</span><span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>/github</span></span>.<span class='id identifier rubyid_com'>com</span><span class='op'>/</span><span class='id identifier rubyid_rvm'>rvm</span><span class='op'>/</span><span class='id identifier rubyid_rvm'>rvm</span><span class='op'>/</span><span class='id identifier rubyid_issues'>issues</span><span class='op'>/</span><span class='int'>3509</span>).

<span class='comment'>#### Symptoms
</span>
<span class='const'>Gem</span> <span class='id identifier rubyid_installation'>installation</span> <span class='id identifier rubyid_fails'>fails</span> <span class='id identifier rubyid_with'>with</span> <span class='id identifier rubyid_an'>an</span> <span class='id identifier rubyid_error'>error</span> <span class='id identifier rubyid_message'>message</span> <span class='label'>like:</span>

<span class='backtick'>`</span><span class='tstring_end'>`</span></span><span class='backtick'>`</span><span class='tstring_content'> sh
/home/user/.rvm/rubies/ruby-2.2.3/lib/ruby/2.2.0/mkmf.rb:456:in </span><span class='tstring_end'>`</span></span><span class='id identifier rubyid_try_do'>try_do</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>: The compiler failed to generate an executable file. (RuntimeError)
You have to install development tools first.</span></code></pre>

<p>And examination of your <code>mkmf.log</code> file shows:</p>

<pre class="code sh"><code class="sh">/usr/bin/ld: cannot find -lgmp
</code></pre>

<h4>Solution</h4>

<p>Run <code>sudo apt-get install libgmp-dev</code>.</p>

<h3>[MacOS] <code>xcode-select</code> errors with a &#39;network problem&#39;</h3>

<p>If you&#39;re compiling the <code>ruby</code> platform gem ...</p>

<h4>Symptoms</h4>

<p>You see this dialog when you run the commands to update xcode commandline tools:</p>

<p><img src="images/xcode-select-network-problem.png" alt="xcode-select-network-problem"></p>

<h4>Solution</h4>

<p>Run this command to turn off forced-authentication with Apple Software Update:</p>

<pre class="code sh"><code class="sh">sudo defaults delete /Library/Preferences/com.apple.SoftwareUpdate CatalogURL
</code></pre>

<h3>[MacOS] <code>error: use of undeclared identifier &#39;LZMA_OK&#39;</code></h3>

<p>If you&#39;re compiling the <code>ruby</code> platform gem ...</p>

<h4>Symptoms</h4>

<p>An error during Nokogiri installation mentions an undeclared identifier <code>LZMA_OK</code>:</p>

<pre class="code text"><code class="text">xmlIO.c:1450:52: error: use of undeclared identifier &#39;LZMA_OK&#39;
    ret =  (__libxml2_xzclose((xzFile) context) == LZMA_OK ) ? 0 : -1;
                                                   ^
1 error generated.
</code></pre>

<h4>Diagnosis</h4>

<p>When using Homebrew, there are several libraries that use a formula called <code>xz</code> (including <code>the_silver_searcher</code> and <code>imagemagick</code>), which by default install a version of <code>liblzma</code> that is incompatible with most Ruby builds.  (Homebrew installs only the 64-bit version of the library, but most Ruby builds are universal.) This can be fixed in a couple of ways:</p>

<h4>Solution 1</h4>

<p>The most reliable solution appears to be temporarily unlinking <code>xz</code> and relinking it during an install of <code>nokogiri</code>:</p>

<pre class="code sh"><code class="sh">brew unlink xz
gem install nokogiri # or bundle install
brew link xz
</code></pre>

<h4>Solution 2</h4>

<p>The other solution is to use a Homebrew-installed <code>libxml2</code>, as suggested in <a href="#installing-using-standard-system-libraries">Installing Using Standard System Libraries</a>.</p>

<pre class="code sh"><code class="sh">brew install libxml2
gem install nokogiri -- --use-system-libraries \
    --with-xml2-include=$(brew --prefix libxml2)/include/libxml2
</code></pre>

<p>or if you&#39;re using bundler:</p>

<pre class="code sh"><code class="sh">bundle config build.nokogiri --use-system-libraries \
    --with-xml2-include=$(brew --prefix libxml2)/include/libxml2
bundle install
</code></pre>

<p>When working with this, be certain to use <code>$(brew --prefix libxml2)</code> because it will use the correct location for your Homebrew install.</p>

<h3>[MacOS] <code>libiconv is missing</code></h3>

<p>Xcode 10 on macOS Mojave <a href="https://developer.apple.com/documentation/xcode_release_notes/xcode_10_release_notes#3035624">moves the system headers</a> out of <code>/usr/include</code> and so Nokogiri will fail to build when you&#39;re compiling the <code>ruby</code> platform gem.</p>

<h4>Symptoms</h4>

<p>You&#39;ll see an error similar to this:</p>

<p>``` text hl_lines=&quot;3&quot;
Building nokogiri using packaged libraries.</p>

<p>libiconv is missing.  please visit <a href="http://nokogiri.org/tutorials/installing_nokogiri.html">http://nokogiri.org/tutorials/installing_nokogiri.html</a> for help with installing dependencies.</p>

<p>*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of necessary libraries and/or headers.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#### Solution
</span>
<span class='const'>A</span> <span class='id identifier rubyid_temporary'>temporary</span> <span class='id identifier rubyid_workaround'>workaround</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_allow'>allow</span> <span class='id identifier rubyid_previous'>previous</span> <span class='id identifier rubyid_releases'>releases</span> <span class='id identifier rubyid_of'>of</span> <span class='const'><a href="Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_build'>build</span> <span class='id identifier rubyid_is'>is</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_the'>the</span> <span class='id identifier rubyid_extra'>extra</span> <span class='id identifier rubyid_headers'>headers</span> <span class='id identifier rubyid_package'>package</span> <span class='id identifier rubyid_mentioned'>mentioned</span> <span class='kw'>in</span> <span class='id identifier rubyid_the'>the</span> <span class='const'>Xcode</span> <span class='int'>10</span> <span class='id identifier rubyid_release'>release</span> <span class='id identifier rubyid_notes'>notes</span><span class='op'>:</span>

<span class='backtick'>`</span><span class='tstring_end'>`</span></span><span class='backtick'>`</span><span class='tstring_content'> sh
open /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg</span></code></pre>

<p>You can also install the headers package from the command line (e.g. for a build script or a CI server):</p>

<pre class="code sh"><code class="sh">sudo installer -pkg /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg -target /
</code></pre>

<h3>[MacOS] General MacOS Tips</h3>

<p>If you&#39;re seeing other problems:</p>

<ul>
<li>Make sure ruby is compiled with the latest clang compiler.</li>
<li>Binary gems and ruby should be compiled with the same compiler/environment.</li>
<li>If you have multiple versions of Xcode installed, make sure you use the right <code>xcode-select</code>.</li>
<li>Try <a href="#installing-using-standard-system-libraries">Installing Using Standard System Libraries</a>.</li>
</ul>

<h2>Appendix A: The Compiler Toolchain</h2>

<p>A good way to tell if you&#39;ve got your basic Ruby C extension compiler toolchain installed correctly is to try installing the <code>bcrypt</code> gem which has a smaller, self-contained C extension. If you can <code>gem install bcrypt</code>, you&#39;re all set!</p>

<p>Reminder: if you&#39;re installing a native gem, you don&#39;t need to do this.</p>

<h3>Ubuntu or Debian-based Distros</h3>

<pre class="code sh"><code class="sh">sudo apt-get install build-essential ruby-dev
</code></pre>

<h3>Fedora, Red Hat, and CentOS</h3>

<pre class="code sh"><code class="sh">dnf install -y make gcc rpm-build ruby-devel
</code></pre>

<h3>Windows</h3>

<p>Please visit <a href="https://rubyinstaller.org/">RubyInstaller</a> and make sure you install a version &quot;With Devkit&quot;.</p>

<h3>MacOS</h3>

<p>First, make sure you have the latest version of RubyGems and xcode commandline tools:</p>

<pre class="code sh"><code class="sh">gem update --system
xcode-select --install # Then agree to the terms, even if you have done this before!
</code></pre>

<p>Agree to the Xcode license:</p>

<pre class="code sh"><code class="sh">sudo xcodebuild -license
</code></pre>

<hr>

<div id='footer'></div>
</div> <!-- content  -->
</div> <!-- y_main   -->
</body>
</html>